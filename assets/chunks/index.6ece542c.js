import{cC as Ot,cD as Nt,cE as Lt,bT as oe,cF as Pe,cG as de,cH as $t,cI as te,cA as ge,cJ as St,cy as Ut,cK as Rt,cz as Pt,cL as Et,cx as Ft,bU as De}from"../composables_use-crud_index.md.80d9fcd1.js";import{aO as At,aP as re,aQ as Kt,aR as Mt}from"../app.46bd79f7.js";import{X as Be,B as Ce,j as O,s as Le,m as R,l as ie,w as we,k as ee,e as b,p as pe,Y as Bt,d as M,q as ut,at as Ee,H as D,o as T,D as $,E as v,J as w,a as P,t as z,a3 as nt,aM as je,a5 as ze,C as X,G as W,c as K,R as fe,F as Y,K as jt,_ as We,ax as ae,ay as ne,r as zt,L as Wt,aw as Ht,M as qt,n as Qt}from"./framework.893d3c69.js";import{M as ct,f as Gt,t as Fe,L as Jt,u as Yt}from"./vuedraggable.umd.32c58759.js";import{a as ye,u as Xt,c as Zt,w as eo,e as to,x as oo}from"../flow-design_demo.md.7ca749ed.js";import"./index.8273129d.js";import"./theme.ea6c12eb.js";import"../components_icon-select_index.md.fa314bdb.js";import"../components_index.md.c4883e2d.js";import"../components_v-text_index.md.ae040ac4.js";import"../composables_index.md.5c5bc1a0.js";import"../flow-design_index.md.97a0804d.js";import"../flow-pages_index.md.29be8972.js";import"../flow-pages_pages_flow-button_index.md.f959f5b7.js";import"../flow-pages_pages_flow-manage_index.md.68241b66.js";import"../flow-pages_pages_flow-ops_index.md.dbbe51af.js";import"../flow-pages_pages_flow-param_index.md.8bc100fc.js";import"../flow-pages_pages_flow-template_index.md.f624eb5f.js";import"../flow-pages_pages_flow-workbench_index.md.c22e7bad.js";import"../flow-pages_pages_form-template_index.md.95d0e3bf.js";import"../flow-pages_pages_table-template_index.md.74a33780.js";import"../form-design_demo.md.5be482af.js";import"../form-design_index.md.6e4d7b38.js";import"../guide_changelog.md.3f96ecea.js";import"../guide_start.md.0c303a84.js";import"../index.md.45571f0d.js";import"../plugins_avue-patch_index.md.d7ef31ad.js";import"../plugins_compatible-tips_index.md.da152e22.js";import"../plugins_env-dts_index.md.8f818d48.js";import"../plugins_index.md.a4e4b704.js";import"../plugins_load-proxy_index.md.06a48642.js";import"../plugins_setup-extend_index.md.ee89ab25.js";import"../plugins_uni-ui-patch_index.md.2d99c7f5.js";import"../plugins_uview-patch_index.md.c0e9597e.js";import"../types_avue_index.md.71b6211b.js";import"../types_index.md.16238616.js";import"../utils_date_dateFormat.md.a7849fcc.js";import"../utils_date_durationFormat.md.c951f8ee.js";import"../utils_emitter_mittAsync.md.33710d95.js";import"../utils_index.md.b422de11.js";import"../utils_math_index.md.b02108d7.js";import"../utils_object_filterObj.md.8f5ea217.js";import"../utils_object_filterObjDeep.md.0a2f5d0f.js";import"../utils_object_getDataType.md.a3fc0920.js";import"../utils_string_deserialize.md.9bdfc2c7.js";import"../utils_string_serialize.md.0744f8fa.js";import"../utils_string_uuid.md.c7000e71.js";import"../utils_tool_awaitTo.md.5d912ffe.js";import"../utils_tool_enumToDic.md.8db0e352.js";import"../utils_tool_sleep.md.12e01257.js";import"../utils_tree_buildTree.md.748c5451.js";import"../utils_tree_filterTree.md.e959896e.js";import"../utils_tree_findTree.md.3d8903e2.js";import"../utils_tree_flatTree.md.7ce54663.js";import"../utils_tree_treeMap.md.89fc6622.js";import"./vue.runtime.esm-bundler.88a25be6.js";function lo(e,t){return Ot(e,t,function(o,u){return Nt(e,u)})}var ao=Lt(function(e,t){return e==null?{}:lo(e,t)});const no=ao,so={},ro=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),io=()=>so,Ae=e=>Array.isArray(e),He=e=>e!==null&&typeof e=="object",qe=e=>e instanceof Function,be=e=>e==null,Qe=typeof window>"u",dt=()=>{var e;return Qe||be((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},uo=()=>{var e,t;return(e=!Qe&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},$e=()=>new Promise(()=>{}),le=e=>ee(e)?e.value:e,co=e=>He(e)?Object.assign(Ae(e)?[]:{},e):e,he=new Map,po=e=>be(e)?void 0:he.get(e),fo=(e,t,o)=>{const u=he.get(e);u!=null&&u.timer&&clearTimeout(u.timer);const a=setTimeout(()=>he.delete(e),t);he.set(e,{...o,timer:a})},ue=e=>e;function pt(e,t,o){let u,a,s,c,l,n,r=0,d=!1,f=!1,_=!0;const i=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,He(o)&&(d=!!o.leading,f="maxWait"in o,s=f?Math.max(+o.maxWait||0,t):s,_="trailing"in o?!!o.trailing:_);function p(C){const I=u,x=a;return u=a=void 0,r=C,c=e.apply(x,I),c}function m(C,I){return i?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,I)}function g(C){if(i)return window.cancelAnimationFrame(C);clearTimeout(C)}function k(C){return r=C,l=m(V,t),d?p(C):c}function y(C){const I=C-n,x=C-r,A=t-I;return f?Math.min(A,s-x):A}function h(C){const I=C-n,x=C-r;return n===void 0||I>=t||I<0||f&&x>=s}function V(){const C=Date.now();if(h(C))return N(C);l=m(V,y(C))}function N(C){return l=void 0,_&&u?p(C):(u=a=void 0,c)}function L(){l!==void 0&&g(l),r=0,u=n=a=l=void 0}function S(){return l===void 0?c:N(Date.now())}function E(){return l!==void 0}function U(){const C=Date.now(),I=h(C);for(var x=arguments.length,A=new Array(x),B=0;B<x;B++)A[B]=arguments[B];if(u=A,a=this,n=C,I){if(l===void 0)return k(n);if(f)return l=m(V,t),p(n)}return l===void 0&&(l=m(V,t)),c}return U.cancel=L,U.flush=S,U.pending=E,U}function mo(e,t,o){let u=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return He(o)&&(u="leading"in o?!!o.leading:u,a="trailing"in o?!!o.trailing:a),pt(e,t,{leading:u,trailing:a,maxWait:t})}var vo=ue((e,t)=>{let{debounceInterval:o,debounceOptions:u,manual:a}=t;const s=O(!1),c=O(),l=R(()=>u),n=R(()=>le(o)),r=O(e.context.runAsync);return a||(s.value=!0),ie(d=>{be(n.value)||(c.value=pt(f=>f(),n.value,l.value),e.context.runAsync=function(){for(var f=arguments.length,_=new Array(f),i=0;i<f;i++)_[i]=arguments[i];return new Promise((p,m)=>{s.value?(s.value=!1,r.value(..._).then(p).catch(m)):c.value(()=>{r.value(..._).then(p).catch(m)})})},d(()=>{var f;(f=c.value)===null||f===void 0||f.cancel(),e.context.runAsync=r.value}))}),{onCancel(){var d;(d=c.value)===null||d===void 0||d.cancel()}}}),_o=ue((e,t)=>{let{errorRetryCount:o=0,errorRetryInterval:u=0}=t;const a=O(),s=O(0),c=R(()=>le(o)),l=R(()=>le(u));let n=!1;const r=()=>{s.value=0},d=R(()=>{if(l.value)return l.value;const i=1e3,p=1,m=9,g=Math.floor(Math.random()*2**Math.min(s.value,m)+p);return i*g}),f=()=>{let i;const p=c.value===-1,m=s.value<c.value;return(p||m)&&(p||(s.value+=1),i=setTimeout(()=>{n=!0,e.context.refresh()},d.value)),()=>i&&clearTimeout(i)},_=()=>{a.value&&a.value()};return{onBefore(){n||r(),n=!1,_()},onSuccess(){r()},onError(){a.value=f()},onCancel(){r(),_()}}}),wo=ue((e,t)=>{let{ready:o=O(!0),manual:u,defaultParams:a=[]}=t;return we(o,s=>{!u&&s&&e.context.run(...a)},{flush:"sync"}),{onBefore(){if(!(qe(o)?o():o.value))return e.loading.value=!1,{isBreak:!0}}}}),yo=ue((e,t)=>{let{refreshDeps:o,refreshDepsAction:u,manual:a}=t;if(o===void 0||Ae(o)&&o.length===0)return{};const s=Ae(o)?o:[o];return we(s,()=>{u?u():!a&&e.context.refresh()}),{}}),bo=ue((e,t)=>{let{throttleInterval:o,throttleOptions:u}=t;const a=O(),s=R(()=>le(o)),c=R(()=>u),l=O(e.context.runAsync);return ie(n=>{if(be(o))return{};a.value=mo(r=>r(),s.value,c.value),e.context.runAsync=function(){for(var r=arguments.length,d=new Array(r),f=0;f<r;f++)d[f]=arguments[f];return new Promise((_,i)=>{a.value(()=>{l.value(...d).then(_).catch(i)})})},n(()=>{var r;(r=a.value)===null||r===void 0||r.cancel(),e.context.runAsync=l.value})}),{onCancel(){var n;(n=a.value)===null||n===void 0||n.cancel()}}});const go=(e,t)=>o=>{Object.keys(o).forEach(u=>{e[u].value=o[u]}),t.forEach(u=>u(e))},ho=(e,t)=>()=>{let o=t;for(let u=e.length;u-- >0;)o=e[u](o);return o()},ko=(e,t,o)=>{var u,a;const{initialData:s,onSuccess:c,onError:l,onBefore:n,onAfter:r}=t,d=O((u=o==null?void 0:o.loading)!==null&&u!==void 0?u:!1),f=Le((a=o==null?void 0:o.data)!==null&&a!==void 0?a:s),_=Le(o==null?void 0:o.error),i=O(o==null?void 0:o.params),p=O([]),m=Le("pending"),g={},k=go({status:m,loading:d,data:f,error:_,params:i},[]),y=function(V){for(var N=arguments.length,L=new Array(N>1?N-1:0),S=1;S<N;S++)L[S-1]=arguments[S];if(V==="onQuery"){const E=p.value.map(U=>U.onQuery).filter(Boolean);return{servicePromise:ho(E,L[0])()}}else{const E=p.value.map(U=>{var C;return(C=U[V])===null||C===void 0?void 0:C.call(U,...L)});return Object.assign({},...E)}},h=O(0);return g.runAsync=async function(){for(var V=arguments.length,N=new Array(V),L=0;L<V;L++)N[L]=arguments[L];k({loading:!0,params:N,status:"pending"}),h.value+=1;const S=h.value,{isBreak:E,breakResult:U=$e()}=y("onBefore",N);if(E)return k({status:"settled"}),U;n==null||n(N);try{const C=()=>new Promise(A=>A(e(...i.value)));let{servicePromise:I}=y("onQuery",C);I||(I=C());const x=await I;return S!==h.value?$e():(k({data:x,loading:!1,error:void 0,status:"settled"}),y("onSuccess",x,N),c==null||c(x,N),S===h.value&&y("onAfter",N,x,void 0),r==null||r(N),x)}catch(C){if(S!==h.value)return $e();throw k({loading:!1,error:C,status:"settled"}),y("onError",C,N),l==null||l(C,N),S===h.value&&y("onAfter",N,void 0,C),r==null||r(N),C}},g.run=function(){g.runAsync(...arguments).catch(V=>{l||console.error(V)})},g.cancel=()=>{h.value+=1,k({loading:!1}),y("onCancel")},g.refresh=()=>{g.run(...i.value||[])},g.refreshAsync=()=>g.runAsync(...i.value||[]),g.mutate=V=>{const N=qe(V)?V(f.value):V,L=co(N);k({data:L}),y("onMutate",L)},{status:m,loading:d,data:f,error:_,params:i,plugins:p,context:g}};function Vo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const u=Be(ro,{}),a={...io(),...u,...t},{manual:s=!1,defaultParams:c=[]}=a,l=ko(e,a);if(l.plugins.value=o.map(n=>n(l,a)),!s){const n=l.params.value||c;l.context.run(...n)}return Ce(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ke=new Map,Do=(e,t)=>{ke.set(e,t),t.then(o=>(ke.delete(e),o)).catch(()=>{ke.delete(e)})},Co=e=>ke.get(e),ve=new Map,xo=(e,t)=>{ve.has(e)&&ve.get(e).forEach(o=>o(t))},To=(e,t)=>(ve.has(e)?ve.get(e).push(t):ve.set(e,[t]),()=>{const o=ve.get(e).indexOf(t);ve.get(e).splice(o,1)});var Io=ue((e,t)=>{let{cacheKey:o,cacheTime:u=6e5,staleTime:a=0,getCache:s,setCache:c}=t;if(!o)return{};const l=qe(o)?o:()=>o,n=O(()=>{});let r;const d=k=>s?s(k):po(k),f=(k,y,h)=>{c?c(k,h):fo(k,y,h),xo(k,h.data)},_=k=>a===-1||k+a>new Date().getTime(),i=(k,y)=>Object.prototype.hasOwnProperty.call(k,y),p=k=>{const y=l(k);return To(y,h=>{e.data.value=h})},m=l(),g=d(m);return g&&i(g,"data")&&(e.data.value=g.data,e.params.value=g.params),m&&(n.value=p()),Ce(()=>{n.value()}),{onBefore(k){const y=l(k),h=d(y);if(!h||!i(h,"data"))return{};if(_(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(k){const y=e.params.value,h=l(y);let V=Co(h);return V&&V!==r?()=>V:(V=k(),r=V,Do(h,V),()=>V)},onSuccess(k,y){const h=l(y);h&&(n.value(),f(h,u,{data:k,params:y,time:new Date().getTime()}),n.value=p(y))},onMutate(k){const y=l(e.params.value);y&&(n.value(),f(y,u,{data:k,params:e.params.value,time:new Date().getTime()}),n.value=p(e.params.value))}}});function Oo(e){let t,o;class u extends Promise{constructor(s){super(s),this.cancel=()=>{o(),clearTimeout(t)}}}return new u(a=>{o=a,t=setTimeout(o,e)})}function Se(){return new Date().getTime()}var No=ue((e,t)=>{let{loadingDelay:o=0,loadingKeep:u=0}=t;const a=O(()=>{}),s=R(()=>le(o)),c=R(()=>le(u));let l=0,n={};const r=()=>{let d;return s.value&&(d=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},s.value)),()=>d&&clearTimeout(d)};return{onBefore(){e.loading.value=!s.value,a.value(),a.value=r(),l=Se()},onQuery(d){if(!c.value)return()=>d();n=Oo(c.value+s.value);const f=async()=>{try{const i=await d();return Se()-l<=s.value&&n.cancel(),Promise.resolve(i)}catch(i){return Se()-l<=s.value&&n.cancel(),Promise.reject(i)}},_=Promise.allSettled([f(),n]).then(i=>{const p=i[0];return p.status==="fulfilled"?p.value:Promise.reject(p.reason)});return()=>_},onCancel(){a.value()},onAfter(){a.value()}}}),Ue;const ft=new Set,mt=new Set,vt=new Set,Ve=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=ft;break;case"RECONNECT_LISTENER":o=vt;break;case"VISIBLE_LISTENER":o=mt;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Re=e=>{e.forEach(t=>{t()})};!Qe&&(Ue=window)!==null&&Ue!==void 0&&Ue.addEventListener&&(window.addEventListener("visibilitychange",()=>{dt()&&Re(mt)},!1),window.addEventListener("focus",()=>Re(ft),!1),window.addEventListener("online",()=>Re(vt),!1));var Lo=ue((e,t)=>{let{pollingInterval:o,pollingWhenHidden:u=!1,pollingWhenOffline:a=!1,errorRetryCount:s=0}=t;const c=O(),l=O(!1),n=R(()=>le(o)),r=R(()=>le(s)),d=[],f=m=>{m&&d.push(m)},_=()=>(u||dt())&&(a||uo()),i=m=>{if(e.error.value&&r.value!==0)return;let g;if(!be(n.value)&&n.value>=0)if(_())g=setTimeout(m,n.value);else{l.value=!0;return}return()=>g&&clearTimeout(g)},p=()=>{l.value&&_()&&(e.context.refresh(),l.value=!1)};return we(n,()=>{c.value&&(c.value(),c.value=i(()=>e.context.refresh()))}),u||f(Ve("VISIBLE_LISTENER",p)),a||f(Ve("RECONNECT_LISTENER",p)),Ce(()=>{d.forEach(m=>m())}),{onBefore(){var m;(m=c.value)===null||m===void 0||m.call(c)},onCancel(){var m;(m=c.value)===null||m===void 0||m.call(c)},onAfter(){c.value=i(()=>e.context.refresh())}}});const $o=(e,t)=>{let o=!1;return function(){o||(o=!0,e(...arguments),setTimeout(()=>{o=!1},t))}};var So=ue((e,t)=>{let{refreshOnWindowFocus:o=!1,refocusTimespan:u=5e3}=t;const a=R(()=>le(o)),s=R(()=>le(u)),c=[],l=r=>{r&&c.push(r)},n=()=>{c.forEach(r=>r())};return ie(()=>{if(n(),a.value){const r=$o(e.context.refresh,s.value);l(Ve("VISIBLE_LISTENER",r)),l(Ve("FOCUS_LISTENER",r))}}),Ce(()=>{n()}),{}});function _e(e,t){return Vo(e,t,[No,_o,vo,Lo,bo,So,yo,wo,Io])}function xe(){const{request:e}=q(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:i=>e.get(t.detail,{params:i}),getApprovalNode:i=>e.post(t.approvalNode,i),startTask:i=>e.post(t.start,i),commitTask:i=>e.post(t.commit,i),saveDraft:i=>e.post(t.draft,i),revokeTask:i=>e.post(t.revoke,i),terminateTask:i=>e.post(t.terminate,i),withdrawTask:i=>e.post(t.withdraw,i),transferTask:i=>e.post(t.transfer,i),getPublishFlow:()=>e.get(t.publish),getTodoList:i=>e.get(t.todo,{params:i})}}function Uo(e){const{commitTask:t,revokeTask:o,saveDraft:u,startTask:a,terminateTask:s,transferTask:c,withdrawTask:l}=xe(),n=R(()=>{const{flowDetail:d,formVariables:f,approvalFormData:_,debug:i,fileIds:p}=e,{flowDeployId:m}=d.value.process??{},{taskId:g,flowInstanceId:k}=d.value.task??{};return{flowDeployId:m,taskId:g,flowInstanceId:k,variables:f.value,debug:i.value,fileIds:p.value,..._.value}}),r=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(r())return u(n.value)},flow_pass(){return r()?t(n.value):a(n.value)},flow_revoke(){if(r())return o(n.value)},flow_withdraw(){if(r())return l(n.value)},flow_terminate(){if(r())return s(n.value)},flow_transfer(){if(r())return c(n.value)}}}function Ro(e){const t=O({});return ie(async()=>{var u;const{formProperty:o}=((u=b(e))==null?void 0:u.properties)||{};o!=null&&o.length&&(await pe(),Object.keys(t.value).forEach(a=>{var l,n,r,d;const s=((l=t.value[a])==null?void 0:l.label)||"",c=o==null?void 0:o.find(f=>f.prop===a);if(t.value[a].display=c==null?void 0:c.display,t.value[a].disabled=c==null?void 0:c.disabled,t.value[a].detail=c==null?void 0:c.detail,t.value[a].readonly=c==null?void 0:c.readonly,t.value[a].rules=t.value[a].rules??[],c!=null&&c.required&&((n=t.value[a].rules)!=null&&n.some(f=>f.required)))return null;c!=null&&c.required?(r=t.value[a].rules)==null||r.push({required:!0,message:`${s}为必填项`}):t.value[a].rules=(d=t.value[a].rules)==null?void 0:d.filter(f=>!f.required)}))}),t}function Po(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Eo(){return{complete:e=>e}}const _t=Symbol("flowFormState");function Fo(e,t){const o=ye(e,void 0,{passive:!0,deep:!0}),{flowDetail:u,modelValue:a,formLoading:s}=o,{getFlowDetail:c}=xe();ie(()=>{const{flowKey:p,taskId:m,instanceId:g}=e;!p&&!m&&!g||(s.value=!0,c({flowKey:p,taskId:m,flowInstanceId:g}).then(k=>{u.value=k.data,a.value=k.data.formData||{}}).finally(()=>{s.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),n=R(()=>{var p,m,g,k;return l.value.fileTab===!0&&((k=(g=(m=(p=u.value)==null?void 0:p.properties)==null?void 0:m.formProperty)==null?void 0:g.find(y=>y.prop==="fileTab"))==null?void 0:k.display)}),r=R(()=>{var p,m,g,k;return l.value.trackTab===!0&&((k=(g=(m=(p=u.value)==null?void 0:p.properties)==null?void 0:m.formProperty)==null?void 0:g.find(y=>y.prop==="trackTab"))==null?void 0:k.display)}),d=O(!1),f=R(()=>Object.entries(a.value||{}).filter(([p])=>!p.startsWith("$")).map(([p,m])=>({key:p,value:m}))),_=O(),i={...o,formData:a,formVariables:f,approvalVisible:d,showFileTab:n,showTrackTab:r,permission:l,fileIds:_,emit:t};return Bt(_t,i),i}function wt(){return Be(_t)}function Ge(e){return new Promise((t,o)=>{b(e).validate((a,s,c)=>{a?(s(),t(c)):o(c)})})}const Ao=M({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=ye(e,void 0,{passive:!0,deep:!0}),o=Ro(e.flowDetail),{proxy:u}=ut(),a=O({});ie(()=>{const{formOption:l}=e.flowDetail.process??{};a.value=ct.bind(u)(l||'{"menuBtn":false}'),a.value.detail=!!e.detail});const s=O();function c(){return Ge(s)}return{form:t,option:a,defaults:o,formRef:s,validate:c}},render(){return Ee(D("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Ko=M({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Xt(e,"modelValue"),{batchUpdate:u,create:a,remove:s,useList:c}=al(),l=O(!1),{activeBtn:n}=wt(),r=R(()=>{var h;return(h=n.value)==null?void 0:h.buttonKey}),{data:d,refresh:f}=c(r),_=R(()=>{var V,N,L;const h=o.value;if(h&&!((V=d.value)!=null&&V.some(S=>S.content===h))){const S=(((L=(N=d.value)==null?void 0:N[0])==null?void 0:L.sort)||1)-1;return[{content:h,sort:S},...d.value||[]]}return d.value});async function i(h){var V;await a({...h,type:(V=n.value)==null?void 0:V.buttonKey}),oe.success("添加成功"),f()}async function p(h){await s(h.id),oe.success("删除成功"),f()}async function m(h,V){let N=V.parent.data;N=N.map((L,S)=>({id:L.id,sort:S+1})),await u(N),oe.success("修改排序成功"),f(),l.value=!1}function g(){l.value=!0}const k=O();async function y(h){var V;o.value=h.content,await pe(),(V=k.value)==null||V.blur()}return(h,V)=>{const N=D("el-input"),L=D("el-text"),S=D("el-col"),E=D("el-button"),U=D("el-row"),C=D("el-tree"),I=D("el-popover");return T(),$(I,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:v(()=>[w(N,{ref_key:"inputRef",ref:k,modelValue:b(o),"onUpdate:modelValue":V[0]||(V[0]=x=>ee(o)?o.value=x:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:V[1]||(V[1]=x=>l.value=!0),onBlur:V[2]||(V[2]=x=>l.value=!1)},null,8,["modelValue"])]),default:v(()=>[w(C,{data:_.value,"node-key":"content",draggable:"","allow-drop":(x,A,B)=>B!=="inner",props:{label:"content"},onNodeClick:y,onNodeDrop:m,onNodeDragStart:g},{default:v(({data:x})=>[w(U,{style:{width:"250px"}},{default:v(()=>[w(S,{span:20},{default:v(()=>[w(L,{truncated:"",title:x.content},{default:v(()=>[P(z(x.content),1)]),_:2},1032,["title"])]),_:2},1024),w(S,{span:4},{default:v(()=>[x.id?(T(),$(E,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:nt(A=>p(x),["stop"])},null,8,["onClick"])):(T(),$(E,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:nt(A=>i(x),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Mo=M({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=xe(),u={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:a,approvalFormData:s,activeBtn:c,approvalVisible:l,formVariables:n,flowDetail:r}=wt(),d=O([]),f=O([]),_=O([]),i=O([]),p=O(),m=O({}),g={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:k}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function k(I,x,A){var G;const B=d.value[0].type==="ParallelGateway",H=(G=d.value[0].children)==null?void 0:G.every(ce=>Gt([ce],J=>f.value.some(Z=>Z.id===J.id)));if(f.value.length){if(B&&!H)return A("请在每个节点选择审批人")}else return A("请选择审批人");return!0}const y=O(),h=R(()=>{var I,x;return(x=(I=c.value)==null?void 0:I.approval)==null?void 0:x.includes("assignee")}),V=R(()=>{var I,x;return(x=(I=c.value)==null?void 0:I.approval)==null?void 0:x.includes("circulate")}),N=R(()=>{var I,x;return(x=(I=c.value)==null?void 0:I.approval)==null?void 0:x.includes("copyUser")}),L=O(!1),S=O(!1);ie(async()=>{var B,H,G,ce,J;if(!l.value||!p.value)return;const{flowKey:I}=((B=r.value)==null?void 0:B.process)||{},{taskId:x}=((H=r.value)==null?void 0:H.task)||{};d.value=[],f.value=[],_.value=[],i.value=[];const A=x?"":"发起";if(s.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:a.value.comment||A},pe(()=>{var Z,Q;m.value.assignee.display=h.value,m.value.circulate.display=V.value,m.value.copyUser.display=N.value,m.value.comment.display=(Q=(Z=c.value)==null?void 0:Z.approval)==null?void 0:Q.includes("comment")}),h.value)try{S.value=!0;const Z=c.value.buttonKey!=="flow_transfer",Q=await o({flowKey:I,variables:n.value,taskId:x,loadConfig:Z});d.value=Fe(Q.data??[],(se,lt,j)=>{const me=se.id||Pe();return se.taskNodeKey=(j==null?void 0:j.taskNodeKey)??se.taskNodeKey,se.incoming=(j==null?void 0:j.incoming)??se.incoming,{...se,id:me,disabled:se.type!=="user"}}),await pe();const F=E(d.value);F&&((G=y.value)==null||G.setCheckedNodes([F]))}finally{S.value=!1}if(N.value){const Z=await o({flowKey:I,variables:n.value,taskId:x,loadConfig:!1});_.value=Fe(((J=(ce=Z.data)==null?void 0:ce[0])==null?void 0:J.children)??[],Q=>{var F;return Q.id||Pe(),{...Q,label:Q.title,disabled:Q.type!=="user"&&!((F=Q.children)!=null&&F.length)}})}});function E(I){var x;if(I.length===1)return(x=I[0].children)!=null&&x.length?E(I[0].children):I[0]}async function U(I,x){var B,H;if(I.type!=="user")return;await pe(),await pe();const A=(B=y.value)==null?void 0:B.getCheckedNodes();f.value=A.filter(G=>G.type==="user"),(H=y.value)==null||H.setCheckedNodes(f.value)}async function C(){await Ge(p),L.value=!0;const I={},x={},A=new Set;f.value.forEach(B=>{const{taskNodeKey:H,incoming:G}=B;I[H]||(I[H]=new Set),B.userId&&I[H].add(B.userId),x[H]=[...I[H]].join(","),A.add(G)}),s.value.assignee=x,s.value.outgoing=[...A],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",a),t("confirm")}return(I,x)=>{const A=D("el-col"),B=D("el-tag"),H=D("el-tree-select"),G=D("avue-form"),ce=D("el-row"),J=D("el-button"),Z=D("el-dialog"),Q=je("loading");return T(),$(Z,{modelValue:b(l),"onUpdate:modelValue":x[6]||(x[6]=F=>ee(l)?l.value=F:null),title:b(c).name,width:h.value?"800px":"500px","append-to-body":""},{footer:v(()=>[w(J,{onClick:x[5]||(x[5]=F=>l.value=!1)},{default:v(()=>[P(" 取 消 ")]),_:1}),w(J,{type:"primary",onClick:C},{default:v(()=>[P(" 确 定 ")]),_:1})]),default:v(()=>[w(ce,{gutter:20},{default:v(()=>[h.value?(T(),$(A,{key:0,span:10},{default:v(()=>[ze((T(),$(b(At),{ref_key:"treeRef",ref:y,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:d.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:U},{default:v(({data:F})=>[X("div",null,[w(b(re),{icon:u[F.type],style:{display:"inline-block"}},null,8,["icon"]),X("span",null,z(F.title),1)])]),_:1},8,["data"])),[[Q,S.value]])]),_:1})):W("",!0),w(A,{span:h.value?14:24},{default:v(()=>[w(G,{ref_key:"formRef",ref:p,modelValue:b(s),"onUpdate:modelValue":x[3]||(x[3]=F=>ee(s)?s.value=F:null),defaults:m.value,"onUpdate:defaults":x[4]||(x[4]=F=>m.value=F),option:g},{assignee:v(()=>[(T(!0),K(Y,null,fe(f.value,F=>(T(),$(B,{key:F.id,type:"info"},{default:v(()=>[P(z(F.title),1)]),_:2},1024))),128))]),copyUser:v(()=>[w(H,{modelValue:i.value,"onUpdate:modelValue":[x[0]||(x[0]=F=>i.value=F),x[1]||(x[1]=F=>b(s).copyUser=F.join(","))],data:_.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:v(()=>[w(Ko,{modelValue:b(s).comment,"onUpdate:modelValue":x[2]||(x[2]=F=>b(s).comment=F)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),st=M({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:u}=rl(),a=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(r){t("update:modelValue",r.join(","))}}),s=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(r){t("update:modelValue",r)}}),c=O([]),l=O(!1),n=R(()=>{var r,d;return(d=(r=o.tableData)==null?void 0:r.row)==null?void 0:d.type});return we(n,r=>{["dept","post","user"].includes(r)&&(l.value=!0,u(r==="user"?"":r).then(d=>{c.value=Fe(d.data,f=>({label:f.title,value:f.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(r,d)=>{const f=D("el-tree-select"),_=D("el-input");return["dept","post","user"].includes(n.value)?(T(),$(f,{key:0,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=i=>a.value=i),data:c.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(T(),$(_,{key:1,modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=i=>s.value=i)},null,8,["modelValue"]))}}}),Bo={key:0,class:"flow-viewer"},jo={class:"flow-status-legend"},zo=M({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{FlowDesign:u}=q(),a=R({get(){let i=Zt();return typeof o.modelValue=="string"&&o.modelValue?i=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(i=o.modelValue),i},set(i){t("update:modelValue",JSON.stringify(i))}}),s=R(()=>{const{column:i=[],group:p=[]}=JSON.parse(o.flowFormOption||"{}");return[...i,...p.map(g=>g.column??[]).flat()]}),{data:c}=Xe().useList(),l=R(()=>{var i;return{formPropertyList:s.value,buttonList:(i=c.value)==null?void 0:i.filter(p=>p.status===1),fieldsDic:s.value.map(p=>({label:p.label,value:`\${${p.prop}}`,desc:`\${${p.prop}}`})),flowButtonDisplayDic:de(Je),flowButtonApprovalDic:de(Ye)}}),n=O({}),r=O({});eo(r,async i=>{var p,m,g,k,y,h,V,N,L;i&&((g=(m=(p=i.assignee)==null?void 0:p.children)==null?void 0:m.column)!=null&&g[1]&&(i.assignee.children.column[1].component=st),(L=(N=(V=(h=(y=(k=i.circulate)==null?void 0:k.children)==null?void 0:y.column)==null?void 0:h[1])==null?void 0:V.children)==null?void 0:N.column)!=null&&L[1]&&(i.circulate.children.column[1].children.column[1].component=st))},{debounce:1});const{data:d}=Ie().useParam("flow.task.status"),f=R(()=>{var i;return(i=o.flowHistory)==null?void 0:i.map(p=>{var g,k;const m=(k=(g=d.value)==null?void 0:g.find(y=>y.value===p.status))==null?void 0:k.style;return{id:p.taskNodeKey,style:m}})}),_=R(()=>{var i,p;return(p=(i=o.flowHistory)==null?void 0:i.filter(m=>m.taskNodeType==="userTask"))==null?void 0:p.map(m=>{var g;return{id:m.taskNodeKey,content:`<div>${m.assigneeName}</div>
        <div>${m.endTime??""}</div>
        <div>${((g=m.comment)==null?void 0:g.comment)??""}</div>`}})});return(i,p)=>i.view?(T(),K("div",Bo,[X("div",jo,[(T(!0),K(Y,null,fe(b(d),m=>{var g;return T(),K("div",{key:m.label,class:"legend-item"},[X("div",{class:"legend-color",style:jt({backgroundColor:(g=m.style)==null?void 0:g.fill})},null,4),X("span",null,z(m.label),1)])}),128))]),w(b(u),{"model-value":a.value,styles:f.value,tooltips:_.value,type:"viewer"},null,8,["model-value","styles","tooltips"])])):(T(),$(b(u),{key:1,modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=m=>a.value=m),formData:n.value,"onUpdate:formData":p[1]||(p[1]=m=>n.value=m),formDefaults:r.value,"onUpdate:formDefaults":p[2]||(p[2]=m=>r.value=m),"form-options":b(to),"data-options":l.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const Te=We(zo,[["__scopeId","data-v-16f31a00"]]),Wo={class:"flow-track"},Ho={key:0},qo={key:1},Qo=M({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=O("table"),u=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],a=R(()=>{var n,r,d;return((d=(r=(n=t.flowDetail)==null?void 0:n.flowHistory)==null?void 0:r.filter(f=>f.taskNodeType==="userTask"))==null?void 0:d.map(f=>({...f,duration:$t(f.duration)})))??[]}),s={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:c}=Ie().useParam("flow.handle.type");function l(n){var r;return(r=c.value)==null?void 0:r.find(d=>d.value===n)}return(n,r)=>{var k,y,h;const d=D("el-radio-button"),f=D("el-radio-group"),_=D("avue-crud"),i=D("el-card"),p=D("el-timeline-item"),m=D("el-timeline"),g=D("el-empty");return T(),K(Y,null,[w(f,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=V=>o.value=V)},{default:v(()=>[(T(),K(Y,null,fe(u,V=>w(d,{key:V.label,label:V.label},{default:v(()=>[w(b(re),{icon:V.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),X("div",Wo,[o.value==="table"?(T(),$(_,{key:0,data:a.value,option:s},null,8,["data"])):W("",!0),o.value==="graph"?(T(),$(Te,{key:1,"model-value":(y=(k=n.flowDetail)==null?void 0:k.process)==null?void 0:y.flowData,"flow-history":(h=n.flowDetail)==null?void 0:h.flowHistory,view:""},null,8,["model-value","flow-history"])):W("",!0),o.value==="timeline"?(T(),K(Y,{key:2},[a.value.length?(T(),$(m,{key:0},{default:v(()=>[(T(!0),K(Y,null,fe([...a.value].reverse(),V=>(T(),$(p,{key:V.id,timestamp:V.endTime,placement:"top"},{default:v(()=>[w(i,null,{default:v(()=>{var N,L,S;return[X("div",null,z(V.assigneeName)+" 开始处理 ["+z(V.taskNodeName)+"] 环节 ",1),V.duration?(T(),K("div",Ho," 办理时长："+z(V.duration),1)):W("",!0),V.type&&((N=V.comment)!=null&&N.comment)?(T(),K("div",qo,z((L=l(V.type))==null?void 0:L.label)+"意见："+z((S=V.comment)==null?void 0:S.comment),1)):W("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),$(g,{key:1}))],64)):W("",!0)])],64)}}});const Go=We(Qo,[["__scopeId","data-v-430a7108"]]),Jo=M({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:u}=Xe().useList();function a(c,l){return c.map(n=>{const r=l.find(f=>f.buttonKey===n.buttonKey);return{...n,...no(r,["display","approval"])}})}const s=R(()=>{var p,m,g,k,y;const c={userId:"1"},{assignee:l,status:n}=((p=o.flowDetail)==null?void 0:p.task)||{},{createUser:r,flowInstanceId:d,status:f}=((m=o.flowDetail)==null?void 0:m.flowInstance)||{},_={true:!0,false:!1,startUser:r==c.userId,assignee:l==c.userId,todo:n==2,done:n==1,notstarted:!d,started:!!d,finished:f===1,unfinished:f===2};return((y=a(u.value??[],((k=(g=o.flowDetail)==null?void 0:g.properties)==null?void 0:k.button)??[]))==null?void 0:y.filter(h=>{var V,N;return(N=(V=h.display)==null?void 0:V.split(","))==null?void 0:N.every(L=>_[L])}))??[]});return(c,l)=>{const n=D("el-button");return T(!0),K(Y,null,fe(s.value,r=>(T(),$(n,{key:r.buttonKey,type:r.buttonType,onClick:d=>t("click",r)},{default:v(()=>[w(b(re),{icon:r.icon},null,8,["icon"]),P(" "+z(r.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Yo=M({__name:"upload-table",props:{flowDetail:{},modelValue:{}},setup(e){const t=e,{modelValue:o}=ye(t,void 0,{passive:!0}),{upload:{action:u,headers:a,preview:s,download:c,props:l}}=q(),n=typeof a=="function"?a():a,r=R(()=>{var y,h;return((h=(y=t.flowDetail)==null?void 0:y.task)==null?void 0:h.flowInstanceId)??Pe()}),d={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:f,getDataList:_,handleDel:i,handleSave:p,afterGetList:m,crudStateRefs:{tableData:g}}=te({crudOption:{...nl(),saveSuccessMsg:"上传成功"},tableOption:d,queryForm:{isLatest:1,flowInstanceId:r.value}});m(()=>{o.value=g.value.map(y=>y.id).join(",")}),_();async function k(y,h){var C,I;const{fileName:V,fileType:N,fileSize:L,fileUrl:S,res:E}=l,U={fileName:ge({res:y},`${E}.${V}`),fileType:ge({res:y},`${E}.${N}`),fileSize:ge({res:y},`${E}.${L}`),fileUrl:ge({res:y},`${E}.${S}`),taskId:(I=(C=t.flowDetail)==null?void 0:C.task)==null?void 0:I.taskId,flowInstanceId:r.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await p(U,_,()=>{})}return(y,h)=>{const V=D("el-button"),N=D("el-upload"),L=D("avue-crud");return T(),$(L,ae(ne(b(f))),{"menu-left":v(()=>[w(N,{action:b(u),headers:b(n),"show-file-list":!1,onSuccess:h[0]||(h[0]=S=>k(S))},{default:v(()=>[w(V,{type:"primary",icon:"el-icon-upload"},{default:v(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:v(({row:S,index:E})=>[w(V,{type:"primary",text:"",icon:"el-icon-view",onClick:U=>{var C;return(C=b(s))==null?void 0:C(S,b(g))}},{default:v(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),w(V,{type:"primary",text:"",icon:"el-icon-download",onClick:U=>{var C;return(C=b(c))==null?void 0:C(S,b(g))}},{default:v(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),w(N,{action:b(u),headers:b(n),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:U=>k(U,S)},{default:v(()=>[w(V,{type:"primary",text:"",icon:"el-icon-upload"},{default:v(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),w(V,{type:"primary",text:"",icon:"el-icon-delete",onClick:U=>b(i)(S,E)},{default:v(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Xo={class:"flow-form__title"},yt=M({__name:"index",props:Po(),emits:Eo(),setup(e,{emit:t}){const o=e,u=Fo(o,t),{flowDetail:a,modelValue:s,activeTab:c,activeBtn:l,formLoading:n,approvalVisible:r,submitLoading:d,fileIds:f}=u,_=O();async function i(g){var k,y;l.value=g,await((k=_.value)==null?void 0:k.validate()),await((y=o.beforeClick)==null?void 0:y.call(o,g)),(g==null?void 0:g.approval)!=="false"?r.value=!0:m()}const p=Uo(u);async function m(){var g,k;try{const{buttonKey:y}=l.value;d.value=!0,await((g=o.beforeSubmit)==null?void 0:g.call(o,l.value));const h=(k=p[y])==null?void 0:k.call(p);h instanceof Promise?(await h,oe.success("操作成功"),r.value=!1,t("complete",l.value)):oe.error("操作失败")}finally{d.value=!1}}return(g,k)=>{const y=D("el-skeleton"),h=D("el-main"),V=D("el-header"),N=D("el-tab-pane"),L=D("el-tabs"),S=D("el-container");return b(n)?(T(),$(h,{key:0},{default:v(()=>[w(y)]),_:1})):(T(),$(S,{key:1,class:"flow-form"},{default:v(()=>[w(V,{class:"flow-form__header"},{default:v(()=>{var E;return[X("div",Xo,z((E=b(a).flowInstance)==null?void 0:E.title),1),w(Jo,{"flow-detail":b(a),onClick:i},null,8,["flow-detail"])]}),_:1}),w(h,{class:"flow-form__main"},{default:v(()=>[w(L,{modelValue:b(c),"onUpdate:modelValue":k[2]||(k[2]=E=>ee(c)?c.value=E:null)},{default:v(()=>{var E,U;return[(U=(E=b(a))==null?void 0:E.process)!=null&&U.formPath?zt(g.$slots,"default",{key:0}):(T(),$(N,{key:1,label:"审批信息",name:"form"},{default:v(()=>[w(Ao,{ref_key:"formRef",ref:_,modelValue:b(s),"onUpdate:modelValue":k[0]||(k[0]=C=>ee(s)?s.value=C:null),"flow-detail":b(a)},null,8,["modelValue","flow-detail"])]),_:1})),w(N,{label:"附件资料",name:"file",lazy:""},{default:v(()=>[w(Yo,{modelValue:b(f),"onUpdate:modelValue":k[1]||(k[1]=C=>ee(f)?f.value=C:null),"flow-detail":b(a)},null,8,["modelValue","flow-detail"])]),_:1}),w(N,{label:"流程跟踪",name:"track",lazy:""},{default:v(()=>[w(Go,{"flow-detail":b(a)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),w(Mo,{onConfirm:m})]),_:3}))}}});function bt(e,t){switch(t.type){case"window":return Zo(e,t);case"dialog":case"drawer":return el(e,t);default:return{open:()=>{},close:()=>{}}}}function Zo(e,t){const{window:{url:o="",name:u="flow-form",features:a="left=0,top=0,width=1600,height=900"}={}}=t,s=O(null),c=R(()=>`${o}?${St(Ut(e,Rt(Pt,Et)))}`);return{open:()=>{var r;s.value=window.open(c.value,u,a),(r=s.value)==null||r.addEventListener("message",d=>{const{event:f}=d.data,_=b(e)[f];typeof _=="function"&&_(d.data)})},close:()=>{var r;return(r=s.value)==null?void 0:r.close()},openedWindow:s}}function el(e,t){const{appContext:o}=ut();let u;const a=()=>{u=document.createElement("div"),u.className="flow-form-wrapper";const c=tl(t.formPath),l=Ee(c,{...b(e)}),n=Ee(t.type==="dialog"?Kt:Mt,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:s,...t.overlay},l);n.appContext=o,Ht(n,u),document.body.appendChild(u)},s=()=>{u&&document.body.removeChild(u)};return{open:a,close:s}}function tl(e){return e?Wt(()=>qt(()=>import(e),[])):yt}const rt=Symbol("flowPagesConfig"),ol={FlowDesign:null,FormDesign:null,request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var gt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(gt||{});const Ke=de(gt);function q(e,t){return e&&t?(e.provide(rt,Ft(ol,t)),t):Be(rt)}var ht=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(ht||{}),Je=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Je||{}),Ye=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(Ye||{}),kt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(kt||{});function Xe(){const{request:e}=q(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ll(){const{request:e}=q(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function al(){const{request:e}=q(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=n=>e.get(t.list,{params:{type:n,ascs:"sort"}});return{url:t,getList:o,useList:n=>_e(()=>o(n.value).then(r=>r.data.records),{refreshDeps:[n]}),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),batchUpdate:n=>e.post(t.batchUpdate,n)}}function Ze(){const{request:e}=q(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var Vt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Vt||{});function et(){const{request:e}=q(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:s=>e.get(t.list,{params:s}),getDetail:s=>e.get(t.detail,{params:s}),update:s=>e.post(t.update,s)}}function nl(){const{request:e}=q(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:s=>e.get(t.list,{params:s}),create:s=>e.post(t.save,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function sl(){const{request:e}=q(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:u=>e.get(t.list,{params:u})}}function Ie(){const{request:e}=q(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=r=>e.get(t.list,{params:r}),u=()=>e.get(t.all),a=r=>e.get(t.key,{params:{paramKey:r}});return{url:t,getList:o,getAllParam:u,getParam:a,useParam:r=>_e(()=>a(r).then(d=>d.data)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}})}}function Dt(){const{request:e}=q(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function rl(){const{request:e}=q(),t={tree:"/sapier-flow/flow-user/tree"},o=a=>e.get(t.tree,{params:{filter:a}});return{url:t,getUserTree:o,useUserTree:()=>_e(()=>o().then(a=>a.data))}}function Ct(){const{request:e}=q(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var xt=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(xt||{});function Me(){const{request:e}=q(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=n=>e.get(t.list,{params:n});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),deploy:n=>e.post(t.deploy,n)}}const il={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:de(ht)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(Je),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(Ye),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:de(kt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},ul=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:u}=te({tableOption:il,crudOption:Xe(),sortOption:{ascs:"sort"}});return u(),(a,s)=>{const c=D("el-button"),l=D("avue-crud");return T(),$(l,ae(ne(b(t))),{icon:v(({row:n})=>[w(b(re),{icon:n.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:v(({row:n})=>[w(c,{type:n.buttonType},{default:v(()=>[w(b(re),{icon:n.icon},null,8,["icon"]),P(" "+z(n.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":v(()=>[w(c,{type:b(o).buttonType},{default:v(()=>[w(b(re),{icon:b(o).icon},null,8,["icon"]),P(" "+z(b(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),tt={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},cl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...tt.column.map((e,t)=>({...e,search:t<=2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Tt=M({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:u,deploy:a}=Ze(),{bindVal:s,crudStateRefs:{searchForm:c},getDataList:l}=te({tableOption:cl,crudOption:{getList:u},searchForm:{categoryId:o.categoryId}});ie(()=>{c.value.categoryId=o.categoryId??"",l()});const n=O(!1);async function r(d){await De.confirm("发布新版本，是否确认？","提示",{type:"success"}),n.value=!0,a({flowModuleId:d.flowModuleId}).then(()=>{oe.success("发布成功"),l()}).finally(()=>{n.value=!1})}return(d,f)=>{const _=D("el-button"),i=D("avue-crud");return T(),$(i,ae(ne(b(s))),{"menu-left":v(()=>[w(_,{type:"primary",icon:"el-icon-plus",onClick:f[0]||(f[0]=p=>t("add"))},{default:v(()=>[P(" 新增 ")]),_:1})]),menu:v(({row:p})=>[w(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:m=>t("view",p)},{default:v(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:m=>t("edit",p)},{default:v(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-upload",onClick:m=>r(p)},{default:v(()=>[P(" 发布 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-switch",onClick:m=>t("version",p)},{default:v(()=>[P(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:v(({row:p})=>[w(b(re),{icon:p.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),dl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...tt.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},It=M({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:u,update:a}=et(),{bindVal:s,crudStateRefs:{searchForm:c},getDataList:l}=te({tableOption:dl,crudOption:{getList:u,dataPath:"res.data"}});ie(()=>{o.flowModuleId&&(c.value.flowModuleId=o.flowModuleId,l())});const n=O(!1);async function r(d){await De.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),n.value=!0,a({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{oe.success("设置成功"),l()}).finally(()=>{n.value=!1})}return(d,f)=>{const _=D("el-button"),i=D("avue-crud");return T(),$(i,ae(ne(b(s))),{"menu-left":v(()=>[w(_,{loading:n.value,type:"primary",icon:"el-icon-arrow-left",onClick:f[0]||(f[0]=p=>t("back"))},{default:v(()=>[P(" 返回 ")]),_:1},8,["loading"])]),menu:v(({row:p})=>[w(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:m=>t("view",p)},{default:v(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:m=>t("edit",p)},{default:v(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,disabled:p.mainVersion===b(Vt).是,type:"text",icon:"el-icon-switch",onClick:m=>r(p)},{default:v(()=>[P(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:v(({row:p})=>[w(b(re),{icon:p.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),it={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},pl=M({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:u},getDataList:a,handleSave:s,handleUpdate:c,handleDel:l}=te({crudOption:{rowKey:"id",...ll(),dataPath:"res.data"},tableOption:it,pageOption:{pageSize:20}});a();function n(f,_,i,p){s(_,i,p)}function r(f,_,i,p){c(_,NaN,i,p)}async function d(f,_){await l(f.data,NaN),_()}return(f,_)=>{const i=D("avue-tree");return T(),$(i,{modelValue:b(o),"onUpdate:modelValue":_[0]||(_[0]=p=>ee(o)?o.value=p:null),option:b(it),data:b(u),onNodeClick:_[1]||(_[1]=p=>t("node-click",p)),onSave:n,onUpdate:r,onDel:d},null,8,["modelValue","option","data"])}}}),ot=M({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var n;const o=e,{FormDesign:u}=q(),a=R({get(){return o.modelValue?ct(o.modelValue):{menuBtn:!1,span:24}},set(r){t("update:modelValue",Jt(r,{useJson5:!1}))}}),s=R(()=>o.fields?JSON.parse(o.fields):[]),c=R(()=>{const r={type:"select",dicData:s.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...r,props:{label:"name",value:"name",desc:"comment"}},{...r,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((n=Yt.settings)==null?void 0:n.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(r,d)=>{const f=D("avue-form");return r.view?(T(),$(f,{key:0,class:Qt(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(T(),$(b(u),{key:1,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),"base-option":c.value,resources:l},null,8,["modelValue","base-option"]))}}}),fl=X("span",null,"流程设计",-1),ml={key:0},vl={key:1},_l={style:{height:"calc(100vh - 144px)"}},wl=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const u=ye(e),{visible:a,modelValue:s}=u,{create:c,deploy:l,getDetail:n,update:r}=Ze(),{getDetail:d,update:f}=et(),_=["流程信息","表单设计","模型设计","完成"],i=O(!1);we(a,async U=>{if(!U)return;const{flowModuleId:C}=s.value,{flowDeployId:I}=s.value;try{i.value=!0;let x={};I?x=await d({flowDeployId:I}):C&&(x=await n({flowModuleId:C})),s.value=x.data}finally{i.value=!1}},{immediate:!0});const{data:p}=Ct().useList(),{data:m}=Dt().useList(),{data:g}=Me().useList(),k=R(()=>{var U,C;return(C=(U=g.value)==null?void 0:U.find(I=>I.tableName===s.value.formDataTable))==null?void 0:C.tableFields}),y=O(0),h=R(()=>{var U,C;return y.value===1?((U=p.value)==null?void 0:U.map(I=>({label:I.formName,value:I.formOption})))??[]:y.value===2?((C=m.value)==null?void 0:C.map(I=>({label:I.flowName,value:I.flowData})))??[]:[]});function V(U){y.value===1?s.value.formOption=U.value:y.value===2&&(s.value.flowData=U.value)}const N=O();async function L(U){y.value===0&&await Ge(N),i.value=!0;const{flowModuleId:C}=s.value,{flowDeployId:I}=s.value;try{I?await f(s.value):C?await r(s.value):await c(s.value).then(x=>{s.value.flowModuleId=x.data.flowModuleId}),oe.success("保存成功")}finally{i.value=!1}typeof U=="number"?y.value=U:y.value++}async function S(){await De.confirm("发布新版本，是否确认？","提示"),i.value=!0,l({flowModuleId:s.value.flowModuleId}).then(()=>{oe.success("发布成功")}).finally(()=>{i.value=!1})}function E(){a.value=!1,y.value=0,s.value={},t("close")}return(U,C)=>{const I=D("el-link"),x=D("el-dropdown-item"),A=D("el-dropdown-menu"),B=D("el-dropdown"),H=D("el-col"),G=D("el-step"),ce=D("el-steps"),J=D("el-button"),Z=D("el-row"),Q=D("avue-form"),F=D("el-result"),se=D("el-dialog"),lt=je("loading");return T(),$(se,{modelValue:b(a),"onUpdate:modelValue":C[5]||(C[5]=j=>ee(a)?a.value=j:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:E},{header:v(()=>[w(Z,{justify:"center"},{default:v(()=>[w(H,{span:5},{default:v(()=>{var j,me,Oe,at;return[X("div",null,[fl,(j=b(s))!=null&&j.flowName?(T(),K("span",ml," - "+z((me=b(s))==null?void 0:me.flowName),1)):W("",!0),(Oe=b(s))!=null&&Oe.version?(T(),K("span",vl," - V"+z((at=b(s))==null?void 0:at.version),1)):W("",!0)]),h.value.length?(T(),$(B,{key:0},{dropdown:v(()=>[w(A,null,{default:v(()=>[(T(!0),K(Y,null,fe(h.value,Ne=>(T(),$(x,{key:Ne.label,onClick:Al=>V(Ne)},{default:v(()=>[P(z(Ne.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:v(()=>[w(I,{icon:"el-icon-arrow-down",underline:!1},{default:v(()=>[P(" 选择模板 ")]),_:1})]),_:1})):W("",!0)]}),_:1}),w(H,{span:14},{default:v(()=>[w(ce,{active:y.value,simple:"","process-status":"finish","finish-status":"success"},{default:v(()=>[(T(),K(Y,null,fe(_,(j,me)=>w(G,{key:me,title:j,onClick:Oe=>L(me)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),w(H,{span:5,style:{"text-align":"right"}},{default:v(()=>[w(J,{disabled:y.value===0,loading:i.value,type:"primary",onClick:C[0]||(C[0]=j=>y.value--)},{default:v(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),w(J,{disabled:y.value===_.length-1,type:"primary",loading:i.value,onClick:C[1]||(C[1]=j=>L())},{default:v(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),w(J,{onClick:E},{default:v(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:v(()=>[ze((T(),K("div",_l,[y.value===0?(T(),$(Q,{key:0,ref_key:"formRef",ref:N,modelValue:b(s),"onUpdate:modelValue":C[2]||(C[2]=j=>ee(s)?s.value=j:null),option:b(tt),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):W("",!0),y.value===1?(T(),$(ot,{key:1,modelValue:b(s).formOption,"onUpdate:modelValue":C[3]||(C[3]=j=>b(s).formOption=j),fields:k.value},null,8,["modelValue","fields"])):W("",!0),y.value===2?(T(),$(Te,{key:2,modelValue:b(s).flowData,"onUpdate:modelValue":C[4]||(C[4]=j=>b(s).flowData=j),"flow-form-option":b(s).formOption},null,8,["modelValue","flow-form-option"])):W("",!0),y.value===3?(T(),$(F,{key:3,icon:"success",title:"流程设计完成"},{extra:v(()=>[b(s).flowDeployId?W("",!0):(T(),$(J,{key:0,type:"primary",onClick:S},{default:v(()=>[P(" 发布 ")]),_:1})),w(J,{onClick:E},{default:v(()=>[P(" 关闭 ")]),_:1})]),_:1})):W("",!0)])),[[lt,i.value]])]),_:1},8,["modelValue"])}}}),yl=X("span",null,"流程查看",-1),bl={key:0},gl={key:1},hl=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=ye(e),{visible:u,modelValue:a}=o,{getDetail:s}=Ze(),{getDetail:c}=et(),l=O("form"),n=O(!1);we(u,async d=>{if(!d)return;const{flowModuleId:f}=a.value,{flowDeployId:_}=a.value;try{n.value=!0;let i={};_?i=await c({flowDeployId:_}):f&&(i=await s({flowModuleId:f})),a.value={...i.data}}finally{n.value=!1}},{immediate:!0});function r(){a.value={},l.value="form"}return(d,f)=>{const _=D("el-tab-pane"),i=D("el-tabs"),p=D("el-dialog"),m=je("loading");return T(),$(p,{modelValue:b(u),"onUpdate:modelValue":f[3]||(f[3]=g=>ee(u)?u.value=g:null),width:"60%",top:"0",onClose:r},{header:v(()=>{var g,k,y,h;return[yl,(g=b(a))!=null&&g.flowName?(T(),K("span",bl," - "+z((k=b(a))==null?void 0:k.flowName),1)):W("",!0),(y=b(a))!=null&&y.version?(T(),K("span",gl," - V"+z((h=b(a))==null?void 0:h.version),1)):W("",!0)]}),default:v(()=>[ze((T(),$(i,{modelValue:l.value,"onUpdate:modelValue":f[2]||(f[2]=g=>l.value=g)},{default:v(()=>[w(_,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:v(()=>[l.value==="form"&&b(a).formOption?(T(),$(ot,{key:0,modelValue:b(a).formOption,"onUpdate:modelValue":f[0]||(f[0]=g=>b(a).formOption=g),view:""},null,8,["modelValue"])):W("",!0)]),_:1}),w(_,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:v(()=>[l.value==="flow"?(T(),$(Te,{key:0,modelValue:b(a).flowData,"onUpdate:modelValue":f[1]||(f[1]=g=>b(a).flowData=g),view:""},null,8,["modelValue"])):W("",!0)]),_:1})]),_:1},8,["modelValue"])),[[m,n.value]])]),_:1},8,["modelValue"])}}}),kl=M({__name:"index",setup(e){const t=O("definition"),o=O({}),u=O(""),a=O("");function s(p){u.value===p.id?u.value="":u.value=p.id}const c=O(!1),l=O(!1);function n(){o.value={},c.value=!0}function r(p){o.value=p,c.value=!0}function d(p){o.value=p,l.value=!0}function f(p){a.value=p.flowModuleId||"",t.value="deploy"}function _(){a.value="",t.value="definition"}async function i(){const p=t.value;await pe(),t.value="",await pe(),t.value=`${p}`}return(p,m)=>{const g=D("el-col"),k=D("el-row");return T(),$(k,{gutter:20},{default:v(()=>[w(g,{span:4},{default:v(()=>[w(pl,{onNodeClick:s})]),_:1}),w(g,{span:20},{default:v(()=>[t.value==="definition"?(T(),$(Tt,{key:0,"category-id":u.value,onAdd:n,onEdit:r,onView:d,onVersion:f},null,8,["category-id"])):W("",!0),t.value==="deploy"?(T(),$(It,{key:1,"flow-module-id":a.value,onEdit:r,onView:d,onBack:_},null,8,["flow-module-id"])):W("",!0),w(wl,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=y=>o.value=y),visible:c.value,"onUpdate:visible":m[1]||(m[1]=y=>c.value=y),onClose:i},null,8,["modelValue","visible"]),w(hl,{modelValue:o.value,"onUpdate:modelValue":m[2]||(m[2]=y=>o.value=y),visible:l.value,"onUpdate:visible":m[3]||(m[3]=y=>l.value=y)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Vl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},Dl=M({__name:"index",setup(e){const t=oo("debugMode",!1),{getList:o}=sl(),{bindVal:u,getDataList:a}=te({tableOption:Vl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});a();const s=O({}),{open:c,close:l}=bt(s,{type:"drawer"});function n(r){s.value={flowKey:r.flowKey,taskId:r.taskId,instanceId:r.flowInstanceId,debug:t.value,onComplete:()=>{l(),a()}},c()}return(r,d)=>{const f=D("el-switch"),_=D("el-button"),i=D("el-link"),p=D("avue-crud");return T(),$(p,ae(ne(b(u))),{"menu-right":v(()=>[w(_,{type:"text"},{default:v(()=>[w(f,{modelValue:b(t),"onUpdate:modelValue":d[0]||(d[0]=m=>ee(t)?t.value=m:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:v(({row:m})=>[w(i,{type:"primary",underline:!1,onClick:g=>n(m)},{default:v(()=>[P(z(m.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),Cl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ke},{label:"备注",prop:"remark"}]},xl=M({__name:"index",setup(e){const{bindVal:t,getDataList:o}=te({tableOption:Cl,crudOption:Ie()});return o(),(u,a)=>{const s=D("avue-crud");return T(),$(s,ae(ne(b(t))),null,16)}}}),Tl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Il={class:"flow-list"},Ol=["onClick"],Nl={class:"flow-name"},Ll=M({__name:"index",setup(e){const t=O([]),{getPublishFlow:o,getTodoList:u}=xe();o().then(_=>{t.value=_.data});const a=O({}),{open:s,close:c}=bt(a,{type:"drawer"});function l(_){a.value={flowKey:_.flowKey,taskId:_.taskId,instanceId:_.flowInstanceId,onComplete:()=>{c(),r()}},s()}const{bindVal:n,getDataList:r,crudStateRefs:{searchForm:d}}=te({tableOption:Tl,crudOption:{getList:u},searchForm:{status:2}}),f=[{label:"待办",value:2},{label:"已办",value:1}];return(_,i)=>{const p=D("el-button"),m=D("el-collapse-item"),g=D("el-collapse"),k=D("el-card"),y=D("el-divider"),h=D("avue-radio"),V=D("el-link"),N=D("avue-crud");return T(),K(Y,null,[w(k,{"body-style":{padding:"0 20px"}},{default:v(()=>[w(g,{"model-value":"1"},{default:v(()=>[w(m,{name:"1"},{title:v(()=>[w(p,{text:"",icon:"el-icon-promotion"},{default:v(()=>[P(" 发起审批 ")]),_:1})]),default:v(()=>[X("div",Il,[(T(!0),K(Y,null,fe(t.value,L=>(T(),K("div",{key:L.flowKey,class:"flow-item",onClick:S=>l(L)},[w(b(re),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),X("div",Nl,z(L.flowName),1)],8,Ol))),128))])]),_:1})]),_:1})]),_:1}),w(y,{direction:"horizontal","content-position":"left"}),w(N,ae(ne(b(n))),{"menu-left":v(()=>[w(h,{modelValue:b(d).status,"onUpdate:modelValue":[i[0]||(i[0]=L=>b(d).status=L),b(r)],button:"",dic:f},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:v(({row:L})=>[w(V,{type:"primary",underline:!1,onClick:S=>l(L)},{default:v(()=>[P(z(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const $l=We(Ll,[["__scopeId","data-v-de4a15fa"]]),Sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Ul=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:u,handleUpdate:a}=te({tableOption:Sl,crudOption:Dt()});u();const s=O(!1);async function c(n){o.value=n,s.value=!0}async function l(){await a(o.value,NaN,()=>s.value=!1,()=>{})}return(n,r)=>{const d=D("el-button"),f=D("avue-crud"),_=D("el-dialog");return T(),K(Y,null,[w(f,ae(ne(b(t))),{flowData:v(({row:i})=>[w(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:p=>c(i)},{default:v(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(_,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=i=>s.value=i),title:`模型设计-${b(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:v(()=>[w(d,{type:"primary",onClick:l},{default:v(()=>[P(" 保存 ")]),_:1}),w(d,{onClick:r[1]||(r[1]=i=>s.value=!1)},{default:v(()=>[P(" 取消 ")]),_:1})]),default:v(()=>[w(Te,{modelValue:b(o).flowData,"onUpdate:modelValue":r[0]||(r[0]=i=>b(o).flowData=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Rl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Pl=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:u,handleUpdate:a}=te({tableOption:Rl,crudOption:Ct()});u();const s=O(!1);async function c(n){o.value={...n},s.value=!0}async function l(){await a(o.value,NaN,()=>s.value=!1,()=>{})}return(n,r)=>{const d=D("el-button"),f=D("avue-crud"),_=D("el-dialog");return T(),K(Y,null,[w(f,ae(ne(b(t))),{formOption:v(({row:i})=>[w(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:p=>c(i)},{default:v(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(_,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=i=>s.value=i),title:`表单设计-${b(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:v(()=>[w(d,{type:"primary",onClick:l},{default:v(()=>[P(" 保存 ")]),_:1}),w(d,{onClick:r[1]||(r[1]=i=>s.value=!1)},{default:v(()=>[P(" 取消 ")]),_:1})]),default:v(()=>[w(ot,{modelValue:b(o).formOption,"onUpdate:modelValue":r[0]||(r[0]=i=>b(o).formOption=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),El={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:de(xt)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ke,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ke,value:1}]}}]},Fl=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:u,beforeOpen:a,beforeSubmit:s}=te({crudOption:Me(),tableOption:El});u();const{data:c}=Ie().useParam("table.default.fields");a(d=>{d==="add"?o.value.tableFields=c.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),s(d=>{d.tableFields=JSON.stringify(d.tableFields)});const{deploy:l}=Me(),n=O(!1);async function r(d){await De.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),n.value=!0,l({id:d.id}).then(()=>{oe.success("部署成功"),u()}).finally(()=>{n.value=!1})}return(d,f)=>{const _=D("el-button"),i=D("avue-crud");return T(),$(i,ae(ne(b(t))),{menu:v(({row:p})=>[w(_,{type:"text",icon:"el-icon-upload",onClick:m=>r(p)},{default:v(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ba={install(e,t){e.component("FlowButton",ul).component("FlowDefinition",Tt).component("FlowDeploy",It).component("FlowForm",yt).component("FlowManage",kl).component("FlowOps",Dl).component("FlowParam",xl).component("FlowTemplate",Ul).component("FormTemplate",Pl).component("TableTemplate",Fl).component("FlowWorkbench",$l),q(e,t)}};export{ol as CONFIG_DEFAULT,rt as CONFIG_PROVIDE_KEY,ul as FlowButton,Tt as FlowDefinition,It as FlowDeploy,yt as FlowForm,kl as FlowManage,Dl as FlowOps,xl as FlowParam,Ul as FlowTemplate,$l as FlowWorkbench,Pl as FormTemplate,Fl as TableTemplate,gt as Whether,Ba as default,tl as resolveFlowFormComponent,q as useConfigProvider,bt as useFlowForm,el as useFlowFormOverlay,Zo as useFlowFormWindow,Ke as whetherDic};
