import{bQ as le,dB as ot,dC as de,dD as Nt,dE as oe,bc as be,dF as Ot,d4 as It,d6 as $t,cw as Lt,a5 as St,by as Ut,bR as Ve}from"../composables_use-crud_index.md.79b7ceb4.js";import{L as Pt,M as ie,s as Et,N as Rt,O as Ft}from"../app.cca9fc56.js";import{U as Me,A as De,r as L,s as $e,d as R,e as ue,w as _e,a6 as te,u as y,n as pe,V as At,h as j,b as st,ar as Ee,G as k,i as O,C as U,D as f,I as w,m as E,p as W,a0 as lt,aK as Ke,a2 as Be,B as Z,E as Q,j as B,N as fe,F as X,J as Mt,_ as je,av as ne,aw as re,k as Kt,b2 as Bt,au as jt,aN as zt,l as qt}from"./framework.22a77fa2.js";import{M as it,f as Wt,t as Re,L as Qt,u as Ht}from"./vuedraggable.umd.1cf218b8.js";import"./mysqlWorkbench.d6d99b78.js";import{d as Gt}from"./data.4cb21f02.js";import{a as Jt}from"../flow-design_flow-modeler_index.md.3e543641.js";import{u as Ce,a as Yt,c as Xt}from"./theme.cbace0df.js";import"../components_icon-select_index.md.dc997862.js";import"../components_index.md.89dfd121.js";import"../components_v-text_index.md.306fe565.js";import"../composables_index.md.1bb90be4.js";import"../flow-design_flow-viewer_index.md.e9fcc2c5.js";import"../flow-design_index.md.e062cae5.js";import"../flow-pages_index.md.4321e7dd.js";import"../flow-pages_pages_flow-button_index.md.2cf37f1f.js";import"../flow-pages_pages_flow-manage_index.md.3b729385.js";import"../flow-pages_pages_flow-ops_index.md.1351e2c2.js";import"../flow-pages_pages_flow-param_index.md.907e6ed8.js";import"../flow-pages_pages_flow-template_index.md.743ad38c.js";import"../flow-pages_pages_flow-workbench_index.md.e559c6b1.js";import"../flow-pages_pages_form-template_index.md.754d7c10.js";import"../flow-pages_pages_table-template_index.md.f196419b.js";import"../form-design_demo.md.f7fa8b02.js";import"../form-design_index.md.f8d915c9.js";import"../guide_changelog.md.71ace3ef.js";import"../guide_start.md.f25ec09d.js";import"../index.md.dedad964.js";import"../plugins_avue-patch_index.md.f5f1f772.js";import"../plugins_env-dts_index.md.97d0973e.js";import"../plugins_index.md.09238556.js";import"../plugins_load-proxy_index.md.aa8b859d.js";import"../plugins_setup-extend_index.md.fa9625ef.js";import"../plugins_uni-ui-patch_index.md.52dae811.js";import"../plugins_uview-patch_index.md.a7c413c3.js";import"../types_avue_index.md.6a2b38aa.js";import"../types_index.md.aa1779e7.js";import"../utils_date_dateFormat.md.24466ffd.js";import"../utils_date_durationFormat.md.a91e1175.js";import"../utils_emitter_mittAsync.md.65520a0e.js";import"../utils_index.md.99824380.js";import"../utils_math_index.md.81fb7150.js";import"../utils_object_filterObj.md.d634698f.js";import"../utils_object_filterObjDeep.md.aee85325.js";import"../utils_object_getDataType.md.4c16fa33.js";import"../utils_string_deserialize.md.49b88e4f.js";import"../utils_string_serialize.md.175ca994.js";import"../utils_string_uuid.md.1b6743be.js";import"../utils_tool_awaitTo.md.907e2bd0.js";import"../utils_tool_enumToDic.md.f0182e11.js";import"../utils_tool_sleep.md.15440607.js";import"../utils_tree_buildTree.md.b95211e7.js";import"../utils_tree_filterTree.md.753c4098.js";import"../utils_tree_findTree.md.30184861.js";import"../utils_tree_flatTree.md.cb52189f.js";import"../utils_tree_treeMap.md.168ca5df.js";import"./vue.runtime.esm-bundler.9ab4c990.js";const Zt={},eo=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),to=()=>Zt,oo=e=>Array.isArray(e),ze=e=>e!==null&&typeof e=="object",ut=e=>e instanceof Function,ye=e=>e==null,qe=typeof window>"u",ct=()=>{var e;return qe||ye((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},lo=()=>{var e,t;return(e=!qe&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Le=()=>new Promise(()=>{}),ae=e=>te(e)?e.value:e,ao=e=>ze(e)?Object.assign(oo(e)?[]:{},e):e,ge=new Map,no=e=>ye(e)?void 0:ge.get(e),ro=(e,t,o)=>{const i=ge.get(e);i!=null&&i.timer&&clearTimeout(i.timer);const r=setTimeout(()=>ge.delete(e),t);ge.set(e,{...o,timer:r})},ce=e=>e;function dt(e,t,o){let i,r,a,u,l,n,s=0,d=!1,v=!1,_=!0;const c=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,ze(o)&&(d=!!o.leading,v="maxWait"in o,a=v?Math.max(+o.maxWait||0,t):a,_="trailing"in o?!!o.trailing:_);function m(T){const I=i,N=r;return i=r=void 0,s=T,u=e.apply(N,I),u}function g(T,I){return c?(window.cancelAnimationFrame(l),window.requestAnimationFrame(T)):setTimeout(T,I)}function b(T){if(c)return window.cancelAnimationFrame(T);clearTimeout(T)}function x(T){return s=T,l=g(p,t),d?m(T):u}function h(T){const I=T-n,N=T-s,F=t-I;return v?Math.min(F,a-N):F}function $(T){const I=T-n,N=T-s;return n===void 0||I>=t||I<0||v&&N>=a}function p(){const T=Date.now();if($(T))return D(T);l=g(p,h(T))}function D(T){return l=void 0,_&&i?m(T):(i=r=void 0,u)}function V(){l!==void 0&&b(l),s=0,i=n=r=l=void 0}function C(){return l===void 0?u:D(Date.now())}function S(){return l!==void 0}function P(...T){const I=Date.now(),N=$(I);if(i=T,r=this,n=I,N){if(l===void 0)return x(n);if(v)return l=g(p,t),m(n)}return l===void 0&&(l=g(p,t)),u}return P.cancel=V,P.flush=C,P.pending=S,P}function so(e,t,o){let i=!0,r=!0;if(typeof e!="function")throw new TypeError("Expected a function");return ze(o)&&(i="leading"in o?!!o.leading:i,r="trailing"in o?!!o.trailing:r),dt(e,t,{leading:i,trailing:r,maxWait:t})}var io=ce((e,{debounceInterval:t,debounceOptions:o,manual:i})=>{const r=L(!1),a=L(),u=R(()=>o),l=R(()=>ae(t)),n=L(e.context.runAsync);return i||(r.value=!0),ue(s=>{ye(l.value)||(a.value=dt(d=>d(),l.value,u.value),e.context.runAsync=(...d)=>new Promise((v,_)=>{r.value?(r.value=!1,n.value(...d).then(v).catch(_)):a.value(()=>{n.value(...d).then(v).catch(_)})}),s(()=>{var d;(d=a.value)===null||d===void 0||d.cancel(),e.context.runAsync=n.value}))}),{onCancel(){var s;(s=a.value)===null||s===void 0||s.cancel()}}}),uo=ce((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const i=L(),r=L(0),a=R(()=>ae(t)),u=R(()=>ae(o));let l=!1;const n=()=>{r.value=0},s=R(()=>{if(u.value)return u.value;const _=1e3,c=1,m=9,g=Math.floor(Math.random()*2**Math.min(r.value,m)+c);return _*g}),d=()=>{let _;const c=a.value===-1,m=r.value<a.value;return(c||m)&&(c||(r.value+=1),_=setTimeout(()=>{l=!0,e.context.refresh()},s.value)),()=>_&&clearTimeout(_)},v=()=>{i.value&&i.value()};return{onBefore(){l||n(),l=!1,v()},onSuccess(){n()},onError(){i.value=d()},onCancel(){n(),v()}}}),co=ce((e,{ready:t=L(!0),manual:o,defaultParams:i=[]})=>(_e(t,r=>{!o&&r&&e.context.run(...i)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),po=ce((e,{refreshDeps:t=[],refreshDepsAction:o,manual:i})=>(t!=null&&t.length&&_e(t,()=>{o?o():!i&&e.context.refresh()}),{})),fo=ce((e,{throttleInterval:t,throttleOptions:o})=>{const i=L(),r=R(()=>ae(t)),a=R(()=>o),u=L(e.context.runAsync);return ue(l=>{if(ye(t))return{};i.value=so(n=>n(),r.value,a.value),e.context.runAsync=(...n)=>new Promise((s,d)=>{i.value(()=>{u.value(...n).then(s).catch(d)})}),l(()=>{var n;(n=i.value)===null||n===void 0||n.cancel(),e.context.runAsync=u.value})}),{onCancel(){var l;(l=i.value)===null||l===void 0||l.cancel()}}});const mo=(e,t)=>o=>{Object.keys(o).forEach(i=>{e[i].value=o[i]}),t.forEach(i=>i(e))},vo=(e,t)=>()=>{let o=t;for(let i=e.length;i-- >0;)o=e[i](o);return o()},_o=(e,t,o)=>{var i,r;const{initialData:a,onSuccess:u,onError:l,onBefore:n,onAfter:s}=t,d=L((i=o==null?void 0:o.loading)!==null&&i!==void 0?i:!1),v=$e((r=o==null?void 0:o.data)!==null&&r!==void 0?r:a),_=$e(o==null?void 0:o.error),c=L(o==null?void 0:o.params),m=L([]),g=$e("pending"),b={},x=mo({status:g,loading:d,data:v,error:_,params:c},[]),h=(p,...D)=>{if(p==="onQuery"){const V=m.value.map(C=>C.onQuery).filter(Boolean);return{servicePromise:vo(V,D[0])()}}else{const V=m.value.map(C=>{var S;return(S=C[p])===null||S===void 0?void 0:S.call(C,...D)});return Object.assign({},...V)}},$=L(0);return b.runAsync=async(...p)=>{x({loading:!0,params:p,status:"pending"}),$.value+=1;const D=$.value,{isBreak:V,breakResult:C=Le()}=h("onBefore",p);if(V)return x({status:"settled"}),C;n==null||n(p);try{const S=()=>new Promise(I=>I(e(...c.value)));let{servicePromise:P}=h("onQuery",S);P||(P=S());const T=await P;return D!==$.value?Le():(x({data:T,loading:!1,error:void 0,status:"settled"}),h("onSuccess",T,p),u==null||u(T,p),h("onAfter",p,T,void 0),s==null||s(p),T)}catch(S){if(D!==$.value)return Le();throw x({loading:!1,error:S,status:"settled"}),h("onError",S,p),l==null||l(S,p),h("onAfter",p,void 0,S),s==null||s(p),S}},b.run=(...p)=>{b.runAsync(...p).catch(D=>{l||console.error(D)})},b.cancel=()=>{$.value+=1,x({loading:!1}),h("onCancel")},b.refresh=()=>{b.run(...c.value||[])},b.refreshAsync=()=>b.runAsync(...c.value||[]),b.mutate=p=>{const D=ut(p)?p(v.value):p,V=ao(D);x({data:V}),h("onMutate",V)},{status:g,loading:d,data:v,error:_,params:c,plugins:m,context:b}};function wo(e,t={},o){const i=Me(eo,{}),r={...to(),...i,...t},{manual:a=!1,defaultParams:u=[]}=r,l=_o(e,r);if(l.plugins.value=o.map(n=>n(l,r)),!a){const n=l.params.value||u;l.context.run(...n)}return De(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const he=new Map,yo=(e,t)=>{he.set(e,t),t.then(o=>(he.delete(e),o)).catch(()=>{he.delete(e)})},bo=e=>he.get(e),ve=new Map,go=(e,t)=>{ve.has(e)&&ve.get(e).forEach(o=>o(t))},ho=(e,t)=>(ve.has(e)?ve.get(e).push(t):ve.set(e,[t]),()=>{const o=ve.get(e).indexOf(t);ve.get(e).splice(o,1)});var ko=ce((e,{cacheKey:t,cacheTime:o=6e5,staleTime:i=0,getCache:r,setCache:a})=>{if(!t)return{};const u=ut(t)?t:()=>t,l=L(()=>{});let n;const s=b=>r?r(b):no(b),d=(b,x,h)=>{a?a(b,h):ro(b,x,h),go(b,h.data)},v=b=>i===-1||b+i>new Date().getTime(),_=(b,x)=>Object.prototype.hasOwnProperty.call(b,x),c=b=>{const x=u(b);return ho(x,h=>{e.data.value=h})},m=u(),g=s(m);return g&&_(g,"data")&&(e.data.value=g.data,e.params.value=g.params),m&&(l.value=c()),De(()=>{l.value()}),{onBefore(b){const x=u(b),h=s(x);if(!h||!_(h,"data"))return{};if(v(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(b){const x=e.params.value,h=u(x);let $=bo(h);return $&&$!==n?()=>$:($=b(),n=$,yo(h,$),()=>$)},onSuccess(b,x){const h=u(x);h&&(l.value(),d(h,o,{data:b,params:x,time:new Date().getTime()}),l.value=c(x))},onMutate(b){const x=u(e.params.value);x&&(l.value(),d(x,o,{data:b,params:e.params.value,time:new Date().getTime()}),l.value=c(e.params.value))}}});function Vo(e){let t,o;class i extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new i(r=>{o=r,t=setTimeout(o,e)})}function Se(){return new Date().getTime()}var Do=ce((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const i=L(()=>{}),r=R(()=>ae(t)),a=R(()=>ae(o));let u=0,l={};const n=()=>{let s;return r.value&&(s=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},r.value)),()=>s&&clearTimeout(s)};return{onBefore(){e.loading.value=!r.value,i.value(),i.value=n(),u=Se()},onQuery(s){if(!a.value)return()=>s();l=Vo(a.value+r.value);const d=async()=>{try{const _=await s();return Se()-u<=r.value&&l.cancel(),Promise.resolve(_)}catch(_){return Se()-u<=r.value&&l.cancel(),Promise.reject(_)}},v=Promise.allSettled([d(),l]).then(_=>{const c=_[0];return c.status==="fulfilled"?c.value:Promise.reject(c.reason)});return()=>v},onCancel(){i.value()},onAfter(){i.value()}}}),Ue;const pt=new Set,ft=new Set,mt=new Set,ke=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=pt;break;case"RECONNECT_LISTENER":o=mt;break;case"VISIBLE_LISTENER":o=ft;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!qe&&(Ue=window)!==null&&Ue!==void 0&&Ue.addEventListener&&(window.addEventListener("visibilitychange",()=>{ct()&&Pe(ft)},!1),window.addEventListener("focus",()=>Pe(pt),!1),window.addEventListener("online",()=>Pe(mt),!1));var Co=ce((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:i=!1,errorRetryCount:r=0})=>{const a=L(),u=L(!1),l=R(()=>ae(t)),n=R(()=>ae(r)),s=[],d=m=>{m&&s.push(m)},v=()=>(o||ct())&&(i||lo()),_=m=>{if(e.error.value&&n.value!==0)return;let g;if(!ye(l.value)&&l.value>=0)if(v())g=setTimeout(m,l.value);else{u.value=!0;return}return()=>g&&clearTimeout(g)},c=()=>{u.value&&v()&&(e.context.refresh(),u.value=!1)};return _e(l,()=>{a.value&&(a.value(),a.value=_(()=>e.context.refresh()))}),o||d(ke("VISIBLE_LISTENER",c)),i||d(ke("RECONNECT_LISTENER",c)),De(()=>{s.forEach(m=>m())}),{onBefore(){var m;(m=a.value)===null||m===void 0||m.call(a)},onCancel(){var m;(m=a.value)===null||m===void 0||m.call(a)},onAfter(){a.value=_(()=>e.context.refresh())}}});const xo=(e,t)=>{let o=!1;return(...i)=>{o||(o=!0,e(...i),setTimeout(()=>{o=!1},t))}};var To=ce((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const i=R(()=>ae(t)),r=R(()=>ae(o)),a=[],u=n=>{n&&a.push(n)},l=()=>{a.forEach(n=>n())};return ue(()=>{if(l(),i.value){const n=xo(e.context.refresh,r.value);u(ke("VISIBLE_LISTENER",n)),u(ke("FOCUS_LISTENER",n))}}),De(()=>{l()}),{}});function we(e,t){return wo(e,t,[Do,uo,io,Co,fo,To,po,co,ko])}function xe(){const{request:e}=H(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:c=>e.get(t.detail,{params:c}),getApprovalNode:c=>e.post(t.approvalNode,c),startTask:c=>e.post(t.start,c),commitTask:c=>e.post(t.commit,c),saveDraft:c=>e.post(t.draft,c),revokeTask:c=>e.post(t.revoke,c),terminateTask:c=>e.post(t.terminate,c),withdrawTask:c=>e.post(t.withdraw,c),transferTask:c=>e.post(t.transfer,c),getPublishFlow:()=>e.get(t.publish),getTodoList:c=>e.get(t.todo,{params:c})}}function No(e){const{commitTask:t,revokeTask:o,saveDraft:i,startTask:r,terminateTask:a,transferTask:u,withdrawTask:l}=xe(),n=R(()=>{const{flowDetail:d,formVariables:v,approvalFormData:_,debug:c}=e,{flowDeployId:m}=d.value.process??{},{taskId:g,flowInstanceId:b}=d.value.task??{};return{flowDeployId:m,taskId:g,flowInstanceId:b,variables:v.value,debug:c.value,..._.value}}),s=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(s())return i(n.value)},flow_pass(){return s()?t(n.value):r(n.value)},flow_revoke(){if(s())return o(n.value)},flow_withdraw(){if(s())return l(n.value)},flow_terminate(){if(s())return a(n.value)},flow_transfer(){if(s())return u(n.value)}}}function Oo(e){const t=L({});return ue(async()=>{var i;const{formProperty:o}=((i=y(e))==null?void 0:i.properties)||{};o!=null&&o.length&&(await pe(),Object.keys(t.value).forEach(r=>{var l,n,s,d;const a=((l=t.value[r])==null?void 0:l.label)||"",u=o==null?void 0:o.find(v=>v.prop===r);if(t.value[r].display=u==null?void 0:u.display,t.value[r].disabled=u==null?void 0:u.disabled,t.value[r].detail=u==null?void 0:u.detail,t.value[r].readonly=u==null?void 0:u.readonly,t.value[r].rules=t.value[r].rules??[],u!=null&&u.required&&((n=t.value[r].rules)!=null&&n.some(v=>v.required)))return null;u!=null&&u.required?(s=t.value[r].rules)==null||s.push({required:!0,message:`${a}为必填项`}):t.value[r].rules=(d=t.value[r].rules)==null?void 0:d.filter(v=>!v.required)}))}),t}function Io(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function $o(){return{complete:e=>e}}const vt=Symbol("flowFormState");function Lo(e,t){const o=Ce(e,void 0,{passive:!0,deep:!0}),{flowDetail:i,modelValue:r,formLoading:a}=o,{getFlowDetail:u}=xe();ue(()=>{const{flowKey:c,taskId:m,instanceId:g}=e;!c&&!m&&!g||(a.value=!0,u({flowKey:c,taskId:m,flowInstanceId:g}).then(b=>{i.value=b.data,r.value=b.data.formData||{}}).finally(()=>{a.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),n=R(()=>{var c,m,g,b;return l.value.fileTab===!0&&((b=(g=(m=(c=i.value)==null?void 0:c.properties)==null?void 0:m.formProperty)==null?void 0:g.find(x=>x.prop==="fileTab"))==null?void 0:b.display)}),s=R(()=>{var c,m,g,b;return l.value.trackTab===!0&&((b=(g=(m=(c=i.value)==null?void 0:c.properties)==null?void 0:m.formProperty)==null?void 0:g.find(x=>x.prop==="trackTab"))==null?void 0:b.display)}),d=L(!1),v=R(()=>Object.entries(r.value||{}).filter(([c])=>!c.startsWith("$")).map(([c,m])=>({key:c,value:m}))),_={...o,formData:r,formVariables:v,approvalVisible:d,showFileTab:n,showTrackTab:s,permission:l,emit:t};return At(vt,_),_}function _t(){return Me(vt)}function We(e){return new Promise((t,o)=>{y(e).validate((r,a,u)=>{r?(a(),t(u)):o(u)})})}const So=j({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=Ce(e,void 0,{passive:!0,deep:!0}),o=Oo(e.flowDetail),{proxy:i}=st(),r=L({});ue(()=>{const{formOption:l}=e.flowDetail.process??{};r.value=it.bind(i)(l||'{"menuBtn":false}'),r.value.detail=!!e.detail});const a=L();function u(){return We(a)}return{form:t,option:r,defaults:o,formRef:a,validate:u}},render(){return Ee(k("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Uo=j({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Yt(e,"modelValue"),{batchUpdate:i,create:r,remove:a,useList:u}=Zo(),l=L(!1),{activeBtn:n}=_t(),s=R(()=>{var $;return($=n.value)==null?void 0:$.buttonKey}),{data:d,refresh:v}=u(s),_=R(()=>{var p,D,V;const $=o.value;if($&&!((p=d.value)!=null&&p.some(C=>C.content===$))){const C=(((V=(D=d.value)==null?void 0:D[0])==null?void 0:V.sort)||1)-1;return[{content:$,sort:C},...d.value||[]]}return d.value});async function c($){var p;await r({...$,type:(p=n.value)==null?void 0:p.buttonKey}),le.success("添加成功"),v()}async function m($){await a($.id),le.success("删除成功"),v()}async function g($,p){let D=p.parent.data;D=D.map((V,C)=>({id:V.id,sort:C+1})),await i(D),le.success("修改排序成功"),v(),l.value=!1}function b(){l.value=!0}const x=L();async function h($){var p;o.value=$.content,await pe(),(p=x.value)==null||p.blur()}return($,p)=>{const D=k("el-input"),V=k("el-text"),C=k("el-col"),S=k("el-button"),P=k("el-row"),T=k("el-tree"),I=k("el-popover");return O(),U(I,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:f(()=>[w(D,{ref_key:"inputRef",ref:x,modelValue:y(o),"onUpdate:modelValue":p[0]||(p[0]=N=>te(o)?o.value=N:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:p[1]||(p[1]=N=>l.value=!0),onBlur:p[2]||(p[2]=N=>l.value=!1)},null,8,["modelValue"])]),default:f(()=>[w(T,{data:_.value,"node-key":"content",draggable:"","allow-drop":(N,F,M)=>M!=="inner",props:{label:"content"},onNodeClick:h,onNodeDrop:g,onNodeDragStart:b},{default:f(({data:N})=>[w(P,{style:{width:"250px"}},{default:f(()=>[w(C,{span:20},{default:f(()=>[w(V,{truncated:"",title:N.content},{default:f(()=>[E(W(N.content),1)]),_:2},1032,["title"])]),_:2},1024),w(C,{span:4},{default:f(()=>[N.id?(O(),U(S,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:lt(F=>m(N),["stop"])},null,8,["onClick"])):(O(),U(S,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:lt(F=>c(N),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Po=j({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=xe(),i={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:r,approvalFormData:a,activeBtn:u,approvalVisible:l,formVariables:n,flowDetail:s}=_t(),d=L([]),v=L([]),_=L([]),c=L([]),m=L(),g=L({}),b={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:x}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function x(I,N,F){var z;const M=d.value[0].type==="ParallelGateway",K=(z=d.value[0].children)==null?void 0:z.every(ee=>Wt([ee],G=>v.value.some(J=>J.id===G.id)));if(v.value.length){if(M&&!K)return F("请在每个节点选择审批人")}else return F("请选择审批人");return!0}const h=L(),$=R(()=>{var I,N;return(N=(I=u.value)==null?void 0:I.approval)==null?void 0:N.includes("assignee")}),p=R(()=>{var I,N;return(N=(I=u.value)==null?void 0:I.approval)==null?void 0:N.includes("circulate")}),D=R(()=>{var I,N;return(N=(I=u.value)==null?void 0:I.approval)==null?void 0:N.includes("copyUser")}),V=L(!1),C=L(!1);ue(async()=>{var M,K,z,ee,G;if(!l.value||!m.value)return;const{flowKey:I}=((M=s.value)==null?void 0:M.process)||{},{taskId:N}=((K=s.value)==null?void 0:K.task)||{};d.value=[],v.value=[],_.value=[],c.value=[];const F=N?"":"发起";if(a.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:r.value.comment||F},pe(()=>{var J,Y;g.value.assignee.display=$.value,g.value.circulate.display=p.value,g.value.copyUser.display=D.value,g.value.comment.display=(Y=(J=u.value)==null?void 0:J.approval)==null?void 0:Y.includes("comment")}),$.value)try{C.value=!0;const J=u.value.buttonKey!=="flow_transfer",Y=await o({flowKey:I,variables:n.value,taskId:N,loadConfig:J});d.value=Re(Y.data??[],(se,et,q)=>{const me=se.id||ot();return se.taskNodeKey=(q==null?void 0:q.taskNodeKey)??se.taskNodeKey,se.incoming=(q==null?void 0:q.incoming)??se.incoming,{...se,id:me,disabled:se.type!=="user"}}),await pe();const A=S(d.value);A&&((z=h.value)==null||z.setCheckedNodes([A]))}finally{C.value=!1}if(D.value){const J=await o({flowKey:I,variables:n.value,taskId:N,loadConfig:!1});_.value=Re(((G=(ee=J.data)==null?void 0:ee[0])==null?void 0:G.children)??[],Y=>{var A;return Y.id||ot(),{...Y,label:Y.title,disabled:Y.type!=="user"&&!((A=Y.children)!=null&&A.length)}})}});function S(I){var N;if(I.length===1)return(N=I[0].children)!=null&&N.length?S(I[0].children):I[0]}async function P(I,N){var M,K;if(I.type!=="user")return;await pe(),await pe();const F=(M=h.value)==null?void 0:M.getCheckedNodes();v.value=F.filter(z=>z.type==="user"),(K=h.value)==null||K.setCheckedNodes(v.value)}async function T(){await We(m),V.value=!0;const I={},N={},F=new Set;v.value.forEach(M=>{const{taskNodeKey:K,incoming:z}=M;I[K]||(I[K]=new Set),M.userId&&I[K].add(M.userId),N[K]=[...I[K]].join(","),F.add(z)}),a.value.assignee=N,a.value.outgoing=[...F],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",r),t("confirm")}return(I,N)=>{const F=k("el-col"),M=k("el-tag"),K=k("el-tree-select"),z=k("avue-form"),ee=k("el-row"),G=k("el-button"),J=k("el-dialog"),Y=Ke("loading");return O(),U(J,{modelValue:y(l),"onUpdate:modelValue":N[6]||(N[6]=A=>te(l)?l.value=A:null),title:y(u).name,width:$.value?"800px":"500px","append-to-body":""},{footer:f(()=>[w(G,{onClick:N[5]||(N[5]=A=>l.value=!1)},{default:f(()=>[E(" 取 消 ")]),_:1}),w(G,{type:"primary",onClick:T},{default:f(()=>[E(" 确 定 ")]),_:1})]),default:f(()=>[w(ee,{gutter:20},{default:f(()=>[$.value?(O(),U(F,{key:0,span:10},{default:f(()=>[Be((O(),U(y(Pt),{ref_key:"treeRef",ref:h,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:d.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:P},{default:f(({data:A})=>[Z("div",null,[w(y(ie),{icon:i[A.type],style:{display:"inline-block"}},null,8,["icon"]),Z("span",null,W(A.title),1)])]),_:1},8,["data"])),[[Y,C.value]])]),_:1})):Q("",!0),w(F,{span:$.value?14:24},{default:f(()=>[w(z,{ref_key:"formRef",ref:m,modelValue:y(a),"onUpdate:modelValue":N[3]||(N[3]=A=>te(a)?a.value=A:null),defaults:g.value,"onUpdate:defaults":N[4]||(N[4]=A=>g.value=A),option:b},{assignee:f(()=>[(O(!0),B(X,null,fe(v.value,A=>(O(),U(M,{key:A.id,type:"info"},{default:f(()=>[E(W(A.title),1)]),_:2},1024))),128))]),copyUser:f(()=>[w(K,{modelValue:c.value,"onUpdate:modelValue":[N[0]||(N[0]=A=>c.value=A),N[1]||(N[1]=A=>y(a).copyUser=A.join(","))],data:_.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:f(()=>[w(Uo,{modelValue:y(a).comment,"onUpdate:modelValue":N[2]||(N[2]=A=>y(a).comment=A)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Eo=Jt,at=j({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:i}=ol(),r=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(s){t("update:modelValue",s.join(","))}}),a=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(s){t("update:modelValue",s)}}),u=L([]),l=L(!1),n=R(()=>{var s,d;return(d=(s=o.tableData)==null?void 0:s.row)==null?void 0:d.type});return _e(n,s=>{["dept","post","user"].includes(s)&&(l.value=!0,i(s==="user"?"":s).then(d=>{u.value=Re(d.data,v=>({label:v.title,value:v.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(s,d)=>{const v=k("el-tree-select"),_=k("el-input");return["dept","post","user"].includes(n.value)?(O(),U(v,{key:0,modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=c=>r.value=c),data:u.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(O(),U(_,{key:1,modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=c=>a.value=c)},null,8,["modelValue"]))}}}),Ro={key:0,class:"flow-viewer"},Fo={class:"flow-status-legend"},Ao=j({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{FlowViewer:i,FlowModeler:r}=H(),a=L({}),u=L({}),l=R({get(){let p=Gt();return typeof o.modelValue=="string"&&o.modelValue?p=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(p=o.modelValue),p},set(p){t("update:modelValue",JSON.stringify(p))}}),n=R(()=>{const{column:p=[],group:D=[]}=JSON.parse(o.flowFormOption||"{}");return[...p,...D.map(C=>C.column??[]).flat()]}),s=R(()=>n.value.map(D=>({label:D.label,value:`\${${D.prop}}`,desc:`\${${D.prop}}`}))),d=de(Qe),v=de(He),{data:_}=Ge().useList();_e(u,p=>{var D,V,C,S,P,T,I,N,F,M,K;p&&(p.priority&&(p.priority.dicData=s.value),p.formTitle&&(p.formTitle.dicData=s.value),(C=(V=(D=p.assignee)==null?void 0:D.children)==null?void 0:V.column)!=null&&C[1]&&(p.assignee.children.column[1].component=at),(F=(N=(I=(T=(P=(S=p.circulate)==null?void 0:S.children)==null?void 0:P.column)==null?void 0:T[1])==null?void 0:I.children)==null?void 0:N.column)!=null&&F[1]&&(p.circulate.children.column[1].children.column[1].component=at),p.formProperty&&(a.value.formProperty=c(n.value,a.value.formProperty||[])),p.button&&((K=(M=p.button.children)==null?void 0:M.column)==null||K.forEach(z=>{z.prop==="display"&&(z.dicData=d),z.prop==="approval"&&(z.dicData=v)}),a.value.button=m(_.value||[],a.value.button||[])))});function c(p,D){return p.map(V=>{var ee,G;const C=D.find(J=>J.prop===V.prop),{label:S,prop:P,display:T=!0,disabled:I=!1,detail:N=!1,readonly:F=!1,rules:M}=V,K=(M==null?void 0:M.some(J=>J.required))??!1,z={label:S,prop:P,display:T,disabled:I,detail:N,readonly:F,required:K,...C};return V.type==="dynamic"&&((G=(ee=V.children)==null?void 0:ee.column)!=null&&G.length)&&(z.children=c(V.children.column,(C==null?void 0:C.children)??[])),z})}function m(p,D){return p.filter(V=>V.status===1).map(V=>{const C=D.find(F=>F.buttonKey===V.buttonKey),{name:S,buttonKey:P,display:T,approval:I}=V;return{name:S,buttonKey:P,display:T,approval:I,...C}})}const{data:g}=Ne().useParam("flow.task.status"),b=R(()=>{var p;return(p=o.flowHistory)==null?void 0:p.map(D=>{var C,S;const V=(S=(C=g.value)==null?void 0:C.find(P=>P.value===D.status))==null?void 0:S.style;return{id:D.taskNodeKey,style:V}})}),x=R(()=>{var p,D;return(D=(p=o.flowHistory)==null?void 0:p.filter(V=>V.taskNodeType==="userTask"))==null?void 0:D.map(V=>{var C;return{id:V.taskNodeKey,content:`<div>${V.assigneeName}</div>
        <div>${V.endTime??""}</div>
        <div>${((C=V.comment)==null?void 0:C.comment)??""}</div>`}})});function h(){var p,D;(D=(p=l.value)==null?void 0:p.flowElementList)==null||D.forEach(V=>{var C;(C=V.properties)!=null&&C.button&&(V.properties.button=m(_.value||[],[]))}),l.value={...l.value}}function $(){var p,D;(D=(p=l.value)==null?void 0:p.flowElementList)==null||D.forEach(V=>{var C;(C=V.properties)!=null&&C.formProperty&&(V.properties.formProperty=c(n.value,[]))}),l.value={...l.value}}return(p,D)=>{const V=k("el-button");return p.view?(O(),B("div",Ro,[Z("div",Fo,[(O(!0),B(X,null,fe(y(g),C=>{var S;return O(),B("div",{key:C.label,class:"legend-item"},[Z("div",{class:"legend-color",style:Mt({backgroundColor:(S=C.style)==null?void 0:S.fill})},null,4),Z("span",null,W(C.label),1)])}),128))]),w(y(i),{"model-value":l.value,styles:b.value,tooltips:x.value},null,8,["model-value","styles","tooltips"])])):(O(),U(y(r),{key:1,modelValue:l.value,"onUpdate:modelValue":D[0]||(D[0]=C=>l.value=C),formData:a.value,"onUpdate:formData":D[1]||(D[1]=C=>a.value=C),formDefaults:u.value,"onUpdate:formDefaults":D[2]||(D[2]=C=>u.value=C),"form-options":y(Eo),"form-width":"30%"},{"form-top":f(()=>[w(V,{type:"default",onClick:h},{default:f(()=>[E(" 重置所有按钮配置 ")]),_:1}),w(V,{type:"default",onClick:$},{default:f(()=>[E(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const Te=je(Ao,[["__scopeId","data-v-cce6bb35"]]),Mo={class:"flow-track"},Ko={key:0},Bo={key:1},jo=j({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=L("table"),i=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],r=R(()=>{var n,s,d;return((d=(s=(n=t.flowDetail)==null?void 0:n.flowHistory)==null?void 0:s.filter(v=>v.taskNodeType==="userTask"))==null?void 0:d.map(v=>({...v,duration:Nt(v.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:u}=Ne().useParam("flow.handle.type");function l(n){var s;return(s=u.value)==null?void 0:s.find(d=>d.value===n)}return(n,s)=>{var x,h,$;const d=k("el-radio-button"),v=k("el-radio-group"),_=k("avue-crud"),c=k("el-card"),m=k("el-timeline-item"),g=k("el-timeline"),b=k("el-empty");return O(),B(X,null,[w(v,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=p=>o.value=p)},{default:f(()=>[(O(),B(X,null,fe(i,p=>w(d,{key:p.label,label:p.label},{default:f(()=>[w(y(ie),{icon:p.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Z("div",Mo,[o.value==="table"?(O(),U(_,{key:0,data:r.value,option:a},null,8,["data"])):Q("",!0),o.value==="graph"?(O(),U(Te,{key:1,"model-value":(h=(x=n.flowDetail)==null?void 0:x.process)==null?void 0:h.flowData,"flow-history":($=n.flowDetail)==null?void 0:$.flowHistory,view:""},null,8,["model-value","flow-history"])):Q("",!0),o.value==="timeline"?(O(),B(X,{key:2},[r.value.length?(O(),U(g,{key:0},{default:f(()=>[(O(!0),B(X,null,fe([...r.value].reverse(),p=>(O(),U(m,{key:p.id,timestamp:p.endTime,placement:"top"},{default:f(()=>[w(c,null,{default:f(()=>{var D,V,C;return[Z("div",null,W(p.assigneeName)+" 开始处理 ["+W(p.taskNodeName)+"] 环节 ",1),p.duration?(O(),B("div",Ko," 办理时长："+W(p.duration),1)):Q("",!0),p.type&&((D=p.comment)!=null&&D.comment)?(O(),B("div",Bo,W((V=l(p.type))==null?void 0:V.label)+"意见："+W((C=p.comment)==null?void 0:C.comment),1)):Q("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(O(),U(b,{key:1}))],64)):Q("",!0)])],64)}}});const zo=je(jo,[["__scopeId","data-v-430a7108"]]),qo=j({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:i}=Ge().useList();function r(u,l){return u.map(n=>{const s=l.find(v=>v.buttonKey===n.buttonKey);return{...n,...Et(s,["display","approval"])}})}const a=R(()=>{var m,g,b,x,h;const u={userId:"1"},{assignee:l,status:n}=((m=o.flowDetail)==null?void 0:m.task)||{},{createUser:s,flowInstanceId:d,status:v}=((g=o.flowDetail)==null?void 0:g.flowInstance)||{},_={true:!0,false:!1,startUser:s==u.userId,assignee:l==u.userId,todo:n==2,done:n==1,notstarted:!d,started:!!d,finished:v===1,unfinished:v===2};return((h=r(i.value??[],((x=(b=o.flowDetail)==null?void 0:b.properties)==null?void 0:x.button)??[]))==null?void 0:h.filter($=>{var p,D;return(D=(p=$.display)==null?void 0:p.split(","))==null?void 0:D.every(V=>_[V])}))??[]});return(u,l)=>{const n=k("el-button");return O(!0),B(X,null,fe(a.value,s=>(O(),U(n,{key:s.buttonKey,type:s.buttonType,onClick:d=>t("click",s)},{default:f(()=>[w(y(ie),{icon:s.icon},null,8,["icon"]),E(" "+W(s.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Wo=j({__name:"upload-table",props:{flowDetail:{}},setup(e){var m,g;const t=e,{upload:{action:o,headers:i,preview:r,download:a,props:u}}=H(),l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:n,getDataList:s,handleDel:d,handleSave:v,crudStateRefs:{tableData:_}}=oe({crudOption:{...el(),saveSuccessMsg:"上传成功"},tableOption:l,queryForm:{isLatest:1,flowInstanceId:(g=(m=t.flowDetail)==null?void 0:m.task)==null?void 0:g.flowInstanceId}});s();async function c(b,x){var S,P,T,I;const{fileName:h,fileType:$,fileSize:p,fileUrl:D,res:V}=u,C={fileName:be({res:b},`${V}.${h}`),fileType:be({res:b},`${V}.${$}`),fileSize:be({res:b},`${V}.${p}`),fileUrl:be({res:b},`${V}.${D}`),taskId:(P=(S=t.flowDetail)==null?void 0:S.task)==null?void 0:P.taskId,flowInstanceId:(I=(T=t.flowDetail)==null?void 0:T.task)==null?void 0:I.flowInstanceId,rootMark:(x==null?void 0:x.rootMark)||"",version:typeof(x==null?void 0:x.version)=="number"?x.version+1:1};await v(C,s,()=>{})}return(b,x)=>{const h=k("el-button"),$=k("el-upload"),p=k("avue-crud");return O(),U(p,ne(re(y(n))),{"menu-left":f(()=>[w($,{action:y(o),headers:y(i),"show-file-list":!1,onSuccess:x[0]||(x[0]=D=>c(D))},{default:f(()=>[w(h,{type:"primary",icon:"el-icon-upload"},{default:f(()=>[E(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:f(({row:D,index:V})=>[w(h,{type:"primary",text:"",icon:"el-icon-view",onClick:C=>{var S;return(S=y(r))==null?void 0:S(D,y(_))}},{default:f(()=>[E(" 预览 ")]),_:2},1032,["onClick"]),w(h,{type:"primary",text:"",icon:"el-icon-download",onClick:C=>{var S;return(S=y(a))==null?void 0:S(D,y(_))}},{default:f(()=>[E(" 下载 ")]),_:2},1032,["onClick"]),w($,{action:y(o),headers:y(i),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:C=>c(C,D)},{default:f(()=>[w(h,{type:"primary",text:"",icon:"el-icon-upload"},{default:f(()=>[E(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),w(h,{type:"primary",text:"",icon:"el-icon-delete",onClick:C=>y(d)(D,V)},{default:f(()=>[E(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Qo={class:"flow-form__title"},wt=j({__name:"index",props:Io(),emits:$o(),setup(e,{emit:t}){const o=e,i=Lo(o,t),{flowDetail:r,modelValue:a,activeTab:u,activeBtn:l,formLoading:n,approvalVisible:s,submitLoading:d}=i,v=L();async function _(g){var b,x;l.value=g,await((b=v.value)==null?void 0:b.validate()),await((x=o.beforeClick)==null?void 0:x.call(o,g)),(g==null?void 0:g.approval)!=="false"?s.value=!0:m()}const c=No(i);async function m(){var g,b;try{const{buttonKey:x}=l.value;d.value=!0,await((g=o.beforeSubmit)==null?void 0:g.call(o,l.value));const h=(b=c[x])==null?void 0:b.call(c);h instanceof Promise?(await h,le.success("操作成功"),s.value=!1,t("complete",l.value)):le.error("操作失败")}finally{d.value=!1}}return(g,b)=>{const x=k("el-skeleton"),h=k("el-main"),$=k("el-header"),p=k("el-tab-pane"),D=k("el-tabs"),V=k("el-container");return y(n)?(O(),U(h,{key:0},{default:f(()=>[w(x)]),_:1})):(O(),U(V,{key:1,class:"flow-form"},{default:f(()=>[w($,{class:"flow-form__header"},{default:f(()=>{var C;return[Z("div",Qo,W((C=y(r).flowInstance)==null?void 0:C.title),1),w(qo,{"flow-detail":y(r),onClick:_},null,8,["flow-detail"])]}),_:1}),w(h,{class:"flow-form__main"},{default:f(()=>[w(D,{modelValue:y(u),"onUpdate:modelValue":b[1]||(b[1]=C=>te(u)?u.value=C:null)},{default:f(()=>{var C,S;return[(S=(C=y(r))==null?void 0:C.process)!=null&&S.formPath?Kt(g.$slots,"default",{key:0}):(O(),U(p,{key:1,label:"审批信息",name:"form"},{default:f(()=>[w(So,{ref_key:"formRef",ref:v,modelValue:y(a),"onUpdate:modelValue":b[0]||(b[0]=P=>te(a)?a.value=P:null),"flow-detail":y(r)},null,8,["modelValue","flow-detail"])]),_:1})),w(p,{label:"附件资料",name:"file",lazy:""},{default:f(()=>[w(Wo,{"flow-detail":y(r)},null,8,["flow-detail"])]),_:1}),w(p,{label:"流程跟踪",name:"track",lazy:""},{default:f(()=>[w(zo,{"flow-detail":y(r)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),w(Po,{onConfirm:m})]),_:3}))}}});function yt(e,t){switch(t.type){case"window":return Ho(e,t);case"dialog":case"drawer":return Go(e,t);default:return{open:()=>{},close:()=>{}}}}function Ho(e,t){const{window:{url:o="",name:i="flow-form",features:r="left=0,top=0,width=1600,height=900"}={}}=t,a=L(null),u=R(()=>`${o}?${Ot(It(e,$t(Lt,St)))}`);return{open:()=>{var s;a.value=window.open(u.value,i,r),(s=a.value)==null||s.addEventListener("message",d=>{const{event:v}=d.data,_=y(e)[v];typeof _=="function"&&_(d.data)})},close:()=>{var s;return(s=a.value)==null?void 0:s.close()},openedWindow:a}}function Go(e,t){const{appContext:o}=st();let i;const r=()=>{i=document.createElement("div"),i.className="flow-form-wrapper";const u=Jo(t.formPath),l=Ee(u,{...y(e)}),n=Ee(t.type==="dialog"?Rt:Ft,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},l);n.appContext=o,jt(n,i),document.body.appendChild(i)},a=()=>{i&&document.body.removeChild(i)};return{open:r,close:a}}function Jo(e){return e?Bt(()=>zt(()=>import(e),[])):wt}const nt=Symbol("flowPagesConfig"),Yo={FlowModeler:null,FlowViewer:null,FormDesign:null,request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var bt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(bt||{});const Fe=de(bt);function H(e,t){return e&&t?(e.provide(nt,Ut(Yo,t)),t):Me(nt)}var gt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(gt||{}),Qe=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Qe||{}),He=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(He||{}),ht=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(ht||{});function Ge(){const{request:e}=H(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Xo(){const{request:e}=H(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Zo(){const{request:e}=H(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=n=>e.get(t.list,{params:{type:n,ascs:"sort"}});return{url:t,getList:o,useList:n=>we(()=>o(n.value).then(s=>s.data.records),{refreshDeps:[n]}),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),batchUpdate:n=>e.post(t.batchUpdate,n)}}function Je(){const{request:e}=H(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var kt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(kt||{});function Ye(){const{request:e}=H(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function el(){const{request:e}=H(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function tl(){const{request:e}=H(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:i=>e.get(t.list,{params:i})}}function Ne(){const{request:e}=H(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=s=>e.get(t.list,{params:s}),i=()=>e.get(t.all),r=s=>e.get(t.key,{params:{paramKey:s}});return{url:t,getList:o,getAllParam:i,getParam:r,useParam:s=>we(()=>r(s).then(d=>d.data)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function Vt(){const{request:e}=H(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ol(){const{request:e}=H(),t={tree:"/sapier-flow/flow-user/tree"},o=r=>e.get(t.tree,{params:{filter:r}});return{url:t,getUserTree:o,useUserTree:()=>we(()=>o().then(r=>r.data))}}function Dt(){const{request:e}=H(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Ct=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ct||{});function Ae(){const{request:e}=H(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=n=>e.get(t.list,{params:n});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),deploy:n=>e.post(t.deploy,n)}}const ll={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:de(gt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(Qe),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(He),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:de(ht)},{label:"按钮预览",prop:"buttonPreview",width:150}]},al=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i}=oe({tableOption:ll,crudOption:Ge(),sortOption:{ascs:"sort"}});return i(),(r,a)=>{const u=k("el-button"),l=k("avue-crud");return O(),U(l,ne(re(y(t))),{icon:f(({row:n})=>[w(y(ie),{icon:n.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:f(({row:n})=>[w(u,{type:n.buttonType},{default:f(()=>[w(y(ie),{icon:n.icon},null,8,["icon"]),E(" "+W(n.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":f(()=>[w(u,{type:y(o).buttonType},{default:f(()=>[w(y(ie),{icon:y(o).icon},null,8,["icon"]),E(" "+W(y(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},nl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Xe.column,{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},xt=j({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:i,deploy:r}=Je(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:nl,crudOption:{getList:i},searchForm:{categoryId:o.categoryId}});ue(()=>{u.value.categoryId=o.categoryId??"",l()});const n=L(!1);async function s(d){await Ve.confirm("发布新版本，是否确认？","提示",{type:"success"}),n.value=!0,r({flowModuleId:d.flowModuleId}).then(()=>{le.success("发布成功"),l()}).finally(()=>{n.value=!1})}return(d,v)=>{const _=k("el-button"),c=k("avue-crud");return O(),U(c,ne(re(y(a))),{"menu-left":f(()=>[w(_,{type:"primary",icon:"el-icon-plus",onClick:v[0]||(v[0]=m=>t("add"))},{default:f(()=>[E(" 新增 ")]),_:1})]),menu:f(({row:m})=>[w(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:g=>t("view",m)},{default:f(()=>[E(" 查看 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:g=>t("edit",m)},{default:f(()=>[E(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-upload",onClick:g=>s(m)},{default:f(()=>[E(" 发布 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-switch",onClick:g=>t("version",m)},{default:f(()=>[E(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:f(({row:m})=>[w(y(ie),{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),rl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Xe.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Tt=j({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:i,update:r}=Ye(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:rl,crudOption:{getList:i,dataPath:"res.data"}});ue(()=>{o.flowModuleId&&(u.value.flowModuleId=o.flowModuleId,l())});const n=L(!1);async function s(d){await Ve.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),n.value=!0,r({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{le.success("设置成功"),l()}).finally(()=>{n.value=!1})}return(d,v)=>{const _=k("el-button"),c=k("avue-crud");return O(),U(c,ne(re(y(a))),{"menu-left":f(()=>[w(_,{loading:n.value,type:"primary",icon:"el-icon-arrow-left",onClick:v[0]||(v[0]=m=>t("back"))},{default:f(()=>[E(" 返回 ")]),_:1},8,["loading"])]),menu:f(({row:m})=>[w(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:g=>t("view",m)},{default:f(()=>[E(" 查看 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:g=>t("edit",m)},{default:f(()=>[E(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,disabled:m.mainVersion===y(kt).是,type:"text",icon:"el-icon-switch",onClick:g=>s(m)},{default:f(()=>[E(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:f(({row:m})=>[w(y(ie),{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),rt={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},sl=j({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:i},getDataList:r,handleSave:a,handleUpdate:u,handleDel:l}=oe({crudOption:{rowKey:"id",...Xo(),dataPath:"res.data"},tableOption:rt,pageOption:{pageSize:20}});r();function n(v,_,c,m){a(_,c,m)}function s(v,_,c,m){u(_,NaN,c,m)}async function d(v,_){await l(v.data,NaN),_()}return(v,_)=>{const c=k("avue-tree");return O(),U(c,{modelValue:y(o),"onUpdate:modelValue":_[0]||(_[0]=m=>te(o)?o.value=m:null),option:y(rt),data:y(i),onNodeClick:_[1]||(_[1]=m=>t("node-click",m)),onSave:n,onUpdate:s,onDel:d},null,8,["modelValue","option","data"])}}}),Ze=j({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var n;const o=e,{FormDesign:i}=H(),r=R({get(){return o.modelValue?it(o.modelValue):{menuBtn:!1,span:24}},set(s){t("update:modelValue",Qt(s,{useJson5:!1}))}}),a=R(()=>o.fields?JSON.parse(o.fields):[]),u=R(()=>{const s={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...s,props:{label:"name",value:"name",desc:"comment"}},{...s,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((n=Ht.settings)==null?void 0:n.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(s,d)=>{const v=k("avue-form");return s.view?(O(),U(v,{key:0,class:qt(r.value.class),"model-value":{},option:r.value},null,8,["class","option"])):(O(),U(y(i),{key:1,modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=_=>r.value=_),"base-option":u.value,resources:l},null,8,["modelValue","base-option"]))}}}),il=Z("span",null,"流程设计",-1),ul={key:0},cl={key:1},dl={style:{height:"calc(100vh - 144px)"}},pl=j({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const i=Ce(e),{visible:r,modelValue:a}=i,{create:u,deploy:l,getDetail:n,update:s}=Je(),{getDetail:d,update:v}=Ye(),_=["流程信息","表单设计","模型设计","完成"],c=L(!1);_e(r,async P=>{if(!P)return;const{flowModuleId:T}=a.value,{flowDeployId:I}=a.value;try{c.value=!0;let N={};I?N=await d({flowDeployId:I}):T&&(N=await n({flowModuleId:T})),a.value=N.data}finally{c.value=!1}},{immediate:!0});const{data:m}=Dt().useList(),{data:g}=Vt().useList(),{data:b}=Ae().useList(),x=R(()=>{var P,T;return(T=(P=b.value)==null?void 0:P.find(I=>I.tableName===a.value.formDataTable))==null?void 0:T.tableFields}),h=L(0),$=R(()=>{var P,T;return h.value===1?((P=m.value)==null?void 0:P.map(I=>({label:I.formName,value:I.formOption})))??[]:h.value===2?((T=g.value)==null?void 0:T.map(I=>({label:I.flowName,value:I.flowData})))??[]:[]});function p(P){h.value===1?a.value.formOption=P.value:h.value===2&&(a.value.flowData=P.value)}const D=L();async function V(P){h.value===0&&await We(D),c.value=!0;const{flowModuleId:T}=a.value,{flowDeployId:I}=a.value;try{I?await v(a.value):T?await s(a.value):await u(a.value).then(N=>{a.value.flowModuleId=N.data.flowModuleId}),le.success("保存成功")}finally{c.value=!1}typeof P=="number"?h.value=P:h.value++}async function C(){await Ve.confirm("发布新版本，是否确认？","提示"),c.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{le.success("发布成功")}).finally(()=>{c.value=!1})}function S(){r.value=!1,h.value=0,a.value={},t("close")}return(P,T)=>{const I=k("el-link"),N=k("el-dropdown-item"),F=k("el-dropdown-menu"),M=k("el-dropdown"),K=k("el-col"),z=k("el-step"),ee=k("el-steps"),G=k("el-button"),J=k("el-row"),Y=k("avue-form"),A=k("el-result"),se=k("el-dialog"),et=Ke("loading");return O(),U(se,{modelValue:y(r),"onUpdate:modelValue":T[5]||(T[5]=q=>te(r)?r.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:S},{header:f(()=>[w(J,{justify:"center"},{default:f(()=>[w(K,{span:5},{default:f(()=>{var q,me,Oe,tt;return[Z("div",null,[il,(q=y(a))!=null&&q.flowName?(O(),B("span",ul," - "+W((me=y(a))==null?void 0:me.flowName),1)):Q("",!0),(Oe=y(a))!=null&&Oe.version?(O(),B("span",cl," - V"+W((tt=y(a))==null?void 0:tt.version),1)):Q("",!0)]),$.value.length?(O(),U(M,{key:0},{dropdown:f(()=>[w(F,null,{default:f(()=>[(O(!0),B(X,null,fe($.value,Ie=>(O(),U(N,{key:Ie.label,onClick:Ul=>p(Ie)},{default:f(()=>[E(W(Ie.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:f(()=>[w(I,{icon:"el-icon-arrow-down",underline:!1},{default:f(()=>[E(" 选择模板 ")]),_:1})]),_:1})):Q("",!0)]}),_:1}),w(K,{span:14},{default:f(()=>[w(ee,{active:h.value,simple:"","process-status":"finish","finish-status":"success"},{default:f(()=>[(O(),B(X,null,fe(_,(q,me)=>w(z,{key:me,title:q,onClick:Oe=>V(me)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),w(K,{span:5,style:{"text-align":"right"}},{default:f(()=>[w(G,{disabled:h.value===0,loading:c.value,type:"primary",onClick:T[0]||(T[0]=q=>h.value--)},{default:f(()=>[E(" 上一步 ")]),_:1},8,["disabled","loading"]),w(G,{disabled:h.value===_.length-1,type:"primary",loading:c.value,onClick:T[1]||(T[1]=q=>V())},{default:f(()=>[E(" 下一步 ")]),_:1},8,["disabled","loading"]),w(G,{onClick:S},{default:f(()=>[E(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:f(()=>[Be((O(),B("div",dl,[h.value===0?(O(),U(Y,{key:0,ref_key:"formRef",ref:D,modelValue:y(a),"onUpdate:modelValue":T[2]||(T[2]=q=>te(a)?a.value=q:null),option:y(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):Q("",!0),h.value===1?(O(),U(Ze,{key:1,modelValue:y(a).formOption,"onUpdate:modelValue":T[3]||(T[3]=q=>y(a).formOption=q),fields:x.value},null,8,["modelValue","fields"])):Q("",!0),h.value===2?(O(),U(Te,{key:2,modelValue:y(a).flowData,"onUpdate:modelValue":T[4]||(T[4]=q=>y(a).flowData=q),"flow-form-option":y(a).formOption},null,8,["modelValue","flow-form-option"])):Q("",!0),h.value===3?(O(),U(A,{key:3,icon:"success",title:"流程设计完成"},{extra:f(()=>[y(a).flowDeployId?Q("",!0):(O(),U(G,{key:0,type:"primary",onClick:C},{default:f(()=>[E(" 发布 ")]),_:1})),w(G,{onClick:S},{default:f(()=>[E(" 关闭 ")]),_:1})]),_:1})):Q("",!0)])),[[et,c.value]])]),_:1},8,["modelValue"])}}}),fl=Z("span",null,"流程查看",-1),ml={key:0},vl={key:1},_l=j({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=Ce(e),{visible:i,modelValue:r}=o,{getDetail:a}=Je(),{getDetail:u}=Ye(),l=L("form"),n=L(!1);_e(i,async d=>{if(!d)return;const{flowModuleId:v}=r.value,{flowDeployId:_}=r.value;try{n.value=!0;let c={};_?c=await u({flowDeployId:_}):v&&(c=await a({flowModuleId:v})),r.value={...c.data}}finally{n.value=!1}},{immediate:!0});function s(){r.value={},l.value="form"}return(d,v)=>{const _=k("el-tab-pane"),c=k("el-tabs"),m=k("el-dialog"),g=Ke("loading");return O(),U(m,{modelValue:y(i),"onUpdate:modelValue":v[3]||(v[3]=b=>te(i)?i.value=b:null),width:"60%",top:"0",onClose:s},{header:f(()=>{var b,x,h,$;return[fl,(b=y(r))!=null&&b.flowName?(O(),B("span",ml," - "+W((x=y(r))==null?void 0:x.flowName),1)):Q("",!0),(h=y(r))!=null&&h.version?(O(),B("span",vl," - V"+W(($=y(r))==null?void 0:$.version),1)):Q("",!0)]}),default:f(()=>[Be((O(),U(c,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=b=>l.value=b)},{default:f(()=>[w(_,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:f(()=>[l.value==="form"&&y(r).formOption?(O(),U(Ze,{key:0,modelValue:y(r).formOption,"onUpdate:modelValue":v[0]||(v[0]=b=>y(r).formOption=b),view:""},null,8,["modelValue"])):Q("",!0)]),_:1}),w(_,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:f(()=>[l.value==="flow"?(O(),U(Te,{key:0,modelValue:y(r).flowData,"onUpdate:modelValue":v[1]||(v[1]=b=>y(r).flowData=b),view:""},null,8,["modelValue"])):Q("",!0)]),_:1})]),_:1},8,["modelValue"])),[[g,n.value]])]),_:1},8,["modelValue"])}}}),wl=j({__name:"index",setup(e){const t=L("definition"),o=L({}),i=L(""),r=L("");function a(m){i.value===m.id?i.value="":i.value=m.id}const u=L(!1),l=L(!1);function n(){o.value={},u.value=!0}function s(m){o.value=m,u.value=!0}function d(m){o.value=m,l.value=!0}function v(m){r.value=m.flowModuleId||"",t.value="deploy"}function _(){r.value="",t.value="definition"}async function c(){const m=t.value;await pe(),t.value="",await pe(),t.value=`${m}`}return(m,g)=>{const b=k("el-col"),x=k("el-row");return O(),U(x,{gutter:20},{default:f(()=>[w(b,{span:4},{default:f(()=>[w(sl,{onNodeClick:a})]),_:1}),w(b,{span:20},{default:f(()=>[t.value==="definition"?(O(),U(xt,{key:0,"category-id":i.value,onAdd:n,onEdit:s,onView:d,onVersion:v},null,8,["category-id"])):Q("",!0),t.value==="deploy"?(O(),U(Tt,{key:1,"flow-module-id":r.value,onEdit:s,onView:d,onBack:_},null,8,["flow-module-id"])):Q("",!0),w(pl,{modelValue:o.value,"onUpdate:modelValue":g[0]||(g[0]=h=>o.value=h),visible:u.value,"onUpdate:visible":g[1]||(g[1]=h=>u.value=h),onClose:c},null,8,["modelValue","visible"]),w(_l,{modelValue:o.value,"onUpdate:modelValue":g[2]||(g[2]=h=>o.value=h),visible:l.value,"onUpdate:visible":g[3]||(g[3]=h=>l.value=h)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),yl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},bl=j({__name:"index",setup(e){const t=Xt("debugMode",!1),{getList:o}=tl(),{bindVal:i,getDataList:r}=oe({tableOption:yl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});r();const a=L({}),{open:u,close:l}=yt(a,{type:"drawer"});function n(s){a.value={flowKey:s.flowKey,taskId:s.taskId,instanceId:s.flowInstanceId,debug:t.value,onComplete:()=>{l(),r()}},u()}return(s,d)=>{const v=k("el-switch"),_=k("el-button"),c=k("el-link"),m=k("avue-crud");return O(),U(m,ne(re(y(i))),{"menu-right":f(()=>[w(_,{type:"text"},{default:f(()=>[w(v,{modelValue:y(t),"onUpdate:modelValue":d[0]||(d[0]=g=>te(t)?t.value=g:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:f(({row:g})=>[w(c,{type:"primary",underline:!1,onClick:b=>n(g)},{default:f(()=>[E(W(g.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),gl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Fe},{label:"备注",prop:"remark"}]},hl=j({__name:"index",setup(e){const{bindVal:t,getDataList:o}=oe({tableOption:gl,crudOption:Ne()});return o(),(i,r)=>{const a=k("avue-crud");return O(),U(a,ne(re(y(t))),null,16)}}}),kl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Vl={class:"flow-list"},Dl=["onClick"],Cl={class:"flow-name"},xl=j({__name:"index",setup(e){const t=L([]),{getPublishFlow:o,getTodoList:i}=xe();o().then(_=>{t.value=_.data});const r=L({}),{open:a,close:u}=yt(r,{type:"drawer"});function l(_){r.value={flowKey:_.flowKey,taskId:_.taskId,instanceId:_.flowInstanceId,onComplete:()=>{u(),s()}},a()}const{bindVal:n,getDataList:s,crudStateRefs:{searchForm:d}}=oe({tableOption:kl,crudOption:{getList:i},searchForm:{status:2}}),v=[{label:"待办",value:2},{label:"已办",value:1}];return(_,c)=>{const m=k("el-button"),g=k("el-collapse-item"),b=k("el-collapse"),x=k("el-card"),h=k("el-divider"),$=k("avue-radio"),p=k("el-link"),D=k("avue-crud");return O(),B(X,null,[w(x,{"body-style":{padding:"0 20px"}},{default:f(()=>[w(b,{"model-value":"1"},{default:f(()=>[w(g,{name:"1"},{title:f(()=>[w(m,{text:"",icon:"el-icon-promotion"},{default:f(()=>[E(" 发起审批 ")]),_:1})]),default:f(()=>[Z("div",Vl,[(O(!0),B(X,null,fe(t.value,V=>(O(),B("div",{key:V.flowKey,class:"flow-item",onClick:C=>l(V)},[w(y(ie),{class:"flow-icon",icon:V.flowIcon,width:"60"},null,8,["icon"]),Z("div",Cl,W(V.flowName),1)],8,Dl))),128))])]),_:1})]),_:1})]),_:1}),w(h,{direction:"horizontal","content-position":"left"}),w(D,ne(re(y(n))),{"menu-left":f(()=>[w($,{modelValue:y(d).status,"onUpdate:modelValue":[c[0]||(c[0]=V=>y(d).status=V),y(s)],button:"",dic:v},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:f(({row:V})=>[w(p,{type:"primary",underline:!1,onClick:C=>l(V)},{default:f(()=>[E(W(V.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Tl=je(xl,[["__scopeId","data-v-de4a15fa"]]),Nl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Ol=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:r}=oe({tableOption:Nl,crudOption:Vt()});i();const a=L(!1);async function u(n){o.value=n,a.value=!0}async function l(){await r(o.value,NaN,()=>a.value=!1,()=>{})}return(n,s)=>{const d=k("el-button"),v=k("avue-crud"),_=k("el-dialog");return O(),B(X,null,[w(v,ne(re(y(t))),{flowData:f(({row:c})=>[w(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>u(c)},{default:f(()=>[E(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(_,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=c=>a.value=c),title:`模型设计-${y(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[w(d,{type:"primary",onClick:l},{default:f(()=>[E(" 保存 ")]),_:1}),w(d,{onClick:s[1]||(s[1]=c=>a.value=!1)},{default:f(()=>[E(" 取消 ")]),_:1})]),default:f(()=>[w(Te,{modelValue:y(o).flowData,"onUpdate:modelValue":s[0]||(s[0]=c=>y(o).flowData=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Il={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},$l=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:r}=oe({tableOption:Il,crudOption:Dt()});i();const a=L(!1);async function u(n){o.value={...n},a.value=!0}async function l(){await r(o.value,NaN,()=>a.value=!1,()=>{})}return(n,s)=>{const d=k("el-button"),v=k("avue-crud"),_=k("el-dialog");return O(),B(X,null,[w(v,ne(re(y(t))),{formOption:f(({row:c})=>[w(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>u(c)},{default:f(()=>[E(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(_,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=c=>a.value=c),title:`表单设计-${y(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[w(d,{type:"primary",onClick:l},{default:f(()=>[E(" 保存 ")]),_:1}),w(d,{onClick:s[1]||(s[1]=c=>a.value=!1)},{default:f(()=>[E(" 取消 ")]),_:1})]),default:f(()=>[w(Ze,{modelValue:y(o).formOption,"onUpdate:modelValue":s[0]||(s[0]=c=>y(o).formOption=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ll={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:de(Ct)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Fe,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Fe,value:1}]}}]},Sl=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,beforeOpen:r,beforeSubmit:a}=oe({crudOption:Ae(),tableOption:Ll});i();const{data:u}=Ne().useParam("table.default.fields");r(d=>{d==="add"?o.value.tableFields=u.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),a(d=>{d.tableFields=JSON.stringify(d.tableFields)});const{deploy:l}=Ae(),n=L(!1);async function s(d){await Ve.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),n.value=!0,l({id:d.id}).then(()=>{le.success("部署成功"),i()}).finally(()=>{n.value=!1})}return(d,v)=>{const _=k("el-button"),c=k("avue-crud");return O(),U(c,ne(re(y(t))),{menu:f(({row:m})=>[w(_,{type:"text",icon:"el-icon-upload",onClick:g=>s(m)},{default:f(()=>[E(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Fa={install(e,t){e.component("FlowButton",al).component("FlowDefinition",xt).component("FlowDeploy",Tt).component("FlowForm",wt).component("FlowManage",wl).component("FlowOps",bl).component("FlowParam",hl).component("FlowTemplate",Ol).component("FormTemplate",$l).component("TableTemplate",Sl).component("FlowWorkbench",Tl),H(e,t)}};export{Yo as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,al as FlowButton,xt as FlowDefinition,Tt as FlowDeploy,wt as FlowForm,wl as FlowManage,bl as FlowOps,hl as FlowParam,Ol as FlowTemplate,Tl as FlowWorkbench,$l as FormTemplate,Sl as TableTemplate,bt as Whether,Fa as default,Jo as resolveFlowFormComponent,H as useConfigProvider,yt as useFlowForm,Go as useFlowFormOverlay,Ho as useFlowFormWindow,Fe as whetherDic};
