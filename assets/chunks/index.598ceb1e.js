import{u as Pe,aJ as Wt,aK as Xe,aQ as Ht,aR as Qt,aH as et,_ as xe,aS as qt,aD as Jt,ax as tt,aT as Gt,aU as Ge,aV as Yt,aW as ot,aX as Zt,aY as Xt,aZ as be,x as lt,a_ as nt,a$ as at,b0 as eo,y as st,J as to,aq as oo,b1 as X,b2 as ie,b3 as te,b4 as he,b5 as lo,b6 as no,b7 as ao,aO as so,b8 as ro,aP as io,z as uo}from"../composables_use-crud_index.md.fba15c80.js";import{r as co}from"./axios.76d92975.js";import{al as fo,f as K,R as we,c as R,h as $,i as B,z as H,j as Z,l as J,u as c,t as j,G as w,B as p,A as N,I as po,C as M,W as Fe,r as I,w as le,n as oe,e as mo,d as Ue,a0 as vo,S as rt,a1 as me,E as it,ay as yo,ag as ut,T as ct,aw as dt,D as V,$ as Ee,y as ke,s as Te,b as ne,ac as q,k as F,ao as ae,ap as se,F as Y,L as ue,_ as Ae,aI as Be,ai as Ne,am as _o,a_ as bo,aL as wo}from"./framework.58691f2b.js";import{e as go,c as Ye,a as ho,d as Ce,q as ko,x as Co}from"./theme.79d710c4.js";import{A as Vo,_ as $o,a5 as ft,a4 as Do,a7 as pt,a8 as To,a9 as Io}from"./index.vue_vue_type_script_setup_true_lang.71a4f17e.js";import{a as Oo,_ as So}from"./index.vue_vue_type_script_setup_true_lang.936ca333.js";import{d as Lo}from"./data.4cb21f02.js";import{a as Eo}from"../flow-design_flow-modeler_index.md.09bbbfe3.js";import{fM as No}from"../app.811c0995.js";import"./vue.runtime.esm-bundler.9b9f3da3.js";import"../components_basic-container_index.md.9b371e9c.js";import"../components_icon-select_index.md.2adaa6f9.js";import"../components_index.md.a2be98bb.js";import"../components_v-text_index.md.fffa2334.js";import"../composables_index.md.4f63e5ec.js";import"../flow-design_flow-viewer_index.md.0f2bbce1.js";import"../flow-design_index.md.36aaaa61.js";import"../flow-pages_index.md.96a87367.js";import"../flow-pages_pages_flow-button_index.md.1f7d435d.js";import"../flow-pages_pages_flow-manage_index.md.6605ff50.js";import"../flow-pages_pages_flow-ops_index.md.48c2710e.js";import"../flow-pages_pages_flow-param_index.md.a838fc38.js";import"../flow-pages_pages_flow-template_index.md.3343aa48.js";import"../flow-pages_pages_flow-workbench_index.md.aed1688c.js";import"../flow-pages_pages_form-template_index.md.4c26b2a2.js";import"../flow-pages_pages_table-template_index.md.2f954a1a.js";import"../form-design_demo.md.7ed33b13.js";import"../form-design_index.md.646ff874.js";import"../guide_changelog.md.c4dd5b98.js";import"../guide_start.md.ac582e3a.js";import"../index.md.01cb05dd.js";import"../plugins_avue-patch_index.md.a923bff2.js";import"../plugins_env-dts_index.md.8a6051ce.js";import"../plugins_index.md.85630059.js";import"../plugins_load-proxy_index.md.599d2cf3.js";import"../plugins_uni-ui-patch_index.md.73eaa4d7.js";import"../plugins_uview-patch_index.md.d35310f9.js";import"../types_avue_index.md.6dd55393.js";import"../utils_date_dateFormat.md.46292425.js";import"../utils_date_durationFormat.md.a9466ca5.js";import"../utils_emitter_mittAsync.md.fa0c1888.js";import"../utils_index.md.6539ff35.js";import"../utils_math_index.md.74592475.js";import"../utils_object_filterObj.md.7e4e2a5d.js";import"../utils_object_filterObjDeep.md.30ba6b3d.js";import"../utils_object_getDataType.md.e91e1325.js";import"../utils_string_deserialize.md.53d74973.js";import"../utils_string_serialize.md.46d95769.js";import"../utils_string_uuid.md.0357bc06.js";import"../utils_tool_awaitTo.md.02770430.js";import"../utils_tool_enumToDic.md.9f356deb.js";import"../utils_tool_sleep.md.1f530da0.js";import"../utils_tree_buildTree.md.90191de7.js";import"../utils_tree_filterTree.md.75f848cc.js";import"../utils_tree_findTree.md.19218304.js";import"../utils_tree_flatTree.md.aad7510e.js";import"../utils_tree_treeMap.md.d5162fe5.js";const Ro=(...e)=>o=>{e.forEach(t=>{fo(t)?t(o):t.value=o})},mt=Symbol("dialogInjectionKey"),vt=Pe({center:{type:Boolean,default:!1},alignCenter:{type:Boolean,default:!1},closeIcon:{type:Wt},customClass:{type:String,default:""},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},title:{type:String,default:""}}),Po={close:()=>!0},xo=["aria-label"],Fo=["id"],Uo=K({name:"ElDialogContent"}),Ao=K({...Uo,props:vt,emits:Po,setup(e){const o=e,{t}=Xe(),{Close:l}=qt,{dialogRef:n,headerRef:a,bodyId:r,ns:s,style:i}=we(mt),{focusTrapRef:u}=we(Ht),d=Ro(u,n),g=R(()=>o.draggable);return Qt(n,a,g),(f,m)=>($(),B("div",{ref:c(d),class:J([c(s).b(),c(s).is("fullscreen",f.fullscreen),c(s).is("draggable",c(g)),c(s).is("align-center",f.alignCenter),{[c(s).m("center")]:f.center},f.customClass]),style:Fe(c(i)),tabindex:"-1"},[H("header",{ref_key:"headerRef",ref:a,class:J(c(s).e("header"))},[Z(f.$slots,"header",{},()=>[H("span",{role:"heading",class:J(c(s).e("title"))},j(f.title),3)]),f.showClose?($(),B("button",{key:0,"aria-label":c(t)("el.dialog.close"),class:J(c(s).e("headerbtn")),type:"button",onClick:m[0]||(m[0]=v=>f.$emit("close"))},[w(c(et),{class:J(c(s).e("close"))},{default:p(()=>[($(),N(po(f.closeIcon||c(l))))]),_:1},8,["class"])],10,xo)):M("v-if",!0)],2),H("div",{id:c(r),class:J(c(s).e("body"))},[Z(f.$slots,"default")],10,Fo),f.$slots.footer?($(),B("footer",{key:0,class:J(c(s).e("footer"))},[Z(f.$slots,"footer")],2)):M("v-if",!0)],6))}});var Bo=xe(Ao,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog-content.vue"]]);const yt=Pe({...vt,appendToBody:{type:Boolean,default:!1},beforeClose:{type:Jt(Function)},destroyOnClose:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:{type:Boolean,default:!1},modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1}}),_t={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[tt]:e=>go(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},bt=(e,o)=>{const l=Ue().emit,{nextZIndex:n}=Gt();let a="";const r=Ge(),s=Ge(),i=I(!1),u=I(!1),d=I(!1),g=I(e.zIndex||n());let f,m;const v=Yt("namespace",Xt),h=R(()=>{const A={},Q=`--${v.value}-dialog`;return e.fullscreen||(e.top&&(A[`${Q}-margin-top`]=e.top),e.width&&(A[`${Q}-width`]=ot(e.width))),A}),k=R(()=>e.alignCenter?{display:"flex"}:{});function S(){l("opened")}function y(){l("closed"),l(tt,!1),e.destroyOnClose&&(d.value=!1)}function C(){l("close")}function b(){m==null||m(),f==null||f(),e.openDelay&&e.openDelay>0?{stop:f}=Ye(()=>O(),e.openDelay):O()}function _(){f==null||f(),m==null||m(),e.closeDelay&&e.closeDelay>0?{stop:m}=Ye(()=>P(),e.closeDelay):P()}function T(){function A(Q){Q||(u.value=!0,i.value=!1)}e.beforeClose?e.beforeClose(A):_()}function L(){e.closeOnClickModal&&T()}function O(){ho&&(i.value=!0)}function P(){i.value=!1}function D(){l("openAutoFocus")}function x(){l("closeAutoFocus")}function U(A){var Q;((Q=A.detail)==null?void 0:Q.focusReason)==="pointer"&&A.preventDefault()}e.lockScroll&&Zt(i);function W(){e.closeOnPressEscape&&T()}return le(()=>e.modelValue,A=>{A?(u.value=!1,b(),d.value=!0,g.value=e.zIndex?g.value++:n(),oe(()=>{l("open"),o.value&&(o.value.scrollTop=0)})):i.value&&_()}),le(()=>e.fullscreen,A=>{o.value&&(A?(a=o.value.style.transform,o.value.style.transform=""):o.value.style.transform=a)}),mo(()=>{e.modelValue&&(i.value=!0,d.value=!0,b())}),{afterEnter:S,afterLeave:y,beforeLeave:C,handleClose:T,onModalClick:L,close:_,doClose:P,onOpenAutoFocus:D,onCloseAutoFocus:x,onCloseRequested:W,onFocusoutPrevented:U,titleId:r,bodyId:s,closed:u,style:h,overlayDialogStyle:k,rendered:d,visible:i,zIndex:g}},Mo=["aria-label","aria-labelledby","aria-describedby"],Ko=K({name:"ElDialog",inheritAttrs:!1}),zo=K({...Ko,props:yt,emits:_t,setup(e,{expose:o}){const t=e,l=vo();be({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},R(()=>!!l.title)),be({scope:"el-dialog",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/dialog.html#attributes",type:"Attribute"},R(()=>!!t.customClass));const n=lt("dialog"),a=I(),r=I(),s=I(),{visible:i,titleId:u,bodyId:d,style:g,overlayDialogStyle:f,rendered:m,zIndex:v,afterEnter:h,afterLeave:k,beforeLeave:S,handleClose:y,onModalClick:C,onOpenAutoFocus:b,onCloseAutoFocus:_,onCloseRequested:T,onFocusoutPrevented:L}=bt(t,a);rt(mt,{dialogRef:a,headerRef:r,bodyId:d,ns:n,rendered:m,style:g});const O=eo(C),P=R(()=>t.draggable&&!t.fullscreen);return o({visible:i,dialogContentRef:s}),(D,x)=>($(),N(dt,{to:"body",disabled:!D.appendToBody},[w(ct,{name:"dialog-fade",onAfterEnter:c(h),onAfterLeave:c(k),onBeforeLeave:c(S),persisted:""},{default:p(()=>[me(w(c(nt),{"custom-mask-event":"",mask:D.modal,"overlay-class":D.modalClass,"z-index":c(v)},{default:p(()=>[H("div",{role:"dialog","aria-modal":"true","aria-label":D.title||void 0,"aria-labelledby":D.title?void 0:c(u),"aria-describedby":c(d),class:J(`${c(n).namespace.value}-overlay-dialog`),style:Fe(c(f)),onClick:x[0]||(x[0]=(...U)=>c(O).onClick&&c(O).onClick(...U)),onMousedown:x[1]||(x[1]=(...U)=>c(O).onMousedown&&c(O).onMousedown(...U)),onMouseup:x[2]||(x[2]=(...U)=>c(O).onMouseup&&c(O).onMouseup(...U))},[w(c(at),{loop:"",trapped:c(i),"focus-start-el":"container",onFocusAfterTrapped:c(b),onFocusAfterReleased:c(_),onFocusoutPrevented:c(L),onReleaseRequested:c(T)},{default:p(()=>[c(m)?($(),N(Bo,it({key:0,ref_key:"dialogContentRef",ref:s},D.$attrs,{"custom-class":D.customClass,center:D.center,"align-center":D.alignCenter,"close-icon":D.closeIcon,draggable:c(P),fullscreen:D.fullscreen,"show-close":D.showClose,title:D.title,onClose:c(y)}),yo({header:p(()=>[D.$slots.title?Z(D.$slots,"title",{key:1}):Z(D.$slots,"header",{key:0,close:c(y),titleId:c(u),titleClass:c(n).e("title")})]),default:p(()=>[Z(D.$slots,"default")]),_:2},[D.$slots.footer?{name:"footer",fn:p(()=>[Z(D.$slots,"footer")])}:void 0]),1040,["custom-class","center","align-center","close-icon","draggable","fullscreen","show-close","title","onClose"])):M("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,Mo)]),_:3},8,["mask","overlay-class","z-index"]),[[ut,c(i)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"]))}});var jo=xe(zo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog.vue"]]);const Wo=st(jo),Ho=Pe({...yt,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),Qo=_t,qo=K({name:"ElDrawer",components:{ElOverlay:nt,ElFocusTrap:at,ElIcon:et,Close:to},inheritAttrs:!1,props:Ho,emits:Qo,setup(e,{slots:o}){be({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},R(()=>!!o.title)),be({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},R(()=>!!e.customClass));const t=I(),l=I(),n=lt("drawer"),{t:a}=Xe(),r=R(()=>e.direction==="rtl"||e.direction==="ltr"),s=R(()=>ot(e.size));return{...bt(e,t),drawerRef:t,focusStartRef:l,isHorizontal:r,drawerSize:s,ns:n,t:a}}}),Jo=["aria-label","aria-labelledby","aria-describedby"],Go=["id"],Yo=["aria-label"],Zo=["id"];function Xo(e,o,t,l,n,a){const r=V("close"),s=V("el-icon"),i=V("el-focus-trap"),u=V("el-overlay");return $(),N(dt,{to:"body",disabled:!e.appendToBody},[w(ct,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:p(()=>[me(w(u,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:p(()=>[w(i,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:p(()=>[H("div",it({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:o[1]||(o[1]=Ee(()=>{},["stop"]))}),[H("span",{ref:"focusStartRef",class:J(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?($(),B("header",{key:0,class:J(e.ns.e("header"))},[e.$slots.title?Z(e.$slots,"title",{key:1},()=>[M(" DEPRECATED SLOT ")]):Z(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?M("v-if",!0):($(),B("span",{key:0,id:e.titleId,role:"heading",class:J(e.ns.e("title"))},j(e.title),11,Go))]),e.showClose?($(),B("button",{key:2,"aria-label":e.t("el.drawer.close"),class:J(e.ns.e("close-btn")),type:"button",onClick:o[0]||(o[0]=(...d)=>e.handleClose&&e.handleClose(...d))},[w(s,{class:J(e.ns.e("close"))},{default:p(()=>[w(r)]),_:1},8,["class"])],10,Yo)):M("v-if",!0)],2)):M("v-if",!0),e.rendered?($(),B("div",{key:1,id:e.bodyId,class:J(e.ns.e("body"))},[Z(e.$slots,"default")],10,Zo)):M("v-if",!0),e.$slots.footer?($(),B("div",{key:2,class:J(e.ns.e("footer"))},[Z(e.$slots,"footer")],2)):M("v-if",!0)],16,Jo)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[ut,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var el=xe(qo,[["render",Xo],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const tl=st(el);var ol=co();const ll=oo(ol),nl={},al=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),sl=()=>nl,rl=e=>Array.isArray(e),Me=e=>e!==null&&typeof e=="object",wt=e=>e instanceof Function,ve=e=>e==null,Ke=typeof window>"u",gt=()=>{var e;return Ke||ve((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},il=()=>{var e,o;return(e=!Ke&&((o=window.navigator)===null||o===void 0?void 0:o.onLine))!==null&&e!==void 0?e:!0},Ie=()=>new Promise(()=>{}),ee=e=>q(e)?e.value:e,ul=e=>Me(e)?Object.assign(rl(e)?[]:{},e):e,ye=new Map,cl=e=>ve(e)?void 0:ye.get(e),dl=(e,o,t)=>{const l=ye.get(e);l!=null&&l.timer&&clearTimeout(l.timer);const n=setTimeout(()=>ye.delete(e),o);ye.set(e,{...t,timer:n})},re=e=>e;function ht(e,o,t){let l,n,a,r,s,i,u=0,d=!1,g=!1,f=!0;const m=!o&&o!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");o=+o||0,Me(t)&&(d=!!t.leading,g="maxWait"in t,a=g?Math.max(+t.maxWait||0,o):a,f="trailing"in t?!!t.trailing:f);function v(D){const x=l,U=n;return l=n=void 0,u=D,r=e.apply(U,x),r}function h(D,x){return m?(window.cancelAnimationFrame(s),window.requestAnimationFrame(D)):setTimeout(D,x)}function k(D){if(m)return window.cancelAnimationFrame(D);clearTimeout(D)}function S(D){return u=D,s=h(b,o),d?v(D):r}function y(D){const x=D-i,U=D-u,W=o-x;return g?Math.min(W,a-U):W}function C(D){const x=D-i,U=D-u;return i===void 0||x>=o||x<0||g&&U>=a}function b(){const D=Date.now();if(C(D))return _(D);s=h(b,y(D))}function _(D){return s=void 0,f&&l?v(D):(l=n=void 0,r)}function T(){s!==void 0&&k(s),u=0,l=i=n=s=void 0}function L(){return s===void 0?r:_(Date.now())}function O(){return s!==void 0}function P(...D){const x=Date.now(),U=C(x);if(l=D,n=this,i=x,U){if(s===void 0)return S(i);if(g)return s=h(b,o),v(i)}return s===void 0&&(s=h(b,o)),r}return P.cancel=T,P.flush=L,P.pending=O,P}function fl(e,o,t){let l=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Me(t)&&(l="leading"in t?!!t.leading:l,n="trailing"in t?!!t.trailing:n),ht(e,o,{leading:l,trailing:n,maxWait:o})}var pl=re((e,{debounceInterval:o,debounceOptions:t,manual:l})=>{const n=I(!1),a=I(),r=R(()=>t),s=R(()=>ee(o)),i=I(e.context.runAsync);return l||(n.value=!0),ne(u=>{ve(s.value)||(a.value=ht(d=>d(),s.value,r.value),e.context.runAsync=(...d)=>new Promise((g,f)=>{n.value?(n.value=!1,i.value(...d).then(g).catch(f)):a.value(()=>{i.value(...d).then(g).catch(f)})}),u(()=>{var d;(d=a.value)===null||d===void 0||d.cancel(),e.context.runAsync=i.value}))}),{onCancel(){var u;(u=a.value)===null||u===void 0||u.cancel()}}}),ml=re((e,{errorRetryCount:o=0,errorRetryInterval:t=0})=>{const l=I(),n=I(0),a=R(()=>ee(o)),r=R(()=>ee(t));let s=!1;const i=()=>{n.value=0},u=R(()=>{if(r.value)return r.value;const f=1e3,m=1,v=9,h=Math.floor(Math.random()*2**Math.min(n.value,v)+m);return f*h}),d=()=>{let f;const m=a.value===-1,v=n.value<a.value;return(m||v)&&(m||(n.value+=1),f=setTimeout(()=>{s=!0,e.context.refresh()},u.value)),()=>f&&clearTimeout(f)},g=()=>{l.value&&l.value()};return{onBefore(){s||i(),s=!1,g()},onSuccess(){i()},onError(){l.value=d()},onCancel(){i(),g()}}}),vl=re((e,{ready:o=I(!0),manual:t,defaultParams:l=[]})=>(le(o,n=>{!t&&n&&e.context.run(...l)},{flush:"sync"}),{onBefore(){if(!o.value)return e.loading.value=!1,{isBreak:!0}}})),yl=re((e,{refreshDeps:o=[],refreshDepsAction:t,manual:l})=>(o!=null&&o.length&&le(o,()=>{t?t():!l&&e.context.refresh()}),{})),_l=re((e,{throttleInterval:o,throttleOptions:t})=>{const l=I(),n=R(()=>ee(o)),a=R(()=>t),r=I(e.context.runAsync);return ne(s=>{if(ve(o))return{};l.value=fl(i=>i(),n.value,a.value),e.context.runAsync=(...i)=>new Promise((u,d)=>{l.value(()=>{r.value(...i).then(u).catch(d)})}),s(()=>{var i;(i=l.value)===null||i===void 0||i.cancel(),e.context.runAsync=r.value})}),{onCancel(){var s;(s=l.value)===null||s===void 0||s.cancel()}}});const bl=(e,o)=>t=>{Object.keys(t).forEach(l=>{e[l].value=t[l]}),o.forEach(l=>l(e))},wl=(e,o)=>()=>{let t=o;for(let l=e.length;l-- >0;)t=e[l](t);return t()},gl=(e,o,t)=>{var l,n;const{initialData:a,onSuccess:r,onError:s,onBefore:i,onAfter:u}=o,d=I((l=t==null?void 0:t.loading)!==null&&l!==void 0?l:!1),g=Te((n=t==null?void 0:t.data)!==null&&n!==void 0?n:a),f=Te(t==null?void 0:t.error),m=I(t==null?void 0:t.params),v=I([]),h=Te("pending"),k={},S=bl({status:h,loading:d,data:g,error:f,params:m},[]),y=(b,..._)=>{if(b==="onQuery"){const T=v.value.map(L=>L.onQuery).filter(Boolean);return{servicePromise:wl(T,_[0])()}}else{const T=v.value.map(L=>{var O;return(O=L[b])===null||O===void 0?void 0:O.call(L,..._)});return Object.assign({},...T)}},C=I(0);return k.runAsync=async(...b)=>{S({loading:!0,params:b,status:"pending"}),C.value+=1;const _=C.value,{isBreak:T,breakResult:L=Ie()}=y("onBefore",b);if(T)return S({status:"settled"}),L;i==null||i(b);try{const O=()=>new Promise(x=>x(e(...m.value)));let{servicePromise:P}=y("onQuery",O);P||(P=O());const D=await P;return _!==C.value?Ie():(S({data:D,loading:!1,error:void 0,status:"settled"}),y("onSuccess",D,b),r==null||r(D,b),y("onAfter",b,D,void 0),u==null||u(b),D)}catch(O){if(_!==C.value)return Ie();throw S({loading:!1,error:O,status:"settled"}),y("onError",O,b),s==null||s(O,b),y("onAfter",b,void 0,O),u==null||u(b),O}},k.run=(...b)=>{k.runAsync(...b).catch(_=>{s||console.error(_)})},k.cancel=()=>{C.value+=1,S({loading:!1}),y("onCancel")},k.refresh=()=>{k.run(...m.value||[])},k.refreshAsync=()=>k.runAsync(...m.value||[]),k.mutate=b=>{const _=wt(b)?b(g.value):b,T=ul(_);S({data:T}),y("onMutate",T)},{status:h,loading:d,data:g,error:f,params:m,plugins:v,context:k}};function hl(e,o={},t){const l=we(al,{}),n={...sl(),...l,...o},{manual:a=!1,defaultParams:r=[]}=n,s=gl(e,n);if(s.plugins.value=t.map(i=>i(s,n)),!a){const i=s.params.value||r;s.context.run(...i)}return ke(()=>{s.context.cancel()}),{loading:s.loading,data:s.data,error:s.error,params:s.params,cancel:s.context.cancel,refresh:s.context.refresh,refreshAsync:s.context.refreshAsync,mutate:s.context.mutate,run:s.context.run,runAsync:s.context.runAsync}}const _e=new Map,kl=(e,o)=>{_e.set(e,o),o.then(t=>(_e.delete(e),t)).catch(()=>{_e.delete(e)})},Cl=e=>_e.get(e),de=new Map,Vl=(e,o)=>{de.has(e)&&de.get(e).forEach(t=>t(o))},$l=(e,o)=>(de.has(e)?de.get(e).push(o):de.set(e,[o]),()=>{const t=de.get(e).indexOf(o);de.get(e).splice(t,1)});var Dl=re((e,{cacheKey:o,cacheTime:t=6e5,staleTime:l=0,getCache:n,setCache:a})=>{if(!o)return{};const r=wt(o)?o:()=>o,s=I(()=>{});let i;const u=k=>n?n(k):cl(k),d=(k,S,y)=>{a?a(k,y):dl(k,S,y),Vl(k,y.data)},g=k=>l===-1||k+l>new Date().getTime(),f=(k,S)=>Object.prototype.hasOwnProperty.call(k,S),m=k=>{const S=r(k);return $l(S,y=>{e.data.value=y})},v=r(),h=u(v);return h&&f(h,"data")&&(e.data.value=h.data,e.params.value=h.params),v&&(s.value=m()),ke(()=>{s.value()}),{onBefore(k){const S=r(k),y=u(S);if(!y||!f(y,"data"))return{};if(g(y.time))return e.data.value=y.data,e.loading.value=!1,{isBreak:!0,breakResult:y.data};e.data.value=y.data},onQuery(k){const S=e.params.value,y=r(S);let C=Cl(y);return C&&C!==i?()=>C:(C=k(),i=C,kl(y,C),()=>C)},onSuccess(k,S){const y=r(S);y&&(s.value(),d(y,t,{data:k,params:S,time:new Date().getTime()}),s.value=m(S))},onMutate(k){const S=r(e.params.value);S&&(s.value(),d(S,t,{data:k,params:e.params.value,time:new Date().getTime()}),s.value=m(e.params.value))}}});function Tl(e){let o,t;class l extends Promise{constructor(a){super(a),this.cancel=()=>{t(),clearTimeout(o)}}}return new l(n=>{t=n,o=setTimeout(t,e)})}function Oe(){return new Date().getTime()}var Il=re((e,{loadingDelay:o=0,loadingKeep:t=0})=>{const l=I(()=>{}),n=R(()=>ee(o)),a=R(()=>ee(t));let r=0,s={};const i=()=>{let u;return n.value&&(u=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},n.value)),()=>u&&clearTimeout(u)};return{onBefore(){e.loading.value=!n.value,l.value(),l.value=i(),r=Oe()},onQuery(u){if(!a.value)return()=>u();s=Tl(a.value+n.value);const d=async()=>{try{const f=await u();return Oe()-r<=n.value&&s.cancel(),Promise.resolve(f)}catch(f){return Oe()-r<=n.value&&s.cancel(),Promise.reject(f)}},g=Promise.allSettled([d(),s]).then(f=>{const m=f[0];return m.status==="fulfilled"?m.value:Promise.reject(m.reason)});return()=>g},onCancel(){l.value()},onAfter(){l.value()}}}),Se;const kt=new Set,Ct=new Set,Vt=new Set,ge=(e,o)=>{let t;switch(e){case"FOCUS_LISTENER":t=kt;break;case"RECONNECT_LISTENER":t=Vt;break;case"VISIBLE_LISTENER":t=Ct;break}if(!t.has(o))return t.add(o),()=>{t.delete(o)}},Le=e=>{e.forEach(o=>{o()})};!Ke&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{gt()&&Le(Ct)},!1),window.addEventListener("focus",()=>Le(kt),!1),window.addEventListener("online",()=>Le(Vt),!1));var Ol=re((e,{pollingInterval:o,pollingWhenHidden:t=!1,pollingWhenOffline:l=!1,errorRetryCount:n=0})=>{const a=I(),r=I(!1),s=R(()=>ee(o)),i=R(()=>ee(n)),u=[],d=v=>{v&&u.push(v)},g=()=>(t||gt())&&(l||il()),f=v=>{if(e.error.value&&i.value!==0)return;let h;if(!ve(s.value)&&s.value>=0)if(g())h=setTimeout(v,s.value);else{r.value=!0;return}return()=>h&&clearTimeout(h)},m=()=>{r.value&&g()&&(e.context.refresh(),r.value=!1)};return le(s,()=>{a.value&&(a.value(),a.value=f(()=>e.context.refresh()))}),t||d(ge("VISIBLE_LISTENER",m)),l||d(ge("RECONNECT_LISTENER",m)),ke(()=>{u.forEach(v=>v())}),{onBefore(){var v;(v=a.value)===null||v===void 0||v.call(a)},onCancel(){var v;(v=a.value)===null||v===void 0||v.call(a)},onAfter(){a.value=f(()=>e.context.refresh())}}});const Sl=(e,o)=>{let t=!1;return(...l)=>{t||(t=!0,e(...l),setTimeout(()=>{t=!1},o))}};var Ll=re((e,{refreshOnWindowFocus:o=!1,refocusTimespan:t=5e3})=>{const l=R(()=>ee(o)),n=R(()=>ee(t)),a=[],r=i=>{i&&a.push(i)},s=()=>{a.forEach(i=>i())};return ne(()=>{if(s(),l.value){const i=Sl(e.context.refresh,n.value);r(ge("VISIBLE_LISTENER",i)),r(ge("FOCUS_LISTENER",i))}}),ke(()=>{s()}),{}});function fe(e,o){return hl(e,o,[Il,ml,pl,Ol,_l,Ll,yl,vl,Dl])}const E=ll.create();E.interceptors.response.use(e=>{const o=e.data;return o.code!==200?(X.error(o.msg),Promise.reject(o.msg)):o});var $t=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))($t||{}),ze=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(ze||{}),je=(e=>(e.不显示="false",e.审批人="assignee",e.抄送人="copyUser",e.意见="comment",e))(je||{}),Dt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Dt||{});function Tt(e){return E.get("/sapier-flow/dev-button/list",{params:e})}function It(){return fe(()=>Tt({size:-1,ascs:"sort"}).then(e=>e.data.records))}function El(e){return E.post("/sapier-flow/dev-button/save",e)}function Nl(e){return E.post("/sapier-flow/dev-button/update",e)}function Rl(e){return E.post("/sapier-flow/dev-button/remove",{},{params:{ids:e}})}const Pl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ie($t)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ie(ze),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示:始终显示;隐藏:始终隐藏;
      发起人:用户为发起人时显示;处理人:用户为处理人时显示;
      已办:任务状态为已办时显示;待办:任务状态为待办时显示;
      未发起:流程未发起时显示;已发起:流程已发起时显示;
      未办结:流程未办结时显示;已办结:流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ie(je),labelTip:"不显示:不显示审批窗口;审批人:显示审批人选择框;抄送人:显示抄送人选择框;意见:显示意见输入框;"},{label:"状态",prop:"status",type:"switch",value:1,dicData:ie(Dt)},{label:"排序",prop:"sort",type:"number",value:0},{label:"按钮预览",prop:"buttonPreview",width:200}]},xl=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l}=te({tableOption:Pl,crudOption:{getList:Tt,create:El,update:Nl,remove:Rl},sortOption:{ascs:"sort"}});return l(),(n,a)=>{const r=V("v-icon"),s=V("el-button"),i=V("avue-crud");return $(),N(i,ae(se(c(o))),{icon:p(({row:u})=>[w(r,{icon:u.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:p(({row:u})=>[w(s,{type:u.buttonType},{default:p(()=>[w(r,{icon:u.icon},null,8,["icon"]),F(" "+j(u.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":p(()=>[w(s,{type:c(t).buttonType},{default:p(()=>[w(r,{icon:c(t).icon},null,8,["icon"]),F(" "+j(c(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),We={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},Fl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...We.column,{label:"流程主版本",prop:"mainVersion",formatter(e,o){return o?`V${o||""}`:""}}]};function Ul(e){return E.get("/sapier-flow/flow-definition/list",{params:e})}function Ot(e){return E.get("/sapier-flow/flow-definition/detail",{params:e})}function Al(e){return E.post("/sapier-flow/flow-definition/save",e)}function Bl(e){return E.post("/sapier-flow/flow-definition/update",e)}function St(e){return E.post("/sapier-flow/flow-definition/deployFlow",e)}const Lt=K({__name:"index",props:{categoryId:null},emits:["add","view","edit","version"],setup(e,{emit:o}){const t=e,{bindVal:l,crudStateRefs:{searchForm:n},getDataList:a}=te({tableOption:Fl,crudOption:{getList:Ul},searchForm:{categoryId:t.categoryId}});ne(()=>{n.value.categoryId=t.categoryId??"",a()});const r=I(!1);async function s(i){await he.confirm("发布新版本，是否确认？","提示",{type:"success"}),r.value=!0,St({flowModuleId:i.flowModuleId}).then(()=>{X.success("发布成功"),a()}).finally(()=>{r.value=!1})}return(i,u)=>{const d=V("el-button"),g=V("v-icon"),f=V("avue-crud");return $(),N(f,ae(se(c(l))),{"menu-left":p(()=>[w(d,{type:"primary",icon:"el-icon-plus",onClick:u[0]||(u[0]=m=>o("add"))},{default:p(()=>[F(" 新增 ")]),_:1})]),menu:p(({row:m})=>[w(d,{loading:r.value,type:"text",icon:"el-icon-view",onClick:v=>o("view",m)},{default:p(()=>[F(" 查看 ")]),_:2},1032,["loading","onClick"]),w(d,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:v=>o("edit",m)},{default:p(()=>[F(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(d,{loading:r.value,type:"text",icon:"el-icon-upload",onClick:v=>s(m)},{default:p(()=>[F(" 发布 ")]),_:2},1032,["loading","onClick"]),w(d,{loading:r.value,type:"text",icon:"el-icon-switch",onClick:v=>o("version",m)},{default:p(()=>[F(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:p(({row:m})=>[w(g,{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Ml={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...We.column,{label:"流程版本",prop:"version",formatter(e,o){return o?`V${o||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]};var Et=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Et||{});function Kl(e){return E.get("/sapier-flow/flow-deploy/list",{params:e})}function Nt(e){return E.get("/sapier-flow/flow-deploy/detail",{params:e})}function Rt(e){return E.post("/sapier-flow/flow-deploy/update",e)}function zl(){return E.get("/sapier-flow/flow-run/queryPublishFlowList")}const Pt=K({__name:"index",props:{flowModuleId:null},emits:["back","view","edit"],setup(e,{emit:o}){const t=e,{bindVal:l,crudStateRefs:{searchForm:n},getDataList:a}=te({tableOption:Ml,crudOption:{getList:Kl,dataPath:"res.data"}});ne(()=>{t.flowModuleId&&(n.value.flowModuleId=t.flowModuleId,a())});const r=I(!1);async function s(i){await he.confirm(`确定将 ${i.flowName}(${i.flowKey}:v${i.version}) 设为主版本?`,"提示",{type:"warning"}),r.value=!0,Rt({flowDeployId:i.flowDeployId,flowModuleId:i.flowModuleId,mainVersion:1}).then(()=>{X.success("设置成功"),a()}).finally(()=>{r.value=!1})}return(i,u)=>{const d=V("el-button"),g=V("v-icon"),f=V("avue-crud");return $(),N(f,ae(se(c(l))),{"menu-left":p(()=>[w(d,{loading:r.value,type:"primary",icon:"el-icon-arrow-left",onClick:u[0]||(u[0]=m=>o("back"))},{default:p(()=>[F(" 返回 ")]),_:1},8,["loading"])]),menu:p(({row:m})=>[w(d,{loading:r.value,type:"text",icon:"el-icon-view",onClick:v=>o("view",m)},{default:p(()=>[F(" 查看 ")]),_:2},1032,["loading","onClick"]),w(d,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:v=>o("edit",m)},{default:p(()=>[F(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(d,{loading:r.value,disabled:m.mainVersion===c(Et).是,type:"text",icon:"el-icon-switch",onClick:v=>s(m)},{default:p(()=>[F(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:p(({row:m})=>[w(g,{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}});function jl(e){return E.get("/sapier-flow/flow-category/list",{params:e})}function Wl(e){return E.post("/sapier-flow/flow-category/save",e)}function Hl(e){return E.post("/sapier-flow/flow-category/update",e)}function Ql(e){return E.post("/sapier-flow/flow-category/remove",{},{params:{ids:e}})}const Ze={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},ql=K({__name:"index",emits:["node-click"],setup(e,{emit:o}){const t={rowKey:"id",getList:jl,create:Wl,update:Hl,remove:Ql,dataPath:"res.data"},{crudStateRefs:{formData:l,tableData:n},getDataList:a,handleSave:r,handleUpdate:s,handleDel:i}=te({crudOption:t,tableOption:Ze,pageOption:{pageSize:20},mockCache:"flow-category"});a();function u(f,m,v,h){r(m,v,h)}function d(f,m,v,h){s(m,NaN,v,h)}async function g(f,m){await i(f.data,NaN),m()}return(f,m)=>{const v=V("avue-tree");return $(),N(v,{modelValue:c(l),"onUpdate:modelValue":m[0]||(m[0]=h=>q(l)?l.value=h:null),option:c(Ze),data:c(n),onNodeClick:m[1]||(m[1]=h=>o("node-click",h)),onSave:u,onUpdate:d,onDel:g},null,8,["modelValue","option","data"])}}}),He=K({__name:"index",props:{modelValue:null,view:{type:Boolean},fields:null},emits:["update:modelValue"],setup(e,{emit:o}){var s;const t=e,l=R({get(){return t.modelValue?ft(t.modelValue):{menuBtn:!1,span:24}},set(i){o("update:modelValue",Do(i,{useJson5:!1}))}}),n=R(()=>t.fields?JSON.parse(t.fields):[]),a=R(()=>{const i={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...i,props:{label:"name",value:"name",desc:"comment"}},{...i,props:{label:"comment",value:"comment",desc:"name"}}]}),r={form:{settings:Array.from({length:((s=Vo.settings)==null?void 0:s.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(i,u)=>{const d=V("avue-form");return e.view?($(),N(d,{key:0,class:J(c(l).class),"model-value":{},option:c(l)},null,8,["class","option"])):($(),N(c($o),{key:1,modelValue:c(l),"onUpdate:modelValue":u[0]||(u[0]=g=>q(l)?l.value=g:null),"base-option":c(a),resources:r},null,8,["modelValue","base-option"]))}}});function Jl(e){return E.get("/sapier-flow/flow-param/list",{params:e})}function Gl(e){return E.get("/sapier-flow/flow-param/getParam",{params:{paramKey:e}})}function Qe(e){return fe(()=>Gl(e).then(o=>o.data))}function Yl(e){return E.post("/sapier-flow/flow-param/save",e)}function Zl(e){return E.post("/sapier-flow/flow-param/update",e)}function Xl(e){return E.post("/sapier-flow/flow-param/remove",{},{params:{ids:e}})}const en=Eo;function tn(e){return E.get("/sapier-flow/flow-user/tree",{params:{filter:e}})}const on=K({__name:"assignee-setter",props:{modelValue:null,tableData:null},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,l=R({get(){return typeof t.modelValue=="string"?t.modelValue?t.modelValue.split(","):[]:t.modelValue},set(i){o("update:modelValue",i.join(","))}}),n=R({get(){return Array.isArray(t.modelValue)?t.modelValue.join(","):t.modelValue},set(i){o("update:modelValue",i)}}),a=I([]),r=I(!1),s=R(()=>{var i,u;return(u=(i=t.tableData)==null?void 0:i.row)==null?void 0:u.type});return le(s,i=>{["dept","post","user"].includes(i)&&(r.value=!0,tn(i==="user"?"":i).then(u=>{a.value=pt(u.data,d=>({label:d.title,value:d.id}))}).finally(()=>r.value=!1))},{immediate:!0}),(i,u)=>{const d=V("el-tree-select"),g=V("el-input");return["dept","post","user"].includes(c(s))?($(),N(d,{key:0,modelValue:c(l),"onUpdate:modelValue":u[0]||(u[0]=f=>q(l)?l.value=f:null),data:a.value,loading:r.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):($(),N(g,{key:1,modelValue:c(n),"onUpdate:modelValue":u[1]||(u[1]=f=>q(n)?n.value=f:null)},null,8,["modelValue"]))}}}),ln={key:0,class:"flow-viewer"},nn={class:"flow-status-legend"},an=K({__name:"index",props:{modelValue:null,view:{type:Boolean},flowFormOption:null,flowHistory:null},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,l=I({}),n=I({}),a=R({get(){let y=Lo();return typeof t.modelValue=="string"&&t.modelValue?y=JSON.parse(t.modelValue):typeof t.modelValue=="object"&&Object.keys(t.modelValue)&&(y=t.modelValue),y},set(y){o("update:modelValue",JSON.stringify(y))}}),r=R(()=>{const{column:y=[],group:C=[]}=JSON.parse(t.flowFormOption||"{}");return[...y,...C.map(_=>_.column??[]).flat()]}),s=R(()=>r.value.map(C=>({label:C.label,value:`\${${C.prop}}`,desc:`\${${C.prop}}`}))),i=ie(ze),u=ie(je),{data:d}=It();le(n,y=>{var C,b,_,T,L;y&&(y.priority&&(y.priority.dicData=s.value),y.formTitle&&(y.formTitle.dicData=s.value),(_=(b=(C=y.assignee)==null?void 0:C.children)==null?void 0:b.column)!=null&&_[1]&&(y.assignee.children.column[1].component=on),y.formProperty&&(l.value.formProperty=g(r.value,l.value.formProperty||[])),y.button&&((L=(T=y.button.children)==null?void 0:T.column)==null||L.forEach(O=>{O.prop==="display"&&(O.dicData=i),O.prop==="approval"&&(O.dicData=u)}),l.value.button=f(d.value||[],l.value.button||[])))});function g(y,C){return y.map(b=>{var Q,z;const _=C.find(ce=>ce.prop===b.prop),{label:T,prop:L,display:O=!0,disabled:P=!1,detail:D=!1,readonly:x=!1,rules:U}=b,W=(U==null?void 0:U.some(ce=>ce.required))??!1,A={label:T,prop:L,display:O,disabled:P,detail:D,readonly:x,required:W,..._};return b.type==="dynamic"&&((z=(Q=b.children)==null?void 0:Q.column)!=null&&z.length)&&(A.children=g(b.children.column,(_==null?void 0:_.children)??[])),A})}function f(y,C){return y.filter(b=>b.status===1).map(b=>{const _=C.find(x=>x.buttonKey===b.buttonKey),{name:T,buttonKey:L,display:O,approval:P}=b;return{name:T,buttonKey:L,display:O,approval:P,..._}})}const{data:m}=Qe("flow.task.status"),v=R(()=>{var y;return(y=t.flowHistory)==null?void 0:y.map(C=>{var _,T;const b=(T=(_=m.value)==null?void 0:_.find(L=>L.value===C.status))==null?void 0:T.style;return{id:C.taskNodeKey,style:b}})}),h=R(()=>{var y,C;return(C=(y=t.flowHistory)==null?void 0:y.filter(b=>b.taskNodeType==="userTask"))==null?void 0:C.map(b=>{var _;return{id:b.taskNodeKey,content:`<div>${b.assigneeName}</div>
        <div>${b.endTime??""}</div>
        <div>${((_=b.comment)==null?void 0:_.comment)??""}</div>`}})});function k(){var y,C;(C=(y=a.value)==null?void 0:y.flowElementList)==null||C.forEach(b=>{var _;(_=b.properties)!=null&&_.button&&(b.properties.button=f(d.value||[],[]))}),a.value={...a.value}}function S(){var y,C;(C=(y=a.value)==null?void 0:y.flowElementList)==null||C.forEach(b=>{var _;(_=b.properties)!=null&&_.formProperty&&(b.properties.formProperty=g(r.value,[]))}),a.value={...a.value}}return(y,C)=>{const b=V("el-button");return e.view?($(),B("div",ln,[H("div",nn,[($(!0),B(Y,null,ue(c(m),_=>{var T;return $(),B("div",{key:_.label,class:"legend-item"},[H("div",{class:"legend-color",style:Fe({backgroundColor:(T=_.style)==null?void 0:T.fill})},null,4),H("span",null,j(_.label),1)])}),128))]),w(c(Oo),{"model-value":c(a),styles:c(v),tooltips:c(h)},null,8,["model-value","styles","tooltips"])])):($(),N(c(So),{key:1,modelValue:c(a),"onUpdate:modelValue":C[0]||(C[0]=_=>q(a)?a.value=_:null),formData:l.value,"onUpdate:formData":C[1]||(C[1]=_=>l.value=_),formDefaults:n.value,"onUpdate:formDefaults":C[2]||(C[2]=_=>n.value=_),"form-options":c(en),"form-width":"30%"},{"form-top":p(()=>[w(b,{type:"default",onClick:k},{default:p(()=>[F(" 重置所有按钮配置 ")]),_:1}),w(b,{type:"default",onClick:S},{default:p(()=>[F(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const Ve=Ae(an,[["__scopeId","data-v-0e1bbf9e"]]);function xt(e){return E.get("/sapier-flow/dev-form/list",{params:e})}function sn(){return fe(()=>xt({size:-1}).then(e=>e.data.records))}function rn(e){return E.post("/sapier-flow/dev-form/submit",e)}function un(e){return E.post("/sapier-flow/dev-form/submit",e)}function cn(e){return E.post("/sapier-flow/dev-form/remove",{},{params:{ids:e}})}function Ft(e){return E.get("/sapier-flow/dev-flow/list",{params:e})}function dn(){return fe(()=>Ft({size:-1}).then(e=>e.data.records))}function fn(e){return E.post("/sapier-flow/dev-flow/submit",e)}function pn(e){return E.post("/sapier-flow/dev-flow/submit",e)}function mn(e){return E.post("/sapier-flow/dev-flow/remove",{},{params:{ids:e}})}var Ut=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ut||{});function At(e){return E.get("/sapier-flow/dev-table/list",{params:e})}function vn(){return fe(()=>At({size:-1}).then(e=>e.data.records))}function yn(e){return E.post("/sapier-flow/dev-table/save",e)}function _n(e){return E.post("/sapier-flow/dev-table/update",e)}function bn(e){return E.post("/sapier-flow/dev-table/remove",{},{params:{ids:e}})}function wn(e){return E.post("/sapier-flow/dev-table/deploy",e)}function qe(e){return new Promise((o,t)=>{(q(e)?e.value:e).validate((n,a,r)=>{n?(a(),o(r)):t(r)})})}const gn=H("span",null,"流程设计",-1),hn={key:0},kn={key:1},Cn={style:{height:"calc(100vh - 144px)"}},Vn=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},emits:["close"],setup(e,{emit:o}){const l=Ce(e),{visible:n,modelValue:a}=l,r=["流程信息","表单设计","模型设计","完成"],s=I(!1);le(n,async C=>{if(!C)return;const{flowModuleId:b}=a.value,{flowDeployId:_}=a.value;try{s.value=!0;let T={};_?T=await Nt({flowDeployId:_}):b&&(T=await Ot({flowModuleId:b})),a.value=T.data}finally{s.value=!1}},{immediate:!0});const{data:i}=sn(),{data:u}=dn(),{data:d}=vn(),g=R(()=>{var C,b;return(b=(C=d.value)==null?void 0:C.find(_=>_.tableName===a.value.formDataTable))==null?void 0:b.tableFields}),f=I(0),m=R(()=>{var C,b;return f.value===1?((C=i.value)==null?void 0:C.map(_=>({label:_.formName,value:_.formOption})))??[]:f.value===2?((b=u.value)==null?void 0:b.map(_=>({label:_.flowName,value:_.flowData})))??[]:[]});function v(C){f.value===1?a.value.formOption=C.value:f.value===2&&(a.value.flowData=C.value)}const h=I();async function k(C){f.value===0&&await qe(h),s.value=!0;const{flowModuleId:b}=a.value,{flowDeployId:_}=a.value;try{_?await Rt(a.value):b?await Bl(a.value):await Al(a.value).then(T=>{a.value.flowModuleId=T.data.flowModuleId}),X.success("保存成功")}finally{s.value=!1}typeof C=="number"?f.value=C:f.value++}async function S(){await he.confirm("发布新版本，是否确认？","提示"),s.value=!0,St({flowModuleId:a.value.flowModuleId}).then(()=>{X.success("发布成功")}).finally(()=>{s.value=!1})}function y(){n.value=!1,f.value=0,a.value={},o("close")}return(C,b)=>{const _=V("el-link"),T=V("el-dropdown-item"),L=V("el-dropdown-menu"),O=V("el-dropdown"),P=V("el-col"),D=V("el-step"),x=V("el-steps"),U=V("el-button"),W=V("el-row"),A=V("avue-form"),Q=V("el-result"),z=V("el-dialog"),ce=Be("loading");return $(),N(z,{modelValue:c(n),"onUpdate:modelValue":b[4]||(b[4]=G=>q(n)?n.value=G:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:y},{header:p(()=>[w(W,{align:"center",justify:"center"},{default:p(()=>[w(P,{span:5},{default:p(()=>{var G,pe,$e,Je;return[H("div",null,[gn,(G=c(a))!=null&&G.flowName?($(),B("span",hn," - "+j((pe=c(a))==null?void 0:pe.flowName),1)):M("",!0),($e=c(a))!=null&&$e.version?($(),B("span",kn," - V"+j((Je=c(a))==null?void 0:Je.version),1)):M("",!0)]),c(m).length?($(),N(O,{key:0},{dropdown:p(()=>[w(L,null,{default:p(()=>[($(!0),B(Y,null,ue(c(m),De=>($(),N(T,{key:De.label,onClick:Ca=>v(De)},{default:p(()=>[F(j(De.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:p(()=>[w(_,{icon:"el-icon-arrow-down",underline:!1},{default:p(()=>[F(" 选择模板 ")]),_:1})]),_:1})):M("",!0)]}),_:1}),w(P,{span:14},{default:p(()=>[w(x,{active:f.value,simple:"","process-status":"finish","finish-status":"success"},{default:p(()=>[($(),B(Y,null,ue(r,(G,pe)=>w(D,{key:pe,title:G,onClick:$e=>k(pe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),w(P,{span:5,style:{"text-align":"right"}},{default:p(()=>[w(U,{disabled:f.value===0,loading:s.value,type:"primary",onClick:b[0]||(b[0]=G=>f.value--)},{default:p(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),w(U,{disabled:f.value===r.length-1,type:"primary",loading:s.value,onClick:k},{default:p(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),w(U,{onClick:y},{default:p(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:p(()=>[me(($(),B("div",Cn,[f.value===0?($(),N(A,{key:0,ref_key:"formRef",ref:h,modelValue:c(a),"onUpdate:modelValue":b[1]||(b[1]=G=>q(a)?a.value=G:null),option:c(We),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):M("",!0),f.value===1?($(),N(He,{key:1,modelValue:c(a).formOption,"onUpdate:modelValue":b[2]||(b[2]=G=>c(a).formOption=G),fields:c(g)},null,8,["modelValue","fields"])):M("",!0),f.value===2?($(),N(Ve,{key:2,modelValue:c(a).flowData,"onUpdate:modelValue":b[3]||(b[3]=G=>c(a).flowData=G),"flow-form-option":c(a).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),f.value===3?($(),N(Q,{key:3,icon:"success",title:"流程设计完成"},{extra:p(()=>[c(a).flowDeployId?M("",!0):($(),N(U,{key:0,type:"primary",onClick:S},{default:p(()=>[F(" 发布 ")]),_:1})),w(U,{onClick:y},{default:p(()=>[F(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[ce,s.value]])]),_:1},8,["modelValue"])}}}),$n=H("span",null,"流程查看",-1),Dn={key:0},Tn={key:1},In=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},setup(e){const t=Ce(e),{visible:l,modelValue:n}=t,a=I("form"),r=I(!1);le(l,async i=>{if(!i)return;const{flowModuleId:u}=n.value,{flowDeployId:d}=n.value;try{r.value=!0;let g={};d?g=await Nt({flowDeployId:d}):u&&(g=await Ot({flowModuleId:u})),n.value={...g.data}}finally{r.value=!1}},{immediate:!0});function s(){n.value={},a.value="form"}return(i,u)=>{const d=V("el-tab-pane"),g=V("el-tabs"),f=V("el-dialog"),m=Be("loading");return $(),N(f,{modelValue:c(l),"onUpdate:modelValue":u[3]||(u[3]=v=>q(l)?l.value=v:null),width:"60%",top:"0",onClose:s},{header:p(()=>{var v,h,k,S;return[$n,(v=c(n))!=null&&v.flowName?($(),B("span",Dn," - "+j((h=c(n))==null?void 0:h.flowName),1)):M("",!0),(k=c(n))!=null&&k.version?($(),B("span",Tn," - V"+j((S=c(n))==null?void 0:S.version),1)):M("",!0)]}),default:p(()=>[me(($(),N(g,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=v=>a.value=v)},{default:p(()=>[w(d,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:p(()=>[a.value==="form"&&c(n).formOption?($(),N(He,{key:0,modelValue:c(n).formOption,"onUpdate:modelValue":u[0]||(u[0]=v=>c(n).formOption=v),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),w(d,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:p(()=>[a.value==="flow"?($(),N(Ve,{key:0,modelValue:c(n).flowData,"onUpdate:modelValue":u[1]||(u[1]=v=>c(n).flowData=v),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[m,r.value]])]),_:1},8,["modelValue"])}}}),On=K({__name:"index",setup(e){const o=I("definition"),t=I({}),l=I(""),n=I("");function a(v){l.value===v.id?l.value="":l.value=v.id}const r=I(!1),s=I(!1);function i(){t.value={},r.value=!0}function u(v){t.value=v,r.value=!0}function d(v){t.value=v,s.value=!0}function g(v){n.value=v.flowModuleId||"",o.value="deploy"}function f(){n.value="",o.value="definition"}async function m(){const v=o.value;await oe(),o.value="",await oe(),o.value=`${v}`}return(v,h)=>{const k=V("el-col"),S=V("el-row");return $(),N(S,{gutter:20},{default:p(()=>[w(k,{span:4},{default:p(()=>[w(ql,{onNodeClick:a})]),_:1}),w(k,{span:20},{default:p(()=>[o.value==="definition"?($(),N(Lt,{key:0,"category-id":l.value,onAdd:i,onEdit:u,onView:d,onVersion:g},null,8,["category-id"])):M("",!0),o.value==="deploy"?($(),N(Pt,{key:1,"flow-module-id":n.value,onEdit:u,onView:d,onBack:f},null,8,["flow-module-id"])):M("",!0),w(Vn,{modelValue:t.value,"onUpdate:modelValue":h[0]||(h[0]=y=>t.value=y),visible:r.value,"onUpdate:visible":h[1]||(h[1]=y=>r.value=y),onClose:m},null,8,["modelValue","visible"]),w(In,{modelValue:t.value,"onUpdate:modelValue":h[2]||(h[2]=y=>t.value=y),visible:s.value,"onUpdate:visible":h[3]||(h[3]=y=>s.value=y)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Sn={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]};function Ln(e){return E.get("/sapier-flow/flow-ops/list",{params:e})}function En(e){return E.get("/sapier-flow/flow-run/userTaskList",{params:e})}function Nn(e){return E.get("/sapier-flow/flow-run/queryPublishFlowDetail",{params:e})}function Rn(e){return E.post("/sapier-flow/flow-run/queryApprovalNode",e)}function Pn(e){return E.post("/sapier-flow/flow-run/startProcess",e)}function xn(e){return E.post("/sapier-flow/flow-run/commitTask",e)}function Fn(e){return E.post("/sapier-flow/flow-run/saveDraft",e)}function Un(e){return E.post("/sapier-flow/flow-run/revokeTask",e)}function An(e){const{flowDetail:o,formVariables:t,approvalFormData:l,debug:n}=e,{flowDeployId:a}=o.value.process??{},{taskId:r,flowInstanceId:s}=o.value.task??{},i={flowDeployId:a,taskId:r,flowInstanceId:s,variables:t.value,debug:n.value,...l.value};return{flow_draft(){if(r&&s)return Fn(i)},flow_pass(){return r&&s?xn(i):Pn(i)},flow_revoke(){if(r&&s)return Un(i)}}}function Bn(e){const o=I({});return ne(async()=>{const t=q(e)?e.value:e,{formProperty:l}=(t==null?void 0:t.properties)||{};l!=null&&l.length&&(await oe(),Object.keys(o.value).forEach(n=>{var s,i,u,d;const a=((s=o.value[n])==null?void 0:s.label)||"",r=l==null?void 0:l.find(g=>g.prop===n);if(o.value[n].display=r==null?void 0:r.display,o.value[n].disabled=r==null?void 0:r.disabled,o.value[n].detail=r==null?void 0:r.detail,o.value[n].readonly=r==null?void 0:r.readonly,o.value[n].rules=o.value[n].rules??[],r!=null&&r.required&&((i=o.value[n].rules)!=null&&i.some(g=>g.required)))return null;r!=null&&r.required?(u=o.value[n].rules)==null||u.push({required:!0,message:`${a}为必填项`}):o.value[n].rules=(d=o.value[n].rules)==null?void 0:d.filter(g=>!g.required)}))}),o}function Mn(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Kn(){return{complete:e=>e}}const Bt=Symbol("flowFormState");function zn(e,o){const t=Ce(e,void 0,{passive:!0,deep:!0}),{flowDetail:l,modelValue:n,formLoading:a}=t;ne(()=>{const{flowKey:f,taskId:m,instanceId:v}=e;!f&&!m&&!v||(a.value=!0,Nn({flowKey:f,taskId:m,flowInstanceId:v}).then(h=>{l.value=h.data,n.value=h.data.formData||{}}).finally(()=>{a.value=!1}))});const r=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),s=R(()=>{var f,m,v,h;return r.value.fileTab===!0&&((h=(v=(m=(f=l.value)==null?void 0:f.properties)==null?void 0:m.formProperty)==null?void 0:v.find(k=>k.prop==="fileTab"))==null?void 0:h.display)}),i=R(()=>{var f,m,v,h;return r.value.trackTab===!0&&((h=(v=(m=(f=l.value)==null?void 0:f.properties)==null?void 0:m.formProperty)==null?void 0:v.find(k=>k.prop==="trackTab"))==null?void 0:h.display)}),u=I(!1),d=R(()=>Object.entries(n.value||{}).filter(([f])=>!f.startsWith("$")).map(([f,m])=>({key:f,value:m}))),g={...t,formData:n,formVariables:d,approvalVisible:u,showFileTab:s,showTrackTab:i,permission:r,emit:o};return rt(Bt,g),g}function Mt(){return we(Bt)}const jn=K({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:o}=Ce(e,void 0,{passive:!0,deep:!0}),t=Bn(e.flowDetail),{proxy:l}=Ue(),n=I({});ne(()=>{const{formOption:s}=e.flowDetail.process??{};n.value=ft.bind(l)(s||'{"menuBtn":false}'),n.value.detail=!!e.detail});const a=I();function r(){return qe(a)}return{form:o,option:n,defaults:t,formRef:a,validate:r}},render(){return Ne(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}});function Wn(e){return E.get("/sapier-flow/flow-user-common/list",{params:{type:e,ascs:"sort"}})}function Hn(e){return fe(()=>Wn(e.value).then(o=>o.data.records),{refreshDeps:[e]})}function Qn(e){return E.post("/sapier-flow/flow-user-common/save",e)}function qn(e){return E.post("/sapier-flow/flow-user-common/remove",{},{params:{ids:e}})}function Jn(e){return E.post("/sapier-flow/flow-user-common/batchUpdate",e)}const Gn=K({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const t=ko(e,"modelValue"),l=I(!1),{activeBtn:n}=Mt(),a=R(()=>{var h;return(h=n.value)==null?void 0:h.buttonKey}),{data:r,refresh:s}=Hn(a),i=R(()=>{var k,S,y;const h=t.value;if(h&&!((k=r.value)!=null&&k.some(C=>C.content===h))){const C=(((y=(S=r.value)==null?void 0:S[0])==null?void 0:y.sort)||1)-1;return[{content:h,sort:C},...r.value||[]]}return r.value});async function u(h){var k;await Qn({...h,type:(k=n.value)==null?void 0:k.buttonKey}),X.success("添加成功"),s()}async function d(h){await qn(h.id),X.success("删除成功"),s()}async function g(h,k){let S=k.parent.data;S=S.map((y,C)=>({id:y.id,sort:C+1})),await Jn(S),X.success("修改排序成功"),s(),l.value=!1}function f(){l.value=!0}const m=I();async function v(h){var k;t.value=h.content,await oe(),(k=m.value)==null||k.blur()}return(h,k)=>{const S=V("el-input"),y=V("el-text"),C=V("el-col"),b=V("el-button"),_=V("el-row"),T=V("el-tree"),L=V("el-popover");return $(),N(L,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:p(()=>[w(S,{ref_key:"inputRef",ref:m,modelValue:c(t),"onUpdate:modelValue":k[0]||(k[0]=O=>q(t)?t.value=O:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:k[1]||(k[1]=O=>l.value=!0),onBlur:k[2]||(k[2]=O=>l.value=!1)},null,8,["modelValue"])]),default:p(()=>[w(T,{data:c(i),"node-key":"content",draggable:"","allow-drop":(O,P,D)=>D!=="inner",props:{label:"content"},onNodeClick:v,onNodeDrop:g,onNodeDragStart:f},{default:p(({data:O})=>[w(_,{style:{width:"250px"}},{default:p(()=>[w(C,{span:20},{default:p(()=>[w(y,{truncated:"",title:O.content},{default:p(()=>[F(j(O.content),1)]),_:2},1032,["title"])]),_:2},1024),w(C,{span:4},{default:p(()=>[O.id?($(),N(b,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Ee(P=>d(O),["stop"])},null,8,["onClick"])):($(),N(b,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Ee(P=>u(O),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Yn=K({__name:"approval-form",emits:["confirm"],setup(e,{emit:o}){const t={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:l,approvalFormData:n,activeBtn:a,approvalVisible:r,formVariables:s,flowDetail:i}=Mt(),u=I([]),d=I([]),g=I(),f=I({}),m={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:v}]},{label:"抄送人",prop:"copyUser",span:24,rules:[{required:!0,message:"请选择抄送人"}]},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function v(T,L,O){var x;const P=u.value[0].type==="ParallelGateway",D=(x=u.value[0].children)==null?void 0:x.every(U=>To([U],W=>d.value.some(A=>A.id===W.id)));if(d.value.length){if(P&&!D)return O("请在每个节点选择审批人")}else return O("请选择审批人");return!0}const h=I(),k=R(()=>{var T,L;return(L=(T=a.value)==null?void 0:T.approval)==null?void 0:L.includes("assignee")}),S=I(!1),y=I(!1);ne(async()=>{var P,D,x;if(!r.value||!g.value)return;const{flowKey:T}=((P=i.value)==null?void 0:P.process)||{},{taskId:L}=((D=i.value)==null?void 0:D.task)||{};u.value=[],d.value=[];const O=L?"":"发起";if(n.value={assignee:{},outgoing:[],comment:l.value.comment||O},oe(()=>{var U,W,A,Q;f.value.assignee.display=k.value,f.value.copyUser.display=(W=(U=a.value)==null?void 0:U.approval)==null?void 0:W.includes("copyUser"),f.value.comment.display=(Q=(A=a.value)==null?void 0:A.approval)==null?void 0:Q.includes("comment")}),k.value)try{y.value=!0;const U=await Rn({flowKey:T,variables:s.value,taskId:L});u.value=pt(U.data??[],(A,Q,z)=>{const ce=A.id||lo();return A.taskNodeKey=(z==null?void 0:z.taskNodeKey)??A.taskNodeKey,A.incoming=(z==null?void 0:z.incoming)??A.incoming,{...A,id:ce,disabled:A.type!=="user"}}),await oe();const W=C(u.value);W&&((x=h.value)==null||x.setCheckedNodes([W]))}finally{y.value=!1}});function C(T){var L;if(T.length===1)return(L=T[0].children)!=null&&L.length?C(T[0].children):T[0]}async function b(T,L){var P,D;if(T.type!=="user")return;await oe(),await oe();const O=(P=h.value)==null?void 0:P.getCheckedNodes();d.value=O.filter(x=>x.type==="user"),(D=h.value)==null||D.setCheckedNodes(d.value)}async function _(){await qe(g),S.value=!0;const T={},L={},O=new Set;d.value.forEach(P=>{const{taskNodeKey:D,incoming:x}=P;T[D]||(T[D]=new Set),P.userId&&T[D].add(P.userId),L[D]=[...T[D]].join(","),O.add(x)}),n.value.assignee=L,n.value.outgoing=[...O],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",l),o("confirm")}return(T,L)=>{const O=V("v-icon"),P=V("el-col"),D=V("el-tag"),x=V("avue-form"),U=V("el-row"),W=V("el-button"),A=V("el-dialog"),Q=Be("loading");return $(),N(A,{modelValue:c(r),"onUpdate:modelValue":L[4]||(L[4]=z=>q(r)?r.value=z:null),title:c(a).name,width:c(k)?"800px":"500px","append-to-body":""},{footer:p(()=>[w(W,{onClick:L[3]||(L[3]=z=>r.value=!1)},{default:p(()=>[F(" 取 消 ")]),_:1}),w(W,{type:"primary",onClick:_},{default:p(()=>[F(" 确 定 ")]),_:1})]),default:p(()=>[w(U,{gutter:20},{default:p(()=>[c(k)?($(),N(P,{key:0,span:10},{default:p(()=>[me(($(),N(c(Io),{ref_key:"treeRef",ref:h,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:u.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:b},{default:p(({data:z})=>[H("div",null,[w(O,{icon:t[z.type],style:{display:"inline-block"}},null,8,["icon"]),H("span",null,j(z.title),1)])]),_:1},8,["data"])),[[Q,y.value]])]),_:1})):M("",!0),w(P,{span:c(k)?14:24},{default:p(()=>[w(x,{ref_key:"formRef",ref:g,modelValue:c(n),"onUpdate:modelValue":L[1]||(L[1]=z=>q(n)?n.value=z:null),defaults:f.value,"onUpdate:defaults":L[2]||(L[2]=z=>f.value=z),option:m},{assignee:p(()=>[($(!0),B(Y,null,ue(d.value,z=>($(),N(D,{key:z.id,type:"info"},{default:p(()=>[F(j(z.title),1)]),_:2},1024))),128))]),copyUser:p(()=>[]),comment:p(()=>[w(Gn,{modelValue:c(n).comment,"onUpdate:modelValue":L[0]||(L[0]=z=>c(n).comment=z)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Zn={class:"flow-track"},Xn={key:0},ea={key:1},ta=K({__name:"flow-track",props:{flowDetail:null},setup(e){const o=e,t=I("table"),l=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=R(()=>{var i,u,d;return((d=(u=(i=o.flowDetail)==null?void 0:i.flowHistory)==null?void 0:u.filter(g=>g.taskNodeType==="userTask"))==null?void 0:d.map(g=>({...g,duration:no(g.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:r}=Qe("flow.handle.type");function s(i){var u;return(u=r.value)==null?void 0:u.find(d=>d.value===i)}return(i,u)=>{var y,C,b;const d=V("v-icon"),g=V("el-radio-button"),f=V("el-radio-group"),m=V("avue-crud"),v=V("el-card"),h=V("el-timeline-item"),k=V("el-timeline"),S=V("el-empty");return $(),B(Y,null,[w(f,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=_=>t.value=_)},{default:p(()=>[($(),B(Y,null,ue(l,_=>w(g,{key:_.label,label:_.label},{default:p(()=>[w(d,{icon:_.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),H("div",Zn,[t.value==="table"?($(),N(m,{key:0,data:c(n),option:a},null,8,["data"])):M("",!0),t.value==="graph"?($(),N(Ve,{key:1,"model-value":(C=(y=e.flowDetail)==null?void 0:y.process)==null?void 0:C.flowData,"flow-history":(b=e.flowDetail)==null?void 0:b.flowHistory,view:""},null,8,["model-value","flow-history"])):M("",!0),t.value==="timeline"?($(),B(Y,{key:2},[c(n).length?($(),N(k,{key:0},{default:p(()=>[($(!0),B(Y,null,ue([...c(n)].reverse(),_=>($(),N(h,{key:_.id,timestamp:_.endTime,placement:"top"},{default:p(()=>[w(v,null,{default:p(()=>{var T,L,O;return[H("div",null,j(_.assigneeName)+" 开始处理 ["+j(_.taskNodeName)+"] 环节 ",1),_.duration?($(),B("div",Xn," 办理时长："+j(_.duration),1)):M("",!0),_.type&&((T=_.comment)!=null&&T.comment)?($(),B("div",ea,j((L=s(_.type))==null?void 0:L.label)+"意见："+j((O=_.comment)==null?void 0:O.comment),1)):M("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):($(),N(S,{key:1}))],64)):M("",!0)])],64)}}});const oa=Ae(ta,[["__scopeId","data-v-3ea86146"]]),la=K({__name:"button-list",props:{flowDetail:null},emits:["click"],setup(e,{emit:o}){const t=e,{data:l}=It();function n(r,s){return r.map(i=>{const u=s.find(g=>g.buttonKey===i.buttonKey);return{...i,...No(u,["display","approval"])}})}const a=R(()=>{var v,h,k,S,y;const r={userId:"1"},{assignee:s,status:i}=((v=t.flowDetail)==null?void 0:v.task)||{},{createUser:u,flowInstanceId:d,status:g}=((h=t.flowDetail)==null?void 0:h.flowInstance)||{},f={true:!0,false:!1,startUser:u==r.userId,assignee:s==r.userId,todo:i==2,done:i==1,notstarted:!d,started:!!d,finished:g===1,unfinished:g===2};return((y=n(l.value??[],((S=(k=t.flowDetail)==null?void 0:k.properties)==null?void 0:S.button)??[]))==null?void 0:y.filter(C=>{var b,_;return(_=(b=C.display)==null?void 0:b.split(","))==null?void 0:_.every(T=>f[T])}))??[]});return(r,s)=>{const i=V("v-icon"),u=V("el-button");return $(!0),B(Y,null,ue(c(a),d=>($(),N(u,{key:d.buttonKey,type:d.buttonType,onClick:g=>o("click",d)},{default:p(()=>[w(i,{icon:d.icon},null,8,["icon"]),F(" "+j(d.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),na={class:"flow-form__title"},Kt=K({__name:"index",props:Mn(),emits:Kn(),setup(e,{emit:o}){const t=e,l=zn(t,o),{flowDetail:n,modelValue:a,activeTab:r,activeBtn:s,formLoading:i,approvalVisible:u,submitLoading:d}=l,g=I();async function f(v){var h,k;s.value=v,await((h=g.value)==null?void 0:h.validate()),await((k=t.beforeClick)==null?void 0:k.call(t,v)),(v==null?void 0:v.approval)!=="false"?u.value=!0:m()}async function m(){var h,k;const v=An(l);try{const{buttonKey:S}=s.value;d.value=!0,await((h=t.beforeSubmit)==null?void 0:h.call(t,s.value)),await((k=v[S])==null?void 0:k.call(v)),X.success("操作成功"),u.value=!1,o("complete",s.value)}finally{d.value=!1}}return(v,h)=>{const k=V("el-skeleton"),S=V("el-main"),y=V("el-header"),C=V("el-tab-pane"),b=V("el-tabs"),_=V("el-container");return c(i)?($(),N(S,{key:0},{default:p(()=>[w(k)]),_:1})):($(),N(_,{key:1,class:"flow-form"},{default:p(()=>[w(y,{class:"flow-form__header"},{default:p(()=>{var T;return[H("div",na,j((T=c(n).flowInstance)==null?void 0:T.title),1),w(la,{"flow-detail":c(n),onClick:f},null,8,["flow-detail"])]}),_:1}),w(S,{class:"flow-form__main"},{default:p(()=>[w(b,{modelValue:c(r),"onUpdate:modelValue":h[1]||(h[1]=T=>q(r)?r.value=T:null)},{default:p(()=>{var T,L;return[(L=(T=c(n))==null?void 0:T.process)!=null&&L.formPath?Z(v.$slots,"default",{key:0}):($(),N(C,{key:1,label:"审批信息",name:"form"},{default:p(()=>[w(jn,{ref_key:"formRef",ref:g,modelValue:c(a),"onUpdate:modelValue":h[0]||(h[0]=O=>q(a)?a.value=O:null),"flow-detail":c(n)},null,8,["modelValue","flow-detail"])]),_:1})),w(C,{label:"附件资料",name:"file",lazy:""}),w(C,{label:"流程跟踪",name:"track",lazy:""},{default:p(()=>[w(oa,{"flow-detail":c(n)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),w(Yn,{onConfirm:m})]),_:3}))}}});function zt(e,o){switch(o.type){case"window":return aa(e,o);case"dialog":case"drawer":return sa(e,o);default:return{open:()=>{},close:()=>{}}}}function aa(e,o){const{window:{url:t="",name:l="flow-form",features:n="left=0,top=0,width=1600,height=900"}={}}=o,a=I(null),r=R(()=>`${t}?${ao(so(e,ro(io,uo)))}`);return{open:()=>{var u;a.value=window.open(r.value,l,n),(u=a.value)==null||u.addEventListener("message",d=>{const{event:g}=d.data,f=c(e)[g];typeof f=="function"&&f(d.data)})},close:()=>{var u;return(u=a.value)==null?void 0:u.close()},openedWindow:a}}function sa(e,o){const{appContext:t}=Ue();let l;const n=()=>{l=document.createElement("div"),l.className="flow-form-wrapper";const r=ra(o.formPath),s=Ne(r,{...c(e)}),i=Ne(o.type==="dialog"?Wo:tl,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...o.overlay},s);i.appContext=t,_o(i,l),document.body.appendChild(l)},a=()=>{l&&document.body.removeChild(l)};return{open:n,close:a}}function ra(e){return e?bo(()=>wo(()=>import(e),[])):Kt}const ia=K({__name:"index",setup(e){const o=Co("debugMode",!1),{bindVal:t,getDataList:l}=te({tableOption:Sn,crudOption:{getList:Ln},searchForm:{status:2},sortOption:{descs:"start_time"}});l();const n=I({}),{open:a,close:r}=zt(n,{type:"drawer"});function s(i){n.value={flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:o.value,onComplete:()=>{r(),l()}},a()}return(i,u)=>{const d=V("el-switch"),g=V("el-button"),f=V("el-link"),m=V("avue-crud");return $(),N(m,ae(se(c(t))),{"menu-right":p(()=>[w(g,{type:"text"},{default:p(()=>[w(d,{modelValue:c(o),"onUpdate:modelValue":u[0]||(u[0]=v=>q(o)?o.value=v:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:p(({row:v})=>[w(f,{type:"primary",underline:!1,onClick:h=>s(v)},{default:p(()=>[F(j(v.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}});var jt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(jt||{});const Re=ie(jt),ua={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Re},{label:"备注",prop:"remark"}]},ca=K({__name:"index",setup(e){const{bindVal:o,getDataList:t}=te({tableOption:ua,crudOption:{getList:Jl,create:Yl,update:Zl,remove:Xl}});return t(),(l,n)=>{const a=V("avue-crud");return $(),N(a,ae(se(c(o))),null,16)}}}),da={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},fa={class:"flow-list"},pa=["onClick"],ma={class:"flow-name"},va=K({__name:"index",setup(e){const o=I([]);zl().then(d=>{o.value=d.data});const t=I({}),{open:l,close:n}=zt(t,{type:"drawer"});function a(d){t.value={flowKey:d.flowKey,taskId:d.taskId,instanceId:d.flowInstanceId,onComplete:()=>{n(),s()}},l()}const{bindVal:r,getDataList:s,crudStateRefs:{searchForm:i}}=te({tableOption:da,crudOption:{getList:En},searchForm:{status:2}}),u=[{label:"待办",value:2},{label:"已办",value:1}];return(d,g)=>{const f=V("el-button"),m=V("v-icon"),v=V("el-collapse-item"),h=V("el-collapse"),k=V("el-card"),S=V("el-divider"),y=V("avue-radio"),C=V("el-link"),b=V("avue-crud");return $(),B(Y,null,[w(k,{"body-style":{padding:"0 20px"}},{default:p(()=>[w(h,{"model-value":"1"},{default:p(()=>[w(v,{name:"1"},{title:p(()=>[w(f,{text:"",icon:"el-icon-promotion"},{default:p(()=>[F(" 发起审批 ")]),_:1})]),default:p(()=>[H("div",fa,[($(!0),B(Y,null,ue(o.value,_=>($(),B("div",{key:_.flowKey,class:"flow-item",onClick:T=>a(_)},[w(m,{class:"flow-icon",icon:_.flowIcon,width:"60"},null,8,["icon"]),H("div",ma,j(_.flowName),1)],8,pa))),128))])]),_:1})]),_:1})]),_:1}),w(S,{direction:"horizontal","content-position":"left"}),w(b,ae(se(c(r))),{"menu-left":p(()=>[w(y,{modelValue:c(i).status,"onUpdate:modelValue":[g[0]||(g[0]=_=>c(i).status=_),c(s)],button:"",dic:u},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:p(({row:_})=>[w(C,{type:"primary",underline:!1,onClick:T=>a(_)},{default:p(()=>[F(j(_.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const ya=Ae(va,[["__scopeId","data-v-78e441de"]]),_a={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},ba=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,handleUpdate:n}=te({tableOption:_a,crudOption:{getList:Ft,create:fn,update:pn,remove:mn}});l();const a=I(!1);async function r(i){t.value=i,a.value=!0}async function s(){await n(t.value,NaN,()=>a.value=!1,()=>{})}return(i,u)=>{const d=V("el-button"),g=V("avue-crud"),f=V("el-dialog");return $(),B(Y,null,[w(g,ae(se(c(o))),{flowData:p(({row:m})=>[w(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:v=>r(m)},{default:p(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(f,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=m=>a.value=m),title:`模型设计-${c(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:p(()=>[w(d,{type:"primary",onClick:s},{default:p(()=>[F(" 保存 ")]),_:1}),w(d,{onClick:u[1]||(u[1]=m=>a.value=!1)},{default:p(()=>[F(" 取消 ")]),_:1})]),default:p(()=>[w(Ve,{modelValue:c(t).flowData,"onUpdate:modelValue":u[0]||(u[0]=m=>c(t).flowData=m),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),wa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},ga=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,handleUpdate:n}=te({tableOption:wa,crudOption:{getList:xt,create:rn,update:un,remove:cn},mockCache:"form-template"});l();const a=I(!1);async function r(i){t.value={...i},a.value=!0}async function s(){await n(t.value,NaN,()=>a.value=!1,()=>{})}return(i,u)=>{const d=V("el-button"),g=V("avue-crud"),f=V("el-dialog");return $(),B(Y,null,[w(g,ae(se(c(o))),{formOption:p(({row:m})=>[w(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:v=>r(m)},{default:p(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(f,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=m=>a.value=m),title:`表单设计-${c(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:p(()=>[w(d,{type:"primary",onClick:s},{default:p(()=>[F(" 保存 ")]),_:1}),w(d,{onClick:u[1]||(u[1]=m=>a.value=!1)},{default:p(()=>[F(" 取消 ")]),_:1})]),default:p(()=>[w(He,{modelValue:c(t).formOption,"onUpdate:modelValue":u[0]||(u[0]=m=>c(t).formOption=m),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),ha={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreated:!0,defaultFirstOption:!0,dicData:ie(Ut)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Re,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Re,value:1}]}}]},ka=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,beforeOpen:n,beforeSave:a,beforeUpdate:r}=te({crudOption:{getList:At,create:yn,update:_n,remove:bn},tableOption:ha}),{data:s}=Qe("table.default.fields");l(),n(d=>{d==="add"?t.value.tableFields=s.value:t.value.tableFields=JSON.parse(t.value.tableFields)}),a(d=>{d.tableFields=JSON.stringify(d.tableFields)}),r(d=>{d.tableFields=JSON.stringify(d.tableFields)});const i=I(!1);async function u(d){await he.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),i.value=!0,wn({id:d.id}).then(()=>{X.success("部署成功"),l()}).finally(()=>{i.value=!1})}return(d,g)=>{const f=V("el-button"),m=V("avue-crud");return $(),N(m,ae(se(c(o))),{menu:p(({row:v})=>[w(f,{type:"text",icon:"el-icon-upload",onClick:h=>u(v)},{default:p(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ts={install(e){e.component("FlowButton",xl),e.component("FlowDefinition",Lt),e.component("FlowDeploy",Pt),e.component("FlowForm",Kt),e.component("FlowManage",On),e.component("FlowOps",ia),e.component("FlowParam",ca),e.component("FlowTemplate",ba),e.component("FormTemplate",ga),e.component("TableTemplate",ka),e.component("FlowWorkbench",ya)}};export{xl as FlowButton,Lt as FlowDefinition,Pt as FlowDeploy,Kt as FlowForm,On as FlowManage,ia as FlowOps,ca as FlowParam,ba as FlowTemplate,ya as FlowWorkbench,ga as FormTemplate,ka as TableTemplate,Ts as default};
