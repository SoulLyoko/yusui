var qt=Object.defineProperty;var Yt=(e,t,n)=>t in e?qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Q=(e,t,n)=>(Yt(e,typeof t!="symbol"?t+"":t,n),n);import{d as Ht,a as Jt,b as Kt}from"../flow-design_demo.md.7ca749ed.js";import{f as Ms,g as Os,h as Ls,i as Ps,c as Ss,e as Ts,j as Ds,k as Cs,m as Rs,n as Fs,p as js,l as As,s as Vs,o as Bs,q as Gs,r as zs}from"../flow-design_demo.md.7ca749ed.js";import{C as Xt,G as ve,M as Qt,D as Zt,l as $e,S as en,a as tn,I as nn,B as We,b as Ue}from"./index.8273129d.js";import{E as Ws,f as Us,g as qs,h as Ys,t as Hs,u as Js,r as Ks,s as Xs,N as Qs,q as Zs,i as ea,j as ta,P as na,c as oa,o as ra,p as ia,m as sa,n as aa,d as da,e as la,U as ca,k as ua}from"./index.8273129d.js";import{cm as on,cn as rn,co as sn,cp as an,bU as dn,cq as Re}from"../composables_use-crud_index.md.80d9fcd1.js";import{p as Ie,w as qe,d as yt,j as ln,l as cn,H as Z,o as oe,D as se,E as re,r as Me,J as de,a as un,e as J,k as ae,C as fn,v as hn,c as pn,aE as vn}from"./framework.893d3c69.js";import"../app.46bd79f7.js";import"./theme.ea6c12eb.js";import"../components_icon-select_index.md.fa314bdb.js";import"../components_index.md.c4883e2d.js";import"../components_v-text_index.md.ae040ac4.js";import"../composables_index.md.5c5bc1a0.js";import"../flow-design_index.md.97a0804d.js";import"../flow-pages_index.md.29be8972.js";import"../flow-pages_pages_flow-button_index.md.f959f5b7.js";import"../flow-pages_pages_flow-manage_index.md.68241b66.js";import"../flow-pages_pages_flow-ops_index.md.dbbe51af.js";import"../flow-pages_pages_flow-param_index.md.8bc100fc.js";import"../flow-pages_pages_flow-template_index.md.f624eb5f.js";import"../flow-pages_pages_flow-workbench_index.md.c22e7bad.js";import"../flow-pages_pages_form-template_index.md.95d0e3bf.js";import"../flow-pages_pages_table-template_index.md.74a33780.js";import"../form-design_demo.md.5be482af.js";import"../form-design_index.md.6e4d7b38.js";import"../guide_changelog.md.3f96ecea.js";import"../guide_start.md.0c303a84.js";import"../index.md.45571f0d.js";import"../plugins_avue-patch_index.md.d7ef31ad.js";import"../plugins_compatible-tips_index.md.da152e22.js";import"../plugins_env-dts_index.md.8f818d48.js";import"../plugins_index.md.a4e4b704.js";import"../plugins_load-proxy_index.md.06a48642.js";import"../plugins_setup-extend_index.md.ee89ab25.js";import"../plugins_uni-ui-patch_index.md.2d99c7f5.js";import"../plugins_uview-patch_index.md.c0e9597e.js";import"../types_avue_index.md.71b6211b.js";import"../types_index.md.16238616.js";import"../utils_date_dateFormat.md.a7849fcc.js";import"../utils_date_durationFormat.md.c951f8ee.js";import"../utils_emitter_mittAsync.md.33710d95.js";import"../utils_index.md.b422de11.js";import"../utils_math_index.md.b02108d7.js";import"../utils_object_filterObj.md.8f5ea217.js";import"../utils_object_filterObjDeep.md.0a2f5d0f.js";import"../utils_object_getDataType.md.a3fc0920.js";import"../utils_string_deserialize.md.9bdfc2c7.js";import"../utils_string_serialize.md.0744f8fa.js";import"../utils_string_uuid.md.c7000e71.js";import"../utils_tool_awaitTo.md.5d912ffe.js";import"../utils_tool_enumToDic.md.8db0e352.js";import"../utils_tool_sleep.md.12e01257.js";import"../utils_tree_buildTree.md.748c5451.js";import"../utils_tree_filterTree.md.e959896e.js";import"../utils_tree_findTree.md.3d8903e2.js";import"../utils_tree_flatTree.md.7ce54663.js";import"../utils_tree_treeMap.md.89fc6622.js";var mn="[object String]";function Fe(e){return typeof e=="string"||!on(e)&&rn(e)&&sn(e)==mn}var yn=0;function bn(e){var t=++yn;return an(e)+t}const Ye={rect:{radius:5,stroke:"black"},circle:{r:18,stroke:"black"},polygon:{stroke:"black"},polyline:{stroke:"black",hoverStroke:"black",selectedStroke:"black"},edgeText:{background:{fill:"white",height:14,stroke:"transparent",radius:3}},nodeText:{}},wn=[{label:"开始",value:"start"},{label:"任务",value:"task"},{label:"结束",value:"end"}],gn=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],xn=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],gs=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:wn},{label:"类型",prop:"eventType",type:"select",dicData:gn},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:xn},{label:"值",prop:"fieldValue"}]}}]}}],En=[{label:"创建",value:"create"},{label:"指派",value:"assignment"},{label:"完成",value:"complete"},{label:"删除",value:"delete"},{label:"更新",value:"update"},{label:"超时",value:"timeout"}],kn=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],_n=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],xs=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:En},{label:"类型",prop:"eventType",type:"select",dicData:kn},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:_n},{label:"值",prop:"fieldValue"}]}}]}}],Es=[{label:"",labelWidth:0,prop:"timeLimit",type:"dynamic",children:{column:[{label:"名称",prop:"name"},{label:"最小值",prop:"min",type:"number"},{label:"最大值",prop:"max",type:"number"}]},value:[]}];function He(e,t){return e.map(n=>{const o=t.find(l=>l.buttonKey===n.buttonKey),{name:r,buttonKey:i,display:a,approval:s}=n;return{name:r,buttonKey:i,display:a,approval:s,...o}})}function Oe(e,t){return e.map(n=>{var h,p;const o=t.find(v=>v.prop===n.prop),{label:r,prop:i,display:a=!0,disabled:s=!1,detail:d=!1,readonly:l=!1,rules:c}=n,u=(c==null?void 0:c.some(v=>v.required))??!1,f={label:r,prop:i,display:a,disabled:s,detail:d,readonly:l,required:u,...o};return n.type==="dynamic"&&((p=(h=n.children)==null?void 0:h.column)!=null&&p.length)&&(f.children=Oe(n.children.column,(o==null?void 0:o.children)??[])),f})}function Nn({lf:e,graphData:t,elementData:n,formData:o,formLoading:r,formOption:i,formOptions:a,editorVisible:s,dataOptions:d,formRef:l,formDefaults:c}){var h,p,v,y,w,I,b,O,R;async function u({data:g,isForce:F}={data:void 0,isForce:!1}){var A,C,U,m,L,T;const S=(A=e.value)==null?void 0:A.graphModel.nodes.find(P=>P.type==="process");!g&&(S!=null&&S.id)&&(g=(C=e.value)==null?void 0:C.getNodeDataById(S.id)),!((g==null?void 0:g.id)===((U=n.value)==null?void 0:U.id)&&!F)&&(g.type!=="process"&&((m=e.value)==null||m.selectElementById(g.id)),r.value=!0,await Ie(),n.value=g,i.value={menuBtn:!1,span:24,labelPosition:"left",group:((L=a.value)==null?void 0:L[g.type])??Ht},o.value={...g.properties,id:g.id,name:((T=g.text)==null?void 0:T.value)||""},r.value=!1,await Ie(),f())}async function f(){var m,L,T,P,V,E,N;const{formPropertyList:g,buttonList:F,fieldsDic:S,flowButtonDisplayDic:A,flowButtonApprovalDic:C}=d.value??{},U=k=>{var M,B;return(B=(M=i.value)==null?void 0:M.group)==null?void 0:B.some(G=>{var z;return(z=G.column)==null?void 0:z.some(K=>K.prop===k)})};U("button")&&(o.value.button=He(F||[],((m=o.value)==null?void 0:m.button)||[]),(P=(T=(L=c.value)==null?void 0:L.button.children)==null?void 0:T.column)==null||P.forEach(k=>{k.prop==="display"&&(k.dicData=A),k.prop==="approval"&&(k.dicData=C)})),U("formProperty")&&(o.value.formProperty=Oe(g||[],((V=o.value)==null?void 0:V.formProperty)||[])),U("priority")&&((E=l.value)==null||E.updateDic("priority",S)),U("formTitle")&&((N=l.value)==null||N.updateDic("formTitle",S))}(h=e.value)==null||h.on("element:click",u),(p=e.value)==null||p.on("blank:click",u),(v=e.value)==null||v.on("node:add",u),(y=e.value)==null||y.on("node:dnd-add",u),(w=e.value)==null||w.on("node:delete",()=>u()),(I=e.value)==null||I.on("history:change",()=>{var g;t.value=(g=e.value)==null?void 0:g.getGraphData()}),(b=e.value)==null||b.on("custom:edit-click",()=>{s.value=!0}),(O=e.value)==null||O.on("custom:reset-form-property",()=>{var g,F;(F=(g=t.value)==null?void 0:g.flowElementList)==null||F.forEach(S=>{var A,C;(A=S.properties)!=null&&A.formProperty&&(S.properties.formProperty=Oe(((C=d.value)==null?void 0:C.formPropertyList)||[],[]))}),t.value={...t.value}}),(R=e.value)==null||R.on("custom:reset-button",()=>{var g,F;(F=(g=t.value)==null?void 0:g.flowElementList)==null||F.forEach(S=>{var A,C;(A=S.properties)!=null&&A.button&&(S.properties.button=He(((C=d.value)==null?void 0:C.buttonList)||[],[]))}),t.value={...t.value}})}class In extends Xt{constructor({lf:t}){super({lf:t}),this.addItem({key:"clear",iconClass:"lf-control-clear",title:"清空",text:"清空",onClick:()=>t.clearData()}),this.addItem({key:"edit",iconClass:"lf-control-edit",title:"编辑",text:"编辑",onClick:()=>t.emit("custom:edit-click",{})}),this.addItem({key:"mini-map",iconClass:"lf-control-mini-map",title:"导航",text:"导航",onClick:()=>{const{isShow:n,show:o,hide:r}=t.extension.miniMap??{};n?r():o()}}),this.addItem({key:"reset",iconClass:"lf-control-reset",title:"重置",text:"重置",onClick:()=>{dn.confirm("选择重置的配置","提示",{confirmButtonText:"重置表单配置",cancelButtonText:"重置按钮配置"}).then(()=>{t.emit("custom:reset-form-property",{})}).catch(()=>{t.emit("custom:reset-button",{})})}})}}class Mn{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.hiddenNodes=[],this.hiddenEdges=[],this.hiddenCombos=[],this.vedges=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(t){return this.init(t),this.execute(!0)}init(t){this.nodes=t.nodes||[],this.edges=t.edges||[],this.combos=t.combos||[],this.comboEdges=t.comboEdges||[],this.hiddenNodes=t.hiddenNodes||[],this.hiddenEdges=t.hiddenEdges||[],this.hiddenCombos=t.hiddenCombos||[],this.vedges=t.vedges||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){t&&Object.assign(this,t)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const On=e=>typeof e=="string",Je=Array.isArray,he=e=>typeof e=="number",bt=e=>e!==null&&typeof e=="object",pe=e=>{if(e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach(n=>{t.push(n)}),t.map(n=>pe(n))}if(typeof e=="object"&&Object.keys(e).length){const t=Object.assign({},e);return Object.keys(t).forEach(n=>{t[n]=pe(t[n])}),t}return e},ne=(e,t)=>{const n=e[t];return bt(n)?n.cell:n},Ke=(e,t,n)=>{let o;return n?o=n:he(e)?o=()=>e:o=()=>t,o},Ln=(e,t)=>{if(e!=="next"&&e!=="prev")return t},Xe=e=>{e.prev.next=e.next,e.next.prev=e.prev,delete e.next,delete e.prev};let Pn=class{constructor(){const t={};t.prev=t,t.next=t.prev,this.shortcut=t}dequeue(){const t=this.shortcut,n=t.prev;if(n&&n!==t)return Xe(n),n}enqueue(t){const n=this.shortcut;t.prev&&t.next&&Xe(t),t.next=n.next,n.next.prev=t,n.next=t,t.prev=n}toString(){const t=[],n=this.shortcut;let o=n.prev;for(;o!==n;)t.push(JSON.stringify(o,Ln)),o=o==null?void 0:o.prev;return`[${t.join(", ")}]`}};function Qe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Sn(e,t,n){return t&&Qe(e.prototype,t),n&&Qe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var wt=Sn(function e(){var t=this;Tn(this,e),this.arr=[],this.keyIndice=new Map,this.size=function(){return t.arr.length},this.keys=function(){return t.arr.map(function(n){return n.key})},this.has=function(n){return t.keyIndice.has(n)},this.priority=function(n){var o=t.keyIndice.get(n);if(o!==void 0)return t.arr[o].priority},this.swap=function(n,o){var r=t.arr,i=t.keyIndice,a=[r[n],r[o]],s=a[0],d=a[1];r[n]=d,r[o]=s,i.set(s.key,o),i.set(d.key,n)},this.innerDecrease=function(n){for(var o=t.arr,r=o[n].priority,i,a=n;a!==0;){var s;if(i=a>>1,((s=o[i])===null||s===void 0?void 0:s.priority)<r)break;t.swap(a,i),a=i}},this.heapify=function(n){var o=t.arr,r=n<<1,i=r+1,a=n;r<o.length&&(a=o[r].priority<o[a].priority?r:a,i<o.length&&(a=o[i].priority<o[a].priority?i:a),a!==n&&(t.swap(n,a),t.heapify(a)))},this.min=function(){if(t.size()===0)throw new Error("Queue underflow");return t.arr[0].key},this.add=function(n,o){var r=t.keyIndice,i=t.arr;if(!r.has(n)){var a=i.length;return r.set(n,a),i.push({key:n,priority:o}),t.innerDecrease(a),!0}return!1},this.removeMin=function(){t.swap(0,t.arr.length-1);var n=t.arr.pop();return t.keyIndice.delete(n.key),t.heapify(0),n.key},this.decrease=function(n,o){if(!t.has(n))throw new Error("There's no key named ".concat(n));var r=t.keyIndice.get(n);if(o>t.arr[r].priority)throw new Error("New priority is greater than current priority.Key: ".concat(n," Old: + ").concat(t.arr[r].priority," New: ").concat(o));t.arr[r].priority=o,t.innerDecrease(r)}}),Dn=function(t,n){var o=new ve,r=new Map,i=new wt,a;function s(c){var u=c.v===a?c.w:c.v,f=i.priority(u);if(f!==void 0){var h=n(c);h<f&&(r.set(u,a),i.decrease(u,h))}}if(t.nodeCount()===0)return o;t.nodes().forEach(function(c){i.add(c,Number.POSITIVE_INFINITY),o.setNode(c)}),i.decrease(t.nodes()[0],0);for(var d=!1;i.size()>0;){var l;if(a=i.removeMin(),r.has(a))o.setEdge(a,r.get(a));else{if(d)throw new Error("Input graph is not connected: "+t.graph());d=!0}(l=t.nodeEdges(a))===null||l===void 0||l.forEach(s)}return o},Cn=function(t){var n=new Set,o=[],r=t.nodes();return r.forEach(function(i){for(var a=[],s=[i];s.length>0;){var d=s.pop();if(!n.has(d)){var l,c;n.add(d),a.push(d),(l=t.successors(d))===null||l===void 0||l.forEach(function(u){return s.push(u)}),(c=t.predecessors(d))===null||c===void 0||c.forEach(function(u){return s.push(u)})}}a.length&&o.push(a)}),o},Rn=function e(t,n,o,r,i,a){r.includes(n)||(r.push(n),o||a.push(n),i(n).forEach(function(s){return e(t,s,o,r,i,a)}),o&&a.push(n))},je=function(t,n,o){var r=Array.isArray(n)?n:[n],i=function(l){return t.isDirected()?t.successors(l):t.neighbors(l)},a=[],s=[];return r.forEach(function(d){if(t.hasNode(d))Rn(t,d,o==="post",s,i,a);else throw new Error("Graph does not have node: "+d)}),a};function Fn(e,t){return Bn(e)||Vn(e,t)||An(e,t)||jn()}function jn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function An(e,t){if(e){if(typeof e=="string")return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ze(e,t)}}function Ze(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Vn(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o=[],r=!0,i=!1,a,s;try{for(n=n.call(e);!(r=(a=n.next()).done)&&(o.push(a.value),!(t&&o.length===t));r=!0);}catch(d){i=!0,s=d}finally{try{!r&&n.return!=null&&n.return()}finally{if(i)throw s}}return o}}function Bn(e){if(Array.isArray(e))return e}var Gn=function(){return 1},gt=function(t,n,o,r){return zn(t,n,o||Gn,r||function(i){return t.outEdges(i)})},zn=function(t,n,o,r){var i=new Map,a=new wt,s,d,l=function(f){var h=f.v!==s?f.v:f.w,p=i.get(h),v=o(f),y=d.distance+v;if(v<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+f+" Weight: "+v);y<p.distance&&(p.distance=y,p.predecessor=s,a.decrease(h,y))};for(t.nodes().forEach(function(u){var f=u===n?0:Number.POSITIVE_INFINITY;i.set(u,{distance:f}),a.add(u,f)});a.size()>0&&(s=a.removeMin(),d=i.get(s),!(d&&d.distance===Number.POSITIVE_INFINITY));)r(s).forEach(l);var c={};return Array.from(i.entries()).forEach(function(u){var f=Fn(u,2),h=f[0],p=f[1];return c[String(h)]=p,c}),c},$n=function(t,n,o){var r={};return t.nodes().forEach(function(i){return r[String(i)]=gt(t,i,n,o),r}),r},xt=function(t){var n=0,o=[],r=new Map,i=[];function a(s){var d,l={onStack:!0,lowlink:n,index:n};if(r.set(s,l),n+=1,o.push(s),(d=t.successors(s))===null||d===void 0||d.forEach(function(h){var p;if(r.has(h)){if(!((p=r.get(h))===null||p===void 0)&&p.onStack){var y=r.get(h);l.lowlink=Math.min(l.lowlink,y.index)}}else{a(h);var v=r.get(h);l.lowlink=Math.min(l.lowlink,v.lowlink)}}),l.lowlink===l.index){var c=[],u;do{u=o.pop();var f=r.get(u);f.onStack=!1,c.push(u)}while(s!==u);i.push(c)}}return t.nodes().forEach(function(s){r.has(s)||a(s)}),i},Wn=function(t){return xt(t).filter(function(n){return n.length>1||n.length===1&&t.hasEdge(n[0],n[0])})};function Le(e){return Le=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Le(e)}function et(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Un(e,t,n){return t&&et(e.prototype,t),n&&et(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function qn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&le(e,t)}function Hn(e){var t=Et();return function(){var o=ce(e),r;if(t){var i=ce(this).constructor;r=Reflect.construct(o,arguments,i)}else r=o.apply(this,arguments);return Jn(this,r)}}function Jn(e,t){if(t&&(Le(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kn(e)}function Kn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pe(e){var t=typeof Map=="function"?new Map:void 0;return Pe=function(o){if(o===null||!Xn(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(o))return t.get(o);t.set(o,r)}function r(){return fe(o,arguments,ce(this).constructor)}return r.prototype=Object.create(o.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),le(r,o)},Pe(e)}function fe(e,t,n){return Et()?fe=Reflect.construct:fe=function(r,i,a){var s=[null];s.push.apply(s,i);var d=Function.bind.apply(r,s),l=new d;return a&&le(l,a.prototype),l},fe.apply(null,arguments)}function Et(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Xn(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function le(e,t){return le=Object.setPrototypeOf||function(o,r){return o.__proto__=r,o},le(e,t)}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},ce(e)}var Se=function(e){Yn(n,e);var t=Hn(n);function n(){return qn(this,n),t.apply(this,arguments)}return Un(n)}(Pe(Error));function kt(e){var t=new Set,n=new Set,o=[];function r(i){if(n.has(i))throw new Se;if(!t.has(i)){var a;n.add(i),t.add(i),(a=e.predecessors(i))===null||a===void 0||a.forEach(r),n.delete(i),o.push(i)}}if(e.sinks().forEach(r),t.size!==e.nodeCount())throw new Se;return o}var Qn=function(t){try{kt(t)}catch(n){if(n instanceof Se)return!1;throw n}return!0},Zn=function(t,n){return je(t,n,"post")},eo=function(t,n){return je(t,n,"pre")},to=function(){return 1};function no(e,t,n){return oo(e,t||to,n||function(o){return e.outEdges(o)})}function oo(e,t,n){var o={},r=e.nodes();return r.forEach(function(i){var a=String(i);o[a]={},o[a][a]={distance:0},r.forEach(function(s){i!==s&&(o[a][String(s)]={distance:Number.POSITIVE_INFINITY})}),n(i).forEach(function(s){var d=s.v===i?s.w:s.v,l=t(s);o[a][String(d)]={distance:l,predecessor:i}})}),r.forEach(function(i){var a=String(i),s=o[a];r.forEach(function(d){var l=String(d),c=o[l];r.forEach(function(u){var f=String(u),h=c[a],p=s[f],v=c[f],y=h.distance+p.distance;y<v.distance&&(v.distance=y,v.predecessor=p.predecessor)})})}),o}const ro=Object.freeze(Object.defineProperty({__proto__:null,components:Cn,dfs:je,dijkstra:gt,dijkstraAll:$n,findCycles:Wn,floydWarshall:no,isAcyclic:Qn,postorder:Zn,preorder:eo,prim:Dn,tarjan:xt,topsort:kt},Symbol.toStringTag,{value:"Module"}));class io extends Pn{}class so extends ve{}const ao=()=>1,lo=(e,t)=>{var n;if(e.nodeCount()<=1)return[];const o=uo(e,t||ao);return(n=co(o.graph,o.buckets,o.zeroIdx).map(i=>e.outEdges(i.v,i.w)))===null||n===void 0?void 0:n.flat()},co=(e,t,n)=>{let o=[];const r=t[t.length-1],i=t[0];let a;for(;e.nodeCount();){for(;a=i.dequeue();)be(e,t,n,a);for(;a=r.dequeue();)be(e,t,n,a);if(e.nodeCount()){for(let s=t.length-2;s>0;--s)if(a=t[s].dequeue(),a){o=o.concat(be(e,t,n,a,!0));break}}}return o},be=(e,t,n,o,r)=>{var i,a;const s=[];return(i=e.inEdges(o.v))===null||i===void 0||i.forEach(d=>{const l=e.edge(d),c=e.node(d.v);r&&s.push({v:d.v,w:d.w,in:0,out:0}),c.out===void 0&&(c.out=0),c.out-=l,Te(t,n,c)}),(a=e.outEdges(o.v))===null||a===void 0||a.forEach(d=>{const l=e.edge(d),c=d.w,u=e.node(c);u.in===void 0&&(u.in=0),u.in-=l,Te(t,n,u)}),e.removeNode(o.v),r?s:void 0},uo=(e,t)=>{const n=new so;let o=0,r=0;e.nodes().forEach(d=>{n.setNode(d,{v:d,in:0,out:0})}),e.edges().forEach(d=>{const l=n.edge(d)||0,c=(t==null?void 0:t(d))||1,u=l+c;n.setEdge(d.v,d.w,u),r=Math.max(r,n.node(d.v).out+=c),o=Math.max(o,n.node(d.w).in+=c)});const i=[],a=r+o+3;for(let d=0;d<a;d++)i.push(new io);const s=o+1;return n.nodes().forEach(d=>{Te(i,s,n.node(d))}),{buckets:i,zeroIdx:s,graph:n}},Te=(e,t,n)=>{n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)},fo=e=>{const t=o=>r=>{var i;return((i=o.edge(r))===null||i===void 0?void 0:i.weight)||1},n=e.graph().acyclicer==="greedy"?lo(e,t(e)):ho(e);n==null||n.forEach(o=>{const r=e.edge(o);e.removeEdgeObj(o),r.forwardName=o.name,r.reversed=!0,e.setEdge(o.w,o.v,r,`rev-${Math.random()}`)})},ho=e=>{const t=[],n={},o={},r=i=>{var a;o[i]||(o[i]=!0,n[i]=!0,(a=e.outEdges(i))===null||a===void 0||a.forEach(s=>{n[s.w]?t.push(s):r(s.w)}),delete n[i])};return e.nodes().forEach(r),t},po=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n.reversed){e.removeEdgeObj(t);const o=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,o)}})},tt={run:fo,undo:po};class ee extends ve{}const vo=(e,t)=>Number(e)-Number(t),ie=(e,t,n,o)=>{let r;do r=`${o}${Math.random()}`;while(e.hasNode(r));return n.dummy=t,e.setNode(r,n),r},mo=e=>{const t=new ee().setGraph(e.graph());return e.nodes().forEach(n=>{t.setNode(n,e.node(n))}),e.edges().forEach(n=>{const o=t.edgeFromArgs(n.v,n.w)||{weight:0,minlen:1},r=e.edge(n);t.setEdge(n.v,n.w,{weight:o.weight+r.weight,minlen:Math.max(o.minlen,r.minlen)})}),t},_t=e=>{const t=new ee({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(n=>{var o;!((o=e.children(n))===null||o===void 0)&&o.length||t.setNode(n,e.node(n))}),e.edges().forEach(n=>{t.setEdgeObj(n,e.edge(n))}),t},yo=(e,t)=>e==null?void 0:e.reduce((n,o,r)=>(n[o]=t[r],n),{}),nt=(e,t)=>{const n=Number(e.x),o=Number(e.y),r=Number(t.x)-n,i=Number(t.y)-o;let a=Number(e.width)/2,s=Number(e.height)/2;if(!r&&!i)return{x:0,y:0};let d,l;return Math.abs(i)*a>Math.abs(r)*s?(i<0&&(s=-s),d=s*r/i,l=s):(r<0&&(a=-a),d=a,l=a*i/r),{x:n+d,y:o+l}},ue=e=>{const t=[],n=Nt(e)+1;for(let o=0;o<n;o++)t.push([]);e.nodes().forEach(o=>{const r=e.node(o);if(!r)return;const i=r.rank;i!==void 0&&t[i]&&t[i].push(o)});for(let o=0;o<n;o++)t[o]=t[o].sort((r,i)=>{var a,s;return vo((a=e.node(r))===null||a===void 0?void 0:a.order,(s=e.node(i))===null||s===void 0?void 0:s.order)});return t},bo=e=>{const t=e.nodes().filter(o=>{var r;return((r=e.node(o))===null||r===void 0?void 0:r.rank)!==void 0}).map(o=>e.node(o).rank),n=Math.min(...t);e.nodes().forEach(o=>{const r=e.node(o);r.hasOwnProperty("rank")&&n!==1/0&&(r.rank-=n)})},wo=e=>{const t=e.nodes(),n=t.filter(s=>{var d;return((d=e.node(s))===null||d===void 0?void 0:d.rank)!==void 0}).map(s=>e.node(s).rank),o=Math.min(...n),r=[];t.forEach(s=>{var d;const l=(((d=e.node(s))===null||d===void 0?void 0:d.rank)||0)-o;r[l]||(r[l]=[]),r[l].push(s)});let i=0;const a=e.graph().nodeRankFactor||0;for(let s=0;s<r.length;s++){const d=r[s];d===void 0?s%a!==0&&(i-=1):i&&(d==null||d.forEach(l=>{const c=e.node(l);c&&(c.rank=c.rank||0,c.rank+=i)}))}},ot=(e,t,n,o)=>{const r={width:0,height:0};return he(n)&&he(o)&&(r.rank=n,r.order=o),ie(e,"border",r,t)},Nt=e=>{let t;return e.nodes().forEach(n=>{var o;const r=(o=e.node(n))===null||o===void 0?void 0:o.rank;r!==void 0&&(t===void 0||r>t)&&(t=r)}),t||(t=0),t},go=(e,t)=>{const n={lhs:[],rhs:[]};return e==null||e.forEach(o=>{t(o)?n.lhs.push(o):n.rhs.push(o)}),n},It=(e,t)=>{const n=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-n}ms`)}},Mt=(e,t)=>t(),Ae=(e,t)=>e.reduce((n,o)=>{const r=t(n),i=t(o);return r>i?o:n}),xo=e=>{e.graph().dummyChains=[],e.edges().forEach(t=>Eo(e,t))},Eo=(e,t)=>{let n=t.v,o=e.node(n).rank;const r=t.w,i=e.node(r).rank,a=t.name,s=e.edge(t),d=s.labelRank;if(i===o+1)return;e.removeEdgeObj(t);const l=e.graph();let c,u,f;for(f=0,++o;o<i;++f,++o)s.points=[],u={edgeLabel:s,width:0,height:0,edgeObj:t,rank:o},c=ie(e,"edge",u,"_d"),o===d&&(u.width=s.width,u.height=s.height,u.dummy="edge-label",u.labelpos=s.labelpos),e.setEdge(n,c,{weight:s.weight},a),f===0&&(l.dummyChains||(l.dummyChains=[]),l.dummyChains.push(c)),n=c;e.setEdge(n,r,{weight:s.weight},a)},ko=e=>{var t;(t=e.graph().dummyChains)===null||t===void 0||t.forEach(n=>{let o=e.node(n);const r=o.edgeLabel;let i;o.edgeObj&&e.setEdgeObj(o.edgeObj,r);let a=n;for(;o.dummy;)i=e.successors(a)[0],e.removeNode(a),r.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height),a=i,o=e.node(a)})},rt={run:xo,undo:ko},Ot=e=>{var t;const n={},o=r=>{var i;const a=e.node(r);if(!a)return 0;if(n[r])return a.rank;n[r]=!0;let s;return(i=e.outEdges(r))===null||i===void 0||i.forEach(d=>{const l=o(d.w),c=e.edge(d).minlen,u=l-c;u&&(s===void 0||u<s)&&(s=u)}),s||(s=0),a.rank=s,s};(t=e.sources())===null||t===void 0||t.forEach(r=>o(r))},_o=e=>{var t;const n={};let o;const r=s=>{var d;const l=e.node(s);if(!l)return 0;if(n[s])return l.rank;n[s]=!0;let c;return(d=e.outEdges(s))===null||d===void 0||d.forEach(u=>{const f=r(u.w),h=e.edge(u).minlen,p=f-h;p&&(c===void 0||p<c)&&(c=p)}),c||(c=0),(o===void 0||c<o)&&(o=c),l.rank=c,c};(t=e.sources())===null||t===void 0||t.forEach(s=>{e.node(s)&&r(s)}),o===void 0&&(o=0);const i={},a=(s,d)=>{var l;const c=e.node(s),u=isNaN(c.layer)?d:c.layer;(c.rank===void 0||c.rank<u)&&(c.rank=u),!i[s]&&(i[s]=!0,(l=e.outEdges(s))===null||l===void 0||l.map(f=>{a(f.w,u+e.edge(f).minlen)}))};e.nodes().forEach(s=>{const d=e.node(s);d&&(isNaN(d.layer)?d.rank-=o:a(s,d.layer))})},te=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,No=e=>{const t=new ee({directed:!1}),n=e.nodes()[0],o=e.nodeCount();t.setNode(n,{});let r,i;for(;Io(t,e)<o;)r=Lt(t,e),i=t.hasNode(r.v)?te(e,r):-te(e,r),Pt(t,e,i);return t},Io=(e,t)=>{const n=o=>{t.nodeEdges(o).forEach(r=>{const i=r.v,a=o===i?r.w:i;!e.hasNode(a)&&!te(t,r)&&(e.setNode(a,{}),e.setEdge(o,a,{}),n(a))})};return e.nodes().forEach(n),e.nodeCount()},Mo=e=>{const t=new ee({directed:!1}),n=e.nodes()[0],o=e.nodes().filter(a=>!!e.node(a)).length;t.setNode(n,{});let r,i;for(;Oo(t,e)<o;)r=Lt(t,e),i=t.hasNode(r.v)?te(e,r):-te(e,r),Pt(t,e,i);return t},Oo=(e,t)=>{const n=o=>{var r;(r=t.nodeEdges(o))===null||r===void 0||r.forEach(i=>{const a=i.v,s=o===a?i.w:a;!e.hasNode(s)&&(t.node(s).layer!==void 0||!te(t,i))&&(e.setNode(s,{}),e.setEdge(o,s,{}),n(s))})};return e.nodes().forEach(n),e.nodeCount()},Lt=(e,t)=>Ae(t.edges(),n=>e.hasNode(n.v)!==e.hasNode(n.w)?te(t,n):1/0),Pt=(e,t,n)=>{e.nodes().forEach(o=>{t.node(o).rank||(t.node(o).rank=0),t.node(o).rank+=n})},{preorder:Lo,postorder:Po}=ro,So=e=>{const t=mo(e);Ot(t);const n=No(t);Tt(n),St(n,t);let o,r;for(;o=Co(n);)r=Ro(n,t,o),Fo(n,t,o,r)},St=(e,t)=>{let n=Po(e,e.nodes());n=n==null?void 0:n.slice(0,(n==null?void 0:n.length)-1),n==null||n.forEach(o=>{To(e,t,o)})},To=(e,t,n)=>{const r=e.node(n).parent;e.edgeFromArgs(n,r).cutvalue=Do(e,t,n)},Do=(e,t,n)=>{var o;const i=e.node(n).parent;let a=!0,s=t.edgeFromArgs(n,i),d=0;return s||(a=!1,s=t.edgeFromArgs(i,n)),d=s.weight,(o=t.nodeEdges(n))===null||o===void 0||o.forEach(l=>{const c=l.v===n,u=c?l.w:l.v;if(u!==i){const f=c===a,h=t.edge(l).weight;if(d+=f?h:-h,Ao(e,n,u)){const p=e.edgeFromArgs(n,u).cutvalue;d+=f?-p:p}}}),d},Tt=(e,t=e.nodes()[0])=>{Dt(e,{},1,t)},Dt=(e,t,n,o,r)=>{var i;const a=n;let s=n;const d=e.node(o);return t[o]=!0,(i=e.neighbors(o))===null||i===void 0||i.forEach(l=>{t[l]||(s=Dt(e,t,s,l,o))}),d.low=a,d.lim=s++,r?d.parent=r:delete d.parent,s},Co=e=>e.edges().find(t=>e.edge(t).cutvalue<0),Ro=(e,t,n)=>{let o=n.v,r=n.w;t.hasEdge(o,r)||(o=n.w,r=n.v);const i=e.node(o),a=e.node(r);let s=i,d=!1;i.lim>a.lim&&(s=a,d=!0);const l=t.edges().filter(c=>d===it(e,e.node(c.v),s)&&d!==it(e,e.node(c.w),s));return Ae(l,c=>te(t,c))},Fo=(e,t,n,o)=>{const r=n.v,i=n.w;e.removeEdge(r,i),e.setEdge(o.v,o.w,{}),Tt(e),St(e,t),jo(e,t)},jo=(e,t)=>{const n=e.nodes().find(r=>{var i;return!(!((i=t.node(r))===null||i===void 0)&&i.parent)});let o=Lo(e,n);o=o==null?void 0:o.slice(1),o==null||o.forEach(r=>{const i=e.node(r).parent;let a=t.edgeFromArgs(r,i),s=!1;a||(a=t.edgeFromArgs(i,r),s=!0),t.node(r).rank=t.node(i).rank+(s?a.minlen:-a.minlen)})},Ao=(e,t,n)=>e.hasEdge(t,n),it=(e,t,n)=>n.low<=t.lim&&t.lim<=n.lim,Vo=e=>{switch(e.graph().ranker){case"network-simplex":Go(e);break;case"tight-tree":st(e);break;case"longest-path":Bo(e);break;default:st(e)}},Bo=Ot,st=e=>{_o(e),Mo(e)},Go=e=>{So(e)},zo=e=>{var t;const n={};let o=0;const r=i=>{var a;const s=o;(a=e.children(i))===null||a===void 0||a.forEach(r),n[i]={low:s,lim:o++}};return(t=e.children())===null||t===void 0||t.forEach(r),n},$o=(e,t,n,o)=>{const r=[],i=[],a=Math.min(t[n].low,t[o].low),s=Math.max(t[n].lim,t[o].lim);let d,l;d=n;do d=e.parent(d),r.push(d);while(d&&(t[d].low>a||s>t[d].lim));for(l=d,d=o;d&&d!==l;)i.push(d),d=e.parent(d);return{lca:l,path:r.concat(i.reverse())}},Wo=e=>{var t;const n=zo(e);(t=e.graph().dummyChains)===null||t===void 0||t.forEach(o=>{var r,i;let a=o,s=e.node(a);const d=s.edgeObj;if(!d)return;const l=$o(e,n,d.v,d.w),c=l.path,u=l.lca;let f=0,h=c[f],p=!0;for(;a!==d.w;){if(s=e.node(a),p){for(;h!==u&&((r=e.node(h))===null||r===void 0?void 0:r.maxRank)<s.rank;)f++,h=c[f];h===u&&(p=!1)}if(!p){for(;f<c.length-1&&((i=e.node(c[f+1]))===null||i===void 0?void 0:i.minRank)<=s.rank;)f++;h=c[f]}e.setParent(a,h),a=e.successors(a)[0]}})},Uo=e=>{var t;const n=ie(e,"root",{},"_root"),o=qo(e);let r=Math.max(...Object.values(o));Math.abs(r)===1/0&&(r=1);const i=r-1,a=2*i+1;e.graph().nestingRoot=n,e.edges().forEach(d=>{e.edge(d).minlen*=a});const s=Yo(e)+1;(t=e.children())===null||t===void 0||t.forEach(d=>{Ct(e,n,a,s,i,o,d)}),e.graph().nodeRankFactor=a},Ct=(e,t,n,o,r,i,a)=>{const s=e.children(a);if(!(s!=null&&s.length)){a!==t&&e.setEdge(t,a,{weight:0,minlen:n});return}const d=ot(e,"_bt"),l=ot(e,"_bb"),c=e.node(a);e.setParent(d,a),c.borderTop=d,e.setParent(l,a),c.borderBottom=l,s==null||s.forEach(u=>{Ct(e,t,n,o,r,i,u);const f=e.node(u),h=f.borderTop?f.borderTop:u,p=f.borderBottom?f.borderBottom:u,v=f.borderTop?o:2*o,y=h!==p?1:r-i[a]+1;e.setEdge(d,h,{minlen:y,weight:v,nestingEdge:!0}),e.setEdge(p,l,{minlen:y,weight:v,nestingEdge:!0})}),e.parent(a)||e.setEdge(t,d,{weight:0,minlen:r+i[a]})},qo=e=>{var t;const n={},o=(r,i)=>{const a=e.children(r);a==null||a.forEach(s=>o(s,i+1)),n[r]=i};return(t=e.children())===null||t===void 0||t.forEach(r=>o(r,1)),n},Yo=e=>{let t=0;return e.edges().forEach(n=>{t+=e.edge(n).weight}),t},Ho=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(n=>{e.edge(n).nestingEdge&&e.removeEdgeObj(n)})},at={run:Uo,cleanup:Ho},Jo=e=>{var t;const n=o=>{const r=e.children(o),i=e.node(o);if(r!=null&&r.length&&r.forEach(a=>n(a)),i.hasOwnProperty("minRank")){i.borderLeft=[],i.borderRight=[];for(let a=i.minRank,s=i.maxRank+1;a<s;a+=1)dt(e,"borderLeft","_bl",o,i,a),dt(e,"borderRight","_br",o,i,a)}};(t=e.children())===null||t===void 0||t.forEach(o=>n(o))},dt=(e,t,n,o,r,i)=>{const a={rank:i,borderType:t,width:0,height:0},s=r[t][i-1],d=ie(e,"border",a,n);r[t][i]=d,e.setParent(d,o),s&&e.setEdge(s,d,{weight:1})},Ko=e=>{var t;const n=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(n==="lr"||n==="rl")&&Rt(e)},Xo=e=>{var t;const n=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(n==="bt"||n==="rl")&&Qo(e),(n==="lr"||n==="rl")&&(Zo(e),Rt(e))},Rt=e=>{e.nodes().forEach(t=>{lt(e.node(t))}),e.edges().forEach(t=>{lt(e.edge(t))})},lt=e=>{const t=e.width;e.width=e.height,e.height=t},Qo=e=>{e.nodes().forEach(t=>{we(e.node(t))}),e.edges().forEach(t=>{var n;const o=e.edge(t);(n=o.points)===null||n===void 0||n.forEach(r=>we(r)),o.hasOwnProperty("y")&&we(o)})},we=e=>{e!=null&&e.y&&(e.y=-e.y)},Zo=e=>{e.nodes().forEach(t=>{ge(e.node(t))}),e.edges().forEach(t=>{var n;const o=e.edge(t);(n=o.points)===null||n===void 0||n.forEach(r=>ge(r)),o.hasOwnProperty("x")&&ge(o)})},ge=e=>{const t=e.x;e.x=e.y,e.y=t},ct={adjust:Ko,undo:Xo};var er={}.toString,tr=function(e,t){return er.call(e)==="[object "+t+"]"};const nr=tr,Ft=function(e){return Array.isArray?Array.isArray(e):nr(e,"Array")},De=function(e){if(Ft(e))return e.reduce(function(t,n){return Math.max(t,n)},e[0])},ut=function(e){if(Ft(e))return e.reduce(function(t,n){return Math.min(t,n)},e[0])},ft=e=>{const t={},n=e.nodes().filter(c=>{var u;return!(!((u=e.children(c))===null||u===void 0)&&u.length)}),o=n.map(c=>e.node(c).rank),r=De(o),i=[];for(let c=0;c<r+1;c++)i.push([]);const a=c=>{var u;if(t.hasOwnProperty(c))return;t[c]=!0;const f=e.node(c);isNaN(f.rank)||i[f.rank].push(c),(u=e.successors(c))===null||u===void 0||u.forEach(h=>a(h))},s=n.sort((c,u)=>e.node(c).rank-e.node(u).rank),l=s.filter(c=>e.node(c).fixorder!==void 0).sort((c,u)=>e.node(c).fixorder-e.node(u).fixorder);return l==null||l.forEach(c=>{isNaN(e.node(c).rank)||i[e.node(c).rank].push(c),t[c]=!0}),s==null||s.forEach(a),i},or=(e,t,n)=>{const o=yo(n,n.map((c,u)=>u)),i=t.map(c=>{var u;const f=(u=e.outEdges(c))===null||u===void 0?void 0:u.map(h=>({pos:o[h.w]||0,weight:e.edge(h).weight}));return f==null?void 0:f.sort((h,p)=>h.pos-p.pos)}).flat().filter(c=>c!==void 0);let a=1;for(;a<n.length;)a<<=1;const s=2*a-1;a-=1;const d=Array(s).fill(0,0,s);let l=0;return i==null||i.forEach(c=>{if(c){let u=c.pos+a;d[u]+=c.weight;let f=0;for(;u>0;)u%2&&(f+=d[u+1]),u=u-1>>1,d[u]+=c.weight;l+=c.weight*f}}),l},ht=(e,t)=>{let n=0;for(let o=1;o<(t==null?void 0:t.length);o+=1)n+=or(e,t[o-1],t[o]);return n},rr=(e,t,n)=>{const o=ir(e),r=new ee({compound:!0}).setGraph({root:o}).setDefaultNodeLabel(i=>e.node(i));return e.nodes().forEach(i=>{var a;const s=e.node(i),d=e.parent(i);(s.rank===t||s.minRank<=t&&t<=s.maxRank)&&(r.setNode(i),r.setParent(i,d||o),(a=e[n](i))===null||a===void 0||a.forEach(l=>{const c=l.v===i?l.w:l.v,u=r.edgeFromArgs(c,i),f=u!==void 0?u.weight:0;r.setEdge(c,i,{weight:e.edge(l).weight+f})}),s.hasOwnProperty("minRank")&&r.setNode(i,{borderLeft:s.borderLeft[t],borderRight:s.borderRight[t]}))}),r},ir=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},sr=(e,t,n)=>{const o={};let r;n==null||n.forEach(i=>{let a=e.parent(i),s,d;for(;a;){if(s=e.parent(a),s?(d=o[s],o[s]=a):(d=r,r=a),d&&d!==a){t.setEdge(d,a);return}a=s}})},ar=(e,t)=>t.map(n=>{const o=e.inEdges(n);if(!(o!=null&&o.length))return{v:n};{const r={sum:0,weight:0};return o==null||o.forEach(i=>{const a=e.edge(i),s=e.node(i.v);r.sum+=a.weight*s.order,r.weight+=a.weight}),{v:n,barycenter:r.sum/r.weight,weight:r.weight}}}),dr=(e,t)=>{var n,o,r;const i={};e==null||e.forEach((s,d)=>{i[s.v]={i:d,indegree:0,in:[],out:[],vs:[s.v]};const l=i[s.v];s.barycenter!==void 0&&(l.barycenter=s.barycenter,l.weight=s.weight)}),(n=t.edges())===null||n===void 0||n.forEach(s=>{const d=i[s.v],l=i[s.w];d!==void 0&&l!==void 0&&(l.indegree++,d.out.push(i[s.w]))});const a=(r=(o=Object.values(i)).filter)===null||r===void 0?void 0:r.call(o,s=>!s.indegree);return lr(a)},lr=e=>{var t,n;const o=[],r=d=>l=>{l.merged||(l.barycenter===void 0||d.barycenter===void 0||l.barycenter>=d.barycenter)&&cr(d,l)},i=d=>l=>{l.in.push(d),--l.indegree===0&&e.push(l)};for(;e!=null&&e.length;){const d=e.pop();o.push(d),(t=d.in.reverse())===null||t===void 0||t.forEach(l=>r(d)(l)),(n=d.out)===null||n===void 0||n.forEach(l=>i(d)(l))}const a=o.filter(d=>!d.merged),s=["vs","i","barycenter","weight"];return a.map(d=>{const l={};return s==null||s.forEach(c=>{d[c]!==void 0&&(l[c]=d[c])}),l})},cr=(e,t)=>{var n;let o=0,r=0;e.weight&&(o+=e.barycenter*e.weight,r+=e.weight),t.weight&&(o+=t.barycenter*t.weight,r+=t.weight),e.vs=(n=t.vs)===null||n===void 0?void 0:n.concat(e.vs),e.barycenter=o/r,e.weight=r,e.i=Math.min(t.i,e.i),t.merged=!0},ur=(e,t,n,o)=>{const r=go(e,f=>{const h=f.hasOwnProperty("fixorder")&&!isNaN(f.fixorder);return o?!h&&f.hasOwnProperty("barycenter"):h||f.hasOwnProperty("barycenter")}),i=r.lhs,a=r.rhs.sort((f,h)=>-f.i- -h.i),s=[];let d=0,l=0,c=0;i==null||i.sort(fr(!!t,!!n)),c=pt(s,a,c),i==null||i.forEach(f=>{var h;c+=(h=f.vs)===null||h===void 0?void 0:h.length,s.push(f.vs),d+=f.barycenter*f.weight,l+=f.weight,c=pt(s,a,c)});const u={vs:s.flat()};return l&&(u.barycenter=d/l,u.weight=l),u},pt=(e,t,n)=>{let o=n,r;for(;t.length&&(r=t[t.length-1]).i<=o;)t.pop(),e==null||e.push(r.vs),o++;return o},fr=(e,t)=>(n,o)=>{if(n.fixorder!==void 0&&o.fixorder!==void 0)return n.fixorder-o.fixorder;if(n.barycenter<o.barycenter)return-1;if(n.barycenter>o.barycenter)return 1;if(t&&n.order!==void 0&&o.order!==void 0){if(n.order<o.order)return-1;if(n.order>o.order)return 1}return e?o.i-n.i:n.i-o.i},jt=(e,t,n,o,r,i)=>{var a,s,d,l;let c=e.children(t);const u=e.node(t),f=u?u.borderLeft:void 0,h=u?u.borderRight:void 0,p={};f&&(c=c==null?void 0:c.filter(I=>I!==f&&I!==h));const v=ar(e,c||[]);v==null||v.forEach(I=>{var b;if(!((b=e.children(I.v))===null||b===void 0)&&b.length){const O=jt(e,I.v,n,o,i);p[I.v]=O,O.hasOwnProperty("barycenter")&&pr(I,O)}});const y=dr(v,n);hr(y,p),(a=y.filter(I=>I.vs.length>0))===null||a===void 0||a.forEach(I=>{const b=e.node(I.vs[0]);b&&(I.fixorder=b.fixorder,I.order=b.order)});const w=ur(y,o,r,i);if(f&&(w.vs=[f,w.vs,h].flat(),!((s=e.predecessors(f))===null||s===void 0)&&s.length)){const I=e.node(((d=e.predecessors(f))===null||d===void 0?void 0:d[0])||""),b=e.node(((l=e.predecessors(h))===null||l===void 0?void 0:l[0])||"");w.hasOwnProperty("barycenter")||(w.barycenter=0,w.weight=0),w.barycenter=(w.barycenter*w.weight+I.order+b.order)/(w.weight+2),w.weight+=2}return w},hr=(e,t)=>{e==null||e.forEach(n=>{var o;const r=(o=n.vs)===null||o===void 0?void 0:o.map(i=>t[i]?t[i].vs:i);n.vs=r.flat()})},pr=(e,t)=>{e.barycenter!==void 0?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},vr=(e,t)=>{const n=Nt(e),o=[],r=[];for(let c=1;c<n+1;c++)o.push(c);for(let c=n-1;c>-1;c--)r.push(c);const i=vt(e,o,"inEdges"),a=vt(e,r,"outEdges");let s=ft(e);xe(e,s);let d=Number.POSITIVE_INFINITY,l;for(let c=0,u=0;u<4;++c,++u){mt(c%2?i:a,c%4>=2,!1,t),s=ue(e);const f=ht(e,s);f<d&&(u=0,l=pe(s),d=f)}s=ft(e),xe(e,s);for(let c=0,u=0;u<4;++c,++u){mt(c%2?i:a,c%4>=2,!0,t),s=ue(e);const f=ht(e,s);f<d&&(u=0,l=pe(s),d=f)}xe(e,l)},vt=(e,t,n)=>t.map(o=>rr(e,o,n)),mt=(e,t,n,o)=>{const r=new ee;e==null||e.forEach(i=>{var a;const s=i.graph().root,d=jt(i,s,r,t,n,o);for(let l=0;l<((a=d.vs)===null||a===void 0?void 0:a.length);l++){const c=i.node(d.vs[l]);c&&(c.order=l)}sr(i,r,d.vs)})},xe=(e,t)=>{t==null||t.forEach(n=>{n==null||n.forEach((o,r)=>{e.node(o).order=r})})};class mr extends ve{}const yr=(e,t)=>{const n={},o=(r,i)=>{let a=0,s=0;const d=r.length,l=i==null?void 0:i[(i==null?void 0:i.length)-1];return i==null||i.forEach((c,u)=>{var f;const h=wr(e,c),p=h?e.node(h).order:d;(h||c===l)&&((f=i.slice(s,u+1))===null||f===void 0||f.forEach(v=>{var y;(y=e.predecessors(v))===null||y===void 0||y.forEach(w=>{var I;const b=e.node(w),O=b.order;(O<a||p<O)&&!(b.dummy&&(!((I=e.node(v))===null||I===void 0)&&I.dummy))&&At(n,w,v)})}),s=u+1,a=p)}),i};return t!=null&&t.length&&t.reduce(o),n},br=(e,t)=>{const n={};function o(s,d,l,c,u){var f,h;let p;for(let v=d;v<l;v++)p=s[v],!((f=e.node(p))===null||f===void 0)&&f.dummy&&((h=e.predecessors(p))===null||h===void 0||h.forEach(y=>{const w=e.node(y);w.dummy&&(w.order<c||w.order>u)&&At(n,y,p)}))}function r(s){return JSON.stringify(s.slice(1))}function i(s,d){const l=r(s);d.get(l)||(o(...s),d.set(l,!0))}const a=(s,d)=>{let l=-1,c,u=0;const f=new Map;return d==null||d.forEach((h,p)=>{var v;if(((v=e.node(h))===null||v===void 0?void 0:v.dummy)==="border"){const y=e.predecessors(h)||[];y.length&&(c=e.node(y[0]).order,i([d,u,p,l,c],f),u=p,l=c)}i([d,u,d.length,c,s.length],f)}),d};return t!=null&&t.length&&t.reduce(a),n},wr=(e,t)=>{var n,o;if(!((n=e.node(t))===null||n===void 0)&&n.dummy)return(o=e.predecessors(t))===null||o===void 0?void 0:o.find(r=>e.node(r).dummy)},At=(e,t,n)=>{let o=t,r=n;if(o>r){const a=o;o=r,r=a}let i=e[o];i||(e[o]=i={}),i[r]=!0},gr=(e,t,n)=>{let o=t,r=n;if(o>r){const i=t;o=r,r=i}return!!e[o]},xr=(e,t,n,o)=>{const r={},i={},a={};return t==null||t.forEach(s=>{s==null||s.forEach((d,l)=>{r[d]=d,i[d]=d,a[d]=l})}),t==null||t.forEach(s=>{let d=-1;s==null||s.forEach(l=>{let c=o(l);if(c.length){c=c.sort((f,h)=>a[f]-a[h]);const u=(c.length-1)/2;for(let f=Math.floor(u),h=Math.ceil(u);f<=h;++f){const p=c[f];i[l]===l&&d<a[p]&&!gr(n,l,p)&&(i[p]=l,i[l]=r[l]=r[p],d=a[p])}}})}),{root:r,align:i}},Er=(e,t,n,o,r)=>{var i;const a={},s=kr(e,t,n,r),d=r?"borderLeft":"borderRight",l=(f,h)=>{let p=s.nodes(),v=p.pop();const y={};for(;v;)y[v]?f(v):(y[v]=!0,p.push(v),p=p.concat(h(v))),v=p.pop()},c=f=>{a[f]=(s.inEdges(f)||[]).reduce((h,p)=>Math.max(h,(a[p.v]||0)+s.edge(p)),0)},u=f=>{const h=(s.outEdges(f)||[]).reduce((v,y)=>Math.min(v,(a[y.w]||0)-s.edge(y)),Number.POSITIVE_INFINITY),p=e.node(f);h!==Number.POSITIVE_INFINITY&&p.borderType!==d&&(a[f]=Math.max(a[f],h))};return l(c,s.predecessors.bind(s)),l(u,s.successors.bind(s)),(i=Object.values(o))===null||i===void 0||i.forEach(f=>{a[f]=a[n[f]]}),a},kr=(e,t,n,o)=>{const r=new mr,i=e.graph(),a=Mr(i.nodesep,i.edgesep,o);return t==null||t.forEach(s=>{let d;s==null||s.forEach(l=>{const c=n[l];if(r.setNode(c),d){const u=n[d],f=r.edgeFromArgs(u,c);r.setEdge(u,c,Math.max(a(e,l,d),f||0))}d=l})}),r},_r=(e,t)=>Ae(Object.values(t),n=>{var o;let r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return(o=Object.keys(n))===null||o===void 0||o.forEach(a=>{const s=n[a],d=Or(e,a)/2;r=Math.max(s+d,r),i=Math.min(s-d,i)}),r-i});function Nr(e,t){const n=Object.values(t),o=ut(n),r=De(n);["u","d"].forEach(i=>{["l","r"].forEach(a=>{const s=i+a,d=e[s];let l;if(d===t)return;const c=Object.values(d);l=a==="l"?o-ut(c):r-De(c),l&&(e[s]={},Object.keys(d).forEach(u=>{e[s][u]=d[u]+l}))})})}const Ir=(e,t)=>{const n={};return Object.keys(e.ul).forEach(o=>{if(t)n[o]=e[t.toLowerCase()][o];else{const r=Object.values(e).map(i=>i[o]);n[o]=(r[0]+r[1])/2}}),n},Mr=(e,t,n)=>(o,r,i)=>{const a=o.node(r),s=o.node(i);let d=0,l;if(d+=a.width/2,a.hasOwnProperty("labelpos"))switch((a.labelpos||"").toLowerCase()){case"l":l=-a.width/2;break;case"r":l=a.width/2;break}if(l&&(d+=n?l:-l),l=0,d+=(a.dummy?t:e)/2,d+=(s.dummy?t:e)/2,d+=s.width/2,s.labelpos)switch((s.labelpos||"").toLowerCase()){case"l":l=s.width/2;break;case"r":l=-s.width/2;break}return l&&(d+=n?l:-l),l=0,d},Or=(e,t)=>e.node(t).width||0,Lr=e=>{const t=ue(e),n=e.graph().ranksep;let o=0;t==null||t.forEach(r=>{const i=r.map(s=>e.node(s).height),a=Math.max(...i,0);r==null||r.forEach(s=>{e.node(s).y=o+a/2}),o+=a+n})},Pr=e=>{const t=ue(e),n=Object.assign(yr(e,t),br(e,t)),o={};let r=[];["u","d"].forEach(a=>{r=a==="u"?t:Object.values(t).reverse(),["l","r"].forEach(s=>{s==="r"&&(r=r.map(u=>Object.values(u).reverse()));const d=(a==="u"?e.predecessors:e.successors).bind(e),l=xr(e,r,n,d),c=Er(e,r,l.root,l.align,s==="r");s==="r"&&Object.keys(c).forEach(u=>c[u]=-c[u]),o[a+s]=c})});const i=_r(e,o);return i&&Nr(o,i),Ir(o,e.graph().align)},Sr=e=>{var t;const n=_t(e);Lr(n);const o=Pr(n);(t=Object.keys(o))===null||t===void 0||t.forEach(r=>{n.node(r).x=o[r]})},Tr=(e,t)=>{const o=e.nodes().filter(a=>{var s;return!(!((s=e.children(a))===null||s===void 0)&&s.length)}).map(a=>e.node(a).rank),r=Math.max(...o),i=[];for(let a=0;a<r+1;a++)i[a]=[];t==null||t.forEach(a=>{const s=e.node(a);!s||s!=null&&s.dummy||isNaN(s.rank)||(s.fixorder=i[s.rank].length,i[s.rank].push(a))})},Dr=(e,t)=>{const n=t&&t.debugTiming?It:Mt;n("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&n("  inheritOrder",()=>{Rr(e,t.prevGraph)});const o=n("  buildLayoutGraph",()=>$r(e));t&&t.edgeLabelSpace===!1||n("  makeSpaceForEdgeLabels",()=>{Wr(o)});try{n("  runLayout",()=>{Cr(o,n,t)})}catch(r){if(r.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,r);return}throw r}n("  updateInputGraph",()=>{Fr(e,o)})})},Cr=(e,t,n)=>{t("    removeSelfEdges",()=>{Zr(e)}),t("    acyclic",()=>{tt.run(e)}),t("    nestingGraph.run",()=>{at.run(e)}),t("    rank",()=>{Vo(_t(e))}),t("    injectEdgeLabelProxies",()=>{Ur(e)}),t("    removeEmptyRanks",()=>{wo(e)}),t("    nestingGraph.cleanup",()=>{at.cleanup(e)}),t("    normalizeRanks",()=>{bo(e)}),t("    assignRankMinMax",()=>{qr(e)}),t("    removeEdgeLabelProxies",()=>{Yr(e)}),t("    normalize.run",()=>{rt.run(e)}),t("    parentDummyChains",()=>{Wo(e)}),t("    addBorderSegments",()=>{Jo(e)}),n&&n.keepNodeOrder&&t("    initDataOrder",()=>{Tr(e,n.nodeOrder)}),t("    order",()=>{vr(e,n==null?void 0:n.keepNodeOrder)}),t("    insertSelfEdges",()=>{ei(e)}),t("    adjustCoordinateSystem",()=>{ct.adjust(e)}),t("    position",()=>{Sr(e)}),t("    positionSelfEdges",()=>{ti(e)}),t("    removeBorderNodes",()=>{Qr(e)}),t("    normalize.undo",()=>{rt.undo(e)}),t("    fixupEdgeLabelCoords",()=>{Kr(e)}),t("    undoCoordinateSystem",()=>{ct.undo(e)}),t("    translateGraph",()=>{Hr(e)}),t("    assignNodeIntersects",()=>{Jr(e)}),t("    reversePoints",()=>{Xr(e)}),t("    acyclic.undo",()=>{tt.undo(e)})},Rr=(e,t)=>{e.nodes().forEach(n=>{const o=e.node(n),r=t.node(n);r!==void 0?(o.fixorder=r._order,delete r._order):delete o.fixorder})},Fr=(e,t)=>{e.nodes().forEach(n=>{var o;const r=e.node(n);if(r){const i=t.node(n);r.x=i.x,r.y=i.y,r._order=i.order,r._rank=i.rank,!((o=t.children(n))===null||o===void 0)&&o.length&&(r.width=i.width,r.height=i.height)}}),e.edges().forEach(n=>{const o=e.edge(n),r=t.edge(n);o.points=r?r.points:[],r&&r.hasOwnProperty("x")&&(o.x=r.x,o.y=r.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},jr=["nodesep","edgesep","ranksep","marginx","marginy"],Ar={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Ee=["acyclicer","ranker","rankdir","align"],Vr=["width","height","layer","fixorder"],Br={width:0,height:0},Gr=["minlen","weight","width","height","labeloffset"],zr={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ke=["labelpos"],$r=e=>{const t=new ee({multigraph:!0,compound:!0}),n=Ne(e.graph()),o={};return Ee==null||Ee.forEach(r=>{n[r]!==void 0&&(o[r]=n[r])}),t.setGraph(Object.assign({},Ar,_e(n,jr),o)),e.nodes().forEach(r=>{const i=Ne(e.node(r)),a=Object.assign(Object.assign({},Br),i),s=_e(a,Vr);t.setNode(r,s),t.setParent(r,e.parent(r))}),e.edges().forEach(r=>{const i=Ne(e.edge(r)),a={};ke==null||ke.forEach(s=>{i[s]!==void 0&&(a[s]=i[s])}),t.setEdgeObj(r,Object.assign({},zr,_e(i,Gr),a))}),t},Wr=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach(n=>{const o=e.node(n);isNaN(o.layer)||o.layer||(o.layer=0)}),e.edges().forEach(n=>{var o;const r=e.edge(n);r.minlen*=2,((o=r.labelpos)===null||o===void 0?void 0:o.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?r.width+=r.labeloffset:r.height+=r.labeloffset)})},Ur=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n.width&&n.height){const o=e.node(t.v),r=e.node(t.w),i={e:t,rank:(r.rank-o.rank)/2+o.rank};ie(e,"edge-proxy",i,"_ep")}})},qr=e=>{let t=0;e.nodes().forEach(n=>{var o,r;const i=e.node(n);i.borderTop&&(i.minRank=(o=e.node(i.borderTop))===null||o===void 0?void 0:o.rank,i.maxRank=(r=e.node(i.borderBottom))===null||r===void 0?void 0:r.rank,t=Math.max(t,i.maxRank||-1/0))}),e.graph().maxRank=t},Yr=e=>{e.nodes().forEach(t=>{const n=e.node(t);n.dummy==="edge-proxy"&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))})},Hr=e=>{let t,n=0,o,r=0;const i=e.graph(),a=i.marginx||0,s=i.marginy||0,d=l=>{if(!l)return;const c=l.x,u=l.y,f=l.width,h=l.height;!isNaN(c)&&!isNaN(f)&&(t===void 0&&(t=c-f/2),t=Math.min(t,c-f/2),n=Math.max(n,c+f/2)),!isNaN(u)&&!isNaN(h)&&(o===void 0&&(o=u-h/2),o=Math.min(o,u-h/2),r=Math.max(r,u+h/2))};e.nodes().forEach(l=>{d(e.node(l))}),e.edges().forEach(l=>{const c=e.edge(l);c!=null&&c.hasOwnProperty("x")&&d(c)}),t-=a,o-=s,e.nodes().forEach(l=>{const c=e.node(l);c&&(c.x-=t,c.y-=o)}),e.edges().forEach(l=>{var c;const u=e.edge(l);(c=u.points)===null||c===void 0||c.forEach(f=>{f.x-=t,f.y-=o}),u.hasOwnProperty("x")&&(u.x-=t),u.hasOwnProperty("y")&&(u.y-=o)}),i.width=n-t+a,i.height=r-o+s},Jr=e=>{e.edges().forEach(t=>{const n=e.edge(t),o=e.node(t.v),r=e.node(t.w);let i,a;n.points?(i=n.points[0],a=n.points[n.points.length-1]):(n.points=[],i=r,a=o),n.points.unshift(nt(o,i)),n.points.push(nt(r,a))})},Kr=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n!=null&&n.hasOwnProperty("x"))switch((n.labelpos==="l"||n.labelpos==="r")&&(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset;break}})},Xr=e=>{e.edges().forEach(t=>{var n;const o=e.edge(t);o.reversed&&((n=o.points)===null||n===void 0||n.reverse())})},Qr=e=>{e.nodes().forEach(t=>{var n,o,r;if(!((n=e.children(t))===null||n===void 0)&&n.length){const i=e.node(t),a=e.node(i.borderTop),s=e.node(i.borderBottom),d=e.node(i.borderLeft[((o=i.borderLeft)===null||o===void 0?void 0:o.length)-1]),l=e.node(i.borderRight[((r=i.borderRight)===null||r===void 0?void 0:r.length)-1]);i.width=Math.abs((l==null?void 0:l.x)-(d==null?void 0:d.x))||10,i.height=Math.abs((s==null?void 0:s.y)-(a==null?void 0:a.y))||10,i.x=((d==null?void 0:d.x)||0)+i.width/2,i.y=((a==null?void 0:a.y)||0)+i.height/2}}),e.nodes().forEach(t=>{var n;((n=e.node(t))===null||n===void 0?void 0:n.dummy)==="border"&&e.removeNode(t)})},Zr=e=>{e.edges().forEach(t=>{if(t.v===t.w){const n=e.node(t.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdgeObj(t)}})},ei=e=>{const t=ue(e);t==null||t.forEach(n=>{let o=0;n==null||n.forEach((r,i)=>{var a;const s=e.node(r);s.order=i+o,(a=s.selfEdges)===null||a===void 0||a.forEach(d=>{ie(e,"selfedge",{width:d.label.width,height:d.label.height,rank:s.rank,order:i+ ++o,e:d.e,label:d.label},"_se")}),delete s.selfEdges})})},ti=e=>{e.nodes().forEach(t=>{const n=e.node(t);if(n.dummy==="selfedge"){const o=e.node(n.e.v),r=o.x+o.width/2,i=o.y,a=n.x-r,s=o.height/2;e.setEdgeObj(n.e,n.label),e.removeNode(t),n.label.points=[{x:r+2*a/3,y:i-s},{x:r+5*a/6,y:i-s},{y:i,x:r+a},{x:r+5*a/6,y:i+s},{x:r+2*a/3,y:i+s}],n.label.x=n.x,n.label.y=n.y}})},_e=(e,t)=>{const n={};return t==null||t.forEach(o=>{e[o]!==void 0&&(n[o]=+e[o])}),n},Ne=(e={})=>{const t={};return Object.keys(e).forEach(n=>{t[n.toLowerCase()]=e[n]}),t},ni={layout:Dr,util:{time:It,notime:Mt}};class oi extends Mn{constructor(t){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.radial=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=n=>{const o=this,{nodes:r}=o,i=r.find(a=>a.id===n);return i?i.layout!==!1:!0},this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1,radial:!1,focusNode:null}}execute(){var t,n,o,r;const i=this,{nodes:a,nodeSize:s,rankdir:d,combos:l,begin:c,radial:u,comboEdges:f=[],vedges:h=[]}=i;if(!a)return;const p=i.edges||[],v=new ee({multigraph:!0,compound:!0});i.nodeMap={};const y={};a.forEach(m=>{i.nodeMap[m.id]=m,m.comboId&&(y[m.comboId]=y[m.comboId]||[],y[m.comboId].push(m.id))});let w=[];const I={};!((t=i.nodeOrder)===null||t===void 0)&&t.length?(i.nodeOrder.forEach(m=>{I[m]=!0,w.push(i.nodeMap[m])}),a.forEach(m=>{I[m.id]||w.push(m)})):w=a;let b;s?Je(s)?b=()=>s:b=()=>[s,s]:b=m=>m.size?Je(m.size)?m.size:bt(m.size)?[m.size.width||40,m.size.height||40]:[m.size,m.size]:[40,40];const O=Ke(i.ranksep,50,i.ranksepFunc),R=Ke(i.nodesep,50,i.nodesepFunc);let g=R,F=O;(d==="LR"||d==="RL")&&(g=O,F=R),v.setDefaultEdgeLabel(()=>({})),v.setGraph(i);const S={};this.sortByCombo&&l&&l.forEach(m=>{if(S[m.id]=m,m.collapsed){const L=b(m),T=F(m),P=g(m),V=L[0]+2*P,E=L[1]+2*T;v.setNode(m.id,{width:V,height:E})}m.parentId&&(S[m.parentId]||v.setNode(m.parentId,{}),v.setParent(m.id,m.parentId))}),w.filter(m=>m.layout!==!1).forEach(m=>{const L=b(m),T=F(m),P=g(m),V=L[0]+2*P,E=L[1]+2*T,N=m.layer;he(N)?v.setNode(m.id,{width:V,height:E,layer:N}):v.setNode(m.id,{width:V,height:E}),this.sortByCombo&&m.comboId&&(S[m.comboId]||(S[m.comboId]={id:m.comboId},v.setNode(m.comboId,{})),v.setParent(m.id,m.comboId))}),p.forEach(m=>{const L=ne(m,"source"),T=ne(m,"target");this.layoutNode(L)&&this.layoutNode(T)&&v.setEdge(L,T,{weight:m.weight||1})}),(n=f==null?void 0:f.concat(h||[]))===null||n===void 0||n.forEach(m=>{var L,T;const{source:P,target:V}=m,E=!((L=S[P])===null||L===void 0)&&L.collapsed?[P]:y[P]||[P],N=!((T=S[V])===null||T===void 0)&&T.collapsed?[V]:y[V]||[V];E.forEach(k=>{N.forEach(M=>{v.setEdge(k,M,{weight:m.weight||1})})})});let A;!((o=i.preset)===null||o===void 0)&&o.nodes&&(A=new ee({multigraph:!0,compound:!0}),i.preset.nodes.forEach(m=>{A==null||A.setNode(m.id,m)})),ni.layout(v,{prevGraph:A,edgeLabelSpace:i.edgeLabelSpace,keepNodeOrder:!!i.nodeOrder,nodeOrder:i.nodeOrder});const C=[0,0];if(c){let m=1/0,L=1/0;v.nodes().forEach(T=>{const P=v.node(T);m>P.x&&(m=P.x),L>P.y&&(L=P.y)}),v.edges().forEach(T=>{var P;(P=v.edge(T).points)===null||P===void 0||P.forEach(E=>{m>E.x&&(m=E.x),L>E.y&&(L=E.y)})}),C[0]=c[0]-m,C[1]=c[1]-L}const U=d==="LR"||d==="RL";if(u){const{focusNode:m,ranksep:L,getRadialPos:T}=this,P=On(m)?m:m==null?void 0:m.id,V=P?(r=v.node(P))===null||r===void 0?void 0:r._rank:0,E=[],N=U?"y":"x",k=U?"height":"width";let M=1/0,B=-1/0;v.nodes().forEach(x=>{const _=v.node(x);if(!i.nodeMap[x])return;const $=R(i.nodeMap[x]);if(V===0)E[_._rank]||(E[_._rank]={nodes:[],totalWidth:0,maxSize:-1/0}),E[_._rank].nodes.push(x),E[_._rank].totalWidth+=$*2+_[k],E[_._rank].maxSize<Math.max(_.width,_.height)&&(E[_._rank].maxSize=Math.max(_.width,_.height));else{const D=_._rank-V;if(D===0)E[D]||(E[D]={nodes:[],totalWidth:0,maxSize:-1/0}),E[D].nodes.push(x),E[D].totalWidth+=$*2+_[k],E[D].maxSize<Math.max(_.width,_.height)&&(E[D].maxSize=Math.max(_.width,_.height));else{const j=Math.abs(D);E[j]||(E[j]={left:[],right:[],totalWidth:0,maxSize:-1/0}),E[j].totalWidth+=$*2+_[k],E[j].maxSize<Math.max(_.width,_.height)&&(E[j].maxSize=Math.max(_.width,_.height)),D<0?E[j].left.push(x):E[j].right.push(x)}}const H=_[N]-_[k]/2-$,W=_[N]+_[k]/2+$;H<M&&(M=H),W>B&&(B=W)});let G=L||50;const z={},K=(B-M)/.9,Ve=[(M+B-K)*.5,(M+B+K)*.5],me=(x,_,$=-1/0,H=[0,1])=>{let W=$;return x.forEach(D=>{const j=v.node(D);z[D]=_;const{x:X,y:q}=T(j[N],Ve,K,_,H);if(!i.nodeMap[D])return;i.nodeMap[D].x=X+C[0],i.nodeMap[D].y=q+C[1],i.nodeMap[D]._order=j._order;const Y=O(i.nodeMap[D]);W<Y&&(W=Y)}),W};let ye=!0;const zt=0;E.forEach(x=>{var _,$,H,W,D,j,X;if(!(!((_=x==null?void 0:x.nodes)===null||_===void 0)&&_.length)&&!(!(($=x==null?void 0:x.left)===null||$===void 0)&&$.length)&&!(!((H=x==null?void 0:x.right)===null||H===void 0)&&H.length))return;if(ye&&x.nodes.length===1){const Y=x.nodes[0];if(!i.nodeMap[Y])return;i.nodeMap[Y].x=C[0],i.nodeMap[Y].y=C[1],z[x.nodes[0]]=0,G=O(i.nodeMap[Y]),ye=!1;return}G=Math.max(G,x.totalWidth/(2*Math.PI));let q=-1/0;if(V===0||!((W=x.nodes)===null||W===void 0)&&W.length)q=me(x.nodes,G,q,[0,1]);else{const Y=((D=x.left)===null||D===void 0?void 0:D.length)/(((j=x.left)===null||j===void 0?void 0:j.length)+((X=x.right)===null||X===void 0?void 0:X.length));q=me(x.left,G,q,[0,Y]),q=me(x.right,G,q,[Y+.05,1])}G+=q,ye=!1,zt-x.maxSize}),v.edges().forEach(x=>{var _,$,H;const W=v.edge(x),D=p.findIndex(j=>{const X=ne(j,"source"),q=ne(j,"target");return X===x.v&&q===x.w});if(!(D<=-1)&&i.edgeLabelSpace&&i.controlPoints&&p[D].type!=="loop"){const j=N==="x"?"y":"x",X=(_=W==null?void 0:W.points)===null||_===void 0?void 0:_.slice(1,W.points.length-1),q=[],Y=($=v.node(x.v))===null||$===void 0?void 0:$[j],$t=Y-((H=v.node(x.w))===null||H===void 0?void 0:H[j]),Be=z[x.v],Wt=Be-z[x.w];X==null||X.forEach(Ge=>{const Ut=(Ge[j]-Y)/$t*Wt+Be,ze=T(Ge[N],Ve,K,Ut);q.push({x:ze.x+C[0],y:ze.y+C[1]})}),p[D].controlPoints=q}})}else{const m=new Set,T=d==="BT"||d==="RL"?(N,k)=>k-N:(N,k)=>N-k;v.nodes().forEach(N=>{const k=v.node(N);if(!k)return;let M=this.nodeMap[N];M||(M=l==null?void 0:l.find(B=>B.id===N)),M&&(M.x=k.x+C[0],M.y=k.y+C[1],M._order=k._order,m.add(U?M.x:M.y))});const P=Array.from(m).sort(T),V=U?(N,k)=>N.x!==k.x:(N,k)=>N.y!==k.y,E=U?(N,k,M)=>{const B=Math.max(k.y,M.y),G=Math.min(k.y,M.y);return N.filter(z=>z.y<=B&&z.y>=G)}:(N,k,M)=>{const B=Math.max(k.x,M.x),G=Math.min(k.x,M.x);return N.filter(z=>z.x<=B&&z.x>=G)};v.edges().forEach(N=>{var k;const M=v.edge(N),B=p.findIndex(G=>{const z=ne(G,"source"),K=ne(G,"target");return z===N.v&&K===N.w});if(!(B<=-1)&&i.edgeLabelSpace&&i.controlPoints&&p[B].type!=="loop"){(k=M==null?void 0:M.points)===null||k===void 0||k.forEach(K=>{K.x+=C[0],K.y+=C[1]});const G=i.nodeMap[N.v],z=i.nodeMap[N.w];p[B].controlPoints=ri(M==null?void 0:M.points,G,z,P,U,V,E)}})}return i.onLayoutEnd&&i.onLayoutEnd(),{nodes:a,edges:p}}getRadialPos(t,n,o,r,i=[0,1]){let a=(t-n[0])/o;a=a*(i[1]-i[0])+i[0];const s=a*2*Math.PI;return{x:Math.cos(s)*r,y:Math.sin(s)*r}}getType(){return"dagre"}}const ri=(e,t,n,o,r,i,a)=>{let s=(e==null?void 0:e.slice(1,e.length-1))||[];if(t&&n){let{x:d,y:l}=t,{x:c,y:u}=n;if(r&&(d=t.y,l=t.x,c=n.y,u=n.x),u!==l&&d!==c){const f=o.indexOf(l),h=o[f+1];if(h){const y=s[0],w=r?{x:(l+h)/2,y:(y==null?void 0:y.y)||c}:{x:(y==null?void 0:y.x)||c,y:(l+h)/2};(!y||i(y,w))&&s.unshift(w)}const p=o.indexOf(u),v=Math.abs(p-f);if(v===1)s=a(s,t,n),s.length||s.push(r?{x:(l+u)/2,y:d}:{x:d,y:(l+u)/2});else if(v>1){const y=o[p-1];if(y){const w=s[s.length-1],I=r?{x:(u+y)/2,y:(w==null?void 0:w.y)||c}:{x:(w==null?void 0:w.x)||d,y:(u+y)/2};(!w||i(w,I))&&s.push(I)}}}}return s};class Vt{constructor(){Q(this,"lf");Q(this,"option")}render(t){this.lf=t}getBytesLength(t){if(!t)return 0;let n=0;for(let o=0;o<t.length;o++){const r=t.charCodeAt(o);t.match(/[A-Z]/)?n+=1.5:r>=1&&r<=126||r>=65376&&r<=65439?n+=1:n+=2}return n}layout(t={}){const{nodes:n,edges:o,gridSize:r}=this.lf.graphModel;let i=40,a=40;r>20&&(i=r*2,a=r*2),this.option={type:"dagre",rankdir:"LR",align:"DR",nodesep:i,ranksep:a,begin:[120,120],...t};const d=new oi(this.option).layout({nodes:n.map(c=>({id:c.id,size:{width:c.width,height:c.height},model:c})),edges:o.map(c=>({source:c.sourceNodeId,target:c.targetNodeId,model:c}))}),l={nodes:[],edges:[]};d.nodes.forEach(c=>{const{model:u}=c,f=u.getData();f.x=c.x,f.y=c.y,l.nodes.push(f)}),d.edges.forEach(c=>{const{model:u}=c,f=u.getData();if(f.pointsList=this.calcPointsList(u,l.nodes),f.pointsList){const h=f.pointsList[0],p=f.pointsList[f.pointsList.length-1];f.startPoint={x:h.x,y:h.y},f.endPoint={x:p.x,y:p.y},f.text&&f.text.value&&(f.text={x:p.x-this.getBytesLength(f.text.value)*6-10,y:p.y,value:f.text.value})}else f.startPoint=void 0,f.endPoint=void 0,f.text&&f.text.value&&(f.text=f.text.value);l.edges.push(f)}),this.lf.renderRawData(l)}pointFilter(t){const n=t;let o=1;for(;o<n.length-1;){const r=n[o-1],i=n[o],a=n[o+1];r.x===i.x&&i.x===a.x||r.y===i.y&&i.y===a.y?n.splice(o,1):o++}return n}calcPointsList(t,n){const o=[];if(this.option.rankdir==="LR"&&t.modelType==="polyline-edge"){const r=this.lf.getNodeModelById(t.sourceNodeId),i=this.lf.getNodeModelById(t.targetNodeId),a=n.find(d=>d.id===t.sourceNodeId),s=n.find(d=>d.id===t.targetNodeId);if(a.x<s.x)return o.push({x:a.x+r.width/2,y:a.y}),o.push({x:a.x+r.width/2+(t.offset||50),y:a.y}),o.push({x:a.x+r.width/2+(t.offset||50),y:s.y}),o.push({x:s.x-i.width/2,y:s.y}),this.pointFilter(o);if(a.x>s.x)return a.y>=s.y?(o.push({x:a.x,y:a.y+r.height/2}),o.push({x:a.x,y:a.y+r.height/2+(t.offset||50)}),o.push({x:s.x,y:a.y+r.height/2+(t.offset||50)}),o.push({x:s.x,y:s.y+i.height/2})):(o.push({x:a.x,y:a.y-r.height/2}),o.push({x:a.x,y:a.y-r.height/2-(t.offset||50)}),o.push({x:s.x,y:a.y-r.height/2-(t.offset||50)}),o.push({x:s.x,y:s.y-i.height/2})),this.pointFilter(o)}}}Q(Vt,"pluginName","dagre");class ii extends Qt{constructor({lf:t}){super({lf:t});const n={text:"复制",icon:!0,className:"lf-menu-copy",callback:b=>t.cloneNode(b.id)},o={text:"删除",icon:!0,className:"lf-menu-delete",callback:b=>{t.deleteNode(b.id),t.deleteEdge(b.id)}},r={text:"编辑文本",icon:!0,className:"lf-menu-edit",callback:b=>t.graphModel.editText(b.id)},i={text:"删除文本",icon:!0,className:"lf-menu-delete",callback:b=>t.updateText(b.id,"")},a={text:"框选",icon:!0,className:"lf-menu-select",callback(){t.openSelectionSelect(),t.once("selection:selected",t.closeSelectionSelect)}},s={text:"清空",icon:!0,className:"lf-menu-clear",callback(){t.clearData()}},d={text:"添加",icon:!0,className:"lf-menu-add",callback:b=>{console.log("🚀 ~ file: menu.ts:66 ~ Menu ~ constructor ~ ele:",b),["endEvent","serviceTask","note"].includes(b.type)?y(b,[l]):y(b,I.nodeMenu)}},l={text:"",icon:!0,className:"lf-menu-back",callback:b=>{y(b,w.nodeMenu)}},c={text:"用户任务",icon:!0,className:"lf-menu-user-task",callback:b=>{const{x:O,y:R}=b,g=t.addNode({type:"userTask",x:O+200,y:R});t.addEdge({sourceNodeId:b.id,targetNodeId:g.id})}},u={text:"服务任务",icon:!0,className:"lf-menu-service-task",callback:b=>{const{x:O,y:R}=b,g=t.addNode({type:"serviceTask",x:O+200,y:R});t.addEdge({type:"noteFlow",sourceNodeId:b.id,targetNodeId:g.id})}},f={text:"结束",icon:!0,className:"lf-menu-end-event",callback:b=>{const{x:O,y:R}=b,g=t.addNode({type:"endEvent",x:O+150,y:R});t.addEdge({sourceNodeId:b.id,targetNodeId:g.id})}},h={text:"互斥网关",icon:!0,className:"lf-menu-exclusive-gateway",callback:b=>{const{x:O,y:R}=b,g=t.addNode({type:"exclusiveGateway",x:O+150,y:R});t.addEdge({sourceNodeId:b.id,targetNodeId:g.id})}},p={text:"并行网关",icon:!0,className:"lf-menu-parallel-gateway",callback:b=>{const{x:O,y:R}=b,g=t.addNode({type:"parallelGateway",x:O+150,y:R});t.addEdge({sourceNodeId:b.id,targetNodeId:g.id})}},v={text:"注释",icon:!0,className:"lf-menu-note",callback:b=>{const{x:O,y:R}=b,g=t.addNode({type:"note",x:O,y:R-150});t.addEdge({type:"noteFlow",sourceNodeId:b.id,targetNodeId:g.id})}},y=(b,O)=>{setTimeout(()=>{this.__currentData=b;const{left:R,top:g}=this.__menuDOM.style;this.showMenu(R,g,O)})},w={nodeMenu:[d,n,o,r,i],edgeMenu:[o,r,i],graphMenu:[a,s]},I={nodeMenu:[l,c,u,h,p,f,v]};this.setMenuConfig(w)}}class si extends Zt{constructor({lf:t}){super({lf:t}),this.setPatternItems([{label:"框选",icon:"https://api.iconify.design/bpmn/lasso-tool.svg?width=24&height=24",callback(){t.openSelectionSelect(),t.once("selection:selected",t.closeSelectionSelect)}},{type:"group",label:"子流程",icon:"https://api.iconify.design/bpmn/subprocess-expanded.svg?width=24&height=24"},{type:"startEvent",text:"开始",label:"开始节点",icon:"https://api.iconify.design/bpmn/start-event.svg?width=24&height=24"},{type:"endEvent",text:"结束",label:"结束节点",icon:"https://api.iconify.design/bpmn/end-event.svg?width=24&height=24"},{type:"userTask",label:"用户任务",icon:"https://api.iconify.design/bpmn/user-task.svg?width=24&height=24"},{type:"serviceTask",label:"服务任务",icon:"https://api.iconify.design/bpmn/service-task.svg?width=24&height=24"},{type:"exclusiveGateway",label:"互斥网关",icon:"https://api.iconify.design/bpmn/gateway-xor.svg?width=24&height=24"},{type:"parallelGateway",label:"并行网关",icon:"https://api.iconify.design/bpmn/gateway-parallel.svg?width=24&height=24"},{type:"note",label:"注释",icon:"https://api.iconify.design/bpmn/text-annotation.svg?width=24&height=24"}])}}const Bt={type:"process",key:"Process",properties:{}};function ai(e){const{id:t,type:n,x:o,y:r,properties:i,children:a,text:s}=e;return{incoming:[],outgoing:[],children:a,type:n,key:t,groupKey:i==null?void 0:i.groupKey,properties:{...i,name:Fe(s)?s:(s==null?void 0:s.value)??"",x:o,y:r,text:s}}}function di(e){const{id:t,type:n,sourceNodeId:o,targetNodeId:r,startPoint:i,endPoint:a,pointsList:s,properties:d,text:l}=e;return{incoming:[o],outgoing:[r],type:n,key:t,groupKey:d==null?void 0:d.groupKey,properties:{...d,name:Fe(l)?l:(l==null?void 0:l.value)??"",text:l,startPoint:i,endPoint:a,pointsList:s}}}function li(e){const{id:t,type:n,properties:o,text:r}=e;return{type:n,key:t,properties:{...o,name:Fe(r)?r:(r==null?void 0:r.value)??""}}}function ci(e){const t=new Map,n={processData:Bt,flowElementList:[]};return e.nodes.forEach(o=>{var r;if(o.type==="process")n.processData=li(o);else{const i=ai(o);(r=n.flowElementList)==null||r.push(i),t.set(o.id,i)}}),e.edges.forEach(o=>{var s;const r=di(o);t.get(o.sourceNodeId).outgoing.push(r.key),t.get(o.targetNodeId).incoming.push(r.key),(s=n.flowElementList)==null||s.push(r)}),n}function ui(e){const{incoming:t,outgoing:n,properties:o,key:r,type:i}=e,{text:a,name:s,startPoint:d,endPoint:l,pointsList:c}=o??{},u={id:r,type:i,sourceNodeId:(t==null?void 0:t[0])??"",targetNodeId:(n==null?void 0:n[0])??"",text:a||s,startPoint:d,endPoint:l,pointsList:c,properties:{}},f=["startPoint","endPoint","pointsList","text"];return u.properties=Re(o,f),u}function fi(e){const{properties:t,key:n,type:o,children:r}=e,{x:i,y:a,text:s,name:d}=t??{},l={id:n,type:o??"",x:i,y:a,text:s||d,children:r,properties:{}},c=["x","y","text"];return l.properties=Re(t,c),l}function hi(e){const{properties:t,key:n,type:o}=e,{name:r}=t??{},i={id:n,type:o??"",text:r,x:0,y:0},a=["x","y","text"];return i.properties=Re(t,a),i}function pi(e){const{flowElementList:t}=e,n=a=>["sequenceFlow","noteFlow"].includes(a),o=(t==null?void 0:t.filter(a=>!n(a.type)).map(fi))??[],r=(t==null?void 0:t.filter(a=>n(a.type)).map(ui))??[];return o.unshift(hi(e.processData??Bt)),{nodes:o,edges:r}}class Ce{constructor({lf:t}){t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut}adapterOut(t){return ci(t)}adapterIn(t){return pi(t)}}Q(Ce,"pluginName","turboAdapter");class Gt{constructor({lf:t}){Q(this,"lf");Q(this,"container");Q(this,"__tooltipDOM");Q(this,"__tooltips",[]);this.__tooltipDOM=document.createElement("div"),this.__tooltipDOM.className="lf-tooltip",this.__tooltipDOM.style.position="absolute",this.__tooltipDOM.style.display="none",this.lf=t}render(t,n){this.container=n,n.appendChild(this.__tooltipDOM),t.on("node:mouseenter,edge:mouseenter",({data:o,e:r})=>{var l;const i=(l=this.__tooltips.find(c=>c.id===o.id))==null?void 0:l.content;if(!i)return;this.__tooltipDOM.innerHTML=i;const a=t.getPointByClient(r.x,r.y),{domOverlayPosition:{x:s,y:d}}=a;this.__tooltipDOM.style.top=`${d+10}px`,this.__tooltipDOM.style.left=`${s+10}px`,this.__tooltipDOM.style.display="block"}),t.on("node:mouseleave,edge:mouseleave",()=>{this.__tooltipDOM.style.display="none"})}setTooltips(t){this.__tooltips=t}}Q(Gt,"pluginName","tooltip");function vi({props:e,state:t}){const{lf:n,graphData:o}=t;function r(a){var s;n.value=new $e.LogicFlow({container:a,grid:{type:"dot",size:10},nodeTextDraggable:!0,edgeTextDraggable:!0,nodeTextEdit:!0,edgeTextEdit:!0,plugins:[In,si,en,ii,tn,nn,We,Ue,Ce,Vt],edgeGenerator:(d,l)=>{if(["note","serviceTask"].includes(l.type))return"noteFlow"},...e.initOptions}),(s=n.value)==null||s.setTheme(Ye),Nn(t),qe(o,d=>{var f,h,p;const l=JSON.stringify(d),c=JSON.stringify((f=n.value)==null?void 0:f.getGraphData());l!==c&&((h=n.value)==null||h.render(d),(p=n.value)==null||p.emit("element:click",{isForce:!0}))},{immediate:!0})}function i(a){var s;n.value=new $e.LogicFlow({container:a,grid:{type:"dot",size:10},isSilentMode:!0,plugins:[We,Ue,Ce,Gt],...e.initOptions}),(s=n.value)==null||s.setTheme(Ye),qe(()=>[o.value,e.styles,e.tooltips],async()=>{var d,l,c,u;(d=n.value)==null||d.render(o.value),await Ie(),(l=e.styles)==null||l.forEach(({id:f,style:h})=>{var p,v;f&&((v=(p=n.value)==null?void 0:p.graphModel)==null||v.updateAttributes(f,{style:h}))}),(u=(c=n.value)==null?void 0:c.extension.tooltip)==null||u.setTooltips(e.tooltips??[])},{immediate:!0})}return{initViewer:i,initModeler:r}}const mi=fn("span",null,"编辑JSON",-1),yi=yt({__name:"flow-editor",props:{modelValue:{},visible:{type:Boolean}},emits:["confirm"],setup(e,{emit:t}){const o=Jt(e),{modelValue:r,visible:i}=o,a=ln("");function s(){const d=JSON.parse(a.value);r.value=d,t("confirm",d),i.value=!1}return cn(()=>{a.value=JSON.stringify(r.value,null,2)}),(d,l)=>{const c=Z("el-input"),u=Z("el-button"),f=Z("el-drawer");return oe(),se(f,{modelValue:J(i),"onUpdate:modelValue":l[1]||(l[1]=h=>ae(i)?i.value=h:null)},{header:re(()=>[mi,Me(d.$slots,"header")]),default:re(()=>[de(c,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=h=>a.value=h),class:"flow-editor__textarea",type:"textarea"},null,8,["modelValue"]),de(u,{class:"flow-editor__confirm-btn",type:"primary",onClick:s},{default:re(()=>[un(" 确定 ")]),_:1})]),_:3},8,["modelValue"])}}}),bi=["id"],_s=yt({__name:"index",props:{lf:{},initOptions:{},modelValue:{},elementData:{},formOptions:{},formData:{},formOption:{},formDefaults:{},formWidth:{},dataOptions:{},type:{},styles:{},tooltips:{}},setup(e){const t=e,n=Kt(t),{lf:o,graphData:r,formRef:i,formData:a,formOption:s,formDefaults:d,formLoading:l,editorVisible:c,onUpdateFormData:u}=n,{initModeler:f,initViewer:h}=vi({props:t,state:n}),p=bn("logicflow-container");return hn(()=>{const v=document.querySelector(`#${p}`);t.type==="viewer"?h(v):f(v)}),(v,y)=>{const w=Z("el-main"),I=Z("el-empty"),b=Z("el-skeleton"),O=Z("avue-form"),R=Z("el-aside"),g=Z("el-container");return v.type==="viewer"?(oe(),pn("div",{key:0,id:J(p),class:"lf-container"},null,8,bi)):(oe(),se(g,{key:1,class:"lf-container"},{default:re(()=>[de(w,{id:J(p),class:"lf-main"},null,8,["id"]),de(R,{width:v.formWidth,class:"lf-aside"},{default:re(()=>{var F,S;return[Me(v.$slots,"form-top"),(S=(F=J(s))==null?void 0:F.group)!=null&&S.length?J(l)?(oe(),se(b,{key:1})):(oe(),se(O,{key:2,ref_key:"formRef",ref:i,modelValue:J(a),"onUpdate:modelValue":[y[0]||(y[0]=A=>ae(a)?a.value=A:null),J(u)],defaults:J(d),"onUpdate:defaults":y[1]||(y[1]=A=>ae(d)?d.value=A:null),option:J(s)},null,8,["modelValue","defaults","option","onUpdate:modelValue"])):(oe(),se(I,{key:0,description:"选择元素以编辑数据"}))]}),_:3},8,["width"]),de(yi,{modelValue:J(r),"onUpdate:modelValue":y[2]||(y[2]=F=>ae(r)?r.value=F:null),visible:J(c),"onUpdate:visible":y[3]||(y[3]=F=>ae(c)?c.value=F:null),onConfirm:y[4]||(y[4]=F=>{var S;return(S=J(o))==null?void 0:S.render(F)})},vn({_:2},[v.$slots["editor-header"]?{name:"header",fn:re(()=>[Me(v.$slots,"editor-header")]),key:"0"}:void 0]),1032,["modelValue","visible"])]),_:3}))}}});export{We as BpmnExtend,In as Control,Vt as Dagre,Ws as EndEventModel,Us as EndEventView,qs as ExclusiveGatewayModel,Ys as ExclusiveGatewayView,_s as FlowDesign,Ue as Group,Hs as GroupModel,Js as GroupView,ii as Menu,Ks as NoteFlowModel,Xs as NoteFlowView,Qs as NoteModel,Zs as NoteView,si as Panel,ea as ParallelGatewayModel,ta as ParallelGatewayView,na as ProcessModel,oa as ProcessView,ra as SequenceFlowModel,ia as SequenceFlowView,sa as ServiceTaskModel,aa as ServiceTaskView,da as StartEventModel,la as StartEventView,Gt as Tooltip,Ce as TurboAdapter,ca as UserTaskModel,ua as UserTaskView,Ms as assigneeColumn,Os as baseColumn,Ls as buttonColumn,Ps as circulateColumn,Ss as defaultGraphData,Ht as defaultGroup,Ts as defaultOptions,Ye as defaultTheme,gs as executionListenerColumn,Ds as formPropertyColumn,Cs as gatewayColumn,Rs as multiInstanceColumn,Fs as noteColumn,js as processColumn,As as propertyColumn,Vs as sequenceFlowColumn,Bs as serialColumn,Gs as serviceTaskColumn,xs as taskListenerColumn,Es as timeLimitColumn,pi as toLogicflowData,ci as toTurboData,zs as userTaskColumn};
