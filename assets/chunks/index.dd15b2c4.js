import{r as T,a9 as _e,aB as Ue,d as Se,h as U,H as f,D as x,E as o,a7 as z,a8 as j,u as v,j as g,J as a,p as C,q as K,e as re,i as J,b as G,m as Ke,k as N,R as H,I as be,F as A,G as S,w as ge,aM as ke,C as W,a5 as Ve,n as we,_ as Be}from"./framework.87994f31.js";import"./index.a2682797.js";import{b as Ae,u as E}from"./index.ed326d4b.js";import{b as P,c as ee,_ as Ee,C as Pe,t as Re,d as ze,e as je,f as qe,g as ue,h as We,F as de,a as Je,i as Ge,w as He,j as De,k as Ye,T as Qe,l as Xe}from"./option.b941d765.js";import{m as _o,n as wo,A as yo,p as bo,q as go,W as ko,x as Vo,v as Do,o as Co,y as Fo,r as ho,s as Oo,u as Lo,z as xo}from"./option.b941d765.js";import{m as ce,a as Y,E as R}from"./index.05b719a1.js";import{o as Ce}from"./omitBy.dee5f82d.js";import{a as Ze}from"./snakeCase.65aa62e9.js";import{z as et}from"./Uint8Array.e988a1a5.js";import{F as tt}from"./index.4aada9e5.js";import{J as ot,K as lt}from"../app.51ecf87c.js";import{I as Q}from"./iconify.a7519ee4.js";import"./index.81c79613.js";import"./index.8d913286.js";import{j as at,H as nt}from"./tree.faa3b0d0.js";import"./vuedraggable.umd.3ed62a2a.js";import{w as te,u as pe,e as st}from"./theme.cdcbae00.js";import{f as it}from"./form.d769572f.js";import{d as ut}from"./differenceBy.3d5e1611.js";import"./dayjs.min.80392c58.js";import"./omit.28986d82.js";import"./index.vue_vue_type_script_setup_true_lang.b05f95f4.js";import"./createCompounder.a55b8569.js";import"./kebabCase.6f38f518.js";import"./vue.runtime.esm-bundler.673250a5.js";function Fe(){const{request:n}=P(),e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},t=d=>n.get(e.list,{params:d});return{getList:t,useList:()=>ee(()=>t({size:-1}).then(d=>d.data)),getTree:d=>n.get(e.tree,{params:d}),create:d=>n.post(e.save,d),update:d=>n.post(e.update,d),remove:d=>n.post(e.remove,{},{params:{ids:d}})}}function he(){const{request:n}=P(),e={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:e,getCirculateList:m=>n.get(e.list,{params:m}),getCirculateOpsList:m=>n.get(e.list,{params:m}),updateCirculate:m=>n.post(e.update,m),removeCirculate:m=>n.post(e.remove,{},{params:{ids:m}})}}function oe(){const{request:n}=P(),e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},t=r=>n.get(e.list,{params:r});return{url:e,getList:t,useList:()=>ee(()=>t({size:-1}).then(r=>r.data.records)),create:r=>n.post(e.save,r),update:r=>n.post(e.update,r),remove:r=>n.post(e.remove,{},{params:{ids:r}}),deploy:r=>n.post(e.deploy,r),getDetail:r=>n.get(e.detail,{params:r})}}var Oe=(n=>(n[n.否=0]="否",n[n.是=1]="是",n))(Oe||{});function me(){const{request:n}=P(),e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:m=>n.get(e.list,{params:m}),getDetail:m=>n.get(e.detail,{params:m}),update:m=>n.post(e.update,m),remove:m=>n.post(e.remove,{},{params:{ids:m}})}}function rt(){const{request:n}=P(),e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:i=>n.get(e.list,{params:i})}}function Le(){const{request:n}=P(),e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},t=s=>n.get(e.list,{params:s});return{url:e,getList:t,useList:()=>ee(()=>t({size:-1}).then(s=>s.data.records)),create:s=>n.post(e.save,s),update:s=>n.post(e.update,s),remove:s=>n.post(e.remove,{},{params:{ids:s}})}}function xe(){const{request:n}=P(),e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},t=s=>n.get(e.list,{params:s});return{url:e,getList:t,useList:()=>ee(()=>t({size:-1}).then(s=>s.data.records)),create:s=>n.post(e.save,s),update:s=>n.post(e.update,s),remove:s=>n.post(e.remove,{},{params:{ids:s}})}}function Ie(n){return n in(Pe.useFlowFormOptions??{})}function $e(n={}){const{useFlowFormOptions:e}=P(),t=ce({...e},{...n});switch(t==null?void 0:t.type){case"window":return dt(t);case"dialog":case"drawer":return ct(t);default:return{open:i=>{},close:()=>{}}}}function dt(n={}){const e=T(null);return{open:(u={})=>{var V;const l=ce({...n},{...u}),{window:[m,s,d]=[]}=l,r=`${m}?${Ae(Ce(l,Ze(et,tt,Ie)))}`;e.value=window.open(r,s,d),(V=e.value)==null||V.addEventListener("message",_=>{const{event:p}=_.data,c=u[p];typeof c=="function"&&c(_.data)})},close:()=>{var u;return(u=e.value)==null?void 0:u.close()},openedWindow:e}}function ct(n={}){const{appContext:e}=Se();let t,i;const u=m=>{t=document.createElement("div"),t.className="flow-form-wrapper";const s=ce({...n},{...m}),d=_e(Ee,Ce(s,Ie));i=_e(s.type==="dialog"?ot:lt,{class:"flow-form-overlay",modelValue:!0,onClose:l,...s.overlay},d),i.appContext=e,Ue(i,t),document.body.appendChild(t)},l=()=>{var m,s;(s=(m=i==null?void 0:i.component)==null?void 0:m.props)!=null&&s.modelValue&&(i.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:u,close:l}}const pt=U({__name:"index",setup(n){const{bindVal:e,crudStateRefs:{formData:t},getDataList:i}=E({tableOption:Re,crudOption:ze(),sortOption:{ascs:"sort"}});return i(),(u,l)=>{const m=f("el-button"),s=f("avue-crud");return g(),x(s,z(j(v(e))),{icon:o(({row:d})=>[a(v(Q),{icon:d.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:d})=>[a(m,{type:d.buttonType},{default:o(()=>[a(v(Q),{icon:d.icon},null,8,["icon"]),C(" "+K(d.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[a(m,{type:v(t).buttonType},{default:o(()=>[a(v(Q),{icon:v(t).icon},null,8,["icon"]),C(" "+K(v(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Te=U({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(n,{emit:e}){const t=n,{getList:i,deploy:u,remove:l}=oe(),{bindVal:m,crudStateRefs:{searchForm:s},getDataList:d}=E({tableOption:je,crudOption:{getList:i,remove:l},searchForm:{categoryId:t.categoryId}});re(()=>{s.value.categoryId=t.categoryId??""}),te(s,d,{debounce:300,immediate:!0,deep:!0});const r=T(!1);async function V(p){await Y.confirm("发布新版本，是否确认？","提示",{type:"success"}),r.value=!0,u({flowModuleId:p.flowModuleId}).then(()=>{R.success("发布成功"),d()}).finally(()=>{r.value=!1})}async function _(p){if(p.mainVersion)return R.warning("请先删除已发布的流程");await Y.confirm("确认删除？","提示",{type:"warning"}),await l(p.flowModuleId),R.success("删除成功"),d()}return(p,c)=>{const w=f("el-button"),y=f("el-dropdown-item"),b=f("avue-crud");return g(),x(b,z(j(v(m))),{"menu-left":o(()=>[a(w,{type:"primary",icon:"el-icon-plus",onClick:c[0]||(c[0]=k=>e("add"))},{default:o(()=>[C(" 新增 ")]),_:1})]),"menu-btn":o(({row:k})=>[a(y,{icon:"el-icon-view",onClick:D=>e("view",k)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-edit",onClick:D=>e("edit",k)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-delete",onClick:D=>_(k)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-upload",onClick:D=>V(k)},{default:o(()=>[C(" 发布 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-switch",onClick:D=>e("version",k)},{default:o(()=>[C(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:k})=>[a(v(Q),{icon:k.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Ne=U({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(n,{emit:e}){const t=n,{getList:i,update:u,remove:l}=me(),{bindVal:m,crudStateRefs:{searchForm:s},getDataList:d}=E({tableOption:qe,crudOption:{getList:i,dataPath:"res.data"}});re(()=>{s.value.flowModuleId=t.flowModuleId}),te(s,d,{debounce:300,immediate:!0,deep:!0});const r=T(!1);async function V(p){await Y.confirm(`确定将 ${p.flowName}(${p.flowKey}:v${p.version}) 设为主版本?`,"提示",{type:"warning"}),r.value=!0,u({flowDeployId:p.flowDeployId,flowModuleId:p.flowModuleId,mainVersion:1}).then(()=>{R.success("设置成功"),d()}).finally(()=>{r.value=!1})}async function _(p){const{value:c}=await Y.prompt("请输入确认删除的流程标识","提示",{type:"warning"});c===p.flowKey&&(await l(p.flowDeployId),R.success("删除成功"),d())}return(p,c)=>{const w=f("el-button"),y=f("el-dropdown-item"),b=f("avue-crud");return g(),x(b,z(j(v(m))),{"menu-left":o(()=>[a(w,{loading:r.value,type:"primary",icon:"el-icon-arrow-left",onClick:c[0]||(c[0]=k=>e("back"))},{default:o(()=>[C(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:k})=>[a(y,{icon:"el-icon-view",onClick:D=>e("view",k)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-edit",onClick:D=>e("edit",k)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-delete",onClick:D=>_(k)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-switch",disabled:k.mainVersion===v(Oe).是,onClick:D=>V(k)},{default:o(()=>[C(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:k})=>[a(v(Q),{icon:k.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),ye={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},mt=U({__name:"index",emits:["node-click"],setup(n,{emit:e}){const{crudStateRefs:{formData:t,tableData:i},getDataList:u,handleSave:l,handleUpdate:m,handleDel:s}=E({crudOption:{rowKey:"id",...Fe(),dataPath:"res.data"},tableOption:ye,pageOption:{pageSize:20}});u();function d(_,p,c,w){l(p,c,w)}function r(_,p,c,w){m(p,NaN,c,w)}async function V(_,p){await s(_.data,NaN),p()}return(_,p)=>{const c=f("avue-tree");return g(),x(c,{modelValue:v(t),"onUpdate:modelValue":p[0]||(p[0]=w=>J(t)?t.value=w:null),option:v(ye),data:v(i),onNodeClick:p[1]||(p[1]=w=>e("node-click",w)),onSave:d,onUpdate:r,onDel:V},null,8,["modelValue","option","data"])}}}),fe=U({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(n,{emit:e}){var d;const t=n,{FormDesign:i}=P(),u=G({get(){return t.modelValue?at(t.modelValue):{menuBtn:!1,span:24}},set(r){e("update:modelValue",nt(r,{useJson5:!1}))}}),l=G(()=>t.fields?JSON.parse(t.fields):[]),m=G(()=>{const r={type:"select",dicData:l.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...r,props:{label:"name",value:"name",desc:"comment"}},{...r,props:{label:"comment",value:"comment",desc:"name"}}]}),s={form:{settings:Array.from({length:((d=it.settings)==null?void 0:d.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(r,V)=>{const _=f("avue-form");return r.view?(g(),x(_,{key:0,class:Ke(u.value.class),"model-value":{},option:u.value},null,8,["class","option"])):(g(),x(v(i),{key:1,modelValue:u.value,"onUpdate:modelValue":V[0]||(V[0]=p=>u.value=p),"base-option":m.value,resources:s},null,8,["modelValue","base-option"]))}}}),ft={key:1},vt=U({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(n){const e=n,{formData:t,activeStep:i}=pe(e),{getDetail:u,useList:l}=oe(),{data:m}=xe().useList(),{data:s}=Le().useList(),{data:d}=l(),r=G(()=>{var _,p,c,w;return(i==null?void 0:i.value)===1?[{label:"表单模板",value:"",type:"divider"},...((_=m.value)==null?void 0:_.map(y=>({label:y.formName,value:y.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((p=d.value)==null?void 0:p.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:(i==null?void 0:i.value)===2?[{label:"流程模板",value:"",type:"divider"},...((c=s.value)==null?void 0:c.map(y=>({label:y.flowName,value:y.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((w=d.value)==null?void 0:w.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:[]});async function V(_){if((i==null?void 0:i.value)===1){if(_.type==="template")t.value.formOption=_.value;else if(_.type==="definition"){const p=await u({flowModuleId:_.value});t.value.formOption=p.data.formOption}}else if((i==null?void 0:i.value)===2){if(_.type==="template")t.value.flowData=_.value;else if(_.type==="definition"){const p=await u({flowModuleId:_.value});t.value.flowData=p.data.flowData}}}return(_,p)=>{const c=f("el-link"),w=f("el-divider"),y=f("el-dropdown-item"),b=f("el-scrollbar"),k=f("el-dropdown-menu"),D=f("el-dropdown");return r.value.length?(g(),x(D,{key:0},{dropdown:o(()=>[a(k,null,{default:o(()=>[a(b,{"max-height":"600px"},{default:o(()=>[(g(!0),N(A,null,H(r.value,h=>(g(),x(y,be({key:h.label},h,{disabled:h.type==="divider",onClick:I=>V(h)}),{default:o(()=>[h.type==="divider"?(g(),x(w,{key:0},{default:o(()=>[C(K(h.label),1)]),_:2},1024)):(g(),N("span",ft,K(h.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[a(c,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[C(" 选择模板 ")]),_:1})]),_:1})):S("",!0)}}}),_t=W("span",null,"流程设计",-1),wt={key:0},yt={key:1},bt={style:{height:"calc(100vh - 144px)"}},gt=U({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(n,{emit:e}){const i=pe(n),{visible:u,modelValue:l}=i,{create:m,deploy:s,getDetail:d,update:r}=oe(),{getDetail:V,update:_}=me(),p=["流程信息","表单设计","模型设计","完成"],c=T(!1);ge(u,async L=>{if(!L)return;const{flowModuleId:F}=l.value,{flowDeployId:M}=l.value;try{c.value=!0;let $={};M?$=await V({flowDeployId:M}):F&&($=await d({flowModuleId:F})),l.value=$.data}finally{c.value=!1}},{immediate:!0});const{data:w}=ue().useList(),y=G(()=>{var L,F;return(F=(L=w.value)==null?void 0:L.find(M=>M.tableName===l.value.formDataTable))==null?void 0:F.tableFields}),b=T(0),k=T();async function D(L){b.value===0&&await Je(k),c.value=!0;const{flowModuleId:F}=l.value,{flowDeployId:M}=l.value;try{M?await _(l.value):F?await r(l.value):await m(l.value).then($=>{l.value.flowModuleId=$.data.flowModuleId}),R.success("保存成功")}finally{c.value=!1}typeof L=="number"?b.value=L:b.value++}async function h(){await Y.confirm("发布新版本，是否确认？","提示"),c.value=!0,s({flowModuleId:l.value.flowModuleId}).then(()=>{R.success("发布成功")}).finally(()=>{c.value=!1})}function I(){u.value=!1,b.value=0,l.value={},e("close")}return(L,F)=>{const M=f("el-col"),$=f("el-step"),X=f("el-steps"),q=f("el-button"),le=f("el-row"),ae=f("avue-form"),ne=f("el-result"),se=f("el-dialog"),ie=ke("loading");return g(),x(se,{modelValue:v(u),"onUpdate:modelValue":F[6]||(F[6]=O=>J(u)?u.value=O:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:I},{header:o(()=>[a(le,{justify:"center"},{default:o(()=>[a(M,{span:5},{default:o(()=>{var O,B,Z,ve;return[W("div",null,[_t,(O=v(l))!=null&&O.flowName?(g(),N("span",wt," - "+K((B=v(l))==null?void 0:B.flowName),1)):S("",!0),(Z=v(l))!=null&&Z.version?(g(),N("span",yt," - V"+K((ve=v(l))==null?void 0:ve.version),1)):S("",!0)]),a(vt,{"form-data":v(l),"onUpdate:formData":F[0]||(F[0]=Me=>J(l)?l.value=Me:null),"active-step":b.value},null,8,["form-data","active-step"])]}),_:1}),a(M,{span:14},{default:o(()=>[a(X,{active:b.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(g(),N(A,null,H(p,(O,B)=>a($,{key:B,title:O,style:{cursor:"pointer"},onClick:Z=>D(B)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),a(M,{span:5,style:{"text-align":"right"}},{default:o(()=>[a(q,{disabled:b.value===0,loading:c.value,type:"primary",onClick:F[1]||(F[1]=O=>b.value--)},{default:o(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),a(q,{disabled:b.value===p.length-1,type:"primary",loading:c.value,onClick:F[2]||(F[2]=O=>D())},{default:o(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),a(q,{onClick:I},{default:o(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[Ve((g(),N("div",bt,[b.value===0?(g(),x(ae,{key:0,ref_key:"formRef",ref:k,modelValue:v(l),"onUpdate:modelValue":F[3]||(F[3]=O=>J(l)?l.value=O:null),option:v(We),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):S("",!0),b.value===1?(g(),x(fe,{key:1,modelValue:v(l).formOption,"onUpdate:modelValue":F[4]||(F[4]=O=>v(l).formOption=O),fields:y.value},null,8,["modelValue","fields"])):S("",!0),b.value===2?(g(),x(de,{key:2,modelValue:v(l).flowData,"onUpdate:modelValue":F[5]||(F[5]=O=>v(l).flowData=O),"flow-form-option":v(l).formOption},null,8,["modelValue","flow-form-option"])):S("",!0),b.value===3?(g(),x(ne,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[v(l).flowDeployId?S("",!0):(g(),x(q,{key:0,type:"primary",onClick:h},{default:o(()=>[C(" 发布 ")]),_:1})),a(q,{onClick:I},{default:o(()=>[C(" 关闭 ")]),_:1})]),_:1})):S("",!0)])),[[ie,c.value]])]),_:1},8,["modelValue"])}}}),kt=W("span",null,"流程查看",-1),Vt={key:0},Dt={key:1},Ct=U({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(n){const t=pe(n),{visible:i,modelValue:u}=t,{getDetail:l}=oe(),{getDetail:m}=me(),s=T("form"),d=T(!1);ge(i,async V=>{if(!V)return;const{flowModuleId:_}=u.value,{flowDeployId:p}=u.value;try{d.value=!0;let c={};p?c=await m({flowDeployId:p}):_&&(c=await l({flowModuleId:_})),u.value={...c.data}}finally{d.value=!1}},{immediate:!0});function r(){u.value={},s.value="form"}return(V,_)=>{const p=f("el-tab-pane"),c=f("el-tabs"),w=f("el-dialog"),y=ke("loading");return g(),x(w,{modelValue:v(i),"onUpdate:modelValue":_[3]||(_[3]=b=>J(i)?i.value=b:null),width:"60%",top:"0",onClose:r},{header:o(()=>{var b,k,D,h;return[kt,(b=v(u))!=null&&b.flowName?(g(),N("span",Vt," - "+K((k=v(u))==null?void 0:k.flowName),1)):S("",!0),(D=v(u))!=null&&D.version?(g(),N("span",Dt," - V"+K((h=v(u))==null?void 0:h.version),1)):S("",!0)]}),default:o(()=>[Ve((g(),x(c,{modelValue:s.value,"onUpdate:modelValue":_[2]||(_[2]=b=>s.value=b)},{default:o(()=>[a(p,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[s.value==="form"&&v(u).formOption?(g(),x(fe,{key:0,modelValue:v(u).formOption,"onUpdate:modelValue":_[0]||(_[0]=b=>v(u).formOption=b),view:""},null,8,["modelValue"])):S("",!0)]),_:1}),a(p,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[s.value==="flow"?(g(),x(de,{key:0,modelValue:v(u).flowData,"onUpdate:modelValue":_[1]||(_[1]=b=>v(u).flowData=b),view:""},null,8,["modelValue"])):S("",!0)]),_:1})]),_:1},8,["modelValue"])),[[y,d.value]])]),_:1},8,["modelValue"])}}}),Ft=U({__name:"index",setup(n){const e=T("definition"),t=T({}),i=T(""),u=T("");function l(w){i.value===w.id?i.value="":i.value=w.id}const m=T(!1),s=T(!1);function d(){t.value={},m.value=!0}function r(w){t.value=w,m.value=!0}function V(w){t.value=w,s.value=!0}function _(w){u.value=w.flowModuleId||"",e.value="deploy"}function p(){u.value="",e.value="definition"}async function c(){const w=e.value;await we(),e.value="",await we(),e.value=`${w}`}return(w,y)=>{const b=f("el-col"),k=f("el-row");return g(),x(k,{gutter:20},{default:o(()=>[a(b,{span:4},{default:o(()=>[a(mt,{onNodeClick:l})]),_:1}),a(b,{span:20},{default:o(()=>[e.value==="definition"?(g(),x(Te,{key:0,"category-id":i.value,onAdd:d,onEdit:r,onView:V,onVersion:_},null,8,["category-id"])):S("",!0),e.value==="deploy"&&u.value?(g(),x(Ne,{key:1,"flow-module-id":u.value,onEdit:r,onView:V,onBack:p},null,8,["flow-module-id"])):S("",!0),a(gt,{modelValue:t.value,"onUpdate:modelValue":y[0]||(y[0]=D=>t.value=D),visible:m.value,"onUpdate:visible":y[1]||(y[1]=D=>m.value=D),onClose:c},null,8,["modelValue","visible"]),a(Ct,{modelValue:t.value,"onUpdate:modelValue":y[2]||(y[2]=D=>t.value=D),visible:s.value,"onUpdate:visible":y[3]||(y[3]=D=>s.value=D)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),ht=U({__name:"index",setup(n){const e=st("debugMode",!1),{getTaskOpsList:t}=rt(),{getCirculateOpsList:i,updateCirculate:u,removeCirculate:l}=he(),{bindVal:m,getDataList:s,crudStateRefs:{searchForm:d,crudOption:r}}=E({tableOption:Ge,crudOption:{getList:t},searchForm:{status:2},sortOption:{descs:"start_time"}});te(d,s,{debounce:300,immediate:!0,deep:!0});const V=T("task"),_=[{label:"任务",name:"task",getList:t},{label:"传阅",name:"circulate",getList:i,update:u,remove:l}];function p({paneName:b}){const k=_.find(D=>D.name===b);r.value.getList=k.getList,r.value.update=k.update,r.value.remove=k.remove,s()}const{open:c,close:w}=$e();function y(b){c({flowKey:b.flowKey,taskId:b.taskId,instanceId:b.flowInstanceId,debug:e.value,circulateId:b.id,onComplete(){w(),s()}})}return(b,k)=>{const D=f("el-tab-pane"),h=f("el-tabs"),I=f("el-switch"),L=f("el-button"),F=f("el-link"),M=f("avue-crud");return g(),N(A,null,[a(h,{modelValue:V.value,"onUpdate:modelValue":k[0]||(k[0]=$=>V.value=$),onTabClick:p},{default:o(()=>[(g(),N(A,null,H(_,$=>a(D,{key:$.name,label:$.label,name:$.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),a(M,be(v(m),{permission:{menu:V.value==="circulate"}}),{"menu-right":o(()=>[a(L,{type:"text"},{default:o(()=>[a(I,{modelValue:v(e),"onUpdate:modelValue":k[1]||(k[1]=$=>J(e)?e.value=$:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:$})=>[a(F,{type:"primary",underline:!1,onClick:X=>y($)},{default:o(()=>[C(K($.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Ot={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:He},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Lt=U({__name:"index",setup(n){const{bindVal:e,getDataList:t}=E({tableOption:Ot,crudOption:De()});return t(),(i,u)=>{const l=f("avue-crud");return g(),x(l,z(j(v(e))),null,16)}}}),xt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},It={class:"flow-list"},$t=["onClick"],Tt={class:"flow-name"},Nt=U({__name:"index",setup(n){const{useList:e}=Fe(),{usePublishList:t,getTaskList:i}=Ye(),{getCirculateList:u}=he(),{data:l}=e(),{data:m}=t(),s=G(()=>{var h;return(h=l.value)==null?void 0:h.map(I=>{var F;const L=((F=m.value)==null?void 0:F.filter(M=>M.categoryId===I.id))??[];return{...I,list:L}}).filter(I=>{var L;return(L=I.list)==null?void 0:L.length})}),d=[{label:"待办",value:2},{label:"已办",value:1}],{bindVal:r,getDataList:V,crudStateRefs:{searchForm:_,crudOption:p}}=E({tableOption:xt,crudOption:{getList:i},searchForm:{status:2}});te(_,V,{debounce:300,immediate:!0,deep:!0});const c=T("task"),w=[{label:"任务",name:"task",getList:i},{label:"传阅",name:"circulate",getList:u}];function y({paneName:h}){const I=w.find(L=>L.name===h);p.value.getList=I.getList,V()}const{open:b,close:k}=$e();function D(h){b({flowKey:h.flowKey,taskId:h.taskId,instanceId:h.flowInstanceId,circulateId:h.id,detail:h.taskId?h.status===Qe.已办:!1,onComplete(){k(),V()}})}return(h,I)=>{const L=f("el-button"),F=f("el-divider"),M=f("Icon"),$=f("el-collapse-item"),X=f("el-collapse"),q=f("el-card"),le=f("el-tab-pane"),ae=f("el-tabs"),ne=f("avue-radio"),se=f("el-link"),ie=f("avue-crud");return g(),N(A,null,[a(q,{"body-style":{padding:"0 20px"}},{default:o(()=>[a(X,{"model-value":"1"},{default:o(()=>[a($,{name:"1"},{title:o(()=>[a(L,{text:"",icon:"el-icon-promotion"},{default:o(()=>[C(" 发起审批 ")]),_:1})]),default:o(()=>[W("div",It,[(g(!0),N(A,null,H(s.value,O=>(g(),N("div",{key:O.id,class:"flow-category"},[a(F,{"content-position":"left"},{default:o(()=>[C(K(O.name),1)]),_:2},1024),(g(!0),N(A,null,H(O.list,B=>(g(),N("div",{key:B.flowKey,class:"flow-item",onClick:Z=>D(B)},[a(M,{class:"flow-icon",icon:B.flowIcon,width:"60"},null,8,["icon"]),W("div",Tt,K(B.flowName),1)],8,$t))),128))]))),128))])]),_:1})]),_:1})]),_:1}),a(F,{direction:"horizontal","content-position":"left"}),a(ae,{modelValue:c.value,"onUpdate:modelValue":I[0]||(I[0]=O=>c.value=O),onTabClick:y},{default:o(()=>[(g(),N(A,null,H(w,O=>a(le,{key:O.name,label:O.label,name:O.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),a(ie,z(j(v(r))),{"menu-left":o(()=>[a(ne,{modelValue:v(_).status,"onUpdate:modelValue":I[1]||(I[1]=O=>v(_).status=O),button:"",dic:d},null,8,["modelValue"])]),processTitle:o(({row:O})=>[a(se,{type:"primary",underline:!1,onClick:B=>D(O)},{default:o(()=>[C(K(O.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Mt=Be(Nt,[["__scopeId","data-v-715d8939"]]),Ut={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},St=U({__name:"index",setup(n){const{bindVal:e,crudStateRefs:{formData:t},getDataList:i,handleUpdate:u}=E({tableOption:Ut,crudOption:Le()});i();const l=T(!1);async function m(d){t.value=d,l.value=!0}async function s(){await u(t.value,NaN,()=>l.value=!1,()=>{})}return(d,r)=>{const V=f("el-button"),_=f("avue-crud"),p=f("el-dialog");return g(),N(A,null,[a(_,z(j(v(e))),{menu:o(({row:c})=>[a(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>m(c)},{default:o(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),a(p,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=c=>l.value=c),title:`模型设计-${v(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[a(V,{type:"primary",onClick:s},{default:o(()=>[C(" 保存 ")]),_:1}),a(V,{onClick:r[1]||(r[1]=c=>l.value=!1)},{default:o(()=>[C(" 取消 ")]),_:1})]),default:o(()=>[a(de,{modelValue:v(t).flowData,"onUpdate:modelValue":r[0]||(r[0]=c=>v(t).flowData=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Kt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Bt=U({__name:"index",setup(n){const{bindVal:e,crudStateRefs:{formData:t},getDataList:i,handleUpdate:u}=E({tableOption:Kt,crudOption:xe()});i();const l=T(!1);async function m(d){t.value={...d},l.value=!0}async function s(){await u(t.value,NaN,()=>l.value=!1,()=>{})}return(d,r)=>{const V=f("el-button"),_=f("avue-crud"),p=f("el-dialog");return g(),N(A,null,[a(_,z(j(v(e))),{menu:o(({row:c})=>[a(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>m(c)},{default:o(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),a(p,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=c=>l.value=c),title:`表单设计-${v(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[a(V,{type:"primary",onClick:s},{default:o(()=>[C(" 保存 ")]),_:1}),a(V,{onClick:r[1]||(r[1]=c=>l.value=!1)},{default:o(()=>[C(" 取消 ")]),_:1})]),default:o(()=>[a(fe,{modelValue:v(t).formOption,"onUpdate:modelValue":r[0]||(r[0]=c=>v(t).formOption=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),At=W("br",null,null,-1),Et=U({__name:"index",setup(n){const{bindVal:e,crudStateRefs:{formData:t,defaults:i},getDataList:u,afterOpen:l,beforeSubmit:m}=E({crudOption:ue(),tableOption:Xe});u();const{data:s}=De().useParam("table.default.fields");l(w=>{if(t.value.defaultFields=s.value??[],w==="edit"){const y=JSON.parse(t.value.tableFields);t.value.editFields=ut(y,s.value??[],"name")}}),m(w=>{const y=[...w.defaultFields,...w.editFields];w.tableFields=JSON.stringify(y)});const d=T(!1);re(()=>{var w;(w=i.value)!=null&&w.defaultFields&&(i.value.defaultFields.display=d.value)});const{deploy:r,getFields:V}=ue(),_=T(!1);async function p(w){await Y.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,r({id:w.id}).then(()=>{R.success("部署成功"),u()}).finally(()=>{_.value=!1})}function c(){V({tableName:t.value.tableName}).then(w=>{var y;if(!((y=w.data)!=null&&y.length))return R.warning("未找到该表");t.value.editFields=w.data})}return(w,y)=>{const b=f("el-button"),k=f("el-input"),D=f("el-switch"),h=f("el-tooltip"),I=f("avue-crud");return g(),x(I,z(j(v(e))),{menu:o(({row:L})=>[a(b,{type:"text",icon:"el-icon-upload",onClick:F=>p(L)},{default:o(()=>[C(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[a(k,{modelValue:v(t).tableName,"onUpdate:modelValue":y[0]||(y[0]=L=>v(t).tableName=L),placeholder:"请输入 表名"},{append:o(()=>[a(b,{type:"primary",size:"default",onClick:c},{default:o(()=>[C(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[W("div",null,[C(" 数据库字段 "),At,a(h,{content:"显示默认字段"},{default:o(()=>[a(D,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=L=>d.value=L)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Pt=Object.freeze(Object.defineProperty({__proto__:null,FlowButton:pt,FlowDefinition:Te,FlowDeploy:Ne,FlowManage:Ft,FlowOps:ht,FlowParam:Lt,FlowTemplate:St,FlowWorkbench:Mt,FormTemplate:Bt,TableTemplate:Et},Symbol.toStringTag,{value:"Module"})),mo={install(n,e){Object.entries(Pt).forEach(([t,i])=>{n.component(t,i)}),P(n,e)}};export{_o as ApprovalForm,wo as ButtonList,Pe as CONFIG_DEFAULT,yo as CONFIG_PROVIDE_KEY,pt as FlowButton,Te as FlowDefinition,Ne as FlowDeploy,Ee as FlowForm,Ft as FlowManage,ht as FlowOps,Lt as FlowParam,St as FlowTemplate,Mt as FlowWorkbench,Bt as FormTemplate,bo as InternalForm,Et as TableTemplate,go as UploadTable,ko as Whether,Je as asyncValidate,mo as default,Vo as flowFormEmits,Do as flowFormProps,Co as flowTrack,Fo as injectionKey,ho as useButtonHandler,P as useConfigProvider,$e as useFlowForm,ct as useFlowFormOverlay,dt as useFlowFormWindow,Oo as useFormDefaults,Lo as useInjectState,xo as useProvideState,He as whetherDic};
