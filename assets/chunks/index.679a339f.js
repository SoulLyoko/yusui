import{a as T,aa as ye,aB as Se,e as Be,j as S,I as f,E as L,G as o,a8 as j,a9 as J,u as c,k as D,K as n,q as F,v as K,f as ce,i as Q,d as H,p as Ke,l as P,S as Y,J as ke,F as E,H as B,w as De,aM as Ve,D as G,a6 as Fe,n as be,_ as Ae}from"./framework.e6d5cdfe.js";import"./index.a2682797.js";import{b as Ee,u as R,e as Re}from"./index.9e7c8c99.js";import{c as oe,d as U,C as ze,t as je,e as Je,f as We,g as He,h as de,i as Ge,F as pe,b as Qe,j as Ye,T as te,w as Xe,k as Ce,l as Ze,m as qe}from"./form.8c1ad074.js";import{G as go,I as ko,B as Do,A as Vo,r as Fo,q as Co,p as ho,s as Oo,o as Io,_ as xo,x as Lo,H as $o,K as To,z as No,L as Po,W as Uo,D as Mo,O as So,N as Bo,J as Ko,P as Ao,E as Eo,M as Ro,n as zo,v as jo,y as Jo,a as Wo,u as Ho,Q as Go}from"./form.8c1ad074.js";import{m as me,a as X,E as z}from"./index.6538ad06.js";import{o as he}from"./omitBy.4cf02115.js";import{a as et}from"./snakeCase.3aec53e3.js";import{z as tt}from"./Uint8Array.e988a1a5.js";import{F as ot}from"./index.19ba2f01.js";import{J as lt,K as at}from"../app.2245f6a0.js";import{I as Z}from"./iconify.0a9b5b72.js";import"./index.2a995bde.js";import"./index.cd139f4e.js";import{j as nt,H as st}from"./tree.833e2973.js";import"./vuedraggable.umd.1ba51a0e.js";import{w as le,a as fe,u as it,f as ut,g as rt}from"./theme.71a909f8.js";import{f as dt}from"./form.4880fc5b.js";import{d as ct}from"./differenceBy.b743b0b2.js";import"./dayjs.min.80392c58.js";import"./omit.b89ba203.js";import"./index.vue_vue_type_script_setup_true_lang.65cb5372.js";import"./createCompounder.a55b8569.js";import"./kebabCase.6f38f518.js";import"./vue.runtime.esm-bundler.4d922a51.js";function Oe(s){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},i=m=>s.get(e.list,{params:m});return{getList:i,useList:()=>oe(()=>i({size:-1}).then(m=>m.data)),getTree:m=>s.get(e.tree,{params:m}),create:m=>s.post(e.save,m),update:m=>s.post(e.update,m),remove:m=>s.post(e.remove,{},{params:{ids:m}})}}function Ie(s){const e={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:e,getCirculateList:l=>s.get(e.list,{params:l}),getCirculateOpsList:l=>s.get(e.list,{params:l}),updateCirculate:l=>s.post(e.update,l),removeCirculate:l=>s.post(e.remove,{},{params:{ids:l}})}}function ae(s){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},i=d=>s.get(e.list,{params:d});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(d=>d.data.records)),create:d=>s.post(e.save,d),update:d=>s.post(e.update,d),remove:d=>s.post(e.remove,{},{params:{ids:d}}),deploy:d=>s.post(e.deploy,d),getDetail:d=>s.get(e.detail,{params:d})}}var xe=(s=>(s[s.否=0]="否",s[s.是=1]="是",s))(xe||{});function ve(s){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:l=>s.get(e.list,{params:l}),getDetail:l=>s.get(e.detail,{params:l}),update:l=>s.post(e.update,l),remove:l=>s.post(e.remove,{},{params:{ids:l}})}}function pt(s){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>s.get(e.list,{params:t})}}function Le(s){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},i=p=>s.get(e.list,{params:p});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(p=>p.data.records)),create:p=>s.post(e.save,p),update:p=>s.post(e.update,p),remove:p=>s.post(e.remove,{},{params:{ids:p}})}}function $e(s){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},i=p=>s.get(e.list,{params:p});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(p=>p.data.records)),create:p=>s.post(e.save,p),update:p=>s.post(e.update,p),remove:p=>s.post(e.remove,{},{params:{ids:p}})}}function Te(s,e){return e in(ze.useFlowFormOptions??{})}function Ne(s={}){const{useFlowFormOptions:e}=U(),i=me({...e},{...s});switch(i==null?void 0:i.type){case"window":return mt(i);case"dialog":case"drawer":return ft(i);default:return{open:t=>{},close:()=>{}}}}function mt(s={}){const e=T(null);return{open:(a={})=>{var b;const u=me({...s},{...a}),{window:[l,p,m]=[]}=u,d=`${l}?${Ee(he(u,et(tt,ot,Te)))}`;e.value=window.open(d,p,m),(b=e.value)==null||b.addEventListener("message",V=>{const{event:_,data:v}=V.data,r=a[_];typeof r=="function"&&r(v)})},close:()=>{var a;return(a=e.value)==null?void 0:a.close()},openedWindow:e}}function ft(s={}){const{appContext:e}=Be(),{FlowForm:i}=U();let t,a;const u=p=>{t=document.createElement("div"),t.className="flow-form-wrapper";const m=me({...s},{...p}),d=ye(i,he(m,Te));a=ye(m.type==="dialog"?lt:at,{class:"flow-form-overlay",modelValue:!0,onClose:l,...m.overlay},d),a.appContext=e,Se(a,t),document.body.appendChild(t)},l=()=>{var p,m;(m=(p=a==null?void 0:a.component)==null?void 0:p.props)!=null&&m.modelValue&&(a.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:u,close:l}}const vt=S({__name:"index",setup(s){const{request:e}=U(),{bindVal:i,crudStateRefs:{formData:t},getDataList:a}=R({tableOption:je,crudOption:Je(e),sortOption:{ascs:"sort"}});return a(),(u,l)=>{const p=f("el-button"),m=f("avue-crud");return D(),L(m,j(J(c(i))),{icon:o(({row:d})=>[n(c(Z),{icon:d.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:d})=>[n(p,{type:d.buttonType},{default:o(()=>[n(c(Z),{icon:d.icon},null,8,["icon"]),F(" "+K(d.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[n(p,{type:c(t).buttonType},{default:o(()=>[n(c(Z),{icon:c(t).icon},null,8,["icon"]),F(" "+K(c(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Pe=S({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(s,{emit:e}){const i=s,{request:t}=U(),{getList:a,deploy:u,remove:l}=ae(t),{bindVal:p,crudStateRefs:{searchForm:m},getDataList:d}=R({tableOption:We,crudOption:{getList:a,remove:l},searchForm:{categoryId:i.categoryId}});ce(()=>{m.value.categoryId=i.categoryId??""}),le(m,d,{debounce:300,immediate:!0,deep:!0});const b=T(!1);async function V(v){await X.confirm("发布新版本，是否确认？","提示",{type:"success"}),b.value=!0,u({flowModuleId:v.flowModuleId}).then(()=>{z.success("发布成功"),d()}).finally(()=>{b.value=!1})}async function _(v){if(v.mainVersion)return z.warning("请先删除已发布的流程");await X.confirm("确认删除？","提示",{type:"warning"}),await l(v.flowModuleId),z.success("删除成功"),d()}return(v,r)=>{const w=f("el-button"),y=f("el-dropdown-item"),k=f("avue-crud");return D(),L(k,j(J(c(p))),{"menu-left":o(()=>[n(w,{type:"primary",icon:"el-icon-plus",onClick:r[0]||(r[0]=g=>e("add"))},{default:o(()=>[F(" 新增 ")]),_:1})]),"menu-btn":o(({row:g})=>[n(y,{icon:"el-icon-view",onClick:I=>e("view",g)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-edit",onClick:I=>e("edit",g)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-delete",onClick:I=>_(g)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-upload",onClick:I=>V(g)},{default:o(()=>[F(" 发布 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-switch",onClick:I=>e("version",g)},{default:o(()=>[F(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:g})=>[n(c(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Ue=S({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(s,{emit:e}){const i=s,{request:t}=U(),{getList:a,update:u,remove:l}=ve(t),{bindVal:p,crudStateRefs:{searchForm:m},getDataList:d}=R({tableOption:He,crudOption:{getList:a,dataPath:"res.data"}});ce(()=>{m.value.flowModuleId=i.flowModuleId}),le(m,d,{debounce:300,immediate:!0,deep:!0});const b=T(!1);async function V(v){await X.confirm(`确定将 ${v.flowName}(${v.flowKey}:v${v.version}) 设为主版本?`,"提示",{type:"warning"}),b.value=!0,u({flowDeployId:v.flowDeployId,flowModuleId:v.flowModuleId,mainVersion:1}).then(()=>{z.success("设置成功"),d()}).finally(()=>{b.value=!1})}async function _(v){const{value:r}=await X.prompt("请输入确认删除的流程标识","提示",{type:"warning"});r===v.flowKey&&(await l(v.flowDeployId),z.success("删除成功"),d())}return(v,r)=>{const w=f("el-button"),y=f("el-dropdown-item"),k=f("avue-crud");return D(),L(k,j(J(c(p))),{"menu-left":o(()=>[n(w,{loading:b.value,type:"primary",icon:"el-icon-arrow-left",onClick:r[0]||(r[0]=g=>e("back"))},{default:o(()=>[F(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:g})=>[n(y,{icon:"el-icon-view",onClick:I=>e("view",g)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-edit",onClick:I=>e("edit",g)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-delete",onClick:I=>_(g)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-switch",disabled:g.mainVersion===c(xe).是,onClick:I=>V(g)},{default:o(()=>[F(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:g})=>[n(c(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),ge={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},_t=S({__name:"index",emits:["node-click"],setup(s,{emit:e}){const{request:i}=U(),{crudStateRefs:{formData:t,tableData:a},getDataList:u,handleSave:l,handleUpdate:p,handleDel:m}=R({crudOption:{rowKey:"id",...Oe(i),dataPath:"res.data"},tableOption:ge,pageOption:{pageSize:20}});u();function d(_,v,r,w){l(v,r,w)}function b(_,v,r,w){p(v,NaN,r,w)}async function V(_,v){await m(_.data,NaN),v()}return(_,v)=>{const r=f("avue-tree");return D(),L(r,{modelValue:c(t),"onUpdate:modelValue":v[0]||(v[0]=w=>Q(t)?t.value=w:null),option:c(ge),data:c(a),onNodeClick:v[1]||(v[1]=w=>e("node-click",w)),onSave:d,onUpdate:b,onDel:V},null,8,["modelValue","option","data"])}}}),_e=S({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(s,{emit:e}){var m;const i=s,{FormDesign:t}=U(),a=H({get(){return i.modelValue?nt(i.modelValue):{menuBtn:!1,span:24}},set(d){e("update:modelValue",st(d,{useJson5:!1}))}}),u=H(()=>i.fields?JSON.parse(i.fields):[]),l=H(()=>{const d={type:"select",dicData:u.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...d,props:{label:"name",value:"name",desc:"comment"}},{...d,props:{label:"comment",value:"comment",desc:"name"}}]}),p={form:{settings:Array.from({length:((m=dt.settings)==null?void 0:m.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(d,b)=>{const V=f("avue-form");return d.view?(D(),L(V,{key:0,class:Ke(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(D(),L(c(t),{key:1,modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=_=>a.value=_),"base-option":l.value,resources:p},null,8,["modelValue","base-option"]))}}}),wt={key:1},yt=S({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(s){const e=s,{formData:i,activeStep:t}=fe(e),{request:a}=U(),{getDetail:u,useList:l}=ae(a),{data:p}=$e(a).useList(),{data:m}=Le(a).useList(),{data:d}=l(),b=H(()=>{var _,v,r,w;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((_=p.value)==null?void 0:_.map(y=>({label:y.formName,value:y.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((v=d.value)==null?void 0:v.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((r=m.value)==null?void 0:r.map(y=>({label:y.flowName,value:y.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((w=d.value)==null?void 0:w.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:[]});async function V(_){if((t==null?void 0:t.value)===1){if(_.type==="template")i.value.formOption=_.value;else if(_.type==="definition"){const v=await u({flowModuleId:_.value});i.value.formOption=v.data.formOption}}else if((t==null?void 0:t.value)===2){if(_.type==="template")i.value.flowData=_.value;else if(_.type==="definition"){const v=await u({flowModuleId:_.value});i.value.flowData=v.data.flowData}}}return(_,v)=>{const r=f("el-link"),w=f("el-divider"),y=f("el-dropdown-item"),k=f("el-scrollbar"),g=f("el-dropdown-menu"),I=f("el-dropdown");return b.value.length?(D(),L(I,{key:0},{dropdown:o(()=>[n(g,null,{default:o(()=>[n(k,{"max-height":"600px"},{default:o(()=>[(D(!0),P(E,null,Y(b.value,h=>(D(),L(y,ke({key:h.label},h,{disabled:h.type==="divider",onClick:$=>V(h)}),{default:o(()=>[h.type==="divider"?(D(),L(w,{key:0},{default:o(()=>[F(K(h.label),1)]),_:2},1024)):(D(),P("span",wt,K(h.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[n(r,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[F(" 选择模板 ")]),_:1})]),_:1})):B("",!0)}}}),bt=G("span",null,"流程设计",-1),gt={key:0},kt={key:1},Dt={style:{height:"calc(100vh - 144px)"}},Vt=S({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(s,{emit:e}){const t=fe(s),{visible:a,modelValue:u}=t,{request:l}=U(),{create:p,deploy:m,getDetail:d,update:b}=ae(l),{getDetail:V,update:_}=ve(l),v=["流程信息","表单设计","模型设计","完成"],r=T(!1);De(a,async x=>{if(!x)return;const{flowModuleId:C}=u.value,{flowDeployId:M}=u.value;try{r.value=!0;let N={};M?N=await V({flowDeployId:M}):C&&(N=await d({flowModuleId:C})),u.value=N.data}finally{r.value=!1}},{immediate:!0});const{data:w}=de(l).useList(),y=H(()=>{var x,C;return(C=(x=w.value)==null?void 0:x.find(M=>M.tableName===u.value.formDataTable))==null?void 0:C.tableFields}),k=T(0),g=T();async function I(x){k.value===0&&await Qe(g),r.value=!0;const{flowModuleId:C}=u.value,{flowDeployId:M}=u.value;try{M?await _(u.value):C?await b(u.value):await p(u.value).then(N=>{u.value.flowModuleId=N.data.flowModuleId}),z.success("保存成功")}finally{r.value=!1}typeof x=="number"?k.value=x:k.value++}async function h(){await X.confirm("发布新版本，是否确认？","提示"),r.value=!0,m({flowModuleId:u.value.flowModuleId}).then(()=>{z.success("发布成功")}).finally(()=>{r.value=!1})}function $(){a.value=!1,k.value=0,u.value={},e("close")}return(x,C)=>{const M=f("el-col"),N=f("el-step"),q=f("el-steps"),W=f("el-button"),ne=f("el-row"),se=f("avue-form"),ie=f("el-result"),ue=f("el-dialog"),re=Ve("loading");return D(),L(ue,{modelValue:c(a),"onUpdate:modelValue":C[6]||(C[6]=O=>Q(a)?a.value=O:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:$},{header:o(()=>[n(ne,{justify:"center"},{default:o(()=>[n(M,{span:5},{default:o(()=>{var O,A,ee,we;return[G("div",null,[bt,(O=c(u))!=null&&O.flowName?(D(),P("span",gt," - "+K((A=c(u))==null?void 0:A.flowName),1)):B("",!0),(ee=c(u))!=null&&ee.version?(D(),P("span",kt," - V"+K((we=c(u))==null?void 0:we.version),1)):B("",!0)]),n(yt,{"form-data":c(u),"onUpdate:formData":C[0]||(C[0]=Me=>Q(u)?u.value=Me:null),"active-step":k.value},null,8,["form-data","active-step"])]}),_:1}),n(M,{span:14},{default:o(()=>[n(q,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(D(),P(E,null,Y(v,(O,A)=>n(N,{key:A,title:O,style:{cursor:"pointer"},onClick:ee=>I(A)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),n(M,{span:5,style:{"text-align":"right"}},{default:o(()=>[n(W,{disabled:k.value===0,loading:r.value,type:"primary",onClick:C[1]||(C[1]=O=>k.value--)},{default:o(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),n(W,{disabled:k.value===v.length-1,type:"primary",loading:r.value,onClick:C[2]||(C[2]=O=>I())},{default:o(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),n(W,{onClick:$},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[Fe((D(),P("div",Dt,[k.value===0?(D(),L(se,{key:0,ref_key:"formRef",ref:g,modelValue:c(u),"onUpdate:modelValue":C[3]||(C[3]=O=>Q(u)?u.value=O:null),option:c(Ge),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),k.value===1?(D(),L(_e,{key:1,modelValue:c(u).formOption,"onUpdate:modelValue":C[4]||(C[4]=O=>c(u).formOption=O),fields:y.value},null,8,["modelValue","fields"])):B("",!0),k.value===2?(D(),L(pe,{key:2,modelValue:c(u).flowData,"onUpdate:modelValue":C[5]||(C[5]=O=>c(u).flowData=O),"flow-form-option":c(u).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),k.value===3?(D(),L(ie,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[c(u).flowDeployId?B("",!0):(D(),L(W,{key:0,type:"primary",onClick:h},{default:o(()=>[F(" 发布 ")]),_:1})),n(W,{onClick:$},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})):B("",!0)])),[[re,r.value]])]),_:1},8,["modelValue"])}}}),Ft=G("span",null,"流程查看",-1),Ct={key:0},ht={key:1},Ot=S({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(s){const i=fe(s),{visible:t,modelValue:a}=i,{request:u}=U(),{getDetail:l}=ae(u),{getDetail:p}=ve(u),m=T("form"),d=T(!1);De(t,async V=>{if(!V)return;const{flowModuleId:_}=a.value,{flowDeployId:v}=a.value;try{d.value=!0;let r={};v?r=await p({flowDeployId:v}):_&&(r=await l({flowModuleId:_})),a.value={...r.data}}finally{d.value=!1}},{immediate:!0});function b(){a.value={},m.value="form"}return(V,_)=>{const v=f("el-tab-pane"),r=f("el-tabs"),w=f("el-dialog"),y=Ve("loading");return D(),L(w,{modelValue:c(t),"onUpdate:modelValue":_[3]||(_[3]=k=>Q(t)?t.value=k:null),width:"60%",top:"0",onClose:b},{header:o(()=>{var k,g,I,h;return[Ft,(k=c(a))!=null&&k.flowName?(D(),P("span",Ct," - "+K((g=c(a))==null?void 0:g.flowName),1)):B("",!0),(I=c(a))!=null&&I.version?(D(),P("span",ht," - V"+K((h=c(a))==null?void 0:h.version),1)):B("",!0)]}),default:o(()=>[Fe((D(),L(r,{modelValue:m.value,"onUpdate:modelValue":_[2]||(_[2]=k=>m.value=k)},{default:o(()=>[n(v,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[m.value==="form"&&c(a).formOption?(D(),L(_e,{key:0,modelValue:c(a).formOption,"onUpdate:modelValue":_[0]||(_[0]=k=>c(a).formOption=k),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),n(v,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[m.value==="flow"?(D(),L(pe,{key:0,modelValue:c(a).flowData,"onUpdate:modelValue":_[1]||(_[1]=k=>c(a).flowData=k),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[y,d.value]])]),_:1},8,["modelValue"])}}}),It=S({__name:"index",setup(s){const e=T("definition"),i=T({}),t=T(""),a=T("");function u(r){t.value===r.id?t.value="":t.value=r.id}const l=T(!1),p=T(!1);function m(){i.value={},l.value=!0}function d(r){i.value=r,l.value=!0}function b(r){i.value=r,p.value=!0}function V(r){a.value=r.flowModuleId||"",e.value="deploy"}function _(){a.value="",e.value="definition"}async function v(){const r=e.value;await be(),e.value="",await be(),e.value=`${r}`}return(r,w)=>{const y=f("el-col"),k=f("el-row");return D(),L(k,{gutter:20},{default:o(()=>[n(y,{span:4},{default:o(()=>[n(_t,{onNodeClick:u})]),_:1}),n(y,{span:20},{default:o(()=>[e.value==="definition"?(D(),L(Pe,{key:0,"category-id":t.value,onAdd:m,onEdit:d,onView:b,onVersion:V},null,8,["category-id"])):B("",!0),e.value==="deploy"&&a.value?(D(),L(Ue,{key:1,"flow-module-id":a.value,onEdit:d,onView:b,onBack:_},null,8,["flow-module-id"])):B("",!0),n(Vt,{modelValue:i.value,"onUpdate:modelValue":w[0]||(w[0]=g=>i.value=g),visible:l.value,"onUpdate:visible":w[1]||(w[1]=g=>l.value=g),onClose:v},null,8,["modelValue","visible"]),n(Ot,{modelValue:i.value,"onUpdate:modelValue":w[2]||(w[2]=g=>i.value=g),visible:p.value,"onUpdate:visible":w[3]||(w[3]=g=>p.value=g)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),xt=S({__name:"index",setup(s){const e=it("debugMode",!1),{request:i}=U(),{getTaskOpsList:t}=pt(i),{getCirculateOpsList:a,updateCirculate:u,removeCirculate:l}=Ie(i),{bindVal:p,getDataList:m,crudStateRefs:{searchForm:d,crudOption:b}}=R({tableOption:Ye,crudOption:{getList:t},searchForm:{status:te.待办},sortOption:{descs:"start_time"}});le(d,m,{debounce:300,immediate:!0,deep:!0});const V=T("task"),_=[{label:"任务",name:"task",getList:t},{label:"传阅",name:"circulate",getList:a,update:u,remove:l}];function v({paneName:k}){const g=_.find(I=>I.name===k);b.value.getList=g.getList,b.value.update=g.update,b.value.remove=g.remove,m()}const{open:r,close:w}=Ne();function y(k){r({flowKey:k.flowKey,taskId:k.taskId,instanceId:k.flowInstanceId,debug:e.value,circulateId:k.id,onComplete(){w(),m()}})}return(k,g)=>{const I=f("el-tab-pane"),h=f("el-tabs"),$=f("el-switch"),x=f("el-button"),C=f("el-link"),M=f("avue-crud");return D(),P(E,null,[n(h,{modelValue:V.value,"onUpdate:modelValue":g[0]||(g[0]=N=>V.value=N),onTabClick:v},{default:o(()=>[(D(),P(E,null,Y(_,N=>n(I,{key:N.name,label:N.label,name:N.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),n(M,ke(c(p),{permission:{menu:V.value==="circulate"}}),{"menu-right":o(()=>[n(x,{type:"text"},{default:o(()=>[n($,{modelValue:c(e),"onUpdate:modelValue":g[1]||(g[1]=N=>Q(e)?e.value=N:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:N})=>[n(C,{type:"primary",underline:!1,onClick:q=>y(N)},{default:o(()=>[F(K(N.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Lt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Xe},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},$t=S({__name:"index",setup(s){const{request:e}=U(),{bindVal:i,getDataList:t}=R({tableOption:Lt,crudOption:Ce(e)});return t(),(a,u)=>{const l=f("avue-crud");return D(),L(l,j(J(c(i))),null,16)}}}),Tt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Nt={class:"flow-list"},Pt=["onClick"],Ut={class:"flow-name"},Mt=S({__name:"index",setup(s){const{request:e}=U(),{useList:i}=Oe(e),{usePublishList:t,getTaskList:a}=Ze(e),{getCirculateList:u}=Ie(e),{data:l}=i(),{data:p}=t(),m=H(()=>{var h;return(h=l.value)==null?void 0:h.map($=>{var C;const x=((C=p.value)==null?void 0:C.filter(M=>M.categoryId===$.id))??[];return{...$,list:x}}).filter($=>{var x;return(x=$.list)==null?void 0:x.length})}),d=Re(te).filter((h,$)=>$<2).reverse(),{bindVal:b,getDataList:V,crudStateRefs:{searchForm:_,crudOption:v}}=R({tableOption:Tt,crudOption:{getList:a},searchForm:{status:te.待办}});le(_,V,{debounce:300,immediate:!0,deep:!0});const r=T("task"),w=[{label:"任务",name:"task",getList:a},{label:"传阅",name:"circulate",getList:u}];function y({paneName:h}){const $=w.find(x=>x.name===h);v.value.getList=$.getList,V()}const{open:k,close:g}=Ne();function I(h){k({flowKey:h.flowKey,taskId:h.taskId,instanceId:h.flowInstanceId,circulateId:h.id,detail:h.taskId?h.status===te.已办:!1,onComplete(){g(),V()}})}return(h,$)=>{const x=f("el-button"),C=f("el-divider"),M=f("Icon"),N=f("el-collapse-item"),q=f("el-collapse"),W=f("el-card"),ne=f("el-tab-pane"),se=f("el-tabs"),ie=f("avue-radio"),ue=f("el-link"),re=f("avue-crud");return D(),P(E,null,[n(W,{"body-style":{padding:"0 20px"}},{default:o(()=>[n(q,{"model-value":"1"},{default:o(()=>[n(N,{name:"1"},{title:o(()=>[n(x,{text:"",icon:"el-icon-promotion"},{default:o(()=>[F(" 发起审批 ")]),_:1})]),default:o(()=>[G("div",Nt,[(D(!0),P(E,null,Y(m.value,O=>(D(),P("div",{key:O.id,class:"flow-category"},[n(C,{"content-position":"left"},{default:o(()=>[F(K(O.name),1)]),_:2},1024),(D(!0),P(E,null,Y(O.list,A=>(D(),P("div",{key:A.flowKey,class:"flow-item",onClick:ee=>I(A)},[n(M,{class:"flow-icon",icon:A.flowIcon,width:"60"},null,8,["icon"]),G("div",Ut,K(A.flowName),1)],8,Pt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),n(C,{direction:"horizontal","content-position":"left"}),n(se,{modelValue:r.value,"onUpdate:modelValue":$[0]||($[0]=O=>r.value=O),onTabClick:y},{default:o(()=>[(D(),P(E,null,Y(w,O=>n(ne,{key:O.name,label:O.label,name:O.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),n(re,j(J(c(b))),{"menu-left":o(()=>[n(ie,{modelValue:c(_).status,"onUpdate:modelValue":$[1]||($[1]=O=>c(_).status=O),button:"",dic:c(d)},null,8,["modelValue","dic"])]),processTitle:o(({row:O})=>[n(ue,{type:"primary",underline:!1,onClick:A=>I(O)},{default:o(()=>[F(K(O.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),St=Ae(Mt,[["__scopeId","data-v-cd3183a3"]]),Bt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Kt=S({__name:"index",setup(s){const{request:e}=U(),{bindVal:i,crudStateRefs:{formData:t},getDataList:a,handleUpdate:u}=R({tableOption:Bt,crudOption:Le(e)});a();const l=T(!1);async function p(d){t.value=d,l.value=!0}async function m(){await u(t.value,NaN,()=>l.value=!1,()=>{})}return(d,b)=>{const V=f("el-button"),_=f("avue-crud"),v=f("el-dialog");return D(),P(E,null,[n(_,j(J(c(i))),{menu:o(({row:r})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>p(r)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(v,{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=r=>l.value=r),title:`模型设计-${c(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(V,{type:"primary",onClick:m},{default:o(()=>[F(" 保存 ")]),_:1}),n(V,{onClick:b[1]||(b[1]=r=>l.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[n(pe,{modelValue:c(t).flowData,"onUpdate:modelValue":b[0]||(b[0]=r=>c(t).flowData=r),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),At={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Et=S({__name:"index",setup(s){const{request:e}=U(),{bindVal:i,crudStateRefs:{formData:t},getDataList:a,handleUpdate:u}=R({tableOption:At,crudOption:$e(e)});a();const l=T(!1);async function p(d){t.value={...d},l.value=!0}async function m(){await u(t.value,NaN,()=>l.value=!1,()=>{})}return(d,b)=>{const V=f("el-button"),_=f("avue-crud"),v=f("el-dialog");return D(),P(E,null,[n(_,j(J(c(i))),{menu:o(({row:r})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>p(r)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(v,{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=r=>l.value=r),title:`表单设计-${c(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(V,{type:"primary",onClick:m},{default:o(()=>[F(" 保存 ")]),_:1}),n(V,{onClick:b[1]||(b[1]=r=>l.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[n(_e,{modelValue:c(t).formOption,"onUpdate:modelValue":b[0]||(b[0]=r=>c(t).formOption=r),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Rt=G("br",null,null,-1),zt=S({__name:"index",setup(s){const{request:e}=U(),{bindVal:i,crudStateRefs:{formData:t,defaults:a},getDataList:u,afterOpen:l,beforeSubmit:p}=R({crudOption:de(e),tableOption:qe});u();const{data:m}=Ce(e).useParam("table.default.fields");l(w=>{if(t.value.defaultFields=m.value??[],w==="edit"){const y=JSON.parse(t.value.tableFields);t.value.editFields=ct(y,m.value??[],"name")}}),p(w=>{const y=[...w.defaultFields,...w.editFields];w.tableFields=JSON.stringify(y)});const d=T(!1);ce(()=>{var w;(w=a.value)!=null&&w.defaultFields&&(a.value.defaultFields.display=d.value)});const{deploy:b,getFields:V}=de(e),_=T(!1);async function v(w){await X.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,b({id:w.id}).then(()=>{z.success("部署成功"),u()}).finally(()=>{_.value=!1})}function r(){V({tableName:t.value.tableName}).then(w=>{var y;if(!((y=w.data)!=null&&y.length))return z.warning("未找到该表");t.value.editFields=w.data})}return(w,y)=>{const k=f("el-button"),g=f("el-input"),I=f("el-switch"),h=f("el-tooltip"),$=f("avue-crud");return D(),L($,j(J(c(i))),{menu:o(({row:x})=>[n(k,{type:"text",icon:"el-icon-upload",onClick:C=>v(x)},{default:o(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[n(g,{modelValue:c(t).tableName,"onUpdate:modelValue":y[0]||(y[0]=x=>c(t).tableName=x),placeholder:"请输入 表名"},{append:o(()=>[n(k,{type:"primary",size:"default",onClick:r},{default:o(()=>[F(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[G("div",null,[F(" 数据库字段 "),Rt,n(h,{content:"显示默认字段"},{default:o(()=>[n(I,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=x=>d.value=x)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),jt=S({__name:"index",setup(s){const e=ut(),i=T({}),{FlowForm:t}=U(),a=H(()=>{const l=i.value.flowInstance;return e.instanceId||e.taskId?`流程详情：${l==null?void 0:l.title}`:`发起流程：${l==null?void 0:l.title}`});rt(a);async function u(l){window.postMessage({event:"onComplete",data:{...l}})}return(l,p)=>(D(),L(c(t),{flowDetail:i.value,"onUpdate:flowDetail":p[0]||(p[0]=m=>i.value=m),"task-id":c(e).taskId,"instance-id":c(e).instanceId,detail:c(e).detail,"flow-key":c(e).flowKey,onComplete:u},null,8,["flowDetail","task-id","instance-id","detail","flow-key"]))}}),Jt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:vt,PageFlowDefinition:Pe,PageFlowDeploy:Ue,PageFlowForm:jt,PageFlowManage:It,PageFlowOps:xt,PageFlowParam:$t,PageFlowTemplate:Kt,PageFlowWorkbench:St,PageFormTemplate:Et,PageTableTemplate:zt},Symbol.toStringTag,{value:"Module"})),wo={install(s,e){Object.entries(Jt).forEach(([i,t])=>{s.component(i,t)}),U(s,e)}};export{go as ApprovalForm,ko as ButtonList,ze as CONFIG_DEFAULT,Do as CONFIG_PROVIDE_KEY,Vo as FieldType,Fo as FlowButtonApproval,Co as FlowButtonDisplay,ho as FlowButtonKey,Oo as FlowButtonStatus,Io as FlowButtonType,xo as FlowForm,Lo as FlowStatus,$o as HandleType,To as InternalForm,xe as IsMainVersion,vt as PageFlowButton,Pe as PageFlowDefinition,Ue as PageFlowDeploy,jt as PageFlowForm,It as PageFlowManage,xt as PageFlowOps,$t as PageFlowParam,Kt as PageFlowTemplate,St as PageFlowWorkbench,Et as PageFormTemplate,zt as PageTableTemplate,No as TablePrimary,te as TaskStatus,Po as UploadTable,Uo as Whether,Qe as asyncValidate,wo as default,Mo as fieldTypeDic,So as flowFormEmits,Bo as flowFormProps,Ko as flowTrack,Ao as injectionKey,Eo as tablePrimaryDic,Ro as useButtonHandler,zo as useCommonCommentApi,U as useConfigProvider,Je as useFlowButtonApi,Oe as useFlowCategoryApi,Ie as useFlowCirculateApi,ae as useFlowDefinitionApi,ve as useFlowDeployApi,jo as useFlowFileApi,Ne as useFlowForm,ft as useFlowFormOverlay,mt as useFlowFormWindow,pt as useFlowOpsApi,Ce as useFlowParamApi,Ze as useFlowTaskApi,Le as useFlowTemplateApi,Jo as useFlowUserApi,Wo as useFormDefaults,$e as useFormTemplateApi,Ho as useInjectState,Go as useProvideState,de as useTableTemplateApi,Xe as whetherDic};
