import{bQ as le,dB as tt,dC as ce,dD as Tt,dE as oe,bc as ye,dF as Nt,d4 as Ot,d6 as It,cw as Lt,a5 as $t,by as St,bR as ke}from"../composables_use-crud_index.md.ff48cf7f.js";import{U as Ae,A as Ve,r as $,s as Ie,d as R,e as ie,w as ve,a6 as te,u as V,n as de,V as Ut,h as j,b as rt,ar as Pe,G as k,i as T,C as U,D as p,I as _,m as E,p as q,a0 as ot,aK as Me,a2 as Ke,B as Z,E as Q,j as B,N as pe,F as X,J as Pt,_ as Be,av as ne,aw as re,k as Et,b2 as Rt,au as Ft,aN as At,l as Mt}from"./framework.bb591d25.js";import{M as st,f as Kt,t as Ee,L as Bt,u as jt}from"./vuedraggable.umd.6e8aae07.js";import{L as zt,M as qt,s as Wt,N as Qt,O as Ht}from"../app.a0fbb67d.js";import"./mysqlWorkbench.a343a5ce.js";import{d as Gt}from"./data.4cb21f02.js";import{a as Jt}from"../flow-design_flow-modeler_index.md.429080b3.js";import{u as De,a as Yt,c as Xt}from"./theme.733a67e1.js";import"./vue.runtime.esm-bundler.c84ff5cc.js";import"../components_icon-select_index.md.9b5df973.js";import"../components_index.md.a071e943.js";import"../components_v-text_index.md.3276e479.js";import"../composables_index.md.ee547963.js";import"../flow-design_flow-viewer_index.md.1320c504.js";import"../flow-design_index.md.71f89b63.js";import"../flow-pages_index.md.b36270ef.js";import"../flow-pages_pages_flow-button_index.md.53b1b4a7.js";import"../flow-pages_pages_flow-manage_index.md.78036b7c.js";import"../flow-pages_pages_flow-ops_index.md.94496f30.js";import"../flow-pages_pages_flow-param_index.md.9009d564.js";import"../flow-pages_pages_flow-template_index.md.33431d91.js";import"../flow-pages_pages_flow-workbench_index.md.814882c7.js";import"../flow-pages_pages_form-template_index.md.f486cc1d.js";import"../flow-pages_pages_table-template_index.md.77a5284c.js";import"../form-design_demo.md.8fdb3921.js";import"../form-design_index.md.a38e33b9.js";import"../guide_changelog.md.5e061225.js";import"../guide_start.md.083770d4.js";import"../index.md.ecbcf3a6.js";import"../plugins_avue-patch_index.md.2e853b9f.js";import"../plugins_env-dts_index.md.c312023f.js";import"../plugins_index.md.dd7f79b6.js";import"../plugins_load-proxy_index.md.1cfc5186.js";import"../plugins_setup-extend_index.md.1811b24a.js";import"../plugins_uni-ui-patch_index.md.7eeaebfb.js";import"../plugins_uview-patch_index.md.f8b64fe3.js";import"../types_avue_index.md.2fb869ec.js";import"../utils_date_dateFormat.md.b8a158e0.js";import"../utils_date_durationFormat.md.797cda4d.js";import"../utils_emitter_mittAsync.md.b3a4dee0.js";import"../utils_index.md.2419292d.js";import"../utils_math_index.md.06a3fbd0.js";import"../utils_object_filterObj.md.d86e7e47.js";import"../utils_object_filterObjDeep.md.8bf78672.js";import"../utils_object_getDataType.md.9fc6abe7.js";import"../utils_string_deserialize.md.20267d67.js";import"../utils_string_serialize.md.5b24c073.js";import"../utils_string_uuid.md.77aee2e2.js";import"../utils_tool_awaitTo.md.2bddde9d.js";import"../utils_tool_enumToDic.md.5ae4cf6f.js";import"../utils_tool_sleep.md.bc3a2b0f.js";import"../utils_tree_buildTree.md.798fc546.js";import"../utils_tree_filterTree.md.e72e35d2.js";import"../utils_tree_findTree.md.f745ffa9.js";import"../utils_tree_flatTree.md.711d8133.js";import"../utils_tree_treeMap.md.e1d1d735.js";const Zt={},eo=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),to=()=>Zt,oo=e=>Array.isArray(e),je=e=>e!==null&&typeof e=="object",it=e=>e instanceof Function,we=e=>e==null,ze=typeof window>"u",ut=()=>{var e;return ze||we((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},lo=()=>{var e,t;return(e=!ze&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Le=()=>new Promise(()=>{}),ae=e=>te(e)?e.value:e,ao=e=>je(e)?Object.assign(oo(e)?[]:{},e):e,be=new Map,no=e=>we(e)?void 0:be.get(e),ro=(e,t,o)=>{const i=be.get(e);i!=null&&i.timer&&clearTimeout(i.timer);const n=setTimeout(()=>be.delete(e),t);be.set(e,{...o,timer:n})},ue=e=>e;function ct(e,t,o){let i,n,a,u,l,r,s=0,d=!1,f=!1,m=!0;const c=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,je(o)&&(d=!!o.leading,f="maxWait"in o,a=f?Math.max(+o.maxWait||0,t):a,m="trailing"in o?!!o.trailing:m);function w(O){const I=i,x=n;return i=n=void 0,s=O,u=e.apply(x,I),u}function b(O,I){return c?(window.cancelAnimationFrame(l),window.requestAnimationFrame(O)):setTimeout(O,I)}function y(O){if(c)return window.cancelAnimationFrame(O);clearTimeout(O)}function N(O){return s=O,l=b(v,t),d?w(O):u}function h(O){const I=O-r,x=O-s,F=t-I;return f?Math.min(F,a-x):F}function L(O){const I=O-r,x=O-s;return r===void 0||I>=t||I<0||f&&x>=a}function v(){const O=Date.now();if(L(O))return g(O);l=b(v,h(O))}function g(O){return l=void 0,m&&i?w(O):(i=n=void 0,u)}function C(){l!==void 0&&y(l),s=0,i=r=n=l=void 0}function D(){return l===void 0?u:g(Date.now())}function S(){return l!==void 0}function P(...O){const I=Date.now(),x=L(I);if(i=O,n=this,r=I,x){if(l===void 0)return N(r);if(f)return l=b(v,t),w(r)}return l===void 0&&(l=b(v,t)),u}return P.cancel=C,P.flush=D,P.pending=S,P}function so(e,t,o){let i=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return je(o)&&(i="leading"in o?!!o.leading:i,n="trailing"in o?!!o.trailing:n),ct(e,t,{leading:i,trailing:n,maxWait:t})}var io=ue((e,{debounceInterval:t,debounceOptions:o,manual:i})=>{const n=$(!1),a=$(),u=R(()=>o),l=R(()=>ae(t)),r=$(e.context.runAsync);return i||(n.value=!0),ie(s=>{we(l.value)||(a.value=ct(d=>d(),l.value,u.value),e.context.runAsync=(...d)=>new Promise((f,m)=>{n.value?(n.value=!1,r.value(...d).then(f).catch(m)):a.value(()=>{r.value(...d).then(f).catch(m)})}),s(()=>{var d;(d=a.value)===null||d===void 0||d.cancel(),e.context.runAsync=r.value}))}),{onCancel(){var s;(s=a.value)===null||s===void 0||s.cancel()}}}),uo=ue((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const i=$(),n=$(0),a=R(()=>ae(t)),u=R(()=>ae(o));let l=!1;const r=()=>{n.value=0},s=R(()=>{if(u.value)return u.value;const m=1e3,c=1,w=9,b=Math.floor(Math.random()*2**Math.min(n.value,w)+c);return m*b}),d=()=>{let m;const c=a.value===-1,w=n.value<a.value;return(c||w)&&(c||(n.value+=1),m=setTimeout(()=>{l=!0,e.context.refresh()},s.value)),()=>m&&clearTimeout(m)},f=()=>{i.value&&i.value()};return{onBefore(){l||r(),l=!1,f()},onSuccess(){r()},onError(){i.value=d()},onCancel(){r(),f()}}}),co=ue((e,{ready:t=$(!0),manual:o,defaultParams:i=[]})=>(ve(t,n=>{!o&&n&&e.context.run(...i)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),po=ue((e,{refreshDeps:t=[],refreshDepsAction:o,manual:i})=>(t!=null&&t.length&&ve(t,()=>{o?o():!i&&e.context.refresh()}),{})),fo=ue((e,{throttleInterval:t,throttleOptions:o})=>{const i=$(),n=R(()=>ae(t)),a=R(()=>o),u=$(e.context.runAsync);return ie(l=>{if(we(t))return{};i.value=so(r=>r(),n.value,a.value),e.context.runAsync=(...r)=>new Promise((s,d)=>{i.value(()=>{u.value(...r).then(s).catch(d)})}),l(()=>{var r;(r=i.value)===null||r===void 0||r.cancel(),e.context.runAsync=u.value})}),{onCancel(){var l;(l=i.value)===null||l===void 0||l.cancel()}}});const mo=(e,t)=>o=>{Object.keys(o).forEach(i=>{e[i].value=o[i]}),t.forEach(i=>i(e))},vo=(e,t)=>()=>{let o=t;for(let i=e.length;i-- >0;)o=e[i](o);return o()},_o=(e,t,o)=>{var i,n;const{initialData:a,onSuccess:u,onError:l,onBefore:r,onAfter:s}=t,d=$((i=o==null?void 0:o.loading)!==null&&i!==void 0?i:!1),f=Ie((n=o==null?void 0:o.data)!==null&&n!==void 0?n:a),m=Ie(o==null?void 0:o.error),c=$(o==null?void 0:o.params),w=$([]),b=Ie("pending"),y={},N=mo({status:b,loading:d,data:f,error:m,params:c},[]),h=(v,...g)=>{if(v==="onQuery"){const C=w.value.map(D=>D.onQuery).filter(Boolean);return{servicePromise:vo(C,g[0])()}}else{const C=w.value.map(D=>{var S;return(S=D[v])===null||S===void 0?void 0:S.call(D,...g)});return Object.assign({},...C)}},L=$(0);return y.runAsync=async(...v)=>{N({loading:!0,params:v,status:"pending"}),L.value+=1;const g=L.value,{isBreak:C,breakResult:D=Le()}=h("onBefore",v);if(C)return N({status:"settled"}),D;r==null||r(v);try{const S=()=>new Promise(I=>I(e(...c.value)));let{servicePromise:P}=h("onQuery",S);P||(P=S());const O=await P;return g!==L.value?Le():(N({data:O,loading:!1,error:void 0,status:"settled"}),h("onSuccess",O,v),u==null||u(O,v),h("onAfter",v,O,void 0),s==null||s(v),O)}catch(S){if(g!==L.value)return Le();throw N({loading:!1,error:S,status:"settled"}),h("onError",S,v),l==null||l(S,v),h("onAfter",v,void 0,S),s==null||s(v),S}},y.run=(...v)=>{y.runAsync(...v).catch(g=>{l||console.error(g)})},y.cancel=()=>{L.value+=1,N({loading:!1}),h("onCancel")},y.refresh=()=>{y.run(...c.value||[])},y.refreshAsync=()=>y.runAsync(...c.value||[]),y.mutate=v=>{const g=it(v)?v(f.value):v,C=ao(g);N({data:C}),h("onMutate",C)},{status:b,loading:d,data:f,error:m,params:c,plugins:w,context:y}};function wo(e,t={},o){const i=Ae(eo,{}),n={...to(),...i,...t},{manual:a=!1,defaultParams:u=[]}=n,l=_o(e,n);if(l.plugins.value=o.map(r=>r(l,n)),!a){const r=l.params.value||u;l.context.run(...r)}return Ve(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ge=new Map,yo=(e,t)=>{ge.set(e,t),t.then(o=>(ge.delete(e),o)).catch(()=>{ge.delete(e)})},bo=e=>ge.get(e),me=new Map,go=(e,t)=>{me.has(e)&&me.get(e).forEach(o=>o(t))},ho=(e,t)=>(me.has(e)?me.get(e).push(t):me.set(e,[t]),()=>{const o=me.get(e).indexOf(t);me.get(e).splice(o,1)});var ko=ue((e,{cacheKey:t,cacheTime:o=6e5,staleTime:i=0,getCache:n,setCache:a})=>{if(!t)return{};const u=it(t)?t:()=>t,l=$(()=>{});let r;const s=y=>n?n(y):no(y),d=(y,N,h)=>{a?a(y,h):ro(y,N,h),go(y,h.data)},f=y=>i===-1||y+i>new Date().getTime(),m=(y,N)=>Object.prototype.hasOwnProperty.call(y,N),c=y=>{const N=u(y);return ho(N,h=>{e.data.value=h})},w=u(),b=s(w);return b&&m(b,"data")&&(e.data.value=b.data,e.params.value=b.params),w&&(l.value=c()),Ve(()=>{l.value()}),{onBefore(y){const N=u(y),h=s(N);if(!h||!m(h,"data"))return{};if(f(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(y){const N=e.params.value,h=u(N);let L=bo(h);return L&&L!==r?()=>L:(L=y(),r=L,yo(h,L),()=>L)},onSuccess(y,N){const h=u(N);h&&(l.value(),d(h,o,{data:y,params:N,time:new Date().getTime()}),l.value=c(N))},onMutate(y){const N=u(e.params.value);N&&(l.value(),d(N,o,{data:y,params:e.params.value,time:new Date().getTime()}),l.value=c(e.params.value))}}});function Vo(e){let t,o;class i extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new i(n=>{o=n,t=setTimeout(o,e)})}function $e(){return new Date().getTime()}var Do=ue((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const i=$(()=>{}),n=R(()=>ae(t)),a=R(()=>ae(o));let u=0,l={};const r=()=>{let s;return n.value&&(s=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},n.value)),()=>s&&clearTimeout(s)};return{onBefore(){e.loading.value=!n.value,i.value(),i.value=r(),u=$e()},onQuery(s){if(!a.value)return()=>s();l=Vo(a.value+n.value);const d=async()=>{try{const m=await s();return $e()-u<=n.value&&l.cancel(),Promise.resolve(m)}catch(m){return $e()-u<=n.value&&l.cancel(),Promise.reject(m)}},f=Promise.allSettled([d(),l]).then(m=>{const c=m[0];return c.status==="fulfilled"?c.value:Promise.reject(c.reason)});return()=>f},onCancel(){i.value()},onAfter(){i.value()}}}),Se;const dt=new Set,pt=new Set,ft=new Set,he=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=dt;break;case"RECONNECT_LISTENER":o=ft;break;case"VISIBLE_LISTENER":o=pt;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Ue=e=>{e.forEach(t=>{t()})};!ze&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{ut()&&Ue(pt)},!1),window.addEventListener("focus",()=>Ue(dt),!1),window.addEventListener("online",()=>Ue(ft),!1));var Co=ue((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:i=!1,errorRetryCount:n=0})=>{const a=$(),u=$(!1),l=R(()=>ae(t)),r=R(()=>ae(n)),s=[],d=w=>{w&&s.push(w)},f=()=>(o||ut())&&(i||lo()),m=w=>{if(e.error.value&&r.value!==0)return;let b;if(!we(l.value)&&l.value>=0)if(f())b=setTimeout(w,l.value);else{u.value=!0;return}return()=>b&&clearTimeout(b)},c=()=>{u.value&&f()&&(e.context.refresh(),u.value=!1)};return ve(l,()=>{a.value&&(a.value(),a.value=m(()=>e.context.refresh()))}),o||d(he("VISIBLE_LISTENER",c)),i||d(he("RECONNECT_LISTENER",c)),Ve(()=>{s.forEach(w=>w())}),{onBefore(){var w;(w=a.value)===null||w===void 0||w.call(a)},onCancel(){var w;(w=a.value)===null||w===void 0||w.call(a)},onAfter(){a.value=m(()=>e.context.refresh())}}});const xo=(e,t)=>{let o=!1;return(...i)=>{o||(o=!0,e(...i),setTimeout(()=>{o=!1},t))}};var To=ue((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const i=R(()=>ae(t)),n=R(()=>ae(o)),a=[],u=r=>{r&&a.push(r)},l=()=>{a.forEach(r=>r())};return ie(()=>{if(l(),i.value){const r=xo(e.context.refresh,n.value);u(he("VISIBLE_LISTENER",r)),u(he("FOCUS_LISTENER",r))}}),Ve(()=>{l()}),{}});function _e(e,t){return wo(e,t,[Do,uo,io,Co,fo,To,po,co,ko])}function Ce(){const{request:e}=H(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:c=>e.get(t.detail,{params:c}),getApprovalNode:c=>e.post(t.approvalNode,c),startTask:c=>e.post(t.start,c),commitTask:c=>e.post(t.commit,c),saveDraft:c=>e.post(t.draft,c),revokeTask:c=>e.post(t.revoke,c),terminateTask:c=>e.post(t.terminate,c),withdrawTask:c=>e.post(t.withdraw,c),transferTask:c=>e.post(t.transfer,c),getPublishFlow:()=>e.get(t.publish),getTodoList:c=>e.get(t.todo,{params:c})}}function No(e){const{commitTask:t,revokeTask:o,saveDraft:i,startTask:n,terminateTask:a,transferTask:u,withdrawTask:l}=Ce(),r=R(()=>{const{flowDetail:d,formVariables:f,approvalFormData:m,debug:c}=e,{flowDeployId:w}=d.value.process??{},{taskId:b,flowInstanceId:y}=d.value.task??{};return{flowDeployId:w,taskId:b,flowInstanceId:y,variables:f.value,debug:c.value,...m.value}}),s=()=>r.value.taskId&&r.value.flowInstanceId;return{flow_draft(){if(s())return i(r.value)},flow_pass(){return s()?t(r.value):n(r.value)},flow_revoke(){if(s())return o(r.value)},flow_withdraw(){if(s())return l(r.value)},flow_terminate(){if(s())return a(r.value)},flow_transfer(){if(s())return u(r.value)}}}function Oo(e){const t=$({});return ie(async()=>{var i;const{formProperty:o}=((i=V(e))==null?void 0:i.properties)||{};o!=null&&o.length&&(await de(),Object.keys(t.value).forEach(n=>{var l,r,s,d;const a=((l=t.value[n])==null?void 0:l.label)||"",u=o==null?void 0:o.find(f=>f.prop===n);if(t.value[n].display=u==null?void 0:u.display,t.value[n].disabled=u==null?void 0:u.disabled,t.value[n].detail=u==null?void 0:u.detail,t.value[n].readonly=u==null?void 0:u.readonly,t.value[n].rules=t.value[n].rules??[],u!=null&&u.required&&((r=t.value[n].rules)!=null&&r.some(f=>f.required)))return null;u!=null&&u.required?(s=t.value[n].rules)==null||s.push({required:!0,message:`${a}为必填项`}):t.value[n].rules=(d=t.value[n].rules)==null?void 0:d.filter(f=>!f.required)}))}),t}function Io(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Lo(){return{complete:e=>e}}const mt=Symbol("flowFormState");function $o(e,t){const o=De(e,void 0,{passive:!0,deep:!0}),{flowDetail:i,modelValue:n,formLoading:a}=o,{getFlowDetail:u}=Ce();ie(()=>{const{flowKey:c,taskId:w,instanceId:b}=e;!c&&!w&&!b||(a.value=!0,u({flowKey:c,taskId:w,flowInstanceId:b}).then(y=>{i.value=y.data,n.value=y.data.formData||{}}).finally(()=>{a.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),r=R(()=>{var c,w,b,y;return l.value.fileTab===!0&&((y=(b=(w=(c=i.value)==null?void 0:c.properties)==null?void 0:w.formProperty)==null?void 0:b.find(N=>N.prop==="fileTab"))==null?void 0:y.display)}),s=R(()=>{var c,w,b,y;return l.value.trackTab===!0&&((y=(b=(w=(c=i.value)==null?void 0:c.properties)==null?void 0:w.formProperty)==null?void 0:b.find(N=>N.prop==="trackTab"))==null?void 0:y.display)}),d=$(!1),f=R(()=>Object.entries(n.value||{}).filter(([c])=>!c.startsWith("$")).map(([c,w])=>({key:c,value:w}))),m={...o,formData:n,formVariables:f,approvalVisible:d,showFileTab:r,showTrackTab:s,permission:l,emit:t};return Ut(mt,m),m}function vt(){return Ae(mt)}function qe(e){return new Promise((t,o)=>{V(e).validate((n,a,u)=>{n?(a(),t(u)):o(u)})})}const So=j({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=De(e,void 0,{passive:!0,deep:!0}),o=Oo(e.flowDetail),{proxy:i}=rt(),n=$({});ie(()=>{const{formOption:l}=e.flowDetail.process??{};n.value=st.bind(i)(l||'{"menuBtn":false}'),n.value.detail=!!e.detail});const a=$();function u(){return qe(a)}return{form:t,option:n,defaults:o,formRef:a,validate:u}},render(){return Pe(k("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Uo=j({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Yt(e,"modelValue"),{batchUpdate:i,create:n,remove:a,useList:u}=Zo(),l=$(!1),{activeBtn:r}=vt(),s=R(()=>{var L;return(L=r.value)==null?void 0:L.buttonKey}),{data:d,refresh:f}=u(s),m=R(()=>{var v,g,C;const L=o.value;if(L&&!((v=d.value)!=null&&v.some(D=>D.content===L))){const D=(((C=(g=d.value)==null?void 0:g[0])==null?void 0:C.sort)||1)-1;return[{content:L,sort:D},...d.value||[]]}return d.value});async function c(L){var v;await n({...L,type:(v=r.value)==null?void 0:v.buttonKey}),le.success("添加成功"),f()}async function w(L){await a(L.id),le.success("删除成功"),f()}async function b(L,v){let g=v.parent.data;g=g.map((C,D)=>({id:C.id,sort:D+1})),await i(g),le.success("修改排序成功"),f(),l.value=!1}function y(){l.value=!0}const N=$();async function h(L){var v;o.value=L.content,await de(),(v=N.value)==null||v.blur()}return(L,v)=>{const g=k("el-input"),C=k("el-text"),D=k("el-col"),S=k("el-button"),P=k("el-row"),O=k("el-tree"),I=k("el-popover");return T(),U(I,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:p(()=>[_(g,{ref_key:"inputRef",ref:N,modelValue:V(o),"onUpdate:modelValue":v[0]||(v[0]=x=>te(o)?o.value=x:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:v[1]||(v[1]=x=>l.value=!0),onBlur:v[2]||(v[2]=x=>l.value=!1)},null,8,["modelValue"])]),default:p(()=>[_(O,{data:m.value,"node-key":"content",draggable:"","allow-drop":(x,F,M)=>M!=="inner",props:{label:"content"},onNodeClick:h,onNodeDrop:b,onNodeDragStart:y},{default:p(({data:x})=>[_(P,{style:{width:"250px"}},{default:p(()=>[_(D,{span:20},{default:p(()=>[_(C,{truncated:"",title:x.content},{default:p(()=>[E(q(x.content),1)]),_:2},1032,["title"])]),_:2},1024),_(D,{span:4},{default:p(()=>[x.id?(T(),U(S,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:ot(F=>w(x),["stop"])},null,8,["onClick"])):(T(),U(S,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:ot(F=>c(x),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Po=j({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Ce(),i={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:n,approvalFormData:a,activeBtn:u,approvalVisible:l,formVariables:r,flowDetail:s}=vt(),d=$([]),f=$([]),m=$([]),c=$([]),w=$(),b=$({}),y={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:N}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function N(I,x,F){var z;const M=d.value[0].type==="ParallelGateway",K=(z=d.value[0].children)==null?void 0:z.every(ee=>Kt([ee],G=>f.value.some(J=>J.id===G.id)));if(f.value.length){if(M&&!K)return F("请在每个节点选择审批人")}else return F("请选择审批人");return!0}const h=$(),L=R(()=>{var I,x;return(x=(I=u.value)==null?void 0:I.approval)==null?void 0:x.includes("assignee")}),v=R(()=>{var I,x;return(x=(I=u.value)==null?void 0:I.approval)==null?void 0:x.includes("circulate")}),g=R(()=>{var I,x;return(x=(I=u.value)==null?void 0:I.approval)==null?void 0:x.includes("copyUser")}),C=$(!1),D=$(!1);ie(async()=>{var M,K,z,ee,G;if(!l.value||!w.value)return;const{flowKey:I}=((M=s.value)==null?void 0:M.process)||{},{taskId:x}=((K=s.value)==null?void 0:K.task)||{};d.value=[],f.value=[],m.value=[],c.value=[];const F=x?"":"发起";if(a.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:n.value.comment||F},de(()=>{var J,Y;b.value.assignee.display=L.value,b.value.circulate.display=v.value,b.value.copyUser.display=g.value,b.value.comment.display=(Y=(J=u.value)==null?void 0:J.approval)==null?void 0:Y.includes("comment")}),L.value)try{D.value=!0;const J=u.value.buttonKey!=="flow_transfer",Y=await o({flowKey:I,variables:r.value,taskId:x,loadConfig:J});d.value=Ee(Y.data??[],(se,Ze,W)=>{const fe=se.id||tt();return se.taskNodeKey=(W==null?void 0:W.taskNodeKey)??se.taskNodeKey,se.incoming=(W==null?void 0:W.incoming)??se.incoming,{...se,id:fe,disabled:se.type!=="user"}}),await de();const A=S(d.value);A&&((z=h.value)==null||z.setCheckedNodes([A]))}finally{D.value=!1}if(g.value){const J=await o({flowKey:I,variables:r.value,taskId:x,loadConfig:!1});m.value=Ee(((G=(ee=J.data)==null?void 0:ee[0])==null?void 0:G.children)??[],Y=>{var A;return Y.id||tt(),{...Y,label:Y.title,disabled:Y.type!=="user"&&!((A=Y.children)!=null&&A.length)}})}});function S(I){var x;if(I.length===1)return(x=I[0].children)!=null&&x.length?S(I[0].children):I[0]}async function P(I,x){var M,K;if(I.type!=="user")return;await de(),await de();const F=(M=h.value)==null?void 0:M.getCheckedNodes();f.value=F.filter(z=>z.type==="user"),(K=h.value)==null||K.setCheckedNodes(f.value)}async function O(){await qe(w),C.value=!0;const I={},x={},F=new Set;f.value.forEach(M=>{const{taskNodeKey:K,incoming:z}=M;I[K]||(I[K]=new Set),M.userId&&I[K].add(M.userId),x[K]=[...I[K]].join(","),F.add(z)}),a.value.assignee=x,a.value.outgoing=[...F],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",n),t("confirm")}return(I,x)=>{const F=k("el-col"),M=k("el-tag"),K=k("el-tree-select"),z=k("avue-form"),ee=k("el-row"),G=k("el-button"),J=k("el-dialog"),Y=Me("loading");return T(),U(J,{modelValue:V(l),"onUpdate:modelValue":x[6]||(x[6]=A=>te(l)?l.value=A:null),title:V(u).name,width:L.value?"800px":"500px","append-to-body":""},{footer:p(()=>[_(G,{onClick:x[5]||(x[5]=A=>l.value=!1)},{default:p(()=>[E(" 取 消 ")]),_:1}),_(G,{type:"primary",onClick:O},{default:p(()=>[E(" 确 定 ")]),_:1})]),default:p(()=>[_(ee,{gutter:20},{default:p(()=>[L.value?(T(),U(F,{key:0,span:10},{default:p(()=>[Ke((T(),U(V(zt),{ref_key:"treeRef",ref:h,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:d.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:P},{default:p(({data:A})=>[Z("div",null,[_(V(qt),{icon:i[A.type],style:{display:"inline-block"}},null,8,["icon"]),Z("span",null,q(A.title),1)])]),_:1},8,["data"])),[[Y,D.value]])]),_:1})):Q("",!0),_(F,{span:L.value?14:24},{default:p(()=>[_(z,{ref_key:"formRef",ref:w,modelValue:V(a),"onUpdate:modelValue":x[3]||(x[3]=A=>te(a)?a.value=A:null),defaults:b.value,"onUpdate:defaults":x[4]||(x[4]=A=>b.value=A),option:y},{assignee:p(()=>[(T(!0),B(X,null,pe(f.value,A=>(T(),U(M,{key:A.id,type:"info"},{default:p(()=>[E(q(A.title),1)]),_:2},1024))),128))]),copyUser:p(()=>[_(K,{modelValue:c.value,"onUpdate:modelValue":[x[0]||(x[0]=A=>c.value=A),x[1]||(x[1]=A=>V(a).copyUser=A.join(","))],data:m.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:p(()=>[_(Uo,{modelValue:V(a).comment,"onUpdate:modelValue":x[2]||(x[2]=A=>V(a).comment=A)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Eo=Jt,lt=j({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:i}=ol(),n=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(s){t("update:modelValue",s.join(","))}}),a=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(s){t("update:modelValue",s)}}),u=$([]),l=$(!1),r=R(()=>{var s,d;return(d=(s=o.tableData)==null?void 0:s.row)==null?void 0:d.type});return ve(r,s=>{["dept","post","user"].includes(s)&&(l.value=!0,i(s==="user"?"":s).then(d=>{u.value=Ee(d.data,f=>({label:f.title,value:f.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(s,d)=>{const f=k("el-tree-select"),m=k("el-input");return["dept","post","user"].includes(r.value)?(T(),U(f,{key:0,modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=c=>n.value=c),data:u.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(T(),U(m,{key:1,modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=c=>a.value=c)},null,8,["modelValue"]))}}}),Ro={key:0,class:"flow-viewer"},Fo={class:"flow-status-legend"},Ao=j({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{FlowViewer:i,FlowModeler:n}=H(),a=$({}),u=$({}),l=R({get(){let v=Gt();return typeof o.modelValue=="string"&&o.modelValue?v=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(v=o.modelValue),v},set(v){t("update:modelValue",JSON.stringify(v))}}),r=R(()=>{const{column:v=[],group:g=[]}=JSON.parse(o.flowFormOption||"{}");return[...v,...g.map(D=>D.column??[]).flat()]}),s=R(()=>r.value.map(g=>({label:g.label,value:`\${${g.prop}}`,desc:`\${${g.prop}}`}))),d=ce(We),f=ce(Qe),{data:m}=He().useList();ve(u,v=>{var g,C,D,S,P,O,I,x,F,M,K;v&&(v.priority&&(v.priority.dicData=s.value),v.formTitle&&(v.formTitle.dicData=s.value),(D=(C=(g=v.assignee)==null?void 0:g.children)==null?void 0:C.column)!=null&&D[1]&&(v.assignee.children.column[1].component=lt),(F=(x=(I=(O=(P=(S=v.circulate)==null?void 0:S.children)==null?void 0:P.column)==null?void 0:O[1])==null?void 0:I.children)==null?void 0:x.column)!=null&&F[1]&&(v.circulate.children.column[1].children.column[1].component=lt),v.formProperty&&(a.value.formProperty=c(r.value,a.value.formProperty||[])),v.button&&((K=(M=v.button.children)==null?void 0:M.column)==null||K.forEach(z=>{z.prop==="display"&&(z.dicData=d),z.prop==="approval"&&(z.dicData=f)}),a.value.button=w(m.value||[],a.value.button||[])))});function c(v,g){return v.map(C=>{var ee,G;const D=g.find(J=>J.prop===C.prop),{label:S,prop:P,display:O=!0,disabled:I=!1,detail:x=!1,readonly:F=!1,rules:M}=C,K=(M==null?void 0:M.some(J=>J.required))??!1,z={label:S,prop:P,display:O,disabled:I,detail:x,readonly:F,required:K,...D};return C.type==="dynamic"&&((G=(ee=C.children)==null?void 0:ee.column)!=null&&G.length)&&(z.children=c(C.children.column,(D==null?void 0:D.children)??[])),z})}function w(v,g){return v.filter(C=>C.status===1).map(C=>{const D=g.find(F=>F.buttonKey===C.buttonKey),{name:S,buttonKey:P,display:O,approval:I}=C;return{name:S,buttonKey:P,display:O,approval:I,...D}})}const{data:b}=Te().useParam("flow.task.status"),y=R(()=>{var v;return(v=o.flowHistory)==null?void 0:v.map(g=>{var D,S;const C=(S=(D=b.value)==null?void 0:D.find(P=>P.value===g.status))==null?void 0:S.style;return{id:g.taskNodeKey,style:C}})}),N=R(()=>{var v,g;return(g=(v=o.flowHistory)==null?void 0:v.filter(C=>C.taskNodeType==="userTask"))==null?void 0:g.map(C=>{var D;return{id:C.taskNodeKey,content:`<div>${C.assigneeName}</div>
        <div>${C.endTime??""}</div>
        <div>${((D=C.comment)==null?void 0:D.comment)??""}</div>`}})});function h(){var v,g;(g=(v=l.value)==null?void 0:v.flowElementList)==null||g.forEach(C=>{var D;(D=C.properties)!=null&&D.button&&(C.properties.button=w(m.value||[],[]))}),l.value={...l.value}}function L(){var v,g;(g=(v=l.value)==null?void 0:v.flowElementList)==null||g.forEach(C=>{var D;(D=C.properties)!=null&&D.formProperty&&(C.properties.formProperty=c(r.value,[]))}),l.value={...l.value}}return(v,g)=>{const C=k("el-button");return v.view?(T(),B("div",Ro,[Z("div",Fo,[(T(!0),B(X,null,pe(V(b),D=>{var S;return T(),B("div",{key:D.label,class:"legend-item"},[Z("div",{class:"legend-color",style:Pt({backgroundColor:(S=D.style)==null?void 0:S.fill})},null,4),Z("span",null,q(D.label),1)])}),128))]),_(V(i),{"model-value":l.value,styles:y.value,tooltips:N.value},null,8,["model-value","styles","tooltips"])])):(T(),U(V(n),{key:1,modelValue:l.value,"onUpdate:modelValue":g[0]||(g[0]=D=>l.value=D),formData:a.value,"onUpdate:formData":g[1]||(g[1]=D=>a.value=D),formDefaults:u.value,"onUpdate:formDefaults":g[2]||(g[2]=D=>u.value=D),"form-options":V(Eo),"form-width":"30%"},{"form-top":p(()=>[_(C,{type:"default",onClick:h},{default:p(()=>[E(" 重置所有按钮配置 ")]),_:1}),_(C,{type:"default",onClick:L},{default:p(()=>[E(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const xe=Be(Ao,[["__scopeId","data-v-cce6bb35"]]),Mo={class:"flow-track"},Ko={key:0},Bo={key:1},jo=j({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=$("table"),i=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=R(()=>{var r,s,d;return((d=(s=(r=t.flowDetail)==null?void 0:r.flowHistory)==null?void 0:s.filter(f=>f.taskNodeType==="userTask"))==null?void 0:d.map(f=>({...f,duration:Tt(f.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:u}=Te().useParam("flow.handle.type");function l(r){var s;return(s=u.value)==null?void 0:s.find(d=>d.value===r)}return(r,s)=>{var h,L,v;const d=k("v-icon"),f=k("el-radio-button"),m=k("el-radio-group"),c=k("avue-crud"),w=k("el-card"),b=k("el-timeline-item"),y=k("el-timeline"),N=k("el-empty");return T(),B(X,null,[_(m,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=g=>o.value=g)},{default:p(()=>[(T(),B(X,null,pe(i,g=>_(f,{key:g.label,label:g.label},{default:p(()=>[_(d,{icon:g.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Z("div",Mo,[o.value==="table"?(T(),U(c,{key:0,data:n.value,option:a},null,8,["data"])):Q("",!0),o.value==="graph"?(T(),U(xe,{key:1,"model-value":(L=(h=r.flowDetail)==null?void 0:h.process)==null?void 0:L.flowData,"flow-history":(v=r.flowDetail)==null?void 0:v.flowHistory,view:""},null,8,["model-value","flow-history"])):Q("",!0),o.value==="timeline"?(T(),B(X,{key:2},[n.value.length?(T(),U(y,{key:0},{default:p(()=>[(T(!0),B(X,null,pe([...n.value].reverse(),g=>(T(),U(b,{key:g.id,timestamp:g.endTime,placement:"top"},{default:p(()=>[_(w,null,{default:p(()=>{var C,D,S;return[Z("div",null,q(g.assigneeName)+" 开始处理 ["+q(g.taskNodeName)+"] 环节 ",1),g.duration?(T(),B("div",Ko," 办理时长："+q(g.duration),1)):Q("",!0),g.type&&((C=g.comment)!=null&&C.comment)?(T(),B("div",Bo,q((D=l(g.type))==null?void 0:D.label)+"意见："+q((S=g.comment)==null?void 0:S.comment),1)):Q("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),U(N,{key:1}))],64)):Q("",!0)])],64)}}});const zo=Be(jo,[["__scopeId","data-v-c50075ce"]]),qo=j({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:i}=He().useList();function n(u,l){return u.map(r=>{const s=l.find(f=>f.buttonKey===r.buttonKey);return{...r,...Wt(s,["display","approval"])}})}const a=R(()=>{var w,b,y,N,h;const u={userId:"1"},{assignee:l,status:r}=((w=o.flowDetail)==null?void 0:w.task)||{},{createUser:s,flowInstanceId:d,status:f}=((b=o.flowDetail)==null?void 0:b.flowInstance)||{},m={true:!0,false:!1,startUser:s==u.userId,assignee:l==u.userId,todo:r==2,done:r==1,notstarted:!d,started:!!d,finished:f===1,unfinished:f===2};return((h=n(i.value??[],((N=(y=o.flowDetail)==null?void 0:y.properties)==null?void 0:N.button)??[]))==null?void 0:h.filter(L=>{var v,g;return(g=(v=L.display)==null?void 0:v.split(","))==null?void 0:g.every(C=>m[C])}))??[]});return(u,l)=>{const r=k("v-icon"),s=k("el-button");return T(!0),B(X,null,pe(a.value,d=>(T(),U(s,{key:d.buttonKey,type:d.buttonType,onClick:f=>t("click",d)},{default:p(()=>[_(r,{icon:d.icon},null,8,["icon"]),E(" "+q(d.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Wo=j({__name:"upload-table",props:{flowDetail:{}},setup(e){var w,b;const t=e,{upload:{action:o,headers:i,preview:n,download:a,props:u}}=H(),l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:r,getDataList:s,handleDel:d,handleSave:f,crudStateRefs:{tableData:m}}=oe({crudOption:{...el(),saveSuccessMsg:"上传成功"},tableOption:l,queryForm:{isLatest:1,flowInstanceId:(b=(w=t.flowDetail)==null?void 0:w.task)==null?void 0:b.flowInstanceId}});s();async function c(y,N){var S,P,O,I;const{fileName:h,fileType:L,fileSize:v,fileUrl:g,res:C}=u,D={fileName:ye({res:y},`${C}.${h}`),fileType:ye({res:y},`${C}.${L}`),fileSize:ye({res:y},`${C}.${v}`),fileUrl:ye({res:y},`${C}.${g}`),taskId:(P=(S=t.flowDetail)==null?void 0:S.task)==null?void 0:P.taskId,flowInstanceId:(I=(O=t.flowDetail)==null?void 0:O.task)==null?void 0:I.flowInstanceId,rootMark:(N==null?void 0:N.rootMark)||"",version:typeof(N==null?void 0:N.version)=="number"?N.version+1:1};await f(D,s,()=>{})}return(y,N)=>{const h=k("el-button"),L=k("el-upload"),v=k("avue-crud");return T(),U(v,ne(re(V(r))),{"menu-left":p(()=>[_(L,{action:V(o),headers:V(i),"show-file-list":!1,onSuccess:c},{default:p(()=>[_(h,{type:"primary",icon:"el-icon-upload"},{default:p(()=>[E(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:p(({row:g,index:C})=>[_(h,{type:"primary",text:"",icon:"el-icon-view",onClick:D=>{var S;return(S=V(n))==null?void 0:S(g,V(m))}},{default:p(()=>[E(" 预览 ")]),_:2},1032,["onClick"]),_(h,{type:"primary",text:"",icon:"el-icon-download",onClick:D=>{var S;return(S=V(a))==null?void 0:S(g,V(m))}},{default:p(()=>[E(" 下载 ")]),_:2},1032,["onClick"]),_(L,{action:V(o),headers:V(i),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:D=>c(D,g)},{default:p(()=>[_(h,{type:"primary",text:"",icon:"el-icon-upload"},{default:p(()=>[E(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),_(h,{type:"primary",text:"",icon:"el-icon-delete",onClick:D=>V(d)(g,C)},{default:p(()=>[E(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Qo={class:"flow-form__title"},_t=j({__name:"index",props:Io(),emits:Lo(),setup(e,{emit:t}){const o=e,i=$o(o,t),{flowDetail:n,modelValue:a,activeTab:u,activeBtn:l,formLoading:r,approvalVisible:s,submitLoading:d}=i,f=$();async function m(b){var y,N;l.value=b,await((y=f.value)==null?void 0:y.validate()),await((N=o.beforeClick)==null?void 0:N.call(o,b)),(b==null?void 0:b.approval)!=="false"?s.value=!0:w()}const c=No(i);async function w(){var b,y;try{const{buttonKey:N}=l.value;d.value=!0,await((b=o.beforeSubmit)==null?void 0:b.call(o,l.value));const h=(y=c[N])==null?void 0:y.call(c);h instanceof Promise?(await h,le.success("操作成功"),s.value=!1,t("complete",l.value)):le.error("操作失败")}finally{d.value=!1}}return(b,y)=>{const N=k("el-skeleton"),h=k("el-main"),L=k("el-header"),v=k("el-tab-pane"),g=k("el-tabs"),C=k("el-container");return V(r)?(T(),U(h,{key:0},{default:p(()=>[_(N)]),_:1})):(T(),U(C,{key:1,class:"flow-form"},{default:p(()=>[_(L,{class:"flow-form__header"},{default:p(()=>{var D;return[Z("div",Qo,q((D=V(n).flowInstance)==null?void 0:D.title),1),_(qo,{"flow-detail":V(n),onClick:m},null,8,["flow-detail"])]}),_:1}),_(h,{class:"flow-form__main"},{default:p(()=>[_(g,{modelValue:V(u),"onUpdate:modelValue":y[1]||(y[1]=D=>te(u)?u.value=D:null)},{default:p(()=>{var D,S;return[(S=(D=V(n))==null?void 0:D.process)!=null&&S.formPath?Et(b.$slots,"default",{key:0}):(T(),U(v,{key:1,label:"审批信息",name:"form"},{default:p(()=>[_(So,{ref_key:"formRef",ref:f,modelValue:V(a),"onUpdate:modelValue":y[0]||(y[0]=P=>te(a)?a.value=P:null),"flow-detail":V(n)},null,8,["modelValue","flow-detail"])]),_:1})),_(v,{label:"附件资料",name:"file",lazy:""},{default:p(()=>[_(Wo,{"flow-detail":V(n)},null,8,["flow-detail"])]),_:1}),_(v,{label:"流程跟踪",name:"track",lazy:""},{default:p(()=>[_(zo,{"flow-detail":V(n)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),_(Po,{onConfirm:w})]),_:3}))}}});function wt(e,t){switch(t.type){case"window":return Ho(e,t);case"dialog":case"drawer":return Go(e,t);default:return{open:()=>{},close:()=>{}}}}function Ho(e,t){const{window:{url:o="",name:i="flow-form",features:n="left=0,top=0,width=1600,height=900"}={}}=t,a=$(null),u=R(()=>`${o}?${Nt(Ot(e,It(Lt,$t)))}`);return{open:()=>{var s;a.value=window.open(u.value,i,n),(s=a.value)==null||s.addEventListener("message",d=>{const{event:f}=d.data,m=V(e)[f];typeof m=="function"&&m(d.data)})},close:()=>{var s;return(s=a.value)==null?void 0:s.close()},openedWindow:a}}function Go(e,t){const{appContext:o}=rt();let i;const n=()=>{i=document.createElement("div"),i.className="flow-form-wrapper";const u=Jo(t.formPath),l=Pe(u,{...V(e)}),r=Pe(t.type==="dialog"?Qt:Ht,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},l);r.appContext=o,Ft(r,i),document.body.appendChild(i)},a=()=>{i&&document.body.removeChild(i)};return{open:n,close:a}}function Jo(e){return e?Rt(()=>At(()=>import(e),[])):_t}const at=Symbol("flowPagesConfig"),Yo={FlowModeler:null,FlowViewer:null,FormDesign:null,request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var yt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(yt||{});const Re=ce(yt);function H(e,t){return e&&t?(e.provide(at,St(Yo,t)),t):Ae(at)}var bt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(bt||{}),We=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(We||{}),Qe=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(Qe||{}),gt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(gt||{});function He(){const{request:e}=H(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Xo(){const{request:e}=H(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Zo(){const{request:e}=H(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=r=>e.get(t.list,{params:{type:r,ascs:"sort"}});return{url:t,getList:o,useList:r=>_e(()=>o(r.value).then(s=>s.data.records),{refreshDeps:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),batchUpdate:r=>e.post(t.batchUpdate,r)}}function Ge(){const{request:e}=H(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var ht=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(ht||{});function Je(){const{request:e}=H(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function el(){const{request:e}=H(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function tl(){const{request:e}=H(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:i=>e.get(t.list,{params:i})}}function Te(){const{request:e}=H(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=s=>e.get(t.list,{params:s}),i=()=>e.get(t.all),n=s=>e.get(t.key,{params:{paramKey:s}});return{url:t,getList:o,getAllParam:i,getParam:n,useParam:s=>_e(()=>n(s).then(d=>d.data)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function kt(){const{request:e}=H(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ol(){const{request:e}=H(),t={tree:"/sapier-flow/flow-user/tree"},o=n=>e.get(t.tree,{params:{filter:n}});return{url:t,getUserTree:o,useUserTree:()=>_e(()=>o().then(n=>n.data))}}function Vt(){const{request:e}=H(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Dt=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Dt||{});function Fe(){const{request:e}=H(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=r=>e.get(t.list,{params:r});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r)}}const ll={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ce(bt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ce(We),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ce(Qe),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:ce(gt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},al=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i}=oe({tableOption:ll,crudOption:He(),sortOption:{ascs:"sort"}});return i(),(n,a)=>{const u=k("v-icon"),l=k("el-button"),r=k("avue-crud");return T(),U(r,ne(re(V(t))),{icon:p(({row:s})=>[_(u,{icon:s.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:p(({row:s})=>[_(l,{type:s.buttonType},{default:p(()=>[_(u,{icon:s.icon},null,8,["icon"]),E(" "+q(s.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":p(()=>[_(l,{type:V(o).buttonType},{default:p(()=>[_(u,{icon:V(o).icon},null,8,["icon"]),E(" "+q(V(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ye={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},nl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Ye.column,{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Ct=j({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:i,deploy:n}=Ge(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:nl,crudOption:{getList:i},searchForm:{categoryId:o.categoryId}});ie(()=>{u.value.categoryId=o.categoryId??"",l()});const r=$(!1);async function s(d){await ke.confirm("发布新版本，是否确认？","提示",{type:"success"}),r.value=!0,n({flowModuleId:d.flowModuleId}).then(()=>{le.success("发布成功"),l()}).finally(()=>{r.value=!1})}return(d,f)=>{const m=k("el-button"),c=k("v-icon"),w=k("avue-crud");return T(),U(w,ne(re(V(a))),{"menu-left":p(()=>[_(m,{type:"primary",icon:"el-icon-plus",onClick:f[0]||(f[0]=b=>t("add"))},{default:p(()=>[E(" 新增 ")]),_:1})]),menu:p(({row:b})=>[_(m,{loading:r.value,type:"text",icon:"el-icon-view",onClick:y=>t("view",b)},{default:p(()=>[E(" 查看 ")]),_:2},1032,["loading","onClick"]),_(m,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:y=>t("edit",b)},{default:p(()=>[E(" 编辑 ")]),_:2},1032,["loading","onClick"]),_(m,{loading:r.value,type:"text",icon:"el-icon-upload",onClick:y=>s(b)},{default:p(()=>[E(" 发布 ")]),_:2},1032,["loading","onClick"]),_(m,{loading:r.value,type:"text",icon:"el-icon-switch",onClick:y=>t("version",b)},{default:p(()=>[E(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:p(({row:b})=>[_(c,{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),rl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Ye.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},xt=j({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:i,update:n}=Je(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:rl,crudOption:{getList:i,dataPath:"res.data"}});ie(()=>{o.flowModuleId&&(u.value.flowModuleId=o.flowModuleId,l())});const r=$(!1);async function s(d){await ke.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),r.value=!0,n({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{le.success("设置成功"),l()}).finally(()=>{r.value=!1})}return(d,f)=>{const m=k("el-button"),c=k("v-icon"),w=k("avue-crud");return T(),U(w,ne(re(V(a))),{"menu-left":p(()=>[_(m,{loading:r.value,type:"primary",icon:"el-icon-arrow-left",onClick:f[0]||(f[0]=b=>t("back"))},{default:p(()=>[E(" 返回 ")]),_:1},8,["loading"])]),menu:p(({row:b})=>[_(m,{loading:r.value,type:"text",icon:"el-icon-view",onClick:y=>t("view",b)},{default:p(()=>[E(" 查看 ")]),_:2},1032,["loading","onClick"]),_(m,{loading:r.value,type:"text",icon:"el-icon-edit",onClick:y=>t("edit",b)},{default:p(()=>[E(" 编辑 ")]),_:2},1032,["loading","onClick"]),_(m,{loading:r.value,disabled:b.mainVersion===V(ht).是,type:"text",icon:"el-icon-switch",onClick:y=>s(b)},{default:p(()=>[E(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:p(({row:b})=>[_(c,{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),nt={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},sl=j({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:i},getDataList:n,handleSave:a,handleUpdate:u,handleDel:l}=oe({crudOption:{rowKey:"id",...Xo(),dataPath:"res.data"},tableOption:nt,pageOption:{pageSize:20}});n();function r(f,m,c,w){a(m,c,w)}function s(f,m,c,w){u(m,NaN,c,w)}async function d(f,m){await l(f.data,NaN),m()}return(f,m)=>{const c=k("avue-tree");return T(),U(c,{modelValue:V(o),"onUpdate:modelValue":m[0]||(m[0]=w=>te(o)?o.value=w:null),option:V(nt),data:V(i),onNodeClick:m[1]||(m[1]=w=>t("node-click",w)),onSave:r,onUpdate:s,onDel:d},null,8,["modelValue","option","data"])}}}),Xe=j({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var r;const o=e,{FormDesign:i}=H(),n=R({get(){return o.modelValue?st(o.modelValue):{menuBtn:!1,span:24}},set(s){t("update:modelValue",Bt(s,{useJson5:!1}))}}),a=R(()=>o.fields?JSON.parse(o.fields):[]),u=R(()=>{const s={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...s,props:{label:"name",value:"name",desc:"comment"}},{...s,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((r=jt.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(s,d)=>{const f=k("avue-form");return s.view?(T(),U(f,{key:0,class:Mt(n.value.class),"model-value":{},option:n.value},null,8,["class","option"])):(T(),U(V(i),{key:1,modelValue:n.value,"onUpdate:modelValue":d[0]||(d[0]=m=>n.value=m),"base-option":u.value,resources:l},null,8,["modelValue","base-option"]))}}}),il=Z("span",null,"流程设计",-1),ul={key:0},cl={key:1},dl={style:{height:"calc(100vh - 144px)"}},pl=j({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const i=De(e),{visible:n,modelValue:a}=i,{create:u,deploy:l,getDetail:r,update:s}=Ge(),{getDetail:d,update:f}=Je(),m=["流程信息","表单设计","模型设计","完成"],c=$(!1);ve(n,async P=>{if(!P)return;const{flowModuleId:O}=a.value,{flowDeployId:I}=a.value;try{c.value=!0;let x={};I?x=await d({flowDeployId:I}):O&&(x=await r({flowModuleId:O})),a.value=x.data}finally{c.value=!1}},{immediate:!0});const{data:w}=Vt().useList(),{data:b}=kt().useList(),{data:y}=Fe().useList(),N=R(()=>{var P,O;return(O=(P=y.value)==null?void 0:P.find(I=>I.tableName===a.value.formDataTable))==null?void 0:O.tableFields}),h=$(0),L=R(()=>{var P,O;return h.value===1?((P=w.value)==null?void 0:P.map(I=>({label:I.formName,value:I.formOption})))??[]:h.value===2?((O=b.value)==null?void 0:O.map(I=>({label:I.flowName,value:I.flowData})))??[]:[]});function v(P){h.value===1?a.value.formOption=P.value:h.value===2&&(a.value.flowData=P.value)}const g=$();async function C(P){h.value===0&&await qe(g),c.value=!0;const{flowModuleId:O}=a.value,{flowDeployId:I}=a.value;try{I?await f(a.value):O?await s(a.value):await u(a.value).then(x=>{a.value.flowModuleId=x.data.flowModuleId}),le.success("保存成功")}finally{c.value=!1}typeof P=="number"?h.value=P:h.value++}async function D(){await ke.confirm("发布新版本，是否确认？","提示"),c.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{le.success("发布成功")}).finally(()=>{c.value=!1})}function S(){n.value=!1,h.value=0,a.value={},t("close")}return(P,O)=>{const I=k("el-link"),x=k("el-dropdown-item"),F=k("el-dropdown-menu"),M=k("el-dropdown"),K=k("el-col"),z=k("el-step"),ee=k("el-steps"),G=k("el-button"),J=k("el-row"),Y=k("avue-form"),A=k("el-result"),se=k("el-dialog"),Ze=Me("loading");return T(),U(se,{modelValue:V(n),"onUpdate:modelValue":O[4]||(O[4]=W=>te(n)?n.value=W:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:S},{header:p(()=>[_(J,{align:"center",justify:"center"},{default:p(()=>[_(K,{span:5},{default:p(()=>{var W,fe,Ne,et;return[Z("div",null,[il,(W=V(a))!=null&&W.flowName?(T(),B("span",ul," - "+q((fe=V(a))==null?void 0:fe.flowName),1)):Q("",!0),(Ne=V(a))!=null&&Ne.version?(T(),B("span",cl," - V"+q((et=V(a))==null?void 0:et.version),1)):Q("",!0)]),L.value.length?(T(),U(M,{key:0},{dropdown:p(()=>[_(F,null,{default:p(()=>[(T(!0),B(X,null,pe(L.value,Oe=>(T(),U(x,{key:Oe.label,onClick:Ul=>v(Oe)},{default:p(()=>[E(q(Oe.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:p(()=>[_(I,{icon:"el-icon-arrow-down",underline:!1},{default:p(()=>[E(" 选择模板 ")]),_:1})]),_:1})):Q("",!0)]}),_:1}),_(K,{span:14},{default:p(()=>[_(ee,{active:h.value,simple:"","process-status":"finish","finish-status":"success"},{default:p(()=>[(T(),B(X,null,pe(m,(W,fe)=>_(z,{key:fe,title:W,onClick:Ne=>C(fe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),_(K,{span:5,style:{"text-align":"right"}},{default:p(()=>[_(G,{disabled:h.value===0,loading:c.value,type:"primary",onClick:O[0]||(O[0]=W=>h.value--)},{default:p(()=>[E(" 上一步 ")]),_:1},8,["disabled","loading"]),_(G,{disabled:h.value===m.length-1,type:"primary",loading:c.value,onClick:C},{default:p(()=>[E(" 下一步 ")]),_:1},8,["disabled","loading"]),_(G,{onClick:S},{default:p(()=>[E(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:p(()=>[Ke((T(),B("div",dl,[h.value===0?(T(),U(Y,{key:0,ref_key:"formRef",ref:g,modelValue:V(a),"onUpdate:modelValue":O[1]||(O[1]=W=>te(a)?a.value=W:null),option:V(Ye),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):Q("",!0),h.value===1?(T(),U(Xe,{key:1,modelValue:V(a).formOption,"onUpdate:modelValue":O[2]||(O[2]=W=>V(a).formOption=W),fields:N.value},null,8,["modelValue","fields"])):Q("",!0),h.value===2?(T(),U(xe,{key:2,modelValue:V(a).flowData,"onUpdate:modelValue":O[3]||(O[3]=W=>V(a).flowData=W),"flow-form-option":V(a).formOption},null,8,["modelValue","flow-form-option"])):Q("",!0),h.value===3?(T(),U(A,{key:3,icon:"success",title:"流程设计完成"},{extra:p(()=>[V(a).flowDeployId?Q("",!0):(T(),U(G,{key:0,type:"primary",onClick:D},{default:p(()=>[E(" 发布 ")]),_:1})),_(G,{onClick:S},{default:p(()=>[E(" 关闭 ")]),_:1})]),_:1})):Q("",!0)])),[[Ze,c.value]])]),_:1},8,["modelValue"])}}}),fl=Z("span",null,"流程查看",-1),ml={key:0},vl={key:1},_l=j({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=De(e),{visible:i,modelValue:n}=o,{getDetail:a}=Ge(),{getDetail:u}=Je(),l=$("form"),r=$(!1);ve(i,async d=>{if(!d)return;const{flowModuleId:f}=n.value,{flowDeployId:m}=n.value;try{r.value=!0;let c={};m?c=await u({flowDeployId:m}):f&&(c=await a({flowModuleId:f})),n.value={...c.data}}finally{r.value=!1}},{immediate:!0});function s(){n.value={},l.value="form"}return(d,f)=>{const m=k("el-tab-pane"),c=k("el-tabs"),w=k("el-dialog"),b=Me("loading");return T(),U(w,{modelValue:V(i),"onUpdate:modelValue":f[3]||(f[3]=y=>te(i)?i.value=y:null),width:"60%",top:"0",onClose:s},{header:p(()=>{var y,N,h,L;return[fl,(y=V(n))!=null&&y.flowName?(T(),B("span",ml," - "+q((N=V(n))==null?void 0:N.flowName),1)):Q("",!0),(h=V(n))!=null&&h.version?(T(),B("span",vl," - V"+q((L=V(n))==null?void 0:L.version),1)):Q("",!0)]}),default:p(()=>[Ke((T(),U(c,{modelValue:l.value,"onUpdate:modelValue":f[2]||(f[2]=y=>l.value=y)},{default:p(()=>[_(m,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:p(()=>[l.value==="form"&&V(n).formOption?(T(),U(Xe,{key:0,modelValue:V(n).formOption,"onUpdate:modelValue":f[0]||(f[0]=y=>V(n).formOption=y),view:""},null,8,["modelValue"])):Q("",!0)]),_:1}),_(m,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:p(()=>[l.value==="flow"?(T(),U(xe,{key:0,modelValue:V(n).flowData,"onUpdate:modelValue":f[1]||(f[1]=y=>V(n).flowData=y),view:""},null,8,["modelValue"])):Q("",!0)]),_:1})]),_:1},8,["modelValue"])),[[b,r.value]])]),_:1},8,["modelValue"])}}}),wl=j({__name:"index",setup(e){const t=$("definition"),o=$({}),i=$(""),n=$("");function a(w){i.value===w.id?i.value="":i.value=w.id}const u=$(!1),l=$(!1);function r(){o.value={},u.value=!0}function s(w){o.value=w,u.value=!0}function d(w){o.value=w,l.value=!0}function f(w){n.value=w.flowModuleId||"",t.value="deploy"}function m(){n.value="",t.value="definition"}async function c(){const w=t.value;await de(),t.value="",await de(),t.value=`${w}`}return(w,b)=>{const y=k("el-col"),N=k("el-row");return T(),U(N,{gutter:20},{default:p(()=>[_(y,{span:4},{default:p(()=>[_(sl,{onNodeClick:a})]),_:1}),_(y,{span:20},{default:p(()=>[t.value==="definition"?(T(),U(Ct,{key:0,"category-id":i.value,onAdd:r,onEdit:s,onView:d,onVersion:f},null,8,["category-id"])):Q("",!0),t.value==="deploy"?(T(),U(xt,{key:1,"flow-module-id":n.value,onEdit:s,onView:d,onBack:m},null,8,["flow-module-id"])):Q("",!0),_(pl,{modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=h=>o.value=h),visible:u.value,"onUpdate:visible":b[1]||(b[1]=h=>u.value=h),onClose:c},null,8,["modelValue","visible"]),_(_l,{modelValue:o.value,"onUpdate:modelValue":b[2]||(b[2]=h=>o.value=h),visible:l.value,"onUpdate:visible":b[3]||(b[3]=h=>l.value=h)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),yl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},bl=j({__name:"index",setup(e){const t=Xt("debugMode",!1),{getList:o}=tl(),{bindVal:i,getDataList:n}=oe({tableOption:yl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});n();const a=$({}),{open:u,close:l}=wt(a,{type:"drawer"});function r(s){a.value={flowKey:s.flowKey,taskId:s.taskId,instanceId:s.flowInstanceId,debug:t.value,onComplete:()=>{l(),n()}},u()}return(s,d)=>{const f=k("el-switch"),m=k("el-button"),c=k("el-link"),w=k("avue-crud");return T(),U(w,ne(re(V(i))),{"menu-right":p(()=>[_(m,{type:"text"},{default:p(()=>[_(f,{modelValue:V(t),"onUpdate:modelValue":d[0]||(d[0]=b=>te(t)?t.value=b:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:p(({row:b})=>[_(c,{type:"primary",underline:!1,onClick:y=>r(b)},{default:p(()=>[E(q(b.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),gl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Re},{label:"备注",prop:"remark"}]},hl=j({__name:"index",setup(e){const{bindVal:t,getDataList:o}=oe({tableOption:gl,crudOption:Te()});return o(),(i,n)=>{const a=k("avue-crud");return T(),U(a,ne(re(V(t))),null,16)}}}),kl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Vl={class:"flow-list"},Dl=["onClick"],Cl={class:"flow-name"},xl=j({__name:"index",setup(e){const t=$([]),{getPublishFlow:o,getTodoList:i}=Ce();o().then(m=>{t.value=m.data});const n=$({}),{open:a,close:u}=wt(n,{type:"drawer"});function l(m){n.value={flowKey:m.flowKey,taskId:m.taskId,instanceId:m.flowInstanceId,onComplete:()=>{u(),s()}},a()}const{bindVal:r,getDataList:s,crudStateRefs:{searchForm:d}}=oe({tableOption:kl,crudOption:{getList:i},searchForm:{status:2}}),f=[{label:"待办",value:2},{label:"已办",value:1}];return(m,c)=>{const w=k("el-button"),b=k("v-icon"),y=k("el-collapse-item"),N=k("el-collapse"),h=k("el-card"),L=k("el-divider"),v=k("avue-radio"),g=k("el-link"),C=k("avue-crud");return T(),B(X,null,[_(h,{"body-style":{padding:"0 20px"}},{default:p(()=>[_(N,{"model-value":"1"},{default:p(()=>[_(y,{name:"1"},{title:p(()=>[_(w,{text:"",icon:"el-icon-promotion"},{default:p(()=>[E(" 发起审批 ")]),_:1})]),default:p(()=>[Z("div",Vl,[(T(!0),B(X,null,pe(t.value,D=>(T(),B("div",{key:D.flowKey,class:"flow-item",onClick:S=>l(D)},[_(b,{class:"flow-icon",icon:D.flowIcon,width:"60"},null,8,["icon"]),Z("div",Cl,q(D.flowName),1)],8,Dl))),128))])]),_:1})]),_:1})]),_:1}),_(L,{direction:"horizontal","content-position":"left"}),_(C,ne(re(V(r))),{"menu-left":p(()=>[_(v,{modelValue:V(d).status,"onUpdate:modelValue":[c[0]||(c[0]=D=>V(d).status=D),V(s)],button:"",dic:f},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:p(({row:D})=>[_(g,{type:"primary",underline:!1,onClick:S=>l(D)},{default:p(()=>[E(q(D.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Tl=Be(xl,[["__scopeId","data-v-7d8c52d6"]]),Nl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Ol=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:n}=oe({tableOption:Nl,crudOption:kt()});i();const a=$(!1);async function u(r){o.value=r,a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(r,s)=>{const d=k("el-button"),f=k("avue-crud"),m=k("el-dialog");return T(),B(X,null,[_(f,ne(re(V(t))),{flowData:p(({row:c})=>[_(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>u(c)},{default:p(()=>[E(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),_(m,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=c=>a.value=c),title:`模型设计-${V(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:p(()=>[_(d,{type:"primary",onClick:l},{default:p(()=>[E(" 保存 ")]),_:1}),_(d,{onClick:s[1]||(s[1]=c=>a.value=!1)},{default:p(()=>[E(" 取消 ")]),_:1})]),default:p(()=>[_(xe,{modelValue:V(o).flowData,"onUpdate:modelValue":s[0]||(s[0]=c=>V(o).flowData=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Il={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Ll=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:n}=oe({tableOption:Il,crudOption:Vt()});i();const a=$(!1);async function u(r){o.value={...r},a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(r,s)=>{const d=k("el-button"),f=k("avue-crud"),m=k("el-dialog");return T(),B(X,null,[_(f,ne(re(V(t))),{formOption:p(({row:c})=>[_(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>u(c)},{default:p(()=>[E(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),_(m,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=c=>a.value=c),title:`表单设计-${V(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:p(()=>[_(d,{type:"primary",onClick:l},{default:p(()=>[E(" 保存 ")]),_:1}),_(d,{onClick:s[1]||(s[1]=c=>a.value=!1)},{default:p(()=>[E(" 取消 ")]),_:1})]),default:p(()=>[_(Xe,{modelValue:V(o).formOption,"onUpdate:modelValue":s[0]||(s[0]=c=>V(o).formOption=c),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),$l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ce(Dt)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Re,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Re,value:1}]}}]},Sl=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,beforeOpen:n,beforeSubmit:a}=oe({crudOption:Fe(),tableOption:$l});i();const{data:u}=Te().useParam("table.default.fields");n(d=>{d==="add"?o.value.tableFields=u.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),a(d=>{d.tableFields=JSON.stringify(d.tableFields)});const{deploy:l}=Fe(),r=$(!1);async function s(d){await ke.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),r.value=!0,l({id:d.id}).then(()=>{le.success("部署成功"),i()}).finally(()=>{r.value=!1})}return(d,f)=>{const m=k("el-button"),c=k("avue-crud");return T(),U(c,ne(re(V(t))),{menu:p(({row:w})=>[_(m,{type:"text",icon:"el-icon-upload",onClick:b=>s(w)},{default:p(()=>[E(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ra={install(e,t){e.component("FlowButton",al).component("FlowDefinition",Ct).component("FlowDeploy",xt).component("FlowForm",_t).component("FlowManage",wl).component("FlowOps",bl).component("FlowParam",hl).component("FlowTemplate",Ol).component("FormTemplate",Ll).component("TableTemplate",Sl).component("FlowWorkbench",Tl),H(e,t)}};export{Yo as CONFIG_DEFAULT,at as CONFIG_PROVIDE_KEY,al as FlowButton,Ct as FlowDefinition,xt as FlowDeploy,_t as FlowForm,wl as FlowManage,bl as FlowOps,hl as FlowParam,Ol as FlowTemplate,Tl as FlowWorkbench,Ll as FormTemplate,Sl as TableTemplate,yt as Whether,Ra as default,Jo as resolveFlowFormComponent,H as useConfigProvider,wt as useFlowForm,Go as useFlowFormOverlay,Ho as useFlowFormWindow,Re as whetherDic};
