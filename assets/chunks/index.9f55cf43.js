import{u as qe,aJ as Xt,aK as mt,aQ as eo,aR as to,aH as vt,_ as We,aS as oo,aD as lo,ax as yt,aT as ao,aU as ut,aV as no,aW as bt,aX as so,aY as ro,aZ as Ve,x as _t,a_ as wt,a$ as gt,b0 as io,y as ht,J as uo,b1 as me,b2 as ne,b3 as ct,b4 as co,b5 as ae,A as ke,b6 as po,aO as fo,b7 as mo,aP as vo,z as yo,b8 as $e,ah as bo}from"../composables_use-crud_index.md.a9f8b378.js";import{ak as _o,f as K,R as we,c as R,h as T,i as F,z as H,j as le,l as G,u,t as q,G as b,B as m,A as P,I as wo,C as M,W as He,r as O,w as de,n as ce,e as go,d as Qe,a0 as ho,S as kt,a1 as ge,E as Ct,ax as ko,af as Dt,T as Vt,av as Tt,D,$ as Be,y as Ie,s as Pe,b as pe,ab as J,ah as Me,k as U,aI as Ge,L as ve,F as ee,_ as Je,an as re,ao as ie,al as Co,a_ as Do,aL as Vo}from"./framework.90a1d017.js";import{e as To,c as dt,a as $o,d as Se,q as Io,x as So}from"./theme.28e928ac.js";import{a5 as $t,a7 as Oo,a8 as Lo,a9 as Ke,A as No,_ as Eo,a4 as Ro}from"./index.vue_vue_type_script_setup_true_lang.868dae54.js";import{fQ as Po,fN as xo}from"../app.43d8dd4b.js";import{a as Uo,_ as Ao}from"./index.vue_vue_type_script_setup_true_lang.e53d5f36.js";import{d as Fo}from"./data.4cb21f02.js";import{a as Bo}from"../flow-design_flow-modeler_index.md.59bfab0e.js";import"./vue.runtime.esm-bundler.bdd2ba2b.js";import"../components_icon-select_index.md.199dd996.js";import"../components_index.md.1f243e21.js";import"../components_v-text_index.md.e725340a.js";import"../composables_index.md.a90d8414.js";import"../flow-design_flow-viewer_index.md.e56606a6.js";import"../flow-design_index.md.3b0804e5.js";import"../flow-pages_index.md.7d9721d6.js";import"../flow-pages_pages_flow-button_index.md.72c1e047.js";import"../flow-pages_pages_flow-manage_index.md.e768d9b9.js";import"../flow-pages_pages_flow-ops_index.md.d8eb58fb.js";import"../flow-pages_pages_flow-param_index.md.717dca5b.js";import"../flow-pages_pages_flow-template_index.md.a0e95177.js";import"../flow-pages_pages_flow-workbench_index.md.0e3cd273.js";import"../flow-pages_pages_form-template_index.md.15338c1a.js";import"../flow-pages_pages_table-template_index.md.87f142c2.js";import"../form-design_demo.md.00b4fd56.js";import"../form-design_index.md.ad8ccf32.js";import"../guide_changelog.md.097c20ce.js";import"../guide_start.md.e2c21051.js";import"../index.md.739b65b2.js";import"../plugins_avue-patch_index.md.ccc92b15.js";import"../plugins_env-dts_index.md.46223070.js";import"../plugins_index.md.ceac4583.js";import"../plugins_load-proxy_index.md.c43ce2e5.js";import"../plugins_setup-extend_index.md.60b3d0bc.js";import"../plugins_uni-ui-patch_index.md.d739021c.js";import"../plugins_uview-patch_index.md.2b011c95.js";import"../types_avue_index.md.aa1d254b.js";import"../utils_date_dateFormat.md.be978828.js";import"../utils_date_durationFormat.md.c9f60012.js";import"../utils_emitter_mittAsync.md.a180465e.js";import"../utils_index.md.cc6a2586.js";import"../utils_math_index.md.4bab9209.js";import"../utils_object_filterObj.md.efa37feb.js";import"../utils_object_filterObjDeep.md.d16e31a2.js";import"../utils_object_getDataType.md.fbaad5f8.js";import"../utils_string_deserialize.md.4bd5e9f6.js";import"../utils_string_serialize.md.5d6a2475.js";import"../utils_string_uuid.md.4bf11f5c.js";import"../utils_tool_awaitTo.md.f087f686.js";import"../utils_tool_enumToDic.md.fa4bf1dd.js";import"../utils_tool_sleep.md.7043172e.js";import"../utils_tree_buildTree.md.a8ea0daa.js";import"../utils_tree_filterTree.md.bafd7159.js";import"../utils_tree_findTree.md.4a313e64.js";import"../utils_tree_flatTree.md.e26eea3a.js";import"../utils_tree_treeMap.md.5323d8bb.js";const Mo=(...e)=>t=>{e.forEach(o=>{_o(o)?o(t):o.value=t})},It=Symbol("dialogInjectionKey"),St=qe({center:{type:Boolean,default:!1},alignCenter:{type:Boolean,default:!1},closeIcon:{type:Xt},customClass:{type:String,default:""},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},title:{type:String,default:""}}),Ko={close:()=>!0},zo=["aria-label"],jo=["id"],qo=K({name:"ElDialogContent"}),Wo=K({...qo,props:St,emits:Ko,setup(e){const t=e,{t:o}=mt(),{Close:r}=oo,{dialogRef:n,headerRef:a,bodyId:c,ns:l,style:s}=we(It),{focusTrapRef:i}=we(eo),d=Mo(i,n),y=R(()=>t.draggable);return to(n,a,y),(v,p)=>(T(),F("div",{ref:u(d),class:G([u(l).b(),u(l).is("fullscreen",v.fullscreen),u(l).is("draggable",u(y)),u(l).is("align-center",v.alignCenter),{[u(l).m("center")]:v.center},v.customClass]),style:He(u(s)),tabindex:"-1"},[H("header",{ref_key:"headerRef",ref:a,class:G(u(l).e("header"))},[le(v.$slots,"header",{},()=>[H("span",{role:"heading",class:G(u(l).e("title"))},q(v.title),3)]),v.showClose?(T(),F("button",{key:0,"aria-label":u(o)("el.dialog.close"),class:G(u(l).e("headerbtn")),type:"button",onClick:p[0]||(p[0]=_=>v.$emit("close"))},[b(u(vt),{class:G(u(l).e("close"))},{default:m(()=>[(T(),P(wo(v.closeIcon||u(r))))]),_:1},8,["class"])],10,zo)):M("v-if",!0)],2),H("div",{id:u(c),class:G(u(l).e("body"))},[le(v.$slots,"default")],10,jo),v.$slots.footer?(T(),F("footer",{key:0,class:G(u(l).e("footer"))},[le(v.$slots,"footer")],2)):M("v-if",!0)],6))}});var Ho=We(Wo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog-content.vue"]]);const Ot=qe({...St,appendToBody:{type:Boolean,default:!1},beforeClose:{type:lo(Function)},destroyOnClose:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:{type:Boolean,default:!1},modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1}}),Lt={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[yt]:e=>To(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},Nt=(e,t)=>{const r=Qe().emit,{nextZIndex:n}=ao();let a="";const c=ut(),l=ut(),s=O(!1),i=O(!1),d=O(!1),y=O(e.zIndex||n());let v,p;const _=no("namespace",ro),h=R(()=>{const A={},B=`--${_.value}-dialog`;return e.fullscreen||(e.top&&(A[`${B}-margin-top`]=e.top),e.width&&(A[`${B}-width`]=bt(e.width))),A}),w=R(()=>e.alignCenter?{display:"flex"}:{});function S(){r("opened")}function f(){r("closed"),r(yt,!1),e.destroyOnClose&&(d.value=!1)}function C(){r("close")}function g(){p==null||p(),v==null||v(),e.openDelay&&e.openDelay>0?{stop:v}=dt(()=>N(),e.openDelay):N()}function k(){v==null||v(),p==null||p(),e.closeDelay&&e.closeDelay>0?{stop:p}=dt(()=>x(),e.closeDelay):x()}function E(){function A(B){B||(i.value=!0,s.value=!1)}e.beforeClose?e.beforeClose(A):k()}function L(){e.closeOnClickModal&&E()}function N(){$o&&(s.value=!0)}function x(){s.value=!1}function V(){r("openAutoFocus")}function I(){r("closeAutoFocus")}function $(A){var B;((B=A.detail)==null?void 0:B.focusReason)==="pointer"&&A.preventDefault()}e.lockScroll&&so(s);function z(){e.closeOnPressEscape&&E()}return de(()=>e.modelValue,A=>{A?(i.value=!1,g(),d.value=!0,y.value=e.zIndex?y.value++:n(),ce(()=>{r("open"),t.value&&(t.value.scrollTop=0)})):s.value&&k()}),de(()=>e.fullscreen,A=>{t.value&&(A?(a=t.value.style.transform,t.value.style.transform=""):t.value.style.transform=a)}),go(()=>{e.modelValue&&(s.value=!0,d.value=!0,g())}),{afterEnter:S,afterLeave:f,beforeLeave:C,handleClose:E,onModalClick:L,close:k,doClose:x,onOpenAutoFocus:V,onCloseAutoFocus:I,onCloseRequested:z,onFocusoutPrevented:$,titleId:c,bodyId:l,closed:i,style:h,overlayDialogStyle:w,rendered:d,visible:s,zIndex:y}},Qo=["aria-label","aria-labelledby","aria-describedby"],Go=K({name:"ElDialog",inheritAttrs:!1}),Jo=K({...Go,props:Ot,emits:Lt,setup(e,{expose:t}){const o=e,r=ho();Ve({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},R(()=>!!r.title)),Ve({scope:"el-dialog",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/dialog.html#attributes",type:"Attribute"},R(()=>!!o.customClass));const n=_t("dialog"),a=O(),c=O(),l=O(),{visible:s,titleId:i,bodyId:d,style:y,overlayDialogStyle:v,rendered:p,zIndex:_,afterEnter:h,afterLeave:w,beforeLeave:S,handleClose:f,onModalClick:C,onOpenAutoFocus:g,onCloseAutoFocus:k,onCloseRequested:E,onFocusoutPrevented:L}=Nt(o,a);kt(It,{dialogRef:a,headerRef:c,bodyId:d,ns:n,rendered:p,style:y});const N=io(C),x=R(()=>o.draggable&&!o.fullscreen);return t({visible:s,dialogContentRef:l}),(V,I)=>(T(),P(Tt,{to:"body",disabled:!V.appendToBody},[b(Vt,{name:"dialog-fade",onAfterEnter:u(h),onAfterLeave:u(w),onBeforeLeave:u(S),persisted:""},{default:m(()=>[ge(b(u(wt),{"custom-mask-event":"",mask:V.modal,"overlay-class":V.modalClass,"z-index":u(_)},{default:m(()=>[H("div",{role:"dialog","aria-modal":"true","aria-label":V.title||void 0,"aria-labelledby":V.title?void 0:u(i),"aria-describedby":u(d),class:G(`${u(n).namespace.value}-overlay-dialog`),style:He(u(v)),onClick:I[0]||(I[0]=(...$)=>u(N).onClick&&u(N).onClick(...$)),onMousedown:I[1]||(I[1]=(...$)=>u(N).onMousedown&&u(N).onMousedown(...$)),onMouseup:I[2]||(I[2]=(...$)=>u(N).onMouseup&&u(N).onMouseup(...$))},[b(u(gt),{loop:"",trapped:u(s),"focus-start-el":"container",onFocusAfterTrapped:u(g),onFocusAfterReleased:u(k),onFocusoutPrevented:u(L),onReleaseRequested:u(E)},{default:m(()=>[u(p)?(T(),P(Ho,Ct({key:0,ref_key:"dialogContentRef",ref:l},V.$attrs,{"custom-class":V.customClass,center:V.center,"align-center":V.alignCenter,"close-icon":V.closeIcon,draggable:u(x),fullscreen:V.fullscreen,"show-close":V.showClose,title:V.title,onClose:u(f)}),ko({header:m(()=>[V.$slots.title?le(V.$slots,"title",{key:1}):le(V.$slots,"header",{key:0,close:u(f),titleId:u(i),titleClass:u(n).e("title")})]),default:m(()=>[le(V.$slots,"default")]),_:2},[V.$slots.footer?{name:"footer",fn:m(()=>[le(V.$slots,"footer")])}:void 0]),1040,["custom-class","center","align-center","close-icon","draggable","fullscreen","show-close","title","onClose"])):M("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,Qo)]),_:3},8,["mask","overlay-class","z-index"]),[[Dt,u(s)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"]))}});var Yo=We(Jo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog.vue"]]);const Zo=ht(Yo),Xo=qe({...Ot,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),el=Lt,tl=K({name:"ElDrawer",components:{ElOverlay:wt,ElFocusTrap:gt,ElIcon:vt,Close:uo},inheritAttrs:!1,props:Xo,emits:el,setup(e,{slots:t}){Ve({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},R(()=>!!t.title)),Ve({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},R(()=>!!e.customClass));const o=O(),r=O(),n=_t("drawer"),{t:a}=mt(),c=R(()=>e.direction==="rtl"||e.direction==="ltr"),l=R(()=>bt(e.size));return{...Nt(e,o),drawerRef:o,focusStartRef:r,isHorizontal:c,drawerSize:l,ns:n,t:a}}}),ol=["aria-label","aria-labelledby","aria-describedby"],ll=["id"],al=["aria-label"],nl=["id"];function sl(e,t,o,r,n,a){const c=D("close"),l=D("el-icon"),s=D("el-focus-trap"),i=D("el-overlay");return T(),P(Tt,{to:"body",disabled:!e.appendToBody},[b(Vt,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:m(()=>[ge(b(i,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:m(()=>[b(s,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:m(()=>[H("div",Ct({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:t[1]||(t[1]=Be(()=>{},["stop"]))}),[H("span",{ref:"focusStartRef",class:G(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?(T(),F("header",{key:0,class:G(e.ns.e("header"))},[e.$slots.title?le(e.$slots,"title",{key:1},()=>[M(" DEPRECATED SLOT ")]):le(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?M("v-if",!0):(T(),F("span",{key:0,id:e.titleId,role:"heading",class:G(e.ns.e("title"))},q(e.title),11,ll))]),e.showClose?(T(),F("button",{key:2,"aria-label":e.t("el.drawer.close"),class:G(e.ns.e("close-btn")),type:"button",onClick:t[0]||(t[0]=(...d)=>e.handleClose&&e.handleClose(...d))},[b(l,{class:G(e.ns.e("close"))},{default:m(()=>[b(c)]),_:1},8,["class"])],10,al)):M("v-if",!0)],2)):M("v-if",!0),e.rendered?(T(),F("div",{key:1,id:e.bodyId,class:G(e.ns.e("body"))},[le(e.$slots,"default")],10,nl)):M("v-if",!0),e.$slots.footer?(T(),F("div",{key:2,class:G(e.ns.e("footer"))},[le(e.$slots,"footer")],2)):M("v-if",!0)],16,ol)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Dt,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var rl=We(tl,[["render",sl],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const il=ht(rl),Et=Symbol("flowPagesConfig"),ul={request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Rt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Rt||{});const ze=me(Rt),cl={},dl=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),pl=()=>cl,fl=e=>Array.isArray(e),Ye=e=>e!==null&&typeof e=="object",Pt=e=>e instanceof Function,he=e=>e==null,Ze=typeof window>"u",xt=()=>{var e;return Ze||he((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ml=()=>{var e,t;return(e=!Ze&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},xe=()=>new Promise(()=>{}),se=e=>J(e)?e.value:e,vl=e=>Ye(e)?Object.assign(fl(e)?[]:{},e):e,Ce=new Map,yl=e=>he(e)?void 0:Ce.get(e),bl=(e,t,o)=>{const r=Ce.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const n=setTimeout(()=>Ce.delete(e),t);Ce.set(e,{...o,timer:n})},fe=e=>e;function Ut(e,t,o){let r,n,a,c,l,s,i=0,d=!1,y=!1,v=!0;const p=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Ye(o)&&(d=!!o.leading,y="maxWait"in o,a=y?Math.max(+o.maxWait||0,t):a,v="trailing"in o?!!o.trailing:v);function _(V){const I=r,$=n;return r=n=void 0,i=V,c=e.apply($,I),c}function h(V,I){return p?(window.cancelAnimationFrame(l),window.requestAnimationFrame(V)):setTimeout(V,I)}function w(V){if(p)return window.cancelAnimationFrame(V);clearTimeout(V)}function S(V){return i=V,l=h(g,t),d?_(V):c}function f(V){const I=V-s,$=V-i,z=t-I;return y?Math.min(z,a-$):z}function C(V){const I=V-s,$=V-i;return s===void 0||I>=t||I<0||y&&$>=a}function g(){const V=Date.now();if(C(V))return k(V);l=h(g,f(V))}function k(V){return l=void 0,v&&r?_(V):(r=n=void 0,c)}function E(){l!==void 0&&w(l),i=0,r=s=n=l=void 0}function L(){return l===void 0?c:k(Date.now())}function N(){return l!==void 0}function x(...V){const I=Date.now(),$=C(I);if(r=V,n=this,s=I,$){if(l===void 0)return S(s);if(y)return l=h(g,t),_(s)}return l===void 0&&(l=h(g,t)),c}return x.cancel=E,x.flush=L,x.pending=N,x}function _l(e,t,o){let r=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Ye(o)&&(r="leading"in o?!!o.leading:r,n="trailing"in o?!!o.trailing:n),Ut(e,t,{leading:r,trailing:n,maxWait:t})}var wl=fe((e,{debounceInterval:t,debounceOptions:o,manual:r})=>{const n=O(!1),a=O(),c=R(()=>o),l=R(()=>se(t)),s=O(e.context.runAsync);return r||(n.value=!0),pe(i=>{he(l.value)||(a.value=Ut(d=>d(),l.value,c.value),e.context.runAsync=(...d)=>new Promise((y,v)=>{n.value?(n.value=!1,s.value(...d).then(y).catch(v)):a.value(()=>{s.value(...d).then(y).catch(v)})}),i(()=>{var d;(d=a.value)===null||d===void 0||d.cancel(),e.context.runAsync=s.value}))}),{onCancel(){var i;(i=a.value)===null||i===void 0||i.cancel()}}}),gl=fe((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const r=O(),n=O(0),a=R(()=>se(t)),c=R(()=>se(o));let l=!1;const s=()=>{n.value=0},i=R(()=>{if(c.value)return c.value;const v=1e3,p=1,_=9,h=Math.floor(Math.random()*2**Math.min(n.value,_)+p);return v*h}),d=()=>{let v;const p=a.value===-1,_=n.value<a.value;return(p||_)&&(p||(n.value+=1),v=setTimeout(()=>{l=!0,e.context.refresh()},i.value)),()=>v&&clearTimeout(v)},y=()=>{r.value&&r.value()};return{onBefore(){l||s(),l=!1,y()},onSuccess(){s()},onError(){r.value=d()},onCancel(){s(),y()}}}),hl=fe((e,{ready:t=O(!0),manual:o,defaultParams:r=[]})=>(de(t,n=>{!o&&n&&e.context.run(...r)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),kl=fe((e,{refreshDeps:t=[],refreshDepsAction:o,manual:r})=>(t!=null&&t.length&&de(t,()=>{o?o():!r&&e.context.refresh()}),{})),Cl=fe((e,{throttleInterval:t,throttleOptions:o})=>{const r=O(),n=R(()=>se(t)),a=R(()=>o),c=O(e.context.runAsync);return pe(l=>{if(he(t))return{};r.value=_l(s=>s(),n.value,a.value),e.context.runAsync=(...s)=>new Promise((i,d)=>{r.value(()=>{c.value(...s).then(i).catch(d)})}),l(()=>{var s;(s=r.value)===null||s===void 0||s.cancel(),e.context.runAsync=c.value})}),{onCancel(){var l;(l=r.value)===null||l===void 0||l.cancel()}}});const Dl=(e,t)=>o=>{Object.keys(o).forEach(r=>{e[r].value=o[r]}),t.forEach(r=>r(e))},Vl=(e,t)=>()=>{let o=t;for(let r=e.length;r-- >0;)o=e[r](o);return o()},Tl=(e,t,o)=>{var r,n;const{initialData:a,onSuccess:c,onError:l,onBefore:s,onAfter:i}=t,d=O((r=o==null?void 0:o.loading)!==null&&r!==void 0?r:!1),y=Pe((n=o==null?void 0:o.data)!==null&&n!==void 0?n:a),v=Pe(o==null?void 0:o.error),p=O(o==null?void 0:o.params),_=O([]),h=Pe("pending"),w={},S=Dl({status:h,loading:d,data:y,error:v,params:p},[]),f=(g,...k)=>{if(g==="onQuery"){const E=_.value.map(L=>L.onQuery).filter(Boolean);return{servicePromise:Vl(E,k[0])()}}else{const E=_.value.map(L=>{var N;return(N=L[g])===null||N===void 0?void 0:N.call(L,...k)});return Object.assign({},...E)}},C=O(0);return w.runAsync=async(...g)=>{S({loading:!0,params:g,status:"pending"}),C.value+=1;const k=C.value,{isBreak:E,breakResult:L=xe()}=f("onBefore",g);if(E)return S({status:"settled"}),L;s==null||s(g);try{const N=()=>new Promise(I=>I(e(...p.value)));let{servicePromise:x}=f("onQuery",N);x||(x=N());const V=await x;return k!==C.value?xe():(S({data:V,loading:!1,error:void 0,status:"settled"}),f("onSuccess",V,g),c==null||c(V,g),f("onAfter",g,V,void 0),i==null||i(g),V)}catch(N){if(k!==C.value)return xe();throw S({loading:!1,error:N,status:"settled"}),f("onError",N,g),l==null||l(N,g),f("onAfter",g,void 0,N),i==null||i(g),N}},w.run=(...g)=>{w.runAsync(...g).catch(k=>{l||console.error(k)})},w.cancel=()=>{C.value+=1,S({loading:!1}),f("onCancel")},w.refresh=()=>{w.run(...p.value||[])},w.refreshAsync=()=>w.runAsync(...p.value||[]),w.mutate=g=>{const k=Pt(g)?g(y.value):g,E=vl(k);S({data:E}),f("onMutate",E)},{status:h,loading:d,data:y,error:v,params:p,plugins:_,context:w}};function $l(e,t={},o){const r=we(dl,{}),n={...pl(),...r,...t},{manual:a=!1,defaultParams:c=[]}=n,l=Tl(e,n);if(l.plugins.value=o.map(s=>s(l,n)),!a){const s=l.params.value||c;l.context.run(...s)}return Ie(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const De=new Map,Il=(e,t)=>{De.set(e,t),t.then(o=>(De.delete(e),o)).catch(()=>{De.delete(e)})},Sl=e=>De.get(e),be=new Map,Ol=(e,t)=>{be.has(e)&&be.get(e).forEach(o=>o(t))},Ll=(e,t)=>(be.has(e)?be.get(e).push(t):be.set(e,[t]),()=>{const o=be.get(e).indexOf(t);be.get(e).splice(o,1)});var Nl=fe((e,{cacheKey:t,cacheTime:o=6e5,staleTime:r=0,getCache:n,setCache:a})=>{if(!t)return{};const c=Pt(t)?t:()=>t,l=O(()=>{});let s;const i=w=>n?n(w):yl(w),d=(w,S,f)=>{a?a(w,f):bl(w,S,f),Ol(w,f.data)},y=w=>r===-1||w+r>new Date().getTime(),v=(w,S)=>Object.prototype.hasOwnProperty.call(w,S),p=w=>{const S=c(w);return Ll(S,f=>{e.data.value=f})},_=c(),h=i(_);return h&&v(h,"data")&&(e.data.value=h.data,e.params.value=h.params),_&&(l.value=p()),Ie(()=>{l.value()}),{onBefore(w){const S=c(w),f=i(S);if(!f||!v(f,"data"))return{};if(y(f.time))return e.data.value=f.data,e.loading.value=!1,{isBreak:!0,breakResult:f.data};e.data.value=f.data},onQuery(w){const S=e.params.value,f=c(S);let C=Sl(f);return C&&C!==s?()=>C:(C=w(),s=C,Il(f,C),()=>C)},onSuccess(w,S){const f=c(S);f&&(l.value(),d(f,o,{data:w,params:S,time:new Date().getTime()}),l.value=p(S))},onMutate(w){const S=c(e.params.value);S&&(l.value(),d(S,o,{data:w,params:e.params.value,time:new Date().getTime()}),l.value=p(e.params.value))}}});function El(e){let t,o;class r extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new r(n=>{o=n,t=setTimeout(o,e)})}function Ue(){return new Date().getTime()}var Rl=fe((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const r=O(()=>{}),n=R(()=>se(t)),a=R(()=>se(o));let c=0,l={};const s=()=>{let i;return n.value&&(i=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},n.value)),()=>i&&clearTimeout(i)};return{onBefore(){e.loading.value=!n.value,r.value(),r.value=s(),c=Ue()},onQuery(i){if(!a.value)return()=>i();l=El(a.value+n.value);const d=async()=>{try{const v=await i();return Ue()-c<=n.value&&l.cancel(),Promise.resolve(v)}catch(v){return Ue()-c<=n.value&&l.cancel(),Promise.reject(v)}},y=Promise.allSettled([d(),l]).then(v=>{const p=v[0];return p.status==="fulfilled"?p.value:Promise.reject(p.reason)});return()=>y},onCancel(){r.value()},onAfter(){r.value()}}}),Ae;const At=new Set,Ft=new Set,Bt=new Set,Te=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=At;break;case"RECONNECT_LISTENER":o=Bt;break;case"VISIBLE_LISTENER":o=Ft;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Fe=e=>{e.forEach(t=>{t()})};!Ze&&(Ae=window)!==null&&Ae!==void 0&&Ae.addEventListener&&(window.addEventListener("visibilitychange",()=>{xt()&&Fe(Ft)},!1),window.addEventListener("focus",()=>Fe(At),!1),window.addEventListener("online",()=>Fe(Bt),!1));var Pl=fe((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:r=!1,errorRetryCount:n=0})=>{const a=O(),c=O(!1),l=R(()=>se(t)),s=R(()=>se(n)),i=[],d=_=>{_&&i.push(_)},y=()=>(o||xt())&&(r||ml()),v=_=>{if(e.error.value&&s.value!==0)return;let h;if(!he(l.value)&&l.value>=0)if(y())h=setTimeout(_,l.value);else{c.value=!0;return}return()=>h&&clearTimeout(h)},p=()=>{c.value&&y()&&(e.context.refresh(),c.value=!1)};return de(l,()=>{a.value&&(a.value(),a.value=v(()=>e.context.refresh()))}),o||d(Te("VISIBLE_LISTENER",p)),r||d(Te("RECONNECT_LISTENER",p)),Ie(()=>{i.forEach(_=>_())}),{onBefore(){var _;(_=a.value)===null||_===void 0||_.call(a)},onCancel(){var _;(_=a.value)===null||_===void 0||_.call(a)},onAfter(){a.value=v(()=>e.context.refresh())}}});const xl=(e,t)=>{let o=!1;return(...r)=>{o||(o=!0,e(...r),setTimeout(()=>{o=!1},t))}};var Ul=fe((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const r=R(()=>se(t)),n=R(()=>se(o)),a=[],c=s=>{s&&a.push(s)},l=()=>{a.forEach(s=>s())};return pe(()=>{if(l(),r.value){const s=xl(e.context.refresh,n.value);c(Te("VISIBLE_LISTENER",s)),c(Te("FOCUS_LISTENER",s))}}),Ie(()=>{l()}),{}});function _e(e,t){return $l(e,t,[Rl,gl,wl,Pl,Cl,Ul,kl,hl,Nl])}function Oe(){const{request:e}=Z(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:p=>e.get(t.detail,{params:p}),getApprovalNode:p=>e.post(t.approvalNode,p),startTask:p=>e.post(t.start,p),commitTask:p=>e.post(t.commit,p),saveDraft:p=>e.post(t.draft,p),revokeTask:p=>e.post(t.revoke,p),terminateTask:p=>e.post(t.terminate,p),withdrawTask:p=>e.post(t.withdraw,p),transferTask:p=>e.post(t.transfer,p),getPublishFlow:()=>e.get(t.publish),getTodoList:p=>e.get(t.todo,{params:p})}}function Al(e){const{commitTask:t,revokeTask:o,saveDraft:r,startTask:n,terminateTask:a,transferTask:c,withdrawTask:l}=Oe(),s=R(()=>{const{flowDetail:d,formVariables:y,approvalFormData:v,debug:p}=e,{flowDeployId:_}=d.value.process??{},{taskId:h,flowInstanceId:w}=d.value.task??{};return{flowDeployId:_,taskId:h,flowInstanceId:w,variables:y.value,debug:p.value,...v.value}}),i=()=>s.value.taskId&&s.value.flowInstanceId;return{flow_draft(){if(i())return r(s.value)},flow_pass(){return i()?t(s.value):n(s.value)},flow_revoke(){if(i())return o(s.value)},flow_withdraw(){if(i())return l(s.value)},flow_terminate(){if(i())return a(s.value)},flow_transfer(){if(i())return c(s.value)}}}function Fl(e){const t=O({});return pe(async()=>{var r;const{formProperty:o}=((r=u(e))==null?void 0:r.properties)||{};o!=null&&o.length&&(await ce(),Object.keys(t.value).forEach(n=>{var l,s,i,d;const a=((l=t.value[n])==null?void 0:l.label)||"",c=o==null?void 0:o.find(y=>y.prop===n);if(t.value[n].display=c==null?void 0:c.display,t.value[n].disabled=c==null?void 0:c.disabled,t.value[n].detail=c==null?void 0:c.detail,t.value[n].readonly=c==null?void 0:c.readonly,t.value[n].rules=t.value[n].rules??[],c!=null&&c.required&&((s=t.value[n].rules)!=null&&s.some(y=>y.required)))return null;c!=null&&c.required?(i=t.value[n].rules)==null||i.push({required:!0,message:`${a}为必填项`}):t.value[n].rules=(d=t.value[n].rules)==null?void 0:d.filter(y=>!y.required)}))}),t}function Bl(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Ml(){return{complete:e=>e}}const Mt=Symbol("flowFormState");function Kl(e,t){const o=Se(e,void 0,{passive:!0,deep:!0}),{flowDetail:r,modelValue:n,formLoading:a}=o,{getFlowDetail:c}=Oe();pe(()=>{const{flowKey:p,taskId:_,instanceId:h}=e;!p&&!_&&!h||(a.value=!0,c({flowKey:p,taskId:_,flowInstanceId:h}).then(w=>{r.value=w.data,n.value=w.data.formData||{}}).finally(()=>{a.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),s=R(()=>{var p,_,h,w;return l.value.fileTab===!0&&((w=(h=(_=(p=r.value)==null?void 0:p.properties)==null?void 0:_.formProperty)==null?void 0:h.find(S=>S.prop==="fileTab"))==null?void 0:w.display)}),i=R(()=>{var p,_,h,w;return l.value.trackTab===!0&&((w=(h=(_=(p=r.value)==null?void 0:p.properties)==null?void 0:_.formProperty)==null?void 0:h.find(S=>S.prop==="trackTab"))==null?void 0:w.display)}),d=O(!1),y=R(()=>Object.entries(n.value||{}).filter(([p])=>!p.startsWith("$")).map(([p,_])=>({key:p,value:_}))),v={...o,formData:n,formVariables:y,approvalVisible:d,showFileTab:s,showTrackTab:i,permission:l,emit:t};return kt(Mt,v),v}function Kt(){return we(Mt)}function Xe(e){return new Promise((t,o)=>{u(e).validate((n,a,c)=>{n?(a(),t(c)):o(c)})})}const zl=K({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=Se(e,void 0,{passive:!0,deep:!0}),o=Fl(e.flowDetail),{proxy:r}=Qe(),n=O({});pe(()=>{const{formOption:l}=e.flowDetail.process??{};n.value=$t.bind(r)(l||'{"menuBtn":false}'),n.value.detail=!!e.detail});const a=O();function c(){return Xe(a)}return{form:t,option:n,defaults:o,formRef:a,validate:c}},render(){return Me(D("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),jl=K({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Io(e,"modelValue"),{batchUpdate:r,create:n,remove:a,useList:c}=ia(),l=O(!1),{activeBtn:s}=Kt(),i=R(()=>{var C;return(C=s.value)==null?void 0:C.buttonKey}),{data:d,refresh:y}=c(i),v=R(()=>{var g,k,E;const C=o.value;if(C&&!((g=d.value)!=null&&g.some(L=>L.content===C))){const L=(((E=(k=d.value)==null?void 0:k[0])==null?void 0:E.sort)||1)-1;return[{content:C,sort:L},...d.value||[]]}return d.value});async function p(C){var g;await n({...C,type:(g=s.value)==null?void 0:g.buttonKey}),ne.success("添加成功"),y()}async function _(C){await a(C.id),ne.success("删除成功"),y()}async function h(C,g){let k=g.parent.data;k=k.map((E,L)=>({id:E.id,sort:L+1})),await r(k),ne.success("修改排序成功"),y(),l.value=!1}function w(){l.value=!0}const S=O();async function f(C){var g;o.value=C.content,await ce(),(g=S.value)==null||g.blur()}return(C,g)=>{const k=D("el-input"),E=D("el-text"),L=D("el-col"),N=D("el-button"),x=D("el-row"),V=D("el-tree"),I=D("el-popover");return T(),P(I,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:m(()=>[b(k,{ref_key:"inputRef",ref:S,modelValue:u(o),"onUpdate:modelValue":g[0]||(g[0]=$=>J(o)?o.value=$:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:g[1]||(g[1]=$=>l.value=!0),onBlur:g[2]||(g[2]=$=>l.value=!1)},null,8,["modelValue"])]),default:m(()=>[b(V,{data:u(v),"node-key":"content",draggable:"","allow-drop":($,z,A)=>A!=="inner",props:{label:"content"},onNodeClick:f,onNodeDrop:h,onNodeDragStart:w},{default:m(({data:$})=>[b(x,{style:{width:"250px"}},{default:m(()=>[b(L,{span:20},{default:m(()=>[b(E,{truncated:"",title:$.content},{default:m(()=>[U(q($.content),1)]),_:2},1032,["title"])]),_:2},1024),b(L,{span:4},{default:m(()=>[$.id?(T(),P(N,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Be(z=>_($),["stop"])},null,8,["onClick"])):(T(),P(N,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Be(z=>p($),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),ql=K({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Oe(),r={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:n,approvalFormData:a,activeBtn:c,approvalVisible:l,formVariables:s,flowDetail:i}=Kt(),d=O([]),y=O([]),v=O([]),p=O([]),_=O(),h=O({}),w={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:S}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function S(I,$,z){var Q;const A=d.value[0].type==="ParallelGateway",B=(Q=d.value[0].children)==null?void 0:Q.every(te=>Oo([te],X=>y.value.some(oe=>oe.id===X.id)));if(y.value.length){if(A&&!B)return z("请在每个节点选择审批人")}else return z("请选择审批人");return!0}const f=O(),C=R(()=>{var I,$;return($=(I=c.value)==null?void 0:I.approval)==null?void 0:$.includes("assignee")}),g=R(()=>{var I,$;return($=(I=c.value)==null?void 0:I.approval)==null?void 0:$.includes("circulate")}),k=R(()=>{var I,$;return($=(I=c.value)==null?void 0:I.approval)==null?void 0:$.includes("copyUser")}),E=O(!1),L=O(!1);pe(async()=>{var A,B,Q,te,X;if(!l.value||!_.value)return;const{flowKey:I}=((A=i.value)==null?void 0:A.process)||{},{taskId:$}=((B=i.value)==null?void 0:B.task)||{};d.value=[],y.value=[],v.value=[],p.value=[];const z=$?"":"发起";if(a.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:n.value.comment||z},ce(()=>{var oe,Y;h.value.assignee.display=C.value,h.value.circulate.display=g.value,h.value.copyUser.display=k.value,h.value.comment.display=(Y=(oe=c.value)==null?void 0:oe.approval)==null?void 0:Y.includes("comment")}),C.value)try{L.value=!0;const oe=c.value.buttonKey!=="flow_transfer",Y=await o({flowKey:I,variables:s.value,taskId:$,loadConfig:oe});d.value=Ke(Y.data??[],(ue,rt,W)=>{const ye=ue.id||ct();return ue.taskNodeKey=(W==null?void 0:W.taskNodeKey)??ue.taskNodeKey,ue.incoming=(W==null?void 0:W.incoming)??ue.incoming,{...ue,id:ye,disabled:ue.type!=="user"}}),await ce();const j=N(d.value);j&&((Q=f.value)==null||Q.setCheckedNodes([j]))}finally{L.value=!1}if(k.value){const oe=await o({flowKey:I,variables:s.value,taskId:$,loadConfig:!1});v.value=Ke(((X=(te=oe.data)==null?void 0:te[0])==null?void 0:X.children)??[],Y=>{var j;return Y.id||ct(),{...Y,label:Y.title,disabled:Y.type!=="user"&&!((j=Y.children)!=null&&j.length)}})}});function N(I){var $;if(I.length===1)return($=I[0].children)!=null&&$.length?N(I[0].children):I[0]}async function x(I,$){var A,B;if(I.type!=="user")return;await ce(),await ce();const z=(A=f.value)==null?void 0:A.getCheckedNodes();y.value=z.filter(Q=>Q.type==="user"),(B=f.value)==null||B.setCheckedNodes(y.value)}async function V(){await Xe(_),E.value=!0;const I={},$={},z=new Set;y.value.forEach(A=>{const{taskNodeKey:B,incoming:Q}=A;I[B]||(I[B]=new Set),A.userId&&I[B].add(A.userId),$[B]=[...I[B]].join(","),z.add(Q)}),a.value.assignee=$,a.value.outgoing=[...z],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",n),t("confirm")}return(I,$)=>{const z=D("el-col"),A=D("el-tag"),B=D("el-tree-select"),Q=D("avue-form"),te=D("el-row"),X=D("el-button"),oe=D("el-dialog"),Y=Ge("loading");return T(),P(oe,{modelValue:u(l),"onUpdate:modelValue":$[6]||($[6]=j=>J(l)?l.value=j:null),title:u(c).name,width:u(C)?"800px":"500px","append-to-body":""},{footer:m(()=>[b(X,{onClick:$[5]||($[5]=j=>l.value=!1)},{default:m(()=>[U(" 取 消 ")]),_:1}),b(X,{type:"primary",onClick:V},{default:m(()=>[U(" 确 定 ")]),_:1})]),default:m(()=>[b(te,{gutter:20},{default:m(()=>[u(C)?(T(),P(z,{key:0,span:10},{default:m(()=>[ge((T(),P(u(Lo),{ref_key:"treeRef",ref:f,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:d.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:x},{default:m(({data:j})=>[H("div",null,[b(u(Po),{icon:r[j.type],style:{display:"inline-block"}},null,8,["icon"]),H("span",null,q(j.title),1)])]),_:1},8,["data"])),[[Y,L.value]])]),_:1})):M("",!0),b(z,{span:u(C)?14:24},{default:m(()=>[b(Q,{ref_key:"formRef",ref:_,modelValue:u(a),"onUpdate:modelValue":$[3]||($[3]=j=>J(a)?a.value=j:null),defaults:h.value,"onUpdate:defaults":$[4]||($[4]=j=>h.value=j),option:w},{assignee:m(()=>[(T(!0),F(ee,null,ve(y.value,j=>(T(),P(A,{key:j.id,type:"info"},{default:m(()=>[U(q(j.title),1)]),_:2},1024))),128))]),copyUser:m(()=>[b(B,{modelValue:p.value,"onUpdate:modelValue":[$[0]||($[0]=j=>p.value=j),$[1]||($[1]=j=>u(a).copyUser=j.join(","))],data:v.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:m(()=>[b(jl,{modelValue:u(a).comment,"onUpdate:modelValue":$[2]||($[2]=j=>u(a).comment=j)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Wl=Bo,pt=K({__name:"assignee-setter",props:{modelValue:null,tableData:null},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:r}=da(),n=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(i){t("update:modelValue",i.join(","))}}),a=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(i){t("update:modelValue",i)}}),c=O([]),l=O(!1),s=R(()=>{var i,d;return(d=(i=o.tableData)==null?void 0:i.row)==null?void 0:d.type});return de(s,i=>{["dept","post","user"].includes(i)&&(l.value=!0,r(i==="user"?"":i).then(d=>{c.value=Ke(d.data,y=>({label:y.title,value:y.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(i,d)=>{const y=D("el-tree-select"),v=D("el-input");return["dept","post","user"].includes(u(s))?(T(),P(y,{key:0,modelValue:u(n),"onUpdate:modelValue":d[0]||(d[0]=p=>J(n)?n.value=p:null),data:c.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(T(),P(v,{key:1,modelValue:u(a),"onUpdate:modelValue":d[1]||(d[1]=p=>J(a)?a.value=p:null)},null,8,["modelValue"]))}}}),Hl={key:0,class:"flow-viewer"},Ql={class:"flow-status-legend"},Gl=K({__name:"index",props:{modelValue:null,view:{type:Boolean},flowFormOption:null,flowHistory:null},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,r=O({}),n=O({}),a=R({get(){let f=Fo();return typeof o.modelValue=="string"&&o.modelValue?f=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(f=o.modelValue),f},set(f){t("update:modelValue",JSON.stringify(f))}}),c=R(()=>{const{column:f=[],group:C=[]}=JSON.parse(o.flowFormOption||"{}");return[...f,...C.map(k=>k.column??[]).flat()]}),l=R(()=>c.value.map(C=>({label:C.label,value:`\${${C.prop}}`,desc:`\${${C.prop}}`}))),s=me(et),i=me(tt),{data:d}=ot().useList();de(n,f=>{var C,g,k,E,L,N,x,V,I,$,z;f&&(f.priority&&(f.priority.dicData=l.value),f.formTitle&&(f.formTitle.dicData=l.value),(k=(g=(C=f.assignee)==null?void 0:C.children)==null?void 0:g.column)!=null&&k[1]&&(f.assignee.children.column[1].component=pt),(I=(V=(x=(N=(L=(E=f.circulate)==null?void 0:E.children)==null?void 0:L.column)==null?void 0:N[1])==null?void 0:x.children)==null?void 0:V.column)!=null&&I[1]&&(f.circulate.children.column[1].children.column[1].component=pt),f.formProperty&&(r.value.formProperty=y(c.value,r.value.formProperty||[])),f.button&&((z=($=f.button.children)==null?void 0:$.column)==null||z.forEach(A=>{A.prop==="display"&&(A.dicData=s),A.prop==="approval"&&(A.dicData=i)}),r.value.button=v(d.value||[],r.value.button||[])))});function y(f,C){return f.map(g=>{var B,Q;const k=C.find(te=>te.prop===g.prop),{label:E,prop:L,display:N=!0,disabled:x=!1,detail:V=!1,readonly:I=!1,rules:$}=g,z=($==null?void 0:$.some(te=>te.required))??!1,A={label:E,prop:L,display:N,disabled:x,detail:V,readonly:I,required:z,...k};return g.type==="dynamic"&&((Q=(B=g.children)==null?void 0:B.column)!=null&&Q.length)&&(A.children=y(g.children.column,(k==null?void 0:k.children)??[])),A})}function v(f,C){return f.filter(g=>g.status===1).map(g=>{const k=C.find(I=>I.buttonKey===g.buttonKey),{name:E,buttonKey:L,display:N,approval:x}=g;return{name:E,buttonKey:L,display:N,approval:x,...k}})}const{data:p}=Ne().useParam("flow.task.status"),_=R(()=>{var f;return(f=o.flowHistory)==null?void 0:f.map(C=>{var k,E;const g=(E=(k=p.value)==null?void 0:k.find(L=>L.value===C.status))==null?void 0:E.style;return{id:C.taskNodeKey,style:g}})}),h=R(()=>{var f,C;return(C=(f=o.flowHistory)==null?void 0:f.filter(g=>g.taskNodeType==="userTask"))==null?void 0:C.map(g=>{var k;return{id:g.taskNodeKey,content:`<div>${g.assigneeName}</div>
        <div>${g.endTime??""}</div>
        <div>${((k=g.comment)==null?void 0:k.comment)??""}</div>`}})});function w(){var f,C;(C=(f=a.value)==null?void 0:f.flowElementList)==null||C.forEach(g=>{var k;(k=g.properties)!=null&&k.button&&(g.properties.button=v(d.value||[],[]))}),a.value={...a.value}}function S(){var f,C;(C=(f=a.value)==null?void 0:f.flowElementList)==null||C.forEach(g=>{var k;(k=g.properties)!=null&&k.formProperty&&(g.properties.formProperty=y(c.value,[]))}),a.value={...a.value}}return(f,C)=>{const g=D("el-button");return e.view?(T(),F("div",Hl,[H("div",Ql,[(T(!0),F(ee,null,ve(u(p),k=>{var E;return T(),F("div",{key:k.label,class:"legend-item"},[H("div",{class:"legend-color",style:He({backgroundColor:(E=k.style)==null?void 0:E.fill})},null,4),H("span",null,q(k.label),1)])}),128))]),b(u(Uo),{"model-value":u(a),styles:u(_),tooltips:u(h)},null,8,["model-value","styles","tooltips"])])):(T(),P(u(Ao),{key:1,modelValue:u(a),"onUpdate:modelValue":C[0]||(C[0]=k=>J(a)?a.value=k:null),formData:r.value,"onUpdate:formData":C[1]||(C[1]=k=>r.value=k),formDefaults:n.value,"onUpdate:formDefaults":C[2]||(C[2]=k=>n.value=k),"form-options":u(Wl),"form-width":"30%"},{"form-top":m(()=>[b(g,{type:"default",onClick:w},{default:m(()=>[U(" 重置所有按钮配置 ")]),_:1}),b(g,{type:"default",onClick:S},{default:m(()=>[U(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const Le=Je(Gl,[["__scopeId","data-v-2fb89427"]]),Jl={class:"flow-track"},Yl={key:0},Zl={key:1},Xl=K({__name:"flow-track",props:{flowDetail:null},setup(e){const t=e,o=O("table"),r=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=R(()=>{var s,i,d;return((d=(i=(s=t.flowDetail)==null?void 0:s.flowHistory)==null?void 0:i.filter(y=>y.taskNodeType==="userTask"))==null?void 0:d.map(y=>({...y,duration:co(y.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:c}=Ne().useParam("flow.handle.type");function l(s){var i;return(i=c.value)==null?void 0:i.find(d=>d.value===s)}return(s,i)=>{var f,C,g;const d=D("v-icon"),y=D("el-radio-button"),v=D("el-radio-group"),p=D("avue-crud"),_=D("el-card"),h=D("el-timeline-item"),w=D("el-timeline"),S=D("el-empty");return T(),F(ee,null,[b(v,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=k=>o.value=k)},{default:m(()=>[(T(),F(ee,null,ve(r,k=>b(y,{key:k.label,label:k.label},{default:m(()=>[b(d,{icon:k.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),H("div",Jl,[o.value==="table"?(T(),P(p,{key:0,data:u(n),option:a},null,8,["data"])):M("",!0),o.value==="graph"?(T(),P(Le,{key:1,"model-value":(C=(f=e.flowDetail)==null?void 0:f.process)==null?void 0:C.flowData,"flow-history":(g=e.flowDetail)==null?void 0:g.flowHistory,view:""},null,8,["model-value","flow-history"])):M("",!0),o.value==="timeline"?(T(),F(ee,{key:2},[u(n).length?(T(),P(w,{key:0},{default:m(()=>[(T(!0),F(ee,null,ve([...u(n)].reverse(),k=>(T(),P(h,{key:k.id,timestamp:k.endTime,placement:"top"},{default:m(()=>[b(_,null,{default:m(()=>{var E,L,N;return[H("div",null,q(k.assigneeName)+" 开始处理 ["+q(k.taskNodeName)+"] 环节 ",1),k.duration?(T(),F("div",Yl," 办理时长："+q(k.duration),1)):M("",!0),k.type&&((E=k.comment)!=null&&E.comment)?(T(),F("div",Zl,q((L=l(k.type))==null?void 0:L.label)+"意见："+q((N=k.comment)==null?void 0:N.comment),1)):M("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),P(S,{key:1}))],64)):M("",!0)])],64)}}});const ea=Je(Xl,[["__scopeId","data-v-c50075ce"]]),ta=K({__name:"button-list",props:{flowDetail:null},emits:["click"],setup(e,{emit:t}){const o=e,{data:r}=ot().useList();function n(c,l){return c.map(s=>{const i=l.find(y=>y.buttonKey===s.buttonKey);return{...s,...xo(i,["display","approval"])}})}const a=R(()=>{var _,h,w,S,f;const c={userId:"1"},{assignee:l,status:s}=((_=o.flowDetail)==null?void 0:_.task)||{},{createUser:i,flowInstanceId:d,status:y}=((h=o.flowDetail)==null?void 0:h.flowInstance)||{},v={true:!0,false:!1,startUser:i==c.userId,assignee:l==c.userId,todo:s==2,done:s==1,notstarted:!d,started:!!d,finished:y===1,unfinished:y===2};return((f=n(r.value??[],((S=(w=o.flowDetail)==null?void 0:w.properties)==null?void 0:S.button)??[]))==null?void 0:f.filter(C=>{var g,k;return(k=(g=C.display)==null?void 0:g.split(","))==null?void 0:k.every(E=>v[E])}))??[]});return(c,l)=>{const s=D("v-icon"),i=D("el-button");return T(!0),F(ee,null,ve(u(a),d=>(T(),P(i,{key:d.buttonKey,type:d.buttonType,onClick:y=>t("click",d)},{default:m(()=>[b(s,{icon:d.icon},null,8,["icon"]),U(" "+q(d.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),oa=K({__name:"upload-table",props:{flowDetail:null},setup(e){var _,h;const t=e,{upload:{action:o,headers:r,preview:n,download:a,props:c}}=Z(),l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:s,getDataList:i,handleDel:d,handleSave:y,crudStateRefs:{tableData:v}}=ae({crudOption:{...ua(),saveSuccessMsg:"上传成功"},tableOption:l,queryForm:{isLatest:1,flowInstanceId:(h=(_=t.flowDetail)==null?void 0:_.task)==null?void 0:h.flowInstanceId}});i();async function p(w,S){var N,x,V,I;const{fileName:f,fileType:C,fileSize:g,fileUrl:k,res:E}=c,L={fileName:ke({res:w},`${E}.${f}`),fileType:ke({res:w},`${E}.${C}`),fileSize:ke({res:w},`${E}.${g}`),fileUrl:ke({res:w},`${E}.${k}`),taskId:(x=(N=t.flowDetail)==null?void 0:N.task)==null?void 0:x.taskId,flowInstanceId:(I=(V=t.flowDetail)==null?void 0:V.task)==null?void 0:I.flowInstanceId,rootMark:(S==null?void 0:S.rootMark)||"",version:typeof(S==null?void 0:S.version)=="number"?S.version+1:1};await y(L,i,()=>{})}return(w,S)=>{const f=D("el-button"),C=D("el-upload"),g=D("avue-crud");return T(),P(g,re(ie(u(s))),{"menu-left":m(()=>[b(C,{action:u(o),headers:u(r),"show-file-list":!1,onSuccess:p},{default:m(()=>[b(f,{type:"primary",icon:"el-icon-upload"},{default:m(()=>[U(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:m(({row:k,index:E})=>[b(f,{type:"primary",text:"",icon:"el-icon-view",onClick:L=>{var N;return(N=u(n))==null?void 0:N(k,u(v))}},{default:m(()=>[U(" 预览 ")]),_:2},1032,["onClick"]),b(f,{type:"primary",text:"",icon:"el-icon-download",onClick:L=>{var N;return(N=u(a))==null?void 0:N(k,u(v))}},{default:m(()=>[U(" 下载 ")]),_:2},1032,["onClick"]),b(C,{action:u(o),headers:u(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:L=>p(L,k)},{default:m(()=>[b(f,{type:"primary",text:"",icon:"el-icon-upload"},{default:m(()=>[U(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),b(f,{type:"primary",text:"",icon:"el-icon-delete",onClick:L=>u(d)(k,E)},{default:m(()=>[U(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),la={class:"flow-form__title"},zt=K({__name:"index",props:Bl(),emits:Ml(),setup(e,{emit:t}){const o=e,r=Kl(o,t),{flowDetail:n,modelValue:a,activeTab:c,activeBtn:l,formLoading:s,approvalVisible:i,submitLoading:d}=r,y=O();async function v(h){var w,S;l.value=h,await((w=y.value)==null?void 0:w.validate()),await((S=o.beforeClick)==null?void 0:S.call(o,h)),(h==null?void 0:h.approval)!=="false"?i.value=!0:_()}const p=Al(r);async function _(){var h,w;try{const{buttonKey:S}=l.value;d.value=!0,await((h=o.beforeSubmit)==null?void 0:h.call(o,l.value));const f=(w=p[S])==null?void 0:w.call(p);f instanceof Promise?(await f,ne.success("操作成功"),i.value=!1,t("complete",l.value)):ne.error("操作失败")}finally{d.value=!1}}return(h,w)=>{const S=D("el-skeleton"),f=D("el-main"),C=D("el-header"),g=D("el-tab-pane"),k=D("el-tabs"),E=D("el-container");return u(s)?(T(),P(f,{key:0},{default:m(()=>[b(S)]),_:1})):(T(),P(E,{key:1,class:"flow-form"},{default:m(()=>[b(C,{class:"flow-form__header"},{default:m(()=>{var L;return[H("div",la,q((L=u(n).flowInstance)==null?void 0:L.title),1),b(ta,{"flow-detail":u(n),onClick:v},null,8,["flow-detail"])]}),_:1}),b(f,{class:"flow-form__main"},{default:m(()=>[b(k,{modelValue:u(c),"onUpdate:modelValue":w[1]||(w[1]=L=>J(c)?c.value=L:null)},{default:m(()=>{var L,N;return[(N=(L=u(n))==null?void 0:L.process)!=null&&N.formPath?le(h.$slots,"default",{key:0}):(T(),P(g,{key:1,label:"审批信息",name:"form"},{default:m(()=>[b(zl,{ref_key:"formRef",ref:y,modelValue:u(a),"onUpdate:modelValue":w[0]||(w[0]=x=>J(a)?a.value=x:null),"flow-detail":u(n)},null,8,["modelValue","flow-detail"])]),_:1})),b(g,{label:"附件资料",name:"file",lazy:""},{default:m(()=>[b(oa,{"flow-detail":u(n)},null,8,["flow-detail"])]),_:1}),b(g,{label:"流程跟踪",name:"track",lazy:""},{default:m(()=>[b(ea,{"flow-detail":u(n)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),b(ql,{onConfirm:_})]),_:3}))}}});function jt(e,t){switch(t.type){case"window":return aa(e,t);case"dialog":case"drawer":return na(e,t);default:return{open:()=>{},close:()=>{}}}}function aa(e,t){const{window:{url:o="",name:r="flow-form",features:n="left=0,top=0,width=1600,height=900"}={}}=t,a=O(null),c=R(()=>`${o}?${po(fo(e,mo(vo,yo)))}`);return{open:()=>{var i;a.value=window.open(c.value,r,n),(i=a.value)==null||i.addEventListener("message",d=>{const{event:y}=d.data,v=u(e)[y];typeof v=="function"&&v(d.data)})},close:()=>{var i;return(i=a.value)==null?void 0:i.close()},openedWindow:a}}function na(e,t){const{appContext:o}=Qe();let r;const n=()=>{r=document.createElement("div"),r.className="flow-form-wrapper";const c=sa(t.formPath),l=Me(c,{...u(e)}),s=Me(t.type==="dialog"?Zo:il,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},l);s.appContext=o,Co(s,r),document.body.appendChild(r)},a=()=>{r&&document.body.removeChild(r)};return{open:n,close:a}}function sa(e){return e?Do(()=>Vo(()=>import(e),[])):zt}function Z(){return we(Et)}var qt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(qt||{}),et=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(et||{}),tt=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(tt||{}),Wt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Wt||{});function ot(){const{request:e}=Z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ra(){const{request:e}=Z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ia(){const{request:e}=Z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=s=>e.get(t.list,{params:{type:s,ascs:"sort"}});return{url:t,getList:o,useList:s=>_e(()=>o(s.value).then(i=>i.data.records),{refreshDeps:[s]}),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),batchUpdate:s=>e.post(t.batchUpdate,s)}}function lt(){const{request:e}=Z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var Ht=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Ht||{});function at(){const{request:e}=Z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function ua(){const{request:e}=Z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function ca(){const{request:e}=Z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:r=>e.get(t.list,{params:r})}}function Ne(){const{request:e}=Z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=i=>e.get(t.list,{params:i}),r=()=>e.get(t.all),n=i=>e.get(t.key,{params:{paramKey:i}});return{url:t,getList:o,getAllParam:r,getParam:n,useParam:i=>_e(()=>n(i).then(d=>d.data)),create:i=>e.post(t.save,i),update:i=>e.post(t.update,i),remove:i=>e.post(t.remove,{},{params:{ids:i}})}}function Qt(){const{request:e}=Z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function da(){const{request:e}=Z(),t={tree:"/sapier-flow/flow-user/tree"},o=n=>e.get(t.tree,{params:{filter:n}});return{url:t,getUserTree:o,useUserTree:()=>_e(()=>o().then(n=>n.data))}}function Gt(){const{request:e}=Z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Jt=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Jt||{});function je(){const{request:e}=Z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=s=>e.get(t.list,{params:s});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(s=>s.data.records)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),deploy:s=>e.post(t.deploy,s)}}const pa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:me(qt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:me(et),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:me(tt),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:me(Wt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},fa=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r}=ae({tableOption:pa,crudOption:ot(),sortOption:{ascs:"sort"}});return r(),(n,a)=>{const c=D("v-icon"),l=D("el-button"),s=D("avue-crud");return T(),P(s,re(ie(u(t))),{icon:m(({row:i})=>[b(c,{icon:i.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:m(({row:i})=>[b(l,{type:i.buttonType},{default:m(()=>[b(c,{icon:i.icon},null,8,["icon"]),U(" "+q(i.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":m(()=>[b(l,{type:u(o).buttonType},{default:m(()=>[b(c,{icon:u(o).icon},null,8,["icon"]),U(" "+q(u(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),nt={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},ma={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...nt.column,{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Yt=K({__name:"index",props:{categoryId:null},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:r,deploy:n}=lt(),{bindVal:a,crudStateRefs:{searchForm:c},getDataList:l}=ae({tableOption:ma,crudOption:{getList:r},searchForm:{categoryId:o.categoryId}});pe(()=>{c.value.categoryId=o.categoryId??"",l()});const s=O(!1);async function i(d){await $e.confirm("发布新版本，是否确认？","提示",{type:"success"}),s.value=!0,n({flowModuleId:d.flowModuleId}).then(()=>{ne.success("发布成功"),l()}).finally(()=>{s.value=!1})}return(d,y)=>{const v=D("el-button"),p=D("v-icon"),_=D("avue-crud");return T(),P(_,re(ie(u(a))),{"menu-left":m(()=>[b(v,{type:"primary",icon:"el-icon-plus",onClick:y[0]||(y[0]=h=>t("add"))},{default:m(()=>[U(" 新增 ")]),_:1})]),menu:m(({row:h})=>[b(v,{loading:s.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",h)},{default:m(()=>[U(" 查看 ")]),_:2},1032,["loading","onClick"]),b(v,{loading:s.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",h)},{default:m(()=>[U(" 编辑 ")]),_:2},1032,["loading","onClick"]),b(v,{loading:s.value,type:"text",icon:"el-icon-upload",onClick:w=>i(h)},{default:m(()=>[U(" 发布 ")]),_:2},1032,["loading","onClick"]),b(v,{loading:s.value,type:"text",icon:"el-icon-switch",onClick:w=>t("version",h)},{default:m(()=>[U(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:m(({row:h})=>[b(p,{icon:h.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),va={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...nt.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Zt=K({__name:"index",props:{flowModuleId:null},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:r,update:n}=at(),{bindVal:a,crudStateRefs:{searchForm:c},getDataList:l}=ae({tableOption:va,crudOption:{getList:r,dataPath:"res.data"}});pe(()=>{o.flowModuleId&&(c.value.flowModuleId=o.flowModuleId,l())});const s=O(!1);async function i(d){await $e.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),s.value=!0,n({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{ne.success("设置成功"),l()}).finally(()=>{s.value=!1})}return(d,y)=>{const v=D("el-button"),p=D("v-icon"),_=D("avue-crud");return T(),P(_,re(ie(u(a))),{"menu-left":m(()=>[b(v,{loading:s.value,type:"primary",icon:"el-icon-arrow-left",onClick:y[0]||(y[0]=h=>t("back"))},{default:m(()=>[U(" 返回 ")]),_:1},8,["loading"])]),menu:m(({row:h})=>[b(v,{loading:s.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",h)},{default:m(()=>[U(" 查看 ")]),_:2},1032,["loading","onClick"]),b(v,{loading:s.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",h)},{default:m(()=>[U(" 编辑 ")]),_:2},1032,["loading","onClick"]),b(v,{loading:s.value,disabled:h.mainVersion===u(Ht).是,type:"text",icon:"el-icon-switch",onClick:w=>i(h)},{default:m(()=>[U(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:m(({row:h})=>[b(p,{icon:h.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),ft={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},ya=K({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:r},getDataList:n,handleSave:a,handleUpdate:c,handleDel:l}=ae({crudOption:{rowKey:"id",...ra(),dataPath:"res.data"},tableOption:ft,pageOption:{pageSize:20}});n();function s(y,v,p,_){a(v,p,_)}function i(y,v,p,_){c(v,NaN,p,_)}async function d(y,v){await l(y.data,NaN),v()}return(y,v)=>{const p=D("avue-tree");return T(),P(p,{modelValue:u(o),"onUpdate:modelValue":v[0]||(v[0]=_=>J(o)?o.value=_:null),option:u(ft),data:u(r),onNodeClick:v[1]||(v[1]=_=>t("node-click",_)),onSave:s,onUpdate:i,onDel:d},null,8,["modelValue","option","data"])}}}),st=K({__name:"index",props:{modelValue:null,view:{type:Boolean},fields:null},emits:["update:modelValue"],setup(e,{emit:t}){var l;const o=e,r=R({get(){return o.modelValue?$t(o.modelValue):{menuBtn:!1,span:24}},set(s){t("update:modelValue",Ro(s,{useJson5:!1}))}}),n=R(()=>o.fields?JSON.parse(o.fields):[]),a=R(()=>{const s={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...s,props:{label:"name",value:"name",desc:"comment"}},{...s,props:{label:"comment",value:"comment",desc:"name"}}]}),c={form:{settings:Array.from({length:((l=No.settings)==null?void 0:l.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(s,i)=>{const d=D("avue-form");return e.view?(T(),P(d,{key:0,class:G(u(r).class),"model-value":{},option:u(r)},null,8,["class","option"])):(T(),P(u(Eo),{key:1,modelValue:u(r),"onUpdate:modelValue":i[0]||(i[0]=y=>J(r)?r.value=y:null),"base-option":u(a),resources:c},null,8,["modelValue","base-option"]))}}}),ba=H("span",null,"流程设计",-1),_a={key:0},wa={key:1},ga={style:{height:"calc(100vh - 144px)"}},ha=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const r=Se(e),{visible:n,modelValue:a}=r,{create:c,deploy:l,getDetail:s,update:i}=lt(),{getDetail:d,update:y}=at(),v=["流程信息","表单设计","模型设计","完成"],p=O(!1);de(n,async x=>{if(!x)return;const{flowModuleId:V}=a.value,{flowDeployId:I}=a.value;try{p.value=!0;let $={};I?$=await d({flowDeployId:I}):V&&($=await s({flowModuleId:V})),a.value=$.data}finally{p.value=!1}},{immediate:!0});const{data:_}=Gt().useList(),{data:h}=Qt().useList(),{data:w}=je().useList(),S=R(()=>{var x,V;return(V=(x=w.value)==null?void 0:x.find(I=>I.tableName===a.value.formDataTable))==null?void 0:V.tableFields}),f=O(0),C=R(()=>{var x,V;return f.value===1?((x=_.value)==null?void 0:x.map(I=>({label:I.formName,value:I.formOption})))??[]:f.value===2?((V=h.value)==null?void 0:V.map(I=>({label:I.flowName,value:I.flowData})))??[]:[]});function g(x){f.value===1?a.value.formOption=x.value:f.value===2&&(a.value.flowData=x.value)}const k=O();async function E(x){f.value===0&&await Xe(k),p.value=!0;const{flowModuleId:V}=a.value,{flowDeployId:I}=a.value;try{I?await y(a.value):V?await i(a.value):await c(a.value).then($=>{a.value.flowModuleId=$.data.flowModuleId}),ne.success("保存成功")}finally{p.value=!1}typeof x=="number"?f.value=x:f.value++}async function L(){await $e.confirm("发布新版本，是否确认？","提示"),p.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{ne.success("发布成功")}).finally(()=>{p.value=!1})}function N(){n.value=!1,f.value=0,a.value={},t("close")}return(x,V)=>{const I=D("el-link"),$=D("el-dropdown-item"),z=D("el-dropdown-menu"),A=D("el-dropdown"),B=D("el-col"),Q=D("el-step"),te=D("el-steps"),X=D("el-button"),oe=D("el-row"),Y=D("avue-form"),j=D("el-result"),ue=D("el-dialog"),rt=Ge("loading");return T(),P(ue,{modelValue:u(n),"onUpdate:modelValue":V[4]||(V[4]=W=>J(n)?n.value=W:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:N},{header:m(()=>[b(oe,{align:"center",justify:"center"},{default:m(()=>[b(B,{span:5},{default:m(()=>{var W,ye,Ee,it;return[H("div",null,[ba,(W=u(a))!=null&&W.flowName?(T(),F("span",_a," - "+q((ye=u(a))==null?void 0:ye.flowName),1)):M("",!0),(Ee=u(a))!=null&&Ee.version?(T(),F("span",wa," - V"+q((it=u(a))==null?void 0:it.version),1)):M("",!0)]),u(C).length?(T(),P(A,{key:0},{dropdown:m(()=>[b(z,null,{default:m(()=>[(T(!0),F(ee,null,ve(u(C),Re=>(T(),P($,{key:Re.label,onClick:za=>g(Re)},{default:m(()=>[U(q(Re.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:m(()=>[b(I,{icon:"el-icon-arrow-down",underline:!1},{default:m(()=>[U(" 选择模板 ")]),_:1})]),_:1})):M("",!0)]}),_:1}),b(B,{span:14},{default:m(()=>[b(te,{active:f.value,simple:"","process-status":"finish","finish-status":"success"},{default:m(()=>[(T(),F(ee,null,ve(v,(W,ye)=>b(Q,{key:ye,title:W,onClick:Ee=>E(ye)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),b(B,{span:5,style:{"text-align":"right"}},{default:m(()=>[b(X,{disabled:f.value===0,loading:p.value,type:"primary",onClick:V[0]||(V[0]=W=>f.value--)},{default:m(()=>[U(" 上一步 ")]),_:1},8,["disabled","loading"]),b(X,{disabled:f.value===v.length-1,type:"primary",loading:p.value,onClick:E},{default:m(()=>[U(" 下一步 ")]),_:1},8,["disabled","loading"]),b(X,{onClick:N},{default:m(()=>[U(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:m(()=>[ge((T(),F("div",ga,[f.value===0?(T(),P(Y,{key:0,ref_key:"formRef",ref:k,modelValue:u(a),"onUpdate:modelValue":V[1]||(V[1]=W=>J(a)?a.value=W:null),option:u(nt),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):M("",!0),f.value===1?(T(),P(st,{key:1,modelValue:u(a).formOption,"onUpdate:modelValue":V[2]||(V[2]=W=>u(a).formOption=W),fields:u(S)},null,8,["modelValue","fields"])):M("",!0),f.value===2?(T(),P(Le,{key:2,modelValue:u(a).flowData,"onUpdate:modelValue":V[3]||(V[3]=W=>u(a).flowData=W),"flow-form-option":u(a).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),f.value===3?(T(),P(j,{key:3,icon:"success",title:"流程设计完成"},{extra:m(()=>[u(a).flowDeployId?M("",!0):(T(),P(X,{key:0,type:"primary",onClick:L},{default:m(()=>[U(" 发布 ")]),_:1})),b(X,{onClick:N},{default:m(()=>[U(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[rt,p.value]])]),_:1},8,["modelValue"])}}}),ka=H("span",null,"流程查看",-1),Ca={key:0},Da={key:1},Va=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},setup(e){const o=Se(e),{visible:r,modelValue:n}=o,{getDetail:a}=lt(),{getDetail:c}=at(),l=O("form"),s=O(!1);de(r,async d=>{if(!d)return;const{flowModuleId:y}=n.value,{flowDeployId:v}=n.value;try{s.value=!0;let p={};v?p=await c({flowDeployId:v}):y&&(p=await a({flowModuleId:y})),n.value={...p.data}}finally{s.value=!1}},{immediate:!0});function i(){n.value={},l.value="form"}return(d,y)=>{const v=D("el-tab-pane"),p=D("el-tabs"),_=D("el-dialog"),h=Ge("loading");return T(),P(_,{modelValue:u(r),"onUpdate:modelValue":y[3]||(y[3]=w=>J(r)?r.value=w:null),width:"60%",top:"0",onClose:i},{header:m(()=>{var w,S,f,C;return[ka,(w=u(n))!=null&&w.flowName?(T(),F("span",Ca," - "+q((S=u(n))==null?void 0:S.flowName),1)):M("",!0),(f=u(n))!=null&&f.version?(T(),F("span",Da," - V"+q((C=u(n))==null?void 0:C.version),1)):M("",!0)]}),default:m(()=>[ge((T(),P(p,{modelValue:l.value,"onUpdate:modelValue":y[2]||(y[2]=w=>l.value=w)},{default:m(()=>[b(v,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:m(()=>[l.value==="form"&&u(n).formOption?(T(),P(st,{key:0,modelValue:u(n).formOption,"onUpdate:modelValue":y[0]||(y[0]=w=>u(n).formOption=w),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),b(v,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:m(()=>[l.value==="flow"?(T(),P(Le,{key:0,modelValue:u(n).flowData,"onUpdate:modelValue":y[1]||(y[1]=w=>u(n).flowData=w),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[h,s.value]])]),_:1},8,["modelValue"])}}}),Ta=K({__name:"index",setup(e){const t=O("definition"),o=O({}),r=O(""),n=O("");function a(_){r.value===_.id?r.value="":r.value=_.id}const c=O(!1),l=O(!1);function s(){o.value={},c.value=!0}function i(_){o.value=_,c.value=!0}function d(_){o.value=_,l.value=!0}function y(_){n.value=_.flowModuleId||"",t.value="deploy"}function v(){n.value="",t.value="definition"}async function p(){const _=t.value;await ce(),t.value="",await ce(),t.value=`${_}`}return(_,h)=>{const w=D("el-col"),S=D("el-row");return T(),P(S,{gutter:20},{default:m(()=>[b(w,{span:4},{default:m(()=>[b(ya,{onNodeClick:a})]),_:1}),b(w,{span:20},{default:m(()=>[t.value==="definition"?(T(),P(Yt,{key:0,"category-id":r.value,onAdd:s,onEdit:i,onView:d,onVersion:y},null,8,["category-id"])):M("",!0),t.value==="deploy"?(T(),P(Zt,{key:1,"flow-module-id":n.value,onEdit:i,onView:d,onBack:v},null,8,["flow-module-id"])):M("",!0),b(ha,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=f=>o.value=f),visible:c.value,"onUpdate:visible":h[1]||(h[1]=f=>c.value=f),onClose:p},null,8,["modelValue","visible"]),b(Va,{modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=f=>o.value=f),visible:l.value,"onUpdate:visible":h[3]||(h[3]=f=>l.value=f)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),$a={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},Ia=K({__name:"index",setup(e){const t=So("debugMode",!1),{getList:o}=ca(),{bindVal:r,getDataList:n}=ae({tableOption:$a,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});n();const a=O({}),{open:c,close:l}=jt(a,{type:"drawer"});function s(i){a.value={flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:t.value,onComplete:()=>{l(),n()}},c()}return(i,d)=>{const y=D("el-switch"),v=D("el-button"),p=D("el-link"),_=D("avue-crud");return T(),P(_,re(ie(u(r))),{"menu-right":m(()=>[b(v,{type:"text"},{default:m(()=>[b(y,{modelValue:u(t),"onUpdate:modelValue":d[0]||(d[0]=h=>J(t)?t.value=h:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:m(({row:h})=>[b(p,{type:"primary",underline:!1,onClick:w=>s(h)},{default:m(()=>[U(q(h.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),Sa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:ze},{label:"备注",prop:"remark"}]},Oa=K({__name:"index",setup(e){const{bindVal:t,getDataList:o}=ae({tableOption:Sa,crudOption:Ne()});return o(),(r,n)=>{const a=D("avue-crud");return T(),P(a,re(ie(u(t))),null,16)}}}),La={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Na={class:"flow-list"},Ea=["onClick"],Ra={class:"flow-name"},Pa=K({__name:"index",setup(e){const t=O([]),{getPublishFlow:o,getTodoList:r}=Oe();o().then(v=>{t.value=v.data});const n=O({}),{open:a,close:c}=jt(n,{type:"drawer"});function l(v){n.value={flowKey:v.flowKey,taskId:v.taskId,instanceId:v.flowInstanceId,onComplete:()=>{c(),i()}},a()}const{bindVal:s,getDataList:i,crudStateRefs:{searchForm:d}}=ae({tableOption:La,crudOption:{getList:r},searchForm:{status:2}}),y=[{label:"待办",value:2},{label:"已办",value:1}];return(v,p)=>{const _=D("el-button"),h=D("v-icon"),w=D("el-collapse-item"),S=D("el-collapse"),f=D("el-card"),C=D("el-divider"),g=D("avue-radio"),k=D("el-link"),E=D("avue-crud");return T(),F(ee,null,[b(f,{"body-style":{padding:"0 20px"}},{default:m(()=>[b(S,{"model-value":"1"},{default:m(()=>[b(w,{name:"1"},{title:m(()=>[b(_,{text:"",icon:"el-icon-promotion"},{default:m(()=>[U(" 发起审批 ")]),_:1})]),default:m(()=>[H("div",Na,[(T(!0),F(ee,null,ve(t.value,L=>(T(),F("div",{key:L.flowKey,class:"flow-item",onClick:N=>l(L)},[b(h,{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),H("div",Ra,q(L.flowName),1)],8,Ea))),128))])]),_:1})]),_:1})]),_:1}),b(C,{direction:"horizontal","content-position":"left"}),b(E,re(ie(u(s))),{"menu-left":m(()=>[b(g,{modelValue:u(d).status,"onUpdate:modelValue":[p[0]||(p[0]=L=>u(d).status=L),u(i)],button:"",dic:y},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:m(({row:L})=>[b(k,{type:"primary",underline:!1,onClick:N=>l(L)},{default:m(()=>[U(q(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const xa=Je(Pa,[["__scopeId","data-v-7d8c52d6"]]),Ua={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Aa=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r,handleUpdate:n}=ae({tableOption:Ua,crudOption:Qt()});r();const a=O(!1);async function c(s){o.value=s,a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(s,i)=>{const d=D("el-button"),y=D("avue-crud"),v=D("el-dialog");return T(),F(ee,null,[b(y,re(ie(u(t))),{flowData:m(({row:p})=>[b(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:_=>c(p)},{default:m(()=>[U(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),b(v,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=p=>a.value=p),title:`模型设计-${u(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:m(()=>[b(d,{type:"primary",onClick:l},{default:m(()=>[U(" 保存 ")]),_:1}),b(d,{onClick:i[1]||(i[1]=p=>a.value=!1)},{default:m(()=>[U(" 取消 ")]),_:1})]),default:m(()=>[b(Le,{modelValue:u(o).flowData,"onUpdate:modelValue":i[0]||(i[0]=p=>u(o).flowData=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Fa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Ba=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r,handleUpdate:n}=ae({tableOption:Fa,crudOption:Gt()});r();const a=O(!1);async function c(s){o.value={...s},a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(s,i)=>{const d=D("el-button"),y=D("avue-crud"),v=D("el-dialog");return T(),F(ee,null,[b(y,re(ie(u(t))),{formOption:m(({row:p})=>[b(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:_=>c(p)},{default:m(()=>[U(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),b(v,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=p=>a.value=p),title:`表单设计-${u(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:m(()=>[b(d,{type:"primary",onClick:l},{default:m(()=>[U(" 保存 ")]),_:1}),b(d,{onClick:i[1]||(i[1]=p=>a.value=!1)},{default:m(()=>[U(" 取消 ")]),_:1})]),default:m(()=>[b(st,{modelValue:u(o).formOption,"onUpdate:modelValue":i[0]||(i[0]=p=>u(o).formOption=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ma={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:me(Jt)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:ze,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:ze,value:1}]}}]},Ka=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r,beforeOpen:n,beforeSubmit:a}=ae({crudOption:je(),tableOption:Ma});r();const{data:c}=Ne().useParam("table.default.fields");n(d=>{d==="add"?o.value.tableFields=c.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),a(d=>{d.tableFields=JSON.stringify(d.tableFields)});const{deploy:l}=je(),s=O(!1);async function i(d){await $e.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),s.value=!0,l({id:d.id}).then(()=>{ne.success("部署成功"),r()}).finally(()=>{s.value=!1})}return(d,y)=>{const v=D("el-button"),p=D("avue-crud");return T(),P(p,re(ie(u(t))),{menu:m(({row:_})=>[b(v,{type:"text",icon:"el-icon-upload",onClick:h=>i(_)},{default:m(()=>[U(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Hn={install(e,t){e.component("FlowButton",fa),e.component("FlowDefinition",Yt),e.component("FlowDeploy",Zt),e.component("FlowForm",zt),e.component("FlowManage",Ta),e.component("FlowOps",Ia),e.component("FlowParam",Oa),e.component("FlowTemplate",Aa),e.component("FormTemplate",Ba),e.component("TableTemplate",Ka),e.component("FlowWorkbench",xa),e.provide(Et,bo(ul,t))}};export{fa as FlowButton,Yt as FlowDefinition,Zt as FlowDeploy,zt as FlowForm,Ta as FlowManage,Ia as FlowOps,Oa as FlowParam,Aa as FlowTemplate,xa as FlowWorkbench,Ba as FormTemplate,Ka as TableTemplate,Hn as default};
