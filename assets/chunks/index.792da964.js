import{c as P,C as Me,t as Se,d as Ae,e as Be,f as Ee,g as ae,h as Ke,F as se,b as Re,i as ve,T as ne,j as _e,k as je,l as we,m as ze,n as We,o as He,p as Je}from"./mobile.07d9a88f.js";import{K as Wo,L as Ho,M as Jo,N as Go,D as Xo,w as Zo,v as Qo,s as Yo,x as qo,r as el,_ as tl,z as ol,O as ll,H as al,P as nl,B as sl,Q as il,W as ul,E as rl,I as dl,X as cl,V as pl,Y as ml,$ as fl,U as vl,J as _l,R as wl,q as yl,S as gl,y as bl,A as kl,a as Dl,u as Fl,Z as Vl,G as Cl}from"./mobile.07d9a88f.js";import{d as x,a5 as me,aA as Ge,l as Xe,u as A,v as D,C as O,O as t,aa as j,ab as z,N as u,M as f,E as n,B as M,L as C,X as K,H as ie,j as Q,q as ye,r as J,aB as ge,F as X,b as B,y as ee,x as G,a8 as be,n as fe,_ as Ze,a as Qe,V as ke}from"./framework.a27b52b7.js";import"./index.b942cce0.js";import{s as Ye}from"./index.386fc70b.js";import{m as ue}from"./merge.958938e5.js";import{o as De}from"./omitBy.560fb68d.js";import{a as qe}from"./snakeCase.55ae7a36.js";import{k as et}from"./baseGet.de748d67.js";import{i as tt}from"./isNil.990ccdb3.js";import{E as ot,a as lt}from"../app.37866784.js";import{u as R}from"./index.a1eeb8c8.js";import"./index.es.27626f09.js";import{I as Y}from"./iconify.d031996c.js";import"./index.1ddd27c3.js";import"./form.3508c547.js";import"./index.fb223d47.js";import"./index.2bbac439.js";import{f as at,M as nt,j as st,b as it}from"./tree.3d3a4775.js";import"./preview.vue_vue_type_script_lang.3ba375ba.js";import{u as q}from"./index.d115895a.js";import{d as ut}from"./union.84ac606f.js";import{a as Z,E}from"./index.947e5bfa.js";import{p as rt}from"./pick.d18c515d.js";import{w as te,a as re,u as dt,c as ct,d as pt}from"./index.db511a59.js";import{d as mt}from"./zipWith.c1dbda15.js";import"./index.0246ace1.js";import"./index.9fb34329.js";import"./cloneDeep.107df971.js";import"./baseSet.af584b72.js";import"./initCloneObject.e5cb543d.js";import"./getTag.37655c57.js";import"./data.836085ce.js";import"./get.198c11b5.js";import"./basePickBy.8321d4c1.js";import"./pickBy.bfc00960.js";import"./omit.941c93ff.js";import"./createCompounder.ddb34af6.js";import"./theme.377bde07.js";import"./index.vue_vue_type_script_setup_true_lang.68350114.js";import"./index.f7cc3270.js";import"./use-form-item.53aa3b9e.js";import"./isEqual.b51c3998.js";import"./index.4ccc50bf.js";import"./set.d72821b0.js";import"./index.0775afe4.js";import"./config.8acf8b03.js";import"./kebabCase.19a9d0b0.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-browser.prod.894f6e94.js";function Fe(d){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},a=_=>d.get(e.list,{params:_}),o=q(a,{res:"data",defaultParams:[{size:-1,ascs:"sort"}]});return{getList:a,useList:o,getTree:_=>d.get(e.tree,{params:_}),create:_=>d.post(e.save,_),update:_=>d.post(e.update,_),remove:_=>d.post(e.remove,{},{params:{ids:_}})}}function oe(d){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},a=p=>d.get(e.list,{params:p}),o=q(a,{res:"data.records",defaultParams:[{size:-1,ascs:"sort"}]});return{url:e,getList:a,useList:o,create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}}),deploy:p=>d.post(e.deploy,p),getDetail:p=>d.get(e.detail,{params:p})}}var Ve=(d=>(d[d.否=0]="否",d[d.是=1]="是",d))(Ve||{});function de(d){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"},a=r=>d.get(e.list,{params:r}),o=q(a,{res:"data"});return{url:e,getList:a,useList:o,getDetail:r=>d.get(e.detail,{params:r}),update:r=>d.post(e.update,r),remove:r=>d.post(e.remove,{},{params:{ids:r}})}}function ft(d){const e={list:"/sapier-flow/flow-ops/list"},a=l=>d.get(e.list,{params:l}),o=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getTaskOpsList:a,useTaskOpsList:o}}function Ce(d){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},a=r=>d.get(e.list,{params:r}),o=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getList:a,useList:o,create:r=>d.post(e.save,r),update:r=>d.post(e.update,r),remove:r=>d.post(e.remove,{},{params:{ids:r}})}}function Oe(d){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},a=r=>d.get(e.list,{params:r}),o=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getList:a,useList:o,create:r=>d.post(e.save,r),update:r=>d.post(e.update,r),remove:r=>d.post(e.remove,{},{params:{ids:r}})}}function he(d,e){return e in(Me.useFlowFormOptions??{})}function le(d={}){const{useFlowFormOptions:e}=P(),a=ue({...e},{...d});switch(a==null?void 0:a.type){case"window":return vt(a);case"dialog":case"drawer":return _t(a);default:return{open:o=>{},close:()=>{}}}}function vt(d={}){const e=x(null);return{open:(l={})=>{var w;const s=ue({...d},{...l}),{window:[c,r,_]=[]}=s,p=`${c}?${Ye(De(s,qe(et,tt,he)))}`;e.value=window.open(p,r,_),(w=e.value)==null||w.addEventListener("message",F=>{const{event:y,data:V}=F.data,i=l[y];typeof i=="function"&&i(V)})},close:()=>{var l;return(l=e.value)==null?void 0:l.close()},openedWindow:e}}function _t(d={}){const{appContext:e}=Xe(),{FlowForm:a}=P();let o,l;const s=r=>{o=document.createElement("div"),o.className="flow-form-wrapper";const _=ue({...d},{...r}),p=me(a,De(_,he));l=me(_.type==="dialog"?ot:lt,{class:"flow-form-overlay",modelValue:!0,onClose:c,..._.overlay},p),l.appContext=e,Ge(l,o),document.body.appendChild(o)},c=()=>{var r,_;(_=(r=l==null?void 0:l.component)==null?void 0:r.props)!=null&&_.modelValue&&(l.component.props.modelValue=!1),o&&document.body.removeChild(o),o=null};return{open:s,close:c}}const wt=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o},getDataList:l}=R({tableOption:Se,crudOption:Ae(e),sortOption:{ascs:"sort"}});return l(),(s,c)=>{const r=f("el-button"),_=f("avue-crud");return D(),O(_,j(z(u(a))),{icon:t(({row:p})=>[n(u(Y),{icon:p.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:t(({row:p})=>[n(r,{type:p.buttonType},{default:t(()=>[p.icon?(D(),O(u(Y),{key:0,icon:p.icon},null,8,["icon"])):M("",!0),C(" "+K(p.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":t(()=>[n(r,{type:u(o).buttonType},{default:t(()=>[u(o).icon?(D(),O(u(Y),{key:0,icon:u(o).icon},null,8,["icon"])):M("",!0),C(" "+K(u(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),$e=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(d,{emit:e}){const a=d,{request:o}=P(),{getList:l,deploy:s,update:c,remove:r}=oe(o),{bindVal:_,crudStateRefs:{searchForm:p},getDataList:w}=R({tableOption:Be,crudOption:{getList:l,remove:r},sortOption:{ascs:"sort"},searchForm:{categoryId:a.categoryId}});ie(()=>{p.value.categoryId=a.categoryId??""}),te(p,w,{debounce:300,immediate:!0,deep:!0});const F=x(!1);async function y(k){await Z.confirm("发布新版本，是否确认？","提示",{type:"success"}),F.value=!0,s({flowModuleId:k.flowModuleId}).then(()=>{E.success("发布成功"),w()}).finally(()=>{F.value=!1})}async function V(k){if(k.mainVersion)return E.warning("请先删除已发布的流程");await Z.confirm("确认删除？","提示",{type:"warning"}),await r(k.flowModuleId),E.success("删除成功"),w()}function i(k){c(rt(k,["flowModuleId","flowKey","sort"])),w()}const v=ut(i,500),{open:m,close:g}=le();function h(k){m({flowKey:k.flowKey,debug:!0,onComplete(){g(),E.success("操作成功")}})}return(k,L)=>{const T=f("el-button"),N=f("el-dropdown-item"),U=f("el-input-number"),$=f("avue-crud");return D(),O($,j(z(u(_))),{"menu-left":t(()=>[n(T,{type:"primary",icon:"el-icon-plus",onClick:L[0]||(L[0]=b=>e("add"))},{default:t(()=>[C(" 新增 ")]),_:1})]),"menu-btn":t(({row:b})=>[n(N,{icon:"el-icon-view",onClick:I=>e("view",b)},{default:t(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),n(N,{icon:"el-icon-edit",onClick:I=>e("edit",b)},{default:t(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),n(N,{icon:"el-icon-delete",onClick:I=>V(b)},{default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),n(N,{icon:"el-icon-video-play",onClick:I=>h(b)},{default:t(()=>[C(" 调试 ")]),_:2},1032,["onClick"]),n(N,{icon:"el-icon-upload",onClick:I=>y(b)},{default:t(()=>[C(" 发布 ")]),_:2},1032,["onClick"]),n(N,{icon:"el-icon-switch",onClick:I=>e("version",b)},{default:t(()=>[C(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:t(({row:b})=>[n(u(Y),{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:t(({row:b})=>[n(U,{modelValue:b.sort,"onUpdate:modelValue":I=>b.sort=I,"controls-position":"right",style:{width:"100%"},onChange:I=>u(v)(b)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),Te=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(d,{emit:e}){const a=d,{request:o}=P(),{getList:l,update:s,remove:c}=de(o),{bindVal:r,crudStateRefs:{searchForm:_,tableData:p},getDataList:w}=R({tableOption:Ee,crudOption:{getList:l,dataPath:"res.data"},sortOption:{descs:"version"}});ie(()=>{_.value.flowModuleId=a.flowModuleId}),te(_,w,{debounce:300,immediate:!0,deep:!0});const F=x(!1);async function y(g){await Z.confirm(`确定将 ${g.flowName}(${g.flowKey}:v${g.version}) 设为主版本?`,"提示",{type:"warning"}),F.value=!0,s({flowDeployId:g.flowDeployId,flowModuleId:g.flowModuleId,mainVersion:1}).then(()=>{E.success("设置成功"),w()}).finally(()=>{F.value=!1})}async function V(g){const{value:h}=await Z.prompt("请输入确认删除的流程标识","提示",{type:"warning"});h===g.flowKey&&(await c(g.flowDeployId),E.success("删除成功"),w())}const{open:i,close:v}=le();function m(){var h;const g=(h=p.value[0])==null?void 0:h.flowKey;g&&i({flowKey:g,debug:!0,onComplete(){v(),E.success("操作成功")}})}return(g,h)=>{const k=f("el-button"),L=f("el-tooltip"),T=f("el-dropdown-item"),N=f("avue-crud");return D(),O(N,j(z(u(r))),{"menu-left":t(()=>[n(k,{loading:F.value,type:"primary",icon:"el-icon-arrow-left",onClick:h[0]||(h[0]=U=>e("back"))},{default:t(()=>[C(" 返回 ")]),_:1},8,["loading"])]),"menu-right":t(()=>[n(L,{content:"调试"},{default:t(()=>[n(k,{icon:"el-icon-video-play",circle:"",onClick:m})]),_:1})]),"menu-btn":t(({row:U})=>[n(T,{icon:"el-icon-view",onClick:$=>e("view",U)},{default:t(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),n(T,{icon:"el-icon-edit",onClick:$=>e("edit",U)},{default:t(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),n(T,{icon:"el-icon-delete",onClick:$=>V(U)},{default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),n(T,{icon:"el-icon-switch",disabled:U.mainVersion===u(Ve).是,onClick:$=>y(U)},{default:t(()=>[C(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:t(({row:U})=>[n(u(Y),{icon:U.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),yt=A({__name:"CategoryTree",emits:["node-click"],setup(d,{emit:e}){const a={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},{request:o}=P(),{crudStateRefs:{formData:l,tableData:s},getDataList:c,handleSave:r,handleUpdate:_,handleDel:p}=R({crudOption:{rowKey:"id",...Fe(o),dataPath:"res.data"},sortOption:{ascs:"sort"},tableOption:a,pageOption:{pageSize:20}});c();function w(V,i,v,m){r(i,v,m)}function F(V,i,v,m){_(i,Number.NaN,v,m)}async function y(V,i){await p(V.data,Number.NaN),i()}return(V,i)=>{const v=f("avue-tree");return D(),O(v,{modelValue:u(l),"onUpdate:modelValue":i[0]||(i[0]=m=>Q(l)?l.value=m:null),option:a,data:u(s),onNodeClick:i[1]||(i[1]=m=>e("node-click",m)),onSave:w,onUpdate:F,onDel:y},null,8,["modelValue","data"])}}}),gt={style:{display:"flex","align-items":"center"}},bt=X("span",null,"流程设计",-1),kt={key:0},Dt={key:1},Ft={style:{height:"calc(100vh - 144px)"}},Vt=A({__name:"DesignSteps",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(d,{emit:e}){const o=re(d),{visible:l,modelValue:s}=o,{request:c}=P(),{create:r,deploy:_,getDetail:p,update:w}=oe(c),{getDetail:F,update:y}=de(c),V=["流程信息","表单设计","模型设计","完成"],i=x(),v=x(),m=x(!1);ye(()=>[l.value,i.value],async()=>{var I;if(!l.value||!i.value)return;const{flowModuleId:$}=s.value,{flowDeployId:b}=s.value;try{m.value=!0;let W={};b?W=await F({flowDeployId:b}):$&&(W=await p({flowModuleId:$})),s.value=W.data,(I=v.value)!=null&&I.sort&&(v.value.sort.display=!s.value.flowDeployId)}finally{m.value=!1}},{immediate:!0});const{data:g}=ae(c).useList(),h=J(()=>{var $,b;return(b=($=g.value)==null?void 0:$.find(I=>I.tableName===s.value.formDataTable))==null?void 0:b.tableFields}),k=x(0);async function L($){k.value===0&&await Re(i),m.value=!0;const{flowModuleId:b}=s.value,{flowDeployId:I}=s.value;try{I?await y(s.value):b?await w(s.value):await r(s.value).then(W=>{s.value.flowModuleId=W.data.flowModuleId}),E.success("保存成功")}finally{m.value=!1}typeof $=="number"?k.value=$:k.value++}async function T(){await Z.confirm("发布新版本，是否确认？","提示",{type:"success"}),m.value=!0,_({flowModuleId:s.value.flowModuleId}).then(()=>{E.success("发布成功")}).finally(()=>{m.value=!1})}async function N(){await Z.confirm("流程定义的数据(包括流程信息、表单设计、流程设计)将被修改为当前版本的数据，是否确认？","提示",{type:"warning"}),await w(s.value),E.success("同步成功")}function U(){l.value=!1,k.value=0,s.value={},e("close")}return($,b)=>{const I=f("el-col"),W=f("el-step"),Ie=f("el-steps"),H=f("el-button"),xe=f("el-row"),Ne=f("avue-form"),Le=f("el-result"),Pe=f("el-dialog"),Ue=ge("loading");return D(),O(Pe,{modelValue:u(l),"onUpdate:modelValue":b[8]||(b[8]=S=>Q(l)?l.value=S:null),"show-close":!1,fullscreen:"","destroy-on-close":"",onClose:U},{header:t(()=>[n(xe,{justify:"center"},{default:t(()=>[n(I,{span:6},{default:t(()=>[X("div",gt,[bt,u(s).flowName?(D(),B("span",kt," - "+K(u(s).flowName),1)):M("",!0),u(s).version?(D(),B("span",Dt," - V"+K(u(s).version),1)):M("",!0),n(u(zt),{"form-data":u(s),"onUpdate:formData":b[0]||(b[0]=S=>Q(s)?s.value=S:null),"active-step":k.value},null,8,["form-data","active-step"])])]),_:1}),n(I,{span:12},{default:t(()=>[n(Ie,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:t(()=>[(D(),B(G,null,ee(V,(S,pe)=>n(W,{key:pe,title:S,style:{cursor:"pointer"},onClick:Wt=>L(pe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),n(I,{span:6,style:{"text-align":"right"}},{default:t(()=>[n(H,{disabled:k.value===0,loading:m.value,type:"primary",onClick:b[1]||(b[1]=S=>L(k.value-1))},{default:t(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),n(H,{disabled:k.value===V.length-1,loading:m.value,type:"primary",onClick:b[2]||(b[2]=S=>L(k.value+1))},{default:t(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),n(H,{loading:m.value,type:"success",onClick:b[3]||(b[3]=S=>L(k.value))},{default:t(()=>[C(" 保存 ")]),_:1},8,["loading"]),n(H,{onClick:U},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:t(()=>[be((D(),B("div",Ft,[k.value===0?(D(),O(Ne,{key:0,ref_key:"formRef",ref:i,modelValue:u(s),"onUpdate:modelValue":b[4]||(b[4]=S=>Q(s)?s.value=S:null),defaults:v.value,"onUpdate:defaults":b[5]||(b[5]=S=>v.value=S),option:u(Ke),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","defaults","option"])):M("",!0),k.value===1?(D(),O(u(ce),{key:1,modelValue:u(s).formOption,"onUpdate:modelValue":b[6]||(b[6]=S=>u(s).formOption=S),fields:h.value},null,8,["modelValue","fields"])):M("",!0),k.value===2?(D(),O(u(se),{key:2,modelValue:u(s).flowData,"onUpdate:modelValue":b[7]||(b[7]=S=>u(s).flowData=S),"flow-form-option":u(s).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),k.value===3?(D(),O(Le,{key:3,icon:"success",title:"流程设计完成"},{extra:t(()=>[u(s).flowDeployId?(D(),O(H,{key:0,type:"primary",onClick:N},{default:t(()=>[C(" 同步到流程定义 ")]),_:1})):M("",!0),u(s).flowDeployId?M("",!0):(D(),O(H,{key:1,type:"primary",onClick:T},{default:t(()=>[C(" 发布 ")]),_:1})),n(H,{onClick:U},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[Ue,m.value]])]),_:1},8,["modelValue"])}}}),Ct=X("span",null,"流程查看",-1),Ot={key:0},ht={key:1},$t=A({__name:"DesignView",props:{modelValue:{},visible:{type:Boolean}},setup(d){const a=re(d),{visible:o,modelValue:l}=a,{request:s}=P(),{getDetail:c}=oe(s),{getDetail:r}=de(s),_=x("form"),p=x(!1);ye(o,async F=>{if(!F)return;const{flowModuleId:y}=l.value,{flowDeployId:V}=l.value;try{p.value=!0;let i={};V?i=await r({flowDeployId:V}):y&&(i=await c({flowModuleId:y})),l.value={...i.data}}finally{p.value=!1}},{immediate:!0});function w(){l.value={},_.value="form"}return(F,y)=>{const V=f("el-tab-pane"),i=f("el-tabs"),v=f("el-dialog"),m=ge("loading");return D(),O(v,{modelValue:u(o),"onUpdate:modelValue":y[3]||(y[3]=g=>Q(o)?o.value=g:null),width:"60%",top:"5%",onClose:w},{header:t(()=>{var g,h,k,L;return[Ct,(g=u(l))!=null&&g.flowName?(D(),B("span",Ot," - "+K((h=u(l))==null?void 0:h.flowName),1)):M("",!0),(k=u(l))!=null&&k.version?(D(),B("span",ht," - V"+K((L=u(l))==null?void 0:L.version),1)):M("",!0)]}),default:t(()=>[be((D(),O(i,{modelValue:_.value,"onUpdate:modelValue":y[2]||(y[2]=g=>_.value=g)},{default:t(()=>[n(V,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:t(()=>[_.value==="form"&&u(l).formOption?(D(),O(u(ce),{key:0,modelValue:u(l).formOption,"onUpdate:modelValue":y[0]||(y[0]=g=>u(l).formOption=g),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),n(V,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:t(()=>[_.value==="flow"?(D(),O(u(se),{key:0,modelValue:u(l).flowData,"onUpdate:modelValue":y[1]||(y[1]=g=>u(l).flowData=g),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[m,p.value]])]),_:1},8,["modelValue"])}}}),Tt=A({__name:"index",setup(d){const e=x("definition"),a=x({}),o=x(""),l=x("");function s(i){o.value===i.id?o.value="":o.value=i.id}const c=x(!1),r=x(!1);function _(){a.value={},c.value=!0}function p(i){a.value=i,c.value=!0}function w(i){a.value=i,r.value=!0}function F(i){l.value=i.flowModuleId||"",e.value="deploy"}function y(){l.value="",e.value="definition"}async function V(){const i=e.value;await fe(),e.value="",await fe(),e.value=`${i}`}return(i,v)=>{const m=f("el-card"),g=f("el-col"),h=f("el-row");return D(),O(h,{gutter:20},{default:t(()=>[n(g,{span:6},{default:t(()=>[n(m,{header:"流程分类",style:{height:"100%"}},{default:t(()=>[n(yt,{onNodeClick:s})]),_:1})]),_:1}),n(g,{span:18},{default:t(()=>[e.value==="definition"?(D(),O($e,{key:0,"category-id":o.value,onAdd:_,onEdit:p,onView:w,onVersion:F},null,8,["category-id"])):M("",!0),e.value==="deploy"&&l.value?(D(),O(Te,{key:1,"flow-module-id":l.value,onEdit:p,onView:w,onBack:y},null,8,["flow-module-id"])):M("",!0),n(Vt,{modelValue:a.value,"onUpdate:modelValue":v[0]||(v[0]=k=>a.value=k),visible:c.value,"onUpdate:visible":v[1]||(v[1]=k=>c.value=k),onClose:V},null,8,["modelValue","visible"]),n($t,{modelValue:a.value,"onUpdate:modelValue":v[2]||(v[2]=k=>a.value=k),visible:r.value,"onUpdate:visible":v[3]||(v[3]=k=>r.value=k)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),It=A({__name:"index",setup(d){const e=dt("debugMode",!1),{request:a}=P(),{getTaskOpsList:o}=ft(a),{bindVal:l,getDataList:s,crudStateRefs:{searchForm:c}}=R({tableOption:ve,crudOption:{getList:o},searchForm:{status:ne.待办,taskNodeType:"userTask"},sortOption:{descs:"start_time"}});te(c,s,{debounce:300,immediate:!0,deep:!0});const{open:r,close:_}=le();function p(w){r({flowKey:w.flowKey,taskId:w.taskId,instanceId:w.flowInstanceId,debug:e.value,onComplete(){_(),E.success("操作成功"),s()}})}return(w,F)=>{const y=f("avue-radio"),V=f("el-switch"),i=f("el-button"),v=f("el-link"),m=f("avue-crud");return D(),O(m,j(z(u(l))),{"menu-left":t(()=>[n(y,{modelValue:u(c).taskNodeType,"onUpdate:modelValue":F[0]||(F[0]=g=>u(c).taskNodeType=g),dic:u(_e),button:""},null,8,["modelValue","dic"])]),"menu-right":t(()=>[n(i,{type:"text"},{default:t(()=>[n(V,{modelValue:u(e),"onUpdate:modelValue":F[1]||(F[1]=g=>Q(e)?e.value=g:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:t(({row:g})=>[n(v,{type:"primary",underline:!1,onClick:h=>p(g)},{default:t(()=>[C(K(g.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),xt=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,getDataList:o}=R({tableOption:je,crudOption:we(e)});return o(),(l,s)=>{const c=f("avue-crud");return D(),O(c,j(z(u(a))),null,16)}}}),Nt={class:"flow-list"},Lt=["onClick"],Pt={class:"flow-name"},Ut=A({__name:"index",setup(d){const{request:e}=P(),{useList:a}=Fe(e),{usePublishList:o,getTaskList:l}=ze(e),{data:s}=a(),{data:c}=o(),r=J(()=>{var i;return(i=s.value)==null?void 0:i.map(v=>{var g;const m=((g=c.value)==null?void 0:g.filter(h=>h.categoryId===v.id))??[];return{...v,list:m}}).filter(v=>{var m;return(m=v.list)==null?void 0:m.length})}),{bindVal:_,getDataList:p,crudStateRefs:{searchForm:w}}=R({tableOption:ve,crudOption:{getList:l},searchForm:{status:ne.待办,taskNodeType:"userTask"}});te(w,p,{debounce:300,immediate:!0,deep:!0});const{open:F,close:y}=le();function V(i){F({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,detail:i.taskId?i.status===ne.已办:!1,onComplete(){y(),E.success("操作成功"),p()}})}return(i,v)=>{const m=f("el-button"),g=f("el-divider"),h=f("el-collapse-item"),k=f("el-collapse"),L=f("el-card"),T=f("avue-radio"),N=f("el-link"),U=f("avue-crud");return D(),B(G,null,[n(L,{"body-style":{padding:"0 20px"}},{default:t(()=>[n(k,{"model-value":"1"},{default:t(()=>[n(h,{name:"1"},{title:t(()=>[n(m,{text:"",icon:"el-icon-promotion"},{default:t(()=>[C(" 发起审批 ")]),_:1})]),default:t(()=>[X("div",Nt,[(D(!0),B(G,null,ee(r.value,$=>(D(),B("div",{key:$.id,class:"flow-category"},[n(g,{"content-position":"left"},{default:t(()=>[C(K($.name),1)]),_:2},1024),(D(!0),B(G,null,ee($.list,b=>(D(),B("div",{key:b.flowKey,class:"flow-item",onClick:I=>V(b)},[n(u(Y),{class:"flow-icon",icon:b.flowIcon,width:"60"},null,8,["icon"]),X("div",Pt,K(b.flowName),1)],8,Lt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),n(g),n(U,j(z(u(_))),{"menu-left":t(()=>[n(T,{modelValue:u(w).taskNodeType,"onUpdate:modelValue":v[0]||(v[0]=$=>u(w).taskNodeType=$),dic:u(_e),button:""},null,8,["modelValue","dic"])]),processTitle:t(({row:$})=>[n(N,{type:"primary",underline:!1,onClick:b=>V($)},{default:t(()=>[C(K($.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Mt=Ze(Ut,[["__scopeId","data-v-f5375a1e"]]),St=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o},getDataList:l,handleUpdate:s}=R({tableOption:We,crudOption:Ce(e)});l();const c=x(!1);async function r(p){o.value=p,c.value=!0}async function _(){await s(o.value,Number.NaN,()=>c.value=!1,()=>{})}return(p,w)=>{const F=f("el-button"),y=f("avue-crud"),V=f("el-dialog");return D(),B(G,null,[n(y,j(z(u(a))),{menu:t(({row:i})=>[n(F,{type:"primary",text:"",icon:"el-icon-crop",onClick:v=>r(i)},{default:t(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(V,{modelValue:c.value,"onUpdate:modelValue":w[2]||(w[2]=i=>c.value=i),title:`模型设计-${u(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:t(()=>[n(F,{type:"primary",onClick:_},{default:t(()=>[C(" 保存 ")]),_:1}),n(F,{onClick:w[1]||(w[1]=i=>c.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1})]),default:t(()=>[n(se,{modelValue:u(o).flowData,"onUpdate:modelValue":w[0]||(w[0]=i=>u(o).flowData=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),ce=A({__name:"FormDesignWrapper",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(d,{emit:e}){var _;const a=d,{FormDesign:o}=P(),l=J({get(){return a.modelValue?nt(a.modelValue):{menuBtn:!1,span:24}},set(p){e("update:modelValue",st(p,{useJson5:!1}))}}),s=J(()=>a.fields?JSON.parse(a.fields):[]),c=J(()=>{const p={type:"select",dicData:s.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return w=>{const F=it(w);return[{...p,props:{label:"name",value:"name",desc:"comment"}},{...p,props:{label:"comment",value:"comment",desc:"name"}},...Array.from({length:((F==null?void 0:F.length)??0)-2}).fill({}).concat({label:"样式类",prop:"class"})]}}),r={form:{settings:Array.from({length:((_=at.settings)==null?void 0:_.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(p,w)=>{const F=f("avue-form");return p.view?(D(),O(F,{key:0,class:Qe(l.value.class),"model-value":{},option:l.value},null,8,["class","option"])):(D(),O(u(o),{key:1,modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),"base-option":c.value,resources:r},null,8,["modelValue","base-option"]))}}}),At=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o},getDataList:l,handleUpdate:s}=R({tableOption:He,crudOption:Oe(e)});l();const c=x(!1);async function r(p){o.value={...p},c.value=!0}async function _(){await s(o.value,Number.NaN,()=>c.value=!1,()=>{})}return(p,w)=>{const F=f("el-button"),y=f("avue-crud"),V=f("el-dialog");return D(),B(G,null,[n(y,j(z(u(a))),{menu:t(({row:i})=>[n(F,{type:"primary",text:"",icon:"el-icon-crop",onClick:v=>r(i)},{default:t(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(V,{modelValue:c.value,"onUpdate:modelValue":w[2]||(w[2]=i=>c.value=i),title:`表单设计-${u(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:t(()=>[n(F,{type:"primary",onClick:_},{default:t(()=>[C(" 保存 ")]),_:1}),n(F,{onClick:w[1]||(w[1]=i=>c.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1})]),default:t(()=>[n(ce,{modelValue:u(o).formOption,"onUpdate:modelValue":w[0]||(w[0]=i=>u(o).formOption=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Bt=X("br",null,null,-1),Et=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o,defaults:l},getDataList:s,afterOpen:c,beforeSubmit:r}=R({crudOption:ae(e),tableOption:Je});s();const{data:_}=we(e).useParam("table.default.fields");c(v=>{if(o.value.defaultFields=_.value??[],v==="edit"){const m=JSON.parse(o.value.tableFields);o.value.editFields=mt(m,_.value??[],"name")}}),r(v=>{const m=[...v.defaultFields,...v.editFields];v.tableFields=JSON.stringify(m)});const p=x(!1);ie(()=>{var v;(v=l.value)!=null&&v.defaultFields&&(l.value.defaultFields.display=p.value)});const{deploy:w,getFields:F}=ae(e),y=x(!1);async function V(v){await Z.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),y.value=!0,w({id:v.id}).then(()=>{E.success("部署成功"),s()}).finally(()=>{y.value=!1})}function i(){F({tableName:o.value.tableName}).then(v=>{var m;if(!((m=v.data)!=null&&m.length))return E.warning("未找到该表");o.value.editFields=v.data})}return(v,m)=>{const g=f("el-button"),h=f("el-input"),k=f("el-switch"),L=f("el-tooltip"),T=f("avue-crud");return D(),O(T,j(z(u(a))),{menu:t(({row:N})=>[n(g,{type:"text",icon:"el-icon-upload",onClick:U=>V(N)},{default:t(()=>[C(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":t(()=>[n(h,{modelValue:u(o).tableName,"onUpdate:modelValue":m[0]||(m[0]=N=>u(o).tableName=N),placeholder:"请输入 表名"},{append:t(()=>[n(g,{type:"primary",size:"default",onClick:i},{default:t(()=>[C(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":t(()=>[X("div",null,[C(" 数据库字段 "),Bt,n(L,{content:"显示默认字段"},{default:t(()=>[n(k,{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=N=>p.value=N)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Kt=A({__name:"index",setup(d){const e=ct(),a=x({}),{FlowForm:o}=P(),l=J(()=>{const c=a.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${c==null?void 0:c.title}`:e.instanceId||e.taskId?`办理流程：${c==null?void 0:c.title}`:`发起流程：${c==null?void 0:c.title}`});pt(l);async function s(c){window.postMessage({event:"onComplete",data:{...c}})}return(c,r)=>(D(),O(u(o),ke({flowDetail:a.value,"onUpdate:flowDetail":r[0]||(r[0]=_=>a.value=_)},u(e),{onComplete:s}),null,16,["flowDetail"]))}}),Rt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:wt,PageFlowDefinition:$e,PageFlowDeploy:Te,PageFlowForm:Kt,PageFlowManage:Tt,PageFlowOps:It,PageFlowParam:xt,PageFlowTemplate:St,PageFlowWorkbench:Mt,PageFormTemplate:At,PageTableTemplate:Et},Symbol.toStringTag,{value:"Module"})),jt={key:1},zt=A({__name:"TemplateSelect",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(d){const e=d,{formData:a,activeStep:o}=re(e),{request:l}=P(),{getDetail:s,useList:c}=oe(l),{data:r}=Oe(l).useList(),{data:_}=Ce(l).useList(),{data:p}=c(),w=J(()=>{var y,V,i,v;return(o==null?void 0:o.value)===1?[{label:"表单模板",value:"",type:"divider"},...((y=r.value)==null?void 0:y.map(m=>({label:m.formName,value:m.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((V=p.value)==null?void 0:V.map(m=>({label:m.flowName,value:m.flowModuleId,type:"definition"})))??[]]:(o==null?void 0:o.value)===2?[{label:"流程模板",value:"",type:"divider"},...((i=_.value)==null?void 0:i.map(m=>({label:m.flowName,value:m.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((v=p.value)==null?void 0:v.map(m=>({label:m.flowName,value:m.flowModuleId,type:"definition"})))??[]]:[]});async function F(y){if((o==null?void 0:o.value)===1){if(y.type==="template")a.value.formOption=y.value;else if(y.type==="definition"){const V=await s({flowModuleId:y.value});a.value.formOption=V.data.formOption}}else if((o==null?void 0:o.value)===2){if(y.type==="template")a.value.flowData=y.value;else if(y.type==="definition"){const V=await s({flowModuleId:y.value});a.value.flowData=V.data.flowData}}}return(y,V)=>{const i=f("Icon"),v=f("el-button"),m=f("el-divider"),g=f("el-dropdown-item"),h=f("el-scrollbar"),k=f("el-dropdown-menu"),L=f("el-dropdown");return w.value.length?(D(),O(L,{key:0},{dropdown:t(()=>[n(k,null,{default:t(()=>[n(h,{"max-height":"600px"},{default:t(()=>[(D(!0),B(G,null,ee(w.value,T=>(D(),O(g,ke({key:T.label},T,{disabled:T.type==="divider",onClick:N=>F(T)}),{default:t(()=>[T.type==="divider"?(D(),O(m,{key:0},{default:t(()=>[C(K(T.label),1)]),_:2},1024)):(D(),B("span",jt,K(T.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:t(()=>[n(v,{text:"",type:"primary",underline:!1},{default:t(()=>[C(" 选择模板 "),n(i,{icon:"ep:arrow-down"})]),_:1})]),_:1})):M("",!0)}}}),Ro={install(d,e){P(e),Object.entries(Rt).forEach(([a,o])=>{d.component(a,o)})}};export{Wo as ApprovalForm,Ho as ApprovalTree,Jo as ButtonList,Me as CONFIG_DEFAULT,yt as CategoryTree,Go as CommonComments,Vt as DesignSteps,$t as DesignView,Xo as FieldType,Zo as FlowButtonApproval,Qo as FlowButtonDisplay,Yo as FlowButtonKey,qo as FlowButtonStatus,el as FlowButtonType,se as FlowDesignWrapper,tl as FlowForm,ol as FlowStatus,ll as FlowTrack,ce as FormDesignWrapper,al as HandleType,nl as InternalForm,Ve as IsMainVersion,wt as PageFlowButton,$e as PageFlowDefinition,Te as PageFlowDeploy,Kt as PageFlowForm,Tt as PageFlowManage,It as PageFlowOps,xt as PageFlowParam,St as PageFlowTemplate,Mt as PageFlowWorkbench,At as PageFormTemplate,Et as PageTableTemplate,sl as TablePrimary,ne as TaskStatus,zt as TemplateSelect,il as UploadTable,ul as Whether,Re as asyncValidate,Ro as default,rl as defineTableOption,Ke as designFormOption,dl as fieldTypeDic,cl as flowFormEmits,pl as flowFormProps,ml as injectionKey,fl as isMobile,vl as mergeColumn,_l as tablePrimaryDic,_e as taskNodeTypeDic,wl as useButtonHandler,yl as useCommonCommentApi,P as useConfigProvider,gl as useEmitter,Ae as useFlowButtonApi,Fe as useFlowCategoryApi,oe as useFlowDefinitionApi,de as useFlowDeployApi,bl as useFlowFileApi,le as useFlowForm,_t as useFlowFormOverlay,vt as useFlowFormWindow,ft as useFlowOpsApi,we as useFlowParamApi,ze as useFlowTaskApi,Ce as useFlowTemplateApi,kl as useFlowUserApi,Dl as useFormDefaults,Oe as useFormTemplateApi,Fl as useInjectState,Vl as useProvideState,ae as useTableTemplateApi,Cl as whetherDic};
