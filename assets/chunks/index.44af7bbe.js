import{c as L,C as Se,t as Be,d as Ae,e as Ee,f as Re,g as ne,h as Ke,F as se,b as ze,i as je,T as q,j as We,k as _e,l as Je,m as Ge,n as He,o as Qe,p as Xe}from"./mobile.2440c6ac.js";import{K as Mo,L as So,D as Bo,w as Ao,v as Eo,s as Ro,x as Ko,r as zo,_ as jo,z as Wo,H as Jo,N as Go,B as Ho,O as Qo,W as Xo,E as Yo,I as Zo,S as qo,R as el,M as tl,U as ol,X as ll,J as al,P as nl,q as sl,Q as il,y as ul,A as rl,a as dl,u as cl,V as pl,G as ml}from"./mobile.2440c6ac.js";import{h as T,a5 as me,al as Ye,D as Ze,d as N,J as v,b as O,w as o,a9 as K,aa as z,l as m,o as b,N as n,a as F,t as A,A as ie,B as Q,g as W,n as qe,c as P,L as ee,R as we,K as J,e as M,z as ye,am as ge,k as G,a7 as be,E as fe,_ as et}from"./framework.a13ec59b.js";import"./index.013eb64a.js";import{s as tt}from"./index.386fc70b.js";import{m as ue}from"./merge.cdc37a6d.js";import{a as ke}from"./omitBy.3ba6179f.js";import{a as ot}from"./snakeCase.460e73b5.js";import{u as lt}from"./Uint8Array.9b4f3e17.js";import{i as at}from"./pickBy.7042e009.js";import{E as nt,a as st}from"../app.bc820d75.js";import{u as R,e as it}from"./index.662af1e4.js";import{u as te}from"./index.es.bd4305ee.js";import{I as X}from"./iconify.4cf0302a.js";import"./index.861a3681.js";import"./data.3a7fc5d1.js";import"./index.722b7181.js";import{j as ut,c as rt}from"./tree.9b5eb098.js";import"./vuedraggable.umd.34b59ae3.js";import{a as Y,E}from"./index.11c61ab2.js";import{p as Ve}from"./pick.d171649b.js";import{w as oe,a as re,u as dt,b as ct,c as pt}from"./index.f1ae53c3.js";import{f as mt}from"./form.7fc4689d.js";import{d as ft}from"./zipWith.3aba0508.js";import"./index.d8aaa0c2.js";import"./cloneDeep.0addb388.js";import"./initCloneObject.bffa9b07.js";import"./getTag.bbaab4d0.js";import"./config.ec43eb9b.js";import"./get.8a71353d.js";import"./basePickBy.d4166d32.js";import"./set.f28c7d85.js";import"./createCompounder.39cbc467.js";import"./theme.47b13fde.js";import"./index.vue_vue_type_script_setup_true_lang.28a5e00c.js";import"./index.c3b49629.js";import"./index.349087e2.js";import"./isEqual.3088a5af.js";import"./union.d42d3f09.js";import"./kebabCase.99797389.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-bundler.45c8764c.js";function De(d){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},r=f=>d.get(e.list,{params:f});return{getList:r,useList:()=>te(()=>r({size:-1}).then(f=>f.data)),getTree:f=>d.get(e.tree,{params:f}),create:f=>d.post(e.save,f),update:f=>d.post(e.update,f),remove:f=>d.post(e.remove,{},{params:{ids:f}})}}function le(d){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},r=c=>d.get(e.list,{params:c});return{url:e,getList:r,useList:()=>te(()=>r({size:-1}).then(c=>c.data.records)),create:c=>d.post(e.save,c),update:c=>d.post(e.update,c),remove:c=>d.post(e.remove,{},{params:{ids:c}}),deploy:c=>d.post(e.deploy,c),getDetail:c=>d.get(e.detail,{params:c})}}var Fe=(d=>(d[d.否=0]="否",d[d.是=1]="是",d))(Fe||{});function de(d){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:i=>d.get(e.list,{params:i}),getDetail:i=>d.get(e.detail,{params:i}),update:i=>d.post(e.update,i),remove:i=>d.post(e.remove,{},{params:{ids:i}})}}function vt(d){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>d.get(e.list,{params:t})}}function he(d){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},r=p=>d.get(e.list,{params:p});return{url:e,getList:r,useList:()=>te(()=>r({size:-1}).then(p=>p.data.records)),create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}})}}function Ce(d){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},r=p=>d.get(e.list,{params:p});return{url:e,getList:r,useList:()=>te(()=>r({size:-1}).then(p=>p.data.records)),create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}})}}function Oe(d,e){return e in(Se.useFlowFormOptions??{})}function $e(d={}){const{useFlowFormOptions:e}=L(),r=ue({...e},{...d});switch(r==null?void 0:r.type){case"window":return _t(r);case"dialog":case"drawer":return wt(r);default:return{open:t=>{},close:()=>{}}}}function _t(d={}){const e=T(null);return{open:(a={})=>{var y;const s=ue({...d},{...a}),{window:[i,p,f]=[]}=s,c=`${i}?${tt(ke(s,ot(lt,at,Oe)))}`;e.value=window.open(c,p,f),(y=e.value)==null||y.addEventListener("message",k=>{const{event:_,data:g}=k.data,u=a[_];typeof u=="function"&&u(g)})},close:()=>{var a;return(a=e.value)==null?void 0:a.close()},openedWindow:e}}function wt(d={}){const{appContext:e}=Ze(),{FlowForm:r}=L();let t,a;const s=p=>{t=document.createElement("div"),t.className="flow-form-wrapper";const f=ue({...d},{...p}),c=me(r,ke(f,Oe));a=me(f.type==="dialog"?nt:st,{class:"flow-form-overlay",modelValue:!0,onClose:i,...f.overlay},c),a.appContext=e,Ye(a,t),document.body.appendChild(t)},i=()=>{var p,f;(f=(p=a==null?void 0:a.component)==null?void 0:p.props)!=null&&f.modelValue&&(a.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:s,close:i}}const yt=N({__name:"index",setup(d){const{request:e}=L(),{bindVal:r,crudStateRefs:{formData:t},getDataList:a}=R({tableOption:Be,crudOption:Ae(e),sortOption:{ascs:"sort"}});return a(),(s,i)=>{const p=v("el-button"),f=v("avue-crud");return b(),O(f,K(z(m(r))),{icon:o(({row:c})=>[n(m(X),{icon:c.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:c})=>[n(p,{type:c.buttonType},{default:o(()=>[n(m(X),{icon:c.icon},null,8,["icon"]),F(" "+A(c.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[n(p,{type:m(t).buttonType},{default:o(()=>[n(m(X),{icon:m(t).icon},null,8,["icon"]),F(" "+A(m(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ie=N({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(d,{emit:e}){const r=d,{request:t}=L(),{getList:a,deploy:s,update:i,remove:p}=le(t),{bindVal:f,crudStateRefs:{searchForm:c},getDataList:y}=R({tableOption:Ee,crudOption:{getList:a,remove:p},searchForm:{categoryId:r.categoryId}});ie(()=>{c.value.categoryId=r.categoryId??""}),oe(c,y,{debounce:300,immediate:!0,deep:!0});const k=T(!1);async function _(l){await Y.confirm("发布新版本，是否确认？","提示",{type:"success"}),k.value=!0,s({flowModuleId:l.flowModuleId}).then(()=>{E.success("发布成功"),y()}).finally(()=>{k.value=!1})}async function g(l){if(l.mainVersion)return E.warning("请先删除已发布的流程");await Y.confirm("确认删除？","提示",{type:"warning"}),await p(l.flowModuleId),E.success("删除成功"),y()}function u(l){i(Ve(l,["flowModuleId","sort"]))}return(l,w)=>{const D=v("el-button"),V=v("el-dropdown-item"),$=v("el-input-number"),h=v("avue-crud");return b(),O(h,K(z(m(f))),{"menu-left":o(()=>[n(D,{type:"primary",icon:"el-icon-plus",onClick:w[0]||(w[0]=C=>e("add"))},{default:o(()=>[F(" 新增 ")]),_:1})]),"menu-btn":o(({row:C})=>[n(V,{icon:"el-icon-view",onClick:I=>e("view",C)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),n(V,{icon:"el-icon-edit",onClick:I=>e("edit",C)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),n(V,{icon:"el-icon-delete",onClick:I=>g(C)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),n(V,{icon:"el-icon-upload",onClick:I=>_(C)},{default:o(()=>[F(" 发布 ")]),_:2},1032,["onClick"]),n(V,{icon:"el-icon-switch",onClick:I=>e("version",C)},{default:o(()=>[F(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:C})=>[n(m(X),{icon:C.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:C})=>[n($,{modelValue:C.sort,"onUpdate:modelValue":I=>C.sort=I,"controls-position":"right",style:{width:"100%"},onChange:I=>u(C)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),xe=N({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(d,{emit:e}){const r=d,{request:t}=L(),{getList:a,update:s,remove:i}=de(t),{bindVal:p,crudStateRefs:{searchForm:f},getDataList:c}=R({tableOption:Re,crudOption:{getList:a,dataPath:"res.data"}});ie(()=>{f.value.flowModuleId=r.flowModuleId}),oe(f,c,{debounce:300,immediate:!0,deep:!0});const y=T(!1);async function k(u){await Y.confirm(`确定将 ${u.flowName}(${u.flowKey}:v${u.version}) 设为主版本?`,"提示",{type:"warning"}),y.value=!0,s({flowDeployId:u.flowDeployId,flowModuleId:u.flowModuleId,mainVersion:1}).then(()=>{E.success("设置成功"),c()}).finally(()=>{y.value=!1})}async function _(u){const{value:l}=await Y.prompt("请输入确认删除的流程标识","提示",{type:"warning"});l===u.flowKey&&(await i(u.flowDeployId),E.success("删除成功"),c())}function g(u){s(Ve(u,["flowDeployId","flowModuleId","sort"]))}return(u,l)=>{const w=v("el-button"),D=v("el-dropdown-item"),V=v("el-input-number"),$=v("avue-crud");return b(),O($,K(z(m(p))),{"menu-left":o(()=>[n(w,{loading:y.value,type:"primary",icon:"el-icon-arrow-left",onClick:l[0]||(l[0]=h=>e("back"))},{default:o(()=>[F(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:h})=>[n(D,{icon:"el-icon-view",onClick:C=>e("view",h)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),n(D,{icon:"el-icon-edit",onClick:C=>e("edit",h)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),n(D,{icon:"el-icon-delete",onClick:C=>_(h)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),n(D,{icon:"el-icon-switch",disabled:h.mainVersion===m(Fe).是,onClick:C=>k(h)},{default:o(()=>[F(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:h})=>[n(m(X),{icon:h.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:h})=>[n(V,{modelValue:h.sort,"onUpdate:modelValue":C=>h.sort=C,"controls-position":"right",style:{width:"100%"},onChange:C=>g(h)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),ve={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},gt=N({__name:"index",emits:["node-click"],setup(d,{emit:e}){const{request:r}=L(),{crudStateRefs:{formData:t,tableData:a},getDataList:s,handleSave:i,handleUpdate:p,handleDel:f}=R({crudOption:{rowKey:"id",...De(r),dataPath:"res.data"},tableOption:ve,pageOption:{pageSize:20}});s();function c(_,g,u,l){i(g,u,l)}function y(_,g,u,l){p(g,Number.NaN,u,l)}async function k(_,g){await f(_.data,Number.NaN),g()}return(_,g)=>{const u=v("avue-tree");return b(),O(u,{modelValue:m(t),"onUpdate:modelValue":g[0]||(g[0]=l=>Q(t)?t.value=l:null),option:m(ve),data:m(a),onNodeClick:g[1]||(g[1]=l=>e("node-click",l)),onSave:c,onUpdate:y,onDel:k},null,8,["modelValue","option","data"])}}}),ce=N({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(d,{emit:e}){var f;const r=d,{FormDesign:t}=L(),a=W({get(){return r.modelValue?ut(r.modelValue):{menuBtn:!1,span:24}},set(c){e("update:modelValue",rt(c,{useJson5:!1}))}}),s=W(()=>r.fields?JSON.parse(r.fields):[]),i=W(()=>{const c={type:"select",dicData:s.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...c,props:{label:"name",value:"name",desc:"comment"}},{...c,props:{label:"comment",value:"comment",desc:"name"}}]}),p={form:{settings:Array.from({length:((f=mt.settings)==null?void 0:f.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(c,y)=>{const k=v("avue-form");return c.view?(b(),O(k,{key:0,class:qe(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(b(),O(m(t),{key:1,modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=_=>a.value=_),"base-option":i.value,resources:p},null,8,["modelValue","base-option"]))}}}),bt={key:1},kt=N({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(d){const e=d,{formData:r,activeStep:t}=re(e),{request:a}=L(),{getDetail:s,useList:i}=le(a),{data:p}=Ce(a).useList(),{data:f}=he(a).useList(),{data:c}=i(),y=W(()=>{var _,g,u,l;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((_=p.value)==null?void 0:_.map(w=>({label:w.formName,value:w.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((g=c.value)==null?void 0:g.map(w=>({label:w.flowName,value:w.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((u=f.value)==null?void 0:u.map(w=>({label:w.flowName,value:w.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((l=c.value)==null?void 0:l.map(w=>({label:w.flowName,value:w.flowModuleId,type:"definition"})))??[]]:[]});async function k(_){if((t==null?void 0:t.value)===1){if(_.type==="template")r.value.formOption=_.value;else if(_.type==="definition"){const g=await s({flowModuleId:_.value});r.value.formOption=g.data.formOption}}else if((t==null?void 0:t.value)===2){if(_.type==="template")r.value.flowData=_.value;else if(_.type==="definition"){const g=await s({flowModuleId:_.value});r.value.flowData=g.data.flowData}}}return(_,g)=>{const u=v("el-link"),l=v("el-divider"),w=v("el-dropdown-item"),D=v("el-scrollbar"),V=v("el-dropdown-menu"),$=v("el-dropdown");return y.value.length?(b(),O($,{key:0},{dropdown:o(()=>[n(V,null,{default:o(()=>[n(D,{"max-height":"600px"},{default:o(()=>[(b(!0),P(J,null,ee(y.value,h=>(b(),O(w,we({key:h.label},h,{disabled:h.type==="divider",onClick:C=>k(h)}),{default:o(()=>[h.type==="divider"?(b(),O(l,{key:0},{default:o(()=>[F(A(h.label),1)]),_:2},1024)):(b(),P("span",bt,A(h.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[n(u,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[F(" 选择模板 ")]),_:1})]),_:1})):M("",!0)}}}),Vt=G("span",null,"流程设计",-1),Dt={key:0},Ft={key:1},ht={style:{height:"calc(100vh - 144px)"}},Ct=N({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(d,{emit:e}){const t=re(d),{visible:a,modelValue:s}=t,{request:i}=L(),{create:p,deploy:f,getDetail:c,update:y}=le(i),{getDetail:k,update:_}=de(i),g=["流程信息","表单设计","模型设计","完成"],u=T(),l=T(!1);ye(()=>[a.value,u.value],async()=>{if(!a.value||!u.value)return;const{flowModuleId:I}=s.value,{flowDeployId:x}=s.value;try{l.value=!0;let S={};x?S=await k({flowDeployId:x}):I&&(S=await c({flowModuleId:I})),s.value=S.data}finally{l.value=!1}},{immediate:!0});const{data:w}=ne(i).useList(),D=W(()=>{var I,x;return(x=(I=w.value)==null?void 0:I.find(S=>S.tableName===s.value.formDataTable))==null?void 0:x.tableFields}),V=T(0);async function $(I){V.value===0&&await ze(u),l.value=!0;const{flowModuleId:x}=s.value,{flowDeployId:S}=s.value;try{S?await _(s.value):x?await y(s.value):await p(s.value).then(B=>{s.value.flowModuleId=B.data.flowModuleId}),E.success("保存成功")}finally{l.value=!1}typeof I=="number"?V.value=I:V.value++}async function h(){await Y.confirm("发布新版本，是否确认？","提示"),l.value=!0,f({flowModuleId:s.value.flowModuleId}).then(()=>{E.success("发布成功")}).finally(()=>{l.value=!1})}function C(){a.value=!1,V.value=0,s.value={},e("close")}return(I,x)=>{const S=v("el-col"),B=v("el-step"),j=v("el-steps"),H=v("el-button"),Te=v("el-row"),Le=v("avue-form"),Ne=v("el-result"),Pe=v("el-dialog"),Ue=ge("loading");return b(),O(Pe,{modelValue:m(a),"onUpdate:modelValue":x[6]||(x[6]=U=>Q(a)?a.value=U:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:C},{header:o(()=>[n(Te,{justify:"center"},{default:o(()=>[n(S,{span:5},{default:o(()=>{var U,Z,ae,pe;return[G("div",null,[Vt,(U=m(s))!=null&&U.flowName?(b(),P("span",Dt," - "+A((Z=m(s))==null?void 0:Z.flowName),1)):M("",!0),(ae=m(s))!=null&&ae.version?(b(),P("span",Ft," - V"+A((pe=m(s))==null?void 0:pe.version),1)):M("",!0)]),n(kt,{"form-data":m(s),"onUpdate:formData":x[0]||(x[0]=Me=>Q(s)?s.value=Me:null),"active-step":V.value},null,8,["form-data","active-step"])]}),_:1}),n(S,{span:14},{default:o(()=>[n(j,{active:V.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(b(),P(J,null,ee(g,(U,Z)=>n(B,{key:Z,title:U,style:{cursor:"pointer"},onClick:ae=>$(Z)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),n(S,{span:5,style:{"text-align":"right"}},{default:o(()=>[n(H,{disabled:V.value===0,loading:l.value,type:"primary",onClick:x[1]||(x[1]=U=>V.value--)},{default:o(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),n(H,{disabled:V.value===g.length-1,type:"primary",loading:l.value,onClick:x[2]||(x[2]=U=>$())},{default:o(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),n(H,{onClick:C},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[be((b(),P("div",ht,[V.value===0?(b(),O(Le,{key:0,ref_key:"formRef",ref:u,modelValue:m(s),"onUpdate:modelValue":x[3]||(x[3]=U=>Q(s)?s.value=U:null),option:m(Ke),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):M("",!0),V.value===1?(b(),O(ce,{key:1,modelValue:m(s).formOption,"onUpdate:modelValue":x[4]||(x[4]=U=>m(s).formOption=U),fields:D.value},null,8,["modelValue","fields"])):M("",!0),V.value===2?(b(),O(se,{key:2,modelValue:m(s).flowData,"onUpdate:modelValue":x[5]||(x[5]=U=>m(s).flowData=U),"flow-form-option":m(s).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),V.value===3?(b(),O(Ne,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[m(s).flowDeployId?M("",!0):(b(),O(H,{key:0,type:"primary",onClick:h},{default:o(()=>[F(" 发布 ")]),_:1})),n(H,{onClick:C},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[Ue,l.value]])]),_:1},8,["modelValue"])}}}),Ot=G("span",null,"流程查看",-1),$t={key:0},It={key:1},xt=N({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(d){const r=re(d),{visible:t,modelValue:a}=r,{request:s}=L(),{getDetail:i}=le(s),{getDetail:p}=de(s),f=T("form"),c=T(!1);ye(t,async k=>{if(!k)return;const{flowModuleId:_}=a.value,{flowDeployId:g}=a.value;try{c.value=!0;let u={};g?u=await p({flowDeployId:g}):_&&(u=await i({flowModuleId:_})),a.value={...u.data}}finally{c.value=!1}},{immediate:!0});function y(){a.value={},f.value="form"}return(k,_)=>{const g=v("el-tab-pane"),u=v("el-tabs"),l=v("el-dialog"),w=ge("loading");return b(),O(l,{modelValue:m(t),"onUpdate:modelValue":_[3]||(_[3]=D=>Q(t)?t.value=D:null),width:"60%",top:"0",onClose:y},{header:o(()=>{var D,V,$,h;return[Ot,(D=m(a))!=null&&D.flowName?(b(),P("span",$t," - "+A((V=m(a))==null?void 0:V.flowName),1)):M("",!0),($=m(a))!=null&&$.version?(b(),P("span",It," - V"+A((h=m(a))==null?void 0:h.version),1)):M("",!0)]}),default:o(()=>[be((b(),O(u,{modelValue:f.value,"onUpdate:modelValue":_[2]||(_[2]=D=>f.value=D)},{default:o(()=>[n(g,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[f.value==="form"&&m(a).formOption?(b(),O(ce,{key:0,modelValue:m(a).formOption,"onUpdate:modelValue":_[0]||(_[0]=D=>m(a).formOption=D),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),n(g,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[f.value==="flow"?(b(),O(se,{key:0,modelValue:m(a).flowData,"onUpdate:modelValue":_[1]||(_[1]=D=>m(a).flowData=D),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[w,c.value]])]),_:1},8,["modelValue"])}}}),Tt=N({__name:"index",setup(d){const e=T("definition"),r=T({}),t=T(""),a=T("");function s(u){t.value===u.id?t.value="":t.value=u.id}const i=T(!1),p=T(!1);function f(){r.value={},i.value=!0}function c(u){r.value=u,i.value=!0}function y(u){r.value=u,p.value=!0}function k(u){a.value=u.flowModuleId||"",e.value="deploy"}function _(){a.value="",e.value="definition"}async function g(){const u=e.value;await fe(),e.value="",await fe(),e.value=`${u}`}return(u,l)=>{const w=v("el-card"),D=v("el-col"),V=v("el-row");return b(),O(V,{gutter:20},{default:o(()=>[n(D,{span:6},{default:o(()=>[n(w,{header:"流程分类",style:{height:"100%"}},{default:o(()=>[n(gt,{onNodeClick:s})]),_:1})]),_:1}),n(D,{span:18},{default:o(()=>[e.value==="definition"?(b(),O(Ie,{key:0,"category-id":t.value,onAdd:f,onEdit:c,onView:y,onVersion:k},null,8,["category-id"])):M("",!0),e.value==="deploy"&&a.value?(b(),O(xe,{key:1,"flow-module-id":a.value,onEdit:c,onView:y,onBack:_},null,8,["flow-module-id"])):M("",!0),n(Ct,{modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=$=>r.value=$),visible:i.value,"onUpdate:visible":l[1]||(l[1]=$=>i.value=$),onClose:g},null,8,["modelValue","visible"]),n(xt,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=$=>r.value=$),visible:p.value,"onUpdate:visible":l[3]||(l[3]=$=>p.value=$)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Lt=N({__name:"index",setup(d){const e=dt("debugMode",!1),{request:r}=L(),{getTaskOpsList:t}=vt(r),{bindVal:a,getDataList:s,crudStateRefs:{searchForm:i}}=R({tableOption:je,crudOption:{getList:t},searchForm:{status:q.待办},sortOption:{descs:"start_time"}});oe(i,s,{debounce:300,immediate:!0,deep:!0});const{open:p,close:f}=$e();function c(y){p({flowKey:y.flowKey,taskId:y.taskId,instanceId:y.flowInstanceId,debug:e.value,onComplete(){f(),E.success("操作成功"),s()}})}return(y,k)=>{const _=v("el-switch"),g=v("el-button"),u=v("el-link"),l=v("avue-crud");return b(),O(l,K(z(m(a))),{"menu-right":o(()=>[n(g,{type:"text"},{default:o(()=>[n(_,{modelValue:m(e),"onUpdate:modelValue":k[0]||(k[0]=w=>Q(e)?e.value=w:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:w})=>[n(u,{type:"primary",underline:!1,onClick:D=>c(w)},{default:o(()=>[F(A(w.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),Nt=N({__name:"index",setup(d){const{request:e}=L(),{bindVal:r,getDataList:t}=R({tableOption:We,crudOption:_e(e)});return t(),(a,s)=>{const i=v("avue-crud");return b(),O(i,K(z(m(r))),null,16)}}}),Pt={class:"flow-list"},Ut=["onClick"],Mt={class:"flow-name"},St=N({__name:"index",setup(d){const{request:e}=L(),{useList:r}=De(e),{usePublishList:t,getTaskList:a}=Ge(e),{data:s}=r(),{data:i}=t(),p=W(()=>{var l;return(l=s.value)==null?void 0:l.map(w=>{var V;const D=((V=i.value)==null?void 0:V.filter($=>$.categoryId===w.id))??[];return{...w,list:D}}).filter(w=>{var D;return(D=w.list)==null?void 0:D.length})}),f=it(q).filter((l,w)=>w<2).reverse(),{bindVal:c,getDataList:y,crudStateRefs:{searchForm:k}}=R({tableOption:Je,crudOption:{getList:a},searchForm:{status:q.待办}});oe(k,y,{debounce:300,immediate:!0,deep:!0});const{open:_,close:g}=$e();function u(l){_({flowKey:l.flowKey,taskId:l.taskId,instanceId:l.flowInstanceId,detail:l.taskId?l.status===q.已办:!1,onComplete(){g(),E.success("操作成功"),y()}})}return(l,w)=>{const D=v("el-button"),V=v("el-divider"),$=v("el-collapse-item"),h=v("el-collapse"),C=v("el-card"),I=v("avue-radio"),x=v("el-link"),S=v("avue-crud");return b(),P(J,null,[n(C,{"body-style":{padding:"0 20px"}},{default:o(()=>[n(h,{"model-value":"1"},{default:o(()=>[n($,{name:"1"},{title:o(()=>[n(D,{text:"",icon:"el-icon-promotion"},{default:o(()=>[F(" 发起审批 ")]),_:1})]),default:o(()=>[G("div",Pt,[(b(!0),P(J,null,ee(p.value,B=>(b(),P("div",{key:B.id,class:"flow-category"},[n(V,{"content-position":"left"},{default:o(()=>[F(A(B.name),1)]),_:2},1024),(b(!0),P(J,null,ee(B.list,j=>(b(),P("div",{key:j.flowKey,class:"flow-item",onClick:H=>u(j)},[n(m(X),{class:"flow-icon",icon:j.flowIcon,width:"60"},null,8,["icon"]),G("div",Mt,A(j.flowName),1)],8,Ut))),128))]))),128))])]),_:1})]),_:1})]),_:1}),n(V),n(S,K(z(m(c))),{"menu-left":o(()=>[n(I,{modelValue:m(k).status,"onUpdate:modelValue":w[0]||(w[0]=B=>m(k).status=B),button:"",dic:m(f)},null,8,["modelValue","dic"])]),processTitle:o(({row:B})=>[n(x,{type:"primary",underline:!1,onClick:j=>u(B)},{default:o(()=>[F(A(B.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Bt=et(St,[["__scopeId","data-v-5341e962"]]),At=N({__name:"index",setup(d){const{request:e}=L(),{bindVal:r,crudStateRefs:{formData:t},getDataList:a,handleUpdate:s}=R({tableOption:He,crudOption:he(e)});a();const i=T(!1);async function p(c){t.value=c,i.value=!0}async function f(){await s(t.value,Number.NaN,()=>i.value=!1,()=>{})}return(c,y)=>{const k=v("el-button"),_=v("avue-crud"),g=v("el-dialog");return b(),P(J,null,[n(_,K(z(m(r))),{menu:o(({row:u})=>[n(k,{type:"primary",text:"",icon:"el-icon-crop",onClick:l=>p(u)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(g,{modelValue:i.value,"onUpdate:modelValue":y[2]||(y[2]=u=>i.value=u),title:`模型设计-${m(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(k,{type:"primary",onClick:f},{default:o(()=>[F(" 保存 ")]),_:1}),n(k,{onClick:y[1]||(y[1]=u=>i.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[n(se,{modelValue:m(t).flowData,"onUpdate:modelValue":y[0]||(y[0]=u=>m(t).flowData=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Et=N({__name:"index",setup(d){const{request:e}=L(),{bindVal:r,crudStateRefs:{formData:t},getDataList:a,handleUpdate:s}=R({tableOption:Qe,crudOption:Ce(e)});a();const i=T(!1);async function p(c){t.value={...c},i.value=!0}async function f(){await s(t.value,Number.NaN,()=>i.value=!1,()=>{})}return(c,y)=>{const k=v("el-button"),_=v("avue-crud"),g=v("el-dialog");return b(),P(J,null,[n(_,K(z(m(r))),{menu:o(({row:u})=>[n(k,{type:"primary",text:"",icon:"el-icon-crop",onClick:l=>p(u)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(g,{modelValue:i.value,"onUpdate:modelValue":y[2]||(y[2]=u=>i.value=u),title:`表单设计-${m(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(k,{type:"primary",onClick:f},{default:o(()=>[F(" 保存 ")]),_:1}),n(k,{onClick:y[1]||(y[1]=u=>i.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[n(ce,{modelValue:m(t).formOption,"onUpdate:modelValue":y[0]||(y[0]=u=>m(t).formOption=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Rt=G("br",null,null,-1),Kt=N({__name:"index",setup(d){const{request:e}=L(),{bindVal:r,crudStateRefs:{formData:t,defaults:a},getDataList:s,afterOpen:i,beforeSubmit:p}=R({crudOption:ne(e),tableOption:Xe});s();const{data:f}=_e(e).useParam("table.default.fields");i(l=>{if(t.value.defaultFields=f.value??[],l==="edit"){const w=JSON.parse(t.value.tableFields);t.value.editFields=ft(w,f.value??[],"name")}}),p(l=>{const w=[...l.defaultFields,...l.editFields];l.tableFields=JSON.stringify(w)});const c=T(!1);ie(()=>{var l;(l=a.value)!=null&&l.defaultFields&&(a.value.defaultFields.display=c.value)});const{deploy:y,getFields:k}=ne(e),_=T(!1);async function g(l){await Y.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,y({id:l.id}).then(()=>{E.success("部署成功"),s()}).finally(()=>{_.value=!1})}function u(){k({tableName:t.value.tableName}).then(l=>{var w;if(!((w=l.data)!=null&&w.length))return E.warning("未找到该表");t.value.editFields=l.data})}return(l,w)=>{const D=v("el-button"),V=v("el-input"),$=v("el-switch"),h=v("el-tooltip"),C=v("avue-crud");return b(),O(C,K(z(m(r))),{menu:o(({row:I})=>[n(D,{type:"text",icon:"el-icon-upload",onClick:x=>g(I)},{default:o(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[n(V,{modelValue:m(t).tableName,"onUpdate:modelValue":w[0]||(w[0]=I=>m(t).tableName=I),placeholder:"请输入 表名"},{append:o(()=>[n(D,{type:"primary",size:"default",onClick:u},{default:o(()=>[F(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[G("div",null,[F(" 数据库字段 "),Rt,n(h,{content:"显示默认字段"},{default:o(()=>[n($,{modelValue:c.value,"onUpdate:modelValue":w[1]||(w[1]=I=>c.value=I)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),zt=N({__name:"index",setup(d){const e=ct(),r=T({}),{FlowForm:t}=L(),a=W(()=>{const i=r.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${i==null?void 0:i.title}`:e.instanceId||e.taskId?`办理流程：${i==null?void 0:i.title}`:`发起流程：${i==null?void 0:i.title}`});pt(a);async function s(i){window.postMessage({event:"onComplete",data:{...i}})}return(i,p)=>(b(),O(m(t),we({flowDetail:r.value,"onUpdate:flowDetail":p[0]||(p[0]=f=>r.value=f)},m(e),{onComplete:s}),null,16,["flowDetail"]))}}),jt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:yt,PageFlowDefinition:Ie,PageFlowDeploy:xe,PageFlowForm:zt,PageFlowManage:Tt,PageFlowOps:Lt,PageFlowParam:Nt,PageFlowTemplate:At,PageFlowWorkbench:Bt,PageFormTemplate:Et,PageTableTemplate:Kt},Symbol.toStringTag,{value:"Module"})),No={install(d,e){L(e),Object.entries(jt).forEach(([r,t])=>{d.component(r,t)})}};export{Mo as ApprovalForm,So as ButtonList,Se as CONFIG_DEFAULT,Bo as FieldType,Ao as FlowButtonApproval,Eo as FlowButtonDisplay,Ro as FlowButtonKey,Ko as FlowButtonStatus,zo as FlowButtonType,jo as FlowForm,Wo as FlowStatus,Jo as HandleType,Go as InternalForm,Fe as IsMainVersion,yt as PageFlowButton,Ie as PageFlowDefinition,xe as PageFlowDeploy,zt as PageFlowForm,Tt as PageFlowManage,Lt as PageFlowOps,Nt as PageFlowParam,At as PageFlowTemplate,Bt as PageFlowWorkbench,Et as PageFormTemplate,Kt as PageTableTemplate,Ho as TablePrimary,q as TaskStatus,Qo as UploadTable,Xo as Whether,ze as asyncValidate,No as default,Yo as defineTableOption,Zo as fieldTypeDic,qo as flowFormEmits,el as flowFormProps,tl as flowTrack,ol as injectionKey,ll as isMobile,al as tablePrimaryDic,nl as useButtonHandler,sl as useCommonCommentApi,L as useConfigProvider,il as useEmitter,Ae as useFlowButtonApi,De as useFlowCategoryApi,le as useFlowDefinitionApi,de as useFlowDeployApi,ul as useFlowFileApi,$e as useFlowForm,wt as useFlowFormOverlay,_t as useFlowFormWindow,vt as useFlowOpsApi,_e as useFlowParamApi,Ge as useFlowTaskApi,he as useFlowTemplateApi,rl as useFlowUserApi,dl as useFormDefaults,Ce as useFormTemplateApi,cl as useInjectState,pl as useProvideState,ne as useTableTemplateApi,ml as whetherDic};
