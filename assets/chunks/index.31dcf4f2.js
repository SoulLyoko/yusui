import{u as Pe,aJ as Wt,aK as Ye,aQ as Qt,aR as qt,aH as Ze,_ as xe,aS as Ht,aD as Jt,ax as Xe,aT as Gt,aU as He,aV as Yt,aW as et,aX as Zt,aY as Xt,aZ as be,x as tt,a_ as ot,a$ as lt,b0 as eo,y as nt,J as to,aq as oo,b1 as Z,b2 as ae,b3 as le,b4 as ge,b5 as lo,b6 as no,aO as ao,b7 as ro,aP as so,z as io}from"../composables_use-crud_index.md.7541bdb9.js";import{r as uo}from"./axios.4c6d325d.js";import{al as co,f as K,R as _e,c as R,h as $,i as B,z as Q,j as G,l as J,u as c,t as j,G as h,B as v,A as N,I as fo,C as M,W as Ue,r as O,w as oe,n as te,e as po,d as Ae,a0 as mo,S as at,a1 as he,E as rt,ay as vo,ag as st,T as it,aw as ut,D as V,$ as Le,y as ke,s as Oe,b as ee,ac as H,k as F,ao as se,ap as ie,F as Y,L as re,_ as Fe,aI as ct,ai as Ne,am as yo,a_ as bo,aL as _o}from"./framework.58691f2b.js";import{e as wo,c as Je,a as go,d as Ce,q as ho,x as ko}from"./theme.79d710c4.js";import{A as Co,_ as Vo,a5 as dt,a4 as $o,a7 as ft,a8 as Do,a9 as Oo}from"./index.vue_vue_type_script_setup_true_lang.14b130b7.js";import{a as Io,_ as To}from"./index.vue_vue_type_script_setup_true_lang.76d4be61.js";import{d as So}from"./data.4cb21f02.js";import{a as Eo}from"../flow-design_flow-modeler_index.md.a061d454.js";import{fM as Lo}from"../app.48ca20ce.js";import"./vue.runtime.esm-bundler.e166299f.js";import"../components_basic-container_index.md.9b371e9c.js";import"../components_icon-select_index.md.2adaa6f9.js";import"../components_index.md.697061c0.js";import"../components_v-text_index.md.fffa2334.js";import"../composables_index.md.4f63e5ec.js";import"../flow-design_flow-viewer_index.md.0f2bbce1.js";import"../flow-design_index.md.36aaaa61.js";import"../flow-pages_index.md.96a87367.js";import"../flow-pages_pages_flow-button_index.md.1f7d435d.js";import"../flow-pages_pages_flow-manage_index.md.6605ff50.js";import"../flow-pages_pages_flow-ops_index.md.48c2710e.js";import"../flow-pages_pages_flow-param_index.md.a838fc38.js";import"../flow-pages_pages_flow-template_index.md.3343aa48.js";import"../flow-pages_pages_flow-workbench_index.md.aed1688c.js";import"../flow-pages_pages_form-template_index.md.4c26b2a2.js";import"../flow-pages_pages_table-template_index.md.2f954a1a.js";import"../form-design_demo.md.7ed33b13.js";import"../form-design_index.md.646ff874.js";import"../guide_changelog.md.c4dd5b98.js";import"../guide_start.md.ac582e3a.js";import"../index.md.01cb05dd.js";import"../plugins_avue-patch_index.md.55274cac.js";import"../plugins_env-dts_index.md.fc1da6fa.js";import"../plugins_index.md.85630059.js";import"../plugins_load-proxy_index.md.aa84f51b.js";import"../plugins_uni-ui-patch_index.md.a40f9660.js";import"../plugins_uview-patch_index.md.e5cda20f.js";import"../types_avue_index.md.6dd55393.js";import"../utils_date_dateFormat.md.46292425.js";import"../utils_date_durationFormat.md.a9466ca5.js";import"../utils_emitter_mittAsync.md.fa0c1888.js";import"../utils_index.md.6539ff35.js";import"../utils_math_index.md.74592475.js";import"../utils_object_filterObj.md.7e4e2a5d.js";import"../utils_object_filterObjDeep.md.30ba6b3d.js";import"../utils_object_getDataType.md.e91e1325.js";import"../utils_string_deserialize.md.53d74973.js";import"../utils_string_serialize.md.46d95769.js";import"../utils_string_uuid.md.0357bc06.js";import"../utils_tool_awaitTo.md.02770430.js";import"../utils_tool_enumToDic.md.9f356deb.js";import"../utils_tool_sleep.md.1f530da0.js";import"../utils_tree_buildTree.md.90191de7.js";import"../utils_tree_filterTree.md.75f848cc.js";import"../utils_tree_findTree.md.19218304.js";import"../utils_tree_flatTree.md.aad7510e.js";import"../utils_tree_treeMap.md.d5162fe5.js";const No=(...e)=>o=>{e.forEach(t=>{co(t)?t(o):t.value=o})},pt=Symbol("dialogInjectionKey"),mt=Pe({center:{type:Boolean,default:!1},alignCenter:{type:Boolean,default:!1},closeIcon:{type:Wt},customClass:{type:String,default:""},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},title:{type:String,default:""}}),Ro={close:()=>!0},Po=["aria-label"],xo=["id"],Uo=K({name:"ElDialogContent"}),Ao=K({...Uo,props:mt,emits:Ro,setup(e){const o=e,{t}=Ye(),{Close:l}=Ht,{dialogRef:r,headerRef:i,bodyId:a,ns:n,style:u}=_e(pt),{focusTrapRef:s}=_e(Qt),d=No(s,r),y=R(()=>o.draggable);return qt(r,i,y),(f,p)=>($(),B("div",{ref:c(d),class:J([c(n).b(),c(n).is("fullscreen",f.fullscreen),c(n).is("draggable",c(y)),c(n).is("align-center",f.alignCenter),{[c(n).m("center")]:f.center},f.customClass]),style:Ue(c(u)),tabindex:"-1"},[Q("header",{ref_key:"headerRef",ref:i,class:J(c(n).e("header"))},[G(f.$slots,"header",{},()=>[Q("span",{role:"heading",class:J(c(n).e("title"))},j(f.title),3)]),f.showClose?($(),B("button",{key:0,"aria-label":c(t)("el.dialog.close"),class:J(c(n).e("headerbtn")),type:"button",onClick:p[0]||(p[0]=m=>f.$emit("close"))},[h(c(Ze),{class:J(c(n).e("close"))},{default:v(()=>[($(),N(fo(f.closeIcon||c(l))))]),_:1},8,["class"])],10,Po)):M("v-if",!0)],2),Q("div",{id:c(a),class:J(c(n).e("body"))},[G(f.$slots,"default")],10,xo),f.$slots.footer?($(),B("footer",{key:0,class:J(c(n).e("footer"))},[G(f.$slots,"footer")],2)):M("v-if",!0)],6))}});var Fo=xe(Ao,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog-content.vue"]]);const vt=Pe({...mt,appendToBody:{type:Boolean,default:!1},beforeClose:{type:Jt(Function)},destroyOnClose:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:{type:Boolean,default:!1},modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1}}),yt={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[Xe]:e=>wo(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},bt=(e,o)=>{const l=Ae().emit,{nextZIndex:r}=Gt();let i="";const a=He(),n=He(),u=O(!1),s=O(!1),d=O(!1),y=O(e.zIndex||r());let f,p;const m=Yt("namespace",Xt),g=R(()=>{const A={},W=`--${m.value}-dialog`;return e.fullscreen||(e.top&&(A[`${W}-margin-top`]=e.top),e.width&&(A[`${W}-width`]=et(e.width))),A}),C=R(()=>e.alignCenter?{display:"flex"}:{});function S(){l("opened")}function I(){l("closed"),l(Xe,!1),e.destroyOnClose&&(d.value=!1)}function k(){l("close")}function _(){p==null||p(),f==null||f(),e.openDelay&&e.openDelay>0?{stop:f}=Je(()=>T(),e.openDelay):T()}function b(){f==null||f(),p==null||p(),e.closeDelay&&e.closeDelay>0?{stop:p}=Je(()=>L(),e.closeDelay):L()}function w(){function A(W){W||(s.value=!0,u.value=!1)}e.beforeClose?e.beforeClose(A):b()}function P(){e.closeOnClickModal&&w()}function T(){go&&(u.value=!0)}function L(){u.value=!1}function D(){l("openAutoFocus")}function x(){l("closeAutoFocus")}function U(A){var W;((W=A.detail)==null?void 0:W.focusReason)==="pointer"&&A.preventDefault()}e.lockScroll&&Zt(u);function z(){e.closeOnPressEscape&&w()}return oe(()=>e.modelValue,A=>{A?(s.value=!1,_(),d.value=!0,y.value=e.zIndex?y.value++:r(),te(()=>{l("open"),o.value&&(o.value.scrollTop=0)})):u.value&&b()}),oe(()=>e.fullscreen,A=>{o.value&&(A?(i=o.value.style.transform,o.value.style.transform=""):o.value.style.transform=i)}),po(()=>{e.modelValue&&(u.value=!0,d.value=!0,_())}),{afterEnter:S,afterLeave:I,beforeLeave:k,handleClose:w,onModalClick:P,close:b,doClose:L,onOpenAutoFocus:D,onCloseAutoFocus:x,onCloseRequested:z,onFocusoutPrevented:U,titleId:a,bodyId:n,closed:s,style:g,overlayDialogStyle:C,rendered:d,visible:u,zIndex:y}},Bo=["aria-label","aria-labelledby","aria-describedby"],Mo=K({name:"ElDialog",inheritAttrs:!1}),Ko=K({...Mo,props:vt,emits:yt,setup(e,{expose:o}){const t=e,l=mo();be({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},R(()=>!!l.title)),be({scope:"el-dialog",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/dialog.html#attributes",type:"Attribute"},R(()=>!!t.customClass));const r=tt("dialog"),i=O(),a=O(),n=O(),{visible:u,titleId:s,bodyId:d,style:y,overlayDialogStyle:f,rendered:p,zIndex:m,afterEnter:g,afterLeave:C,beforeLeave:S,handleClose:I,onModalClick:k,onOpenAutoFocus:_,onCloseAutoFocus:b,onCloseRequested:w,onFocusoutPrevented:P}=bt(t,i);at(pt,{dialogRef:i,headerRef:a,bodyId:d,ns:r,rendered:p,style:y});const T=eo(k),L=R(()=>t.draggable&&!t.fullscreen);return o({visible:u,dialogContentRef:n}),(D,x)=>($(),N(ut,{to:"body",disabled:!D.appendToBody},[h(it,{name:"dialog-fade",onAfterEnter:c(g),onAfterLeave:c(C),onBeforeLeave:c(S),persisted:""},{default:v(()=>[he(h(c(ot),{"custom-mask-event":"",mask:D.modal,"overlay-class":D.modalClass,"z-index":c(m)},{default:v(()=>[Q("div",{role:"dialog","aria-modal":"true","aria-label":D.title||void 0,"aria-labelledby":D.title?void 0:c(s),"aria-describedby":c(d),class:J(`${c(r).namespace.value}-overlay-dialog`),style:Ue(c(f)),onClick:x[0]||(x[0]=(...U)=>c(T).onClick&&c(T).onClick(...U)),onMousedown:x[1]||(x[1]=(...U)=>c(T).onMousedown&&c(T).onMousedown(...U)),onMouseup:x[2]||(x[2]=(...U)=>c(T).onMouseup&&c(T).onMouseup(...U))},[h(c(lt),{loop:"",trapped:c(u),"focus-start-el":"container",onFocusAfterTrapped:c(_),onFocusAfterReleased:c(b),onFocusoutPrevented:c(P),onReleaseRequested:c(w)},{default:v(()=>[c(p)?($(),N(Fo,rt({key:0,ref_key:"dialogContentRef",ref:n},D.$attrs,{"custom-class":D.customClass,center:D.center,"align-center":D.alignCenter,"close-icon":D.closeIcon,draggable:c(L),fullscreen:D.fullscreen,"show-close":D.showClose,title:D.title,onClose:c(I)}),vo({header:v(()=>[D.$slots.title?G(D.$slots,"title",{key:1}):G(D.$slots,"header",{key:0,close:c(I),titleId:c(s),titleClass:c(r).e("title")})]),default:v(()=>[G(D.$slots,"default")]),_:2},[D.$slots.footer?{name:"footer",fn:v(()=>[G(D.$slots,"footer")])}:void 0]),1040,["custom-class","center","align-center","close-icon","draggable","fullscreen","show-close","title","onClose"])):M("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,Bo)]),_:3},8,["mask","overlay-class","z-index"]),[[st,c(u)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"]))}});var zo=xe(Ko,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog.vue"]]);const jo=nt(zo),Wo=Pe({...vt,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),Qo=yt,qo=K({name:"ElDrawer",components:{ElOverlay:ot,ElFocusTrap:lt,ElIcon:Ze,Close:to},inheritAttrs:!1,props:Wo,emits:Qo,setup(e,{slots:o}){be({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},R(()=>!!o.title)),be({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},R(()=>!!e.customClass));const t=O(),l=O(),r=tt("drawer"),{t:i}=Ye(),a=R(()=>e.direction==="rtl"||e.direction==="ltr"),n=R(()=>et(e.size));return{...bt(e,t),drawerRef:t,focusStartRef:l,isHorizontal:a,drawerSize:n,ns:r,t:i}}}),Ho=["aria-label","aria-labelledby","aria-describedby"],Jo=["id"],Go=["aria-label"],Yo=["id"];function Zo(e,o,t,l,r,i){const a=V("close"),n=V("el-icon"),u=V("el-focus-trap"),s=V("el-overlay");return $(),N(ut,{to:"body",disabled:!e.appendToBody},[h(it,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:v(()=>[he(h(s,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:v(()=>[h(u,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:v(()=>[Q("div",rt({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:o[1]||(o[1]=Le(()=>{},["stop"]))}),[Q("span",{ref:"focusStartRef",class:J(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?($(),B("header",{key:0,class:J(e.ns.e("header"))},[e.$slots.title?G(e.$slots,"title",{key:1},()=>[M(" DEPRECATED SLOT ")]):G(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?M("v-if",!0):($(),B("span",{key:0,id:e.titleId,role:"heading",class:J(e.ns.e("title"))},j(e.title),11,Jo))]),e.showClose?($(),B("button",{key:2,"aria-label":e.t("el.drawer.close"),class:J(e.ns.e("close-btn")),type:"button",onClick:o[0]||(o[0]=(...d)=>e.handleClose&&e.handleClose(...d))},[h(n,{class:J(e.ns.e("close"))},{default:v(()=>[h(a)]),_:1},8,["class"])],10,Go)):M("v-if",!0)],2)):M("v-if",!0),e.rendered?($(),B("div",{key:1,id:e.bodyId,class:J(e.ns.e("body"))},[G(e.$slots,"default")],10,Yo)):M("v-if",!0),e.$slots.footer?($(),B("div",{key:2,class:J(e.ns.e("footer"))},[G(e.$slots,"footer")],2)):M("v-if",!0)],16,Ho)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[st,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var Xo=xe(qo,[["render",Zo],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const el=nt(Xo);var tl=uo();const ol=oo(tl),ll={},nl=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),al=()=>ll,rl=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",_t=e=>e instanceof Function,fe=e=>e==null,Me=typeof window>"u",wt=()=>{var e;return Me||fe((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},sl=()=>{var e,o;return(e=!Me&&((o=window.navigator)===null||o===void 0?void 0:o.onLine))!==null&&e!==void 0?e:!0},Ie=()=>new Promise(()=>{}),X=e=>H(e)?e.value:e,il=e=>Be(e)?Object.assign(rl(e)?[]:{},e):e,ve=new Map,ul=e=>fe(e)?void 0:ve.get(e),cl=(e,o,t)=>{const l=ve.get(e);l!=null&&l.timer&&clearTimeout(l.timer);const r=setTimeout(()=>ve.delete(e),o);ve.set(e,{...t,timer:r})},ne=e=>e;function gt(e,o,t){let l,r,i,a,n,u,s=0,d=!1,y=!1,f=!0;const p=!o&&o!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");o=+o||0,Be(t)&&(d=!!t.leading,y="maxWait"in t,i=y?Math.max(+t.maxWait||0,o):i,f="trailing"in t?!!t.trailing:f);function m(D){const x=l,U=r;return l=r=void 0,s=D,a=e.apply(U,x),a}function g(D,x){return p?(window.cancelAnimationFrame(n),window.requestAnimationFrame(D)):setTimeout(D,x)}function C(D){if(p)return window.cancelAnimationFrame(D);clearTimeout(D)}function S(D){return s=D,n=g(_,o),d?m(D):a}function I(D){const x=D-u,U=D-s,z=o-x;return y?Math.min(z,i-U):z}function k(D){const x=D-u,U=D-s;return u===void 0||x>=o||x<0||y&&U>=i}function _(){const D=Date.now();if(k(D))return b(D);n=g(_,I(D))}function b(D){return n=void 0,f&&l?m(D):(l=r=void 0,a)}function w(){n!==void 0&&C(n),s=0,l=u=r=n=void 0}function P(){return n===void 0?a:b(Date.now())}function T(){return n!==void 0}function L(...D){const x=Date.now(),U=k(x);if(l=D,r=this,u=x,U){if(n===void 0)return S(u);if(y)return n=g(_,o),m(u)}return n===void 0&&(n=g(_,o)),a}return L.cancel=w,L.flush=P,L.pending=T,L}function dl(e,o,t){let l=!0,r=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(t)&&(l="leading"in t?!!t.leading:l,r="trailing"in t?!!t.trailing:r),gt(e,o,{leading:l,trailing:r,maxWait:o})}var fl=ne((e,{debounceInterval:o,debounceOptions:t,manual:l})=>{const r=O(!1),i=O(),a=R(()=>t),n=R(()=>X(o)),u=O(e.context.runAsync);return l||(r.value=!0),ee(s=>{fe(n.value)||(i.value=gt(d=>d(),n.value,a.value),e.context.runAsync=(...d)=>new Promise((y,f)=>{r.value?(r.value=!1,u.value(...d).then(y).catch(f)):i.value(()=>{u.value(...d).then(y).catch(f)})}),s(()=>{var d;(d=i.value)===null||d===void 0||d.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var s;(s=i.value)===null||s===void 0||s.cancel()}}}),pl=ne((e,{errorRetryCount:o=0,errorRetryInterval:t=0})=>{const l=O(),r=O(0),i=R(()=>X(o)),a=R(()=>X(t));let n=!1;const u=()=>{r.value=0},s=R(()=>{if(a.value)return a.value;const f=1e3,p=1,m=9,g=Math.floor(Math.random()*2**Math.min(r.value,m)+p);return f*g}),d=()=>{let f;const p=i.value===-1,m=r.value<i.value;return(p||m)&&(p||(r.value+=1),f=setTimeout(()=>{n=!0,e.context.refresh()},s.value)),()=>f&&clearTimeout(f)},y=()=>{l.value&&l.value()};return{onBefore(){n||u(),n=!1,y()},onSuccess(){u()},onError(){l.value=d()},onCancel(){u(),y()}}}),ml=ne((e,{ready:o=O(!0),manual:t,defaultParams:l=[]})=>(oe(o,r=>{!t&&r&&e.context.run(...l)},{flush:"sync"}),{onBefore(){if(!o.value)return e.loading.value=!1,{isBreak:!0}}})),vl=ne((e,{refreshDeps:o=[],refreshDepsAction:t,manual:l})=>(o!=null&&o.length&&oe(o,()=>{t?t():!l&&e.context.refresh()}),{})),yl=ne((e,{throttleInterval:o,throttleOptions:t})=>{const l=O(),r=R(()=>X(o)),i=R(()=>t),a=O(e.context.runAsync);return ee(n=>{if(fe(o))return{};l.value=dl(u=>u(),r.value,i.value),e.context.runAsync=(...u)=>new Promise((s,d)=>{l.value(()=>{a.value(...u).then(s).catch(d)})}),n(()=>{var u;(u=l.value)===null||u===void 0||u.cancel(),e.context.runAsync=a.value})}),{onCancel(){var n;(n=l.value)===null||n===void 0||n.cancel()}}});const bl=(e,o)=>t=>{Object.keys(t).forEach(l=>{e[l].value=t[l]}),o.forEach(l=>l(e))},_l=(e,o)=>()=>{let t=o;for(let l=e.length;l-- >0;)t=e[l](t);return t()},wl=(e,o,t)=>{var l,r;const{initialData:i,onSuccess:a,onError:n,onBefore:u,onAfter:s}=o,d=O((l=t==null?void 0:t.loading)!==null&&l!==void 0?l:!1),y=Oe((r=t==null?void 0:t.data)!==null&&r!==void 0?r:i),f=Oe(t==null?void 0:t.error),p=O(t==null?void 0:t.params),m=O([]),g=Oe("pending"),C={},S=bl({status:g,loading:d,data:y,error:f,params:p},[]),I=(_,...b)=>{if(_==="onQuery"){const w=m.value.map(P=>P.onQuery).filter(Boolean);return{servicePromise:_l(w,b[0])()}}else{const w=m.value.map(P=>{var T;return(T=P[_])===null||T===void 0?void 0:T.call(P,...b)});return Object.assign({},...w)}},k=O(0);return C.runAsync=async(..._)=>{S({loading:!0,params:_,status:"pending"}),k.value+=1;const b=k.value,{isBreak:w,breakResult:P=Ie()}=I("onBefore",_);if(w)return S({status:"settled"}),P;u==null||u(_);try{const T=()=>new Promise(x=>x(e(...p.value)));let{servicePromise:L}=I("onQuery",T);L||(L=T());const D=await L;return b!==k.value?Ie():(S({data:D,loading:!1,error:void 0,status:"settled"}),I("onSuccess",D,_),a==null||a(D,_),I("onAfter",_,D,void 0),s==null||s(_),D)}catch(T){if(b!==k.value)return Ie();throw S({loading:!1,error:T,status:"settled"}),I("onError",T,_),n==null||n(T,_),I("onAfter",_,void 0,T),s==null||s(_),T}},C.run=(..._)=>{C.runAsync(..._).catch(b=>{n||console.error(b)})},C.cancel=()=>{k.value+=1,S({loading:!1}),I("onCancel")},C.refresh=()=>{C.run(...p.value||[])},C.refreshAsync=()=>C.runAsync(...p.value||[]),C.mutate=_=>{const b=_t(_)?_(y.value):_,w=il(b);S({data:w}),I("onMutate",w)},{status:g,loading:d,data:y,error:f,params:p,plugins:m,context:C}};function gl(e,o={},t){const l=_e(nl,{}),r={...al(),...l,...o},{manual:i=!1,defaultParams:a=[]}=r,n=wl(e,r);if(n.plugins.value=t.map(u=>u(n,r)),!i){const u=n.params.value||a;n.context.run(...u)}return ke(()=>{n.context.cancel()}),{loading:n.loading,data:n.data,error:n.error,params:n.params,cancel:n.context.cancel,refresh:n.context.refresh,refreshAsync:n.context.refreshAsync,mutate:n.context.mutate,run:n.context.run,runAsync:n.context.runAsync}}const ye=new Map,hl=(e,o)=>{ye.set(e,o),o.then(t=>(ye.delete(e),t)).catch(()=>{ye.delete(e)})},kl=e=>ye.get(e),ue=new Map,Cl=(e,o)=>{ue.has(e)&&ue.get(e).forEach(t=>t(o))},Vl=(e,o)=>(ue.has(e)?ue.get(e).push(o):ue.set(e,[o]),()=>{const t=ue.get(e).indexOf(o);ue.get(e).splice(t,1)});var $l=ne((e,{cacheKey:o,cacheTime:t=6e5,staleTime:l=0,getCache:r,setCache:i})=>{if(!o)return{};const a=_t(o)?o:()=>o,n=O(()=>{});let u;const s=C=>r?r(C):ul(C),d=(C,S,I)=>{i?i(C,I):cl(C,S,I),Cl(C,I.data)},y=C=>l===-1||C+l>new Date().getTime(),f=(C,S)=>Object.prototype.hasOwnProperty.call(C,S),p=C=>{const S=a(C);return Vl(S,I=>{e.data.value=I})},m=a(),g=s(m);return g&&f(g,"data")&&(e.data.value=g.data,e.params.value=g.params),m&&(n.value=p()),ke(()=>{n.value()}),{onBefore(C){const S=a(C),I=s(S);if(!I||!f(I,"data"))return{};if(y(I.time))return e.data.value=I.data,e.loading.value=!1,{isBreak:!0,breakResult:I.data};e.data.value=I.data},onQuery(C){const S=e.params.value,I=a(S);let k=kl(I);return k&&k!==u?()=>k:(k=C(),u=k,hl(I,k),()=>k)},onSuccess(C,S){const I=a(S);I&&(n.value(),d(I,t,{data:C,params:S,time:new Date().getTime()}),n.value=p(S))},onMutate(C){const S=a(e.params.value);S&&(n.value(),d(S,t,{data:C,params:e.params.value,time:new Date().getTime()}),n.value=p(e.params.value))}}});function Dl(e){let o,t;class l extends Promise{constructor(i){super(i),this.cancel=()=>{t(),clearTimeout(o)}}}return new l(r=>{t=r,o=setTimeout(t,e)})}function Te(){return new Date().getTime()}var Ol=ne((e,{loadingDelay:o=0,loadingKeep:t=0})=>{const l=O(()=>{}),r=R(()=>X(o)),i=R(()=>X(t));let a=0,n={};const u=()=>{let s;return r.value&&(s=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},r.value)),()=>s&&clearTimeout(s)};return{onBefore(){e.loading.value=!r.value,l.value(),l.value=u(),a=Te()},onQuery(s){if(!i.value)return()=>s();n=Dl(i.value+r.value);const d=async()=>{try{const f=await s();return Te()-a<=r.value&&n.cancel(),Promise.resolve(f)}catch(f){return Te()-a<=r.value&&n.cancel(),Promise.reject(f)}},y=Promise.allSettled([d(),n]).then(f=>{const p=f[0];return p.status==="fulfilled"?p.value:Promise.reject(p.reason)});return()=>y},onCancel(){l.value()},onAfter(){l.value()}}}),Se;const ht=new Set,kt=new Set,Ct=new Set,we=(e,o)=>{let t;switch(e){case"FOCUS_LISTENER":t=ht;break;case"RECONNECT_LISTENER":t=Ct;break;case"VISIBLE_LISTENER":t=kt;break}if(!t.has(o))return t.add(o),()=>{t.delete(o)}},Ee=e=>{e.forEach(o=>{o()})};!Me&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{wt()&&Ee(kt)},!1),window.addEventListener("focus",()=>Ee(ht),!1),window.addEventListener("online",()=>Ee(Ct),!1));var Il=ne((e,{pollingInterval:o,pollingWhenHidden:t=!1,pollingWhenOffline:l=!1,errorRetryCount:r=0})=>{const i=O(),a=O(!1),n=R(()=>X(o)),u=R(()=>X(r)),s=[],d=m=>{m&&s.push(m)},y=()=>(t||wt())&&(l||sl()),f=m=>{if(e.error.value&&u.value!==0)return;let g;if(!fe(n.value)&&n.value>=0)if(y())g=setTimeout(m,n.value);else{a.value=!0;return}return()=>g&&clearTimeout(g)},p=()=>{a.value&&y()&&(e.context.refresh(),a.value=!1)};return oe(n,()=>{i.value&&(i.value(),i.value=f(()=>e.context.refresh()))}),t||d(we("VISIBLE_LISTENER",p)),l||d(we("RECONNECT_LISTENER",p)),ke(()=>{s.forEach(m=>m())}),{onBefore(){var m;(m=i.value)===null||m===void 0||m.call(i)},onCancel(){var m;(m=i.value)===null||m===void 0||m.call(i)},onAfter(){i.value=f(()=>e.context.refresh())}}});const Tl=(e,o)=>{let t=!1;return(...l)=>{t||(t=!0,e(...l),setTimeout(()=>{t=!1},o))}};var Sl=ne((e,{refreshOnWindowFocus:o=!1,refocusTimespan:t=5e3})=>{const l=R(()=>X(o)),r=R(()=>X(t)),i=[],a=u=>{u&&i.push(u)},n=()=>{i.forEach(u=>u())};return ee(()=>{if(n(),l.value){const u=Tl(e.context.refresh,r.value);a(we("VISIBLE_LISTENER",u)),a(we("FOCUS_LISTENER",u))}}),ke(()=>{n()}),{}});function pe(e,o){return gl(e,o,[Ol,pl,fl,Il,yl,Sl,vl,ml,$l])}const E=ol.create();E.interceptors.response.use(e=>{const o=e.data;return o.code!==200?(Z.error(o.msg),Promise.reject(o.msg)):o});var Vt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Vt||{}),Ke=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Ke||{}),ze=(e=>(e.不显示="false",e.审批人="assignee",e.抄送人="copyUser",e.意见="comment",e))(ze||{}),$t=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))($t||{});function Dt(e){return E.get("/sapier-flow/dev-button/list",{params:e})}function Ot(){return pe(()=>Dt({size:-1,ascs:"sort"}).then(e=>e.data.records))}function El(e){return E.post("/sapier-flow/dev-button/save",e)}function Ll(e){return E.post("/sapier-flow/dev-button/update",e)}function Nl(e){return E.post("/sapier-flow/dev-button/remove",{},{params:{ids:e}})}const Rl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ae(Vt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ae(Ke),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示:始终显示;隐藏:始终隐藏;
      发起人:用户为发起人时显示;处理人:用户为处理人时显示;
      已办:任务状态为已办时显示;待办:任务状态为待办时显示;
      未发起:流程未发起时显示;已发起:流程已发起时显示;
      未办结:流程未办结时显示;已办结:流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ae(ze),labelTip:"不显示:不显示审批窗口;审批人:显示审批人选择框;抄送人:显示抄送人选择框;意见:显示意见输入框;"},{label:"状态",prop:"status",type:"switch",value:1,dicData:ae($t)},{label:"排序",prop:"sort",type:"number",value:0},{label:"按钮预览",prop:"buttonPreview",width:200}]},Pl=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l}=le({tableOption:Rl,crudOption:{getList:Dt,create:El,update:Ll,remove:Nl},sortOption:{ascs:"sort"}});return l(),(r,i)=>{const a=V("v-icon"),n=V("el-button"),u=V("avue-crud");return $(),N(u,se(ie(c(o))),{icon:v(({row:s})=>[h(a,{icon:s.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:v(({row:s})=>[h(n,{type:s.buttonType},{default:v(()=>[h(a,{icon:s.icon},null,8,["icon"]),F(" "+j(s.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":v(()=>[h(n,{type:c(t).buttonType},{default:v(()=>[h(a,{icon:c(t).icon},null,8,["icon"]),F(" "+j(c(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),je={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},xl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...je.column,{label:"流程主版本",prop:"mainVersion",formatter(e,o){return o?`V${o||""}`:""}}]};function Ul(e){return E.get("/sapier-flow/flow-definition/list",{params:e})}function It(e){return E.get("/sapier-flow/flow-definition/detail",{params:e})}function Al(e){return E.post("/sapier-flow/flow-definition/save",e)}function Fl(e){return E.post("/sapier-flow/flow-definition/update",e)}function Tt(e){return E.post("/sapier-flow/flow-definition/deployFlow",e)}const St=K({__name:"index",props:{categoryId:null},emits:["add","view","edit","version"],setup(e,{emit:o}){const t=e,{bindVal:l,crudStateRefs:{searchForm:r},getDataList:i}=le({tableOption:xl,crudOption:{getList:Ul},searchForm:{categoryId:t.categoryId}});ee(()=>{r.value.categoryId=t.categoryId??"",i()});const a=O(!1);async function n(u){await ge.confirm("发布新版本，是否确认？","提示",{type:"success"}),a.value=!0,Tt({flowModuleId:u.flowModuleId}).then(()=>{Z.success("发布成功"),i()}).finally(()=>{a.value=!1})}return(u,s)=>{const d=V("el-button"),y=V("v-icon"),f=V("avue-crud");return $(),N(f,se(ie(c(l))),{"menu-left":v(()=>[h(d,{type:"primary",icon:"el-icon-plus",onClick:s[0]||(s[0]=p=>o("add"))},{default:v(()=>[F(" 新增 ")]),_:1})]),menu:v(({row:p})=>[h(d,{loading:a.value,type:"text",icon:"el-icon-view",onClick:m=>o("view",p)},{default:v(()=>[F(" 查看 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:a.value,type:"text",icon:"el-icon-edit",onClick:m=>o("edit",p)},{default:v(()=>[F(" 编辑 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:a.value,type:"text",icon:"el-icon-upload",onClick:m=>n(p)},{default:v(()=>[F(" 发布 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:a.value,type:"text",icon:"el-icon-switch",onClick:m=>o("version",p)},{default:v(()=>[F(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:v(({row:p})=>[h(y,{icon:p.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Bl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...je.column,{label:"流程版本",prop:"version",formatter(e,o){return o?`V${o||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]};var Et=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Et||{});function Ml(e){return E.get("/sapier-flow/flow-deploy/list",{params:e})}function Lt(e){return E.get("/sapier-flow/flow-deploy/detail",{params:e})}function Nt(e){return E.post("/sapier-flow/flow-deploy/update",e)}function Kl(){return E.get("/sapier-flow/flow-run/queryPublishFlowList")}const Rt=K({__name:"index",props:{flowModuleId:null},emits:["back","view","edit"],setup(e,{emit:o}){const t=e,{bindVal:l,crudStateRefs:{searchForm:r},getDataList:i}=le({tableOption:Bl,crudOption:{getList:Ml,dataPath:"res.data"}});ee(()=>{t.flowModuleId&&(r.value.flowModuleId=t.flowModuleId,i())});const a=O(!1);async function n(u){await ge.confirm(`确定将 ${u.flowName}(${u.flowKey}:v${u.version}) 设为主版本?`,"提示",{type:"warning"}),a.value=!0,Nt({flowDeployId:u.flowDeployId,flowModuleId:u.flowModuleId,mainVersion:1}).then(()=>{Z.success("设置成功"),i()}).finally(()=>{a.value=!1})}return(u,s)=>{const d=V("el-button"),y=V("v-icon"),f=V("avue-crud");return $(),N(f,se(ie(c(l))),{"menu-left":v(()=>[h(d,{loading:a.value,type:"primary",icon:"el-icon-arrow-left",onClick:s[0]||(s[0]=p=>o("back"))},{default:v(()=>[F(" 返回 ")]),_:1},8,["loading"])]),menu:v(({row:p})=>[h(d,{loading:a.value,type:"text",icon:"el-icon-view",onClick:m=>o("view",p)},{default:v(()=>[F(" 查看 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:a.value,type:"text",icon:"el-icon-edit",onClick:m=>o("edit",p)},{default:v(()=>[F(" 编辑 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:a.value,disabled:p.mainVersion===c(Et).是,type:"text",icon:"el-icon-switch",onClick:m=>n(p)},{default:v(()=>[F(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:v(({row:p})=>[h(y,{icon:p.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}});function zl(e){return E.get("/sapier-flow/flow-category/list",{params:e})}function jl(e){return E.post("/sapier-flow/flow-category/save",e)}function Wl(e){return E.post("/sapier-flow/flow-category/update",e)}function Ql(e){return E.post("/sapier-flow/flow-category/remove",{},{params:{ids:e}})}const Ge={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},ql=K({__name:"index",emits:["node-click"],setup(e,{emit:o}){const t={rowKey:"id",getList:zl,create:jl,update:Wl,remove:Ql,dataPath:"res.data"},{crudStateRefs:{formData:l,tableData:r},getDataList:i,handleSave:a,handleUpdate:n,handleDel:u}=le({crudOption:t,tableOption:Ge,pageOption:{pageSize:20},mockCache:"flow-category"});i();function s(f,p,m,g){a(p,m,g)}function d(f,p,m,g){n(p,NaN,m,g)}async function y(f,p){await u(f.data,NaN),p()}return(f,p)=>{const m=V("avue-tree");return $(),N(m,{modelValue:c(l),"onUpdate:modelValue":p[0]||(p[0]=g=>H(l)?l.value=g:null),option:c(Ge),data:c(r),onNodeClick:p[1]||(p[1]=g=>o("node-click",g)),onSave:s,onUpdate:d,onDel:y},null,8,["modelValue","option","data"])}}}),We=K({__name:"index",props:{modelValue:null,view:{type:Boolean},fields:null},emits:["update:modelValue"],setup(e,{emit:o}){var n;const t=e,l=R({get(){return t.modelValue?dt(t.modelValue):{menuBtn:!1,span:24}},set(u){o("update:modelValue",$o(u,{useJson5:!1}))}}),r=R(()=>t.fields?JSON.parse(t.fields):[]),i=R(()=>{const u={type:"select",dicData:r.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...u,props:{label:"name",value:"name",desc:"comment"}},{...u,props:{label:"comment",value:"comment",desc:"name"}}]}),a={form:{settings:Array.from({length:((n=Co.settings)==null?void 0:n.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(u,s)=>{const d=V("avue-form");return e.view?($(),N(d,{key:0,class:J(c(l).class),"model-value":{},option:c(l)},null,8,["class","option"])):($(),N(c(Vo),{key:1,modelValue:c(l),"onUpdate:modelValue":s[0]||(s[0]=y=>H(l)?l.value=y:null),"base-option":c(i),resources:a},null,8,["modelValue","base-option"]))}}});function Hl(e){return E.get("/sapier-flow/flow-param/list",{params:e})}function Pt(e){return E.get("/sapier-flow/flow-param/getParam",{params:{paramKey:e}})}function Jl(e){return E.post("/sapier-flow/flow-param/save",e)}function Gl(e){return E.post("/sapier-flow/flow-param/update",e)}function Yl(e){return E.post("/sapier-flow/flow-param/remove",{},{params:{ids:e}})}const Zl=Eo;function Xl(e){return E.get("/sapier-flow/flow-user/tree",{params:{filter:e}})}const en=K({__name:"assignee-setter",props:{modelValue:null,tableData:null},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,l=R({get(){return typeof t.modelValue=="string"?t.modelValue?t.modelValue.split(","):[]:t.modelValue},set(u){o("update:modelValue",u.join(","))}}),r=R({get(){return Array.isArray(t.modelValue)?t.modelValue.join(","):t.modelValue},set(u){o("update:modelValue",u)}}),i=O([]),a=O(!1),n=R(()=>{var u,s;return(s=(u=t.tableData)==null?void 0:u.row)==null?void 0:s.type});return oe(n,u=>{["dept","post","user"].includes(u)&&(a.value=!0,Xl(u==="user"?"":u).then(s=>{i.value=ft(s.data,d=>({label:d.title,value:d.id}))}).finally(()=>a.value=!1))},{immediate:!0}),(u,s)=>{const d=V("el-tree-select"),y=V("el-input");return["dept","post","user"].includes(c(n))?($(),N(d,{key:0,modelValue:c(l),"onUpdate:modelValue":s[0]||(s[0]=f=>H(l)?l.value=f:null),data:i.value,loading:a.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):($(),N(y,{key:1,modelValue:c(r),"onUpdate:modelValue":s[1]||(s[1]=f=>H(r)?r.value=f:null)},null,8,["modelValue"]))}}}),tn={key:0,class:"flow-viewer"},on={class:"flow-status-legend"},ln=K({__name:"index",props:{modelValue:null,view:{type:Boolean},flowFormOption:null,flowHistory:null},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,l=O({}),r=O({}),i=O({}),a=O(),n=R({get(){let k=So();return typeof t.modelValue=="string"&&t.modelValue?k=JSON.parse(t.modelValue):typeof t.modelValue=="object"&&Object.keys(t.modelValue)&&(k=t.modelValue),k},set(k){o("update:modelValue",JSON.stringify(k))}}),u=R(()=>{const{column:k=[],group:_=[]}=JSON.parse(t.flowFormOption||"{}");return[...k,..._.map(w=>w.column??[]).flat()]}),s=R(()=>u.value.map(_=>({label:_.label,value:`\${${_.prop}}`,desc:`\${${_.prop}}`}))),d=ae(Ke),y=ae(ze),{data:f}=Ot();oe(i,k=>{var _,b,w,P,T;k&&(k.priority&&(k.priority.dicData=s.value),k.formTitle&&(k.formTitle.dicData=s.value),(w=(b=(_=k.assignee)==null?void 0:_.children)==null?void 0:b.column)!=null&&w[1]&&(k.assignee.children.column[1].component=en),k.formProperty&&(l.value.formProperty=p(u.value,l.value.formProperty||[])),k.button&&((T=(P=k.button.children)==null?void 0:P.column)==null||T.forEach(L=>{L.prop==="display"&&(L.dicData=d),L.prop==="approval"&&(L.dicData=y)}),console.log(111),l.value.button=m(f.value||[],l.value.button||[])))});function p(k,_){return k.map(b=>{var ce,me;const w=_.find(q=>q.prop===b.prop),{label:P,prop:T,display:L=!0,disabled:D=!1,detail:x=!1,readonly:U=!1,rules:z}=b,A=(z==null?void 0:z.some(q=>q.required))??!1,W={label:P,prop:T,display:L,disabled:D,detail:x,readonly:U,required:A,...w};return b.type==="dynamic"&&((me=(ce=b.children)==null?void 0:ce.column)!=null&&me.length)&&(W.children=p(b.children.column,(w==null?void 0:w.children)??[])),W})}function m(k,_){return k.filter(b=>b.status===1).map(b=>{const w=_.find(U=>U.buttonKey===b.buttonKey),{name:P,buttonKey:T,display:L,approval:D}=b;return{name:P,buttonKey:T,display:L,approval:D,...w}})}const g=O([]);Pt("flow.task.status").then(k=>{g.value=k.data});const C=R(()=>{var k;return(k=t.flowHistory)==null?void 0:k.map(_=>{const b=g.value.find(w=>w.value===_.status);return{id:_.taskNodeKey,style:b}})});function S(){var k,_;(_=(k=n.value)==null?void 0:k.flowElementList)==null||_.forEach(b=>{var w;(w=b.properties)!=null&&w.button&&(b.properties.button=m(f.value||[],[]))}),n.value={...n.value}}function I(){var k,_;(_=(k=n.value)==null?void 0:k.flowElementList)==null||_.forEach(b=>{var w;(w=b.properties)!=null&&w.formProperty&&(b.properties.formProperty=p(u.value,[]))}),n.value={...n.value}}return(k,_)=>{const b=V("el-button");return e.view?($(),B("div",tn,[Q("div",on,[($(!0),B(Y,null,re(g.value,w=>{var P;return $(),B("div",{key:w.label,class:"legend-item"},[Q("div",{class:"legend-color",style:Ue({backgroundColor:(P=w.style)==null?void 0:P.fill})},null,4),Q("span",null,j(w.label),1)])}),128))]),h(c(Io),{"model-value":c(n),styles:c(C)},null,8,["model-value","styles"])])):($(),N(c(To),{key:1,modelValue:c(n),"onUpdate:modelValue":_[0]||(_[0]=w=>H(n)?n.value=w:null),elementData:a.value,"onUpdate:elementData":_[1]||(_[1]=w=>a.value=w),formData:l.value,"onUpdate:formData":_[2]||(_[2]=w=>l.value=w),formDefaults:i.value,"onUpdate:formDefaults":_[3]||(_[3]=w=>i.value=w),formOption:r.value,"onUpdate:formOption":_[4]||(_[4]=w=>r.value=w),"form-options":c(Zl),"form-width":"30%"},{"form-top":v(()=>[h(b,{type:"default",onClick:S},{default:v(()=>[F(" 重置所有按钮配置 ")]),_:1}),h(b,{type:"default",onClick:I},{default:v(()=>[F(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","elementData","formData","formDefaults","formOption","form-options"]))}}});const Ve=Fe(ln,[["__scopeId","data-v-3be1eb32"]]);function xt(e){return E.get("/sapier-flow/dev-form/list",{params:e})}function nn(){return pe(()=>xt({size:-1}).then(e=>e.data.records))}function an(e){return E.post("/sapier-flow/dev-form/submit",e)}function rn(e){return E.post("/sapier-flow/dev-form/submit",e)}function sn(e){return E.post("/sapier-flow/dev-form/remove",{},{params:{ids:e}})}function Ut(e){return E.get("/sapier-flow/dev-flow/list",{params:e})}function un(){return pe(()=>Ut({size:-1}).then(e=>e.data.records))}function cn(e){return E.post("/sapier-flow/dev-flow/submit",e)}function dn(e){return E.post("/sapier-flow/dev-flow/submit",e)}function fn(e){return E.post("/sapier-flow/dev-flow/remove",{},{params:{ids:e}})}var At=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(At||{});function Ft(e){return E.get("/sapier-flow/dev-table/list",{params:e})}function pn(){return pe(()=>Ft({size:-1}).then(e=>e.data.records))}function mn(e){return E.post("/sapier-flow/dev-table/save",e)}function vn(e){return E.post("/sapier-flow/dev-table/update",e)}function yn(e){return E.post("/sapier-flow/dev-table/remove",{},{params:{ids:e}})}function bn(e){return E.post("/sapier-flow/dev-table/deploy",e)}function Qe(e){return new Promise((o,t)=>{(H(e)?e.value:e).validate((r,i,a)=>{r?(i(),o(a)):t(a)})})}const _n=Q("span",null,"流程设计",-1),wn={key:0},gn={key:1},hn={style:{height:"calc(100vh - 144px)"}},kn=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},emits:["close"],setup(e,{emit:o}){const l=Ce(e),{visible:r,modelValue:i}=l,a=["流程信息","表单设计","模型设计","完成"],n=O(!1);oe(r,async k=>{if(!k)return;const{flowModuleId:_}=i.value,{flowDeployId:b}=i.value;try{n.value=!0;let w={};b?w=await Lt({flowDeployId:b}):_&&(w=await It({flowModuleId:_})),i.value=w.data}finally{n.value=!1}},{immediate:!0});const{data:u}=nn(),{data:s}=un(),{data:d}=pn(),y=R(()=>{var k,_;return(_=(k=d.value)==null?void 0:k.find(b=>b.tableName===i.value.formDataTable))==null?void 0:_.tableFields}),f=O(0),p=R(()=>{var k,_;return f.value===1?((k=u.value)==null?void 0:k.map(b=>({label:b.formName,value:b.formOption})))??[]:f.value===2?((_=s.value)==null?void 0:_.map(b=>({label:b.flowName,value:b.flowData})))??[]:[]});function m(k){f.value===1?i.value.formOption=k.value:f.value===2&&(i.value.flowData=k.value)}const g=O();async function C(k){f.value===0&&await Qe(g),n.value=!0;const{flowModuleId:_}=i.value,{flowDeployId:b}=i.value;try{b?await Nt(i.value):_?await Fl(i.value):await Al(i.value).then(w=>{i.value.flowModuleId=w.data.flowModuleId}),Z.success("保存成功")}finally{n.value=!1}typeof k=="number"?f.value=k:f.value++}async function S(){await ge.confirm("发布新版本，是否确认？","提示"),n.value=!0,Tt({flowModuleId:i.value.flowModuleId}).then(()=>{Z.success("发布成功")}).finally(()=>{n.value=!1})}function I(){r.value=!1,f.value=0,i.value={},o("close")}return(k,_)=>{const b=V("el-link"),w=V("el-dropdown-item"),P=V("el-dropdown-menu"),T=V("el-dropdown"),L=V("el-col"),D=V("el-step"),x=V("el-steps"),U=V("el-button"),z=V("el-row"),A=V("avue-form"),W=V("el-result"),ce=V("el-dialog"),me=ct("loading");return $(),N(ce,{modelValue:c(r),"onUpdate:modelValue":_[4]||(_[4]=q=>H(r)?r.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:I},{header:v(()=>[h(z,{align:"center",justify:"center"},{default:v(()=>[h(L,{span:5},{default:v(()=>{var q,de,$e,qe;return[Q("div",null,[_n,(q=c(i))!=null&&q.flowName?($(),B("span",wn," - "+j((de=c(i))==null?void 0:de.flowName),1)):M("",!0),($e=c(i))!=null&&$e.version?($(),B("span",gn," - V"+j((qe=c(i))==null?void 0:qe.version),1)):M("",!0)]),c(p).length?($(),N(T,{key:0},{dropdown:v(()=>[h(P,null,{default:v(()=>[($(!0),B(Y,null,re(c(p),De=>($(),N(w,{key:De.label,onClick:wa=>m(De)},{default:v(()=>[F(j(De.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:v(()=>[h(b,{icon:"el-icon-arrow-down",underline:!1},{default:v(()=>[F(" 选择模板 ")]),_:1})]),_:1})):M("",!0)]}),_:1}),h(L,{span:14},{default:v(()=>[h(x,{active:f.value,simple:"","process-status":"finish","finish-status":"success"},{default:v(()=>[($(),B(Y,null,re(a,(q,de)=>h(D,{key:de,title:q,onClick:$e=>C(de)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),h(L,{span:5,style:{"text-align":"right"}},{default:v(()=>[h(U,{disabled:f.value===0,loading:n.value,type:"primary",onClick:_[0]||(_[0]=q=>f.value--)},{default:v(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),h(U,{disabled:f.value===a.length-1,type:"primary",loading:n.value,onClick:C},{default:v(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),h(U,{onClick:I},{default:v(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:v(()=>[he(($(),B("div",hn,[f.value===0?($(),N(A,{key:0,ref_key:"formRef",ref:g,modelValue:c(i),"onUpdate:modelValue":_[1]||(_[1]=q=>H(i)?i.value=q:null),option:c(je),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):M("",!0),f.value===1?($(),N(We,{key:1,modelValue:c(i).formOption,"onUpdate:modelValue":_[2]||(_[2]=q=>c(i).formOption=q),fields:c(y)},null,8,["modelValue","fields"])):M("",!0),f.value===2?($(),N(Ve,{key:2,modelValue:c(i).flowData,"onUpdate:modelValue":_[3]||(_[3]=q=>c(i).flowData=q),"flow-form-option":c(i).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),f.value===3?($(),N(W,{key:3,icon:"success",title:"流程设计完成"},{extra:v(()=>[c(i).flowDeployId?M("",!0):($(),N(U,{key:0,type:"primary",onClick:S},{default:v(()=>[F(" 发布 ")]),_:1})),h(U,{onClick:I},{default:v(()=>[F(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[me,n.value]])]),_:1},8,["modelValue"])}}}),Cn=Q("span",null,"流程查看",-1),Vn={key:0},$n={key:1},Dn=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},setup(e){const t=Ce(e),{visible:l,modelValue:r}=t,i=O("form"),a=O(!1);oe(l,async u=>{if(!u)return;const{flowModuleId:s}=r.value,{flowDeployId:d}=r.value;try{a.value=!0;let y={};d?y=await Lt({flowDeployId:d}):s&&(y=await It({flowModuleId:s})),r.value={...y.data}}finally{a.value=!1}},{immediate:!0});function n(){r.value={},i.value="form"}return(u,s)=>{const d=V("el-tab-pane"),y=V("el-tabs"),f=V("el-dialog"),p=ct("loading");return $(),N(f,{modelValue:c(l),"onUpdate:modelValue":s[3]||(s[3]=m=>H(l)?l.value=m:null),width:"60%",top:"0",onClose:n},{header:v(()=>{var m,g,C,S;return[Cn,(m=c(r))!=null&&m.flowName?($(),B("span",Vn," - "+j((g=c(r))==null?void 0:g.flowName),1)):M("",!0),(C=c(r))!=null&&C.version?($(),B("span",$n," - V"+j((S=c(r))==null?void 0:S.version),1)):M("",!0)]}),default:v(()=>[he(($(),N(y,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=m=>i.value=m)},{default:v(()=>[h(d,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:v(()=>[i.value==="form"&&c(r).formOption?($(),N(We,{key:0,modelValue:c(r).formOption,"onUpdate:modelValue":s[0]||(s[0]=m=>c(r).formOption=m),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),h(d,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:v(()=>[i.value==="flow"?($(),N(Ve,{key:0,modelValue:c(r).flowData,"onUpdate:modelValue":s[1]||(s[1]=m=>c(r).flowData=m),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[p,a.value]])]),_:1},8,["modelValue"])}}}),On=K({__name:"index",setup(e){const o=O("definition"),t=O({}),l=O(""),r=O("");function i(m){l.value===m.id?l.value="":l.value=m.id}const a=O(!1),n=O(!1);function u(){t.value={},a.value=!0}function s(m){t.value=m,a.value=!0}function d(m){t.value=m,n.value=!0}function y(m){r.value=m.flowModuleId||"",o.value="deploy"}function f(){r.value="",o.value="definition"}async function p(){const m=o.value;await te(),o.value="",await te(),o.value=`${m}`}return(m,g)=>{const C=V("el-col"),S=V("el-row");return $(),N(S,{gutter:20},{default:v(()=>[h(C,{span:4},{default:v(()=>[h(ql,{onNodeClick:i})]),_:1}),h(C,{span:20},{default:v(()=>[o.value==="definition"?($(),N(St,{key:0,"category-id":l.value,onAdd:u,onEdit:s,onView:d,onVersion:y},null,8,["category-id"])):M("",!0),o.value==="deploy"?($(),N(Rt,{key:1,"flow-module-id":r.value,onEdit:s,onView:d,onBack:f},null,8,["flow-module-id"])):M("",!0),h(kn,{modelValue:t.value,"onUpdate:modelValue":g[0]||(g[0]=I=>t.value=I),visible:a.value,"onUpdate:visible":g[1]||(g[1]=I=>a.value=I),onClose:p},null,8,["modelValue","visible"]),h(Dn,{modelValue:t.value,"onUpdate:modelValue":g[2]||(g[2]=I=>t.value=I),visible:n.value,"onUpdate:visible":g[3]||(g[3]=I=>n.value=I)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),In={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]};function Tn(e){return E.get("/sapier-flow/flow-ops/list",{params:e})}function Sn(e){return E.get("/sapier-flow/flow-run/queryPublishFlowDetail",{params:e})}function En(e){return E.post("/sapier-flow/flow-run/queryApprovalNode",e)}function Ln(e){return E.post("/sapier-flow/flow-run/startProcess",e)}function Nn(e){return E.post("/sapier-flow/flow-run/commitTask",e)}function Rn(e){return E.post("/sapier-flow/flow-run/saveDraft",e)}function Pn(e){return E.post("/sapier-flow/flow-run/revokeTask",e)}function xn(e){const{flowDetail:o,formVariables:t,approvalFormData:l,debug:r}=e,{flowDeployId:i}=o.value.process??{},{taskId:a,flowInstanceId:n}=o.value.task??{},u={flowDeployId:i,taskId:a,flowInstanceId:n,variables:t.value,debug:r.value,...l.value};return{flow_draft(){if(a&&n)return Rn(u)},flow_pass(){return a&&n?Nn(u):Ln(u)},flow_revoke(){if(a&&n)return Pn(u)}}}function Un(e){const o=O({});return ee(async()=>{const t=H(e)?e.value:e,{formProperty:l}=(t==null?void 0:t.properties)||{};l!=null&&l.length&&(await te(),Object.keys(o.value).forEach(r=>{var n,u,s,d;const i=((n=o.value[r])==null?void 0:n.label)||"",a=l==null?void 0:l.find(y=>y.prop===r);if(o.value[r].display=a==null?void 0:a.display,o.value[r].disabled=a==null?void 0:a.disabled,o.value[r].detail=a==null?void 0:a.detail,o.value[r].readonly=a==null?void 0:a.readonly,o.value[r].rules=o.value[r].rules??[],a!=null&&a.required&&((u=o.value[r].rules)!=null&&u.some(y=>y.required)))return null;a!=null&&a.required?(s=o.value[r].rules)==null||s.push({required:!0,message:`${i}为必填项`}):o.value[r].rules=(d=o.value[r].rules)==null?void 0:d.filter(y=>!y.required)}))}),o}function An(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Fn(){return{complete:e=>e}}const Bt=Symbol("flowFormState");function Bn(e,o){const t=Ce(e,void 0,{passive:!0,deep:!0}),{flowDetail:l,modelValue:r,formLoading:i}=t;ee(()=>{const{flowKey:f,taskId:p,instanceId:m}=e;!f&&!p&&!m||(i.value=!0,Sn({flowKey:f,taskId:p,flowInstanceId:m}).then(g=>{l.value=g.data,r.value=g.data.formData||{}}).finally(()=>{i.value=!1}))});const a=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),n=R(()=>{var f,p,m,g;return a.value.fileTab===!0&&((g=(m=(p=(f=l.value)==null?void 0:f.properties)==null?void 0:p.formProperty)==null?void 0:m.find(C=>C.prop==="fileTab"))==null?void 0:g.display)}),u=R(()=>{var f,p,m,g;return a.value.trackTab===!0&&((g=(m=(p=(f=l.value)==null?void 0:f.properties)==null?void 0:p.formProperty)==null?void 0:m.find(C=>C.prop==="trackTab"))==null?void 0:g.display)}),s=O(!1),d=R(()=>Object.entries(r.value||{}).filter(([f])=>!f.startsWith("$")).map(([f,p])=>({key:f,value:p}))),y={...t,formData:r,formVariables:d,approvalVisible:s,showFileTab:n,showTrackTab:u,permission:a,emit:o};return at(Bt,y),y}function Mt(){return _e(Bt)}const Mn=K({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:o}=Ce(e,void 0,{passive:!0,deep:!0}),t=Un(e.flowDetail),{proxy:l}=Ae(),r=O({});ee(()=>{const{formOption:n}=e.flowDetail.process??{};r.value=dt.bind(l)(n||'{"menuBtn":false}'),r.value.detail=!!e.detail});const i=O();function a(){return Qe(i)}return{form:o,option:r,defaults:t,formRef:i,validate:a}},render(){return Ne(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}});function Kn(e){return E.get("/sapier-flow/flow-user-common/list",{params:{type:e,ascs:"sort"}})}function zn(e){return pe(()=>Kn(e.value).then(o=>o.data.records),{refreshDeps:[e]})}function jn(e){return E.post("/sapier-flow/flow-user-common/save",e)}function Wn(e){return E.post("/sapier-flow/flow-user-common/remove",{},{params:{ids:e}})}function Qn(e){return E.post("/sapier-flow/flow-user-common/batchUpdate",e)}const qn=K({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const t=ho(e,"modelValue"),l=O(!1),{activeBtn:r}=Mt(),i=R(()=>{var g;return(g=r.value)==null?void 0:g.buttonKey}),{data:a,refresh:n}=zn(i),u=R(()=>{var C,S,I;const g=t.value;if(g&&!((C=a.value)!=null&&C.some(k=>k.content===g))){const k=(((I=(S=a.value)==null?void 0:S[0])==null?void 0:I.sort)||1)-1;return[{content:g,sort:k},...a.value||[]]}return a.value});async function s(g){var C;await jn({...g,type:(C=r.value)==null?void 0:C.buttonKey}),Z.success("添加成功"),n()}async function d(g){await Wn(g.id),Z.success("删除成功"),n()}async function y(g,C){let S=C.parent.data;S=S.map((I,k)=>({id:I.id,sort:k+1})),await Qn(S),Z.success("修改排序成功"),n(),l.value=!1}function f(){l.value=!0}const p=O();async function m(g){var C;t.value=g.content,await te(),(C=p.value)==null||C.blur()}return(g,C)=>{const S=V("el-input"),I=V("el-text"),k=V("el-col"),_=V("el-button"),b=V("el-row"),w=V("el-tree"),P=V("el-popover");return $(),N(P,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:v(()=>[h(S,{ref_key:"inputRef",ref:p,modelValue:c(t),"onUpdate:modelValue":C[0]||(C[0]=T=>H(t)?t.value=T:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:C[1]||(C[1]=T=>l.value=!0),onBlur:C[2]||(C[2]=T=>l.value=!1)},null,8,["modelValue"])]),default:v(()=>[h(w,{data:c(u),"node-key":"content",draggable:"","allow-drop":(T,L,D)=>D!=="inner",props:{label:"content"},onNodeClick:m,onNodeDrop:y,onNodeDragStart:f},{default:v(({data:T})=>[h(b,{style:{width:"250px"}},{default:v(()=>[h(k,{span:20},{default:v(()=>[h(I,{truncated:"",title:T.content},{default:v(()=>[F(j(T.content),1)]),_:2},1032,["title"])]),_:2},1024),h(k,{span:4},{default:v(()=>[T.id?($(),N(_,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Le(L=>d(T),["stop"])},null,8,["onClick"])):($(),N(_,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Le(L=>s(T),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Hn=K({__name:"approval-form",emits:["confirm"],setup(e,{emit:o}){const t={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:l,approvalFormData:r,activeBtn:i,approvalVisible:a,formVariables:n,flowDetail:u}=Mt(),s=O([]),d=O([]),y=O(),f=O({}),p={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:m}]},{label:"抄送人",prop:"copyUser",span:24,rules:[{required:!0,message:"请选择抄送人"}]},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function m(b,w,P){var D;const T=s.value[0].type==="ParallelGateway",L=(D=s.value[0].children)==null?void 0:D.every(x=>Do([x],U=>d.value.some(z=>z.id===U.id)));if(d.value.length){if(T&&!L)return P("请在每个节点选择审批人")}else return P("请选择审批人");return!0}const g=O(),C=R(()=>{var b,w;return(w=(b=i.value)==null?void 0:b.approval)==null?void 0:w.includes("assignee")}),S=O(!1);ee(async()=>{var T,L,D;if(!a.value||!y.value)return;const{flowKey:b}=((T=u.value)==null?void 0:T.process)||{},{taskId:w}=((L=u.value)==null?void 0:L.task)||{};s.value=[],d.value=[];const P=w?"":"发起";if(r.value={assignee:{},outgoing:[],comment:l.value.comment||P},te(()=>{var x,U,z,A;f.value.assignee.display=C.value,f.value.copyUser.display=(U=(x=i.value)==null?void 0:x.approval)==null?void 0:U.includes("copyUser"),f.value.comment.display=(A=(z=i.value)==null?void 0:z.approval)==null?void 0:A.includes("comment")}),C.value){console.log("🚀 ~ file: approval-form.vue:120 ~ watchEffect ~ flowDetail:",u);const x=await En({flowKey:b,variables:n.value,taskId:w});s.value=ft(x.data??[],(z,A,W)=>{const ce=z.id||lo();return z.taskNodeKey=(W==null?void 0:W.taskNodeKey)??z.taskNodeKey,z.incoming=(W==null?void 0:W.incoming)??z.incoming,{...z,id:ce,disabled:z.type!=="user"}}),await te();const U=I(s.value);U&&((D=g.value)==null||D.setCheckedNodes([U]))}});function I(b){var w;if(b.length===1)return(w=b[0].children)!=null&&w.length?I(b[0].children):b[0]}async function k(b,w){var T,L;if(b.type!=="user")return;await te(),await te();const P=(T=g.value)==null?void 0:T.getCheckedNodes();d.value=P.filter(D=>D.type==="user"),(L=g.value)==null||L.setCheckedNodes(d.value)}async function _(){await Qe(y),S.value=!0;const b={},w={},P=new Set;d.value.forEach(T=>{const{taskNodeKey:L,incoming:D}=T;b[L]||(b[L]=new Set),T.userId&&b[L].add(T.userId),w[L]=[...b[L]].join(","),P.add(D)}),r.value.assignee=w,r.value.outgoing=[...P],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",l),o("confirm")}return(b,w)=>{const P=V("v-icon"),T=V("el-col"),L=V("el-tag"),D=V("avue-form"),x=V("el-row"),U=V("el-button"),z=V("el-dialog");return $(),N(z,{modelValue:c(a),"onUpdate:modelValue":w[4]||(w[4]=A=>H(a)?a.value=A:null),width:c(C)?"800px":"500px","append-to-body":""},{footer:v(()=>[h(U,{onClick:w[3]||(w[3]=A=>a.value=!1)},{default:v(()=>[F(" 取 消 ")]),_:1}),h(U,{type:"primary",onClick:_},{default:v(()=>[F(" 确 定 ")]),_:1})]),default:v(()=>[h(x,{gutter:20},{default:v(()=>[c(C)?($(),N(T,{key:0,span:10},{default:v(()=>[h(c(Oo),{ref_key:"treeRef",ref:g,class:"approval-tree","w-full":"","h-400px":"","overflow-y-scroll":"","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:s.value,style:{"max-height":"600px",overflow:"auto"},onCheckChange:k},{default:v(({data:A})=>[Q("div",null,[h(P,{icon:t[A.type],style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(A.title),1)])]),_:1},8,["data"])]),_:1})):M("",!0),h(T,{span:c(C)?14:24},{default:v(()=>[h(D,{ref_key:"formRef",ref:y,modelValue:c(r),"onUpdate:modelValue":w[1]||(w[1]=A=>H(r)?r.value=A:null),defaults:f.value,"onUpdate:defaults":w[2]||(w[2]=A=>f.value=A),option:p},{assignee:v(()=>[($(!0),B(Y,null,re(d.value,A=>($(),N(L,{key:A.id,type:"info"},{default:v(()=>[F(j(A.title),1)]),_:2},1024))),128))]),copyUser:v(()=>[]),comment:v(()=>[h(qn,{modelValue:c(r).comment,"onUpdate:modelValue":w[0]||(w[0]=A=>c(r).comment=A)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","width"])}}}),Jn={class:"flow-track"},Gn={key:0},Yn={key:1},Zn=K({__name:"flow-track",props:{flowDetail:null},setup(e){const o=e,t=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],l=O("table"),r=R(()=>{var s,d;return((d=(s=o.flowDetail)==null?void 0:s.flowHistory)==null?void 0:d.filter(y=>y.taskNodeType==="userTask"))??[]}),i={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},a=O(),n=O([]);ee(()=>{var s,d,y,f,p;(y=(d=(s=a==null?void 0:a.value)==null?void 0:s.DIC)==null?void 0:d.type)!=null&&y.length&&(n.value=(p=(f=a==null?void 0:a.value)==null?void 0:f.DIC)==null?void 0:p.type)});function u(s){var d;return(d=n.value)==null?void 0:d.find(y=>y.value===s)}return(s,d)=>{var I,k,_;const y=V("v-icon"),f=V("el-radio-button"),p=V("el-radio-group"),m=V("avue-crud"),g=V("el-card"),C=V("el-timeline-item"),S=V("el-timeline");return $(),B(Y,null,[h(p,{modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=b=>l.value=b)},{default:v(()=>[($(),B(Y,null,re(t,b=>h(f,{key:b.label,label:b.label},{default:v(()=>[h(y,{icon:b.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",Jn,[l.value==="table"?($(),N(m,{key:0,ref_key:"crudRef",ref:a,class:"hide-menu",data:c(r),option:i},null,8,["data"])):M("",!0),l.value==="graph"?($(),N(Ve,{key:1,"model-value":(k=(I=e.flowDetail)==null?void 0:I.process)==null?void 0:k.flowData,"flow-history":(_=e.flowDetail)==null?void 0:_.flowHistory,view:""},null,8,["model-value","flow-history"])):M("",!0),l.value==="timeline"?($(),N(S,{key:2},{default:v(()=>[($(!0),B(Y,null,re([...c(r)].reverse(),b=>($(),N(C,{key:b.id,timestamp:b.createTime,placement:"top"},{default:v(()=>[h(g,null,{default:v(()=>{var w,P;return[Q("div",null,j(b.assigneeName)+" 开始处理 ["+j(b.taskNodeName)+"] 环节 ",1),b.duration?($(),B("div",Gn," 办理时长："+j(b.duration),1)):M("",!0),b.type?($(),B("div",Yn,j((w=u(b.type))==null?void 0:w.label)+"意见："+j((P=b.comment)==null?void 0:P.comment),1)):M("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):M("",!0)])],64)}}});const Xn=Fe(Zn,[["__scopeId","data-v-ca0e858d"]]),ea=K({__name:"button-list",props:{flowDetail:null},emits:["click"],setup(e,{emit:o}){const t=e,{data:l}=Ot();function r(a,n){return a.map(u=>{const s=n.find(y=>y.buttonKey===u.buttonKey);return{...u,...Lo(s,["display","approval"])}})}const i=R(()=>{var m,g,C,S,I;const a={userId:"1"},{assignee:n,status:u}=((m=t.flowDetail)==null?void 0:m.task)||{},{createUser:s,flowInstanceId:d,status:y}=((g=t.flowDetail)==null?void 0:g.flowInstance)||{},f={true:!0,false:!1,startUser:s==a.userId,assignee:n==a.userId,todo:u==2,done:u==1,notstarted:!d,started:!!d,finished:y===1,unfinished:y===2};return((I=r(l.value??[],((S=(C=t.flowDetail)==null?void 0:C.properties)==null?void 0:S.button)??[]))==null?void 0:I.filter(k=>{var _,b;return(b=(_=k.display)==null?void 0:_.split(","))==null?void 0:b.every(w=>f[w])}))??[]});return(a,n)=>{const u=V("v-icon"),s=V("el-button");return $(!0),B(Y,null,re(c(i),d=>($(),N(s,{key:d.buttonKey,type:d.buttonType,onClick:y=>o("click",d)},{default:v(()=>[h(u,{icon:d.icon},null,8,["icon"]),F(" "+j(d.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),ta={class:"flow-form__title"},Kt=K({__name:"index",props:An(),emits:Fn(),setup(e,{emit:o}){const t=e,l=Bn(t,o),{flowDetail:r,modelValue:i,activeTab:a,activeBtn:n,formLoading:u,approvalVisible:s,submitLoading:d}=l,y=O();async function f(m){var g,C;n.value=m,await((g=y.value)==null?void 0:g.validate()),await((C=t.beforeClick)==null?void 0:C.call(t,m)),(m==null?void 0:m.approval)!=="false"?s.value=!0:p()}async function p(){var g,C;const m=xn(l);try{const{buttonKey:S}=n.value;d.value=!0,await((g=t.beforeSubmit)==null?void 0:g.call(t,n.value)),await((C=m[S])==null?void 0:C.call(m)),Z.success("操作成功"),s.value=!1,o("complete",n.value)}finally{d.value=!1}}return(m,g)=>{const C=V("el-skeleton"),S=V("el-main"),I=V("el-header"),k=V("el-tab-pane"),_=V("el-tabs"),b=V("el-container");return c(u)?($(),N(S,{key:0},{default:v(()=>[h(C)]),_:1})):($(),N(b,{key:1,class:"flow-form"},{default:v(()=>[h(I,{class:"flow-form__header"},{default:v(()=>{var w;return[Q("div",ta,j((w=c(r).flowInstance)==null?void 0:w.title),1),h(ea,{"flow-detail":c(r),onClick:f},null,8,["flow-detail"])]}),_:1}),h(S,{class:"flow-form__main"},{default:v(()=>[h(_,{modelValue:c(a),"onUpdate:modelValue":g[1]||(g[1]=w=>H(a)?a.value=w:null)},{default:v(()=>{var w,P;return[(P=(w=c(r))==null?void 0:w.process)!=null&&P.formPath?G(m.$slots,"default",{key:0}):($(),N(k,{key:1,label:"审批信息",name:"form"},{default:v(()=>[h(Mn,{ref_key:"formRef",ref:y,modelValue:c(i),"onUpdate:modelValue":g[0]||(g[0]=T=>H(i)?i.value=T:null),"flow-detail":c(r)},null,8,["modelValue","flow-detail"])]),_:1})),h(k,{label:"附件资料",name:"file",lazy:""}),h(k,{label:"流程跟踪",name:"track",lazy:""},{default:v(()=>[h(Xn,{"flow-detail":c(r)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),h(Hn,{onConfirm:p})]),_:3}))}}});function zt(e,o){switch(o.type){case"window":return oa(e,o);case"dialog":case"drawer":return la(e,o);default:return{open:()=>{},close:()=>{}}}}function oa(e,o){const{window:{url:t="",name:l="flow-form",features:r="left=0,top=0,width=1600,height=900"}={}}=o,i=O(null),a=R(()=>`${t}?${no(ao(e,ro(so,io)))}`);return{open:()=>{var s;i.value=window.open(a.value,l,r),(s=i.value)==null||s.addEventListener("message",d=>{const{event:y}=d.data,f=c(e)[y];typeof f=="function"&&f(d.data)})},close:()=>{var s;return(s=i.value)==null?void 0:s.close()},openedWindow:i}}function la(e,o){const{appContext:t}=Ae();let l;const r=()=>{l&&document.body.removeChild(l)};return{open:()=>{l=document.createElement("div"),l.className="flow-form-wrapper";const a=na(o.formPath),n=Ne(a,{...c(e)}),u=Ne(o.type==="dialog"?jo:el,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,"onUpdate:modelValue":s=>!s&&r,...o.overlay},n);u.appContext=t,yo(u,l),document.body.appendChild(l)},close:r}}function na(e){return e?bo(()=>_o(()=>import(e),[])):Kt}const aa=K({__name:"index",setup(e){const o=ko("debugMode",!1),{bindVal:t,getDataList:l}=le({tableOption:In,crudOption:{getList:Tn},searchForm:{status:2},sortOption:{descs:"start_time"}});l();const r=O({}),{open:i,close:a}=zt(r,{type:"drawer"});function n(u){r.value={flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,debug:o.value,onComplete:()=>{a(),l()}},i()}return(u,s)=>{const d=V("el-switch"),y=V("el-button"),f=V("el-link"),p=V("avue-crud");return $(),N(p,se(ie(c(t))),{"menu-right":v(()=>[h(y,{type:"text"},{default:v(()=>[h(d,{modelValue:c(o),"onUpdate:modelValue":s[0]||(s[0]=m=>H(o)?o.value=m:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:v(({row:m})=>[h(f,{type:"primary",underline:!1,onClick:g=>n(m)},{default:v(()=>[F(j(m.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}});var jt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(jt||{});const Re=ae(jt),ra={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Re},{label:"备注",prop:"remark"}]},sa=K({__name:"index",setup(e){const{bindVal:o,getDataList:t}=le({tableOption:ra,crudOption:{getList:Hl,create:Jl,update:Gl,remove:Yl}});return t(),(l,r)=>{const i=V("avue-crud");return $(),N(i,se(ie(c(o))),null,16)}}}),ia={class:"flow-list"},ua=["onClick"],ca={class:"flow-name"},da=K({__name:"index",setup(e){const o=O([]);Kl().then(a=>{o.value=a.data});const t=O({}),{open:l,close:r}=zt(t,{type:"drawer"});function i(a){t.value={flowKey:a.flowKey,onComplete:r},l()}return(a,n)=>{const u=V("v-icon");return $(),B("div",ia,[($(!0),B(Y,null,re(o.value,s=>($(),B("div",{key:s.flowKey,class:"flow-item",onClick:d=>i(s)},[h(u,{class:"flow-icon",icon:s.flowIcon,width:"60"},null,8,["icon"]),Q("div",ca,j(s.flowName),1)],8,ua))),128))])}}});const fa=Fe(da,[["__scopeId","data-v-144fd383"]]),pa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},ma=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,handleUpdate:r}=le({tableOption:pa,crudOption:{getList:Ut,create:cn,update:dn,remove:fn}});l();const i=O(!1);async function a(u){t.value=u,i.value=!0}async function n(){await r(t.value,NaN,()=>i.value=!1,()=>{})}return(u,s)=>{const d=V("el-button"),y=V("avue-crud"),f=V("el-dialog");return $(),B(Y,null,[h(y,se(ie(c(o))),{flowData:v(({row:p})=>[h(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>a(p)},{default:v(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),h(f,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=p=>i.value=p),title:`模型设计-${c(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:v(()=>[h(d,{type:"primary",onClick:n},{default:v(()=>[F(" 保存 ")]),_:1}),h(d,{onClick:s[1]||(s[1]=p=>i.value=!1)},{default:v(()=>[F(" 取消 ")]),_:1})]),default:v(()=>[h(Ve,{modelValue:c(t).flowData,"onUpdate:modelValue":s[0]||(s[0]=p=>c(t).flowData=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),va={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},ya=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,handleUpdate:r}=le({tableOption:va,crudOption:{getList:xt,create:an,update:rn,remove:sn},mockCache:"form-template"});l();const i=O(!1);async function a(u){t.value={...u},i.value=!0}async function n(){await r(t.value,NaN,()=>i.value=!1,()=>{})}return(u,s)=>{const d=V("el-button"),y=V("avue-crud"),f=V("el-dialog");return $(),B(Y,null,[h(y,se(ie(c(o))),{formOption:v(({row:p})=>[h(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>a(p)},{default:v(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),h(f,{modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=p=>i.value=p),title:`表单设计-${c(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:v(()=>[h(d,{type:"primary",onClick:n},{default:v(()=>[F(" 保存 ")]),_:1}),h(d,{onClick:s[1]||(s[1]=p=>i.value=!1)},{default:v(()=>[F(" 取消 ")]),_:1})]),default:v(()=>[h(We,{modelValue:c(t).formOption,"onUpdate:modelValue":s[0]||(s[0]=p=>c(t).formOption=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),ba={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreated:!0,defaultFirstOption:!0,dicData:ae(At)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Re,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Re,value:1}]}}]},_a=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,afterGetList:r,beforeOpen:i,beforeSave:a,beforeUpdate:n}=le({crudOption:{getList:Ft,create:mn,update:vn,remove:yn},tableOption:ba}),u=O([]);r(()=>{Pt("table.default.fields").then(y=>{u.value=y.data})}),l(),i(y=>{y==="add"?t.value.tableFields=u.value:t.value.tableFields=JSON.parse(t.value.tableFields)}),a(y=>{y.tableFields=JSON.stringify(y.tableFields)}),n(y=>{y.tableFields=JSON.stringify(y.tableFields)});const s=O(!1);async function d(y){await ge.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),s.value=!0,bn({id:y.id}).then(()=>{Z.success("部署成功"),l()}).finally(()=>{s.value=!1})}return(y,f)=>{const p=V("el-button"),m=V("avue-crud");return $(),N(m,se(ie(c(o))),{menu:v(({row:g})=>[h(p,{type:"text",icon:"el-icon-upload",onClick:C=>d(g)},{default:v(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Cr={install(e){e.component("FlowButton",Pl),e.component("FlowDefinition",St),e.component("FlowDeploy",Rt),e.component("FlowForm",Kt),e.component("FlowManage",On),e.component("FlowOps",aa),e.component("FlowParam",sa),e.component("FlowTemplate",ma),e.component("FormTemplate",ya),e.component("TableTemplate",_a),e.component("FlowWorkbench",fa)}};export{Pl as FlowButton,St as FlowDefinition,Rt as FlowDeploy,Kt as FlowForm,On as FlowManage,aa as FlowOps,sa as FlowParam,ma as FlowTemplate,ya as FormTemplate,_a as TableTemplate,fa as Workbench,Cr as default};
