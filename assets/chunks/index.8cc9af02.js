import{h as x,a9 as fe,aB as Se,D as Be,d as L,J as v,b as O,w as o,a7 as j,a8 as J,l as m,o as k,N as i,a as V,t as B,A as se,B as Q,g as W,n as Ke,c as P,L as ee,R as we,K as H,e as M,z as ye,aM as be,k as G,a5 as ge,E as ve,_ as Ae}from"./framework.c2983551.js";import"./index.deecc6ab.js";import{s as Ee,u as R,e as Re}from"./index.013ebf7e.js";import{c as te,d as N,C as ze,t as je,e as Je,f as We,g as He,h as ne,i as Ge,F as ie,b as Qe,j as Ye,T as q,w as Xe,k as ke,l as Ze,m as qe}from"./mobile.fb990cfb.js";import{G as ko,I as Do,B as Vo,A as Fo,r as ho,q as Co,p as Oo,s as $o,o as Io,_ as xo,x as No,H as To,K as Lo,z as Po,L as Uo,W as Mo,D as So,O as Bo,N as Ko,J as Ao,P as Eo,R as Ro,E as zo,M as jo,n as Jo,v as Wo,y as Ho,a as Go,u as Qo,Q as Yo}from"./mobile.fb990cfb.js";import{m as ue,a as Y,E as A}from"./index.ce0b877c.js";import{o as De}from"./omitBy.d2a19f53.js";import{a as et}from"./snakeCase.7099c4a4.js";import{K as tt}from"./index.ccfd64e4.js";import{C as ot}from"./index.2fcafa0b.js";import{J as lt,K as at}from"../app.a8f0c0f5.js";import{I as Z}from"./iconify.4639d8e3.js";import"./index.038acb2e.js";import"./index.02ba6ccf.js";import{j as nt,H as st}from"./tree.82fe43ad.js";import"./vuedraggable.umd.5daff888.js";import{p as Ve}from"./index.vue_vue_type_script_setup_true_lang.c9440674.js";import{w as oe,a as re,u as it,h as ut,i as rt}from"./index.d990ce32.js";import{f as dt}from"./form.87a8a395.js";import{d as ct}from"./differenceBy.715de9ac.js";import"./dayjs.min.50666642.js";import"./omit.1bac3483.js";import"./createCompounder.45a3c61a.js";import"./theme.fc185fef.js";import"./kebabCase.f05af6b4.js";import"./vue.runtime.esm-bundler.3b5cdda3.js";function Fe(d){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},u=f=>d.get(e.list,{params:f});return{getList:u,useList:()=>te(()=>u({size:-1}).then(f=>f.data)),getTree:f=>d.get(e.tree,{params:f}),create:f=>d.post(e.save,f),update:f=>d.post(e.update,f),remove:f=>d.post(e.remove,{},{params:{ids:f}})}}function le(d){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},u=c=>d.get(e.list,{params:c});return{url:e,getList:u,useList:()=>te(()=>u({size:-1}).then(c=>c.data.records)),create:c=>d.post(e.save,c),update:c=>d.post(e.update,c),remove:c=>d.post(e.remove,{},{params:{ids:c}}),deploy:c=>d.post(e.deploy,c),getDetail:c=>d.get(e.detail,{params:c})}}var he=(d=>(d[d.否=0]="否",d[d.是=1]="是",d))(he||{});function de(d){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:s=>d.get(e.list,{params:s}),getDetail:s=>d.get(e.detail,{params:s}),update:s=>d.post(e.update,s),remove:s=>d.post(e.remove,{},{params:{ids:s}})}}function pt(d){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>d.get(e.list,{params:t})}}function Ce(d){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},u=p=>d.get(e.list,{params:p});return{url:e,getList:u,useList:()=>te(()=>u({size:-1}).then(p=>p.data.records)),create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}})}}function Oe(d){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},u=p=>d.get(e.list,{params:p});return{url:e,getList:u,useList:()=>te(()=>u({size:-1}).then(p=>p.data.records)),create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}})}}function $e(d,e){return e in(ze.useFlowFormOptions??{})}function Ie(d={}){const{useFlowFormOptions:e}=N(),u=ue({...e},{...d});switch(u==null?void 0:u.type){case"window":return mt(u);case"dialog":case"drawer":return ft(u);default:return{open:t=>{},close:()=>{}}}}function mt(d={}){const e=x(null);return{open:(a={})=>{var y;const n=ue({...d},{...a}),{window:[s,p,f]=[]}=n,c=`${s}?${Ee(De(n,et(tt,ot,$e)))}`;e.value=window.open(c,p,f),(y=e.value)==null||y.addEventListener("message",D=>{const{event:_,data:g}=D.data,l=a[_];typeof l=="function"&&l(g)})},close:()=>{var a;return(a=e.value)==null?void 0:a.close()},openedWindow:e}}function ft(d={}){const{appContext:e}=Be(),{FlowForm:u}=N();let t,a;const n=p=>{t=document.createElement("div"),t.className="flow-form-wrapper";const f=ue({...d},{...p}),c=fe(u,De(f,$e));a=fe(f.type==="dialog"?lt:at,{class:"flow-form-overlay",modelValue:!0,onClose:s,...f.overlay},c),a.appContext=e,Se(a,t),document.body.appendChild(t)},s=()=>{var p,f;(f=(p=a==null?void 0:a.component)==null?void 0:p.props)!=null&&f.modelValue&&(a.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:n,close:s}}const vt=L({__name:"index",setup(d){const{request:e}=N(),{bindVal:u,crudStateRefs:{formData:t},getDataList:a}=R({tableOption:je,crudOption:Je(e),sortOption:{ascs:"sort"}});return a(),(n,s)=>{const p=v("el-button"),f=v("avue-crud");return k(),O(f,j(J(m(u))),{icon:o(({row:c})=>[i(m(Z),{icon:c.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:c})=>[i(p,{type:c.buttonType},{default:o(()=>[i(m(Z),{icon:c.icon},null,8,["icon"]),V(" "+B(c.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[i(p,{type:m(t).buttonType},{default:o(()=>[i(m(Z),{icon:m(t).icon},null,8,["icon"]),V(" "+B(m(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),xe=L({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(d,{emit:e}){const u=d,{request:t}=N(),{getList:a,deploy:n,update:s,remove:p}=le(t),{bindVal:f,crudStateRefs:{searchForm:c},getDataList:y}=R({tableOption:We,crudOption:{getList:a,remove:p},searchForm:{categoryId:u.categoryId}});se(()=>{c.value.categoryId=u.categoryId??""}),oe(c,y,{debounce:300,immediate:!0,deep:!0});const D=x(!1);async function _(r){await Y.confirm("发布新版本，是否确认？","提示",{type:"success"}),D.value=!0,n({flowModuleId:r.flowModuleId}).then(()=>{A.success("发布成功"),y()}).finally(()=>{D.value=!1})}async function g(r){if(r.mainVersion)return A.warning("请先删除已发布的流程");await Y.confirm("确认删除？","提示",{type:"warning"}),await p(r.flowModuleId),A.success("删除成功"),y()}function l(r){s(Ve(r,["flowModuleId","sort"]))}return(r,w)=>{const b=v("el-button"),F=v("el-dropdown-item"),T=v("el-input-number"),h=v("avue-crud");return k(),O(h,j(J(m(f))),{"menu-left":o(()=>[i(b,{type:"primary",icon:"el-icon-plus",onClick:w[0]||(w[0]=C=>e("add"))},{default:o(()=>[V(" 新增 ")]),_:1})]),"menu-btn":o(({row:C})=>[i(F,{icon:"el-icon-view",onClick:I=>e("view",C)},{default:o(()=>[V(" 查看 ")]),_:2},1032,["onClick"]),i(F,{icon:"el-icon-edit",onClick:I=>e("edit",C)},{default:o(()=>[V(" 编辑 ")]),_:2},1032,["onClick"]),i(F,{icon:"el-icon-delete",onClick:I=>g(C)},{default:o(()=>[V(" 删除 ")]),_:2},1032,["onClick"]),i(F,{icon:"el-icon-upload",onClick:I=>_(C)},{default:o(()=>[V(" 发布 ")]),_:2},1032,["onClick"]),i(F,{icon:"el-icon-switch",onClick:I=>e("version",C)},{default:o(()=>[V(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:C})=>[i(m(Z),{icon:C.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:C})=>[i(T,{modelValue:C.sort,"onUpdate:modelValue":I=>C.sort=I,"controls-position":"right",style:{width:"100%"},onChange:I=>l(C)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),Ne=L({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(d,{emit:e}){const u=d,{request:t}=N(),{getList:a,update:n,remove:s}=de(t),{bindVal:p,crudStateRefs:{searchForm:f},getDataList:c}=R({tableOption:He,crudOption:{getList:a,dataPath:"res.data"}});se(()=>{f.value.flowModuleId=u.flowModuleId}),oe(f,c,{debounce:300,immediate:!0,deep:!0});const y=x(!1);async function D(l){await Y.confirm(`确定将 ${l.flowName}(${l.flowKey}:v${l.version}) 设为主版本?`,"提示",{type:"warning"}),y.value=!0,n({flowDeployId:l.flowDeployId,flowModuleId:l.flowModuleId,mainVersion:1}).then(()=>{A.success("设置成功"),c()}).finally(()=>{y.value=!1})}async function _(l){const{value:r}=await Y.prompt("请输入确认删除的流程标识","提示",{type:"warning"});r===l.flowKey&&(await s(l.flowDeployId),A.success("删除成功"),c())}function g(l){n(Ve(l,["flowDeployId","flowModuleId","sort"]))}return(l,r)=>{const w=v("el-button"),b=v("el-dropdown-item"),F=v("el-input-number"),T=v("avue-crud");return k(),O(T,j(J(m(p))),{"menu-left":o(()=>[i(w,{loading:y.value,type:"primary",icon:"el-icon-arrow-left",onClick:r[0]||(r[0]=h=>e("back"))},{default:o(()=>[V(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:h})=>[i(b,{icon:"el-icon-view",onClick:C=>e("view",h)},{default:o(()=>[V(" 查看 ")]),_:2},1032,["onClick"]),i(b,{icon:"el-icon-edit",onClick:C=>e("edit",h)},{default:o(()=>[V(" 编辑 ")]),_:2},1032,["onClick"]),i(b,{icon:"el-icon-delete",onClick:C=>_(h)},{default:o(()=>[V(" 删除 ")]),_:2},1032,["onClick"]),i(b,{icon:"el-icon-switch",disabled:h.mainVersion===m(he).是,onClick:C=>D(h)},{default:o(()=>[V(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:h})=>[i(m(Z),{icon:h.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:h})=>[i(F,{modelValue:h.sort,"onUpdate:modelValue":C=>h.sort=C,"controls-position":"right",style:{width:"100%"},onChange:C=>g(h)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),_e={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},_t=L({__name:"index",emits:["node-click"],setup(d,{emit:e}){const{request:u}=N(),{crudStateRefs:{formData:t,tableData:a},getDataList:n,handleSave:s,handleUpdate:p,handleDel:f}=R({crudOption:{rowKey:"id",...Fe(u),dataPath:"res.data"},tableOption:_e,pageOption:{pageSize:20}});n();function c(_,g,l,r){s(g,l,r)}function y(_,g,l,r){p(g,Number.NaN,l,r)}async function D(_,g){await f(_.data,Number.NaN),g()}return(_,g)=>{const l=v("avue-tree");return k(),O(l,{modelValue:m(t),"onUpdate:modelValue":g[0]||(g[0]=r=>Q(t)?t.value=r:null),option:m(_e),data:m(a),onNodeClick:g[1]||(g[1]=r=>e("node-click",r)),onSave:c,onUpdate:y,onDel:D},null,8,["modelValue","option","data"])}}}),ce=L({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(d,{emit:e}){var f;const u=d,{FormDesign:t}=N(),a=W({get(){return u.modelValue?nt(u.modelValue):{menuBtn:!1,span:24}},set(c){e("update:modelValue",st(c,{useJson5:!1}))}}),n=W(()=>u.fields?JSON.parse(u.fields):[]),s=W(()=>{const c={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...c,props:{label:"name",value:"name",desc:"comment"}},{...c,props:{label:"comment",value:"comment",desc:"name"}}]}),p={form:{settings:Array.from({length:((f=dt.settings)==null?void 0:f.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(c,y)=>{const D=v("avue-form");return c.view?(k(),O(D,{key:0,class:Ke(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(k(),O(m(t),{key:1,modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=_=>a.value=_),"base-option":s.value,resources:p},null,8,["modelValue","base-option"]))}}}),wt={key:1},yt=L({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(d){const e=d,{formData:u,activeStep:t}=re(e),{request:a}=N(),{getDetail:n,useList:s}=le(a),{data:p}=Oe(a).useList(),{data:f}=Ce(a).useList(),{data:c}=s(),y=W(()=>{var _,g,l,r;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((_=p.value)==null?void 0:_.map(w=>({label:w.formName,value:w.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((g=c.value)==null?void 0:g.map(w=>({label:w.flowName,value:w.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((l=f.value)==null?void 0:l.map(w=>({label:w.flowName,value:w.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((r=c.value)==null?void 0:r.map(w=>({label:w.flowName,value:w.flowModuleId,type:"definition"})))??[]]:[]});async function D(_){if((t==null?void 0:t.value)===1){if(_.type==="template")u.value.formOption=_.value;else if(_.type==="definition"){const g=await n({flowModuleId:_.value});u.value.formOption=g.data.formOption}}else if((t==null?void 0:t.value)===2){if(_.type==="template")u.value.flowData=_.value;else if(_.type==="definition"){const g=await n({flowModuleId:_.value});u.value.flowData=g.data.flowData}}}return(_,g)=>{const l=v("el-link"),r=v("el-divider"),w=v("el-dropdown-item"),b=v("el-scrollbar"),F=v("el-dropdown-menu"),T=v("el-dropdown");return y.value.length?(k(),O(T,{key:0},{dropdown:o(()=>[i(F,null,{default:o(()=>[i(b,{"max-height":"600px"},{default:o(()=>[(k(!0),P(H,null,ee(y.value,h=>(k(),O(w,we({key:h.label},h,{disabled:h.type==="divider",onClick:C=>D(h)}),{default:o(()=>[h.type==="divider"?(k(),O(r,{key:0},{default:o(()=>[V(B(h.label),1)]),_:2},1024)):(k(),P("span",wt,B(h.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[i(l,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[V(" 选择模板 ")]),_:1})]),_:1})):M("",!0)}}}),bt=G("span",null,"流程设计",-1),gt={key:0},kt={key:1},Dt={style:{height:"calc(100vh - 144px)"}},Vt=L({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(d,{emit:e}){const t=re(d),{visible:a,modelValue:n}=t,{request:s}=N(),{create:p,deploy:f,getDetail:c,update:y}=le(s),{getDetail:D,update:_}=de(s),g=["流程信息","表单设计","模型设计","完成"],l=x(!1);ye(a,async I=>{if(!I)return;const{flowModuleId:$}=n.value,{flowDeployId:S}=n.value;try{l.value=!0;let z={};S?z=await D({flowDeployId:S}):$&&(z=await c({flowModuleId:$})),n.value=z.data}finally{l.value=!1}},{immediate:!0});const{data:r}=ne(s).useList(),w=W(()=>{var I,$;return($=(I=r.value)==null?void 0:I.find(S=>S.tableName===n.value.formDataTable))==null?void 0:$.tableFields}),b=x(0),F=x();async function T(I){b.value===0&&await Qe(F),l.value=!0;const{flowModuleId:$}=n.value,{flowDeployId:S}=n.value;try{S?await _(n.value):$?await y(n.value):await p(n.value).then(z=>{n.value.flowModuleId=z.data.flowModuleId}),A.success("保存成功")}finally{l.value=!1}typeof I=="number"?b.value=I:b.value++}async function h(){await Y.confirm("发布新版本，是否确认？","提示"),l.value=!0,f({flowModuleId:n.value.flowModuleId}).then(()=>{A.success("发布成功")}).finally(()=>{l.value=!1})}function C(){a.value=!1,b.value=0,n.value={},e("close")}return(I,$)=>{const S=v("el-col"),z=v("el-step"),E=v("el-steps"),K=v("el-button"),pe=v("el-row"),Te=v("avue-form"),Le=v("el-result"),Pe=v("el-dialog"),Ue=be("loading");return k(),O(Pe,{modelValue:m(a),"onUpdate:modelValue":$[6]||($[6]=U=>Q(a)?a.value=U:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:C},{header:o(()=>[i(pe,{justify:"center"},{default:o(()=>[i(S,{span:5},{default:o(()=>{var U,X,ae,me;return[G("div",null,[bt,(U=m(n))!=null&&U.flowName?(k(),P("span",gt," - "+B((X=m(n))==null?void 0:X.flowName),1)):M("",!0),(ae=m(n))!=null&&ae.version?(k(),P("span",kt," - V"+B((me=m(n))==null?void 0:me.version),1)):M("",!0)]),i(yt,{"form-data":m(n),"onUpdate:formData":$[0]||($[0]=Me=>Q(n)?n.value=Me:null),"active-step":b.value},null,8,["form-data","active-step"])]}),_:1}),i(S,{span:14},{default:o(()=>[i(E,{active:b.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(k(),P(H,null,ee(g,(U,X)=>i(z,{key:X,title:U,style:{cursor:"pointer"},onClick:ae=>T(X)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),i(S,{span:5,style:{"text-align":"right"}},{default:o(()=>[i(K,{disabled:b.value===0,loading:l.value,type:"primary",onClick:$[1]||($[1]=U=>b.value--)},{default:o(()=>[V(" 上一步 ")]),_:1},8,["disabled","loading"]),i(K,{disabled:b.value===g.length-1,type:"primary",loading:l.value,onClick:$[2]||($[2]=U=>T())},{default:o(()=>[V(" 下一步 ")]),_:1},8,["disabled","loading"]),i(K,{onClick:C},{default:o(()=>[V(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[ge((k(),P("div",Dt,[b.value===0?(k(),O(Te,{key:0,ref_key:"formRef",ref:F,modelValue:m(n),"onUpdate:modelValue":$[3]||($[3]=U=>Q(n)?n.value=U:null),option:m(Ge),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):M("",!0),b.value===1?(k(),O(ce,{key:1,modelValue:m(n).formOption,"onUpdate:modelValue":$[4]||($[4]=U=>m(n).formOption=U),fields:w.value},null,8,["modelValue","fields"])):M("",!0),b.value===2?(k(),O(ie,{key:2,modelValue:m(n).flowData,"onUpdate:modelValue":$[5]||($[5]=U=>m(n).flowData=U),"flow-form-option":m(n).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),b.value===3?(k(),O(Le,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[m(n).flowDeployId?M("",!0):(k(),O(K,{key:0,type:"primary",onClick:h},{default:o(()=>[V(" 发布 ")]),_:1})),i(K,{onClick:C},{default:o(()=>[V(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[Ue,l.value]])]),_:1},8,["modelValue"])}}}),Ft=G("span",null,"流程查看",-1),ht={key:0},Ct={key:1},Ot=L({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(d){const u=re(d),{visible:t,modelValue:a}=u,{request:n}=N(),{getDetail:s}=le(n),{getDetail:p}=de(n),f=x("form"),c=x(!1);ye(t,async D=>{if(!D)return;const{flowModuleId:_}=a.value,{flowDeployId:g}=a.value;try{c.value=!0;let l={};g?l=await p({flowDeployId:g}):_&&(l=await s({flowModuleId:_})),a.value={...l.data}}finally{c.value=!1}},{immediate:!0});function y(){a.value={},f.value="form"}return(D,_)=>{const g=v("el-tab-pane"),l=v("el-tabs"),r=v("el-dialog"),w=be("loading");return k(),O(r,{modelValue:m(t),"onUpdate:modelValue":_[3]||(_[3]=b=>Q(t)?t.value=b:null),width:"60%",top:"0",onClose:y},{header:o(()=>{var b,F,T,h;return[Ft,(b=m(a))!=null&&b.flowName?(k(),P("span",ht," - "+B((F=m(a))==null?void 0:F.flowName),1)):M("",!0),(T=m(a))!=null&&T.version?(k(),P("span",Ct," - V"+B((h=m(a))==null?void 0:h.version),1)):M("",!0)]}),default:o(()=>[ge((k(),O(l,{modelValue:f.value,"onUpdate:modelValue":_[2]||(_[2]=b=>f.value=b)},{default:o(()=>[i(g,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[f.value==="form"&&m(a).formOption?(k(),O(ce,{key:0,modelValue:m(a).formOption,"onUpdate:modelValue":_[0]||(_[0]=b=>m(a).formOption=b),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),i(g,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[f.value==="flow"?(k(),O(ie,{key:0,modelValue:m(a).flowData,"onUpdate:modelValue":_[1]||(_[1]=b=>m(a).flowData=b),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[w,c.value]])]),_:1},8,["modelValue"])}}}),$t=L({__name:"index",setup(d){const e=x("definition"),u=x({}),t=x(""),a=x("");function n(l){t.value===l.id?t.value="":t.value=l.id}const s=x(!1),p=x(!1);function f(){u.value={},s.value=!0}function c(l){u.value=l,s.value=!0}function y(l){u.value=l,p.value=!0}function D(l){a.value=l.flowModuleId||"",e.value="deploy"}function _(){a.value="",e.value="definition"}async function g(){const l=e.value;await ve(),e.value="",await ve(),e.value=`${l}`}return(l,r)=>{const w=v("el-col"),b=v("el-row");return k(),O(b,{gutter:20},{default:o(()=>[i(w,{span:4},{default:o(()=>[i(_t,{onNodeClick:n})]),_:1}),i(w,{span:20},{default:o(()=>[e.value==="definition"?(k(),O(xe,{key:0,"category-id":t.value,onAdd:f,onEdit:c,onView:y,onVersion:D},null,8,["category-id"])):M("",!0),e.value==="deploy"&&a.value?(k(),O(Ne,{key:1,"flow-module-id":a.value,onEdit:c,onView:y,onBack:_},null,8,["flow-module-id"])):M("",!0),i(Vt,{modelValue:u.value,"onUpdate:modelValue":r[0]||(r[0]=F=>u.value=F),visible:s.value,"onUpdate:visible":r[1]||(r[1]=F=>s.value=F),onClose:g},null,8,["modelValue","visible"]),i(Ot,{modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=F=>u.value=F),visible:p.value,"onUpdate:visible":r[3]||(r[3]=F=>p.value=F)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),It=L({__name:"index",setup(d){const e=it("debugMode",!1),{request:u}=N(),{getTaskOpsList:t}=pt(u),{bindVal:a,getDataList:n,crudStateRefs:{searchForm:s}}=R({tableOption:Ye,crudOption:{getList:t},searchForm:{status:q.待办},sortOption:{descs:"start_time"}});oe(s,n,{debounce:300,immediate:!0,deep:!0});const{open:p,close:f}=Ie();function c(y){p({flowKey:y.flowKey,taskId:y.taskId,instanceId:y.flowInstanceId,debug:e.value,onComplete(){f(),A.success("操作成功"),n()}})}return(y,D)=>{const _=v("el-switch"),g=v("el-button"),l=v("el-link"),r=v("avue-crud");return k(),O(r,j(J(m(a))),{"menu-right":o(()=>[i(g,{type:"text"},{default:o(()=>[i(_,{modelValue:m(e),"onUpdate:modelValue":D[0]||(D[0]=w=>Q(e)?e.value=w:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:w})=>[i(l,{type:"primary",underline:!1,onClick:b=>c(w)},{default:o(()=>[V(B(w.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),xt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Xe},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Nt=L({__name:"index",setup(d){const{request:e}=N(),{bindVal:u,getDataList:t}=R({tableOption:xt,crudOption:ke(e)});return t(),(a,n)=>{const s=v("avue-crud");return k(),O(s,j(J(m(u))),null,16)}}}),Tt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Lt={class:"flow-list"},Pt=["onClick"],Ut={class:"flow-name"},Mt=L({__name:"index",setup(d){const{request:e}=N(),{useList:u}=Fe(e),{usePublishList:t,getTaskList:a}=Ze(e),{data:n}=u(),{data:s}=t(),p=W(()=>{var r;return(r=n.value)==null?void 0:r.map(w=>{var F;const b=((F=s.value)==null?void 0:F.filter(T=>T.categoryId===w.id))??[];return{...w,list:b}}).filter(w=>{var b;return(b=w.list)==null?void 0:b.length})}),f=Re(q).filter((r,w)=>w<2).reverse(),{bindVal:c,getDataList:y,crudStateRefs:{searchForm:D}}=R({tableOption:Tt,crudOption:{getList:a},searchForm:{status:q.待办}});oe(D,y,{debounce:300,immediate:!0,deep:!0});const{open:_,close:g}=Ie();function l(r){_({flowKey:r.flowKey,taskId:r.taskId,instanceId:r.flowInstanceId,detail:r.taskId?r.status===q.已办:!1,onComplete(){g(),A.success("操作成功"),y()}})}return(r,w)=>{const b=v("el-button"),F=v("el-divider"),T=v("Icon"),h=v("el-collapse-item"),C=v("el-collapse"),I=v("el-card"),$=v("avue-radio"),S=v("el-link"),z=v("avue-crud");return k(),P(H,null,[i(I,{"body-style":{padding:"0 20px"}},{default:o(()=>[i(C,{"model-value":"1"},{default:o(()=>[i(h,{name:"1"},{title:o(()=>[i(b,{text:"",icon:"el-icon-promotion"},{default:o(()=>[V(" 发起审批 ")]),_:1})]),default:o(()=>[G("div",Lt,[(k(!0),P(H,null,ee(p.value,E=>(k(),P("div",{key:E.id,class:"flow-category"},[i(F,{"content-position":"left"},{default:o(()=>[V(B(E.name),1)]),_:2},1024),(k(!0),P(H,null,ee(E.list,K=>(k(),P("div",{key:K.flowKey,class:"flow-item",onClick:pe=>l(K)},[i(T,{class:"flow-icon",icon:K.flowIcon,width:"60"},null,8,["icon"]),G("div",Ut,B(K.flowName),1)],8,Pt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),i(F,{direction:"horizontal","content-position":"left"}),i(z,j(J(m(c))),{"menu-left":o(()=>[i($,{modelValue:m(D).status,"onUpdate:modelValue":w[0]||(w[0]=E=>m(D).status=E),button:"",dic:m(f)},null,8,["modelValue","dic"])]),processTitle:o(({row:E})=>[i(S,{type:"primary",underline:!1,onClick:K=>l(E)},{default:o(()=>[V(B(E.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),St=Ae(Mt,[["__scopeId","data-v-a80dbd8c"]]),Bt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Kt=L({__name:"index",setup(d){const{request:e}=N(),{bindVal:u,crudStateRefs:{formData:t},getDataList:a,handleUpdate:n}=R({tableOption:Bt,crudOption:Ce(e)});a();const s=x(!1);async function p(c){t.value=c,s.value=!0}async function f(){await n(t.value,Number.NaN,()=>s.value=!1,()=>{})}return(c,y)=>{const D=v("el-button"),_=v("avue-crud"),g=v("el-dialog");return k(),P(H,null,[i(_,j(J(m(u))),{menu:o(({row:l})=>[i(D,{type:"primary",text:"",icon:"el-icon-crop",onClick:r=>p(l)},{default:o(()=>[V(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),i(g,{modelValue:s.value,"onUpdate:modelValue":y[2]||(y[2]=l=>s.value=l),title:`模型设计-${m(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[i(D,{type:"primary",onClick:f},{default:o(()=>[V(" 保存 ")]),_:1}),i(D,{onClick:y[1]||(y[1]=l=>s.value=!1)},{default:o(()=>[V(" 取消 ")]),_:1})]),default:o(()=>[i(ie,{modelValue:m(t).flowData,"onUpdate:modelValue":y[0]||(y[0]=l=>m(t).flowData=l),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),At={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Et=L({__name:"index",setup(d){const{request:e}=N(),{bindVal:u,crudStateRefs:{formData:t},getDataList:a,handleUpdate:n}=R({tableOption:At,crudOption:Oe(e)});a();const s=x(!1);async function p(c){t.value={...c},s.value=!0}async function f(){await n(t.value,Number.NaN,()=>s.value=!1,()=>{})}return(c,y)=>{const D=v("el-button"),_=v("avue-crud"),g=v("el-dialog");return k(),P(H,null,[i(_,j(J(m(u))),{menu:o(({row:l})=>[i(D,{type:"primary",text:"",icon:"el-icon-crop",onClick:r=>p(l)},{default:o(()=>[V(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),i(g,{modelValue:s.value,"onUpdate:modelValue":y[2]||(y[2]=l=>s.value=l),title:`表单设计-${m(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[i(D,{type:"primary",onClick:f},{default:o(()=>[V(" 保存 ")]),_:1}),i(D,{onClick:y[1]||(y[1]=l=>s.value=!1)},{default:o(()=>[V(" 取消 ")]),_:1})]),default:o(()=>[i(ce,{modelValue:m(t).formOption,"onUpdate:modelValue":y[0]||(y[0]=l=>m(t).formOption=l),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Rt=G("br",null,null,-1),zt=L({__name:"index",setup(d){const{request:e}=N(),{bindVal:u,crudStateRefs:{formData:t,defaults:a},getDataList:n,afterOpen:s,beforeSubmit:p}=R({crudOption:ne(e),tableOption:qe});n();const{data:f}=ke(e).useParam("table.default.fields");s(r=>{if(t.value.defaultFields=f.value??[],r==="edit"){const w=JSON.parse(t.value.tableFields);t.value.editFields=ct(w,f.value??[],"name")}}),p(r=>{const w=[...r.defaultFields,...r.editFields];r.tableFields=JSON.stringify(w)});const c=x(!1);se(()=>{var r;(r=a.value)!=null&&r.defaultFields&&(a.value.defaultFields.display=c.value)});const{deploy:y,getFields:D}=ne(e),_=x(!1);async function g(r){await Y.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,y({id:r.id}).then(()=>{A.success("部署成功"),n()}).finally(()=>{_.value=!1})}function l(){D({tableName:t.value.tableName}).then(r=>{var w;if(!((w=r.data)!=null&&w.length))return A.warning("未找到该表");t.value.editFields=r.data})}return(r,w)=>{const b=v("el-button"),F=v("el-input"),T=v("el-switch"),h=v("el-tooltip"),C=v("avue-crud");return k(),O(C,j(J(m(u))),{menu:o(({row:I})=>[i(b,{type:"text",icon:"el-icon-upload",onClick:$=>g(I)},{default:o(()=>[V(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[i(F,{modelValue:m(t).tableName,"onUpdate:modelValue":w[0]||(w[0]=I=>m(t).tableName=I),placeholder:"请输入 表名"},{append:o(()=>[i(b,{type:"primary",size:"default",onClick:l},{default:o(()=>[V(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[G("div",null,[V(" 数据库字段 "),Rt,i(h,{content:"显示默认字段"},{default:o(()=>[i(T,{modelValue:c.value,"onUpdate:modelValue":w[1]||(w[1]=I=>c.value=I)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),jt=L({__name:"index",setup(d){const e=ut(),u=x({}),{FlowForm:t}=N(),a=W(()=>{const s=u.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${s==null?void 0:s.title}`:e.instanceId||e.taskId?`办理流程：${s==null?void 0:s.title}`:`发起流程：${s==null?void 0:s.title}`});rt(a);async function n(s){window.postMessage({event:"onComplete",data:{...s}})}return(s,p)=>(k(),O(m(t),we({flowDetail:u.value,"onUpdate:flowDetail":p[0]||(p[0]=f=>u.value=f)},m(e),{onComplete:n}),null,16,["flowDetail"]))}}),Jt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:vt,PageFlowDefinition:xe,PageFlowDeploy:Ne,PageFlowForm:jt,PageFlowManage:$t,PageFlowOps:It,PageFlowParam:Nt,PageFlowTemplate:Kt,PageFlowWorkbench:St,PageFormTemplate:Et,PageTableTemplate:zt},Symbol.toStringTag,{value:"Module"})),yo={install(d,e){Object.entries(Jt).forEach(([u,t])=>{d.component(u,t)}),N(d,e)}};export{ko as ApprovalForm,Do as ButtonList,ze as CONFIG_DEFAULT,Vo as CONFIG_PROVIDE_KEY,Fo as FieldType,ho as FlowButtonApproval,Co as FlowButtonDisplay,Oo as FlowButtonKey,$o as FlowButtonStatus,Io as FlowButtonType,xo as FlowForm,No as FlowStatus,To as HandleType,Lo as InternalForm,he as IsMainVersion,vt as PageFlowButton,xe as PageFlowDefinition,Ne as PageFlowDeploy,jt as PageFlowForm,$t as PageFlowManage,It as PageFlowOps,Nt as PageFlowParam,Kt as PageFlowTemplate,St as PageFlowWorkbench,Et as PageFormTemplate,zt as PageTableTemplate,Po as TablePrimary,q as TaskStatus,Uo as UploadTable,Mo as Whether,Qe as asyncValidate,yo as default,So as fieldTypeDic,Bo as flowFormEmits,Ko as flowFormProps,Ao as flowTrack,Eo as injectionKey,Ro as isMobile,zo as tablePrimaryDic,jo as useButtonHandler,Jo as useCommonCommentApi,N as useConfigProvider,Je as useFlowButtonApi,Fe as useFlowCategoryApi,le as useFlowDefinitionApi,de as useFlowDeployApi,Wo as useFlowFileApi,Ie as useFlowForm,ft as useFlowFormOverlay,mt as useFlowFormWindow,pt as useFlowOpsApi,ke as useFlowParamApi,Ze as useFlowTaskApi,Ce as useFlowTemplateApi,Ho as useFlowUserApi,Go as useFormDefaults,Oe as useFormTemplateApi,Qo as useInjectState,Yo as useProvideState,ne as useTableTemplateApi,Xe as whetherDic};
