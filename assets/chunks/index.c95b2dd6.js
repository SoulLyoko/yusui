import{d as U,J as se,Z as ue,u as g,r as y,v as h,C as x,M as _,q as ce,b as K,E as T,V as ie,O as j,L as de,B as E,N as F,j as $,A as M,F as q,x as me}from"./framework.8186f3e6.js";import{a as S,e as be}from"./index.ada82d55.js";import"./index.b942cce0.js";import{e as ye,s as R}from"./index.0246ace1.js";import{f as B}from"./index.ad30fe90.js";import{d as L}from"./form.a80801ff.js";import{a as z}from"./zipWith.b77fc110.js";var J=(a=>(a.用户="user",a.部门="dept",a.岗位="post",a.动态="dynamic",a.指定节点="userTask",a.指定用户="specifyUser",a.自定义="custom",a))(J||{});const Z=Symbol("flowDesignState");function Ae(a){const t=S(a,void 0,{passive:!0}),{lf:e,modelValue:p,elementData:l,formOptions:n,formData:s,formOption:u,formDefaults:d,dataOptions:v}=t,f=U(!1),C=U(!1);function i(r){var c,k,w;const b=(c=l.value)==null?void 0:c.id;b&&((k=e.value)==null||k.setProperties(b,r)),b&&((w=e.value)==null||w.updateText(b,r.name))}const m=U(),o={lf:e,graphData:p,elementData:l,formRef:m,formData:s,formDefaults:d,formLoading:f,formOption:u,formOptions:n,editorVisible:C,dataOptions:v,onUpdateFormData:i};return ue(Z,o),o}function O(){return se(Z)}const W=g({__name:"FlowNodeSelect",props:{filterType:{},dic:{}},setup(a){const t=a,{lf:e}=O(),p=y(()=>{var l;return(l=e.value)==null?void 0:l.graphModel.nodes.filter(n=>t.filterType?t.filterType.includes(n.type):!0).map(n=>({label:n.text.value,value:n.id,desc:n.id}))});return(l,n)=>{const s=_("avue-select");return h(),x(s,{dic:p.value},null,8,["dic"])}}}),ve={key:0,style:{display:"flex"}},fe=g({__name:"FlowAssigneeSetter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(a,{emit:t}){const e=a,p=U(!1),l=y(()=>{var o,r;return(r=(o=e.tableData)==null?void 0:o.row)==null?void 0:r.type}),n=y(()=>["dept","post","user","specifyUser"].includes(l.value));ce(l,()=>{s.value=[],u.value=""});const s=y({get(){return e.modelValue?e.modelValue.split(","):[]},set(o){var r;if(t("update:modelValue",o.join(",")),(r=e.tableData)!=null&&r.row){const b=B(i.value,c=>o==null?void 0:o.includes(c.id));e.tableData.row.idVal=b.map(c=>c[`${l.value.replace("specifyUser","user")}Id`]).join(",")}}}),u=y({get(){return e.modelValue},set(o){t("update:modelValue",o)}}),d=y({get(){return n.value?s.value:u.value},set(o){n.value?s.value=o:u.value=o}});function v(){d.value=B(i.value,o=>o.type===l.value).map(o=>o.id)}const{dataOptions:f}=O(),C=y(()=>{const{flowAssigneeUserDic:o=[],flowAssigneeDeptDic:r=[],flowAssigneePostDic:b=[],flowAssigneeDynamicDic:c=[]}=f.value??{};return{user:o,dept:r,post:b,dynamic:c,specifyUser:o,userTask:[]}}),i=y(()=>C.value[l.value]??[]),m=y(()=>{const o={clearable:!0,data:i.value,filterable:!0,loading:p.value,nodeKey:"value",placeholder:"请选择"},r={checkStrictly:!["user","specifyUser"].includes(l.value),multiple:!0,showCheckbox:!0,collapseTags:!0,collapseTagsTooltip:!0,maxCollapseTags:3};return{...o,...n.value?r:{}}});return(o,r)=>{const b=_("el-tree-select"),c=_("el-button"),k=_("el-input");return["dept","post","user","specifyUser","dynamic"].includes(l.value)?(h(),K("div",ve,[T(b,ie({modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=w=>d.value=w)},m.value,{style:{width:"100%"}}),null,16,["modelValue"]),m.value.multiple?(h(),x(c,{key:0,text:"",type:"primary",icon:"el-icon-check",onClick:v},{default:j(()=>[de(" 全选 ")]),_:1})):E("",!0)])):l.value==="userTask"?(h(),x(W,{key:1,modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=w=>u.value=w),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(h(),x(k,{key:2,modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=w=>u.value=w),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),H=g({__name:"FlowAssignee",props:{modelValue:{}},setup(a){const t=a,{modelValue:e}=S(t,void 0,{defaultValue:[]}),p=y(()=>({rowKey:"type",addBtn:!0,column:[{label:"类型",prop:"type",type:"select",width:120,dicData:ye(J)},{label:"值",prop:"value",component:fe}]}));return(l,n)=>{const s=_("avue-dynamic");return h(),x(s,{modelValue:F(e),"onUpdate:modelValue":n[0]||(n[0]=u=>$(e)?e.value=u:null),children:p.value},null,8,["modelValue","children"])}}}),Q=[{label:"",labelWidth:0,prop:"assignee",type:"dynamic",component:H,value:[]}],V=[{label:"节点id",prop:"id",readonly:!0},{label:"节点名称",prop:"name"},{label:"节点描述",prop:"desc"}];function he(a,t){const e=[];return a.forEach(p=>{const l=t.find(u=>u.buttonKey===p.buttonKey);!l||[p.display===l.display,p.approval===l.approval,p.validate===l.validate].every(u=>u)||e.push(l)}),z(e,"buttonKey")}function X(a,t){const e=[];return a.forEach(p=>{var o,r,b;const l=t.find(c=>c.prop===p.prop);if(!l)return;p.type==="dynamic"&&((r=(o=p.children)==null?void 0:o.column)!=null&&r.length)&&(l.children=X(p.children.column,(l==null?void 0:l.children)??[]));const{display:n,disabled:s,detail:u,readonly:d,rules:v}={...L,...p},f=!!(v!=null&&v.some(c=>c.required)),C=!!(v!=null&&v.length);[n===l.display,s===l.disabled,u===l.detail,d===l.readonly,f===l.required,C===l.validate].every(c=>c)&&!((b=l.children)!=null&&b.length)||e.push(l)}),z(e,"prop")}function je(a,t){return{...a,...t,plugins:[...(a==null?void 0:a.plugins)??[],...(t==null?void 0:t.plugins)??[]]}}function Y(a){return a.map(t=>{var p,l,n;const e={label:t.label,value:t.prop,desc:t.prop};return t.type==="dynamic"&&((l=(p=t.children)==null?void 0:p.column)!=null&&l.length)&&(e.children=Y((n=t.children)==null?void 0:n.column)),e})}const _e=g({__name:"FlowButton",props:{modelValue:{}},setup(a){const t=a,{modelValue:e}=S(t,void 0,{defaultValue:[]}),{dataOptions:p}=O();M(async()=>{var n;await R(),e.value=he(((n=p.value)==null?void 0:n.buttonList)??[],e.value??[])});const l=y(()=>{const{flowButtonDisplayDic:n=[],flowButtonApprovalDic:s=[],flowButtonValidateDic:u=[],buttonList:d=[]}=p.value??{};return{rowKey:"buttonKey",column:[{label:"按钮",prop:"buttonKey",width:100,type:"select",dicData:(d==null?void 0:d.map(f=>({label:f.name,value:f.buttonKey,desc:f.buttonKey})))??[],filterable:!0},{label:"显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",dicData:n??[]},{label:"审批窗口",prop:"approval",type:"select",multiple:!0,dataType:"string",dicData:s??[]},{label:"是否校验",prop:"validate",type:"switch",width:60,dicData:u??[]}]}});return(n,s)=>{const u=_("avue-dynamic");return h(),x(u,{modelValue:F(e),"onUpdate:modelValue":s[0]||(s[0]=d=>$(e)?e.value=d:null),children:l.value},null,8,["modelValue","children"])}}}),N=[{label:"",labelWidth:0,prop:"button",type:"dynamic",component:_e,value:[],tip:"需要覆盖默认按钮配置时从这里添加"}],ee=[{label:"",labelWidth:0,prop:"circulate",type:"dynamic",component:H,value:[]}],we=[{label:"开始",value:"start"},{label:"任务",value:"task"},{label:"结束",value:"end"}],Ve=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],De=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],xe=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:we},{label:"类型",prop:"eventType",type:"select",dicData:Ve},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:De},{label:"值",prop:"fieldValue"}]}}]}}],G=g({__name:"FlowCheckbox",props:{modelValue:{type:Boolean}},setup(a){const t=a,{modelValue:e}=S(t);return(p,l)=>{const n=_("el-checkbox");return h(),K("span",null,[T(n,{modelValue:F(e),"onUpdate:modelValue":l[0]||(l[0]=s=>$(e)?e.value=s:null)},null,8,["modelValue"])])}}}),Ce={style:{display:"flex"}},Te={style:{position:"absolute",left:"12px",top:"16px","z-index":"10"}},ge=q("strong",null," 字段",-1),ke=g({__name:"FlowFormProperty",props:{modelValue:{}},setup(a){const t=a,{modelValue:e}=S(t,void 0,{defaultValue:[]}),[p,l]=be(),{dataOptions:n}=O();M(async()=>{var i;await R(),e.value=X(((i=n.value)==null?void 0:i.formPropertyList)??[],e.value??[])});const s=y(()=>{var i;return Y(((i=n.value)==null?void 0:i.formPropertyList)??[])}),u=y(()=>({rowKey:"prop",defaultExpandAll:!0,column:[{prop:"_index",hide:!0},{label:"",prop:"prop",component:l,type:"select",dicData:s.value??[]},{label:"显示",prop:"display",width:40,component:G},{label:"禁用",prop:"disabled",width:40,component:G},{label:"详情",prop:"detail",width:40,component:G},{label:"只读",prop:"readonly",width:40,component:G},{label:"必填",prop:"required",width:40,component:G},{label:"校验",prop:"validate",width:40,component:G}]}));function d(){e.value.push({...L})}function v(i){const m=e.value.find(o=>o.prop===i);m.children||(m.children=[]),m.children.push({...L,$cellEdit:!0})}function f(i){e.value=B(e.value,m=>m.prop!==i,{flat:!1})}function C(i){return!!s.value.find(o=>{var r;return o.value===i&&((r=o.children)==null?void 0:r.length)})}return(i,m)=>{const o=_("avue-input-tree"),r=_("el-button"),b=_("avue-dynamic");return h(),K(me,null,[T(F(p),null,{default:j(({modelValue:c,"onUpdate:modelValue":k})=>[q("div",Ce,[T(o,{"model-value":c,dic:s.value,"default-expand-all":"",filterable:"","onUpdate:modelValue":k},null,8,["model-value","dic","onUpdate:modelValue"]),C(c)?(h(),x(r,{key:0,type:"primary",icon:"el-icon-plus",text:"",onClick:w=>v(c)},null,8,["onClick"])):E("",!0),T(r,{type:"danger",icon:"el-icon-delete",text:"",onClick:w=>f(c)},null,8,["onClick"])])]),_:1}),q("div",null,[q("div",Te,[T(r,{type:"primary",icon:"el-icon-plus",size:"small",circle:"",onClick:d}),ge]),T(b,{modelValue:F(e),"onUpdate:modelValue":m[0]||(m[0]=c=>$(e)?e.value=c:null),children:u.value},null,8,["modelValue","children"])])],64)}}}),P=[{label:"",labelWidth:0,prop:"formProperty",type:"dynamic",component:ke,value:[],tip:"需要覆盖默认表单配置时从这里添加"}],le=[{label:"网关类型",prop:"inout",type:"radio",button:!0,value:"in",dicData:[{label:"进",value:"in"},{label:"出",value:"out"}]},{label:"完成条件",prop:"completionCondition",type:"slider",showInput:!0,showInputControls:!1,labelPosition:"top",step:.01,max:1,value:0,labelTip:"任务完成的百分比，如2人接收，需同时完成才往下进行时=100%，只需1人完成时=50%",span:23,offset:1}],I=[{label:"多实例类型",prop:"multiInstanceType",tip:"选择后节点变更为多人任务",type:"select",dicData:[{label:"并行审批",value:"parallel",desc:"同时接收审批"},{label:"顺序审批",value:"sequential",desc:"按顺序审批"}]},{label:"完成条件",prop:"completionCondition",type:"slider",showInput:!0,showInputControls:!1,labelPosition:"top",step:.01,max:1,value:0,labelTip:"任务完成的百分比，如2人接收，需同时完成才往下进行时=100%，只需1人完成时=50%",span:23,offset:1},{label:"回收任务",prop:"isRecall",type:"switch",value:!1,labelTip:"满足完成条件时，该节点未审批任务是否回收，回收的任务仅保留记录，对应人员无需再办理"}],ae=[{label:"节点id",prop:"id",readonly:!0},{label:"节点描述",prop:"name",type:"textarea"}],A=g({__name:"FlowFieldsSelect",props:{dic:{}},setup(a){const{dataOptions:t}=O(),e=y(()=>{var p;return((p=t.value)==null?void 0:p.fieldsDic)??[]});return(p,l)=>{const n=_("avue-select");return h(),x(n,{dic:e.value},null,8,["dic"])}}}),te=[{label:"跳过第一节点",prop:"skipFirstNode",type:"switch",labelWidth:100,value:!0},{label:"默认驳回节点",prop:"rollbackNode",type:"select",labelWidth:100,component:W,params:{filterType:"userTask"}},{label:"优先级字段",prop:"priority",type:"select",component:A,filterable:!0,allowCreate:!0,defaultFirstOption:!0},{label:"表单标题",prop:"formTitle",separator:"-",type:"select",component:A,dataType:"string",multiple:!0,filterable:!0,allowCreate:!0,defaultFirstOption:!0},{label:"标题分隔符",prop:"formTitleSeparator",value:"-",control(a){return{formTitle:{separator:a}}}}],D=[{label:"",labelWidth:0,prop:"property",type:"dynamic",children:{column:[{label:"属性名",prop:"name"},{label:"属性值",prop:"value",type:"textarea",minRows:1}]},value:[]}],oe=[{label:"条件表达式",prop:"conditionsequenceflow"},{label:"是否为默认分支",prop:"defaultConditions",labelWidth:120,type:"switch",value:!1,change({row:a,value:t}){a.isDefaultFlow=t}}],ne=[{label:"",labelWidth:0,prop:"serial",component:"avue-form",option:{menuBtn:!1,span:24,column:[{label:"名称",prop:"name"},{label:"前缀",prop:"prefix"},{label:"日期格式",prop:"dateFormat"},{label:"后缀位数",prop:"suffixLength"},{label:"初始数值",prop:"startSequence"},{label:"连接符",prop:"connector"},{label:"重置周期",prop:"cycle",type:"select",dicData:[{label:"不重置",value:"none"},{label:"按天重置",value:"day"},{label:"按周重置",value:"week"},{label:"按月重置",value:"month"},{label:"按年重置",value:"year"}]}]}}],pe=[{label:"类",prop:"className"},{label:"异步",prop:"isAsync",type:"switch",value:!1}],Ge=[{label:"创建",value:"create"},{label:"指派",value:"assignment"},{label:"完成",value:"complete"},{label:"删除",value:"delete"},{label:"更新",value:"update"},{label:"超时",value:"timeout"}],Pe=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],Fe=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],Se=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:Ge},{label:"类型",prop:"eventType",type:"select",dicData:Pe},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:Fe},{label:"值",prop:"fieldValue"}]}}]}}],Oe=[{label:"",labelWidth:0,prop:"timeLimit",type:"dynamic",children:{column:[{label:"名称",prop:"name"},{label:"最小值",prop:"min",type:"number"},{label:"最大值",prop:"max",type:"number"}]},value:[]}],re=[{label:"驳回节点",prop:"rollbackNode",type:"select",component:W,params:{filterType:"userTask"}},{label:"重新提交后回到驳回人",prop:"backToRejecter",type:"switch",value:!1}],Ue=[{label:"基本配置",prop:"base",column:V}],qe={startEvent:[{label:"基本配置",prop:"baseGroup",column:V},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],endEvent:[{label:"基本配置",prop:"baseGroup",column:V},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],userTask:[{label:"基本配置",prop:"baseGroup",column:[...V,...re]},{label:"人员配置",prop:"assigneeGroup",column:Q},{label:"多实例配置",prop:"multiInstanceGroup",collapse:!1,column:I},{label:"按钮配置",prop:"buttonGroup",collapse:!1,column:N},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],serviceTask:[{label:"基本配置",prop:"baseGroup",column:V},{label:"服务配置",prop:"serviceGroup",column:pe},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],circulateTask:[{label:"基本配置",prop:"baseGroup",column:V},{label:"传阅配置",prop:"circulateGroup",column:ee},{label:"按钮配置",prop:"buttonGroup",collapse:!1,column:N},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P}],sequenceFlow:[{label:"基本配置",prop:"baseGroup",column:V},{label:"条件配置",prop:"sequenceFlowGroup",column:oe},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],parallelGateway:[{label:"基本配置",prop:"baseGroup",column:V},{label:"网关配置",prop:"baseGroup",column:le}],process:[{label:"流程配置",prop:"baseGroup",column:te},{label:"流水号配置",prop:"serialGroup",column:ne},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],group:[{label:"基本配置",prop:"baseGroup",column:V},{label:"多实例配置",prop:"multiInstanceGroup",collapse:!1,column:I},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:D}],note:[{label:"基本配置",prop:"baseGroup",column:ae}]},Ee=Object.freeze(Object.defineProperty({__proto__:null,assigneeColumn:Q,baseColumn:V,buttonColumn:N,circulateColumn:ee,defaultGroup:Ue,defaultOptions:qe,executionListenerColumn:xe,formPropertyColumn:P,gatewayColumn:le,multiInstanceColumn:I,noteColumn:ae,processColumn:te,propertyColumn:D,sequenceFlowColumn:oe,serialColumn:ne,serviceTaskColumn:pe,taskListenerColumn:Se,timeLimitColumn:Oe,userTaskColumn:re},Symbol.toStringTag,{value:"Module"}));export{J as A,Ee as B,O as a,qe as b,Q as c,Ue as d,V as e,N as f,ee as g,xe as h,Z as i,P as j,le as k,I as l,je as m,ae as n,D as o,te as p,ne as q,pe as r,oe as s,Se as t,Ae as u,Oe as v,re as w,he as x,X as y,Y as z};
