import{a as ut,s as Ut,e as ne,b as Et,u as Z}from"./index.15c943cf.js";import{I as se}from"./iconify.5d378855.js";import{d as At}from"./index.5e3eb256.js";import{X as Me,B as De,r as N,s as he,d as U,e as J,w as pe,i as ee,u as k,n as _e,Y as Kt,h as A,H as V,j as T,k as E,R as X,F as W,D as $,E as b,J as g,p as P,q as j,a3 as tt,C as Q,_ as Te,G as B,K as Mt,l as Bt,O as lt,b as it,L as jt,a9 as Ue,aA as Ht,M as zt,a7 as le,a8 as oe,m as Wt,aM as ct,a5 as dt,I as Yt}from"./framework.268af5be.js";import{_ as qt,d as Qt,a as Gt}from"./index.903afd6b.js";import"./index.66eb9e74.js";import{t as pt,P as ft,f as Jt,M as mt,L as Xt,u as Zt}from"./vuedraggable.umd.62eae2ee.js";import{u as fe,w as xe,d as el,e as tl}from"./theme.86d729e1.js";import{p as ll}from"./index.vue_vue_type_script_setup_true_lang.ed2201cd.js";import{E as G,m as ol,a as de}from"./index.e39bc4dd.js";import{d as vt}from"./differenceBy.b50d3d5d.js";import{aa as al,F as nl,D as ge}from"./index.f85f9727.js";import{o as sl}from"./omitBy.9af654cc.js";import{a as rl}from"./snakeCase.5ddcd990.js";import{J as ul,K as il}from"../app.60ac5629.js";import"./omit.67d7f778.js";import"./vue.runtime.esm-bundler.8984e576.js";const cl={},dl=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),pl=()=>cl,ae=e=>e,Ee=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",je=e=>e instanceof Function,be=e=>e==null,He=typeof window>"u",_t=()=>{var e;return He||be((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},fl=()=>{var e,t;return(e=!He&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Se=()=>new Promise(()=>{}),te=e=>ee(e)?e.value:e,ml=e=>Be(e)?Object.assign(Ee(e)?[]:{},e):e,ke=new Map,vl=e=>be(e)?void 0:ke.get(e),_l=(e,t,l)=>{const p=ke.get(e);p!=null&&p.timer&&clearTimeout(p.timer);const s=setTimeout(()=>ke.delete(e),t);ke.set(e,{...l,timer:s})};function bt(e,t,l){let p,s,a,c,o,r,f=0,_=!1,n=!1,d=!0;const u=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Be(l)&&(_=!!l.leading,n="maxWait"in l,a=n?Math.max(+l.maxWait||0,t):a,d="trailing"in l?!!l.trailing:d);function y(C){const x=p,L=s;return p=s=void 0,f=C,c=e.apply(L,x),c}function w(C,x){return u?(window.cancelAnimationFrame(o),window.requestAnimationFrame(C)):setTimeout(C,x)}function i(C){if(u)return window.cancelAnimationFrame(C);clearTimeout(C)}function v(C){return f=C,o=w(D,t),_?y(C):c}function m(C){const x=C-r,L=C-f,K=t-x;return n?Math.min(K,a-L):K}function h(C){const x=C-r,L=C-f;return r===void 0||x>=t||x<0||n&&L>=a}function D(){const C=Date.now();if(h(C))return O(C);o=w(D,m(C))}function O(C){return o=void 0,d&&p?y(C):(p=s=void 0,c)}function F(){o!==void 0&&i(o),f=0,p=r=s=o=void 0}function I(){return o===void 0?c:O(Date.now())}function R(){return o!==void 0}function S(){const C=Date.now(),x=h(C);for(var L=arguments.length,K=new Array(L),H=0;H<L;H++)K[H]=arguments[H];if(p=K,s=this,r=C,x){if(o===void 0)return v(r);if(n)return o=w(D,t),y(r)}return o===void 0&&(o=w(D,t)),c}return S.cancel=F,S.flush=I,S.pending=R,S}function bl(e,t,l){let p=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(l)&&(p="leading"in l?!!l.leading:p,s="trailing"in l?!!l.trailing:s),bt(e,t,{leading:p,trailing:s,maxWait:t})}var wl=ae((e,t)=>{let{debounceInterval:l,debounceOptions:p,manual:s}=t;const a=N(!1),c=N(),o=U(()=>p),r=U(()=>te(l)),f=N(e.context.runAsync);return s||(a.value=!0),J(_=>{be(r.value)||(c.value=bt(n=>n(),r.value,o.value),e.context.runAsync=function(){for(var n=arguments.length,d=new Array(n),u=0;u<n;u++)d[u]=arguments[u];return new Promise((y,w)=>{a.value?(a.value=!1,f.value(...d).then(y).catch(w)):c.value(()=>{f.value(...d).then(y).catch(w)})})},_(()=>{var n;(n=c.value)===null||n===void 0||n.cancel(),e.context.runAsync=f.value}))}),{onCancel(){var _;(_=c.value)===null||_===void 0||_.cancel()}}}),yl=ae((e,t)=>{let{errorRetryCount:l=0,errorRetryInterval:p=0}=t;const s=N(),a=N(0),c=U(()=>te(l)),o=U(()=>te(p));let r=!1;const f=()=>{a.value=0},_=U(()=>{if(o.value)return o.value;const u=1e3,y=1,w=9,i=Math.floor(Math.random()*2**Math.min(a.value,w)+y);return u*i}),n=()=>{let u;const y=c.value===-1,w=a.value<c.value;return(y||w)&&(y||(a.value+=1),u=setTimeout(()=>{r=!0,e.context.refresh()},_.value)),()=>u&&clearTimeout(u)},d=()=>{s.value&&s.value()};return{onBefore(){r||f(),r=!1,d()},onSuccess(){f()},onError(){s.value=n()},onCancel(){f(),d()}}}),gl=ae((e,t)=>{let{ready:l=N(!0),manual:p,defaultParams:s=[]}=t;return pe(l,a=>{!p&&a&&e.context.run(...s)},{flush:"sync"}),{onBefore(){if(!(je(l)?l():l.value))return e.loading.value=!1,{isBreak:!0}}}}),hl=ae((e,t)=>{let{refreshDeps:l,refreshDepsAction:p,manual:s}=t;if(l===void 0||Ee(l)&&l.length===0)return{};const a=Ee(l)?l:[l];return pe(a,()=>{p?p():!s&&e.context.refresh()}),{}}),kl=ae((e,t)=>{let{throttleInterval:l,throttleOptions:p}=t;const s=N(),a=U(()=>te(l)),c=U(()=>p),o=N(e.context.runAsync);return J(r=>{if(be(l))return{};s.value=bl(f=>f(),a.value,c.value),e.context.runAsync=function(){for(var f=arguments.length,_=new Array(f),n=0;n<f;n++)_[n]=arguments[n];return new Promise((d,u)=>{s.value(()=>{o.value(..._).then(d).catch(u)})})},r(()=>{var f;(f=s.value)===null||f===void 0||f.cancel(),e.context.runAsync=o.value})}),{onCancel(){var r;(r=s.value)===null||r===void 0||r.cancel()}}});const Cl=(e,t)=>l=>{Object.keys(l).forEach(p=>{e[p].value=l[p]}),t.forEach(p=>p(e))},Vl=(e,t)=>()=>{let l=t;for(let p=e.length;p-- >0;)l=e[p](l);return l()},Dl=(e,t,l)=>{var p,s;const{initialData:a,onSuccess:c,onError:o,onBefore:r,onAfter:f}=t,_=N((p=l==null?void 0:l.loading)!==null&&p!==void 0?p:!1),n=he((s=l==null?void 0:l.data)!==null&&s!==void 0?s:a),d=he(l==null?void 0:l.error),u=N(l==null?void 0:l.params),y=N([]),w=he("pending"),i={},v=Cl({status:w,loading:_,data:n,error:d,params:u},[]),m=function(D){for(var O=arguments.length,F=new Array(O>1?O-1:0),I=1;I<O;I++)F[I-1]=arguments[I];if(D==="onQuery"){const R=y.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:Vl(R,F[0])()}}else{const R=y.value.map(S=>{var C;return(C=S[D])===null||C===void 0?void 0:C.call(S,...F)});return Object.assign({},...R)}},h=N(0);return i.runAsync=async function(){for(var D=arguments.length,O=new Array(D),F=0;F<D;F++)O[F]=arguments[F];v({loading:!0,params:O,status:"pending"}),h.value+=1;const I=h.value,{isBreak:R,breakResult:S=Se()}=m("onBefore",O);if(R)return v({status:"settled"}),S;r==null||r(O);try{const C=()=>new Promise(K=>K(e(...u.value)));let{servicePromise:x}=m("onQuery",C);x||(x=C());const L=await x;return I!==h.value?Se():(v({data:L,loading:!1,error:void 0,status:"settled"}),m("onSuccess",L,O),c==null||c(L,O),I===h.value&&m("onAfter",O,L,void 0),f==null||f(O),L)}catch(C){if(I!==h.value)return Se();throw v({loading:!1,error:C,status:"settled"}),m("onError",C,O),o==null||o(C,O),I===h.value&&m("onAfter",O,void 0,C),f==null||f(O),C}},i.run=function(){i.runAsync(...arguments).catch(D=>{o||console.error(D)})},i.cancel=()=>{h.value+=1,v({loading:!1}),m("onCancel")},i.refresh=()=>{i.run(...u.value||[])},i.refreshAsync=()=>i.runAsync(...u.value||[]),i.mutate=D=>{const O=je(D)?D(n.value):D,F=ml(O);v({data:F}),m("onMutate",F)},{status:w,loading:_,data:n,error:d,params:u,plugins:y,context:i}};function Tl(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const p=Me(dl,{}),s={...pl(),...p,...t},{manual:a=!1,defaultParams:c=[]}=s,o=Dl(e,s);if(o.plugins.value=l.map(r=>r(o,s)),!a){const r=o.params.value||c;o.context.run(...r)}return De(()=>{o.context.cancel()}),{loading:o.loading,data:o.data,error:o.error,params:o.params,cancel:o.context.cancel,refresh:o.context.refresh,refreshAsync:o.context.refreshAsync,mutate:o.context.mutate,run:o.context.run,runAsync:o.context.runAsync}}const Ce=new Map,xl=(e,t)=>{Ce.set(e,t),t.then(l=>(Ce.delete(e),l)).catch(()=>{Ce.delete(e)})},Ll=e=>Ce.get(e),ue=new Map,Nl=(e,t)=>{ue.has(e)&&ue.get(e).forEach(l=>l(t))},Il=(e,t)=>(ue.has(e)?ue.get(e).push(t):ue.set(e,[t]),()=>{const l=ue.get(e).indexOf(t);ue.get(e).splice(l,1)});var Ol=ae((e,t)=>{let{cacheKey:l,cacheTime:p=6e5,staleTime:s=0,getCache:a,setCache:c}=t;if(!l)return{};const o=je(l)?l:()=>l,r=N(()=>{});let f;const _=v=>a?a(v):vl(v),n=(v,m,h)=>{c?c(v,h):_l(v,m,h),Nl(v,h.data)},d=v=>s===-1||v+s>new Date().getTime(),u=(v,m)=>Object.prototype.hasOwnProperty.call(v,m),y=v=>{const m=o(v);return Il(m,h=>{e.data.value=h})},w=o(),i=_(w);return i&&u(i,"data")&&(e.data.value=i.data,e.params.value=i.params),w&&(r.value=y()),De(()=>{r.value()}),{onBefore(v){const m=o(v),h=_(m);if(!h||!u(h,"data"))return{};if(d(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(v){const m=e.params.value,h=o(m);let D=Ll(h);return D&&D!==f?()=>D:(D=v(),f=D,xl(h,D),()=>D)},onSuccess(v,m){const h=o(m);h&&(r.value(),n(h,p,{data:v,params:m,time:new Date().getTime()}),r.value=y(m))},onMutate(v){const m=o(e.params.value);m&&(r.value(),n(m,p,{data:v,params:e.params.value,time:new Date().getTime()}),r.value=y(e.params.value))}}});function $l(e){let t,l;class p extends Promise{constructor(a){super(a),this.cancel=()=>{l(),clearTimeout(t)}}}return new p(s=>{l=s,t=setTimeout(l,e)})}function Fe(){return new Date().getTime()}var Sl=ae((e,t)=>{let{loadingDelay:l=0,loadingKeep:p=0}=t;const s=N(()=>{}),a=U(()=>te(l)),c=U(()=>te(p));let o=0,r={};const f=()=>{let _;return a.value&&(_=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>_&&clearTimeout(_)};return{onBefore(){e.loading.value=!a.value,s.value(),s.value=f(),o=Fe()},onQuery(_){if(!c.value)return()=>_();r=$l(c.value+a.value);const n=async()=>{try{const u=await _();return Fe()-o<=a.value&&r.cancel(),Promise.resolve(u)}catch(u){return Fe()-o<=a.value&&r.cancel(),Promise.reject(u)}},d=Promise.allSettled([n(),r]).then(u=>{const y=u[0];return y.status==="fulfilled"?y.value:Promise.reject(y.reason)});return()=>d},onCancel(){s.value()},onAfter(){s.value()}}}),Re;const wt=new Set,yt=new Set,gt=new Set,Ve=(e,t)=>{let l;switch(e){case"FOCUS_LISTENER":l=wt;break;case"RECONNECT_LISTENER":l=gt;break;case"VISIBLE_LISTENER":l=yt;break}if(!l.has(t))return l.add(t),()=>{l.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!He&&(Re=window)!==null&&Re!==void 0&&Re.addEventListener&&(window.addEventListener("visibilitychange",()=>{_t()&&Pe(yt)},!1),window.addEventListener("focus",()=>Pe(wt),!1),window.addEventListener("online",()=>Pe(gt),!1));var Fl=ae((e,t)=>{let{pollingInterval:l,pollingWhenHidden:p=!1,pollingWhenOffline:s=!1,errorRetryCount:a=0}=t;const c=N(),o=N(!1),r=U(()=>te(l)),f=U(()=>te(a)),_=[],n=w=>{w&&_.push(w)},d=()=>(p||_t())&&(s||fl()),u=w=>{if(e.error.value&&f.value!==0)return;let i;if(!be(r.value)&&r.value>=0)if(d())i=setTimeout(w,r.value);else{o.value=!0;return}return()=>i&&clearTimeout(i)},y=()=>{o.value&&d()&&(e.context.refresh(),o.value=!1)};return pe(r,()=>{c.value&&(c.value(),c.value=u(()=>e.context.refresh()))}),p||n(Ve("VISIBLE_LISTENER",y)),s||n(Ve("RECONNECT_LISTENER",y)),De(()=>{_.forEach(w=>w())}),{onBefore(){var w;(w=c.value)===null||w===void 0||w.call(c)},onCancel(){var w;(w=c.value)===null||w===void 0||w.call(c)},onAfter(){c.value=u(()=>e.context.refresh())}}});const Rl=(e,t)=>{let l=!1;return function(){l||(l=!0,e(...arguments),setTimeout(()=>{l=!1},t))}};var Pl=ae((e,t)=>{let{refreshOnWindowFocus:l=!1,refocusTimespan:p=5e3}=t;const s=U(()=>te(l)),a=U(()=>te(p)),c=[],o=f=>{f&&c.push(f)},r=()=>{c.forEach(f=>f())};return J(()=>{if(r(),s.value){const f=Rl(e.context.refresh,a.value);o(Ve("VISIBLE_LISTENER",f)),o(Ve("FOCUS_LISTENER",f))}}),De(()=>{r()}),{}});function ie(e,t){return Tl(e,t,[Sl,yl,wl,Fl,kl,Pl,hl,gl,Ol])}var ht=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(ht||{});function Le(){const{request:e}=z(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"};return{url:t,getPublishList:()=>e.get(t.publishList),getTaskList:i=>e.get(t.taskList,{params:i}),getFlowDetail:i=>e.get(t.detail,{params:i}),getApprovalNode:i=>e.post(t.approvalNode,i),startTask:i=>e.post(t.start,i),commitTask:i=>e.post(t.commit,i),saveDraft:i=>e.post(t.draft,i),revokeTask:i=>e.post(t.revoke,i),terminateTask:i=>e.post(t.terminate,i),withdrawTask:i=>e.post(t.withdraw,i),transferTask:i=>e.post(t.transfer,i),rejectTask:i=>e.post(t.reject,i),greenChannel:i=>e.post(t.green,i),circulateTask:i=>e.post(t.circulate,i)}}function Ul(e){const{commitTask:t,revokeTask:l,saveDraft:p,startTask:s,terminateTask:a,transferTask:c,withdrawTask:o,rejectTask:r,greenChannel:f,circulateTask:_}=Le(),n=U(()=>{const{flowDetail:u,formVariables:y,approvalFormData:w,debug:i,fileIds:v}=e,{flowDeployId:m}=u.value.process??{},{taskId:h,flowInstanceId:D}=u.value.task??{};return{flowDeployId:m,taskId:h,flowInstanceId:D,variables:y.value,debug:i.value,fileIds:v.value,...w.value}}),d=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(d())return p(n.value)},flow_pass(){return d()?t(n.value):s(n.value)},flow_revoke(){if(d())return l(n.value)},flow_withdraw(){if(d())return o(n.value)},flow_terminate(){if(d())return a(n.value)},flow_transfer(){if(d())return c(n.value)},flow_reject(){if(d())return r(n.value)},flow_green(){if(d())return f(n.value)},flow_circulate(){if(d()){const{approvalFormData:u,circulateId:y}=e;return _({id:y==null?void 0:y.value,comment:u==null?void 0:u.value.comment})}}}}function El(e){const t=N({});return J(async()=>{var p;const{formProperty:l}=((p=k(e))==null?void 0:p.properties)||{};l!=null&&l.length&&(await _e(),Object.keys(t.value).forEach(s=>{var o,r,f,_;const a=((o=t.value[s])==null?void 0:o.label)||"",c=l==null?void 0:l.find(n=>n.prop===s);if(t.value[s].display=c==null?void 0:c.display,t.value[s].disabled=c==null?void 0:c.disabled,t.value[s].detail=c==null?void 0:c.detail,t.value[s].readonly=c==null?void 0:c.readonly,t.value[s].rules=t.value[s].rules??[],c!=null&&c.required&&((r=t.value[s].rules)!=null&&r.some(n=>n.required)))return null;c!=null&&c.required?(f=t.value[s].rules)==null||f.push({required:!0,message:`${a}为必填项`}):t.value[s].rules=(_=t.value[s].rules)==null?void 0:_.filter(n=>!n.required)}))}),t}function Al(){return{modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}}}function Kl(){return{complete:e=>e}}const kt=Symbol("flowFormState");function Ml(e,t){const l=fe(e,void 0,{passive:!0,deep:!0}),{flowDetail:p,modelValue:s,formLoading:a}=l,{getFlowDetail:c}=Le(),{tabs:o}=z(),r=U(()=>(o==null?void 0:o.filter(u=>{var w,i,v;const y=(v=(i=(w=p.value)==null?void 0:w.properties)==null?void 0:i.formProperty)==null?void 0:v.find(m=>m.prop===u.prop);return(y==null?void 0:y.display)!==!1}))??[]);J(()=>{const{flowKey:u,taskId:y,instanceId:w}=e;!u&&!y&&!w||(a.value=!0,c({flowKey:u,taskId:y,flowInstanceId:w}).then(i=>{p.value=i.data,s.value=i.data.formData||{}}).finally(()=>{a.value=!1}))});const f=N(!1),_=U(()=>Object.entries(s.value||{}).filter(([u])=>!u.startsWith("$")).map(([u,y])=>({key:u,value:y}))),n=N(),d={...l,formData:s,formVariables:_,approvalVisible:f,tabList:r,fileIds:n,emit:t};return Kt(kt,d),d}function ce(){return Me(kt)}const Bl=A({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:l,circulateId:p}=ce(),{data:s}=Qe().useList(),{userInfo:a}=z();function c(r,f){return r.map(_=>{const n=f.find(u=>u.buttonKey===_.buttonKey);return{..._,...ll(n,["display","approval"])}})}const o=U(()=>{var m,h,D,O,F,I;if(p!=null&&p.value){const R=(m=s.value)==null?void 0:m.find(S=>S.buttonKey==="flow_circulate");return R?[R]:[]}const r=typeof a=="function"?a():a,{assignee:f,status:_}=((h=l.value)==null?void 0:h.task)||{},{createUser:n,flowInstanceId:d,status:u}=((D=l.value)==null?void 0:D.flowInstance)||{},y={true:!0,false:!1,startUser:n==(r==null?void 0:r.userId),assignee:f==(r==null?void 0:r.userId),todo:_==2,done:_==1,notstarted:!d,started:!!d,finished:u===1,unfinished:u===2},w=((O=s.value)==null?void 0:O.filter(R=>R.buttonKey!=="flow_circulate"))??[],{button:i}=((F=l.value)==null?void 0:F.properties)||{};return((I=c(w,i??[]))==null?void 0:I.filter(R=>{var S,C;return(C=(S=R.display)==null?void 0:S.split(","))==null?void 0:C.every(x=>y[x])}))??[]});return(r,f)=>{const _=V("el-button");return T(!0),E(W,null,X(o.value,n=>(T(),$(_,{key:n.buttonKey,type:n.buttonType,onClick:d=>t("click",n)},{default:b(()=>[g(k(se),{icon:n.icon},null,8,["icon"]),P(" "+j(n.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function ze(e){return new Promise((t,l)=>{k(e).validate((s,a,c)=>{s?(a(),t(c)):l(c)})})}const jl=A({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:l}=fe(t),{batchUpdate:p,create:s,remove:a,useList:c}=uo(),o=N(!1),{activeBtn:r}=ce(),f=U(()=>{var h;return(h=r.value)==null?void 0:h.buttonKey}),{data:_,refresh:n}=c(f),d=U(()=>{var D,O,F;const h=l.value;if(h&&!((D=_.value)!=null&&D.some(I=>I.content===h))){const I=(((F=(O=_.value)==null?void 0:O[0])==null?void 0:F.sort)||1)-1;return[{content:h,sort:I},..._.value||[]]}return _.value});async function u(h){var D;await s({...h,type:(D=r.value)==null?void 0:D.buttonKey}),G.success("添加成功"),n()}async function y(h){await a(h.id),G.success("删除成功"),n()}async function w(h,D){let O=D.parent.data;O=O.map((F,I)=>({id:F.id,sort:I+1})),await p(O),G.success("修改排序成功"),n(),o.value=!1}function i(){o.value=!0}const v=N();async function m(h){var D;l.value=h.content??"",await _e(),(D=v.value)==null||D.blur()}return(h,D)=>{const O=V("el-input"),F=V("el-text"),I=V("el-col"),R=V("el-button"),S=V("el-row"),C=V("el-tree"),x=V("el-popover");return T(),$(x,{visible:o.value,placement:"bottom",title:"常用意见",width:600},{reference:b(()=>[g(O,{ref_key:"inputRef",ref:v,modelValue:k(l),"onUpdate:modelValue":D[0]||(D[0]=L=>ee(l)?l.value=L:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:D[1]||(D[1]=L=>o.value=!0),onBlur:D[2]||(D[2]=L=>o.value=!1)},null,8,["modelValue"])]),default:b(()=>[g(C,{data:d.value,"node-key":"content",draggable:"","allow-drop":(L,K,H)=>H!=="inner",props:{label:"content"},onNodeClick:m,onNodeDrop:w,onNodeDragStart:i},{default:b(({data:L})=>[g(S,{style:{width:"600px"}},{default:b(()=>[g(I,{span:22},{default:b(()=>[g(F,{truncated:"",title:L.content},{default:b(()=>[P(j(L.content),1)]),_:2},1032,["title"])]),_:2},1024),g(I,{span:2},{default:b(()=>[L.id?(T(),$(R,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:tt(K=>y(L),["stop"])},null,8,["onClick"])):(T(),$(R,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:tt(K=>u(L),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Hl=A({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:l}=fe(t),p=N(),s={class(n){return`node-${n.type}`}},a=U(()=>pt(t.data??[],(n,d,u)=>{const y=ut();return n.taskNodeKey=(u==null?void 0:u.taskNodeKey)??n.taskNodeKey,n.incoming=(u==null?void 0:u.incoming)??n.incoming,n.multiple=(u==null?void 0:u.multiple)??n.multiple,{...n,id:y,label:n.title,disabled:n.type!=="user"}})),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};xe(()=>[a.value,p.value],async()=>{if(!p.value||!a.value.length)return;if(t.autoCheck){const d=o(a.value);d&&_([d])}ft(a.value,d=>{var u;return!!((u=d.children)!=null&&u.length)}).map(async d=>{var y;await Ut(100);const u=(y=p.value)==null?void 0:y.getNode(d);u==null||u.expand()})},{immediate:!0,debounce:100});function o(n){var d;if(n.length===1)return(d=n[0].children)!=null&&d.length?o(n[0].children):n[0]}async function r(n,{checkedNodes:d}){var w;let u=d.filter(i=>i.type==="user");const y=u.some(i=>i.id===n.id);if(a.value.every(i=>!i.multiple)&&y)u=[n];else if(!n.multiple&&y){const m=((w=p.value)==null?void 0:w.getNode(n)).parent.data.children.filter(h=>h.id!==n.id);u=vt(u,m,"id")}_(u)}function f(n){const d=l.value.filter(u=>u.id!==n.id);_(d)}function _(n){var d;l.value=n,(d=p.value)==null||d.setCheckedNodes(n)}return(n,d)=>{const u=V("el-tag"),y=V("Icon"),w=V("el-tree");return T(),E(W,null,[(T(!0),E(W,null,X(k(l),i=>(T(),$(u,{key:i.id,type:"info",closable:"",onClose:v=>f(i)},{default:b(()=>[P(j(i.title),1)]),_:2},1032,["onClose"]))),128)),g(w,{ref_key:"treeRef",ref:p,class:"approval-tree",data:a.value,props:s,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:r},{default:b(({data:i})=>[Q("div",null,[g(y,{icon:c[i.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(i.title),1)])]),_:1},8,["data"])],64)}}});const ot=Te(Hl,[["__scopeId","data-v-f1318efd"]]),at=A({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,p=U({get(){return typeof l.modelValue=="string"?l.modelValue?l.modelValue.split(","):[]:l.modelValue},set(n){var d;t("update:modelValue",n.join(",")),(d=l.tableData)!=null&&d.row&&(l.tableData.row.idVal=ft(o.value,u=>n==null?void 0:n.includes(u.id)).map(u=>u[`${c.value}Id`]).join(","))}}),s=U({get(){return Array.isArray(l.modelValue)?l.modelValue.join(","):l.modelValue},set(n){t("update:modelValue",n)}}),a=N(!1),c=U(()=>{var n,d;return(d=(n=l.tableData)==null?void 0:n.row)==null?void 0:d.type}),o=N([]),r=N([]),{getUserTree:f}=fo(),{getParam:_}=me();return pe(c,n=>{["dept","post","user"].includes(n)?(a.value=!0,f(n==="user"?"":n).then(d=>{o.value=pt(d.data,u=>({...u,label:u.title,value:u.id,disabled:n==="user"?u.type!=="user":!1}))}).finally(()=>a.value=!1)):c.value==="dynamic"&&(a.value=!0,_("flow.trends.user").then(d=>{r.value=d.data}).finally(()=>a.value=!1))},{immediate:!0}),(n,d)=>{const u=V("el-tree-select"),y=V("el-input");return["dept","post","user"].includes(c.value)?(T(),$(u,{key:0,modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=w=>p.value=w),data:o.value,loading:a.value,"expand-on-click-node":!1,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="dynamic"?(T(),$(u,{key:1,modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=w=>s.value=w),data:r.value,loading:a.value,clearable:"",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="userTask"?(T(),$(k(qt),{key:2,modelValue:s.value,"onUpdate:modelValue":d[2]||(d[2]=w=>s.value=w),"filter-type":"userTask"},null,8,["modelValue"])):(T(),$(y,{key:3,modelValue:s.value,"onUpdate:modelValue":d[3]||(d[3]=w=>s.value=w)},null,8,["modelValue"]))}}}),zl={key:0,class:"flow-viewer"},Wl={key:0,class:"flow-status-legend"},Yl=A({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const l=e,{FlowDesign:p,tabs:s}=z(),a=he();el(a,()=>{var i;(i=a.value)==null||i.on("node:click",v=>t("nodeClick",v))});const c=U({get(){let i=Qt();return typeof l.modelValue=="string"&&l.modelValue?i=JSON.parse(l.modelValue):typeof l.modelValue=="object"&&Object.keys(l.modelValue)&&(i=l.modelValue),i},set(i){t("update:modelValue",JSON.stringify(i))}}),o=U(()=>{const{column:i=[],group:v=[]}=JSON.parse(l.flowFormOption||"{}");return[...i,...v.map(h=>h.column??[]).flat()]}),{data:r}=Qe().useList(),f=U(()=>(s==null?void 0:s.map(i=>({...i,display:!0})))??[]),_=U(()=>{var i;return{formPropertyList:[...o.value,...f.value],buttonList:(i=r.value)==null?void 0:i.filter(v=>v.status===1),fieldsDic:o.value.map(v=>({label:v.label,value:`\${${v.prop}}`,desc:`\${${v.prop}}`})),flowButtonDisplayDic:ne(Ye),flowButtonApprovalDic:ne(qe)}}),n=N({}),d=N({});xe(d,i=>{var v,m,h,D,O,F;i&&((h=(m=(v=i.assignee)==null?void 0:v.children)==null?void 0:m.column)!=null&&h[1]&&(i.assignee.children.column[1].component=at),(F=(O=(D=i.circulate)==null?void 0:D.children)==null?void 0:O.column)!=null&&F[1]&&(i.circulate.children.column[1].component=at))},{debounce:1});const{data:u}=me().useParam("flow.task.status"),y=U(()=>{var i;return(i=l.flowHistory)==null?void 0:i.map(v=>{var h,D;const m=(D=(h=u.value)==null?void 0:h.find(O=>O.value===v.status))==null?void 0:D.style;return{id:v.taskNodeKey,style:m}})}),w=U(()=>{var i,v;return(v=(i=l.flowHistory)==null?void 0:i.filter(m=>m.taskNodeType==="userTask"))==null?void 0:v.map(m=>{var h;return{id:m.taskNodeKey,content:`<div>${m.assigneeName}</div>
        <div>${m.endTime??""}</div>
        <div>${((h=m.comment)==null?void 0:h.handleComment)??""}</div>`}})});return(i,v)=>i.view?(T(),E("div",zl,[i.showLegend!==!1?(T(),E("div",Wl,[(T(!0),E(W,null,X(k(u),m=>{var h;return T(),E("div",{key:m.label,class:"legend-item"},[Q("div",{class:"legend-color",style:Mt({backgroundColor:(h=m.style)==null?void 0:h.fill})},null,4),Q("span",null,j(m.label),1)])}),128))])):B("",!0),g(k(p),{lf:a.value,"onUpdate:lf":v[0]||(v[0]=m=>a.value=m),"model-value":c.value,styles:y.value,tooltips:w.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(T(),$(k(p),{key:1,modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=m=>c.value=m),formData:n.value,"onUpdate:formData":v[2]||(v[2]=m=>n.value=m),formDefaults:d.value,"onUpdate:formDefaults":v[3]||(v[3]=m=>d.value=m),"form-options":k(Gt),"data-options":_.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const we=Te(Yl,[["__scopeId","data-v-0b8d2722"]]),ql=A({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:l}=fe(t),{flowDetail:p}=ce(),s=N(!1);function a({data:c}){c.type==="userTask"&&(s.value=!1,l.value=c.id)}return(c,o)=>{const r=V("el-button"),f=V("el-popover");return T(),$(f,{visible:s.value,"onUpdate:visible":o[0]||(o[0]=_=>s.value=_),placement:"bottom-start",width:"800px",trigger:"click"},{reference:b(()=>[g(r,null,{default:b(()=>[P(" 点击选择节点 ")]),_:1})]),default:b(()=>{var _,n;return[g(we,{"model-value":(n=(_=k(p))==null?void 0:_.process)==null?void 0:n.flowData,view:"",style:{height:"600px"},onNodeClick:a},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Ql=A({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:l}=Le(),{useParam:p}=me(),{formData:s,approvalFormData:a,activeBtn:c,approvalVisible:o,formVariables:r,flowDetail:f}=ce(),_=N([]),n=N([]),d=N([]),u=N([]),y=N(!1),w=N(!1),i=N(),v=N(),m={menuBtn:!1,labelWidth:100,column:[{label:"指定节点",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"传阅人",prop:"circulate",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function h(C,x,L){var Y,M,ye;const K=((Y=_.value[0])==null?void 0:Y.type)==="parallelGateway",H=(ye=(M=_.value[0])==null?void 0:M.children)==null?void 0:ye.every(re=>Jt([re],Ne=>n.value.some(Ie=>Ie.id===Ne.id)));if(n.value.length){if(K&&!H)return L("请在每个节点选择审批人")}else return L("请选择审批人");return!0}const{data:D}=p("flow.default.comment"),{data:O}=p("flow.approval.autocheck");J(async()=>{var x;if(!o.value||!i.value||!v.value)return;F();const{taskId:C}=((x=f.value)==null?void 0:x.task)||{};_e(()=>{i.value.resetFields(),a.value.comment=s.value.comment||(C?"":D.value),v.value.jumpTaskNodeKey.display=I("specifyNode"),v.value.assignee.display=I("assignee"),v.value.circulate.display=I("circulate"),v.value.comment.display=I("comment")})}),J(async()=>{var L,K;if(!o.value||!I("assignee")||I("specifyNode")&&!a.value.jumpTaskNodeKey)return;F();const{flowKey:C}=((L=f.value)==null?void 0:L.process)||{},{taskId:x}=((K=f.value)==null?void 0:K.task)||{};try{w.value=!0;const H=await l({flowKey:C,taskId:x,variables:r.value,buttonType:c.value.buttonKey,jumpTaskNodeKey:a.value.jumpTaskNodeKey});_.value=H.data.approvalNodeList,d.value=H.data.circulateNodeList}finally{w.value=!1}});function F(){_.value=[],n.value=[],d.value=[],u.value=[]}function I(C){var x,L;return(L=(x=c.value)==null?void 0:x.approval)==null?void 0:L.includes(C)}async function R(){await ze(i),y.value=!0;const{data:C,outgoing:x}=S(n.value),{data:L}=S(u.value);a.value.assignee=C,a.value.outgoing=[...x],a.value.circulate=L,console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",s),t("confirm")}function S(C){const x={},L={},K=new Set;return C.forEach(H=>{const{taskNodeKey:Y,incoming:M}=H;x[Y]||(x[Y]=new Set),H.userId&&x[Y].add(H.userId),L[Y]=[...x[Y]].join(","),M&&K.add(M)}),{set:x,data:L,outgoing:K}}return(C,x)=>{const L=V("el-skeleton"),K=V("avue-form"),H=V("el-button"),Y=V("el-dialog");return T(),$(Y,{modelValue:k(o),"onUpdate:modelValue":x[7]||(x[7]=M=>ee(o)?o.value=M:null),class:"approlval-form",title:k(c).name,width:"900px","append-to-body":""},{footer:b(()=>[g(H,{onClick:x[6]||(x[6]=M=>o.value=!1)},{default:b(()=>[P(" 取 消 ")]),_:1}),g(H,{type:"primary",onClick:R},{default:b(()=>[P(" 确 定 ")]),_:1})]),default:b(()=>[g(K,{ref_key:"formRef",ref:i,modelValue:k(a),"onUpdate:modelValue":x[4]||(x[4]=M=>ee(a)?a.value=M:null),defaults:v.value,"onUpdate:defaults":x[5]||(x[5]=M=>v.value=M),option:m},{jumpTaskNodeKey:b(()=>[g(ql,{modelValue:k(a).jumpTaskNodeKey,"onUpdate:modelValue":x[0]||(x[0]=M=>k(a).jumpTaskNodeKey=M)},null,8,["modelValue"])]),assignee:b(()=>[w.value?(T(),$(L,{key:0})):(T(),$(ot,{key:"AssigneeTree",modelValue:n.value,"onUpdate:modelValue":x[1]||(x[1]=M=>n.value=M),data:_.value,"auto-check":k(O)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:b(()=>[w.value?(T(),$(L,{key:0})):(T(),$(ot,{key:"CirculateTree",modelValue:u.value,"onUpdate:modelValue":x[2]||(x[2]=M=>u.value=M),data:d.value},null,8,["modelValue","data"]))]),comment:b(()=>[g(jl,{modelValue:k(a).comment,"onUpdate:modelValue":x[3]||(x[3]=M=>k(a).comment=M)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Gl={class:"flow-form__title"},We=A({__name:"index",props:Al(),emits:Kl(),setup(e,{emit:t}){const l=e,p=Ml(l,t),{flowDetail:s,tabList:a,activeTab:c,activeBtn:o,formLoading:r,approvalVisible:f,submitLoading:_}=p,n=N();async function d(w){var i,v;o.value=w,await((i=n.value)==null?void 0:i.validate()),await((v=l.beforeClick)==null?void 0:v.call(l,w)),(w==null?void 0:w.approval)!=="false"?f.value=!0:y()}const u=Ul(p);async function y(){var w,i;try{const{buttonKey:v}=o.value;_.value=!0,await((w=l.beforeSubmit)==null?void 0:w.call(l,o.value));const m=(i=u[v])==null?void 0:i.call(u);m instanceof Promise?(await m,G.success("操作成功"),f.value=!1,t("complete",o.value)):G.error("操作失败")}finally{_.value=!1}}return(w,i)=>{const v=V("el-skeleton"),m=V("el-main"),h=V("el-header"),D=V("el-tab-pane"),O=V("el-tabs"),F=V("el-container");return k(r)?(T(),$(m,{key:0},{default:b(()=>[g(v)]),_:1})):(T(),$(F,{key:1,class:"flow-form"},{default:b(()=>[g(h,{class:"flow-form__header",height:"auto"},{default:b(()=>{var I;return[Q("div",Gl,j(l.title??((I=k(s).flowInstance)==null?void 0:I.title)),1),w.detail?B("",!0):(T(),$(Bl,{key:0,onClick:d})),Bt(w.$slots,"button")]}),_:3}),g(m,{class:"flow-form__main"},{default:b(()=>[g(O,{modelValue:k(c),"onUpdate:modelValue":i[0]||(i[0]=I=>ee(c)?c.value=I:null)},{default:b(()=>[(T(!0),E(W,null,X(k(a),I=>(T(),$(D,{key:I.prop,label:I.label,name:I.prop,lazy:""},{default:b(()=>[I.prop==="formTab"?(T(),$(lt(w.$slots.default??I.component),{key:0,ref_for:!0,ref:R=>n.value=R},null,512)):(T(),$(lt(I.component),{key:1}))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(Ql,{onConfirm:y})]),_:3}))}}});function Ct(e,t){switch(t.type){case"window":return Jl(e,t);case"dialog":case"drawer":return Xl(e,t);default:return{open:l=>{},close:()=>{}}}}function Jl(e,t){const{window:[l="",p="flow-form",s="left=0,top=0,width=1600,height=900"]=[]}=t,a=N(null),c=U(()=>`${l}?${Et(sl(e,rl(al,nl)))}`);return{open:f=>{var _;a.value=window.open(c.value,p,s),(_=a.value)==null||_.addEventListener("message",n=>{const{event:d}=n.data,u={...k(e),...k(f)}[d];typeof u=="function"&&u(n.data)})},close:()=>{var f;return(f=a.value)==null?void 0:f.close()},openedWindow:a}}function Xl(e,t){const{appContext:l}=it();let p;const s=c=>{p=document.createElement("div"),p.className="flow-form-wrapper";const o=Zl(t.formPath),r=Ue(o,{...k(e),...k(c)}),f=Ue(t.type==="dialog"?ul:il,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},r);f.appContext=l,Ht(f,p),document.body.appendChild(p)},a=()=>{p&&document.body.removeChild(p)};return{open:s,close:a}}function Zl(e){return e?jt(()=>zt(()=>import(e),[])):We}const eo=A({setup(){const{flowDetail:e,formData:t,detail:l}=ce(),p=El(e.value),{proxy:s}=it(),a=N({});J(()=>{const{formOption:r}=e.value.process??{};a.value=mt.bind(s)(r||'{"menuBtn":false}'),a.value.detail=!!l.value});const c=N();function o(){return ze(c)}return{form:t,option:a,defaults:p,formRef:c,validate:o}},render(){return Ue(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),to=A({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:l}=ce(),{upload:{action:p,headers:s,preview:a,download:c,props:o}={}}=z(),r=typeof s=="function"?s():s,f=U(()=>{var m,h;return((h=(m=t.value)==null?void 0:m.task)==null?void 0:h.flowInstanceId)??ut()}),_={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:n,getDataList:d,handleDel:u,handleSave:y,afterGetList:w,crudStateRefs:{tableData:i}}=Z({crudOption:{...co(),saveSuccessMsg:"上传成功"},tableOption:_,queryForm:{isLatest:1,flowInstanceId:f.value}});w(()=>{l.value=i.value.map(m=>m.id).join(",")}),d();async function v(m,h){var C,x;const{fileName:D,fileType:O,fileSize:F,fileUrl:I,res:R}=o,S={fileName:ge({res:m},`${R}.${D}`),fileType:ge({res:m},`${R}.${O}`),fileSize:ge({res:m},`${R}.${F}`),fileUrl:ge({res:m},`${R}.${I}`),taskId:(x=(C=t.value)==null?void 0:C.task)==null?void 0:x.taskId,flowInstanceId:f.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await y(S,d,()=>{})}return(m,h)=>{const D=V("el-button"),O=V("el-upload"),F=V("avue-crud");return T(),$(F,le(oe(k(n))),{"menu-left":b(()=>[g(O,{action:k(p),headers:k(r),"show-file-list":!1,onSuccess:h[0]||(h[0]=I=>v(I))},{default:b(()=>[g(D,{type:"primary",icon:"el-icon-upload"},{default:b(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:b(({row:I,index:R})=>[g(D,{type:"primary",text:"",icon:"el-icon-view",onClick:S=>{var C;return(C=k(a))==null?void 0:C(I,k(i))}},{default:b(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),g(D,{type:"primary",text:"",icon:"el-icon-download",onClick:S=>{var C;return(C=k(c))==null?void 0:C(I,k(i))}},{default:b(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),g(O,{action:k(p),headers:k(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:S=>v(S,I)},{default:b(()=>[g(D,{type:"primary",text:"",icon:"el-icon-upload"},{default:b(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),g(D,{type:"primary",text:"",icon:"el-icon-delete",onClick:S=>k(u)(I,R)},{default:b(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),lo={class:"flow-track"},oo={key:0},ao={key:1},no=A({__name:"flow-track",setup(e){const{flowDetail:t}=ce(),l=N("table"),p=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],s=U(()=>{var r,f,_;return((_=(f=(r=t.value)==null?void 0:r.flowHistory)==null?void 0:f.filter(n=>n.taskNodeType==="userTask"))==null?void 0:_.map(n=>({...n,duration:At(n.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},{data:c}=me().useParam("flow.handle.type");function o(r){var f;return(f=c.value)==null?void 0:f.find(_=>_.value===r)}return(r,f)=>{var v,m,h;const _=V("el-radio-button"),n=V("el-radio-group"),d=V("avue-crud"),u=V("el-card"),y=V("el-timeline-item"),w=V("el-timeline"),i=V("el-empty");return T(),E(W,null,[g(n,{modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=D=>l.value=D)},{default:b(()=>[(T(),E(W,null,X(p,D=>g(_,{key:D.label,label:D.label},{default:b(()=>[g(k(se),{icon:D.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",lo,[l.value==="table"?(T(),$(d,{key:0,data:s.value,option:a},null,8,["data"])):B("",!0),l.value==="graph"?(T(),$(we,{key:1,"model-value":(m=(v=k(t))==null?void 0:v.process)==null?void 0:m.flowData,"flow-history":(h=k(t))==null?void 0:h.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):B("",!0),l.value==="timeline"?(T(),E(W,{key:2},[s.value.length?(T(),$(w,{key:0},{default:b(()=>[(T(!0),E(W,null,X([...s.value].reverse(),D=>(T(),$(y,{key:D.id,timestamp:D.endTime,placement:"top"},{default:b(()=>[g(u,null,{default:b(()=>{var O,F,I;return[Q("div",null,j(D.assigneeName)+" 开始处理 ["+j(D.taskNodeName)+"] 环节 ",1),D.duration?(T(),E("div",oo," 办理时长："+j(D.duration),1)):B("",!0),D.type&&((O=D.comment)!=null&&O.handleComment)?(T(),E("div",ao,j((F=o(D.type))==null?void 0:F.label)+"意见："+j((I=D.comment)==null?void 0:I.handleComment),1)):B("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),$(i,{key:1}))],64)):B("",!0)])],64)}}});const so=Te(no,[["__scopeId","data-v-0411478e"]]),nt=Symbol("flowPagesConfig"),ro={FlowDesign:{},FormDesign:{},FlowForm:We,tabs:[{label:"审批表单",prop:"formTab",component:eo},{label:"附件资料",prop:"fileTab",component:to},{label:"流程跟踪",prop:"trackTab",component:so}],request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Vt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Vt||{});const Ae=ne(Vt);function z(e,t){return e&&t?(e.provide(nt,ol(ro,t)),t):Me(nt)}function uo(){const{request:e}=z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},l=r=>e.get(t.list,{params:{type:r,ascs:"sort"}});return{url:t,getList:l,useList:r=>ie(()=>l(r.value).then(f=>f.data.records),{refreshDeps:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),batchUpdate:r=>e.post(t.batchUpdate,r)}}var Dt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Dt||{}),Ye=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Ye||{}),qe=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(qe||{}),Tt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Tt||{});function Qe(){const{request:e}=z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},l=o=>e.get(t.list,{params:o});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1,ascs:"sort"}).then(o=>o.data.records)),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}function io(){const{request:e}=z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:o=>e.get(t.list,{params:o}),getTree:o=>e.get(t.tree,{params:o}),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}function xt(){const{request:e}=z(),t={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:t,getCirculateList:c=>e.get(t.list,{params:c}),getCirculateOpsList:c=>e.get(t.list,{params:c}),updateCirculate:c=>e.post(t.update,c),removeCirculate:c=>e.post(t.remove,{},{params:{ids:c}})}}function Ge(){const{request:e}=z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:r=>e.get(t.list,{params:r}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r),getDetail:r=>e.get(t.detail,{params:r})}}var Lt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Lt||{});function Je(){const{request:e}=z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:c=>e.get(t.list,{params:c}),getDetail:c=>e.get(t.detail,{params:c}),update:c=>e.post(t.update,c),remove:c=>e.post(t.remove,{},{params:{ids:c}})}}function co(){const{request:e}=z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function po(){const{request:e}=z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getTaskOpsList:p=>e.get(t.list,{params:p})}}function me(){const{request:e}=z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},l=f=>e.get(t.list,{params:f}),p=()=>e.get(t.all),s=f=>e.get(t.key,{params:{paramKey:f}});return{url:t,getList:l,getAllParam:p,getParam:s,useParam:f=>ie(()=>s(f).then(_=>_.data)),create:f=>e.post(t.save,f),update:f=>e.post(t.update,f),remove:f=>e.post(t.remove,{},{params:{ids:f}})}}function Nt(){const{request:e}=z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},l=o=>e.get(t.list,{params:o});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1}).then(o=>o.data.records)),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}function fo(){const{request:e}=z(),t={tree:"/sapier-flow/flow-user/tree"},l=s=>e.get(t.tree,{params:{filter:s}});return{url:t,getUserTree:l,useUserTree:()=>ie(()=>l().then(s=>s.data))}}function It(){const{request:e}=z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},l=o=>e.get(t.list,{params:o});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1}).then(o=>o.data.records)),create:o=>e.post(t.save,o),update:o=>e.post(t.update,o),remove:o=>e.post(t.remove,{},{params:{ids:o}})}}var Ot=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ot||{});function Ke(){const{request:e}=z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},l=r=>e.get(t.list,{params:r});return{url:t,getList:l,useList:()=>ie(()=>l({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r)}}const mo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ne(Dt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(Ye),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(qe),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:ne(Tt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},vo=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l},getDataList:p}=Z({tableOption:mo,crudOption:Qe(),sortOption:{ascs:"sort"}});return p(),(s,a)=>{const c=V("el-button"),o=V("avue-crud");return T(),$(o,le(oe(k(t))),{icon:b(({row:r})=>[g(k(se),{icon:r.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:b(({row:r})=>[g(c,{type:r.buttonType},{default:b(()=>[g(k(se),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":b(()=>[g(c,{type:k(l).buttonType},{default:b(()=>[g(k(se),{icon:k(l).icon},null,8,["icon"]),P(" "+j(k(l).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},_o={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Xe.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},$t=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const l=e,{getList:p,deploy:s,remove:a}=Ge(),{bindVal:c,crudStateRefs:{searchForm:o},getDataList:r}=Z({tableOption:_o,crudOption:{getList:p,remove:a},searchForm:{categoryId:l.categoryId}});J(()=>{o.value.categoryId=l.categoryId??"",r()});const f=N(!1);async function _(d){await de.confirm("发布新版本，是否确认？","提示",{type:"success"}),f.value=!0,s({flowModuleId:d.flowModuleId}).then(()=>{G.success("发布成功"),r()}).finally(()=>{f.value=!1})}async function n(d){if(console.log("🚀 ~ file: index.vue:49 ~ handleDel ~ row:",d),d.mainVersion)return G.warning("请先删除已发布的流程");await de.confirm("确认删除？","提示",{type:"warning"}),await a(d.flowModuleId),G.success("删除成功"),r()}return(d,u)=>{const y=V("el-button"),w=V("el-dropdown-item"),i=V("avue-crud");return T(),$(i,le(oe(k(c))),{"menu-left":b(()=>[g(y,{type:"primary",icon:"el-icon-plus",onClick:u[0]||(u[0]=v=>t("add"))},{default:b(()=>[P(" 新增 ")]),_:1})]),"menu-btn":b(({row:v})=>[g(w,{icon:"el-icon-view",onClick:m=>t("view",v)},{default:b(()=>[P(" 查看 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-edit",onClick:m=>t("edit",v)},{default:b(()=>[P(" 编辑 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-delete",onClick:m=>n(v)},{default:b(()=>[P(" 删除 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-upload",onClick:m=>_(v)},{default:b(()=>[P(" 发布 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-switch",onClick:m=>t("version",v)},{default:b(()=>[P(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:b(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),bo={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Xe.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},St=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const l=e,{getList:p,update:s,remove:a}=Je(),{bindVal:c,crudStateRefs:{searchForm:o},getDataList:r}=Z({tableOption:bo,crudOption:{getList:p,dataPath:"res.data"}});J(()=>{l.flowModuleId&&(o.value.flowModuleId=l.flowModuleId,r())});const f=N(!1);async function _(d){await de.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),f.value=!0,s({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{G.success("设置成功"),r()}).finally(()=>{f.value=!1})}async function n(d){const{value:u}=await de.prompt("请输入确认删除的流程标识","提示",{type:"warning"});u===d.flowKey&&(await a(d.flowDeployId),G.success("删除成功"),r())}return(d,u)=>{const y=V("el-button"),w=V("el-dropdown-item"),i=V("avue-crud");return T(),$(i,le(oe(k(c))),{"menu-left":b(()=>[g(y,{loading:f.value,type:"primary",icon:"el-icon-arrow-left",onClick:u[0]||(u[0]=v=>t("back"))},{default:b(()=>[P(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":b(({row:v})=>[g(w,{icon:"el-icon-view",onClick:m=>t("view",v)},{default:b(()=>[P(" 查看 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-edit",onClick:m=>t("edit",v)},{default:b(()=>[P(" 编辑 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-delete",onClick:m=>n(v)},{default:b(()=>[P(" 删除 ")]),_:2},1032,["onClick"]),g(w,{icon:"el-icon-switch",disabled:v.mainVersion===k(Lt).是,onClick:m=>_(v)},{default:b(()=>[P(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:b(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},wo=A({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:l,tableData:p},getDataList:s,handleSave:a,handleUpdate:c,handleDel:o}=Z({crudOption:{rowKey:"id",...io(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});s();function r(n,d,u,y){a(d,u,y)}function f(n,d,u,y){c(d,NaN,u,y)}async function _(n,d){await o(n.data,NaN),d()}return(n,d)=>{const u=V("avue-tree");return T(),$(u,{modelValue:k(l),"onUpdate:modelValue":d[0]||(d[0]=y=>ee(l)?l.value=y:null),option:k(st),data:k(p),onNodeClick:d[1]||(d[1]=y=>t("node-click",y)),onSave:r,onUpdate:f,onDel:_},null,8,["modelValue","option","data"])}}}),Ze=A({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var r;const l=e,{FormDesign:p}=z(),s=U({get(){return l.modelValue?mt(l.modelValue):{menuBtn:!1,span:24}},set(f){t("update:modelValue",Xt(f,{useJson5:!1}))}}),a=U(()=>l.fields?JSON.parse(l.fields):[]),c=U(()=>{const f={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...f,props:{label:"name",value:"name",desc:"comment"}},{...f,props:{label:"comment",value:"comment",desc:"name"}}]}),o={form:{settings:Array.from({length:((r=Zt.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(f,_)=>{const n=V("avue-form");return f.view?(T(),$(n,{key:0,class:Wt(s.value.class),"model-value":{},option:s.value},null,8,["class","option"])):(T(),$(k(p),{key:1,modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=d=>s.value=d),"base-option":c.value,resources:o},null,8,["modelValue","base-option"]))}}}),yo=Q("span",null,"流程设计",-1),go={key:0},ho={key:1},ko={style:{height:"calc(100vh - 144px)"}},Co=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const p=fe(e),{visible:s,modelValue:a}=p,{create:c,deploy:o,getDetail:r,update:f}=Ge(),{getDetail:_,update:n}=Je(),d=["流程信息","表单设计","模型设计","完成"],u=N(!1);pe(s,async S=>{if(!S)return;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{u.value=!0;let L={};x?L=await _({flowDeployId:x}):C&&(L=await r({flowModuleId:C})),a.value=L.data}finally{u.value=!1}},{immediate:!0});const{data:y}=It().useList(),{data:w}=Nt().useList(),{data:i}=Ke().useList(),v=U(()=>{var S,C;return(C=(S=i.value)==null?void 0:S.find(x=>x.tableName===a.value.formDataTable))==null?void 0:C.tableFields}),m=N(0),h=U(()=>{var S,C;return m.value===1?((S=y.value)==null?void 0:S.map(x=>({label:x.formName,value:x.formOption})))??[]:m.value===2?((C=w.value)==null?void 0:C.map(x=>({label:x.flowName,value:x.flowData})))??[]:[]});function D(S){m.value===1?a.value.formOption=S.value:m.value===2&&(a.value.flowData=S.value)}const O=N();async function F(S){m.value===0&&await ze(O),u.value=!0;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{x?await n(a.value):C?await f(a.value):await c(a.value).then(L=>{a.value.flowModuleId=L.data.flowModuleId}),G.success("保存成功")}finally{u.value=!1}typeof S=="number"?m.value=S:m.value++}async function I(){await de.confirm("发布新版本，是否确认？","提示"),u.value=!0,o({flowModuleId:a.value.flowModuleId}).then(()=>{G.success("发布成功")}).finally(()=>{u.value=!1})}function R(){s.value=!1,m.value=0,a.value={},t("close")}return(S,C)=>{const x=V("el-link"),L=V("el-dropdown-item"),K=V("el-dropdown-menu"),H=V("el-dropdown"),Y=V("el-col"),M=V("el-step"),ye=V("el-steps"),re=V("el-button"),Ne=V("el-row"),Ie=V("avue-form"),Ft=V("el-result"),Rt=V("el-dialog"),Pt=ct("loading");return T(),$(Rt,{modelValue:k(s),"onUpdate:modelValue":C[5]||(C[5]=q=>ee(s)?s.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:R},{header:b(()=>[g(Ne,{justify:"center"},{default:b(()=>[g(Y,{span:5},{default:b(()=>{var q,ve,Oe,et;return[Q("div",null,[yo,(q=k(a))!=null&&q.flowName?(T(),E("span",go," - "+j((ve=k(a))==null?void 0:ve.flowName),1)):B("",!0),(Oe=k(a))!=null&&Oe.version?(T(),E("span",ho," - V"+j((et=k(a))==null?void 0:et.version),1)):B("",!0)]),h.value.length?(T(),$(H,{key:0},{dropdown:b(()=>[g(K,null,{default:b(()=>[(T(!0),E(W,null,X(h.value,$e=>(T(),$(L,{key:$e.label,onClick:qo=>D($e)},{default:b(()=>[P(j($e.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:b(()=>[g(x,{icon:"el-icon-arrow-down",underline:!1},{default:b(()=>[P(" 选择模板 ")]),_:1})]),_:1})):B("",!0)]}),_:1}),g(Y,{span:14},{default:b(()=>[g(ye,{active:m.value,simple:"","process-status":"finish","finish-status":"success"},{default:b(()=>[(T(),E(W,null,X(d,(q,ve)=>g(M,{key:ve,title:q,onClick:Oe=>F(ve)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),g(Y,{span:5,style:{"text-align":"right"}},{default:b(()=>[g(re,{disabled:m.value===0,loading:u.value,type:"primary",onClick:C[0]||(C[0]=q=>m.value--)},{default:b(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),g(re,{disabled:m.value===d.length-1,type:"primary",loading:u.value,onClick:C[1]||(C[1]=q=>F())},{default:b(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),g(re,{onClick:R},{default:b(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:b(()=>[dt((T(),E("div",ko,[m.value===0?(T(),$(Ie,{key:0,ref_key:"formRef",ref:O,modelValue:k(a),"onUpdate:modelValue":C[2]||(C[2]=q=>ee(a)?a.value=q:null),option:k(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),m.value===1?(T(),$(Ze,{key:1,modelValue:k(a).formOption,"onUpdate:modelValue":C[3]||(C[3]=q=>k(a).formOption=q),fields:v.value},null,8,["modelValue","fields"])):B("",!0),m.value===2?(T(),$(we,{key:2,modelValue:k(a).flowData,"onUpdate:modelValue":C[4]||(C[4]=q=>k(a).flowData=q),"flow-form-option":k(a).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),m.value===3?(T(),$(Ft,{key:3,icon:"success",title:"流程设计完成"},{extra:b(()=>[k(a).flowDeployId?B("",!0):(T(),$(re,{key:0,type:"primary",onClick:I},{default:b(()=>[P(" 发布 ")]),_:1})),g(re,{onClick:R},{default:b(()=>[P(" 关闭 ")]),_:1})]),_:1})):B("",!0)])),[[Pt,u.value]])]),_:1},8,["modelValue"])}}}),Vo=Q("span",null,"流程查看",-1),Do={key:0},To={key:1},xo=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const l=fe(e),{visible:p,modelValue:s}=l,{getDetail:a}=Ge(),{getDetail:c}=Je(),o=N("form"),r=N(!1);pe(p,async _=>{if(!_)return;const{flowModuleId:n}=s.value,{flowDeployId:d}=s.value;try{r.value=!0;let u={};d?u=await c({flowDeployId:d}):n&&(u=await a({flowModuleId:n})),s.value={...u.data}}finally{r.value=!1}},{immediate:!0});function f(){s.value={},o.value="form"}return(_,n)=>{const d=V("el-tab-pane"),u=V("el-tabs"),y=V("el-dialog"),w=ct("loading");return T(),$(y,{modelValue:k(p),"onUpdate:modelValue":n[3]||(n[3]=i=>ee(p)?p.value=i:null),width:"60%",top:"0",onClose:f},{header:b(()=>{var i,v,m,h;return[Vo,(i=k(s))!=null&&i.flowName?(T(),E("span",Do," - "+j((v=k(s))==null?void 0:v.flowName),1)):B("",!0),(m=k(s))!=null&&m.version?(T(),E("span",To," - V"+j((h=k(s))==null?void 0:h.version),1)):B("",!0)]}),default:b(()=>[dt((T(),$(u,{modelValue:o.value,"onUpdate:modelValue":n[2]||(n[2]=i=>o.value=i)},{default:b(()=>[g(d,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:b(()=>[o.value==="form"&&k(s).formOption?(T(),$(Ze,{key:0,modelValue:k(s).formOption,"onUpdate:modelValue":n[0]||(n[0]=i=>k(s).formOption=i),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),g(d,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:b(()=>[o.value==="flow"?(T(),$(we,{key:0,modelValue:k(s).flowData,"onUpdate:modelValue":n[1]||(n[1]=i=>k(s).flowData=i),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[w,r.value]])]),_:1},8,["modelValue"])}}}),Lo=A({__name:"index",setup(e){const t=N("definition"),l=N({}),p=N(""),s=N("");function a(y){p.value===y.id?p.value="":p.value=y.id}const c=N(!1),o=N(!1);function r(){l.value={},c.value=!0}function f(y){l.value=y,c.value=!0}function _(y){l.value=y,o.value=!0}function n(y){s.value=y.flowModuleId||"",t.value="deploy"}function d(){s.value="",t.value="definition"}async function u(){const y=t.value;await _e(),t.value="",await _e(),t.value=`${y}`}return(y,w)=>{const i=V("el-col"),v=V("el-row");return T(),$(v,{gutter:20},{default:b(()=>[g(i,{span:4},{default:b(()=>[g(wo,{onNodeClick:a})]),_:1}),g(i,{span:20},{default:b(()=>[t.value==="definition"?(T(),$($t,{key:0,"category-id":p.value,onAdd:r,onEdit:f,onView:_,onVersion:n},null,8,["category-id"])):B("",!0),t.value==="deploy"?(T(),$(St,{key:1,"flow-module-id":s.value,onEdit:f,onView:_,onBack:d},null,8,["flow-module-id"])):B("",!0),g(Co,{modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=m=>l.value=m),visible:c.value,"onUpdate:visible":w[1]||(w[1]=m=>c.value=m),onClose:u},null,8,["modelValue","visible"]),g(xo,{modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=m=>l.value=m),visible:o.value,"onUpdate:visible":w[3]||(w[3]=m=>o.value=m)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),No=[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),Io=[{label:"审批人",prop:"assignee"},{label:"节点名称",prop:"taskNodeName"},{label:"接收时间",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"结束时间",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"耗时",prop:"duration"},{label:"传阅意见",prop:"comment"}].map(e=>({...e,hide:!0})),Oo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...No,...Io]},$o=A({__name:"index",setup(e){const t=tl("debugMode",!1),{getTaskOpsList:l}=po(),{getCirculateOpsList:p,updateCirculate:s,removeCirculate:a}=xt(),{bindVal:c,getDataList:o,crudStateRefs:{searchForm:r,crudOption:f}}=Z({tableOption:Oo,crudOption:{getList:l},searchForm:{status:2},sortOption:{descs:"start_time"}});xe(r,o,{debounce:300,immediate:!0,deep:!0});const _=N("task"),n=[{label:"任务",name:"task",getList:l},{label:"传阅",name:"circulate",getList:p,update:s,remove:a}];function d({paneName:i}){const v=n.find(m=>m.name===i);f.value.getList=v.getList,f.value.update=v.update,f.value.remove=v.remove,o()}const{open:u,close:y}=Ct({onComplete:()=>(y(),o())},{type:"drawer"});function w(i){u({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:t.value,circulateId:i.id})}return(i,v)=>{const m=V("el-tab-pane"),h=V("el-tabs"),D=V("el-switch"),O=V("el-button"),F=V("el-link"),I=V("avue-crud");return T(),E(W,null,[g(h,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=R=>_.value=R),onTabClick:d},{default:b(()=>[(T(),E(W,null,X(n,R=>g(m,{key:R.name,label:R.label,name:R.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(I,Yt(k(c),{permission:{menu:_.value==="circulate"}}),{"menu-right":b(()=>[g(O,{type:"text"},{default:b(()=>[g(D,{modelValue:k(t),"onUpdate:modelValue":v[1]||(v[1]=R=>ee(t)?t.value=R:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:b(({row:R})=>[g(F,{type:"primary",underline:!1,onClick:S=>w(R)},{default:b(()=>[P(j(R.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),So={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ae},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Fo=A({__name:"index",setup(e){const{bindVal:t,getDataList:l}=Z({tableOption:So,crudOption:me()});return l(),(p,s)=>{const a=V("avue-crud");return T(),$(a,le(oe(k(t))),null,16)}}}),Ro={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Po={class:"flow-list"},Uo=["onClick"],Eo={class:"flow-name"},Ao=A({__name:"index",setup(e){const t=N([]),{getPublishList:l,getTaskList:p}=Le(),{getCirculateList:s}=xt();l().then(i=>{t.value=i.data});const a=[{label:"待办",value:2},{label:"已办",value:1}],{bindVal:c,getDataList:o,crudStateRefs:{searchForm:r,crudOption:f}}=Z({tableOption:Ro,crudOption:{getList:p},searchForm:{status:2}});xe(r,o,{debounce:300,immediate:!0,deep:!0});const _=N("task"),n=[{label:"任务",name:"task",getList:p},{label:"传阅",name:"circulate",getList:s}];function d({paneName:i}){const v=n.find(m=>m.name===i);f.value.getList=v.getList,o()}const{open:u,close:y}=Ct({onComplete:()=>(y(),o())},{type:"drawer"});function w(i){u({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,circulateId:i.id,detail:i.taskId?i.status===ht.已办:!1})}return(i,v)=>{const m=V("el-button"),h=V("el-collapse-item"),D=V("el-collapse"),O=V("el-card"),F=V("el-divider"),I=V("el-tab-pane"),R=V("el-tabs"),S=V("avue-radio"),C=V("el-link"),x=V("avue-crud");return T(),E(W,null,[g(O,{"body-style":{padding:"0 20px"}},{default:b(()=>[g(D,{"model-value":"1"},{default:b(()=>[g(h,{name:"1"},{title:b(()=>[g(m,{text:"",icon:"el-icon-promotion"},{default:b(()=>[P(" 发起审批 ")]),_:1})]),default:b(()=>[Q("div",Po,[(T(!0),E(W,null,X(t.value,L=>(T(),E("div",{key:L.flowKey,class:"flow-item",onClick:K=>w(L)},[g(k(se),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),Q("div",Eo,j(L.flowName),1)],8,Uo))),128))])]),_:1})]),_:1})]),_:1}),g(F,{direction:"horizontal","content-position":"left"}),g(R,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=L=>_.value=L),onTabClick:d},{default:b(()=>[(T(),E(W,null,X(n,L=>g(I,{key:L.name,label:L.label,name:L.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(x,le(oe(k(c))),{"menu-left":b(()=>[g(S,{modelValue:k(r).status,"onUpdate:modelValue":v[1]||(v[1]=L=>k(r).status=L),button:"",dic:a},null,8,["modelValue"])]),processTitle:b(({row:L})=>[g(C,{type:"primary",underline:!1,onClick:K=>w(L)},{default:b(()=>[P(j(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Ko=Te(Ao,[["__scopeId","data-v-e1f72e36"]]),Mo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Bo=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l},getDataList:p,handleUpdate:s}=Z({tableOption:Mo,crudOption:Nt()});p();const a=N(!1);async function c(r){l.value=r,a.value=!0}async function o(){await s(l.value,NaN,()=>a.value=!1,()=>{})}return(r,f)=>{const _=V("el-button"),n=V("avue-crud"),d=V("el-dialog");return T(),E(W,null,[g(n,le(oe(k(t))),{flowData:b(({row:u})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(u)},{default:b(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=u=>a.value=u),title:`模型设计-${k(l).flowName}`,fullscreen:"","destroy-on-close":""},{footer:b(()=>[g(_,{type:"primary",onClick:o},{default:b(()=>[P(" 保存 ")]),_:1}),g(_,{onClick:f[1]||(f[1]=u=>a.value=!1)},{default:b(()=>[P(" 取消 ")]),_:1})]),default:b(()=>[g(we,{modelValue:k(l).flowData,"onUpdate:modelValue":f[0]||(f[0]=u=>k(l).flowData=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),jo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Ho=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l},getDataList:p,handleUpdate:s}=Z({tableOption:jo,crudOption:It()});p();const a=N(!1);async function c(r){l.value={...r},a.value=!0}async function o(){await s(l.value,NaN,()=>a.value=!1,()=>{})}return(r,f)=>{const _=V("el-button"),n=V("avue-crud"),d=V("el-dialog");return T(),E(W,null,[g(n,le(oe(k(t))),{formOption:b(({row:u})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(u)},{default:b(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=u=>a.value=u),title:`表单设计-${k(l).formName}`,fullscreen:"","destroy-on-close":""},{footer:b(()=>[g(_,{type:"primary",onClick:o},{default:b(()=>[P(" 保存 ")]),_:1}),g(_,{onClick:f[1]||(f[1]=u=>a.value=!1)},{default:b(()=>[P(" 取消 ")]),_:1})]),default:b(()=>[g(Ze,{modelValue:k(l).formOption,"onUpdate:modelValue":f[0]||(f[0]=u=>k(l).formOption=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),rt=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ne(Ot)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}],zo={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:rt}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:rt}}]},Wo=Q("br",null,null,-1),Yo=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:l,defaults:p},getDataList:s,afterOpen:a,beforeSubmit:c}=Z({crudOption:Ke(),tableOption:zo});s();const{data:o}=me().useParam("table.default.fields");a(d=>{if(l.value.defaultFields=o.value??[],d==="edit"){const u=JSON.parse(l.value.tableFields);l.value.editFields=vt(u,o.value??[],"name")}}),c(d=>{const u=[...d.defaultFields,...d.editFields];d.tableFields=JSON.stringify(u)});const r=N(!1);J(()=>{var d;(d=p.value)!=null&&d.defaultFields&&(p.value.defaultFields.display=r.value)});const{deploy:f}=Ke(),_=N(!1);async function n(d){await de.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,f({id:d.id}).then(()=>{G.success("部署成功"),s()}).finally(()=>{_.value=!1})}return(d,u)=>{const y=V("el-button"),w=V("el-switch"),i=V("el-tooltip"),v=V("avue-crud");return T(),$(v,le(oe(k(t))),{menu:b(({row:m})=>[g(y,{type:"text",icon:"el-icon-upload",onClick:h=>n(m)},{default:b(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),"editFields-label":b(()=>[Q("div",null,[P(" 数据库字段 "),Wo,g(i,{content:"显示默认字段"},{default:b(()=>[g(w,{modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=m=>r.value=m)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),pa={install(e,t){e.component("FlowButton",vo).component("FlowDefinition",$t).component("FlowDeploy",St).component("FlowForm",We).component("FlowManage",Lo).component("FlowOps",$o).component("FlowParam",Fo).component("FlowTemplate",Bo).component("FormTemplate",Ho).component("TableTemplate",Yo).component("FlowWorkbench",Ko),z(e,t)}};export{ro as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,vo as FlowButton,$t as FlowDefinition,St as FlowDeploy,We as FlowForm,Lo as FlowManage,$o as FlowOps,Fo as FlowParam,Bo as FlowTemplate,Ko as FlowWorkbench,Ho as FormTemplate,Yo as TableTemplate,Vt as Whether,pa as default,Zl as resolveFlowFormComponent,z as useConfigProvider,Ct as useFlowForm,Xl as useFlowFormOverlay,Jl as useFlowFormWindow,Ae as whetherDic};
