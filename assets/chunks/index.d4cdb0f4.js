import{c as P,C as Me,t as Se,d as Ae,e as Be,f as Ke,g as ne,h as Ee,F as ie,b as Re,i as _e,T as se,j as we,k as je,l as ye,m as ze,n as We,o as He,p as Je}from"./mobile.f45eb069.js";import{K as zo,L as Wo,M as Ho,N as Jo,D as Go,w as Xo,v as Zo,s as Qo,x as Yo,r as qo,_ as el,z as tl,O as ol,H as ll,P as al,B as nl,Q as sl,W as il,E as ul,I as rl,X as dl,V as cl,Y as pl,$ as ml,U as fl,J as vl,R as _l,q as wl,S as yl,y as gl,A as bl,a as kl,u as Dl,Z as Fl,G as Vl}from"./mobile.f45eb069.js";import{d as x,a5 as fe,aw as Ge,l as Xe,u as A,v as D,C as O,O as t,aa as j,ab as z,N as u,M as v,E as s,B as M,L as C,X as E,H as ue,j as Q,q as ge,r as H,ax as be,F as G,b as B,y as te,x as J,a8 as ke,n as ve,_ as Ze,a as Qe,V as De}from"./framework.ff32bdcd.js";import"./index.b942cce0.js";import{s as Ye}from"./index.386fc70b.js";import{m as re}from"./merge.958938e5.js";import{o as Fe}from"./omitBy.560fb68d.js";import{a as qe}from"./snakeCase.55ae7a36.js";import{k as et}from"./baseGet.de748d67.js";import{i as tt}from"./isNil.c75b1b34.js";import{E as ot,a as lt,b as X,c as K}from"../app.b122bd95.js";import{u as R}from"./index.5304f19c.js";import"./index.es.4cf21787.js";import{I as Y}from"./iconify.11bcffd3.js";import"./index.1a6a28ca.js";import"./form.725638ac.js";import"./index.b6ebabfa.js";import"./index.e1d3da00.js";import{f as at,M as nt,j as st,b as it}from"./tree.ea7926fd.js";import"./preview.vue_vue_type_script_lang.78a9c3ae.js";import{u as q}from"./index.406e35a0.js";import{d as ut}from"./union.84ac606f.js";import{p as rt}from"./pick.d18c515d.js";import{w as oe,a as de,u as dt,c as ct,d as pt}from"./index.c70d9707.js";import{d as mt}from"./zipWith.c1dbda15.js";import"./index.0246ace1.js";import"./index.9fb34329.js";import"./cloneDeep.107df971.js";import"./baseSet.af584b72.js";import"./initCloneObject.e5cb543d.js";import"./getTag.37655c57.js";import"./data.8df2e76c.js";import"./get.198c11b5.js";import"./basePickBy.8321d4c1.js";import"./pickBy.bfc00960.js";import"./omit.941c93ff.js";import"./createCompounder.ddb34af6.js";import"./theme.658369aa.js";import"./index.vue_vue_type_script_setup_true_lang.e5a901f9.js";import"./use-form-item.66197949.js";import"./fromPairs.e099444b.js";import"./isEqual.b51c3998.js";import"./index.07c8c01c.js";import"./set.d72821b0.js";import"./index.d441a327.js";import"./config.8acf8b03.js";import"./kebabCase.19a9d0b0.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-browser.prod.f0e24fb4.js";function Ve(d){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},a=_=>d.get(e.list,{params:_}),o=q(a,{res:"data",defaultParams:[{size:-1,ascs:"sort"}]});return{getList:a,useList:o,getTree:_=>d.get(e.tree,{params:_}),create:_=>d.post(e.save,_),update:_=>d.post(e.update,_),remove:_=>d.post(e.remove,{},{params:{ids:_}})}}function le(d){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},a=p=>d.get(e.list,{params:p}),o=q(a,{res:"data.records",defaultParams:[{size:-1,ascs:"sort"}]});return{url:e,getList:a,useList:o,create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}}),deploy:p=>d.post(e.deploy,p),getDetail:p=>d.get(e.detail,{params:p})}}var Ce=(d=>(d[d.否=0]="否",d[d.是=1]="是",d))(Ce||{});function ce(d){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"},a=r=>d.get(e.list,{params:r}),o=q(a,{res:"data"});return{url:e,getList:a,useList:o,getDetail:r=>d.get(e.detail,{params:r}),update:r=>d.post(e.update,r),remove:r=>d.post(e.remove,{},{params:{ids:r}})}}function ft(d){const e={list:"/sapier-flow/flow-ops/list"},a=l=>d.get(e.list,{params:l}),o=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getTaskOpsList:a,useTaskOpsList:o}}function Oe(d){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},a=r=>d.get(e.list,{params:r}),o=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getList:a,useList:o,create:r=>d.post(e.save,r),update:r=>d.post(e.update,r),remove:r=>d.post(e.remove,{},{params:{ids:r}})}}function he(d){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},a=r=>d.get(e.list,{params:r}),o=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getList:a,useList:o,create:r=>d.post(e.save,r),update:r=>d.post(e.update,r),remove:r=>d.post(e.remove,{},{params:{ids:r}})}}function $e(d,e){return e in(Me.useFlowFormOptions??{})}function ae(d={}){const{useFlowFormOptions:e}=P(),a=re({...e},{...d});switch(a==null?void 0:a.type){case"window":return vt(a);case"dialog":case"drawer":return _t(a);default:return{open:o=>{},close:()=>{}}}}function vt(d={}){const e=x(null);return{open:(l={})=>{var w;const n=re({...d},{...l}),{window:[c,r,_]=[]}=n,p=`${c}?${Ye(Fe(n,qe(et,tt,$e)))}`;e.value=window.open(p,r,_),(w=e.value)==null||w.addEventListener("message",F=>{const{event:y,data:V}=F.data,i=l[y];typeof i=="function"&&i(V)})},close:()=>{var l;return(l=e.value)==null?void 0:l.close()},openedWindow:e}}function _t(d={}){const{appContext:e}=Xe(),{FlowForm:a}=P();let o,l;const n=r=>{o=document.createElement("div"),o.className="flow-form-wrapper";const _=re({...d},{...r}),p=fe(a,Fe(_,$e));l=fe(_.type==="dialog"?ot:lt,{class:"flow-form-overlay",modelValue:!0,onClose:c,..._.overlay},p),l.appContext=e,Ge(l,o),document.body.appendChild(o)},c=()=>{var r,_;(_=(r=l==null?void 0:l.component)==null?void 0:r.props)!=null&&_.modelValue&&(l.component.props.modelValue=!1),o&&document.body.removeChild(o),o=null};return{open:n,close:c}}const wt=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o},getDataList:l}=R({tableOption:Se,crudOption:Ae(e),sortOption:{ascs:"sort"}});return l(),(n,c)=>{const r=v("el-button"),_=v("avue-crud");return D(),O(_,j(z(u(a))),{icon:t(({row:p})=>[s(u(Y),{icon:p.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:t(({row:p})=>[s(r,{type:p.buttonType},{default:t(()=>[p.icon?(D(),O(u(Y),{key:0,icon:p.icon},null,8,["icon"])):M("",!0),C(" "+E(p.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":t(()=>[s(r,{type:u(o).buttonType},{default:t(()=>[u(o).icon?(D(),O(u(Y),{key:0,icon:u(o).icon},null,8,["icon"])):M("",!0),C(" "+E(u(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ie=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(d,{emit:e}){const a=d,{request:o}=P(),{getList:l,deploy:n,update:c,remove:r}=le(o),{bindVal:_,crudStateRefs:{searchForm:p},getDataList:w}=R({tableOption:Be,crudOption:{getList:l,remove:r},sortOption:{ascs:"sort"},searchForm:{categoryId:a.categoryId}});ue(()=>{p.value.categoryId=a.categoryId??""}),oe(p,w,{debounce:300,immediate:!0,deep:!0});const F=x(!1);async function y(k){await X.confirm("发布新版本，是否确认？","提示",{type:"success"}),F.value=!0,n({flowModuleId:k.flowModuleId}).then(()=>{K.success("发布成功"),w()}).finally(()=>{F.value=!1})}async function V(k){if(k.mainVersion)return K.warning("请先删除已发布的流程");await X.confirm("确认删除？","提示",{type:"warning"}),await r(k.flowModuleId),K.success("删除成功"),w()}function i(k){c(rt(k,["flowModuleId","flowKey","sort"])),w()}const f=ut(i,500),{open:m,close:g}=ae();function h(k){m({flowKey:k.flowKey,debug:!0,onComplete(){g(),K.success("操作成功")}})}return(k,L)=>{const I=v("el-button"),N=v("el-dropdown-item"),U=v("el-input-number"),$=v("avue-crud");return D(),O($,j(z(u(_))),{"menu-left":t(()=>[s(I,{type:"primary",icon:"el-icon-plus",onClick:L[0]||(L[0]=b=>e("add"))},{default:t(()=>[C(" 新增 ")]),_:1})]),"menu-btn":t(({row:b})=>[s(N,{icon:"el-icon-view",onClick:T=>e("view",b)},{default:t(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),s(N,{icon:"el-icon-edit",onClick:T=>e("edit",b)},{default:t(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),s(N,{icon:"el-icon-delete",onClick:T=>V(b)},{default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),s(N,{icon:"el-icon-video-play",onClick:T=>h(b)},{default:t(()=>[C(" 调试 ")]),_:2},1032,["onClick"]),s(N,{icon:"el-icon-upload",onClick:T=>y(b)},{default:t(()=>[C(" 发布 ")]),_:2},1032,["onClick"]),s(N,{icon:"el-icon-switch",onClick:T=>e("version",b)},{default:t(()=>[C(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:t(({row:b})=>[s(u(Y),{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:t(({row:b})=>[s(U,{modelValue:b.sort,"onUpdate:modelValue":T=>b.sort=T,"controls-position":"right",style:{width:"100%"},onChange:T=>u(f)(b)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),Te=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(d,{emit:e}){const a=d,{request:o}=P(),{getList:l,update:n,remove:c}=ce(o),{bindVal:r,crudStateRefs:{searchForm:_,tableData:p},getDataList:w}=R({tableOption:Ke,crudOption:{getList:l,dataPath:"res.data"},sortOption:{descs:"version"}});ue(()=>{_.value.flowModuleId=a.flowModuleId}),oe(_,w,{debounce:300,immediate:!0,deep:!0});const F=x(!1);async function y(g){await X.confirm(`确定将 ${g.flowName}(${g.flowKey}:v${g.version}) 设为主版本?`,"提示",{type:"warning"}),F.value=!0,n({flowDeployId:g.flowDeployId,flowModuleId:g.flowModuleId,mainVersion:1}).then(()=>{K.success("设置成功"),w()}).finally(()=>{F.value=!1})}async function V(g){const{value:h}=await X.prompt("请输入确认删除的流程标识","提示",{type:"warning"});h===g.flowKey&&(await c(g.flowDeployId),K.success("删除成功"),w())}const{open:i,close:f}=ae();function m(){var h;const g=(h=p.value[0])==null?void 0:h.flowKey;g&&i({flowKey:g,debug:!0,onComplete(){f(),K.success("操作成功")}})}return(g,h)=>{const k=v("el-button"),L=v("el-tooltip"),I=v("el-dropdown-item"),N=v("avue-crud");return D(),O(N,j(z(u(r))),{"menu-left":t(()=>[s(k,{loading:F.value,type:"primary",icon:"el-icon-arrow-left",onClick:h[0]||(h[0]=U=>e("back"))},{default:t(()=>[C(" 返回 ")]),_:1},8,["loading"])]),"menu-right":t(()=>[s(L,{content:"调试"},{default:t(()=>[s(k,{icon:"el-icon-video-play",circle:"",onClick:m})]),_:1})]),"menu-btn":t(({row:U})=>[s(I,{icon:"el-icon-view",onClick:$=>e("view",U)},{default:t(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),s(I,{icon:"el-icon-edit",onClick:$=>e("edit",U)},{default:t(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),s(I,{icon:"el-icon-delete",onClick:$=>V(U)},{default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),s(I,{icon:"el-icon-switch",disabled:U.mainVersion===u(Ce).是,onClick:$=>y(U)},{default:t(()=>[C(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:t(({row:U})=>[s(u(Y),{icon:U.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),yt=A({__name:"CategoryTree",emits:["node-click"],setup(d,{emit:e}){const a={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},{request:o}=P(),{crudStateRefs:{formData:l,tableData:n},getDataList:c,handleSave:r,handleUpdate:_,handleDel:p}=R({crudOption:{rowKey:"id",...Ve(o),dataPath:"res.data"},sortOption:{ascs:"sort"},tableOption:a,pageOption:{pageSize:20}});c();function w(V,i,f,m){r(i,f,m)}function F(V,i,f,m){_(i,Number.NaN,f,m)}async function y(V,i){await p(V.data,Number.NaN),i()}return(V,i)=>{const f=v("avue-tree");return D(),O(f,{modelValue:u(l),"onUpdate:modelValue":i[0]||(i[0]=m=>Q(l)?l.value=m:null),option:a,data:u(n),onNodeClick:i[1]||(i[1]=m=>e("node-click",m)),onSave:w,onUpdate:F,onDel:y},null,8,["modelValue","data"])}}}),gt={style:{display:"flex","align-items":"center"}},bt=G("span",null,"流程设计",-1),kt={key:0},Dt={key:1},Ft={style:{height:"calc(100vh - 144px)"}},Vt=A({__name:"DesignSteps",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(d,{emit:e}){const o=de(d),{visible:l,modelValue:n}=o,{request:c}=P(),{create:r,deploy:_,getDetail:p,update:w}=le(c),{getDetail:F,update:y}=ce(c),V=["流程信息","表单设计","模型设计","完成"],i=x(),f=x(),m=x(!1);ge(()=>[l.value,i.value],async()=>{var T,Z;if(!l.value||!i.value)return;const{flowModuleId:$}=n.value,{flowDeployId:b}=n.value;try{m.value=!0;let ee={};b?ee=await F({flowDeployId:b}):$&&(ee=await p({flowModuleId:$})),n.value=ee.data,(T=f.value)!=null&&T.sort&&(f.value.sort.display=!("flowDeployId"in n.value)),(Z=f.value)!=null&&Z.flowKey&&(f.value.flowKey.disabled="flowModuleId"in n.value||"flowDeployId"in n.value)}finally{m.value=!1}},{immediate:!0});const{data:g}=ne(c).useList(),h=H(()=>{var $,b;return(b=($=g.value)==null?void 0:$.find(T=>T.tableName===n.value.formDataTable))==null?void 0:b.tableFields}),k=x(0);async function L($){k.value===0&&await Re(i),m.value=!0;const{flowModuleId:b}=n.value,{flowDeployId:T}=n.value;try{T?await y(n.value):b?await w(n.value):await r(n.value).then(Z=>{n.value.flowModuleId=Z.data.flowModuleId}),K.success("保存成功")}finally{m.value=!1}typeof $=="number"?k.value=$:k.value++}async function I(){await X.confirm("发布新版本，是否确认？","提示",{type:"success"}),m.value=!0,_({flowModuleId:n.value.flowModuleId}).then(()=>{K.success("发布成功")}).finally(()=>{m.value=!1})}async function N(){await X.confirm("流程定义的数据(包括流程信息、表单设计、流程设计)将被修改为当前版本的数据，是否确认？","提示",{type:"warning"}),await w(n.value),K.success("同步成功")}function U(){l.value=!1,k.value=0,n.value={},e("close")}return($,b)=>{const T=v("el-col"),Z=v("el-step"),ee=v("el-steps"),W=v("el-button"),xe=v("el-row"),Ne=v("avue-form"),Le=v("el-result"),Pe=v("el-dialog"),Ue=be("loading");return D(),O(Pe,{modelValue:u(l),"onUpdate:modelValue":b[8]||(b[8]=S=>Q(l)?l.value=S:null),"show-close":!1,fullscreen:"","destroy-on-close":"",onClose:U},{header:t(()=>[s(xe,{justify:"center"},{default:t(()=>[s(T,{span:6},{default:t(()=>[G("div",gt,[bt,u(n).flowName?(D(),B("span",kt," - "+E(u(n).flowName),1)):M("",!0),u(n).version?(D(),B("span",Dt," - V"+E(u(n).version),1)):M("",!0),s(u(zt),{"form-data":u(n),"onUpdate:formData":b[0]||(b[0]=S=>Q(n)?n.value=S:null),"active-step":k.value},null,8,["form-data","active-step"])])]),_:1}),s(T,{span:12},{default:t(()=>[s(ee,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:t(()=>[(D(),B(J,null,te(V,(S,me)=>s(Z,{key:me,title:S,style:{cursor:"pointer"},onClick:Wt=>L(me)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),s(T,{span:6,style:{"text-align":"right"}},{default:t(()=>[s(W,{disabled:k.value===0,loading:m.value,type:"primary",onClick:b[1]||(b[1]=S=>L(k.value-1))},{default:t(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),s(W,{disabled:k.value===V.length-1,loading:m.value,type:"primary",onClick:b[2]||(b[2]=S=>L(k.value+1))},{default:t(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),s(W,{loading:m.value,type:"success",onClick:b[3]||(b[3]=S=>L(k.value))},{default:t(()=>[C(" 保存 ")]),_:1},8,["loading"]),s(W,{onClick:U},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:t(()=>[ke((D(),B("div",Ft,[k.value===0?(D(),O(Ne,{key:0,ref_key:"formRef",ref:i,modelValue:u(n),"onUpdate:modelValue":b[4]||(b[4]=S=>Q(n)?n.value=S:null),defaults:f.value,"onUpdate:defaults":b[5]||(b[5]=S=>f.value=S),option:u(Ee),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","defaults","option"])):M("",!0),k.value===1?(D(),O(u(pe),{key:1,modelValue:u(n).formOption,"onUpdate:modelValue":b[6]||(b[6]=S=>u(n).formOption=S),fields:h.value},null,8,["modelValue","fields"])):M("",!0),k.value===2?(D(),O(u(ie),{key:2,modelValue:u(n).flowData,"onUpdate:modelValue":b[7]||(b[7]=S=>u(n).flowData=S),"flow-form-option":u(n).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),k.value===3?(D(),O(Le,{key:3,icon:"success",title:"流程设计完成"},{extra:t(()=>[u(n).flowDeployId?(D(),O(W,{key:0,type:"primary",onClick:N},{default:t(()=>[C(" 同步到流程定义 ")]),_:1})):M("",!0),u(n).flowDeployId?M("",!0):(D(),O(W,{key:1,type:"primary",onClick:I},{default:t(()=>[C(" 发布 ")]),_:1})),s(W,{onClick:U},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[Ue,m.value]])]),_:1},8,["modelValue"])}}}),Ct=G("span",null,"流程查看",-1),Ot={key:0},ht={key:1},$t=A({__name:"DesignView",props:{modelValue:{},visible:{type:Boolean}},setup(d){const a=de(d),{visible:o,modelValue:l}=a,{request:n}=P(),{getDetail:c}=le(n),{getDetail:r}=ce(n),_=x("form"),p=x(!1);ge(o,async F=>{if(!F)return;const{flowModuleId:y}=l.value,{flowDeployId:V}=l.value;try{p.value=!0;let i={};V?i=await r({flowDeployId:V}):y&&(i=await c({flowModuleId:y})),l.value={...i.data}}finally{p.value=!1}},{immediate:!0});function w(){l.value={},_.value="form"}return(F,y)=>{const V=v("el-tab-pane"),i=v("el-tabs"),f=v("el-dialog"),m=be("loading");return D(),O(f,{modelValue:u(o),"onUpdate:modelValue":y[3]||(y[3]=g=>Q(o)?o.value=g:null),width:"60%",top:"5%",onClose:w},{header:t(()=>{var g,h,k,L;return[Ct,(g=u(l))!=null&&g.flowName?(D(),B("span",Ot," - "+E((h=u(l))==null?void 0:h.flowName),1)):M("",!0),(k=u(l))!=null&&k.version?(D(),B("span",ht," - V"+E((L=u(l))==null?void 0:L.version),1)):M("",!0)]}),default:t(()=>[ke((D(),O(i,{modelValue:_.value,"onUpdate:modelValue":y[2]||(y[2]=g=>_.value=g)},{default:t(()=>[s(V,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:t(()=>[_.value==="form"&&u(l).formOption?(D(),O(u(pe),{key:0,modelValue:u(l).formOption,"onUpdate:modelValue":y[0]||(y[0]=g=>u(l).formOption=g),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),s(V,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:t(()=>[_.value==="flow"?(D(),O(u(ie),{key:0,modelValue:u(l).flowData,"onUpdate:modelValue":y[1]||(y[1]=g=>u(l).flowData=g),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[m,p.value]])]),_:1},8,["modelValue"])}}}),It=A({__name:"index",setup(d){const e=x("definition"),a=x({}),o=x(""),l=x("");function n(i){o.value===i.id?o.value="":o.value=i.id}const c=x(!1),r=x(!1);function _(){a.value={},c.value=!0}function p(i){a.value=i,c.value=!0}function w(i){a.value=i,r.value=!0}function F(i){l.value=i.flowModuleId||"",e.value="deploy"}function y(){l.value="",e.value="definition"}async function V(){const i=e.value;await ve(),e.value="",await ve(),e.value=`${i}`}return(i,f)=>{const m=v("el-card"),g=v("el-col"),h=v("el-row");return D(),O(h,{gutter:20},{default:t(()=>[s(g,{span:6},{default:t(()=>[s(m,{header:"流程分类",style:{height:"100%"}},{default:t(()=>[s(yt,{onNodeClick:n})]),_:1})]),_:1}),s(g,{span:18},{default:t(()=>[e.value==="definition"?(D(),O(Ie,{key:0,"category-id":o.value,onAdd:_,onEdit:p,onView:w,onVersion:F},null,8,["category-id"])):M("",!0),e.value==="deploy"&&l.value?(D(),O(Te,{key:1,"flow-module-id":l.value,onEdit:p,onView:w,onBack:y},null,8,["flow-module-id"])):M("",!0),s(Vt,{modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=k=>a.value=k),visible:c.value,"onUpdate:visible":f[1]||(f[1]=k=>c.value=k),onClose:V},null,8,["modelValue","visible"]),s($t,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=k=>a.value=k),visible:r.value,"onUpdate:visible":f[3]||(f[3]=k=>r.value=k)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Tt=A({__name:"index",setup(d){const e=dt("debugMode",!1),{request:a}=P(),{getTaskOpsList:o}=ft(a),{bindVal:l,getDataList:n,crudStateRefs:{searchForm:c}}=R({tableOption:_e,crudOption:{getList:o},searchForm:{status:se.待办,taskNodeType:"userTask"},sortOption:{descs:"start_time"}});oe(c,n,{debounce:300,immediate:!0,deep:!0});const{open:r,close:_}=ae();function p(w){r({flowKey:w.flowKey,taskId:w.taskId,instanceId:w.flowInstanceId,debug:e.value,onComplete(){_(),K.success("操作成功"),n()}})}return(w,F)=>{const y=v("avue-radio"),V=v("el-switch"),i=v("el-button"),f=v("el-link"),m=v("avue-crud");return D(),O(m,j(z(u(l))),{"menu-left":t(()=>[s(y,{modelValue:u(c).taskNodeType,"onUpdate:modelValue":F[0]||(F[0]=g=>u(c).taskNodeType=g),dic:u(we),button:""},null,8,["modelValue","dic"])]),"menu-right":t(()=>[s(i,{type:"text"},{default:t(()=>[s(V,{modelValue:u(e),"onUpdate:modelValue":F[1]||(F[1]=g=>Q(e)?e.value=g:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:t(({row:g})=>[s(f,{type:"primary",underline:!1,onClick:h=>p(g)},{default:t(()=>[C(E(g.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),xt=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,getDataList:o}=R({tableOption:je,crudOption:ye(e)});return o(),(l,n)=>{const c=v("avue-crud");return D(),O(c,j(z(u(a))),null,16)}}}),Nt={class:"flow-list"},Lt=["onClick"],Pt={class:"flow-name"},Ut=A({__name:"index",setup(d){const{request:e}=P(),{useList:a}=Ve(e),{usePublishList:o,getTaskList:l}=ze(e),{data:n}=a(),{data:c}=o(),r=H(()=>{var i;return(i=n.value)==null?void 0:i.map(f=>{var g;const m=((g=c.value)==null?void 0:g.filter(h=>h.categoryId===f.id))??[];return{...f,list:m}}).filter(f=>{var m;return(m=f.list)==null?void 0:m.length})}),{bindVal:_,getDataList:p,crudStateRefs:{searchForm:w}}=R({tableOption:_e,crudOption:{getList:l},searchForm:{status:se.待办,taskNodeType:"userTask"}});oe(w,p,{debounce:300,immediate:!0,deep:!0});const{open:F,close:y}=ae();function V(i){F({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,detail:i.taskId?i.status===se.已办:!1,onComplete(){y(),K.success("操作成功"),p()}})}return(i,f)=>{const m=v("el-button"),g=v("el-divider"),h=v("el-collapse-item"),k=v("el-collapse"),L=v("el-card"),I=v("avue-radio"),N=v("el-link"),U=v("avue-crud");return D(),B(J,null,[s(L,{"body-style":{padding:"0 20px"}},{default:t(()=>[s(k,{"model-value":"1"},{default:t(()=>[s(h,{name:"1"},{title:t(()=>[s(m,{text:"",icon:"el-icon-promotion"},{default:t(()=>[C(" 发起审批 ")]),_:1})]),default:t(()=>[G("div",Nt,[(D(!0),B(J,null,te(r.value,$=>(D(),B("div",{key:$.id,class:"flow-category"},[s(g,{"content-position":"left"},{default:t(()=>[C(E($.name),1)]),_:2},1024),(D(!0),B(J,null,te($.list,b=>(D(),B("div",{key:b.flowKey,class:"flow-item",onClick:T=>V(b)},[s(u(Y),{class:"flow-icon",icon:b.flowIcon,width:"60"},null,8,["icon"]),G("div",Pt,E(b.flowName),1)],8,Lt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),s(g),s(U,j(z(u(_))),{"menu-left":t(()=>[s(I,{modelValue:u(w).taskNodeType,"onUpdate:modelValue":f[0]||(f[0]=$=>u(w).taskNodeType=$),dic:u(we),button:""},null,8,["modelValue","dic"])]),processTitle:t(({row:$})=>[s(N,{type:"primary",underline:!1,onClick:b=>V($)},{default:t(()=>[C(E($.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Mt=Ze(Ut,[["__scopeId","data-v-f5375a1e"]]),St=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o},getDataList:l,handleUpdate:n}=R({tableOption:We,crudOption:Oe(e)});l();const c=x(!1);async function r(p){o.value=p,c.value=!0}async function _(){await n(o.value,Number.NaN,()=>c.value=!1,()=>{})}return(p,w)=>{const F=v("el-button"),y=v("avue-crud"),V=v("el-dialog");return D(),B(J,null,[s(y,j(z(u(a))),{menu:t(({row:i})=>[s(F,{type:"primary",text:"",icon:"el-icon-crop",onClick:f=>r(i)},{default:t(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),s(V,{modelValue:c.value,"onUpdate:modelValue":w[2]||(w[2]=i=>c.value=i),title:`模型设计-${u(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:t(()=>[s(F,{type:"primary",onClick:_},{default:t(()=>[C(" 保存 ")]),_:1}),s(F,{onClick:w[1]||(w[1]=i=>c.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1})]),default:t(()=>[s(ie,{modelValue:u(o).flowData,"onUpdate:modelValue":w[0]||(w[0]=i=>u(o).flowData=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),pe=A({__name:"FormDesignWrapper",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(d,{emit:e}){var _;const a=d,{FormDesign:o}=P(),l=H({get(){return a.modelValue?nt(a.modelValue):{menuBtn:!1,span:24}},set(p){e("update:modelValue",st(p,{useJson5:!1}))}}),n=H(()=>a.fields?JSON.parse(a.fields):[]),c=H(()=>{const p={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return w=>{const F=it(w);return[{...p,props:{label:"name",value:"name",desc:"comment"}},{...p,props:{label:"comment",value:"comment",desc:"name"}},...Array.from({length:((F==null?void 0:F.length)??0)-2}).fill({}).concat({label:"样式类",prop:"class"})]}}),r={form:{settings:Array.from({length:((_=at.settings)==null?void 0:_.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(p,w)=>{const F=v("avue-form");return p.view?(D(),O(F,{key:0,class:Qe(l.value.class),"model-value":{},option:l.value},null,8,["class","option"])):(D(),O(u(o),{key:1,modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),"base-option":c.value,resources:r},null,8,["modelValue","base-option"]))}}}),At=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o},getDataList:l,handleUpdate:n}=R({tableOption:He,crudOption:he(e)});l();const c=x(!1);async function r(p){o.value={...p},c.value=!0}async function _(){await n(o.value,Number.NaN,()=>c.value=!1,()=>{})}return(p,w)=>{const F=v("el-button"),y=v("avue-crud"),V=v("el-dialog");return D(),B(J,null,[s(y,j(z(u(a))),{menu:t(({row:i})=>[s(F,{type:"primary",text:"",icon:"el-icon-crop",onClick:f=>r(i)},{default:t(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),s(V,{modelValue:c.value,"onUpdate:modelValue":w[2]||(w[2]=i=>c.value=i),title:`表单设计-${u(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:t(()=>[s(F,{type:"primary",onClick:_},{default:t(()=>[C(" 保存 ")]),_:1}),s(F,{onClick:w[1]||(w[1]=i=>c.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1})]),default:t(()=>[s(pe,{modelValue:u(o).formOption,"onUpdate:modelValue":w[0]||(w[0]=i=>u(o).formOption=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Bt=G("br",null,null,-1),Kt=A({__name:"index",setup(d){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:o,defaults:l},getDataList:n,afterOpen:c,beforeSubmit:r}=R({crudOption:ne(e),tableOption:Je});n();const{data:_}=ye(e).useParam("table.default.fields");c(f=>{if(o.value.defaultFields=_.value??[],f==="edit"){const m=JSON.parse(o.value.tableFields);o.value.editFields=mt(m,_.value??[],"name")}}),r(f=>{const m=[...f.defaultFields,...f.editFields];f.tableFields=JSON.stringify(m)});const p=x(!1);ue(()=>{var f;(f=l.value)!=null&&f.defaultFields&&(l.value.defaultFields.display=p.value)});const{deploy:w,getFields:F}=ne(e),y=x(!1);async function V(f){await X.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),y.value=!0,w({id:f.id}).then(()=>{K.success("部署成功"),n()}).finally(()=>{y.value=!1})}function i(){F({tableName:o.value.tableName}).then(f=>{var m;if(!((m=f.data)!=null&&m.length))return K.warning("未找到该表");o.value.editFields=f.data})}return(f,m)=>{const g=v("el-button"),h=v("el-input"),k=v("el-switch"),L=v("el-tooltip"),I=v("avue-crud");return D(),O(I,j(z(u(a))),{menu:t(({row:N})=>[s(g,{type:"text",icon:"el-icon-upload",onClick:U=>V(N)},{default:t(()=>[C(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":t(()=>[s(h,{modelValue:u(o).tableName,"onUpdate:modelValue":m[0]||(m[0]=N=>u(o).tableName=N),placeholder:"请输入 表名"},{append:t(()=>[s(g,{type:"primary",size:"default",onClick:i},{default:t(()=>[C(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":t(()=>[G("div",null,[C(" 数据库字段 "),Bt,s(L,{content:"显示默认字段"},{default:t(()=>[s(k,{modelValue:p.value,"onUpdate:modelValue":m[1]||(m[1]=N=>p.value=N)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Et=A({__name:"index",setup(d){const e=ct(),a=x({}),{FlowForm:o}=P(),l=H(()=>{const c=a.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${c==null?void 0:c.title}`:e.instanceId||e.taskId?`办理流程：${c==null?void 0:c.title}`:`发起流程：${c==null?void 0:c.title}`});pt(l);async function n(c){window.postMessage({event:"onComplete",data:{...c}})}return(c,r)=>(D(),O(u(o),De({flowDetail:a.value,"onUpdate:flowDetail":r[0]||(r[0]=_=>a.value=_)},u(e),{onComplete:n}),null,16,["flowDetail"]))}}),Rt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:wt,PageFlowDefinition:Ie,PageFlowDeploy:Te,PageFlowForm:Et,PageFlowManage:It,PageFlowOps:Tt,PageFlowParam:xt,PageFlowTemplate:St,PageFlowWorkbench:Mt,PageFormTemplate:At,PageTableTemplate:Kt},Symbol.toStringTag,{value:"Module"})),jt={key:1},zt=A({__name:"TemplateSelect",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(d){const e=d,{formData:a,activeStep:o}=de(e),{request:l}=P(),{getDetail:n,useList:c}=le(l),{data:r}=he(l).useList(),{data:_}=Oe(l).useList(),{data:p}=c(),w=H(()=>{var y,V,i,f;return(o==null?void 0:o.value)===1?[{label:"表单模板",value:"",type:"divider"},...((y=r.value)==null?void 0:y.map(m=>({label:m.formName,value:m.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((V=p.value)==null?void 0:V.map(m=>({label:m.flowName,value:m.flowModuleId,type:"definition"})))??[]]:(o==null?void 0:o.value)===2?[{label:"流程模板",value:"",type:"divider"},...((i=_.value)==null?void 0:i.map(m=>({label:m.flowName,value:m.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((f=p.value)==null?void 0:f.map(m=>({label:m.flowName,value:m.flowModuleId,type:"definition"})))??[]]:[]});async function F(y){if((o==null?void 0:o.value)===1){if(y.type==="template")a.value.formOption=y.value;else if(y.type==="definition"){const V=await n({flowModuleId:y.value});a.value.formOption=V.data.formOption}}else if((o==null?void 0:o.value)===2){if(y.type==="template")a.value.flowData=y.value;else if(y.type==="definition"){const V=await n({flowModuleId:y.value});a.value.flowData=V.data.flowData}}}return(y,V)=>{const i=v("Icon"),f=v("el-button"),m=v("el-divider"),g=v("el-dropdown-item"),h=v("el-scrollbar"),k=v("el-dropdown-menu"),L=v("el-dropdown");return w.value.length?(D(),O(L,{key:0},{dropdown:t(()=>[s(k,null,{default:t(()=>[s(h,{"max-height":"600px"},{default:t(()=>[(D(!0),B(J,null,te(w.value,I=>(D(),O(g,De({key:I.label},I,{disabled:I.type==="divider",onClick:N=>F(I)}),{default:t(()=>[I.type==="divider"?(D(),O(m,{key:0},{default:t(()=>[C(E(I.label),1)]),_:2},1024)):(D(),B("span",jt,E(I.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:t(()=>[s(f,{text:"",type:"primary",underline:!1},{default:t(()=>[C(" 选择模板 "),s(i,{icon:"ep:arrow-down"})]),_:1})]),_:1})):M("",!0)}}}),Eo={install(d,e){P(e),Object.entries(Rt).forEach(([a,o])=>{d.component(a,o)})}};export{zo as ApprovalForm,Wo as ApprovalTree,Ho as ButtonList,Me as CONFIG_DEFAULT,yt as CategoryTree,Jo as CommonComments,Vt as DesignSteps,$t as DesignView,Go as FieldType,Xo as FlowButtonApproval,Zo as FlowButtonDisplay,Qo as FlowButtonKey,Yo as FlowButtonStatus,qo as FlowButtonType,ie as FlowDesignWrapper,el as FlowForm,tl as FlowStatus,ol as FlowTrack,pe as FormDesignWrapper,ll as HandleType,al as InternalForm,Ce as IsMainVersion,wt as PageFlowButton,Ie as PageFlowDefinition,Te as PageFlowDeploy,Et as PageFlowForm,It as PageFlowManage,Tt as PageFlowOps,xt as PageFlowParam,St as PageFlowTemplate,Mt as PageFlowWorkbench,At as PageFormTemplate,Kt as PageTableTemplate,nl as TablePrimary,se as TaskStatus,zt as TemplateSelect,sl as UploadTable,il as Whether,Re as asyncValidate,Eo as default,ul as defineTableOption,Ee as designFormOption,rl as fieldTypeDic,dl as flowFormEmits,cl as flowFormProps,pl as injectionKey,ml as isMobile,fl as mergeColumn,vl as tablePrimaryDic,we as taskNodeTypeDic,_l as useButtonHandler,wl as useCommonCommentApi,P as useConfigProvider,yl as useEmitter,Ae as useFlowButtonApi,Ve as useFlowCategoryApi,le as useFlowDefinitionApi,ce as useFlowDeployApi,gl as useFlowFileApi,ae as useFlowForm,_t as useFlowFormOverlay,vt as useFlowFormWindow,ft as useFlowOpsApi,ye as useFlowParamApi,ze as useFlowTaskApi,Oe as useFlowTemplateApi,bl as useFlowUserApi,kl as useFormDefaults,he as useFormTemplateApi,Dl as useInjectState,Fl as useProvideState,ne as useTableTemplateApi,Vl as whetherDic};
