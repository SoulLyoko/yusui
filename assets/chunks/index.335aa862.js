import{c as L,C as Ae,t as Be,d as Ee,e as Ke,f as Re,g as ie,h as ze,F as ue,b as je,i as We,T as ee,j as Je,k as ye,l as Ge,m as He,n as Qe,o as Xe,p as Ye}from"./mobile.744ed105.js";import{K as Jo,L as Go,D as Ho,w as Qo,v as Xo,s as Yo,x as Zo,r as qo,_ as el,z as tl,H as ol,N as ll,B as al,O as nl,W as sl,E as il,I as ul,U as rl,S as dl,M as cl,V as pl,Y as ml,R as fl,J as vl,P as _l,q as wl,Q as yl,y as gl,A as bl,a as kl,u as Dl,X as Fl,G as Vl}from"./mobile.744ed105.js";import{h as T,a5 as ve,aE as Ze,D as qe,d as M,J as _,b as h,w as t,a9 as z,aa as j,l as d,o as D,N as n,e as P,a as C,t as K,A as re,B as Y,g as J,n as et,c as A,L as te,R as ge,K as G,z as be,aF as ke,k as H,a7 as De,E as _e,_ as tt}from"./framework.6b67ac47.js";import"./index.013eb64a.js";import{s as ot}from"./index.386fc70b.js";import{m as de}from"./merge.0f72b880.js";import{a as Fe}from"./omitBy.e7ddedc3.js";import{a as lt}from"./snakeCase.6293e677.js";import{y as at}from"./baseSet.c6f802bb.js";import{i as nt}from"./isNil.990ccdb3.js";import{E as st,a as it}from"../app.8c3eb3b2.js";import{u as R}from"./index.3bec44c8.js";import{u as oe}from"./index.es.1accc3d3.js";import{I as Z}from"./iconify.924204c7.js";import"./index.181284a5.js";import"./form.b5017a1b.js";import"./index.7749527f.js";import"./index.6700b933.js";import{j as ut,d as rt}from"./tree.c7a66f34.js";import"./vuedraggable.umd.9831e9f5.js";import{d as dt}from"./union.a37b7994.js";import{a as Q,E as B}from"./index.6dee874e.js";import{p as ct}from"./pick.3451ca24.js";import{w as le,a as ce,u as pt,b as mt,c as ft}from"./index.63550f19.js";import{f as vt,b as _t}from"./form.c7c8470f.js";import{e as wt}from"./index.0246ace1.js";import{d as yt}from"./zipWith.b37739bd.js";import"./index.af03a1c8.js";import"./cloneDeep.707d050f.js";import"./initCloneObject.52366613.js";import"./getTag.0b794599.js";import"./data.4983ed38.js";import"./basePickBy.93df484a.js";import"./pickBy.ee766c69.js";import"./baseMap.4525a961.js";import"./createCompounder.21553c6c.js";import"./theme.446fc1bf.js";import"./index.vue_vue_type_script_setup_true_lang.9d3d440b.js";import"./index.c02d6d41.js";import"./use-form-item.2570ef11.js";import"./isEqual.d232753d.js";import"./index.9dabad22.js";import"./config.287367be.js";import"./index.ac500038.js";import"./set.d1d08ef6.js";import"./kebabCase.9388dd24.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-bundler.21b58301.js";function Ve(u){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},i=f=>u.get(e.list,{params:f});return{getList:i,useList:()=>oe(()=>i({size:-1,ascs:"sort"}).then(f=>f.data)),getTree:f=>u.get(e.tree,{params:f}),create:f=>u.post(e.save,f),update:f=>u.post(e.update,f),remove:f=>u.post(e.remove,{},{params:{ids:f}})}}function ae(u){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},i=r=>u.get(e.list,{params:r});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1,ascs:"sort"}).then(r=>r.data.records)),create:r=>u.post(e.save,r),update:r=>u.post(e.update,r),remove:r=>u.post(e.remove,{},{params:{ids:r}}),deploy:r=>u.post(e.deploy,r),getDetail:r=>u.get(e.detail,{params:r})}}var Ce=(u=>(u[u.否=0]="否",u[u.是=1]="是",u))(Ce||{});function pe(u){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:s=>u.get(e.list,{params:s}),getDetail:s=>u.get(e.detail,{params:s}),update:s=>u.post(e.update,s),remove:s=>u.post(e.remove,{},{params:{ids:s}})}}function gt(u){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:o=>u.get(e.list,{params:o})}}function he(u){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},i=c=>u.get(e.list,{params:c});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(c=>c.data.records)),create:c=>u.post(e.save,c),update:c=>u.post(e.update,c),remove:c=>u.post(e.remove,{},{params:{ids:c}})}}function Oe(u){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},i=c=>u.get(e.list,{params:c});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(c=>c.data.records)),create:c=>u.post(e.save,c),update:c=>u.post(e.update,c),remove:c=>u.post(e.remove,{},{params:{ids:c}})}}function $e(u,e){return e in(Ae.useFlowFormOptions??{})}function ne(u={}){const{useFlowFormOptions:e}=L(),i=de({...e},{...u});switch(i==null?void 0:i.type){case"window":return bt(i);case"dialog":case"drawer":return kt(i);default:return{open:o=>{},close:()=>{}}}}function bt(u={}){const e=T(null);return{open:(l={})=>{var w;const a=de({...u},{...l}),{window:[s,c,f]=[]}=a,r=`${s}?${ot(Fe(a,lt(at,nt,$e)))}`;e.value=window.open(r,c,f),(w=e.value)==null||w.addEventListener("message",V=>{const{event:y,data:b}=V.data,m=l[y];typeof m=="function"&&m(b)})},close:()=>{var l;return(l=e.value)==null?void 0:l.close()},openedWindow:e}}function kt(u={}){const{appContext:e}=qe(),{FlowForm:i}=L();let o,l;const a=c=>{o=document.createElement("div"),o.className="flow-form-wrapper";const f=de({...u},{...c}),r=ve(i,Fe(f,$e));l=ve(f.type==="dialog"?st:it,{class:"flow-form-overlay",modelValue:!0,onClose:s,...f.overlay},r),l.appContext=e,Ze(l,o),document.body.appendChild(o)},s=()=>{var c,f;(f=(c=l==null?void 0:l.component)==null?void 0:c.props)!=null&&f.modelValue&&(l.component.props.modelValue=!1),o&&document.body.removeChild(o),o=null};return{open:a,close:s}}const Dt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:o},getDataList:l}=R({tableOption:Be,crudOption:Ee(e),sortOption:{ascs:"sort"}});return l(),(a,s)=>{const c=_("el-button"),f=_("avue-crud");return D(),h(f,z(j(d(i))),{icon:t(({row:r})=>[n(d(Z),{icon:r.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:t(({row:r})=>[n(c,{type:r.buttonType},{default:t(()=>[r.icon?(D(),h(d(Z),{key:0,icon:r.icon},null,8,["icon"])):P("",!0),C(" "+K(r.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":t(()=>[n(c,{type:d(o).buttonType},{default:t(()=>[d(o).icon?(D(),h(d(Z),{key:0,icon:d(o).icon},null,8,["icon"])):P("",!0),C(" "+K(d(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ie=M({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(u,{emit:e}){const i=u,{request:o}=L(),{getList:l,deploy:a,update:s,remove:c}=ae(o),{bindVal:f,crudStateRefs:{searchForm:r},getDataList:w}=R({tableOption:Ke,crudOption:{getList:l,remove:c},sortOption:{ascs:"sort"},searchForm:{categoryId:i.categoryId}});re(()=>{r.value.categoryId=i.categoryId??""}),le(r,w,{debounce:300,immediate:!0,deep:!0});const V=T(!1);async function y(k){await Q.confirm("发布新版本，是否确认？","提示",{type:"success"}),V.value=!0,a({flowModuleId:k.flowModuleId}).then(()=>{B.success("发布成功"),w()}).finally(()=>{V.value=!1})}async function b(k){if(k.mainVersion)return B.warning("请先删除已发布的流程");await Q.confirm("确认删除？","提示",{type:"warning"}),await c(k.flowModuleId),B.success("删除成功"),w()}function m(k){s(ct(k,["flowModuleId","flowKey","sort"])),w()}const p=dt(m,500),{open:v,close:F}=ne();function O(k){v({flowKey:k.flowKey,debug:!0,onComplete(){F(),B.success("操作成功")}})}return(k,I)=>{const E=_("el-button"),x=_("el-dropdown-item"),S=_("el-input-number"),N=_("avue-crud");return D(),h(N,z(j(d(f))),{"menu-left":t(()=>[n(E,{type:"primary",icon:"el-icon-plus",onClick:I[0]||(I[0]=g=>e("add"))},{default:t(()=>[C(" 新增 ")]),_:1})]),"menu-btn":t(({row:g})=>[n(x,{icon:"el-icon-view",onClick:$=>e("view",g)},{default:t(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-edit",onClick:$=>e("edit",g)},{default:t(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-delete",onClick:$=>b(g)},{default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-video-play",onClick:$=>O(g)},{default:t(()=>[C(" 调试 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-upload",onClick:$=>y(g)},{default:t(()=>[C(" 发布 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-switch",onClick:$=>e("version",g)},{default:t(()=>[C(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:t(({row:g})=>[n(d(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:t(({row:g})=>[n(S,{modelValue:g.sort,"onUpdate:modelValue":$=>g.sort=$,"controls-position":"right",style:{width:"100%"},onChange:$=>d(p)(g)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),xe=M({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(u,{emit:e}){const i=u,{request:o}=L(),{getList:l,update:a,remove:s}=pe(o),{bindVal:c,crudStateRefs:{searchForm:f,tableData:r},getDataList:w}=R({tableOption:Re,crudOption:{getList:l,dataPath:"res.data"},sortOption:{descs:"version"}});re(()=>{f.value.flowModuleId=i.flowModuleId}),le(f,w,{debounce:300,immediate:!0,deep:!0});const V=T(!1);async function y(F){await Q.confirm(`确定将 ${F.flowName}(${F.flowKey}:v${F.version}) 设为主版本?`,"提示",{type:"warning"}),V.value=!0,a({flowDeployId:F.flowDeployId,flowModuleId:F.flowModuleId,mainVersion:1}).then(()=>{B.success("设置成功"),w()}).finally(()=>{V.value=!1})}async function b(F){const{value:O}=await Q.prompt("请输入确认删除的流程标识","提示",{type:"warning"});O===F.flowKey&&(await s(F.flowDeployId),B.success("删除成功"),w())}const{open:m,close:p}=ne();function v(){var O;const F=(O=r.value[0])==null?void 0:O.flowKey;F&&m({flowKey:F,debug:!0,onComplete(){p(),B.success("操作成功")}})}return(F,O)=>{const k=_("el-button"),I=_("el-tooltip"),E=_("el-dropdown-item"),x=_("avue-crud");return D(),h(x,z(j(d(c))),{"menu-left":t(()=>[n(k,{loading:V.value,type:"primary",icon:"el-icon-arrow-left",onClick:O[0]||(O[0]=S=>e("back"))},{default:t(()=>[C(" 返回 ")]),_:1},8,["loading"])]),"menu-right":t(()=>[n(I,{content:"调试"},{default:t(()=>[n(k,{icon:"el-icon-video-play",circle:"",onClick:v})]),_:1})]),"menu-btn":t(({row:S})=>[n(E,{icon:"el-icon-view",onClick:N=>e("view",S)},{default:t(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),n(E,{icon:"el-icon-edit",onClick:N=>e("edit",S)},{default:t(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),n(E,{icon:"el-icon-delete",onClick:N=>b(S)},{default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),n(E,{icon:"el-icon-switch",disabled:S.mainVersion===d(Ce).是,onClick:N=>y(S)},{default:t(()=>[C(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:t(({row:S})=>[n(d(Z),{icon:S.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),we={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},Ft=M({__name:"index",emits:["node-click"],setup(u,{emit:e}){const{request:i}=L(),{crudStateRefs:{formData:o,tableData:l},getDataList:a,handleSave:s,handleUpdate:c,handleDel:f}=R({crudOption:{rowKey:"id",...Ve(i),dataPath:"res.data"},sortOption:{ascs:"sort"},tableOption:we,pageOption:{pageSize:20}});a();function r(y,b,m,p){s(b,m,p)}function w(y,b,m,p){c(b,Number.NaN,m,p)}async function V(y,b){await f(y.data,Number.NaN),b()}return(y,b)=>{const m=_("avue-tree");return D(),h(m,{modelValue:d(o),"onUpdate:modelValue":b[0]||(b[0]=p=>Y(o)?o.value=p:null),option:d(we),data:d(l),onNodeClick:b[1]||(b[1]=p=>e("node-click",p)),onSave:r,onUpdate:w,onDel:V},null,8,["modelValue","option","data"])}}}),me=M({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(u,{emit:e}){var f;const i=u,{FormDesign:o}=L(),l=J({get(){return i.modelValue?ut(i.modelValue):{menuBtn:!1,span:24}},set(r){e("update:modelValue",rt(r,{useJson5:!1}))}}),a=J(()=>i.fields?JSON.parse(i.fields):[]),s=J(()=>{const r={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return w=>{const V=_t(w);return[{...r,props:{label:"name",value:"name",desc:"comment"}},{...r,props:{label:"comment",value:"comment",desc:"name"}},...Array.from({length:((V==null?void 0:V.length)??0)-2}).fill({}).concat({label:"样式类",prop:"class"})]}}),c={form:{settings:Array.from({length:((f=vt.settings)==null?void 0:f.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(r,w)=>{const V=_("avue-form");return r.view?(D(),h(V,{key:0,class:et(l.value.class),"model-value":{},option:l.value},null,8,["class","option"])):(D(),h(d(o),{key:1,modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),"base-option":s.value,resources:c},null,8,["modelValue","base-option"]))}}}),Vt={key:1},Ct=M({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(u){const e=u,{formData:i,activeStep:o}=ce(e),{request:l}=L(),{getDetail:a,useList:s}=ae(l),{data:c}=Oe(l).useList(),{data:f}=he(l).useList(),{data:r}=s(),w=J(()=>{var y,b,m,p;return(o==null?void 0:o.value)===1?[{label:"表单模板",value:"",type:"divider"},...((y=c.value)==null?void 0:y.map(v=>({label:v.formName,value:v.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((b=r.value)==null?void 0:b.map(v=>({label:v.flowName,value:v.flowModuleId,type:"definition"})))??[]]:(o==null?void 0:o.value)===2?[{label:"流程模板",value:"",type:"divider"},...((m=f.value)==null?void 0:m.map(v=>({label:v.flowName,value:v.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((p=r.value)==null?void 0:p.map(v=>({label:v.flowName,value:v.flowModuleId,type:"definition"})))??[]]:[]});async function V(y){if((o==null?void 0:o.value)===1){if(y.type==="template")i.value.formOption=y.value;else if(y.type==="definition"){const b=await a({flowModuleId:y.value});i.value.formOption=b.data.formOption}}else if((o==null?void 0:o.value)===2){if(y.type==="template")i.value.flowData=y.value;else if(y.type==="definition"){const b=await a({flowModuleId:y.value});i.value.flowData=b.data.flowData}}}return(y,b)=>{const m=_("el-link"),p=_("el-divider"),v=_("el-dropdown-item"),F=_("el-scrollbar"),O=_("el-dropdown-menu"),k=_("el-dropdown");return w.value.length?(D(),h(k,{key:0},{dropdown:t(()=>[n(O,null,{default:t(()=>[n(F,{"max-height":"600px"},{default:t(()=>[(D(!0),A(G,null,te(w.value,I=>(D(),h(v,ge({key:I.label},I,{disabled:I.type==="divider",onClick:E=>V(I)}),{default:t(()=>[I.type==="divider"?(D(),h(p,{key:0},{default:t(()=>[C(K(I.label),1)]),_:2},1024)):(D(),A("span",Vt,K(I.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:t(()=>[n(m,{icon:"el-icon-arrow-down",underline:!1},{default:t(()=>[C(" 选择模板 ")]),_:1})]),_:1})):P("",!0)}}}),ht=H("span",null,"流程设计",-1),Ot={key:0},$t={key:1},It={style:{height:"calc(100vh - 144px)"}},xt=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(u,{emit:e}){const o=ce(u),{visible:l,modelValue:a}=o,{request:s}=L(),{create:c,deploy:f,getDetail:r,update:w}=ae(s),{getDetail:V,update:y}=pe(s),b=["流程信息","表单设计","模型设计","完成"],m=T(),p=T(),v=T(!1);be(()=>[l.value,m.value],async()=>{var $;if(!l.value||!m.value)return;const{flowModuleId:N}=a.value,{flowDeployId:g}=a.value;try{v.value=!0;let W={};g?W=await V({flowDeployId:g}):N&&(W=await r({flowModuleId:N})),a.value=W.data,($=p.value)!=null&&$.sort&&(p.value.sort.display=!a.value.flowDeployId)}finally{v.value=!1}},{immediate:!0});const{data:F}=ie(s).useList(),O=J(()=>{var N,g;return(g=(N=F.value)==null?void 0:N.find($=>$.tableName===a.value.formDataTable))==null?void 0:g.tableFields}),k=T(0);async function I(N){k.value===0&&await je(m),v.value=!0;const{flowModuleId:g}=a.value,{flowDeployId:$}=a.value;try{$?await y(a.value):g?await w(a.value):await c(a.value).then(W=>{a.value.flowModuleId=W.data.flowModuleId}),B.success("保存成功")}finally{v.value=!1}typeof N=="number"?k.value=N:k.value++}async function E(){await Q.confirm("发布新版本，是否确认？","提示"),v.value=!0,f({flowModuleId:a.value.flowModuleId}).then(()=>{B.success("发布成功")}).finally(()=>{v.value=!1})}function x(){l.value=!1,k.value=0,a.value={},e("close")}async function S(){await Q.confirm("流程定义的数据(包括流程信息、表单设计、流程设计)将被修改为当前版本的数据，是否确认？","提示"),await w(a.value),B.success("同步成功")}return(N,g)=>{const $=_("el-col"),W=_("el-step"),Te=_("el-steps"),X=_("el-button"),Le=_("el-row"),Ne=_("avue-form"),Pe=_("el-result"),Ue=_("el-dialog"),Me=ke("loading");return D(),h(Ue,{modelValue:d(l),"onUpdate:modelValue":g[7]||(g[7]=U=>Y(l)?l.value=U:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:x},{header:t(()=>[n(Le,{justify:"center"},{default:t(()=>[n($,{span:5},{default:t(()=>{var U,q,se,fe;return[H("div",null,[ht,(U=d(a))!=null&&U.flowName?(D(),A("span",Ot," - "+K((q=d(a))==null?void 0:q.flowName),1)):P("",!0),(se=d(a))!=null&&se.version?(D(),A("span",$t," - V"+K((fe=d(a))==null?void 0:fe.version),1)):P("",!0)]),n(Ct,{"form-data":d(a),"onUpdate:formData":g[0]||(g[0]=Se=>Y(a)?a.value=Se:null),"active-step":k.value},null,8,["form-data","active-step"])]}),_:1}),n($,{span:14},{default:t(()=>[n(Te,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:t(()=>[(D(),A(G,null,te(b,(U,q)=>n(W,{key:q,title:U,style:{cursor:"pointer"},onClick:se=>I(q)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),n($,{span:5,style:{"text-align":"right"}},{default:t(()=>[n(X,{disabled:k.value===0,loading:v.value,type:"primary",onClick:g[1]||(g[1]=U=>k.value--)},{default:t(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),n(X,{disabled:k.value===b.length-1,type:"primary",loading:v.value,onClick:g[2]||(g[2]=U=>I())},{default:t(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),n(X,{onClick:x},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:t(()=>[De((D(),A("div",It,[k.value===0?(D(),h(Ne,{key:0,ref_key:"formRef",ref:m,modelValue:d(a),"onUpdate:modelValue":g[3]||(g[3]=U=>Y(a)?a.value=U:null),defaults:p.value,"onUpdate:defaults":g[4]||(g[4]=U=>p.value=U),option:d(ze),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","defaults","option"])):P("",!0),k.value===1?(D(),h(me,{key:1,modelValue:d(a).formOption,"onUpdate:modelValue":g[5]||(g[5]=U=>d(a).formOption=U),fields:O.value},null,8,["modelValue","fields"])):P("",!0),k.value===2?(D(),h(ue,{key:2,modelValue:d(a).flowData,"onUpdate:modelValue":g[6]||(g[6]=U=>d(a).flowData=U),"flow-form-option":d(a).formOption},null,8,["modelValue","flow-form-option"])):P("",!0),k.value===3?(D(),h(Pe,{key:3,icon:"success",title:"流程设计完成"},{extra:t(()=>[d(a).flowDeployId?(D(),h(X,{key:0,type:"primary",onClick:S},{default:t(()=>[C(" 同步到流程定义 ")]),_:1})):P("",!0),d(a).flowDeployId?P("",!0):(D(),h(X,{key:1,type:"primary",onClick:E},{default:t(()=>[C(" 发布 ")]),_:1})),n(X,{onClick:x},{default:t(()=>[C(" 关闭 ")]),_:1})]),_:1})):P("",!0)])),[[Me,v.value]])]),_:1},8,["modelValue"])}}}),Tt=H("span",null,"流程查看",-1),Lt={key:0},Nt={key:1},Pt=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(u){const i=ce(u),{visible:o,modelValue:l}=i,{request:a}=L(),{getDetail:s}=ae(a),{getDetail:c}=pe(a),f=T("form"),r=T(!1);be(o,async V=>{if(!V)return;const{flowModuleId:y}=l.value,{flowDeployId:b}=l.value;try{r.value=!0;let m={};b?m=await c({flowDeployId:b}):y&&(m=await s({flowModuleId:y})),l.value={...m.data}}finally{r.value=!1}},{immediate:!0});function w(){l.value={},f.value="form"}return(V,y)=>{const b=_("el-tab-pane"),m=_("el-tabs"),p=_("el-dialog"),v=ke("loading");return D(),h(p,{modelValue:d(o),"onUpdate:modelValue":y[3]||(y[3]=F=>Y(o)?o.value=F:null),width:"60%",top:"0",onClose:w},{header:t(()=>{var F,O,k,I;return[Tt,(F=d(l))!=null&&F.flowName?(D(),A("span",Lt," - "+K((O=d(l))==null?void 0:O.flowName),1)):P("",!0),(k=d(l))!=null&&k.version?(D(),A("span",Nt," - V"+K((I=d(l))==null?void 0:I.version),1)):P("",!0)]}),default:t(()=>[De((D(),h(m,{modelValue:f.value,"onUpdate:modelValue":y[2]||(y[2]=F=>f.value=F)},{default:t(()=>[n(b,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:t(()=>[f.value==="form"&&d(l).formOption?(D(),h(me,{key:0,modelValue:d(l).formOption,"onUpdate:modelValue":y[0]||(y[0]=F=>d(l).formOption=F),view:""},null,8,["modelValue"])):P("",!0)]),_:1}),n(b,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:t(()=>[f.value==="flow"?(D(),h(ue,{key:0,modelValue:d(l).flowData,"onUpdate:modelValue":y[1]||(y[1]=F=>d(l).flowData=F),view:""},null,8,["modelValue"])):P("",!0)]),_:1})]),_:1},8,["modelValue"])),[[v,r.value]])]),_:1},8,["modelValue"])}}}),Ut=M({__name:"index",setup(u){const e=T("definition"),i=T({}),o=T(""),l=T("");function a(m){o.value===m.id?o.value="":o.value=m.id}const s=T(!1),c=T(!1);function f(){i.value={},s.value=!0}function r(m){i.value=m,s.value=!0}function w(m){i.value=m,c.value=!0}function V(m){l.value=m.flowModuleId||"",e.value="deploy"}function y(){l.value="",e.value="definition"}async function b(){const m=e.value;await _e(),e.value="",await _e(),e.value=`${m}`}return(m,p)=>{const v=_("el-card"),F=_("el-col"),O=_("el-row");return D(),h(O,{gutter:20},{default:t(()=>[n(F,{span:6},{default:t(()=>[n(v,{header:"流程分类",style:{height:"100%"}},{default:t(()=>[n(Ft,{onNodeClick:a})]),_:1})]),_:1}),n(F,{span:18},{default:t(()=>[e.value==="definition"?(D(),h(Ie,{key:0,"category-id":o.value,onAdd:f,onEdit:r,onView:w,onVersion:V},null,8,["category-id"])):P("",!0),e.value==="deploy"&&l.value?(D(),h(xe,{key:1,"flow-module-id":l.value,onEdit:r,onView:w,onBack:y},null,8,["flow-module-id"])):P("",!0),n(xt,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=k=>i.value=k),visible:s.value,"onUpdate:visible":p[1]||(p[1]=k=>s.value=k),onClose:b},null,8,["modelValue","visible"]),n(Pt,{modelValue:i.value,"onUpdate:modelValue":p[2]||(p[2]=k=>i.value=k),visible:c.value,"onUpdate:visible":p[3]||(p[3]=k=>c.value=k)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Mt=M({__name:"index",setup(u){const e=pt("debugMode",!1),{request:i}=L(),{getTaskOpsList:o}=gt(i),{bindVal:l,getDataList:a,crudStateRefs:{searchForm:s}}=R({tableOption:We,crudOption:{getList:o},searchForm:{status:ee.待办},sortOption:{descs:"start_time"}});le(s,a,{debounce:300,immediate:!0,deep:!0});const{open:c,close:f}=ne();function r(w){c({flowKey:w.flowKey,taskId:w.taskId,instanceId:w.flowInstanceId,debug:e.value,onComplete(){f(),B.success("操作成功"),a()}})}return(w,V)=>{const y=_("el-switch"),b=_("el-button"),m=_("el-link"),p=_("avue-crud");return D(),h(p,z(j(d(l))),{"menu-right":t(()=>[n(b,{type:"text"},{default:t(()=>[n(y,{modelValue:d(e),"onUpdate:modelValue":V[0]||(V[0]=v=>Y(e)?e.value=v:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:t(({row:v})=>[n(m,{type:"primary",underline:!1,onClick:F=>r(v)},{default:t(()=>[C(K(v.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),St=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,getDataList:o}=R({tableOption:Je,crudOption:ye(e)});return o(),(l,a)=>{const s=_("avue-crud");return D(),h(s,z(j(d(i))),null,16)}}}),At={class:"flow-list"},Bt=["onClick"],Et={class:"flow-name"},Kt=M({__name:"index",setup(u){const{request:e}=L(),{useList:i}=Ve(e),{usePublishList:o,getTaskList:l}=He(e),{data:a}=i(),{data:s}=o(),c=J(()=>{var p;return(p=a.value)==null?void 0:p.map(v=>{var O;const F=((O=s.value)==null?void 0:O.filter(k=>k.categoryId===v.id))??[];return{...v,list:F}}).filter(v=>{var F;return(F=v.list)==null?void 0:F.length})}),f=wt(ee).filter((p,v)=>v<2).reverse(),{bindVal:r,getDataList:w,crudStateRefs:{searchForm:V}}=R({tableOption:Ge,crudOption:{getList:l},searchForm:{status:ee.待办}});le(V,w,{debounce:300,immediate:!0,deep:!0});const{open:y,close:b}=ne();function m(p){y({flowKey:p.flowKey,taskId:p.taskId,instanceId:p.flowInstanceId,detail:p.taskId?p.status===ee.已办:!1,onComplete(){b(),B.success("操作成功"),w()}})}return(p,v)=>{const F=_("el-button"),O=_("el-divider"),k=_("el-collapse-item"),I=_("el-collapse"),E=_("el-card"),x=_("avue-radio"),S=_("el-link"),N=_("avue-crud");return D(),A(G,null,[n(E,{"body-style":{padding:"0 20px"}},{default:t(()=>[n(I,{"model-value":"1"},{default:t(()=>[n(k,{name:"1"},{title:t(()=>[n(F,{text:"",icon:"el-icon-promotion"},{default:t(()=>[C(" 发起审批 ")]),_:1})]),default:t(()=>[H("div",At,[(D(!0),A(G,null,te(c.value,g=>(D(),A("div",{key:g.id,class:"flow-category"},[n(O,{"content-position":"left"},{default:t(()=>[C(K(g.name),1)]),_:2},1024),(D(!0),A(G,null,te(g.list,$=>(D(),A("div",{key:$.flowKey,class:"flow-item",onClick:W=>m($)},[n(d(Z),{class:"flow-icon",icon:$.flowIcon,width:"60"},null,8,["icon"]),H("div",Et,K($.flowName),1)],8,Bt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),n(O),n(N,z(j(d(r))),{"menu-left":t(()=>[n(x,{modelValue:d(V).status,"onUpdate:modelValue":v[0]||(v[0]=g=>d(V).status=g),button:"",dic:d(f)},null,8,["modelValue","dic"])]),processTitle:t(({row:g})=>[n(S,{type:"primary",underline:!1,onClick:$=>m(g)},{default:t(()=>[C(K(g.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Rt=tt(Kt,[["__scopeId","data-v-5341e962"]]),zt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:o},getDataList:l,handleUpdate:a}=R({tableOption:Qe,crudOption:he(e)});l();const s=T(!1);async function c(r){o.value=r,s.value=!0}async function f(){await a(o.value,Number.NaN,()=>s.value=!1,()=>{})}return(r,w)=>{const V=_("el-button"),y=_("avue-crud"),b=_("el-dialog");return D(),A(G,null,[n(y,z(j(d(i))),{menu:t(({row:m})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:p=>c(m)},{default:t(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(b,{modelValue:s.value,"onUpdate:modelValue":w[2]||(w[2]=m=>s.value=m),title:`模型设计-${d(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:t(()=>[n(V,{type:"primary",onClick:f},{default:t(()=>[C(" 保存 ")]),_:1}),n(V,{onClick:w[1]||(w[1]=m=>s.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1})]),default:t(()=>[n(ue,{modelValue:d(o).flowData,"onUpdate:modelValue":w[0]||(w[0]=m=>d(o).flowData=m),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),jt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:o},getDataList:l,handleUpdate:a}=R({tableOption:Xe,crudOption:Oe(e)});l();const s=T(!1);async function c(r){o.value={...r},s.value=!0}async function f(){await a(o.value,Number.NaN,()=>s.value=!1,()=>{})}return(r,w)=>{const V=_("el-button"),y=_("avue-crud"),b=_("el-dialog");return D(),A(G,null,[n(y,z(j(d(i))),{menu:t(({row:m})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:p=>c(m)},{default:t(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(b,{modelValue:s.value,"onUpdate:modelValue":w[2]||(w[2]=m=>s.value=m),title:`表单设计-${d(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:t(()=>[n(V,{type:"primary",onClick:f},{default:t(()=>[C(" 保存 ")]),_:1}),n(V,{onClick:w[1]||(w[1]=m=>s.value=!1)},{default:t(()=>[C(" 取消 ")]),_:1})]),default:t(()=>[n(me,{modelValue:d(o).formOption,"onUpdate:modelValue":w[0]||(w[0]=m=>d(o).formOption=m),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Wt=H("br",null,null,-1),Jt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:o,defaults:l},getDataList:a,afterOpen:s,beforeSubmit:c}=R({crudOption:ie(e),tableOption:Ye});a();const{data:f}=ye(e).useParam("table.default.fields");s(p=>{if(o.value.defaultFields=f.value??[],p==="edit"){const v=JSON.parse(o.value.tableFields);o.value.editFields=yt(v,f.value??[],"name")}}),c(p=>{const v=[...p.defaultFields,...p.editFields];p.tableFields=JSON.stringify(v)});const r=T(!1);re(()=>{var p;(p=l.value)!=null&&p.defaultFields&&(l.value.defaultFields.display=r.value)});const{deploy:w,getFields:V}=ie(e),y=T(!1);async function b(p){await Q.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),y.value=!0,w({id:p.id}).then(()=>{B.success("部署成功"),a()}).finally(()=>{y.value=!1})}function m(){V({tableName:o.value.tableName}).then(p=>{var v;if(!((v=p.data)!=null&&v.length))return B.warning("未找到该表");o.value.editFields=p.data})}return(p,v)=>{const F=_("el-button"),O=_("el-input"),k=_("el-switch"),I=_("el-tooltip"),E=_("avue-crud");return D(),h(E,z(j(d(i))),{menu:t(({row:x})=>[n(F,{type:"text",icon:"el-icon-upload",onClick:S=>b(x)},{default:t(()=>[C(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":t(()=>[n(O,{modelValue:d(o).tableName,"onUpdate:modelValue":v[0]||(v[0]=x=>d(o).tableName=x),placeholder:"请输入 表名"},{append:t(()=>[n(F,{type:"primary",size:"default",onClick:m},{default:t(()=>[C(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":t(()=>[H("div",null,[C(" 数据库字段 "),Wt,n(I,{content:"显示默认字段"},{default:t(()=>[n(k,{modelValue:r.value,"onUpdate:modelValue":v[1]||(v[1]=x=>r.value=x)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Gt=M({__name:"index",setup(u){const e=mt(),i=T({}),{FlowForm:o}=L(),l=J(()=>{const s=i.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${s==null?void 0:s.title}`:e.instanceId||e.taskId?`办理流程：${s==null?void 0:s.title}`:`发起流程：${s==null?void 0:s.title}`});ft(l);async function a(s){window.postMessage({event:"onComplete",data:{...s}})}return(s,c)=>(D(),h(d(o),ge({flowDetail:i.value,"onUpdate:flowDetail":c[0]||(c[0]=f=>i.value=f)},d(e),{onComplete:a}),null,16,["flowDetail"]))}}),Ht=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:Dt,PageFlowDefinition:Ie,PageFlowDeploy:xe,PageFlowForm:Gt,PageFlowManage:Ut,PageFlowOps:Mt,PageFlowParam:St,PageFlowTemplate:zt,PageFlowWorkbench:Rt,PageFormTemplate:jt,PageTableTemplate:Jt},Symbol.toStringTag,{value:"Module"})),zo={install(u,e){L(e),Object.entries(Ht).forEach(([i,o])=>{u.component(i,o)})}};export{Jo as ApprovalForm,Go as ButtonList,Ae as CONFIG_DEFAULT,Ho as FieldType,Qo as FlowButtonApproval,Xo as FlowButtonDisplay,Yo as FlowButtonKey,Zo as FlowButtonStatus,qo as FlowButtonType,el as FlowForm,tl as FlowStatus,ol as HandleType,ll as InternalForm,Ce as IsMainVersion,Dt as PageFlowButton,Ie as PageFlowDefinition,xe as PageFlowDeploy,Gt as PageFlowForm,Ut as PageFlowManage,Mt as PageFlowOps,St as PageFlowParam,zt as PageFlowTemplate,Rt as PageFlowWorkbench,jt as PageFormTemplate,Jt as PageTableTemplate,al as TablePrimary,ee as TaskStatus,nl as UploadTable,sl as Whether,je as asyncValidate,zo as default,il as defineTableOption,ul as fieldTypeDic,rl as flowFormEmits,dl as flowFormProps,cl as flowTrack,pl as injectionKey,ml as isMobile,fl as mergeColumn,vl as tablePrimaryDic,_l as useButtonHandler,wl as useCommonCommentApi,L as useConfigProvider,yl as useEmitter,Ee as useFlowButtonApi,Ve as useFlowCategoryApi,ae as useFlowDefinitionApi,pe as useFlowDeployApi,gl as useFlowFileApi,ne as useFlowForm,kt as useFlowFormOverlay,bt as useFlowFormWindow,gt as useFlowOpsApi,ye as useFlowParamApi,He as useFlowTaskApi,he as useFlowTemplateApi,bl as useFlowUserApi,kl as useFormDefaults,Oe as useFormTemplateApi,Dl as useInjectState,Fl as useProvideState,ie as useTableTemplateApi,Vl as whetherDic};
