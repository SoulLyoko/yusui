import{dB as ce,bQ as le,dC as tt,dD as Tt,dE as oe,bc as ye,dF as Nt,d4 as Ot,d6 as It,cw as $t,a5 as Lt,bR as ke,by as St}from"../composables_use-crud_index.md.b68a9fc1.js";import{U as Ae,A as Ve,r as $,s as Ie,b as R,d as ie,w as ve,a6 as te,u as D,n as de,V as Ut,h as B,ar as Pe,G as V,e as nt,i as x,C as U,D as f,I as _,m as P,p as z,a0 as ot,aK as Me,a2 as Ke,B as X,E as W,j as K,N as pe,F as Y,J as Pt,_ as Be,av as ne,aw as se,k as Et,au as Rt,b2 as Ft,aN as At,l as Mt}from"./framework.b266b145.js";import{a5 as st,a7 as Kt,a8 as Ee,A as Bt,_ as jt,a4 as zt}from"./index.vue_vue_type_script_setup_true_lang.ce8bf743.js";import{L as qt,M as Wt,s as Qt,N as Ht,O as Gt}from"../app.4528da56.js";import{a as Jt,_ as Yt}from"./index.vue_vue_type_script_setup_true_lang.bb580509.js";import{d as Xt}from"./data.4cb21f02.js";import{a as Zt}from"../flow-design_flow-modeler_index.md.a7cf72ad.js";import{u as De,a as eo,c as to}from"./theme.5db20171.js";import"./vue.runtime.esm-bundler.0ad4d8a3.js";import"../components_icon-select_index.md.4fb331fc.js";import"../components_index.md.46cf363d.js";import"../components_v-text_index.md.e98d43c0.js";import"../composables_index.md.3044f1ae.js";import"../flow-design_flow-viewer_index.md.79ca8d22.js";import"../flow-design_index.md.743c5e3a.js";import"../flow-pages_index.md.e99b69fa.js";import"../flow-pages_pages_flow-button_index.md.bed80d55.js";import"../flow-pages_pages_flow-manage_index.md.46189761.js";import"../flow-pages_pages_flow-ops_index.md.a424c38b.js";import"../flow-pages_pages_flow-param_index.md.ef0e553b.js";import"../flow-pages_pages_flow-template_index.md.f798a59b.js";import"../flow-pages_pages_flow-workbench_index.md.5e52b719.js";import"../flow-pages_pages_form-template_index.md.3f80c849.js";import"../flow-pages_pages_table-template_index.md.b8ad4f81.js";import"../form-design_demo.md.9d5a6cab.js";import"../form-design_index.md.24447ebb.js";import"../guide_changelog.md.0ad24ee9.js";import"../guide_start.md.761dfe93.js";import"../index.md.2d064c25.js";import"../plugins_avue-patch_index.md.48e20c21.js";import"../plugins_env-dts_index.md.71927072.js";import"../plugins_index.md.8ac5c6d9.js";import"../plugins_load-proxy_index.md.6a28ebff.js";import"../plugins_setup-extend_index.md.d0060799.js";import"../plugins_uni-ui-patch_index.md.561160ff.js";import"../plugins_uview-patch_index.md.28102419.js";import"../types_avue_index.md.32c3526a.js";import"../utils_date_dateFormat.md.5067e69c.js";import"../utils_date_durationFormat.md.191b7e46.js";import"../utils_emitter_mittAsync.md.afaed53a.js";import"../utils_index.md.1cfabe15.js";import"../utils_math_index.md.679a3ea2.js";import"../utils_object_filterObj.md.37dc9792.js";import"../utils_object_filterObjDeep.md.a2aec3aa.js";import"../utils_object_getDataType.md.868c07a7.js";import"../utils_string_deserialize.md.fba5ee35.js";import"../utils_string_serialize.md.8c3bea90.js";import"../utils_string_uuid.md.6cca6855.js";import"../utils_tool_awaitTo.md.baefc1dc.js";import"../utils_tool_enumToDic.md.ba2933f9.js";import"../utils_tool_sleep.md.bd52f355.js";import"../utils_tree_buildTree.md.899c69cb.js";import"../utils_tree_filterTree.md.3b301401.js";import"../utils_tree_findTree.md.ce9b0fcb.js";import"../utils_tree_flatTree.md.335a4148.js";import"../utils_tree_treeMap.md.1dcbcbce.js";import"./uniqueId.8e3f83bc.js";const rt=Symbol("flowPagesConfig"),oo={request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var it=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(it||{});const Re=ce(it),lo={},ao=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),no=()=>lo,so=e=>Array.isArray(e),je=e=>e!==null&&typeof e=="object",ut=e=>e instanceof Function,we=e=>e==null,ze=typeof window>"u",ct=()=>{var e;return ze||we((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ro=()=>{var e,t;return(e=!ze&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},$e=()=>new Promise(()=>{}),ae=e=>te(e)?e.value:e,io=e=>je(e)?Object.assign(so(e)?[]:{},e):e,be=new Map,uo=e=>we(e)?void 0:be.get(e),co=(e,t,o)=>{const r=be.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const s=setTimeout(()=>be.delete(e),t);be.set(e,{...o,timer:s})},ue=e=>e;function dt(e,t,o){let r,s,a,u,l,n,i=0,c=!1,m=!1,v=!0;const d=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,je(o)&&(c=!!o.leading,m="maxWait"in o,a=m?Math.max(+o.maxWait||0,t):a,v="trailing"in o?!!o.trailing:v);function y(O){const N=r,C=s;return r=s=void 0,i=O,u=e.apply(C,N),u}function b(O,N){return d?(window.cancelAnimationFrame(l),window.requestAnimationFrame(O)):setTimeout(O,N)}function w(O){if(d)return window.cancelAnimationFrame(O);clearTimeout(O)}function T(O){return i=O,l=b(g,t),c?y(O):u}function p(O){const N=O-n,C=O-i,A=t-N;return m?Math.min(A,a-C):A}function k(O){const N=O-n,C=O-i;return n===void 0||N>=t||N<0||m&&C>=a}function g(){const O=Date.now();if(k(O))return h(O);l=b(g,p(O))}function h(O){return l=void 0,v&&r?y(O):(r=s=void 0,u)}function L(){l!==void 0&&w(l),i=0,r=n=s=l=void 0}function I(){return l===void 0?u:h(Date.now())}function S(){return l!==void 0}function E(...O){const N=Date.now(),C=k(N);if(r=O,s=this,n=N,C){if(l===void 0)return T(n);if(m)return l=b(g,t),y(n)}return l===void 0&&(l=b(g,t)),u}return E.cancel=L,E.flush=I,E.pending=S,E}function po(e,t,o){let r=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return je(o)&&(r="leading"in o?!!o.leading:r,s="trailing"in o?!!o.trailing:s),dt(e,t,{leading:r,trailing:s,maxWait:t})}var fo=ue((e,{debounceInterval:t,debounceOptions:o,manual:r})=>{const s=$(!1),a=$(),u=R(()=>o),l=R(()=>ae(t)),n=$(e.context.runAsync);return r||(s.value=!0),ie(i=>{we(l.value)||(a.value=dt(c=>c(),l.value,u.value),e.context.runAsync=(...c)=>new Promise((m,v)=>{s.value?(s.value=!1,n.value(...c).then(m).catch(v)):a.value(()=>{n.value(...c).then(m).catch(v)})}),i(()=>{var c;(c=a.value)===null||c===void 0||c.cancel(),e.context.runAsync=n.value}))}),{onCancel(){var i;(i=a.value)===null||i===void 0||i.cancel()}}}),mo=ue((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const r=$(),s=$(0),a=R(()=>ae(t)),u=R(()=>ae(o));let l=!1;const n=()=>{s.value=0},i=R(()=>{if(u.value)return u.value;const v=1e3,d=1,y=9,b=Math.floor(Math.random()*2**Math.min(s.value,y)+d);return v*b}),c=()=>{let v;const d=a.value===-1,y=s.value<a.value;return(d||y)&&(d||(s.value+=1),v=setTimeout(()=>{l=!0,e.context.refresh()},i.value)),()=>v&&clearTimeout(v)},m=()=>{r.value&&r.value()};return{onBefore(){l||n(),l=!1,m()},onSuccess(){n()},onError(){r.value=c()},onCancel(){n(),m()}}}),vo=ue((e,{ready:t=$(!0),manual:o,defaultParams:r=[]})=>(ve(t,s=>{!o&&s&&e.context.run(...r)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),_o=ue((e,{refreshDeps:t=[],refreshDepsAction:o,manual:r})=>(t!=null&&t.length&&ve(t,()=>{o?o():!r&&e.context.refresh()}),{})),wo=ue((e,{throttleInterval:t,throttleOptions:o})=>{const r=$(),s=R(()=>ae(t)),a=R(()=>o),u=$(e.context.runAsync);return ie(l=>{if(we(t))return{};r.value=po(n=>n(),s.value,a.value),e.context.runAsync=(...n)=>new Promise((i,c)=>{r.value(()=>{u.value(...n).then(i).catch(c)})}),l(()=>{var n;(n=r.value)===null||n===void 0||n.cancel(),e.context.runAsync=u.value})}),{onCancel(){var l;(l=r.value)===null||l===void 0||l.cancel()}}});const yo=(e,t)=>o=>{Object.keys(o).forEach(r=>{e[r].value=o[r]}),t.forEach(r=>r(e))},bo=(e,t)=>()=>{let o=t;for(let r=e.length;r-- >0;)o=e[r](o);return o()},go=(e,t,o)=>{var r,s;const{initialData:a,onSuccess:u,onError:l,onBefore:n,onAfter:i}=t,c=$((r=o==null?void 0:o.loading)!==null&&r!==void 0?r:!1),m=Ie((s=o==null?void 0:o.data)!==null&&s!==void 0?s:a),v=Ie(o==null?void 0:o.error),d=$(o==null?void 0:o.params),y=$([]),b=Ie("pending"),w={},T=yo({status:b,loading:c,data:m,error:v,params:d},[]),p=(g,...h)=>{if(g==="onQuery"){const L=y.value.map(I=>I.onQuery).filter(Boolean);return{servicePromise:bo(L,h[0])()}}else{const L=y.value.map(I=>{var S;return(S=I[g])===null||S===void 0?void 0:S.call(I,...h)});return Object.assign({},...L)}},k=$(0);return w.runAsync=async(...g)=>{T({loading:!0,params:g,status:"pending"}),k.value+=1;const h=k.value,{isBreak:L,breakResult:I=$e()}=p("onBefore",g);if(L)return T({status:"settled"}),I;n==null||n(g);try{const S=()=>new Promise(N=>N(e(...d.value)));let{servicePromise:E}=p("onQuery",S);E||(E=S());const O=await E;return h!==k.value?$e():(T({data:O,loading:!1,error:void 0,status:"settled"}),p("onSuccess",O,g),u==null||u(O,g),p("onAfter",g,O,void 0),i==null||i(g),O)}catch(S){if(h!==k.value)return $e();throw T({loading:!1,error:S,status:"settled"}),p("onError",S,g),l==null||l(S,g),p("onAfter",g,void 0,S),i==null||i(g),S}},w.run=(...g)=>{w.runAsync(...g).catch(h=>{l||console.error(h)})},w.cancel=()=>{k.value+=1,T({loading:!1}),p("onCancel")},w.refresh=()=>{w.run(...d.value||[])},w.refreshAsync=()=>w.runAsync(...d.value||[]),w.mutate=g=>{const h=ut(g)?g(m.value):g,L=io(h);T({data:L}),p("onMutate",L)},{status:b,loading:c,data:m,error:v,params:d,plugins:y,context:w}};function ho(e,t={},o){const r=Ae(ao,{}),s={...no(),...r,...t},{manual:a=!1,defaultParams:u=[]}=s,l=go(e,s);if(l.plugins.value=o.map(n=>n(l,s)),!a){const n=l.params.value||u;l.context.run(...n)}return Ve(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ge=new Map,ko=(e,t)=>{ge.set(e,t),t.then(o=>(ge.delete(e),o)).catch(()=>{ge.delete(e)})},Vo=e=>ge.get(e),me=new Map,Do=(e,t)=>{me.has(e)&&me.get(e).forEach(o=>o(t))},Co=(e,t)=>(me.has(e)?me.get(e).push(t):me.set(e,[t]),()=>{const o=me.get(e).indexOf(t);me.get(e).splice(o,1)});var xo=ue((e,{cacheKey:t,cacheTime:o=6e5,staleTime:r=0,getCache:s,setCache:a})=>{if(!t)return{};const u=ut(t)?t:()=>t,l=$(()=>{});let n;const i=w=>s?s(w):uo(w),c=(w,T,p)=>{a?a(w,p):co(w,T,p),Do(w,p.data)},m=w=>r===-1||w+r>new Date().getTime(),v=(w,T)=>Object.prototype.hasOwnProperty.call(w,T),d=w=>{const T=u(w);return Co(T,p=>{e.data.value=p})},y=u(),b=i(y);return b&&v(b,"data")&&(e.data.value=b.data,e.params.value=b.params),y&&(l.value=d()),Ve(()=>{l.value()}),{onBefore(w){const T=u(w),p=i(T);if(!p||!v(p,"data"))return{};if(m(p.time))return e.data.value=p.data,e.loading.value=!1,{isBreak:!0,breakResult:p.data};e.data.value=p.data},onQuery(w){const T=e.params.value,p=u(T);let k=Vo(p);return k&&k!==n?()=>k:(k=w(),n=k,ko(p,k),()=>k)},onSuccess(w,T){const p=u(T);p&&(l.value(),c(p,o,{data:w,params:T,time:new Date().getTime()}),l.value=d(T))},onMutate(w){const T=u(e.params.value);T&&(l.value(),c(T,o,{data:w,params:e.params.value,time:new Date().getTime()}),l.value=d(e.params.value))}}});function To(e){let t,o;class r extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new r(s=>{o=s,t=setTimeout(o,e)})}function Le(){return new Date().getTime()}var No=ue((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const r=$(()=>{}),s=R(()=>ae(t)),a=R(()=>ae(o));let u=0,l={};const n=()=>{let i;return s.value&&(i=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},s.value)),()=>i&&clearTimeout(i)};return{onBefore(){e.loading.value=!s.value,r.value(),r.value=n(),u=Le()},onQuery(i){if(!a.value)return()=>i();l=To(a.value+s.value);const c=async()=>{try{const v=await i();return Le()-u<=s.value&&l.cancel(),Promise.resolve(v)}catch(v){return Le()-u<=s.value&&l.cancel(),Promise.reject(v)}},m=Promise.allSettled([c(),l]).then(v=>{const d=v[0];return d.status==="fulfilled"?d.value:Promise.reject(d.reason)});return()=>m},onCancel(){r.value()},onAfter(){r.value()}}}),Se;const pt=new Set,ft=new Set,mt=new Set,he=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=pt;break;case"RECONNECT_LISTENER":o=mt;break;case"VISIBLE_LISTENER":o=ft;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Ue=e=>{e.forEach(t=>{t()})};!ze&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{ct()&&Ue(ft)},!1),window.addEventListener("focus",()=>Ue(pt),!1),window.addEventListener("online",()=>Ue(mt),!1));var Oo=ue((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:r=!1,errorRetryCount:s=0})=>{const a=$(),u=$(!1),l=R(()=>ae(t)),n=R(()=>ae(s)),i=[],c=y=>{y&&i.push(y)},m=()=>(o||ct())&&(r||ro()),v=y=>{if(e.error.value&&n.value!==0)return;let b;if(!we(l.value)&&l.value>=0)if(m())b=setTimeout(y,l.value);else{u.value=!0;return}return()=>b&&clearTimeout(b)},d=()=>{u.value&&m()&&(e.context.refresh(),u.value=!1)};return ve(l,()=>{a.value&&(a.value(),a.value=v(()=>e.context.refresh()))}),o||c(he("VISIBLE_LISTENER",d)),r||c(he("RECONNECT_LISTENER",d)),Ve(()=>{i.forEach(y=>y())}),{onBefore(){var y;(y=a.value)===null||y===void 0||y.call(a)},onCancel(){var y;(y=a.value)===null||y===void 0||y.call(a)},onAfter(){a.value=v(()=>e.context.refresh())}}});const Io=(e,t)=>{let o=!1;return(...r)=>{o||(o=!0,e(...r),setTimeout(()=>{o=!1},t))}};var $o=ue((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const r=R(()=>ae(t)),s=R(()=>ae(o)),a=[],u=n=>{n&&a.push(n)},l=()=>{a.forEach(n=>n())};return ie(()=>{if(l(),r.value){const n=Io(e.context.refresh,s.value);u(he("VISIBLE_LISTENER",n)),u(he("FOCUS_LISTENER",n))}}),Ve(()=>{l()}),{}});function _e(e,t){return ho(e,t,[No,mo,fo,Oo,wo,$o,_o,vo,xo])}function Ce(){const{request:e}=G(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:d=>e.get(t.detail,{params:d}),getApprovalNode:d=>e.post(t.approvalNode,d),startTask:d=>e.post(t.start,d),commitTask:d=>e.post(t.commit,d),saveDraft:d=>e.post(t.draft,d),revokeTask:d=>e.post(t.revoke,d),terminateTask:d=>e.post(t.terminate,d),withdrawTask:d=>e.post(t.withdraw,d),transferTask:d=>e.post(t.transfer,d),getPublishFlow:()=>e.get(t.publish),getTodoList:d=>e.get(t.todo,{params:d})}}function Lo(e){const{commitTask:t,revokeTask:o,saveDraft:r,startTask:s,terminateTask:a,transferTask:u,withdrawTask:l}=Ce(),n=R(()=>{const{flowDetail:c,formVariables:m,approvalFormData:v,debug:d}=e,{flowDeployId:y}=c.value.process??{},{taskId:b,flowInstanceId:w}=c.value.task??{};return{flowDeployId:y,taskId:b,flowInstanceId:w,variables:m.value,debug:d.value,...v.value}}),i=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(i())return r(n.value)},flow_pass(){return i()?t(n.value):s(n.value)},flow_revoke(){if(i())return o(n.value)},flow_withdraw(){if(i())return l(n.value)},flow_terminate(){if(i())return a(n.value)},flow_transfer(){if(i())return u(n.value)}}}function So(e){const t=$({});return ie(async()=>{var r;const{formProperty:o}=((r=D(e))==null?void 0:r.properties)||{};o!=null&&o.length&&(await de(),Object.keys(t.value).forEach(s=>{var l,n,i,c;const a=((l=t.value[s])==null?void 0:l.label)||"",u=o==null?void 0:o.find(m=>m.prop===s);if(t.value[s].display=u==null?void 0:u.display,t.value[s].disabled=u==null?void 0:u.disabled,t.value[s].detail=u==null?void 0:u.detail,t.value[s].readonly=u==null?void 0:u.readonly,t.value[s].rules=t.value[s].rules??[],u!=null&&u.required&&((n=t.value[s].rules)!=null&&n.some(m=>m.required)))return null;u!=null&&u.required?(i=t.value[s].rules)==null||i.push({required:!0,message:`${a}为必填项`}):t.value[s].rules=(c=t.value[s].rules)==null?void 0:c.filter(m=>!m.required)}))}),t}function Uo(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Po(){return{complete:e=>e}}const vt=Symbol("flowFormState");function Eo(e,t){const o=De(e,void 0,{passive:!0,deep:!0}),{flowDetail:r,modelValue:s,formLoading:a}=o,{getFlowDetail:u}=Ce();ie(()=>{const{flowKey:d,taskId:y,instanceId:b}=e;!d&&!y&&!b||(a.value=!0,u({flowKey:d,taskId:y,flowInstanceId:b}).then(w=>{r.value=w.data,s.value=w.data.formData||{}}).finally(()=>{a.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),n=R(()=>{var d,y,b,w;return l.value.fileTab===!0&&((w=(b=(y=(d=r.value)==null?void 0:d.properties)==null?void 0:y.formProperty)==null?void 0:b.find(T=>T.prop==="fileTab"))==null?void 0:w.display)}),i=R(()=>{var d,y,b,w;return l.value.trackTab===!0&&((w=(b=(y=(d=r.value)==null?void 0:d.properties)==null?void 0:y.formProperty)==null?void 0:b.find(T=>T.prop==="trackTab"))==null?void 0:w.display)}),c=$(!1),m=R(()=>Object.entries(s.value||{}).filter(([d])=>!d.startsWith("$")).map(([d,y])=>({key:d,value:y}))),v={...o,formData:s,formVariables:m,approvalVisible:c,showFileTab:n,showTrackTab:i,permission:l,emit:t};return Ut(vt,v),v}function _t(){return Ae(vt)}function qe(e){return new Promise((t,o)=>{D(e).validate((s,a,u)=>{s?(a(),t(u)):o(u)})})}const Ro=B({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=De(e,void 0,{passive:!0,deep:!0}),o=So(e.flowDetail),{proxy:r}=nt(),s=$({});ie(()=>{const{formOption:l}=e.flowDetail.process??{};s.value=st.bind(r)(l||'{"menuBtn":false}'),s.value.detail=!!e.detail});const a=$();function u(){return qe(a)}return{form:t,option:s,defaults:o,formRef:a,validate:u}},render(){return Pe(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Fo=B({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=eo(e,"modelValue"),{batchUpdate:r,create:s,remove:a,useList:u}=ol(),l=$(!1),{activeBtn:n}=_t(),i=R(()=>{var k;return(k=n.value)==null?void 0:k.buttonKey}),{data:c,refresh:m}=u(i),v=R(()=>{var g,h,L;const k=o.value;if(k&&!((g=c.value)!=null&&g.some(I=>I.content===k))){const I=(((L=(h=c.value)==null?void 0:h[0])==null?void 0:L.sort)||1)-1;return[{content:k,sort:I},...c.value||[]]}return c.value});async function d(k){var g;await s({...k,type:(g=n.value)==null?void 0:g.buttonKey}),le.success("添加成功"),m()}async function y(k){await a(k.id),le.success("删除成功"),m()}async function b(k,g){let h=g.parent.data;h=h.map((L,I)=>({id:L.id,sort:I+1})),await r(h),le.success("修改排序成功"),m(),l.value=!1}function w(){l.value=!0}const T=$();async function p(k){var g;o.value=k.content,await de(),(g=T.value)==null||g.blur()}return(k,g)=>{const h=V("el-input"),L=V("el-text"),I=V("el-col"),S=V("el-button"),E=V("el-row"),O=V("el-tree"),N=V("el-popover");return x(),U(N,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:f(()=>[_(h,{ref_key:"inputRef",ref:T,modelValue:D(o),"onUpdate:modelValue":g[0]||(g[0]=C=>te(o)?o.value=C:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:g[1]||(g[1]=C=>l.value=!0),onBlur:g[2]||(g[2]=C=>l.value=!1)},null,8,["modelValue"])]),default:f(()=>[_(O,{data:v.value,"node-key":"content",draggable:"","allow-drop":(C,A,M)=>M!=="inner",props:{label:"content"},onNodeClick:p,onNodeDrop:b,onNodeDragStart:w},{default:f(({data:C})=>[_(E,{style:{width:"250px"}},{default:f(()=>[_(I,{span:20},{default:f(()=>[_(L,{truncated:"",title:C.content},{default:f(()=>[P(z(C.content),1)]),_:2},1032,["title"])]),_:2},1024),_(I,{span:4},{default:f(()=>[C.id?(x(),U(S,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:ot(A=>y(C),["stop"])},null,8,["onClick"])):(x(),U(S,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:ot(A=>d(C),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Ao=B({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Ce(),r={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:s,approvalFormData:a,activeBtn:u,approvalVisible:l,formVariables:n,flowDetail:i}=_t(),c=$([]),m=$([]),v=$([]),d=$([]),y=$(),b=$({}),w={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:T}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function T(N,C,A){var Q;const M=c.value[0].type==="ParallelGateway",j=(Q=c.value[0].children)==null?void 0:Q.every(Z=>Kt([Z],J=>m.value.some(ee=>ee.id===J.id)));if(m.value.length){if(M&&!j)return A("请在每个节点选择审批人")}else return A("请选择审批人");return!0}const p=$(),k=R(()=>{var N,C;return(C=(N=u.value)==null?void 0:N.approval)==null?void 0:C.includes("assignee")}),g=R(()=>{var N,C;return(C=(N=u.value)==null?void 0:N.approval)==null?void 0:C.includes("circulate")}),h=R(()=>{var N,C;return(C=(N=u.value)==null?void 0:N.approval)==null?void 0:C.includes("copyUser")}),L=$(!1),I=$(!1);ie(async()=>{var M,j,Q,Z,J;if(!l.value||!y.value)return;const{flowKey:N}=((M=i.value)==null?void 0:M.process)||{},{taskId:C}=((j=i.value)==null?void 0:j.task)||{};c.value=[],m.value=[],v.value=[],d.value=[];const A=C?"":"发起";if(a.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:s.value.comment||A},de(()=>{var ee,H;b.value.assignee.display=k.value,b.value.circulate.display=g.value,b.value.copyUser.display=h.value,b.value.comment.display=(H=(ee=u.value)==null?void 0:ee.approval)==null?void 0:H.includes("comment")}),k.value)try{I.value=!0;const ee=u.value.buttonKey!=="flow_transfer",H=await o({flowKey:N,variables:n.value,taskId:C,loadConfig:ee});c.value=Ee(H.data??[],(re,Ze,q)=>{const fe=re.id||tt();return re.taskNodeKey=(q==null?void 0:q.taskNodeKey)??re.taskNodeKey,re.incoming=(q==null?void 0:q.incoming)??re.incoming,{...re,id:fe,disabled:re.type!=="user"}}),await de();const F=S(c.value);F&&((Q=p.value)==null||Q.setCheckedNodes([F]))}finally{I.value=!1}if(h.value){const ee=await o({flowKey:N,variables:n.value,taskId:C,loadConfig:!1});v.value=Ee(((J=(Z=ee.data)==null?void 0:Z[0])==null?void 0:J.children)??[],H=>{var F;return H.id||tt(),{...H,label:H.title,disabled:H.type!=="user"&&!((F=H.children)!=null&&F.length)}})}});function S(N){var C;if(N.length===1)return(C=N[0].children)!=null&&C.length?S(N[0].children):N[0]}async function E(N,C){var M,j;if(N.type!=="user")return;await de(),await de();const A=(M=p.value)==null?void 0:M.getCheckedNodes();m.value=A.filter(Q=>Q.type==="user"),(j=p.value)==null||j.setCheckedNodes(m.value)}async function O(){await qe(y),L.value=!0;const N={},C={},A=new Set;m.value.forEach(M=>{const{taskNodeKey:j,incoming:Q}=M;N[j]||(N[j]=new Set),M.userId&&N[j].add(M.userId),C[j]=[...N[j]].join(","),A.add(Q)}),a.value.assignee=C,a.value.outgoing=[...A],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",s),t("confirm")}return(N,C)=>{const A=V("el-col"),M=V("el-tag"),j=V("el-tree-select"),Q=V("avue-form"),Z=V("el-row"),J=V("el-button"),ee=V("el-dialog"),H=Me("loading");return x(),U(ee,{modelValue:D(l),"onUpdate:modelValue":C[6]||(C[6]=F=>te(l)?l.value=F:null),title:D(u).name,width:k.value?"800px":"500px","append-to-body":""},{footer:f(()=>[_(J,{onClick:C[5]||(C[5]=F=>l.value=!1)},{default:f(()=>[P(" 取 消 ")]),_:1}),_(J,{type:"primary",onClick:O},{default:f(()=>[P(" 确 定 ")]),_:1})]),default:f(()=>[_(Z,{gutter:20},{default:f(()=>[k.value?(x(),U(A,{key:0,span:10},{default:f(()=>[Ke((x(),U(D(qt),{ref_key:"treeRef",ref:p,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:c.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:E},{default:f(({data:F})=>[X("div",null,[_(D(Wt),{icon:r[F.type],style:{display:"inline-block"}},null,8,["icon"]),X("span",null,z(F.title),1)])]),_:1},8,["data"])),[[H,I.value]])]),_:1})):W("",!0),_(A,{span:k.value?14:24},{default:f(()=>[_(Q,{ref_key:"formRef",ref:y,modelValue:D(a),"onUpdate:modelValue":C[3]||(C[3]=F=>te(a)?a.value=F:null),defaults:b.value,"onUpdate:defaults":C[4]||(C[4]=F=>b.value=F),option:w},{assignee:f(()=>[(x(!0),K(Y,null,pe(m.value,F=>(x(),U(M,{key:F.id,type:"info"},{default:f(()=>[P(z(F.title),1)]),_:2},1024))),128))]),copyUser:f(()=>[_(j,{modelValue:d.value,"onUpdate:modelValue":[C[0]||(C[0]=F=>d.value=F),C[1]||(C[1]=F=>D(a).copyUser=F.join(","))],data:v.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:f(()=>[_(Fo,{modelValue:D(a).comment,"onUpdate:modelValue":C[2]||(C[2]=F=>D(a).comment=F)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Mo=Zt,lt=B({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:r}=nl(),s=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(i){t("update:modelValue",i.join(","))}}),a=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(i){t("update:modelValue",i)}}),u=$([]),l=$(!1),n=R(()=>{var i,c;return(c=(i=o.tableData)==null?void 0:i.row)==null?void 0:c.type});return ve(n,i=>{["dept","post","user"].includes(i)&&(l.value=!0,r(i==="user"?"":i).then(c=>{u.value=Ee(c.data,m=>({label:m.title,value:m.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(i,c)=>{const m=V("el-tree-select"),v=V("el-input");return["dept","post","user"].includes(n.value)?(x(),U(m,{key:0,modelValue:s.value,"onUpdate:modelValue":c[0]||(c[0]=d=>s.value=d),data:u.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(x(),U(v,{key:1,modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=d=>a.value=d)},null,8,["modelValue"]))}}}),Ko={key:0,class:"flow-viewer"},Bo={class:"flow-status-legend"},jo=B({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,r=$({}),s=$({}),a=R({get(){let p=Xt();return typeof o.modelValue=="string"&&o.modelValue?p=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(p=o.modelValue),p},set(p){t("update:modelValue",JSON.stringify(p))}}),u=R(()=>{const{column:p=[],group:k=[]}=JSON.parse(o.flowFormOption||"{}");return[...p,...k.map(h=>h.column??[]).flat()]}),l=R(()=>u.value.map(k=>({label:k.label,value:`\${${k.prop}}`,desc:`\${${k.prop}}`}))),n=ce(We),i=ce(Qe),{data:c}=He().useList();ve(s,p=>{var k,g,h,L,I,S,E,O,N,C,A;p&&(p.priority&&(p.priority.dicData=l.value),p.formTitle&&(p.formTitle.dicData=l.value),(h=(g=(k=p.assignee)==null?void 0:k.children)==null?void 0:g.column)!=null&&h[1]&&(p.assignee.children.column[1].component=lt),(N=(O=(E=(S=(I=(L=p.circulate)==null?void 0:L.children)==null?void 0:I.column)==null?void 0:S[1])==null?void 0:E.children)==null?void 0:O.column)!=null&&N[1]&&(p.circulate.children.column[1].children.column[1].component=lt),p.formProperty&&(r.value.formProperty=m(u.value,r.value.formProperty||[])),p.button&&((A=(C=p.button.children)==null?void 0:C.column)==null||A.forEach(M=>{M.prop==="display"&&(M.dicData=n),M.prop==="approval"&&(M.dicData=i)}),r.value.button=v(c.value||[],r.value.button||[])))});function m(p,k){return p.map(g=>{var j,Q;const h=k.find(Z=>Z.prop===g.prop),{label:L,prop:I,display:S=!0,disabled:E=!1,detail:O=!1,readonly:N=!1,rules:C}=g,A=(C==null?void 0:C.some(Z=>Z.required))??!1,M={label:L,prop:I,display:S,disabled:E,detail:O,readonly:N,required:A,...h};return g.type==="dynamic"&&((Q=(j=g.children)==null?void 0:j.column)!=null&&Q.length)&&(M.children=m(g.children.column,(h==null?void 0:h.children)??[])),M})}function v(p,k){return p.filter(g=>g.status===1).map(g=>{const h=k.find(N=>N.buttonKey===g.buttonKey),{name:L,buttonKey:I,display:S,approval:E}=g;return{name:L,buttonKey:I,display:S,approval:E,...h}})}const{data:d}=Te().useParam("flow.task.status"),y=R(()=>{var p;return(p=o.flowHistory)==null?void 0:p.map(k=>{var h,L;const g=(L=(h=d.value)==null?void 0:h.find(I=>I.value===k.status))==null?void 0:L.style;return{id:k.taskNodeKey,style:g}})}),b=R(()=>{var p,k;return(k=(p=o.flowHistory)==null?void 0:p.filter(g=>g.taskNodeType==="userTask"))==null?void 0:k.map(g=>{var h;return{id:g.taskNodeKey,content:`<div>${g.assigneeName}</div>
        <div>${g.endTime??""}</div>
        <div>${((h=g.comment)==null?void 0:h.comment)??""}</div>`}})});function w(){var p,k;(k=(p=a.value)==null?void 0:p.flowElementList)==null||k.forEach(g=>{var h;(h=g.properties)!=null&&h.button&&(g.properties.button=v(c.value||[],[]))}),a.value={...a.value}}function T(){var p,k;(k=(p=a.value)==null?void 0:p.flowElementList)==null||k.forEach(g=>{var h;(h=g.properties)!=null&&h.formProperty&&(g.properties.formProperty=m(u.value,[]))}),a.value={...a.value}}return(p,k)=>{const g=V("el-button");return p.view?(x(),K("div",Ko,[X("div",Bo,[(x(!0),K(Y,null,pe(D(d),h=>{var L;return x(),K("div",{key:h.label,class:"legend-item"},[X("div",{class:"legend-color",style:Pt({backgroundColor:(L=h.style)==null?void 0:L.fill})},null,4),X("span",null,z(h.label),1)])}),128))]),_(D(Jt),{"model-value":a.value,styles:y.value,tooltips:b.value},null,8,["model-value","styles","tooltips"])])):(x(),U(D(Yt),{key:1,modelValue:a.value,"onUpdate:modelValue":k[0]||(k[0]=h=>a.value=h),formData:r.value,"onUpdate:formData":k[1]||(k[1]=h=>r.value=h),formDefaults:s.value,"onUpdate:formDefaults":k[2]||(k[2]=h=>s.value=h),"form-options":D(Mo),"form-width":"30%"},{"form-top":f(()=>[_(g,{type:"default",onClick:w},{default:f(()=>[P(" 重置所有按钮配置 ")]),_:1}),_(g,{type:"default",onClick:T},{default:f(()=>[P(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const xe=Be(jo,[["__scopeId","data-v-2fb89427"]]),zo={class:"flow-track"},qo={key:0},Wo={key:1},Qo=B({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=$("table"),r=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],s=R(()=>{var n,i,c;return((c=(i=(n=t.flowDetail)==null?void 0:n.flowHistory)==null?void 0:i.filter(m=>m.taskNodeType==="userTask"))==null?void 0:c.map(m=>({...m,duration:Tt(m.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:u}=Te().useParam("flow.handle.type");function l(n){var i;return(i=u.value)==null?void 0:i.find(c=>c.value===n)}return(n,i)=>{var p,k,g;const c=V("v-icon"),m=V("el-radio-button"),v=V("el-radio-group"),d=V("avue-crud"),y=V("el-card"),b=V("el-timeline-item"),w=V("el-timeline"),T=V("el-empty");return x(),K(Y,null,[_(v,{modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=h=>o.value=h)},{default:f(()=>[(x(),K(Y,null,pe(r,h=>_(m,{key:h.label,label:h.label},{default:f(()=>[_(c,{icon:h.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),X("div",zo,[o.value==="table"?(x(),U(d,{key:0,data:s.value,option:a},null,8,["data"])):W("",!0),o.value==="graph"?(x(),U(xe,{key:1,"model-value":(k=(p=n.flowDetail)==null?void 0:p.process)==null?void 0:k.flowData,"flow-history":(g=n.flowDetail)==null?void 0:g.flowHistory,view:""},null,8,["model-value","flow-history"])):W("",!0),o.value==="timeline"?(x(),K(Y,{key:2},[s.value.length?(x(),U(w,{key:0},{default:f(()=>[(x(!0),K(Y,null,pe([...s.value].reverse(),h=>(x(),U(b,{key:h.id,timestamp:h.endTime,placement:"top"},{default:f(()=>[_(y,null,{default:f(()=>{var L,I,S;return[X("div",null,z(h.assigneeName)+" 开始处理 ["+z(h.taskNodeName)+"] 环节 ",1),h.duration?(x(),K("div",qo," 办理时长："+z(h.duration),1)):W("",!0),h.type&&((L=h.comment)!=null&&L.comment)?(x(),K("div",Wo,z((I=l(h.type))==null?void 0:I.label)+"意见："+z((S=h.comment)==null?void 0:S.comment),1)):W("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(x(),U(T,{key:1}))],64)):W("",!0)])],64)}}});const Ho=Be(Qo,[["__scopeId","data-v-c50075ce"]]),Go=B({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:r}=He().useList();function s(u,l){return u.map(n=>{const i=l.find(m=>m.buttonKey===n.buttonKey);return{...n,...Qt(i,["display","approval"])}})}const a=R(()=>{var y,b,w,T,p;const u={userId:"1"},{assignee:l,status:n}=((y=o.flowDetail)==null?void 0:y.task)||{},{createUser:i,flowInstanceId:c,status:m}=((b=o.flowDetail)==null?void 0:b.flowInstance)||{},v={true:!0,false:!1,startUser:i==u.userId,assignee:l==u.userId,todo:n==2,done:n==1,notstarted:!c,started:!!c,finished:m===1,unfinished:m===2};return((p=s(r.value??[],((T=(w=o.flowDetail)==null?void 0:w.properties)==null?void 0:T.button)??[]))==null?void 0:p.filter(k=>{var g,h;return(h=(g=k.display)==null?void 0:g.split(","))==null?void 0:h.every(L=>v[L])}))??[]});return(u,l)=>{const n=V("v-icon"),i=V("el-button");return x(!0),K(Y,null,pe(a.value,c=>(x(),U(i,{key:c.buttonKey,type:c.buttonType,onClick:m=>t("click",c)},{default:f(()=>[_(n,{icon:c.icon},null,8,["icon"]),P(" "+z(c.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Jo=B({__name:"upload-table",props:{flowDetail:{}},setup(e){var y,b;const t=e,{upload:{action:o,headers:r,preview:s,download:a,props:u}}=G(),l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:n,getDataList:i,handleDel:c,handleSave:m,crudStateRefs:{tableData:v}}=oe({crudOption:{...ll(),saveSuccessMsg:"上传成功"},tableOption:l,queryForm:{isLatest:1,flowInstanceId:(b=(y=t.flowDetail)==null?void 0:y.task)==null?void 0:b.flowInstanceId}});i();async function d(w,T){var S,E,O,N;const{fileName:p,fileType:k,fileSize:g,fileUrl:h,res:L}=u,I={fileName:ye({res:w},`${L}.${p}`),fileType:ye({res:w},`${L}.${k}`),fileSize:ye({res:w},`${L}.${g}`),fileUrl:ye({res:w},`${L}.${h}`),taskId:(E=(S=t.flowDetail)==null?void 0:S.task)==null?void 0:E.taskId,flowInstanceId:(N=(O=t.flowDetail)==null?void 0:O.task)==null?void 0:N.flowInstanceId,rootMark:(T==null?void 0:T.rootMark)||"",version:typeof(T==null?void 0:T.version)=="number"?T.version+1:1};await m(I,i,()=>{})}return(w,T)=>{const p=V("el-button"),k=V("el-upload"),g=V("avue-crud");return x(),U(g,ne(se(D(n))),{"menu-left":f(()=>[_(k,{action:D(o),headers:D(r),"show-file-list":!1,onSuccess:d},{default:f(()=>[_(p,{type:"primary",icon:"el-icon-upload"},{default:f(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:f(({row:h,index:L})=>[_(p,{type:"primary",text:"",icon:"el-icon-view",onClick:I=>{var S;return(S=D(s))==null?void 0:S(h,D(v))}},{default:f(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),_(p,{type:"primary",text:"",icon:"el-icon-download",onClick:I=>{var S;return(S=D(a))==null?void 0:S(h,D(v))}},{default:f(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),_(k,{action:D(o),headers:D(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:I=>d(I,h)},{default:f(()=>[_(p,{type:"primary",text:"",icon:"el-icon-upload"},{default:f(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),_(p,{type:"primary",text:"",icon:"el-icon-delete",onClick:I=>D(c)(h,L)},{default:f(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Yo={class:"flow-form__title"},wt=B({__name:"index",props:Uo(),emits:Po(),setup(e,{emit:t}){const o=e,r=Eo(o,t),{flowDetail:s,modelValue:a,activeTab:u,activeBtn:l,formLoading:n,approvalVisible:i,submitLoading:c}=r,m=$();async function v(b){var w,T;l.value=b,await((w=m.value)==null?void 0:w.validate()),await((T=o.beforeClick)==null?void 0:T.call(o,b)),(b==null?void 0:b.approval)!=="false"?i.value=!0:y()}const d=Lo(r);async function y(){var b,w;try{const{buttonKey:T}=l.value;c.value=!0,await((b=o.beforeSubmit)==null?void 0:b.call(o,l.value));const p=(w=d[T])==null?void 0:w.call(d);p instanceof Promise?(await p,le.success("操作成功"),i.value=!1,t("complete",l.value)):le.error("操作失败")}finally{c.value=!1}}return(b,w)=>{const T=V("el-skeleton"),p=V("el-main"),k=V("el-header"),g=V("el-tab-pane"),h=V("el-tabs"),L=V("el-container");return D(n)?(x(),U(p,{key:0},{default:f(()=>[_(T)]),_:1})):(x(),U(L,{key:1,class:"flow-form"},{default:f(()=>[_(k,{class:"flow-form__header"},{default:f(()=>{var I;return[X("div",Yo,z((I=D(s).flowInstance)==null?void 0:I.title),1),_(Go,{"flow-detail":D(s),onClick:v},null,8,["flow-detail"])]}),_:1}),_(p,{class:"flow-form__main"},{default:f(()=>[_(h,{modelValue:D(u),"onUpdate:modelValue":w[1]||(w[1]=I=>te(u)?u.value=I:null)},{default:f(()=>{var I,S;return[(S=(I=D(s))==null?void 0:I.process)!=null&&S.formPath?Et(b.$slots,"default",{key:0}):(x(),U(g,{key:1,label:"审批信息",name:"form"},{default:f(()=>[_(Ro,{ref_key:"formRef",ref:m,modelValue:D(a),"onUpdate:modelValue":w[0]||(w[0]=E=>te(a)?a.value=E:null),"flow-detail":D(s)},null,8,["modelValue","flow-detail"])]),_:1})),_(g,{label:"附件资料",name:"file",lazy:""},{default:f(()=>[_(Jo,{"flow-detail":D(s)},null,8,["flow-detail"])]),_:1}),_(g,{label:"流程跟踪",name:"track",lazy:""},{default:f(()=>[_(Ho,{"flow-detail":D(s)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),_(Ao,{onConfirm:y})]),_:3}))}}});function yt(e,t){switch(t.type){case"window":return Xo(e,t);case"dialog":case"drawer":return Zo(e,t);default:return{open:()=>{},close:()=>{}}}}function Xo(e,t){const{window:{url:o="",name:r="flow-form",features:s="left=0,top=0,width=1600,height=900"}={}}=t,a=$(null),u=R(()=>`${o}?${Nt(Ot(e,It($t,Lt)))}`);return{open:()=>{var i;a.value=window.open(u.value,r,s),(i=a.value)==null||i.addEventListener("message",c=>{const{event:m}=c.data,v=D(e)[m];typeof v=="function"&&v(c.data)})},close:()=>{var i;return(i=a.value)==null?void 0:i.close()},openedWindow:a}}function Zo(e,t){const{appContext:o}=nt();let r;const s=()=>{r=document.createElement("div"),r.className="flow-form-wrapper";const u=el(t.formPath),l=Pe(u,{...D(e)}),n=Pe(t.type==="dialog"?Ht:Gt,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},l);n.appContext=o,Rt(n,r),document.body.appendChild(r)},a=()=>{r&&document.body.removeChild(r)};return{open:s,close:a}}function el(e){return e?Ft(()=>At(()=>import(e),[])):wt}function G(){return Ae(rt)}var bt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(bt||{}),We=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(We||{}),Qe=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(Qe||{}),gt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(gt||{});function He(){const{request:e}=G(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function tl(){const{request:e}=G(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ol(){const{request:e}=G(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=n=>e.get(t.list,{params:{type:n,ascs:"sort"}});return{url:t,getList:o,useList:n=>_e(()=>o(n.value).then(i=>i.data.records),{refreshDeps:[n]}),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),batchUpdate:n=>e.post(t.batchUpdate,n)}}function Ge(){const{request:e}=G(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var ht=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(ht||{});function Je(){const{request:e}=G(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function ll(){const{request:e}=G(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function al(){const{request:e}=G(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:r=>e.get(t.list,{params:r})}}function Te(){const{request:e}=G(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=i=>e.get(t.list,{params:i}),r=()=>e.get(t.all),s=i=>e.get(t.key,{params:{paramKey:i}});return{url:t,getList:o,getAllParam:r,getParam:s,useParam:i=>_e(()=>s(i).then(c=>c.data)),create:i=>e.post(t.save,i),update:i=>e.post(t.update,i),remove:i=>e.post(t.remove,{},{params:{ids:i}})}}function kt(){const{request:e}=G(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function nl(){const{request:e}=G(),t={tree:"/sapier-flow/flow-user/tree"},o=s=>e.get(t.tree,{params:{filter:s}});return{url:t,getUserTree:o,useUserTree:()=>_e(()=>o().then(s=>s.data))}}function Vt(){const{request:e}=G(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Dt=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Dt||{});function Fe(){const{request:e}=G(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=n=>e.get(t.list,{params:n});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),deploy:n=>e.post(t.deploy,n)}}const sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ce(bt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ce(We),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ce(Qe),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:ce(gt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},rl=B({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r}=oe({tableOption:sl,crudOption:He(),sortOption:{ascs:"sort"}});return r(),(s,a)=>{const u=V("v-icon"),l=V("el-button"),n=V("avue-crud");return x(),U(n,ne(se(D(t))),{icon:f(({row:i})=>[_(u,{icon:i.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:f(({row:i})=>[_(l,{type:i.buttonType},{default:f(()=>[_(u,{icon:i.icon},null,8,["icon"]),P(" "+z(i.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":f(()=>[_(l,{type:D(o).buttonType},{default:f(()=>[_(u,{icon:D(o).icon},null,8,["icon"]),P(" "+z(D(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ye={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},il={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Ye.column,{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Ct=B({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:r,deploy:s}=Ge(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:il,crudOption:{getList:r},searchForm:{categoryId:o.categoryId}});ie(()=>{u.value.categoryId=o.categoryId??"",l()});const n=$(!1);async function i(c){await ke.confirm("发布新版本，是否确认？","提示",{type:"success"}),n.value=!0,s({flowModuleId:c.flowModuleId}).then(()=>{le.success("发布成功"),l()}).finally(()=>{n.value=!1})}return(c,m)=>{const v=V("el-button"),d=V("v-icon"),y=V("avue-crud");return x(),U(y,ne(se(D(a))),{"menu-left":f(()=>[_(v,{type:"primary",icon:"el-icon-plus",onClick:m[0]||(m[0]=b=>t("add"))},{default:f(()=>[P(" 新增 ")]),_:1})]),menu:f(({row:b})=>[_(v,{loading:n.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",b)},{default:f(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),_(v,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",b)},{default:f(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),_(v,{loading:n.value,type:"text",icon:"el-icon-upload",onClick:w=>i(b)},{default:f(()=>[P(" 发布 ")]),_:2},1032,["loading","onClick"]),_(v,{loading:n.value,type:"text",icon:"el-icon-switch",onClick:w=>t("version",b)},{default:f(()=>[P(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:f(({row:b})=>[_(d,{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),ul={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Ye.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},xt=B({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:r,update:s}=Je(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:ul,crudOption:{getList:r,dataPath:"res.data"}});ie(()=>{o.flowModuleId&&(u.value.flowModuleId=o.flowModuleId,l())});const n=$(!1);async function i(c){await ke.confirm(`确定将 ${c.flowName}(${c.flowKey}:v${c.version}) 设为主版本?`,"提示",{type:"warning"}),n.value=!0,s({flowDeployId:c.flowDeployId,flowModuleId:c.flowModuleId,mainVersion:1}).then(()=>{le.success("设置成功"),l()}).finally(()=>{n.value=!1})}return(c,m)=>{const v=V("el-button"),d=V("v-icon"),y=V("avue-crud");return x(),U(y,ne(se(D(a))),{"menu-left":f(()=>[_(v,{loading:n.value,type:"primary",icon:"el-icon-arrow-left",onClick:m[0]||(m[0]=b=>t("back"))},{default:f(()=>[P(" 返回 ")]),_:1},8,["loading"])]),menu:f(({row:b})=>[_(v,{loading:n.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",b)},{default:f(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),_(v,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",b)},{default:f(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),_(v,{loading:n.value,disabled:b.mainVersion===D(ht).是,type:"text",icon:"el-icon-switch",onClick:w=>i(b)},{default:f(()=>[P(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:f(({row:b})=>[_(d,{icon:b.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),at={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},cl=B({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:r},getDataList:s,handleSave:a,handleUpdate:u,handleDel:l}=oe({crudOption:{rowKey:"id",...tl(),dataPath:"res.data"},tableOption:at,pageOption:{pageSize:20}});s();function n(m,v,d,y){a(v,d,y)}function i(m,v,d,y){u(v,NaN,d,y)}async function c(m,v){await l(m.data,NaN),v()}return(m,v)=>{const d=V("avue-tree");return x(),U(d,{modelValue:D(o),"onUpdate:modelValue":v[0]||(v[0]=y=>te(o)?o.value=y:null),option:D(at),data:D(r),onNodeClick:v[1]||(v[1]=y=>t("node-click",y)),onSave:n,onUpdate:i,onDel:c},null,8,["modelValue","option","data"])}}}),Xe=B({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var l;const o=e,r=R({get(){return o.modelValue?st(o.modelValue):{menuBtn:!1,span:24}},set(n){t("update:modelValue",zt(n,{useJson5:!1}))}}),s=R(()=>o.fields?JSON.parse(o.fields):[]),a=R(()=>{const n={type:"select",dicData:s.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...n,props:{label:"name",value:"name",desc:"comment"}},{...n,props:{label:"comment",value:"comment",desc:"name"}}]}),u={form:{settings:Array.from({length:((l=Bt.settings)==null?void 0:l.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(n,i)=>{const c=V("avue-form");return n.view?(x(),U(c,{key:0,class:Mt(r.value.class),"model-value":{},option:r.value},null,8,["class","option"])):(x(),U(D(jt),{key:1,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=m=>r.value=m),"base-option":a.value,resources:u},null,8,["modelValue","base-option"]))}}}),dl=X("span",null,"流程设计",-1),pl={key:0},fl={key:1},ml={style:{height:"calc(100vh - 144px)"}},vl=B({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const r=De(e),{visible:s,modelValue:a}=r,{create:u,deploy:l,getDetail:n,update:i}=Ge(),{getDetail:c,update:m}=Je(),v=["流程信息","表单设计","模型设计","完成"],d=$(!1);ve(s,async E=>{if(!E)return;const{flowModuleId:O}=a.value,{flowDeployId:N}=a.value;try{d.value=!0;let C={};N?C=await c({flowDeployId:N}):O&&(C=await n({flowModuleId:O})),a.value=C.data}finally{d.value=!1}},{immediate:!0});const{data:y}=Vt().useList(),{data:b}=kt().useList(),{data:w}=Fe().useList(),T=R(()=>{var E,O;return(O=(E=w.value)==null?void 0:E.find(N=>N.tableName===a.value.formDataTable))==null?void 0:O.tableFields}),p=$(0),k=R(()=>{var E,O;return p.value===1?((E=y.value)==null?void 0:E.map(N=>({label:N.formName,value:N.formOption})))??[]:p.value===2?((O=b.value)==null?void 0:O.map(N=>({label:N.flowName,value:N.flowData})))??[]:[]});function g(E){p.value===1?a.value.formOption=E.value:p.value===2&&(a.value.flowData=E.value)}const h=$();async function L(E){p.value===0&&await qe(h),d.value=!0;const{flowModuleId:O}=a.value,{flowDeployId:N}=a.value;try{N?await m(a.value):O?await i(a.value):await u(a.value).then(C=>{a.value.flowModuleId=C.data.flowModuleId}),le.success("保存成功")}finally{d.value=!1}typeof E=="number"?p.value=E:p.value++}async function I(){await ke.confirm("发布新版本，是否确认？","提示"),d.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{le.success("发布成功")}).finally(()=>{d.value=!1})}function S(){s.value=!1,p.value=0,a.value={},t("close")}return(E,O)=>{const N=V("el-link"),C=V("el-dropdown-item"),A=V("el-dropdown-menu"),M=V("el-dropdown"),j=V("el-col"),Q=V("el-step"),Z=V("el-steps"),J=V("el-button"),ee=V("el-row"),H=V("avue-form"),F=V("el-result"),re=V("el-dialog"),Ze=Me("loading");return x(),U(re,{modelValue:D(s),"onUpdate:modelValue":O[4]||(O[4]=q=>te(s)?s.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:S},{header:f(()=>[_(ee,{align:"center",justify:"center"},{default:f(()=>[_(j,{span:5},{default:f(()=>{var q,fe,Ne,et;return[X("div",null,[dl,(q=D(a))!=null&&q.flowName?(x(),K("span",pl," - "+z((fe=D(a))==null?void 0:fe.flowName),1)):W("",!0),(Ne=D(a))!=null&&Ne.version?(x(),K("span",fl," - V"+z((et=D(a))==null?void 0:et.version),1)):W("",!0)]),k.value.length?(x(),U(M,{key:0},{dropdown:f(()=>[_(A,null,{default:f(()=>[(x(!0),K(Y,null,pe(k.value,Oe=>(x(),U(C,{key:Oe.label,onClick:Rl=>g(Oe)},{default:f(()=>[P(z(Oe.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:f(()=>[_(N,{icon:"el-icon-arrow-down",underline:!1},{default:f(()=>[P(" 选择模板 ")]),_:1})]),_:1})):W("",!0)]}),_:1}),_(j,{span:14},{default:f(()=>[_(Z,{active:p.value,simple:"","process-status":"finish","finish-status":"success"},{default:f(()=>[(x(),K(Y,null,pe(v,(q,fe)=>_(Q,{key:fe,title:q,onClick:Ne=>L(fe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),_(j,{span:5,style:{"text-align":"right"}},{default:f(()=>[_(J,{disabled:p.value===0,loading:d.value,type:"primary",onClick:O[0]||(O[0]=q=>p.value--)},{default:f(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),_(J,{disabled:p.value===v.length-1,type:"primary",loading:d.value,onClick:L},{default:f(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),_(J,{onClick:S},{default:f(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:f(()=>[Ke((x(),K("div",ml,[p.value===0?(x(),U(H,{key:0,ref_key:"formRef",ref:h,modelValue:D(a),"onUpdate:modelValue":O[1]||(O[1]=q=>te(a)?a.value=q:null),option:D(Ye),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):W("",!0),p.value===1?(x(),U(Xe,{key:1,modelValue:D(a).formOption,"onUpdate:modelValue":O[2]||(O[2]=q=>D(a).formOption=q),fields:T.value},null,8,["modelValue","fields"])):W("",!0),p.value===2?(x(),U(xe,{key:2,modelValue:D(a).flowData,"onUpdate:modelValue":O[3]||(O[3]=q=>D(a).flowData=q),"flow-form-option":D(a).formOption},null,8,["modelValue","flow-form-option"])):W("",!0),p.value===3?(x(),U(F,{key:3,icon:"success",title:"流程设计完成"},{extra:f(()=>[D(a).flowDeployId?W("",!0):(x(),U(J,{key:0,type:"primary",onClick:I},{default:f(()=>[P(" 发布 ")]),_:1})),_(J,{onClick:S},{default:f(()=>[P(" 关闭 ")]),_:1})]),_:1})):W("",!0)])),[[Ze,d.value]])]),_:1},8,["modelValue"])}}}),_l=X("span",null,"流程查看",-1),wl={key:0},yl={key:1},bl=B({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=De(e),{visible:r,modelValue:s}=o,{getDetail:a}=Ge(),{getDetail:u}=Je(),l=$("form"),n=$(!1);ve(r,async c=>{if(!c)return;const{flowModuleId:m}=s.value,{flowDeployId:v}=s.value;try{n.value=!0;let d={};v?d=await u({flowDeployId:v}):m&&(d=await a({flowModuleId:m})),s.value={...d.data}}finally{n.value=!1}},{immediate:!0});function i(){s.value={},l.value="form"}return(c,m)=>{const v=V("el-tab-pane"),d=V("el-tabs"),y=V("el-dialog"),b=Me("loading");return x(),U(y,{modelValue:D(r),"onUpdate:modelValue":m[3]||(m[3]=w=>te(r)?r.value=w:null),width:"60%",top:"0",onClose:i},{header:f(()=>{var w,T,p,k;return[_l,(w=D(s))!=null&&w.flowName?(x(),K("span",wl," - "+z((T=D(s))==null?void 0:T.flowName),1)):W("",!0),(p=D(s))!=null&&p.version?(x(),K("span",yl," - V"+z((k=D(s))==null?void 0:k.version),1)):W("",!0)]}),default:f(()=>[Ke((x(),U(d,{modelValue:l.value,"onUpdate:modelValue":m[2]||(m[2]=w=>l.value=w)},{default:f(()=>[_(v,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:f(()=>[l.value==="form"&&D(s).formOption?(x(),U(Xe,{key:0,modelValue:D(s).formOption,"onUpdate:modelValue":m[0]||(m[0]=w=>D(s).formOption=w),view:""},null,8,["modelValue"])):W("",!0)]),_:1}),_(v,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:f(()=>[l.value==="flow"?(x(),U(xe,{key:0,modelValue:D(s).flowData,"onUpdate:modelValue":m[1]||(m[1]=w=>D(s).flowData=w),view:""},null,8,["modelValue"])):W("",!0)]),_:1})]),_:1},8,["modelValue"])),[[b,n.value]])]),_:1},8,["modelValue"])}}}),gl=B({__name:"index",setup(e){const t=$("definition"),o=$({}),r=$(""),s=$("");function a(y){r.value===y.id?r.value="":r.value=y.id}const u=$(!1),l=$(!1);function n(){o.value={},u.value=!0}function i(y){o.value=y,u.value=!0}function c(y){o.value=y,l.value=!0}function m(y){s.value=y.flowModuleId||"",t.value="deploy"}function v(){s.value="",t.value="definition"}async function d(){const y=t.value;await de(),t.value="",await de(),t.value=`${y}`}return(y,b)=>{const w=V("el-col"),T=V("el-row");return x(),U(T,{gutter:20},{default:f(()=>[_(w,{span:4},{default:f(()=>[_(cl,{onNodeClick:a})]),_:1}),_(w,{span:20},{default:f(()=>[t.value==="definition"?(x(),U(Ct,{key:0,"category-id":r.value,onAdd:n,onEdit:i,onView:c,onVersion:m},null,8,["category-id"])):W("",!0),t.value==="deploy"?(x(),U(xt,{key:1,"flow-module-id":s.value,onEdit:i,onView:c,onBack:v},null,8,["flow-module-id"])):W("",!0),_(vl,{modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=p=>o.value=p),visible:u.value,"onUpdate:visible":b[1]||(b[1]=p=>u.value=p),onClose:d},null,8,["modelValue","visible"]),_(bl,{modelValue:o.value,"onUpdate:modelValue":b[2]||(b[2]=p=>o.value=p),visible:l.value,"onUpdate:visible":b[3]||(b[3]=p=>l.value=p)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),hl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},kl=B({__name:"index",setup(e){const t=to("debugMode",!1),{getList:o}=al(),{bindVal:r,getDataList:s}=oe({tableOption:hl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});s();const a=$({}),{open:u,close:l}=yt(a,{type:"drawer"});function n(i){a.value={flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:t.value,onComplete:()=>{l(),s()}},u()}return(i,c)=>{const m=V("el-switch"),v=V("el-button"),d=V("el-link"),y=V("avue-crud");return x(),U(y,ne(se(D(r))),{"menu-right":f(()=>[_(v,{type:"text"},{default:f(()=>[_(m,{modelValue:D(t),"onUpdate:modelValue":c[0]||(c[0]=b=>te(t)?t.value=b:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:f(({row:b})=>[_(d,{type:"primary",underline:!1,onClick:w=>n(b)},{default:f(()=>[P(z(b.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),Vl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Re},{label:"备注",prop:"remark"}]},Dl=B({__name:"index",setup(e){const{bindVal:t,getDataList:o}=oe({tableOption:Vl,crudOption:Te()});return o(),(r,s)=>{const a=V("avue-crud");return x(),U(a,ne(se(D(t))),null,16)}}}),Cl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},xl={class:"flow-list"},Tl=["onClick"],Nl={class:"flow-name"},Ol=B({__name:"index",setup(e){const t=$([]),{getPublishFlow:o,getTodoList:r}=Ce();o().then(v=>{t.value=v.data});const s=$({}),{open:a,close:u}=yt(s,{type:"drawer"});function l(v){s.value={flowKey:v.flowKey,taskId:v.taskId,instanceId:v.flowInstanceId,onComplete:()=>{u(),i()}},a()}const{bindVal:n,getDataList:i,crudStateRefs:{searchForm:c}}=oe({tableOption:Cl,crudOption:{getList:r},searchForm:{status:2}}),m=[{label:"待办",value:2},{label:"已办",value:1}];return(v,d)=>{const y=V("el-button"),b=V("v-icon"),w=V("el-collapse-item"),T=V("el-collapse"),p=V("el-card"),k=V("el-divider"),g=V("avue-radio"),h=V("el-link"),L=V("avue-crud");return x(),K(Y,null,[_(p,{"body-style":{padding:"0 20px"}},{default:f(()=>[_(T,{"model-value":"1"},{default:f(()=>[_(w,{name:"1"},{title:f(()=>[_(y,{text:"",icon:"el-icon-promotion"},{default:f(()=>[P(" 发起审批 ")]),_:1})]),default:f(()=>[X("div",xl,[(x(!0),K(Y,null,pe(t.value,I=>(x(),K("div",{key:I.flowKey,class:"flow-item",onClick:S=>l(I)},[_(b,{class:"flow-icon",icon:I.flowIcon,width:"60"},null,8,["icon"]),X("div",Nl,z(I.flowName),1)],8,Tl))),128))])]),_:1})]),_:1})]),_:1}),_(k,{direction:"horizontal","content-position":"left"}),_(L,ne(se(D(n))),{"menu-left":f(()=>[_(g,{modelValue:D(c).status,"onUpdate:modelValue":[d[0]||(d[0]=I=>D(c).status=I),D(i)],button:"",dic:m},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:f(({row:I})=>[_(h,{type:"primary",underline:!1,onClick:S=>l(I)},{default:f(()=>[P(z(I.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Il=Be(Ol,[["__scopeId","data-v-7d8c52d6"]]),$l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Ll=B({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r,handleUpdate:s}=oe({tableOption:$l,crudOption:kt()});r();const a=$(!1);async function u(n){o.value=n,a.value=!0}async function l(){await s(o.value,NaN,()=>a.value=!1,()=>{})}return(n,i)=>{const c=V("el-button"),m=V("avue-crud"),v=V("el-dialog");return x(),K(Y,null,[_(m,ne(se(D(t))),{flowData:f(({row:d})=>[_(c,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>u(d)},{default:f(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),_(v,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=d=>a.value=d),title:`模型设计-${D(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[_(c,{type:"primary",onClick:l},{default:f(()=>[P(" 保存 ")]),_:1}),_(c,{onClick:i[1]||(i[1]=d=>a.value=!1)},{default:f(()=>[P(" 取消 ")]),_:1})]),default:f(()=>[_(xe,{modelValue:D(o).flowData,"onUpdate:modelValue":i[0]||(i[0]=d=>D(o).flowData=d),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Ul=B({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r,handleUpdate:s}=oe({tableOption:Sl,crudOption:Vt()});r();const a=$(!1);async function u(n){o.value={...n},a.value=!0}async function l(){await s(o.value,NaN,()=>a.value=!1,()=>{})}return(n,i)=>{const c=V("el-button"),m=V("avue-crud"),v=V("el-dialog");return x(),K(Y,null,[_(m,ne(se(D(t))),{formOption:f(({row:d})=>[_(c,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>u(d)},{default:f(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),_(v,{modelValue:a.value,"onUpdate:modelValue":i[2]||(i[2]=d=>a.value=d),title:`表单设计-${D(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[_(c,{type:"primary",onClick:l},{default:f(()=>[P(" 保存 ")]),_:1}),_(c,{onClick:i[1]||(i[1]=d=>a.value=!1)},{default:f(()=>[P(" 取消 ")]),_:1})]),default:f(()=>[_(Xe,{modelValue:D(o).formOption,"onUpdate:modelValue":i[0]||(i[0]=d=>D(o).formOption=d),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Pl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ce(Dt)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Re,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Re,value:1}]}}]},El=B({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:r,beforeOpen:s,beforeSubmit:a}=oe({crudOption:Fe(),tableOption:Pl});r();const{data:u}=Te().useParam("table.default.fields");s(c=>{c==="add"?o.value.tableFields=u.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),a(c=>{c.tableFields=JSON.stringify(c.tableFields)});const{deploy:l}=Fe(),n=$(!1);async function i(c){await ke.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),n.value=!0,l({id:c.id}).then(()=>{le.success("部署成功"),r()}).finally(()=>{n.value=!1})}return(c,m)=>{const v=V("el-button"),d=V("avue-crud");return x(),U(d,ne(se(D(t))),{menu:f(({row:y})=>[_(v,{type:"text",icon:"el-icon-upload",onClick:b=>i(y)},{default:f(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ka={install(e,t){e.component("FlowButton",rl),e.component("FlowDefinition",Ct),e.component("FlowDeploy",xt),e.component("FlowForm",wt),e.component("FlowManage",gl),e.component("FlowOps",kl),e.component("FlowParam",Dl),e.component("FlowTemplate",Ll),e.component("FormTemplate",Ul),e.component("TableTemplate",El),e.component("FlowWorkbench",Il),e.provide(rt,St(oo,t))}};export{rl as FlowButton,Ct as FlowDefinition,xt as FlowDeploy,wt as FlowForm,gl as FlowManage,kl as FlowOps,Dl as FlowParam,Ll as FlowTemplate,Il as FlowWorkbench,Ul as FormTemplate,El as TableTemplate,Ka as default};
