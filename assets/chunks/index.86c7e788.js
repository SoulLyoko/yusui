import{c as L,C as Ae,t as Be,d as Ee,e as Ke,f as Re,g as ie,h as ze,F as ue,b as je,i as We,T as ee,j as Je,k as ye,l as Ge,m as He,n as Qe,o as Xe,p as Ye}from"./mobile.dfefe395.js";import{K as Qo,L as Xo,D as Yo,w as Zo,v as qo,s as el,x as tl,r as ol,_ as ll,z as al,H as nl,N as sl,B as il,O as ul,W as rl,E as dl,I as cl,U as pl,S as ml,M as fl,V as vl,Y as _l,R as wl,J as yl,P as gl,q as bl,Q as kl,y as Dl,A as Fl,a as Vl,u as Cl,X as hl,G as Ol}from"./mobile.dfefe395.js";import{h as T,a5 as ve,aE as Ze,D as qe,d as M,J as _,b as h,w as o,a9 as z,aa as j,l as r,o as D,N as n,e as N,a as C,t as K,A as re,B as Y,g as J,n as et,c as A,L as te,R as ge,K as G,z as be,aF as ke,k as H,a7 as De,E as _e,_ as tt}from"./framework.6b67ac47.js";import"./index.013eb64a.js";import{s as ot}from"./index.386fc70b.js";import{m as de}from"./merge.0f542de0.js";import{a as Fe}from"./omitBy.496be11f.js";import{a as lt}from"./snakeCase.f05f4dc6.js";import{k as at}from"./baseGet.f3f2ab16.js";import{i as nt}from"./isNil.990ccdb3.js";import{E as st,a as it}from"../app.9d581225.js";import{u as R}from"./index.2a155e22.js";import"./index.es.1accc3d3.js";import{I as Z}from"./iconify.924204c7.js";import"./index.109b5c65.js";import"./form.814fb769.js";import"./index.100f92e3.js";import"./index.6700b933.js";import{j as ut,d as rt}from"./tree.50ccd3e9.js";import"./vuedraggable.umd.9831e9f5.js";import{u as oe}from"./index.69d25208.js";import{d as dt}from"./union.c774781a.js";import{a as Q,E as B}from"./index.b68c08c0.js";import{p as ct}from"./pick.c38fd284.js";import{w as le,a as ce,u as pt,b as mt,c as ft}from"./index.63550f19.js";import{f as vt,b as _t}from"./form.d4ae7eba.js";import{e as wt}from"./index.0246ace1.js";import{d as yt}from"./zipWith.8642dcad.js";import"./index.da343e5c.js";import"./cloneDeep.6b1411dd.js";import"./baseSet.84292f44.js";import"./initCloneObject.fb0a9e5d.js";import"./getTag.9f0d1dee.js";import"./data.0c1ff404.js";import"./get.51c768ca.js";import"./basePickBy.40d88517.js";import"./pickBy.e06d9ce3.js";import"./baseMap.717c06fd.js";import"./createCompounder.12670e9b.js";import"./theme.ab3b3e7f.js";import"./index.vue_vue_type_script_setup_true_lang.814d8a22.js";import"./index.bde6247e.js";import"./use-form-item.18167ea7.js";import"./isEqual.1cc8ee6e.js";import"./index.caee73d1.js";import"./config.ed7166e7.js";import"./index.6748db2d.js";import"./set.30e920c7.js";import"./kebabCase.47021076.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-bundler.21b58301.js";function Ve(u){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},i=v=>u.get(e.list,{params:v}),t=oe(i,{res:"data",modify:!0,defaultParams:[{size:-1,ascs:"sort"}]});return{getList:i,useList:t,getTree:v=>u.get(e.tree,{params:v}),create:v=>u.post(e.save,v),update:v=>u.post(e.update,v),remove:v=>u.post(e.remove,{},{params:{ids:v}})}}function ae(u){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},i=d=>u.get(e.list,{params:d}),t=oe(i,{res:"data.records",modify:!0,defaultParams:[{size:-1,ascs:"sort"}]});return{url:e,getList:i,useList:t,create:d=>u.post(e.save,d),update:d=>u.post(e.update,d),remove:d=>u.post(e.remove,{},{params:{ids:d}}),deploy:d=>u.post(e.deploy,d),getDetail:d=>u.get(e.detail,{params:d})}}var Ce=(u=>(u[u.否=0]="否",u[u.是=1]="是",u))(Ce||{});function pe(u){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:s=>u.get(e.list,{params:s}),getDetail:s=>u.get(e.detail,{params:s}),update:s=>u.post(e.update,s),remove:s=>u.post(e.remove,{},{params:{ids:s}})}}function gt(u){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>u.get(e.list,{params:t})}}function he(u){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},i=m=>u.get(e.list,{params:m}),t=oe(i,{res:"data.records",modify:!0,defaultParams:[{size:-1}]});return{url:e,getList:i,useList:t,create:m=>u.post(e.save,m),update:m=>u.post(e.update,m),remove:m=>u.post(e.remove,{},{params:{ids:m}})}}function Oe(u){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},i=m=>u.get(e.list,{params:m}),t=oe(i,{res:"data.records",modify:!0,defaultParams:[{size:-1}]});return{url:e,getList:i,useList:t,create:m=>u.post(e.save,m),update:m=>u.post(e.update,m),remove:m=>u.post(e.remove,{},{params:{ids:m}})}}function $e(u,e){return e in(Ae.useFlowFormOptions??{})}function ne(u={}){const{useFlowFormOptions:e}=L(),i=de({...e},{...u});switch(i==null?void 0:i.type){case"window":return bt(i);case"dialog":case"drawer":return kt(i);default:return{open:t=>{},close:()=>{}}}}function bt(u={}){const e=T(null);return{open:(l={})=>{var w;const a=de({...u},{...l}),{window:[s,m,v]=[]}=a,d=`${s}?${ot(Fe(a,lt(at,nt,$e)))}`;e.value=window.open(d,m,v),(w=e.value)==null||w.addEventListener("message",V=>{const{event:y,data:b}=V.data,p=l[y];typeof p=="function"&&p(b)})},close:()=>{var l;return(l=e.value)==null?void 0:l.close()},openedWindow:e}}function kt(u={}){const{appContext:e}=qe(),{FlowForm:i}=L();let t,l;const a=m=>{t=document.createElement("div"),t.className="flow-form-wrapper";const v=de({...u},{...m}),d=ve(i,Fe(v,$e));l=ve(v.type==="dialog"?st:it,{class:"flow-form-overlay",modelValue:!0,onClose:s,...v.overlay},d),l.appContext=e,Ze(l,t),document.body.appendChild(t)},s=()=>{var m,v;(v=(m=l==null?void 0:l.component)==null?void 0:m.props)!=null&&v.modelValue&&(l.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:a,close:s}}const Dt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:t},getDataList:l}=R({tableOption:Be,crudOption:Ee(e),sortOption:{ascs:"sort"}});return l(),(a,s)=>{const m=_("el-button"),v=_("avue-crud");return D(),h(v,z(j(r(i))),{icon:o(({row:d})=>[n(r(Z),{icon:d.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:d})=>[n(m,{type:d.buttonType},{default:o(()=>[d.icon?(D(),h(r(Z),{key:0,icon:d.icon},null,8,["icon"])):N("",!0),C(" "+K(d.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[n(m,{type:r(t).buttonType},{default:o(()=>[r(t).icon?(D(),h(r(Z),{key:0,icon:r(t).icon},null,8,["icon"])):N("",!0),C(" "+K(r(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ie=M({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(u,{emit:e}){const i=u,{request:t}=L(),{getList:l,deploy:a,update:s,remove:m}=ae(t),{bindVal:v,crudStateRefs:{searchForm:d},getDataList:w}=R({tableOption:Ke,crudOption:{getList:l,remove:m},sortOption:{ascs:"sort"},searchForm:{categoryId:i.categoryId}});re(()=>{d.value.categoryId=i.categoryId??""}),le(d,w,{debounce:300,immediate:!0,deep:!0});const V=T(!1);async function y(k){await Q.confirm("发布新版本，是否确认？","提示",{type:"success"}),V.value=!0,a({flowModuleId:k.flowModuleId}).then(()=>{B.success("发布成功"),w()}).finally(()=>{V.value=!1})}async function b(k){if(k.mainVersion)return B.warning("请先删除已发布的流程");await Q.confirm("确认删除？","提示",{type:"warning"}),await m(k.flowModuleId),B.success("删除成功"),w()}function p(k){s(ct(k,["flowModuleId","flowKey","sort"])),w()}const c=dt(p,500),{open:f,close:F}=ne();function O(k){f({flowKey:k.flowKey,debug:!0,onComplete(){F(),B.success("操作成功")}})}return(k,I)=>{const E=_("el-button"),x=_("el-dropdown-item"),S=_("el-input-number"),P=_("avue-crud");return D(),h(P,z(j(r(v))),{"menu-left":o(()=>[n(E,{type:"primary",icon:"el-icon-plus",onClick:I[0]||(I[0]=g=>e("add"))},{default:o(()=>[C(" 新增 ")]),_:1})]),"menu-btn":o(({row:g})=>[n(x,{icon:"el-icon-view",onClick:$=>e("view",g)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-edit",onClick:$=>e("edit",g)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-delete",onClick:$=>b(g)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-video-play",onClick:$=>O(g)},{default:o(()=>[C(" 调试 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-upload",onClick:$=>y(g)},{default:o(()=>[C(" 发布 ")]),_:2},1032,["onClick"]),n(x,{icon:"el-icon-switch",onClick:$=>e("version",g)},{default:o(()=>[C(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:g})=>[n(r(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:g})=>[n(S,{modelValue:g.sort,"onUpdate:modelValue":$=>g.sort=$,"controls-position":"right",style:{width:"100%"},onChange:$=>r(c)(g)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),xe=M({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(u,{emit:e}){const i=u,{request:t}=L(),{getList:l,update:a,remove:s}=pe(t),{bindVal:m,crudStateRefs:{searchForm:v,tableData:d},getDataList:w}=R({tableOption:Re,crudOption:{getList:l,dataPath:"res.data"},sortOption:{descs:"version"}});re(()=>{v.value.flowModuleId=i.flowModuleId}),le(v,w,{debounce:300,immediate:!0,deep:!0});const V=T(!1);async function y(F){await Q.confirm(`确定将 ${F.flowName}(${F.flowKey}:v${F.version}) 设为主版本?`,"提示",{type:"warning"}),V.value=!0,a({flowDeployId:F.flowDeployId,flowModuleId:F.flowModuleId,mainVersion:1}).then(()=>{B.success("设置成功"),w()}).finally(()=>{V.value=!1})}async function b(F){const{value:O}=await Q.prompt("请输入确认删除的流程标识","提示",{type:"warning"});O===F.flowKey&&(await s(F.flowDeployId),B.success("删除成功"),w())}const{open:p,close:c}=ne();function f(){var O;const F=(O=d.value[0])==null?void 0:O.flowKey;F&&p({flowKey:F,debug:!0,onComplete(){c(),B.success("操作成功")}})}return(F,O)=>{const k=_("el-button"),I=_("el-tooltip"),E=_("el-dropdown-item"),x=_("avue-crud");return D(),h(x,z(j(r(m))),{"menu-left":o(()=>[n(k,{loading:V.value,type:"primary",icon:"el-icon-arrow-left",onClick:O[0]||(O[0]=S=>e("back"))},{default:o(()=>[C(" 返回 ")]),_:1},8,["loading"])]),"menu-right":o(()=>[n(I,{content:"调试"},{default:o(()=>[n(k,{icon:"el-icon-video-play",circle:"",onClick:f})]),_:1})]),"menu-btn":o(({row:S})=>[n(E,{icon:"el-icon-view",onClick:P=>e("view",S)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),n(E,{icon:"el-icon-edit",onClick:P=>e("edit",S)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),n(E,{icon:"el-icon-delete",onClick:P=>b(S)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),n(E,{icon:"el-icon-switch",disabled:S.mainVersion===r(Ce).是,onClick:P=>y(S)},{default:o(()=>[C(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:S})=>[n(r(Z),{icon:S.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),we={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},Ft=M({__name:"index",emits:["node-click"],setup(u,{emit:e}){const{request:i}=L(),{crudStateRefs:{formData:t,tableData:l},getDataList:a,handleSave:s,handleUpdate:m,handleDel:v}=R({crudOption:{rowKey:"id",...Ve(i),dataPath:"res.data"},sortOption:{ascs:"sort"},tableOption:we,pageOption:{pageSize:20}});a();function d(y,b,p,c){s(b,p,c)}function w(y,b,p,c){m(b,Number.NaN,p,c)}async function V(y,b){await v(y.data,Number.NaN),b()}return(y,b)=>{const p=_("avue-tree");return D(),h(p,{modelValue:r(t),"onUpdate:modelValue":b[0]||(b[0]=c=>Y(t)?t.value=c:null),option:r(we),data:r(l),onNodeClick:b[1]||(b[1]=c=>e("node-click",c)),onSave:d,onUpdate:w,onDel:V},null,8,["modelValue","option","data"])}}}),me=M({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(u,{emit:e}){var v;const i=u,{FormDesign:t}=L(),l=J({get(){return i.modelValue?ut(i.modelValue):{menuBtn:!1,span:24}},set(d){e("update:modelValue",rt(d,{useJson5:!1}))}}),a=J(()=>i.fields?JSON.parse(i.fields):[]),s=J(()=>{const d={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return w=>{const V=_t(w);return[{...d,props:{label:"name",value:"name",desc:"comment"}},{...d,props:{label:"comment",value:"comment",desc:"name"}},...Array.from({length:((V==null?void 0:V.length)??0)-2}).fill({}).concat({label:"样式类",prop:"class"})]}}),m={form:{settings:Array.from({length:((v=vt.settings)==null?void 0:v.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(d,w)=>{const V=_("avue-form");return d.view?(D(),h(V,{key:0,class:et(l.value.class),"model-value":{},option:l.value},null,8,["class","option"])):(D(),h(r(t),{key:1,modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),"base-option":s.value,resources:m},null,8,["modelValue","base-option"]))}}}),Vt={key:1},Ct=M({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(u){const e=u,{formData:i,activeStep:t}=ce(e),{request:l}=L(),{getDetail:a,useList:s}=ae(l),{data:m}=Oe(l).useList(),{data:v}=he(l).useList(),{data:d}=s(),w=J(()=>{var y,b,p,c;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((y=m.value)==null?void 0:y.map(f=>({label:f.formName,value:f.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((b=d.value)==null?void 0:b.map(f=>({label:f.flowName,value:f.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((p=v.value)==null?void 0:p.map(f=>({label:f.flowName,value:f.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((c=d.value)==null?void 0:c.map(f=>({label:f.flowName,value:f.flowModuleId,type:"definition"})))??[]]:[]});async function V(y){if((t==null?void 0:t.value)===1){if(y.type==="template")i.value.formOption=y.value;else if(y.type==="definition"){const b=await a({flowModuleId:y.value});i.value.formOption=b.data.formOption}}else if((t==null?void 0:t.value)===2){if(y.type==="template")i.value.flowData=y.value;else if(y.type==="definition"){const b=await a({flowModuleId:y.value});i.value.flowData=b.data.flowData}}}return(y,b)=>{const p=_("el-link"),c=_("el-divider"),f=_("el-dropdown-item"),F=_("el-scrollbar"),O=_("el-dropdown-menu"),k=_("el-dropdown");return w.value.length?(D(),h(k,{key:0},{dropdown:o(()=>[n(O,null,{default:o(()=>[n(F,{"max-height":"600px"},{default:o(()=>[(D(!0),A(G,null,te(w.value,I=>(D(),h(f,ge({key:I.label},I,{disabled:I.type==="divider",onClick:E=>V(I)}),{default:o(()=>[I.type==="divider"?(D(),h(c,{key:0},{default:o(()=>[C(K(I.label),1)]),_:2},1024)):(D(),A("span",Vt,K(I.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[n(p,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[C(" 选择模板 ")]),_:1})]),_:1})):N("",!0)}}}),ht=H("span",null,"流程设计",-1),Ot={key:0},$t={key:1},It={style:{height:"calc(100vh - 144px)"}},xt=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(u,{emit:e}){const t=ce(u),{visible:l,modelValue:a}=t,{request:s}=L(),{create:m,deploy:v,getDetail:d,update:w}=ae(s),{getDetail:V,update:y}=pe(s),b=["流程信息","表单设计","模型设计","完成"],p=T(),c=T(),f=T(!1);be(()=>[l.value,p.value],async()=>{var $;if(!l.value||!p.value)return;const{flowModuleId:P}=a.value,{flowDeployId:g}=a.value;try{f.value=!0;let W={};g?W=await V({flowDeployId:g}):P&&(W=await d({flowModuleId:P})),a.value=W.data,($=c.value)!=null&&$.sort&&(c.value.sort.display=!a.value.flowDeployId)}finally{f.value=!1}},{immediate:!0});const{data:F}=ie(s).useList(),O=J(()=>{var P,g;return(g=(P=F.value)==null?void 0:P.find($=>$.tableName===a.value.formDataTable))==null?void 0:g.tableFields}),k=T(0);async function I(P){k.value===0&&await je(p),f.value=!0;const{flowModuleId:g}=a.value,{flowDeployId:$}=a.value;try{$?await y(a.value):g?await w(a.value):await m(a.value).then(W=>{a.value.flowModuleId=W.data.flowModuleId}),B.success("保存成功")}finally{f.value=!1}typeof P=="number"?k.value=P:k.value++}async function E(){await Q.confirm("发布新版本，是否确认？","提示"),f.value=!0,v({flowModuleId:a.value.flowModuleId}).then(()=>{B.success("发布成功")}).finally(()=>{f.value=!1})}function x(){l.value=!1,k.value=0,a.value={},e("close")}async function S(){await Q.confirm("流程定义的数据(包括流程信息、表单设计、流程设计)将被修改为当前版本的数据，是否确认？","提示"),await w(a.value),B.success("同步成功")}return(P,g)=>{const $=_("el-col"),W=_("el-step"),Te=_("el-steps"),X=_("el-button"),Le=_("el-row"),Pe=_("avue-form"),Ne=_("el-result"),Ue=_("el-dialog"),Me=ke("loading");return D(),h(Ue,{modelValue:r(l),"onUpdate:modelValue":g[7]||(g[7]=U=>Y(l)?l.value=U:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:x},{header:o(()=>[n(Le,{justify:"center"},{default:o(()=>[n($,{span:5},{default:o(()=>{var U,q,se,fe;return[H("div",null,[ht,(U=r(a))!=null&&U.flowName?(D(),A("span",Ot," - "+K((q=r(a))==null?void 0:q.flowName),1)):N("",!0),(se=r(a))!=null&&se.version?(D(),A("span",$t," - V"+K((fe=r(a))==null?void 0:fe.version),1)):N("",!0)]),n(Ct,{"form-data":r(a),"onUpdate:formData":g[0]||(g[0]=Se=>Y(a)?a.value=Se:null),"active-step":k.value},null,8,["form-data","active-step"])]}),_:1}),n($,{span:14},{default:o(()=>[n(Te,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(D(),A(G,null,te(b,(U,q)=>n(W,{key:q,title:U,style:{cursor:"pointer"},onClick:se=>I(q)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),n($,{span:5,style:{"text-align":"right"}},{default:o(()=>[n(X,{disabled:k.value===0,loading:f.value,type:"primary",onClick:g[1]||(g[1]=U=>k.value--)},{default:o(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),n(X,{disabled:k.value===b.length-1,type:"primary",loading:f.value,onClick:g[2]||(g[2]=U=>I())},{default:o(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),n(X,{onClick:x},{default:o(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[De((D(),A("div",It,[k.value===0?(D(),h(Pe,{key:0,ref_key:"formRef",ref:p,modelValue:r(a),"onUpdate:modelValue":g[3]||(g[3]=U=>Y(a)?a.value=U:null),defaults:c.value,"onUpdate:defaults":g[4]||(g[4]=U=>c.value=U),option:r(ze),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","defaults","option"])):N("",!0),k.value===1?(D(),h(me,{key:1,modelValue:r(a).formOption,"onUpdate:modelValue":g[5]||(g[5]=U=>r(a).formOption=U),fields:O.value},null,8,["modelValue","fields"])):N("",!0),k.value===2?(D(),h(ue,{key:2,modelValue:r(a).flowData,"onUpdate:modelValue":g[6]||(g[6]=U=>r(a).flowData=U),"flow-form-option":r(a).formOption},null,8,["modelValue","flow-form-option"])):N("",!0),k.value===3?(D(),h(Ne,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[r(a).flowDeployId?(D(),h(X,{key:0,type:"primary",onClick:S},{default:o(()=>[C(" 同步到流程定义 ")]),_:1})):N("",!0),r(a).flowDeployId?N("",!0):(D(),h(X,{key:1,type:"primary",onClick:E},{default:o(()=>[C(" 发布 ")]),_:1})),n(X,{onClick:x},{default:o(()=>[C(" 关闭 ")]),_:1})]),_:1})):N("",!0)])),[[Me,f.value]])]),_:1},8,["modelValue"])}}}),Tt=H("span",null,"流程查看",-1),Lt={key:0},Pt={key:1},Nt=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(u){const i=ce(u),{visible:t,modelValue:l}=i,{request:a}=L(),{getDetail:s}=ae(a),{getDetail:m}=pe(a),v=T("form"),d=T(!1);be(t,async V=>{if(!V)return;const{flowModuleId:y}=l.value,{flowDeployId:b}=l.value;try{d.value=!0;let p={};b?p=await m({flowDeployId:b}):y&&(p=await s({flowModuleId:y})),l.value={...p.data}}finally{d.value=!1}},{immediate:!0});function w(){l.value={},v.value="form"}return(V,y)=>{const b=_("el-tab-pane"),p=_("el-tabs"),c=_("el-dialog"),f=ke("loading");return D(),h(c,{modelValue:r(t),"onUpdate:modelValue":y[3]||(y[3]=F=>Y(t)?t.value=F:null),width:"60%",top:"0",onClose:w},{header:o(()=>{var F,O,k,I;return[Tt,(F=r(l))!=null&&F.flowName?(D(),A("span",Lt," - "+K((O=r(l))==null?void 0:O.flowName),1)):N("",!0),(k=r(l))!=null&&k.version?(D(),A("span",Pt," - V"+K((I=r(l))==null?void 0:I.version),1)):N("",!0)]}),default:o(()=>[De((D(),h(p,{modelValue:v.value,"onUpdate:modelValue":y[2]||(y[2]=F=>v.value=F)},{default:o(()=>[n(b,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[v.value==="form"&&r(l).formOption?(D(),h(me,{key:0,modelValue:r(l).formOption,"onUpdate:modelValue":y[0]||(y[0]=F=>r(l).formOption=F),view:""},null,8,["modelValue"])):N("",!0)]),_:1}),n(b,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[v.value==="flow"?(D(),h(ue,{key:0,modelValue:r(l).flowData,"onUpdate:modelValue":y[1]||(y[1]=F=>r(l).flowData=F),view:""},null,8,["modelValue"])):N("",!0)]),_:1})]),_:1},8,["modelValue"])),[[f,d.value]])]),_:1},8,["modelValue"])}}}),Ut=M({__name:"index",setup(u){const e=T("definition"),i=T({}),t=T(""),l=T("");function a(p){t.value===p.id?t.value="":t.value=p.id}const s=T(!1),m=T(!1);function v(){i.value={},s.value=!0}function d(p){i.value=p,s.value=!0}function w(p){i.value=p,m.value=!0}function V(p){l.value=p.flowModuleId||"",e.value="deploy"}function y(){l.value="",e.value="definition"}async function b(){const p=e.value;await _e(),e.value="",await _e(),e.value=`${p}`}return(p,c)=>{const f=_("el-card"),F=_("el-col"),O=_("el-row");return D(),h(O,{gutter:20},{default:o(()=>[n(F,{span:6},{default:o(()=>[n(f,{header:"流程分类",style:{height:"100%"}},{default:o(()=>[n(Ft,{onNodeClick:a})]),_:1})]),_:1}),n(F,{span:18},{default:o(()=>[e.value==="definition"?(D(),h(Ie,{key:0,"category-id":t.value,onAdd:v,onEdit:d,onView:w,onVersion:V},null,8,["category-id"])):N("",!0),e.value==="deploy"&&l.value?(D(),h(xe,{key:1,"flow-module-id":l.value,onEdit:d,onView:w,onBack:y},null,8,["flow-module-id"])):N("",!0),n(xt,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=k=>i.value=k),visible:s.value,"onUpdate:visible":c[1]||(c[1]=k=>s.value=k),onClose:b},null,8,["modelValue","visible"]),n(Nt,{modelValue:i.value,"onUpdate:modelValue":c[2]||(c[2]=k=>i.value=k),visible:m.value,"onUpdate:visible":c[3]||(c[3]=k=>m.value=k)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Mt=M({__name:"index",setup(u){const e=pt("debugMode",!1),{request:i}=L(),{getTaskOpsList:t}=gt(i),{bindVal:l,getDataList:a,crudStateRefs:{searchForm:s}}=R({tableOption:We,crudOption:{getList:t},searchForm:{status:ee.待办},sortOption:{descs:"start_time"}});le(s,a,{debounce:300,immediate:!0,deep:!0});const{open:m,close:v}=ne();function d(w){m({flowKey:w.flowKey,taskId:w.taskId,instanceId:w.flowInstanceId,debug:e.value,onComplete(){v(),B.success("操作成功"),a()}})}return(w,V)=>{const y=_("el-switch"),b=_("el-button"),p=_("el-link"),c=_("avue-crud");return D(),h(c,z(j(r(l))),{"menu-right":o(()=>[n(b,{type:"text"},{default:o(()=>[n(y,{modelValue:r(e),"onUpdate:modelValue":V[0]||(V[0]=f=>Y(e)?e.value=f:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:f})=>[n(p,{type:"primary",underline:!1,onClick:F=>d(f)},{default:o(()=>[C(K(f.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),St=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,getDataList:t}=R({tableOption:Je,crudOption:ye(e)});return t(),(l,a)=>{const s=_("avue-crud");return D(),h(s,z(j(r(i))),null,16)}}}),At={class:"flow-list"},Bt=["onClick"],Et={class:"flow-name"},Kt=M({__name:"index",setup(u){const{request:e}=L(),{useList:i}=Ve(e),{usePublishList:t,getTaskList:l}=Ge(e),{data:a}=i(),{data:s}=t(),m=J(()=>{var c;return(c=a.value)==null?void 0:c.map(f=>{var O;const F=((O=s.value)==null?void 0:O.filter(k=>k.categoryId===f.id))??[];return{...f,list:F}}).filter(f=>{var F;return(F=f.list)==null?void 0:F.length})}),v=wt(ee).filter((c,f)=>f<2).reverse(),{bindVal:d,getDataList:w,crudStateRefs:{searchForm:V}}=R({tableOption:He,crudOption:{getList:l},searchForm:{status:ee.待办}});le(V,w,{debounce:300,immediate:!0,deep:!0});const{open:y,close:b}=ne();function p(c){y({flowKey:c.flowKey,taskId:c.taskId,instanceId:c.flowInstanceId,detail:c.taskId?c.status===ee.已办:!1,onComplete(){b(),B.success("操作成功"),w()}})}return(c,f)=>{const F=_("el-button"),O=_("el-divider"),k=_("el-collapse-item"),I=_("el-collapse"),E=_("el-card"),x=_("avue-radio"),S=_("el-link"),P=_("avue-crud");return D(),A(G,null,[n(E,{"body-style":{padding:"0 20px"}},{default:o(()=>[n(I,{"model-value":"1"},{default:o(()=>[n(k,{name:"1"},{title:o(()=>[n(F,{text:"",icon:"el-icon-promotion"},{default:o(()=>[C(" 发起审批 ")]),_:1})]),default:o(()=>[H("div",At,[(D(!0),A(G,null,te(m.value,g=>(D(),A("div",{key:g.id,class:"flow-category"},[n(O,{"content-position":"left"},{default:o(()=>[C(K(g.name),1)]),_:2},1024),(D(!0),A(G,null,te(g.list,$=>(D(),A("div",{key:$.flowKey,class:"flow-item",onClick:W=>p($)},[n(r(Z),{class:"flow-icon",icon:$.flowIcon,width:"60"},null,8,["icon"]),H("div",Et,K($.flowName),1)],8,Bt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),n(O),n(P,z(j(r(d))),{"menu-left":o(()=>[n(x,{modelValue:r(V).status,"onUpdate:modelValue":f[0]||(f[0]=g=>r(V).status=g),button:"",dic:r(v)},null,8,["modelValue","dic"])]),processTitle:o(({row:g})=>[n(S,{type:"primary",underline:!1,onClick:$=>p(g)},{default:o(()=>[C(K(g.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Rt=tt(Kt,[["__scopeId","data-v-5341e962"]]),zt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:t},getDataList:l,handleUpdate:a}=R({tableOption:Qe,crudOption:he(e)});l();const s=T(!1);async function m(d){t.value=d,s.value=!0}async function v(){await a(t.value,Number.NaN,()=>s.value=!1,()=>{})}return(d,w)=>{const V=_("el-button"),y=_("avue-crud"),b=_("el-dialog");return D(),A(G,null,[n(y,z(j(r(i))),{menu:o(({row:p})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:c=>m(p)},{default:o(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(b,{modelValue:s.value,"onUpdate:modelValue":w[2]||(w[2]=p=>s.value=p),title:`模型设计-${r(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(V,{type:"primary",onClick:v},{default:o(()=>[C(" 保存 ")]),_:1}),n(V,{onClick:w[1]||(w[1]=p=>s.value=!1)},{default:o(()=>[C(" 取消 ")]),_:1})]),default:o(()=>[n(ue,{modelValue:r(t).flowData,"onUpdate:modelValue":w[0]||(w[0]=p=>r(t).flowData=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),jt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:t},getDataList:l,handleUpdate:a}=R({tableOption:Xe,crudOption:Oe(e)});l();const s=T(!1);async function m(d){t.value={...d},s.value=!0}async function v(){await a(t.value,Number.NaN,()=>s.value=!1,()=>{})}return(d,w)=>{const V=_("el-button"),y=_("avue-crud"),b=_("el-dialog");return D(),A(G,null,[n(y,z(j(r(i))),{menu:o(({row:p})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:c=>m(p)},{default:o(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(b,{modelValue:s.value,"onUpdate:modelValue":w[2]||(w[2]=p=>s.value=p),title:`表单设计-${r(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(V,{type:"primary",onClick:v},{default:o(()=>[C(" 保存 ")]),_:1}),n(V,{onClick:w[1]||(w[1]=p=>s.value=!1)},{default:o(()=>[C(" 取消 ")]),_:1})]),default:o(()=>[n(me,{modelValue:r(t).formOption,"onUpdate:modelValue":w[0]||(w[0]=p=>r(t).formOption=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Wt=H("br",null,null,-1),Jt=M({__name:"index",setup(u){const{request:e}=L(),{bindVal:i,crudStateRefs:{formData:t,defaults:l},getDataList:a,afterOpen:s,beforeSubmit:m}=R({crudOption:ie(e),tableOption:Ye});a();const{data:v}=ye(e).useParam("table.default.fields");s(c=>{if(t.value.defaultFields=v.value??[],c==="edit"){const f=JSON.parse(t.value.tableFields);t.value.editFields=yt(f,v.value??[],"name")}}),m(c=>{const f=[...c.defaultFields,...c.editFields];c.tableFields=JSON.stringify(f)});const d=T(!1);re(()=>{var c;(c=l.value)!=null&&c.defaultFields&&(l.value.defaultFields.display=d.value)});const{deploy:w,getFields:V}=ie(e),y=T(!1);async function b(c){await Q.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),y.value=!0,w({id:c.id}).then(()=>{B.success("部署成功"),a()}).finally(()=>{y.value=!1})}function p(){V({tableName:t.value.tableName}).then(c=>{var f;if(!((f=c.data)!=null&&f.length))return B.warning("未找到该表");t.value.editFields=c.data})}return(c,f)=>{const F=_("el-button"),O=_("el-input"),k=_("el-switch"),I=_("el-tooltip"),E=_("avue-crud");return D(),h(E,z(j(r(i))),{menu:o(({row:x})=>[n(F,{type:"text",icon:"el-icon-upload",onClick:S=>b(x)},{default:o(()=>[C(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[n(O,{modelValue:r(t).tableName,"onUpdate:modelValue":f[0]||(f[0]=x=>r(t).tableName=x),placeholder:"请输入 表名"},{append:o(()=>[n(F,{type:"primary",size:"default",onClick:p},{default:o(()=>[C(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[H("div",null,[C(" 数据库字段 "),Wt,n(I,{content:"显示默认字段"},{default:o(()=>[n(k,{modelValue:d.value,"onUpdate:modelValue":f[1]||(f[1]=x=>d.value=x)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Gt=M({__name:"index",setup(u){const e=mt(),i=T({}),{FlowForm:t}=L(),l=J(()=>{const s=i.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${s==null?void 0:s.title}`:e.instanceId||e.taskId?`办理流程：${s==null?void 0:s.title}`:`发起流程：${s==null?void 0:s.title}`});ft(l);async function a(s){window.postMessage({event:"onComplete",data:{...s}})}return(s,m)=>(D(),h(r(t),ge({flowDetail:i.value,"onUpdate:flowDetail":m[0]||(m[0]=v=>i.value=v)},r(e),{onComplete:a}),null,16,["flowDetail"]))}}),Ht=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:Dt,PageFlowDefinition:Ie,PageFlowDeploy:xe,PageFlowForm:Gt,PageFlowManage:Ut,PageFlowOps:Mt,PageFlowParam:St,PageFlowTemplate:zt,PageFlowWorkbench:Rt,PageFormTemplate:jt,PageTableTemplate:Jt},Symbol.toStringTag,{value:"Module"})),Jo={install(u,e){L(e),Object.entries(Ht).forEach(([i,t])=>{u.component(i,t)})}};export{Qo as ApprovalForm,Xo as ButtonList,Ae as CONFIG_DEFAULT,Yo as FieldType,Zo as FlowButtonApproval,qo as FlowButtonDisplay,el as FlowButtonKey,tl as FlowButtonStatus,ol as FlowButtonType,ll as FlowForm,al as FlowStatus,nl as HandleType,sl as InternalForm,Ce as IsMainVersion,Dt as PageFlowButton,Ie as PageFlowDefinition,xe as PageFlowDeploy,Gt as PageFlowForm,Ut as PageFlowManage,Mt as PageFlowOps,St as PageFlowParam,zt as PageFlowTemplate,Rt as PageFlowWorkbench,jt as PageFormTemplate,Jt as PageTableTemplate,il as TablePrimary,ee as TaskStatus,ul as UploadTable,rl as Whether,je as asyncValidate,Jo as default,dl as defineTableOption,cl as fieldTypeDic,pl as flowFormEmits,ml as flowFormProps,fl as flowTrack,vl as injectionKey,_l as isMobile,wl as mergeColumn,yl as tablePrimaryDic,gl as useButtonHandler,bl as useCommonCommentApi,L as useConfigProvider,kl as useEmitter,Ee as useFlowButtonApi,Ve as useFlowCategoryApi,ae as useFlowDefinitionApi,pe as useFlowDeployApi,Dl as useFlowFileApi,ne as useFlowForm,kt as useFlowFormOverlay,bt as useFlowFormWindow,gt as useFlowOpsApi,ye as useFlowParamApi,Ge as useFlowTaskApi,he as useFlowTemplateApi,Fl as useFlowUserApi,Vl as useFormDefaults,Oe as useFormTemplateApi,Cl as useInjectState,hl as useProvideState,ie as useTableTemplateApi,Ol as whetherDic};
