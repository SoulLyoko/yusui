import{bQ as le,dB as Ee,dC as de,dD as It,dE as oe,bc as ge,dF as Nt,d4 as Ot,d6 as Lt,cw as $t,a5 as St,by as Ut,bR as De}from"../composables_use-crud_index.md.79b7ceb4.js";import{L as Pt,M as ie,s as Et,N as Rt,O as Ft}from"../app.cb4d5dc7.js";import{U as Ke,A as Ce,r as $,s as Le,d as R,e as ue,w as _e,a6 as ee,u as b,n as pe,V as At,h as j,b as st,ar as Re,G as k,i as O,C as P,D as f,I as w,m as E,p as W,a0 as lt,aK as Be,a2 as je,B as Z,E as Q,j as B,N as fe,F as X,J as Mt,_ as ze,av as ne,aw as re,k as Kt,b2 as Bt,au as jt,aN as zt,l as qt}from"./framework.22a77fa2.js";import{M as it,f as Wt,t as Fe,L as Qt,u as Ht}from"./vuedraggable.umd.ddd2ac8d.js";import"./mysqlWorkbench.1d6fa6a0.js";import{d as Gt}from"./data.4cb21f02.js";import{a as Jt}from"../flow-design_flow-modeler_index.md.434060ac.js";import{u as ye,a as Yt,c as Xt}from"./theme.1d56182c.js";import"../components_icon-select_index.md.dc997862.js";import"../components_index.md.16cda016.js";import"../components_v-text_index.md.306fe565.js";import"../composables_index.md.1bb90be4.js";import"../flow-design_flow-viewer_index.md.e9fcc2c5.js";import"../flow-design_index.md.e062cae5.js";import"../flow-pages_index.md.aa7061af.js";import"../flow-pages_pages_flow-button_index.md.2cf37f1f.js";import"../flow-pages_pages_flow-manage_index.md.3b729385.js";import"../flow-pages_pages_flow-ops_index.md.1351e2c2.js";import"../flow-pages_pages_flow-param_index.md.907e6ed8.js";import"../flow-pages_pages_flow-template_index.md.743ad38c.js";import"../flow-pages_pages_flow-workbench_index.md.e559c6b1.js";import"../flow-pages_pages_form-template_index.md.754d7c10.js";import"../flow-pages_pages_table-template_index.md.f196419b.js";import"../form-design_demo.md.f7fa8b02.js";import"../form-design_index.md.f8d915c9.js";import"../guide_changelog.md.71ace3ef.js";import"../guide_start.md.f25ec09d.js";import"../index.md.dedad964.js";import"../plugins_avue-patch_index.md.390faa69.js";import"../plugins_env-dts_index.md.77e8f459.js";import"../plugins_index.md.09238556.js";import"../plugins_load-proxy_index.md.94b7863d.js";import"../plugins_setup-extend_index.md.1aa92da1.js";import"../plugins_uni-ui-patch_index.md.4b8e1986.js";import"../plugins_uview-patch_index.md.e375633d.js";import"../types_avue_index.md.31e36571.js";import"../types_index.md.aa1779e7.js";import"../utils_date_dateFormat.md.24466ffd.js";import"../utils_date_durationFormat.md.a91e1175.js";import"../utils_emitter_mittAsync.md.65520a0e.js";import"../utils_index.md.99824380.js";import"../utils_math_index.md.81fb7150.js";import"../utils_object_filterObj.md.d634698f.js";import"../utils_object_filterObjDeep.md.aee85325.js";import"../utils_object_getDataType.md.4c16fa33.js";import"../utils_string_deserialize.md.49b88e4f.js";import"../utils_string_serialize.md.175ca994.js";import"../utils_string_uuid.md.1b6743be.js";import"../utils_tool_awaitTo.md.907e2bd0.js";import"../utils_tool_enumToDic.md.f0182e11.js";import"../utils_tool_sleep.md.15440607.js";import"../utils_tree_buildTree.md.b95211e7.js";import"../utils_tree_filterTree.md.753c4098.js";import"../utils_tree_findTree.md.30184861.js";import"../utils_tree_flatTree.md.cb52189f.js";import"../utils_tree_treeMap.md.168ca5df.js";import"./vue.runtime.esm-bundler.9ab4c990.js";const Zt={},eo=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),to=()=>Zt,oo=e=>Array.isArray(e),qe=e=>e!==null&&typeof e=="object",ut=e=>e instanceof Function,be=e=>e==null,We=typeof window>"u",ct=()=>{var e;return We||be((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},lo=()=>{var e,t;return(e=!We&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},$e=()=>new Promise(()=>{}),ae=e=>ee(e)?e.value:e,ao=e=>qe(e)?Object.assign(oo(e)?[]:{},e):e,he=new Map,no=e=>be(e)?void 0:he.get(e),ro=(e,t,o)=>{const i=he.get(e);i!=null&&i.timer&&clearTimeout(i.timer);const r=setTimeout(()=>he.delete(e),t);he.set(e,{...o,timer:r})},ce=e=>e;function dt(e,t,o){let i,r,a,u,l,n,s=0,c=!1,v=!1,_=!0;const d=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,qe(o)&&(c=!!o.leading,v="maxWait"in o,a=v?Math.max(+o.maxWait||0,t):a,_="trailing"in o?!!o.trailing:_);function m(V){const L=i,N=r;return i=r=void 0,s=V,u=e.apply(N,L),u}function h(V,L){return d?(window.cancelAnimationFrame(l),window.requestAnimationFrame(V)):setTimeout(V,L)}function g(V){if(d)return window.cancelAnimationFrame(V);clearTimeout(V)}function x(V){return s=V,l=h(p,t),c?m(V):u}function y(V){const L=V-n,N=V-s,F=t-L;return v?Math.min(F,a-N):F}function I(V){const L=V-n,N=V-s;return n===void 0||L>=t||L<0||v&&N>=a}function p(){const V=Date.now();if(I(V))return D(V);l=h(p,y(V))}function D(V){return l=void 0,_&&i?m(V):(i=r=void 0,u)}function C(){l!==void 0&&g(l),s=0,i=n=r=l=void 0}function T(){return l===void 0?u:D(Date.now())}function S(){return l!==void 0}function U(...V){const L=Date.now(),N=I(L);if(i=V,r=this,n=L,N){if(l===void 0)return x(n);if(v)return l=h(p,t),m(n)}return l===void 0&&(l=h(p,t)),u}return U.cancel=C,U.flush=T,U.pending=S,U}function so(e,t,o){let i=!0,r=!0;if(typeof e!="function")throw new TypeError("Expected a function");return qe(o)&&(i="leading"in o?!!o.leading:i,r="trailing"in o?!!o.trailing:r),dt(e,t,{leading:i,trailing:r,maxWait:t})}var io=ce((e,{debounceInterval:t,debounceOptions:o,manual:i})=>{const r=$(!1),a=$(),u=R(()=>o),l=R(()=>ae(t)),n=$(e.context.runAsync);return i||(r.value=!0),ue(s=>{be(l.value)||(a.value=dt(c=>c(),l.value,u.value),e.context.runAsync=(...c)=>new Promise((v,_)=>{r.value?(r.value=!1,n.value(...c).then(v).catch(_)):a.value(()=>{n.value(...c).then(v).catch(_)})}),s(()=>{var c;(c=a.value)===null||c===void 0||c.cancel(),e.context.runAsync=n.value}))}),{onCancel(){var s;(s=a.value)===null||s===void 0||s.cancel()}}}),uo=ce((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const i=$(),r=$(0),a=R(()=>ae(t)),u=R(()=>ae(o));let l=!1;const n=()=>{r.value=0},s=R(()=>{if(u.value)return u.value;const _=1e3,d=1,m=9,h=Math.floor(Math.random()*2**Math.min(r.value,m)+d);return _*h}),c=()=>{let _;const d=a.value===-1,m=r.value<a.value;return(d||m)&&(d||(r.value+=1),_=setTimeout(()=>{l=!0,e.context.refresh()},s.value)),()=>_&&clearTimeout(_)},v=()=>{i.value&&i.value()};return{onBefore(){l||n(),l=!1,v()},onSuccess(){n()},onError(){i.value=c()},onCancel(){n(),v()}}}),co=ce((e,{ready:t=$(!0),manual:o,defaultParams:i=[]})=>(_e(t,r=>{!o&&r&&e.context.run(...i)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),po=ce((e,{refreshDeps:t=[],refreshDepsAction:o,manual:i})=>(t!=null&&t.length&&_e(t,()=>{o?o():!i&&e.context.refresh()}),{})),fo=ce((e,{throttleInterval:t,throttleOptions:o})=>{const i=$(),r=R(()=>ae(t)),a=R(()=>o),u=$(e.context.runAsync);return ue(l=>{if(be(t))return{};i.value=so(n=>n(),r.value,a.value),e.context.runAsync=(...n)=>new Promise((s,c)=>{i.value(()=>{u.value(...n).then(s).catch(c)})}),l(()=>{var n;(n=i.value)===null||n===void 0||n.cancel(),e.context.runAsync=u.value})}),{onCancel(){var l;(l=i.value)===null||l===void 0||l.cancel()}}});const mo=(e,t)=>o=>{Object.keys(o).forEach(i=>{e[i].value=o[i]}),t.forEach(i=>i(e))},vo=(e,t)=>()=>{let o=t;for(let i=e.length;i-- >0;)o=e[i](o);return o()},_o=(e,t,o)=>{var i,r;const{initialData:a,onSuccess:u,onError:l,onBefore:n,onAfter:s}=t,c=$((i=o==null?void 0:o.loading)!==null&&i!==void 0?i:!1),v=Le((r=o==null?void 0:o.data)!==null&&r!==void 0?r:a),_=Le(o==null?void 0:o.error),d=$(o==null?void 0:o.params),m=$([]),h=Le("pending"),g={},x=mo({status:h,loading:c,data:v,error:_,params:d},[]),y=(p,...D)=>{if(p==="onQuery"){const C=m.value.map(T=>T.onQuery).filter(Boolean);return{servicePromise:vo(C,D[0])()}}else{const C=m.value.map(T=>{var S;return(S=T[p])===null||S===void 0?void 0:S.call(T,...D)});return Object.assign({},...C)}},I=$(0);return g.runAsync=async(...p)=>{x({loading:!0,params:p,status:"pending"}),I.value+=1;const D=I.value,{isBreak:C,breakResult:T=$e()}=y("onBefore",p);if(C)return x({status:"settled"}),T;n==null||n(p);try{const S=()=>new Promise(L=>L(e(...d.value)));let{servicePromise:U}=y("onQuery",S);U||(U=S());const V=await U;return D!==I.value?$e():(x({data:V,loading:!1,error:void 0,status:"settled"}),y("onSuccess",V,p),u==null||u(V,p),y("onAfter",p,V,void 0),s==null||s(p),V)}catch(S){if(D!==I.value)return $e();throw x({loading:!1,error:S,status:"settled"}),y("onError",S,p),l==null||l(S,p),y("onAfter",p,void 0,S),s==null||s(p),S}},g.run=(...p)=>{g.runAsync(...p).catch(D=>{l||console.error(D)})},g.cancel=()=>{I.value+=1,x({loading:!1}),y("onCancel")},g.refresh=()=>{g.run(...d.value||[])},g.refreshAsync=()=>g.runAsync(...d.value||[]),g.mutate=p=>{const D=ut(p)?p(v.value):p,C=ao(D);x({data:C}),y("onMutate",C)},{status:h,loading:c,data:v,error:_,params:d,plugins:m,context:g}};function wo(e,t={},o){const i=Ke(eo,{}),r={...to(),...i,...t},{manual:a=!1,defaultParams:u=[]}=r,l=_o(e,r);if(l.plugins.value=o.map(n=>n(l,r)),!a){const n=l.params.value||u;l.context.run(...n)}return Ce(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ke=new Map,yo=(e,t)=>{ke.set(e,t),t.then(o=>(ke.delete(e),o)).catch(()=>{ke.delete(e)})},bo=e=>ke.get(e),ve=new Map,go=(e,t)=>{ve.has(e)&&ve.get(e).forEach(o=>o(t))},ho=(e,t)=>(ve.has(e)?ve.get(e).push(t):ve.set(e,[t]),()=>{const o=ve.get(e).indexOf(t);ve.get(e).splice(o,1)});var ko=ce((e,{cacheKey:t,cacheTime:o=6e5,staleTime:i=0,getCache:r,setCache:a})=>{if(!t)return{};const u=ut(t)?t:()=>t,l=$(()=>{});let n;const s=g=>r?r(g):no(g),c=(g,x,y)=>{a?a(g,y):ro(g,x,y),go(g,y.data)},v=g=>i===-1||g+i>new Date().getTime(),_=(g,x)=>Object.prototype.hasOwnProperty.call(g,x),d=g=>{const x=u(g);return ho(x,y=>{e.data.value=y})},m=u(),h=s(m);return h&&_(h,"data")&&(e.data.value=h.data,e.params.value=h.params),m&&(l.value=d()),Ce(()=>{l.value()}),{onBefore(g){const x=u(g),y=s(x);if(!y||!_(y,"data"))return{};if(v(y.time))return e.data.value=y.data,e.loading.value=!1,{isBreak:!0,breakResult:y.data};e.data.value=y.data},onQuery(g){const x=e.params.value,y=u(x);let I=bo(y);return I&&I!==n?()=>I:(I=g(),n=I,yo(y,I),()=>I)},onSuccess(g,x){const y=u(x);y&&(l.value(),c(y,o,{data:g,params:x,time:new Date().getTime()}),l.value=d(x))},onMutate(g){const x=u(e.params.value);x&&(l.value(),c(x,o,{data:g,params:e.params.value,time:new Date().getTime()}),l.value=d(e.params.value))}}});function Vo(e){let t,o;class i extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new i(r=>{o=r,t=setTimeout(o,e)})}function Se(){return new Date().getTime()}var Do=ce((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const i=$(()=>{}),r=R(()=>ae(t)),a=R(()=>ae(o));let u=0,l={};const n=()=>{let s;return r.value&&(s=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},r.value)),()=>s&&clearTimeout(s)};return{onBefore(){e.loading.value=!r.value,i.value(),i.value=n(),u=Se()},onQuery(s){if(!a.value)return()=>s();l=Vo(a.value+r.value);const c=async()=>{try{const _=await s();return Se()-u<=r.value&&l.cancel(),Promise.resolve(_)}catch(_){return Se()-u<=r.value&&l.cancel(),Promise.reject(_)}},v=Promise.allSettled([c(),l]).then(_=>{const d=_[0];return d.status==="fulfilled"?d.value:Promise.reject(d.reason)});return()=>v},onCancel(){i.value()},onAfter(){i.value()}}}),Ue;const pt=new Set,ft=new Set,mt=new Set,Ve=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=pt;break;case"RECONNECT_LISTENER":o=mt;break;case"VISIBLE_LISTENER":o=ft;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!We&&(Ue=window)!==null&&Ue!==void 0&&Ue.addEventListener&&(window.addEventListener("visibilitychange",()=>{ct()&&Pe(ft)},!1),window.addEventListener("focus",()=>Pe(pt),!1),window.addEventListener("online",()=>Pe(mt),!1));var Co=ce((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:i=!1,errorRetryCount:r=0})=>{const a=$(),u=$(!1),l=R(()=>ae(t)),n=R(()=>ae(r)),s=[],c=m=>{m&&s.push(m)},v=()=>(o||ct())&&(i||lo()),_=m=>{if(e.error.value&&n.value!==0)return;let h;if(!be(l.value)&&l.value>=0)if(v())h=setTimeout(m,l.value);else{u.value=!0;return}return()=>h&&clearTimeout(h)},d=()=>{u.value&&v()&&(e.context.refresh(),u.value=!1)};return _e(l,()=>{a.value&&(a.value(),a.value=_(()=>e.context.refresh()))}),o||c(Ve("VISIBLE_LISTENER",d)),i||c(Ve("RECONNECT_LISTENER",d)),Ce(()=>{s.forEach(m=>m())}),{onBefore(){var m;(m=a.value)===null||m===void 0||m.call(a)},onCancel(){var m;(m=a.value)===null||m===void 0||m.call(a)},onAfter(){a.value=_(()=>e.context.refresh())}}});const xo=(e,t)=>{let o=!1;return(...i)=>{o||(o=!0,e(...i),setTimeout(()=>{o=!1},t))}};var To=ce((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const i=R(()=>ae(t)),r=R(()=>ae(o)),a=[],u=n=>{n&&a.push(n)},l=()=>{a.forEach(n=>n())};return ue(()=>{if(l(),i.value){const n=xo(e.context.refresh,r.value);u(Ve("VISIBLE_LISTENER",n)),u(Ve("FOCUS_LISTENER",n))}}),Ce(()=>{l()}),{}});function we(e,t){return wo(e,t,[Do,uo,io,Co,fo,To,po,co,ko])}function xe(){const{request:e}=H(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:d=>e.get(t.detail,{params:d}),getApprovalNode:d=>e.post(t.approvalNode,d),startTask:d=>e.post(t.start,d),commitTask:d=>e.post(t.commit,d),saveDraft:d=>e.post(t.draft,d),revokeTask:d=>e.post(t.revoke,d),terminateTask:d=>e.post(t.terminate,d),withdrawTask:d=>e.post(t.withdraw,d),transferTask:d=>e.post(t.transfer,d),getPublishFlow:()=>e.get(t.publish),getTodoList:d=>e.get(t.todo,{params:d})}}function Io(e){const{commitTask:t,revokeTask:o,saveDraft:i,startTask:r,terminateTask:a,transferTask:u,withdrawTask:l}=xe(),n=R(()=>{const{flowDetail:c,formVariables:v,approvalFormData:_,debug:d,fileIds:m}=e,{flowDeployId:h}=c.value.process??{},{taskId:g,flowInstanceId:x}=c.value.task??{};return{flowDeployId:h,taskId:g,flowInstanceId:x,variables:v.value,debug:d.value,fileIds:m.value,..._.value}}),s=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(s())return i(n.value)},flow_pass(){return s()?t(n.value):r(n.value)},flow_revoke(){if(s())return o(n.value)},flow_withdraw(){if(s())return l(n.value)},flow_terminate(){if(s())return a(n.value)},flow_transfer(){if(s())return u(n.value)}}}function No(e){const t=$({});return ue(async()=>{var i;const{formProperty:o}=((i=b(e))==null?void 0:i.properties)||{};o!=null&&o.length&&(await pe(),Object.keys(t.value).forEach(r=>{var l,n,s,c;const a=((l=t.value[r])==null?void 0:l.label)||"",u=o==null?void 0:o.find(v=>v.prop===r);if(t.value[r].display=u==null?void 0:u.display,t.value[r].disabled=u==null?void 0:u.disabled,t.value[r].detail=u==null?void 0:u.detail,t.value[r].readonly=u==null?void 0:u.readonly,t.value[r].rules=t.value[r].rules??[],u!=null&&u.required&&((n=t.value[r].rules)!=null&&n.some(v=>v.required)))return null;u!=null&&u.required?(s=t.value[r].rules)==null||s.push({required:!0,message:`${a}为必填项`}):t.value[r].rules=(c=t.value[r].rules)==null?void 0:c.filter(v=>!v.required)}))}),t}function Oo(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Lo(){return{complete:e=>e}}const vt=Symbol("flowFormState");function $o(e,t){const o=ye(e,void 0,{passive:!0,deep:!0}),{flowDetail:i,modelValue:r,formLoading:a}=o,{getFlowDetail:u}=xe();ue(()=>{const{flowKey:m,taskId:h,instanceId:g}=e;!m&&!h&&!g||(a.value=!0,u({flowKey:m,taskId:h,flowInstanceId:g}).then(x=>{i.value=x.data,r.value=x.data.formData||{}}).finally(()=>{a.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),n=R(()=>{var m,h,g,x;return l.value.fileTab===!0&&((x=(g=(h=(m=i.value)==null?void 0:m.properties)==null?void 0:h.formProperty)==null?void 0:g.find(y=>y.prop==="fileTab"))==null?void 0:x.display)}),s=R(()=>{var m,h,g,x;return l.value.trackTab===!0&&((x=(g=(h=(m=i.value)==null?void 0:m.properties)==null?void 0:h.formProperty)==null?void 0:g.find(y=>y.prop==="trackTab"))==null?void 0:x.display)}),c=$(!1),v=R(()=>Object.entries(r.value||{}).filter(([m])=>!m.startsWith("$")).map(([m,h])=>({key:m,value:h}))),_=$(),d={...o,formData:r,formVariables:v,approvalVisible:c,showFileTab:n,showTrackTab:s,permission:l,fileIds:_,emit:t};return At(vt,d),d}function _t(){return Ke(vt)}function Qe(e){return new Promise((t,o)=>{b(e).validate((r,a,u)=>{r?(a(),t(u)):o(u)})})}const So=j({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=ye(e,void 0,{passive:!0,deep:!0}),o=No(e.flowDetail),{proxy:i}=st(),r=$({});ue(()=>{const{formOption:l}=e.flowDetail.process??{};r.value=it.bind(i)(l||'{"menuBtn":false}'),r.value.detail=!!e.detail});const a=$();function u(){return Qe(a)}return{form:t,option:r,defaults:o,formRef:a,validate:u}},render(){return Re(k("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Uo=j({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Yt(e,"modelValue"),{batchUpdate:i,create:r,remove:a,useList:u}=Zo(),l=$(!1),{activeBtn:n}=_t(),s=R(()=>{var I;return(I=n.value)==null?void 0:I.buttonKey}),{data:c,refresh:v}=u(s),_=R(()=>{var p,D,C;const I=o.value;if(I&&!((p=c.value)!=null&&p.some(T=>T.content===I))){const T=(((C=(D=c.value)==null?void 0:D[0])==null?void 0:C.sort)||1)-1;return[{content:I,sort:T},...c.value||[]]}return c.value});async function d(I){var p;await r({...I,type:(p=n.value)==null?void 0:p.buttonKey}),le.success("添加成功"),v()}async function m(I){await a(I.id),le.success("删除成功"),v()}async function h(I,p){let D=p.parent.data;D=D.map((C,T)=>({id:C.id,sort:T+1})),await i(D),le.success("修改排序成功"),v(),l.value=!1}function g(){l.value=!0}const x=$();async function y(I){var p;o.value=I.content,await pe(),(p=x.value)==null||p.blur()}return(I,p)=>{const D=k("el-input"),C=k("el-text"),T=k("el-col"),S=k("el-button"),U=k("el-row"),V=k("el-tree"),L=k("el-popover");return O(),P(L,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:f(()=>[w(D,{ref_key:"inputRef",ref:x,modelValue:b(o),"onUpdate:modelValue":p[0]||(p[0]=N=>ee(o)?o.value=N:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:p[1]||(p[1]=N=>l.value=!0),onBlur:p[2]||(p[2]=N=>l.value=!1)},null,8,["modelValue"])]),default:f(()=>[w(V,{data:_.value,"node-key":"content",draggable:"","allow-drop":(N,F,M)=>M!=="inner",props:{label:"content"},onNodeClick:y,onNodeDrop:h,onNodeDragStart:g},{default:f(({data:N})=>[w(U,{style:{width:"250px"}},{default:f(()=>[w(T,{span:20},{default:f(()=>[w(C,{truncated:"",title:N.content},{default:f(()=>[E(W(N.content),1)]),_:2},1032,["title"])]),_:2},1024),w(T,{span:4},{default:f(()=>[N.id?(O(),P(S,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:lt(F=>m(N),["stop"])},null,8,["onClick"])):(O(),P(S,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:lt(F=>d(N),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Po=j({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=xe(),i={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:r,approvalFormData:a,activeBtn:u,approvalVisible:l,formVariables:n,flowDetail:s}=_t(),c=$([]),v=$([]),_=$([]),d=$([]),m=$(),h=$({}),g={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:x}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function x(L,N,F){var z;const M=c.value[0].type==="ParallelGateway",K=(z=c.value[0].children)==null?void 0:z.every(te=>Wt([te],G=>v.value.some(J=>J.id===G.id)));if(v.value.length){if(M&&!K)return F("请在每个节点选择审批人")}else return F("请选择审批人");return!0}const y=$(),I=R(()=>{var L,N;return(N=(L=u.value)==null?void 0:L.approval)==null?void 0:N.includes("assignee")}),p=R(()=>{var L,N;return(N=(L=u.value)==null?void 0:L.approval)==null?void 0:N.includes("circulate")}),D=R(()=>{var L,N;return(N=(L=u.value)==null?void 0:L.approval)==null?void 0:N.includes("copyUser")}),C=$(!1),T=$(!1);ue(async()=>{var M,K,z,te,G;if(!l.value||!m.value)return;const{flowKey:L}=((M=s.value)==null?void 0:M.process)||{},{taskId:N}=((K=s.value)==null?void 0:K.task)||{};c.value=[],v.value=[],_.value=[],d.value=[];const F=N?"":"发起";if(a.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:r.value.comment||F},pe(()=>{var J,Y;h.value.assignee.display=I.value,h.value.circulate.display=p.value,h.value.copyUser.display=D.value,h.value.comment.display=(Y=(J=u.value)==null?void 0:J.approval)==null?void 0:Y.includes("comment")}),I.value)try{T.value=!0;const J=u.value.buttonKey!=="flow_transfer",Y=await o({flowKey:L,variables:n.value,taskId:N,loadConfig:J});c.value=Fe(Y.data??[],(se,tt,q)=>{const me=se.id||Ee();return se.taskNodeKey=(q==null?void 0:q.taskNodeKey)??se.taskNodeKey,se.incoming=(q==null?void 0:q.incoming)??se.incoming,{...se,id:me,disabled:se.type!=="user"}}),await pe();const A=S(c.value);A&&((z=y.value)==null||z.setCheckedNodes([A]))}finally{T.value=!1}if(D.value){const J=await o({flowKey:L,variables:n.value,taskId:N,loadConfig:!1});_.value=Fe(((G=(te=J.data)==null?void 0:te[0])==null?void 0:G.children)??[],Y=>{var A;return Y.id||Ee(),{...Y,label:Y.title,disabled:Y.type!=="user"&&!((A=Y.children)!=null&&A.length)}})}});function S(L){var N;if(L.length===1)return(N=L[0].children)!=null&&N.length?S(L[0].children):L[0]}async function U(L,N){var M,K;if(L.type!=="user")return;await pe(),await pe();const F=(M=y.value)==null?void 0:M.getCheckedNodes();v.value=F.filter(z=>z.type==="user"),(K=y.value)==null||K.setCheckedNodes(v.value)}async function V(){await Qe(m),C.value=!0;const L={},N={},F=new Set;v.value.forEach(M=>{const{taskNodeKey:K,incoming:z}=M;L[K]||(L[K]=new Set),M.userId&&L[K].add(M.userId),N[K]=[...L[K]].join(","),F.add(z)}),a.value.assignee=N,a.value.outgoing=[...F],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",r),t("confirm")}return(L,N)=>{const F=k("el-col"),M=k("el-tag"),K=k("el-tree-select"),z=k("avue-form"),te=k("el-row"),G=k("el-button"),J=k("el-dialog"),Y=Be("loading");return O(),P(J,{modelValue:b(l),"onUpdate:modelValue":N[6]||(N[6]=A=>ee(l)?l.value=A:null),title:b(u).name,width:I.value?"800px":"500px","append-to-body":""},{footer:f(()=>[w(G,{onClick:N[5]||(N[5]=A=>l.value=!1)},{default:f(()=>[E(" 取 消 ")]),_:1}),w(G,{type:"primary",onClick:V},{default:f(()=>[E(" 确 定 ")]),_:1})]),default:f(()=>[w(te,{gutter:20},{default:f(()=>[I.value?(O(),P(F,{key:0,span:10},{default:f(()=>[je((O(),P(b(Pt),{ref_key:"treeRef",ref:y,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:c.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:U},{default:f(({data:A})=>[Z("div",null,[w(b(ie),{icon:i[A.type],style:{display:"inline-block"}},null,8,["icon"]),Z("span",null,W(A.title),1)])]),_:1},8,["data"])),[[Y,T.value]])]),_:1})):Q("",!0),w(F,{span:I.value?14:24},{default:f(()=>[w(z,{ref_key:"formRef",ref:m,modelValue:b(a),"onUpdate:modelValue":N[3]||(N[3]=A=>ee(a)?a.value=A:null),defaults:h.value,"onUpdate:defaults":N[4]||(N[4]=A=>h.value=A),option:g},{assignee:f(()=>[(O(!0),B(X,null,fe(v.value,A=>(O(),P(M,{key:A.id,type:"info"},{default:f(()=>[E(W(A.title),1)]),_:2},1024))),128))]),copyUser:f(()=>[w(K,{modelValue:d.value,"onUpdate:modelValue":[N[0]||(N[0]=A=>d.value=A),N[1]||(N[1]=A=>b(a).copyUser=A.join(","))],data:_.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:f(()=>[w(Uo,{modelValue:b(a).comment,"onUpdate:modelValue":N[2]||(N[2]=A=>b(a).comment=A)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Eo=Jt,at=j({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:i}=ol(),r=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(s){t("update:modelValue",s.join(","))}}),a=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(s){t("update:modelValue",s)}}),u=$([]),l=$(!1),n=R(()=>{var s,c;return(c=(s=o.tableData)==null?void 0:s.row)==null?void 0:c.type});return _e(n,s=>{["dept","post","user"].includes(s)&&(l.value=!0,i(s==="user"?"":s).then(c=>{u.value=Fe(c.data,v=>({label:v.title,value:v.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(s,c)=>{const v=k("el-tree-select"),_=k("el-input");return["dept","post","user"].includes(n.value)?(O(),P(v,{key:0,modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=d=>r.value=d),data:u.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(O(),P(_,{key:1,modelValue:a.value,"onUpdate:modelValue":c[1]||(c[1]=d=>a.value=d)},null,8,["modelValue"]))}}}),Ro={key:0,class:"flow-viewer"},Fo={class:"flow-status-legend"},Ao=j({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{FlowViewer:i,FlowModeler:r}=H(),a=$({}),u=$({}),l=R({get(){let p=Gt();return typeof o.modelValue=="string"&&o.modelValue?p=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(p=o.modelValue),p},set(p){t("update:modelValue",JSON.stringify(p))}}),n=R(()=>{const{column:p=[],group:D=[]}=JSON.parse(o.flowFormOption||"{}");return[...p,...D.map(T=>T.column??[]).flat()]}),s=R(()=>n.value.map(D=>({label:D.label,value:`\${${D.prop}}`,desc:`\${${D.prop}}`}))),c=de(He),v=de(Ge),{data:_}=Je().useList();_e(u,p=>{var D,C,T,S,U,V,L,N,F,M,K;p&&(p.priority&&(p.priority.dicData=s.value),p.formTitle&&(p.formTitle.dicData=s.value),(T=(C=(D=p.assignee)==null?void 0:D.children)==null?void 0:C.column)!=null&&T[1]&&(p.assignee.children.column[1].component=at),(F=(N=(L=(V=(U=(S=p.circulate)==null?void 0:S.children)==null?void 0:U.column)==null?void 0:V[1])==null?void 0:L.children)==null?void 0:N.column)!=null&&F[1]&&(p.circulate.children.column[1].children.column[1].component=at),p.formProperty&&(a.value.formProperty=d(n.value,a.value.formProperty||[])),p.button&&((K=(M=p.button.children)==null?void 0:M.column)==null||K.forEach(z=>{z.prop==="display"&&(z.dicData=c),z.prop==="approval"&&(z.dicData=v)}),a.value.button=m(_.value||[],a.value.button||[])))});function d(p,D){return p.map(C=>{var te,G;const T=D.find(J=>J.prop===C.prop),{label:S,prop:U,display:V=!0,disabled:L=!1,detail:N=!1,readonly:F=!1,rules:M}=C,K=(M==null?void 0:M.some(J=>J.required))??!1,z={label:S,prop:U,display:V,disabled:L,detail:N,readonly:F,required:K,...T};return C.type==="dynamic"&&((G=(te=C.children)==null?void 0:te.column)!=null&&G.length)&&(z.children=d(C.children.column,(T==null?void 0:T.children)??[])),z})}function m(p,D){return p.filter(C=>C.status===1).map(C=>{const T=D.find(F=>F.buttonKey===C.buttonKey),{name:S,buttonKey:U,display:V,approval:L}=C;return{name:S,buttonKey:U,display:V,approval:L,...T}})}const{data:h}=Ie().useParam("flow.task.status"),g=R(()=>{var p;return(p=o.flowHistory)==null?void 0:p.map(D=>{var T,S;const C=(S=(T=h.value)==null?void 0:T.find(U=>U.value===D.status))==null?void 0:S.style;return{id:D.taskNodeKey,style:C}})}),x=R(()=>{var p,D;return(D=(p=o.flowHistory)==null?void 0:p.filter(C=>C.taskNodeType==="userTask"))==null?void 0:D.map(C=>{var T;return{id:C.taskNodeKey,content:`<div>${C.assigneeName}</div>
        <div>${C.endTime??""}</div>
        <div>${((T=C.comment)==null?void 0:T.comment)??""}</div>`}})});function y(){var p,D;(D=(p=l.value)==null?void 0:p.flowElementList)==null||D.forEach(C=>{var T;(T=C.properties)!=null&&T.button&&(C.properties.button=m(_.value||[],[]))}),l.value={...l.value}}function I(){var p,D;(D=(p=l.value)==null?void 0:p.flowElementList)==null||D.forEach(C=>{var T;(T=C.properties)!=null&&T.formProperty&&(C.properties.formProperty=d(n.value,[]))}),l.value={...l.value}}return(p,D)=>{const C=k("el-button");return p.view?(O(),B("div",Ro,[Z("div",Fo,[(O(!0),B(X,null,fe(b(h),T=>{var S;return O(),B("div",{key:T.label,class:"legend-item"},[Z("div",{class:"legend-color",style:Mt({backgroundColor:(S=T.style)==null?void 0:S.fill})},null,4),Z("span",null,W(T.label),1)])}),128))]),w(b(i),{"model-value":l.value,styles:g.value,tooltips:x.value},null,8,["model-value","styles","tooltips"])])):(O(),P(b(r),{key:1,modelValue:l.value,"onUpdate:modelValue":D[0]||(D[0]=T=>l.value=T),formData:a.value,"onUpdate:formData":D[1]||(D[1]=T=>a.value=T),formDefaults:u.value,"onUpdate:formDefaults":D[2]||(D[2]=T=>u.value=T),"form-options":b(Eo),"form-width":"30%"},{"form-top":f(()=>[w(C,{type:"default",onClick:y},{default:f(()=>[E(" 重置所有按钮配置 ")]),_:1}),w(C,{type:"default",onClick:I},{default:f(()=>[E(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const Te=ze(Ao,[["__scopeId","data-v-cce6bb35"]]),Mo={class:"flow-track"},Ko={key:0},Bo={key:1},jo=j({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=$("table"),i=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],r=R(()=>{var n,s,c;return((c=(s=(n=t.flowDetail)==null?void 0:n.flowHistory)==null?void 0:s.filter(v=>v.taskNodeType==="userTask"))==null?void 0:c.map(v=>({...v,duration:It(v.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:u}=Ie().useParam("flow.handle.type");function l(n){var s;return(s=u.value)==null?void 0:s.find(c=>c.value===n)}return(n,s)=>{var x,y,I;const c=k("el-radio-button"),v=k("el-radio-group"),_=k("avue-crud"),d=k("el-card"),m=k("el-timeline-item"),h=k("el-timeline"),g=k("el-empty");return O(),B(X,null,[w(v,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=p=>o.value=p)},{default:f(()=>[(O(),B(X,null,fe(i,p=>w(c,{key:p.label,label:p.label},{default:f(()=>[w(b(ie),{icon:p.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Z("div",Mo,[o.value==="table"?(O(),P(_,{key:0,data:r.value,option:a},null,8,["data"])):Q("",!0),o.value==="graph"?(O(),P(Te,{key:1,"model-value":(y=(x=n.flowDetail)==null?void 0:x.process)==null?void 0:y.flowData,"flow-history":(I=n.flowDetail)==null?void 0:I.flowHistory,view:""},null,8,["model-value","flow-history"])):Q("",!0),o.value==="timeline"?(O(),B(X,{key:2},[r.value.length?(O(),P(h,{key:0},{default:f(()=>[(O(!0),B(X,null,fe([...r.value].reverse(),p=>(O(),P(m,{key:p.id,timestamp:p.endTime,placement:"top"},{default:f(()=>[w(d,null,{default:f(()=>{var D,C,T;return[Z("div",null,W(p.assigneeName)+" 开始处理 ["+W(p.taskNodeName)+"] 环节 ",1),p.duration?(O(),B("div",Ko," 办理时长："+W(p.duration),1)):Q("",!0),p.type&&((D=p.comment)!=null&&D.comment)?(O(),B("div",Bo,W((C=l(p.type))==null?void 0:C.label)+"意见："+W((T=p.comment)==null?void 0:T.comment),1)):Q("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(O(),P(g,{key:1}))],64)):Q("",!0)])],64)}}});const zo=ze(jo,[["__scopeId","data-v-430a7108"]]),qo=j({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:i}=Je().useList();function r(u,l){return u.map(n=>{const s=l.find(v=>v.buttonKey===n.buttonKey);return{...n,...Et(s,["display","approval"])}})}const a=R(()=>{var m,h,g,x,y;const u={userId:"1"},{assignee:l,status:n}=((m=o.flowDetail)==null?void 0:m.task)||{},{createUser:s,flowInstanceId:c,status:v}=((h=o.flowDetail)==null?void 0:h.flowInstance)||{},_={true:!0,false:!1,startUser:s==u.userId,assignee:l==u.userId,todo:n==2,done:n==1,notstarted:!c,started:!!c,finished:v===1,unfinished:v===2};return((y=r(i.value??[],((x=(g=o.flowDetail)==null?void 0:g.properties)==null?void 0:x.button)??[]))==null?void 0:y.filter(I=>{var p,D;return(D=(p=I.display)==null?void 0:p.split(","))==null?void 0:D.every(C=>_[C])}))??[]});return(u,l)=>{const n=k("el-button");return O(!0),B(X,null,fe(a.value,s=>(O(),P(n,{key:s.buttonKey,type:s.buttonType,onClick:c=>t("click",s)},{default:f(()=>[w(b(ie),{icon:s.icon},null,8,["icon"]),E(" "+W(s.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Wo=j({__name:"upload-table",props:{flowDetail:{},modelValue:{}},setup(e){const t=e,{modelValue:o}=ye(t,void 0,{passive:!0}),{upload:{action:i,headers:r,preview:a,download:u,props:l}}=H(),n=typeof r=="function"?r():r,s=R(()=>{var y,I;return((I=(y=t.flowDetail)==null?void 0:y.task)==null?void 0:I.flowInstanceId)??Ee()}),c={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:v,getDataList:_,handleDel:d,handleSave:m,afterGetList:h,crudStateRefs:{tableData:g}}=oe({crudOption:{...el(),saveSuccessMsg:"上传成功"},tableOption:c,queryForm:{isLatest:1,flowInstanceId:s.value}});h(()=>{o.value=g.value.map(y=>y.id).join(",")}),_();async function x(y,I){var V,L;const{fileName:p,fileType:D,fileSize:C,fileUrl:T,res:S}=l,U={fileName:ge({res:y},`${S}.${p}`),fileType:ge({res:y},`${S}.${D}`),fileSize:ge({res:y},`${S}.${C}`),fileUrl:ge({res:y},`${S}.${T}`),taskId:(L=(V=t.flowDetail)==null?void 0:V.task)==null?void 0:L.taskId,flowInstanceId:s.value,rootMark:(I==null?void 0:I.rootMark)||"",version:typeof(I==null?void 0:I.version)=="number"?I.version+1:1};await m(U,_,()=>{})}return(y,I)=>{const p=k("el-button"),D=k("el-upload"),C=k("avue-crud");return O(),P(C,ne(re(b(v))),{"menu-left":f(()=>[w(D,{action:b(i),headers:b(n),"show-file-list":!1,onSuccess:I[0]||(I[0]=T=>x(T))},{default:f(()=>[w(p,{type:"primary",icon:"el-icon-upload"},{default:f(()=>[E(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:f(({row:T,index:S})=>[w(p,{type:"primary",text:"",icon:"el-icon-view",onClick:U=>{var V;return(V=b(a))==null?void 0:V(T,b(g))}},{default:f(()=>[E(" 预览 ")]),_:2},1032,["onClick"]),w(p,{type:"primary",text:"",icon:"el-icon-download",onClick:U=>{var V;return(V=b(u))==null?void 0:V(T,b(g))}},{default:f(()=>[E(" 下载 ")]),_:2},1032,["onClick"]),w(D,{action:b(i),headers:b(n),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:U=>x(U,T)},{default:f(()=>[w(p,{type:"primary",text:"",icon:"el-icon-upload"},{default:f(()=>[E(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),w(p,{type:"primary",text:"",icon:"el-icon-delete",onClick:U=>b(d)(T,S)},{default:f(()=>[E(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Qo={class:"flow-form__title"},wt=j({__name:"index",props:Oo(),emits:Lo(),setup(e,{emit:t}){const o=e,i=$o(o,t),{flowDetail:r,modelValue:a,activeTab:u,activeBtn:l,formLoading:n,approvalVisible:s,submitLoading:c,fileIds:v}=i,_=$();async function d(g){var x,y;l.value=g,await((x=_.value)==null?void 0:x.validate()),await((y=o.beforeClick)==null?void 0:y.call(o,g)),(g==null?void 0:g.approval)!=="false"?s.value=!0:h()}const m=Io(i);async function h(){var g,x;try{const{buttonKey:y}=l.value;c.value=!0,await((g=o.beforeSubmit)==null?void 0:g.call(o,l.value));const I=(x=m[y])==null?void 0:x.call(m);I instanceof Promise?(await I,le.success("操作成功"),s.value=!1,t("complete",l.value)):le.error("操作失败")}finally{c.value=!1}}return(g,x)=>{const y=k("el-skeleton"),I=k("el-main"),p=k("el-header"),D=k("el-tab-pane"),C=k("el-tabs"),T=k("el-container");return b(n)?(O(),P(I,{key:0},{default:f(()=>[w(y)]),_:1})):(O(),P(T,{key:1,class:"flow-form"},{default:f(()=>[w(p,{class:"flow-form__header"},{default:f(()=>{var S;return[Z("div",Qo,W((S=b(r).flowInstance)==null?void 0:S.title),1),w(qo,{"flow-detail":b(r),onClick:d},null,8,["flow-detail"])]}),_:1}),w(I,{class:"flow-form__main"},{default:f(()=>[w(C,{modelValue:b(u),"onUpdate:modelValue":x[2]||(x[2]=S=>ee(u)?u.value=S:null)},{default:f(()=>{var S,U;return[(U=(S=b(r))==null?void 0:S.process)!=null&&U.formPath?Kt(g.$slots,"default",{key:0}):(O(),P(D,{key:1,label:"审批信息",name:"form"},{default:f(()=>[w(So,{ref_key:"formRef",ref:_,modelValue:b(a),"onUpdate:modelValue":x[0]||(x[0]=V=>ee(a)?a.value=V:null),"flow-detail":b(r)},null,8,["modelValue","flow-detail"])]),_:1})),w(D,{label:"附件资料",name:"file",lazy:""},{default:f(()=>[w(Wo,{modelValue:b(v),"onUpdate:modelValue":x[1]||(x[1]=V=>ee(v)?v.value=V:null),"flow-detail":b(r)},null,8,["modelValue","flow-detail"])]),_:1}),w(D,{label:"流程跟踪",name:"track",lazy:""},{default:f(()=>[w(zo,{"flow-detail":b(r)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),w(Po,{onConfirm:h})]),_:3}))}}});function yt(e,t){switch(t.type){case"window":return Ho(e,t);case"dialog":case"drawer":return Go(e,t);default:return{open:()=>{},close:()=>{}}}}function Ho(e,t){const{window:{url:o="",name:i="flow-form",features:r="left=0,top=0,width=1600,height=900"}={}}=t,a=$(null),u=R(()=>`${o}?${Nt(Ot(e,Lt($t,St)))}`);return{open:()=>{var s;a.value=window.open(u.value,i,r),(s=a.value)==null||s.addEventListener("message",c=>{const{event:v}=c.data,_=b(e)[v];typeof _=="function"&&_(c.data)})},close:()=>{var s;return(s=a.value)==null?void 0:s.close()},openedWindow:a}}function Go(e,t){const{appContext:o}=st();let i;const r=()=>{i=document.createElement("div"),i.className="flow-form-wrapper";const u=Jo(t.formPath),l=Re(u,{...b(e)}),n=Re(t.type==="dialog"?Rt:Ft,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},l);n.appContext=o,jt(n,i),document.body.appendChild(i)},a=()=>{i&&document.body.removeChild(i)};return{open:r,close:a}}function Jo(e){return e?Bt(()=>zt(()=>import(e),[])):wt}const nt=Symbol("flowPagesConfig"),Yo={FlowModeler:null,FlowViewer:null,FormDesign:null,request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var bt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(bt||{});const Ae=de(bt);function H(e,t){return e&&t?(e.provide(nt,Ut(Yo,t)),t):Ke(nt)}var gt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(gt||{}),He=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(He||{}),Ge=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(Ge||{}),ht=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(ht||{});function Je(){const{request:e}=H(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Xo(){const{request:e}=H(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Zo(){const{request:e}=H(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=n=>e.get(t.list,{params:{type:n,ascs:"sort"}});return{url:t,getList:o,useList:n=>we(()=>o(n.value).then(s=>s.data.records),{refreshDeps:[n]}),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),batchUpdate:n=>e.post(t.batchUpdate,n)}}function Ye(){const{request:e}=H(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var kt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(kt||{});function Xe(){const{request:e}=H(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:a=>e.get(t.list,{params:a}),getDetail:a=>e.get(t.detail,{params:a}),update:a=>e.post(t.update,a)}}function el(){const{request:e}=H(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function tl(){const{request:e}=H(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:i=>e.get(t.list,{params:i})}}function Ie(){const{request:e}=H(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=s=>e.get(t.list,{params:s}),i=()=>e.get(t.all),r=s=>e.get(t.key,{params:{paramKey:s}});return{url:t,getList:o,getAllParam:i,getParam:r,useParam:s=>we(()=>r(s).then(c=>c.data)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function Vt(){const{request:e}=H(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ol(){const{request:e}=H(),t={tree:"/sapier-flow/flow-user/tree"},o=r=>e.get(t.tree,{params:{filter:r}});return{url:t,getUserTree:o,useUserTree:()=>we(()=>o().then(r=>r.data))}}function Dt(){const{request:e}=H(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Ct=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ct||{});function Me(){const{request:e}=H(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=n=>e.get(t.list,{params:n});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),deploy:n=>e.post(t.deploy,n)}}const ll={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:de(gt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(He),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(Ge),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:de(ht)},{label:"按钮预览",prop:"buttonPreview",width:150}]},al=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i}=oe({tableOption:ll,crudOption:Je(),sortOption:{ascs:"sort"}});return i(),(r,a)=>{const u=k("el-button"),l=k("avue-crud");return O(),P(l,ne(re(b(t))),{icon:f(({row:n})=>[w(b(ie),{icon:n.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:f(({row:n})=>[w(u,{type:n.buttonType},{default:f(()=>[w(b(ie),{icon:n.icon},null,8,["icon"]),E(" "+W(n.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":f(()=>[w(u,{type:b(o).buttonType},{default:f(()=>[w(b(ie),{icon:b(o).icon},null,8,["icon"]),E(" "+W(b(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ze={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},nl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Ze.column,{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},xt=j({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:i,deploy:r}=Ye(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:nl,crudOption:{getList:i},searchForm:{categoryId:o.categoryId}});ue(()=>{u.value.categoryId=o.categoryId??"",l()});const n=$(!1);async function s(c){await De.confirm("发布新版本，是否确认？","提示",{type:"success"}),n.value=!0,r({flowModuleId:c.flowModuleId}).then(()=>{le.success("发布成功"),l()}).finally(()=>{n.value=!1})}return(c,v)=>{const _=k("el-button"),d=k("avue-crud");return O(),P(d,ne(re(b(a))),{"menu-left":f(()=>[w(_,{type:"primary",icon:"el-icon-plus",onClick:v[0]||(v[0]=m=>t("add"))},{default:f(()=>[E(" 新增 ")]),_:1})]),menu:f(({row:m})=>[w(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:h=>t("view",m)},{default:f(()=>[E(" 查看 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:h=>t("edit",m)},{default:f(()=>[E(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-upload",onClick:h=>s(m)},{default:f(()=>[E(" 发布 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-switch",onClick:h=>t("version",m)},{default:f(()=>[E(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:f(({row:m})=>[w(b(ie),{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),rl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Ze.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Tt=j({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:i,update:r}=Xe(),{bindVal:a,crudStateRefs:{searchForm:u},getDataList:l}=oe({tableOption:rl,crudOption:{getList:i,dataPath:"res.data"}});ue(()=>{o.flowModuleId&&(u.value.flowModuleId=o.flowModuleId,l())});const n=$(!1);async function s(c){await De.confirm(`确定将 ${c.flowName}(${c.flowKey}:v${c.version}) 设为主版本?`,"提示",{type:"warning"}),n.value=!0,r({flowDeployId:c.flowDeployId,flowModuleId:c.flowModuleId,mainVersion:1}).then(()=>{le.success("设置成功"),l()}).finally(()=>{n.value=!1})}return(c,v)=>{const _=k("el-button"),d=k("avue-crud");return O(),P(d,ne(re(b(a))),{"menu-left":f(()=>[w(_,{loading:n.value,type:"primary",icon:"el-icon-arrow-left",onClick:v[0]||(v[0]=m=>t("back"))},{default:f(()=>[E(" 返回 ")]),_:1},8,["loading"])]),menu:f(({row:m})=>[w(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:h=>t("view",m)},{default:f(()=>[E(" 查看 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:h=>t("edit",m)},{default:f(()=>[E(" 编辑 ")]),_:2},1032,["loading","onClick"]),w(_,{loading:n.value,disabled:m.mainVersion===b(kt).是,type:"text",icon:"el-icon-switch",onClick:h=>s(m)},{default:f(()=>[E(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:f(({row:m})=>[w(b(ie),{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),rt={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},sl=j({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:i},getDataList:r,handleSave:a,handleUpdate:u,handleDel:l}=oe({crudOption:{rowKey:"id",...Xo(),dataPath:"res.data"},tableOption:rt,pageOption:{pageSize:20}});r();function n(v,_,d,m){a(_,d,m)}function s(v,_,d,m){u(_,NaN,d,m)}async function c(v,_){await l(v.data,NaN),_()}return(v,_)=>{const d=k("avue-tree");return O(),P(d,{modelValue:b(o),"onUpdate:modelValue":_[0]||(_[0]=m=>ee(o)?o.value=m:null),option:b(rt),data:b(i),onNodeClick:_[1]||(_[1]=m=>t("node-click",m)),onSave:n,onUpdate:s,onDel:c},null,8,["modelValue","option","data"])}}}),et=j({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var n;const o=e,{FormDesign:i}=H(),r=R({get(){return o.modelValue?it(o.modelValue):{menuBtn:!1,span:24}},set(s){t("update:modelValue",Qt(s,{useJson5:!1}))}}),a=R(()=>o.fields?JSON.parse(o.fields):[]),u=R(()=>{const s={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...s,props:{label:"name",value:"name",desc:"comment"}},{...s,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((n=Ht.settings)==null?void 0:n.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(s,c)=>{const v=k("avue-form");return s.view?(O(),P(v,{key:0,class:qt(r.value.class),"model-value":{},option:r.value},null,8,["class","option"])):(O(),P(b(i),{key:1,modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=_=>r.value=_),"base-option":u.value,resources:l},null,8,["modelValue","base-option"]))}}}),il=Z("span",null,"流程设计",-1),ul={key:0},cl={key:1},dl={style:{height:"calc(100vh - 144px)"}},pl=j({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const i=ye(e),{visible:r,modelValue:a}=i,{create:u,deploy:l,getDetail:n,update:s}=Ye(),{getDetail:c,update:v}=Xe(),_=["流程信息","表单设计","模型设计","完成"],d=$(!1);_e(r,async U=>{if(!U)return;const{flowModuleId:V}=a.value,{flowDeployId:L}=a.value;try{d.value=!0;let N={};L?N=await c({flowDeployId:L}):V&&(N=await n({flowModuleId:V})),a.value=N.data}finally{d.value=!1}},{immediate:!0});const{data:m}=Dt().useList(),{data:h}=Vt().useList(),{data:g}=Me().useList(),x=R(()=>{var U,V;return(V=(U=g.value)==null?void 0:U.find(L=>L.tableName===a.value.formDataTable))==null?void 0:V.tableFields}),y=$(0),I=R(()=>{var U,V;return y.value===1?((U=m.value)==null?void 0:U.map(L=>({label:L.formName,value:L.formOption})))??[]:y.value===2?((V=h.value)==null?void 0:V.map(L=>({label:L.flowName,value:L.flowData})))??[]:[]});function p(U){y.value===1?a.value.formOption=U.value:y.value===2&&(a.value.flowData=U.value)}const D=$();async function C(U){y.value===0&&await Qe(D),d.value=!0;const{flowModuleId:V}=a.value,{flowDeployId:L}=a.value;try{L?await v(a.value):V?await s(a.value):await u(a.value).then(N=>{a.value.flowModuleId=N.data.flowModuleId}),le.success("保存成功")}finally{d.value=!1}typeof U=="number"?y.value=U:y.value++}async function T(){await De.confirm("发布新版本，是否确认？","提示"),d.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{le.success("发布成功")}).finally(()=>{d.value=!1})}function S(){r.value=!1,y.value=0,a.value={},t("close")}return(U,V)=>{const L=k("el-link"),N=k("el-dropdown-item"),F=k("el-dropdown-menu"),M=k("el-dropdown"),K=k("el-col"),z=k("el-step"),te=k("el-steps"),G=k("el-button"),J=k("el-row"),Y=k("avue-form"),A=k("el-result"),se=k("el-dialog"),tt=Be("loading");return O(),P(se,{modelValue:b(r),"onUpdate:modelValue":V[5]||(V[5]=q=>ee(r)?r.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:S},{header:f(()=>[w(J,{justify:"center"},{default:f(()=>[w(K,{span:5},{default:f(()=>{var q,me,Ne,ot;return[Z("div",null,[il,(q=b(a))!=null&&q.flowName?(O(),B("span",ul," - "+W((me=b(a))==null?void 0:me.flowName),1)):Q("",!0),(Ne=b(a))!=null&&Ne.version?(O(),B("span",cl," - V"+W((ot=b(a))==null?void 0:ot.version),1)):Q("",!0)]),I.value.length?(O(),P(M,{key:0},{dropdown:f(()=>[w(F,null,{default:f(()=>[(O(!0),B(X,null,fe(I.value,Oe=>(O(),P(N,{key:Oe.label,onClick:Ul=>p(Oe)},{default:f(()=>[E(W(Oe.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:f(()=>[w(L,{icon:"el-icon-arrow-down",underline:!1},{default:f(()=>[E(" 选择模板 ")]),_:1})]),_:1})):Q("",!0)]}),_:1}),w(K,{span:14},{default:f(()=>[w(te,{active:y.value,simple:"","process-status":"finish","finish-status":"success"},{default:f(()=>[(O(),B(X,null,fe(_,(q,me)=>w(z,{key:me,title:q,onClick:Ne=>C(me)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),w(K,{span:5,style:{"text-align":"right"}},{default:f(()=>[w(G,{disabled:y.value===0,loading:d.value,type:"primary",onClick:V[0]||(V[0]=q=>y.value--)},{default:f(()=>[E(" 上一步 ")]),_:1},8,["disabled","loading"]),w(G,{disabled:y.value===_.length-1,type:"primary",loading:d.value,onClick:V[1]||(V[1]=q=>C())},{default:f(()=>[E(" 下一步 ")]),_:1},8,["disabled","loading"]),w(G,{onClick:S},{default:f(()=>[E(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:f(()=>[je((O(),B("div",dl,[y.value===0?(O(),P(Y,{key:0,ref_key:"formRef",ref:D,modelValue:b(a),"onUpdate:modelValue":V[2]||(V[2]=q=>ee(a)?a.value=q:null),option:b(Ze),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):Q("",!0),y.value===1?(O(),P(et,{key:1,modelValue:b(a).formOption,"onUpdate:modelValue":V[3]||(V[3]=q=>b(a).formOption=q),fields:x.value},null,8,["modelValue","fields"])):Q("",!0),y.value===2?(O(),P(Te,{key:2,modelValue:b(a).flowData,"onUpdate:modelValue":V[4]||(V[4]=q=>b(a).flowData=q),"flow-form-option":b(a).formOption},null,8,["modelValue","flow-form-option"])):Q("",!0),y.value===3?(O(),P(A,{key:3,icon:"success",title:"流程设计完成"},{extra:f(()=>[b(a).flowDeployId?Q("",!0):(O(),P(G,{key:0,type:"primary",onClick:T},{default:f(()=>[E(" 发布 ")]),_:1})),w(G,{onClick:S},{default:f(()=>[E(" 关闭 ")]),_:1})]),_:1})):Q("",!0)])),[[tt,d.value]])]),_:1},8,["modelValue"])}}}),fl=Z("span",null,"流程查看",-1),ml={key:0},vl={key:1},_l=j({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=ye(e),{visible:i,modelValue:r}=o,{getDetail:a}=Ye(),{getDetail:u}=Xe(),l=$("form"),n=$(!1);_e(i,async c=>{if(!c)return;const{flowModuleId:v}=r.value,{flowDeployId:_}=r.value;try{n.value=!0;let d={};_?d=await u({flowDeployId:_}):v&&(d=await a({flowModuleId:v})),r.value={...d.data}}finally{n.value=!1}},{immediate:!0});function s(){r.value={},l.value="form"}return(c,v)=>{const _=k("el-tab-pane"),d=k("el-tabs"),m=k("el-dialog"),h=Be("loading");return O(),P(m,{modelValue:b(i),"onUpdate:modelValue":v[3]||(v[3]=g=>ee(i)?i.value=g:null),width:"60%",top:"0",onClose:s},{header:f(()=>{var g,x,y,I;return[fl,(g=b(r))!=null&&g.flowName?(O(),B("span",ml," - "+W((x=b(r))==null?void 0:x.flowName),1)):Q("",!0),(y=b(r))!=null&&y.version?(O(),B("span",vl," - V"+W((I=b(r))==null?void 0:I.version),1)):Q("",!0)]}),default:f(()=>[je((O(),P(d,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=g=>l.value=g)},{default:f(()=>[w(_,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:f(()=>[l.value==="form"&&b(r).formOption?(O(),P(et,{key:0,modelValue:b(r).formOption,"onUpdate:modelValue":v[0]||(v[0]=g=>b(r).formOption=g),view:""},null,8,["modelValue"])):Q("",!0)]),_:1}),w(_,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:f(()=>[l.value==="flow"?(O(),P(Te,{key:0,modelValue:b(r).flowData,"onUpdate:modelValue":v[1]||(v[1]=g=>b(r).flowData=g),view:""},null,8,["modelValue"])):Q("",!0)]),_:1})]),_:1},8,["modelValue"])),[[h,n.value]])]),_:1},8,["modelValue"])}}}),wl=j({__name:"index",setup(e){const t=$("definition"),o=$({}),i=$(""),r=$("");function a(m){i.value===m.id?i.value="":i.value=m.id}const u=$(!1),l=$(!1);function n(){o.value={},u.value=!0}function s(m){o.value=m,u.value=!0}function c(m){o.value=m,l.value=!0}function v(m){r.value=m.flowModuleId||"",t.value="deploy"}function _(){r.value="",t.value="definition"}async function d(){const m=t.value;await pe(),t.value="",await pe(),t.value=`${m}`}return(m,h)=>{const g=k("el-col"),x=k("el-row");return O(),P(x,{gutter:20},{default:f(()=>[w(g,{span:4},{default:f(()=>[w(sl,{onNodeClick:a})]),_:1}),w(g,{span:20},{default:f(()=>[t.value==="definition"?(O(),P(xt,{key:0,"category-id":i.value,onAdd:n,onEdit:s,onView:c,onVersion:v},null,8,["category-id"])):Q("",!0),t.value==="deploy"?(O(),P(Tt,{key:1,"flow-module-id":r.value,onEdit:s,onView:c,onBack:_},null,8,["flow-module-id"])):Q("",!0),w(pl,{modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=y=>o.value=y),visible:u.value,"onUpdate:visible":h[1]||(h[1]=y=>u.value=y),onClose:d},null,8,["modelValue","visible"]),w(_l,{modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=y=>o.value=y),visible:l.value,"onUpdate:visible":h[3]||(h[3]=y=>l.value=y)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),yl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},bl=j({__name:"index",setup(e){const t=Xt("debugMode",!1),{getList:o}=tl(),{bindVal:i,getDataList:r}=oe({tableOption:yl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});r();const a=$({}),{open:u,close:l}=yt(a,{type:"drawer"});function n(s){a.value={flowKey:s.flowKey,taskId:s.taskId,instanceId:s.flowInstanceId,debug:t.value,onComplete:()=>{l(),r()}},u()}return(s,c)=>{const v=k("el-switch"),_=k("el-button"),d=k("el-link"),m=k("avue-crud");return O(),P(m,ne(re(b(i))),{"menu-right":f(()=>[w(_,{type:"text"},{default:f(()=>[w(v,{modelValue:b(t),"onUpdate:modelValue":c[0]||(c[0]=h=>ee(t)?t.value=h:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:f(({row:h})=>[w(d,{type:"primary",underline:!1,onClick:g=>n(h)},{default:f(()=>[E(W(h.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),gl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ae},{label:"备注",prop:"remark"}]},hl=j({__name:"index",setup(e){const{bindVal:t,getDataList:o}=oe({tableOption:gl,crudOption:Ie()});return o(),(i,r)=>{const a=k("avue-crud");return O(),P(a,ne(re(b(t))),null,16)}}}),kl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Vl={class:"flow-list"},Dl=["onClick"],Cl={class:"flow-name"},xl=j({__name:"index",setup(e){const t=$([]),{getPublishFlow:o,getTodoList:i}=xe();o().then(_=>{t.value=_.data});const r=$({}),{open:a,close:u}=yt(r,{type:"drawer"});function l(_){r.value={flowKey:_.flowKey,taskId:_.taskId,instanceId:_.flowInstanceId,onComplete:()=>{u(),s()}},a()}const{bindVal:n,getDataList:s,crudStateRefs:{searchForm:c}}=oe({tableOption:kl,crudOption:{getList:i},searchForm:{status:2}}),v=[{label:"待办",value:2},{label:"已办",value:1}];return(_,d)=>{const m=k("el-button"),h=k("el-collapse-item"),g=k("el-collapse"),x=k("el-card"),y=k("el-divider"),I=k("avue-radio"),p=k("el-link"),D=k("avue-crud");return O(),B(X,null,[w(x,{"body-style":{padding:"0 20px"}},{default:f(()=>[w(g,{"model-value":"1"},{default:f(()=>[w(h,{name:"1"},{title:f(()=>[w(m,{text:"",icon:"el-icon-promotion"},{default:f(()=>[E(" 发起审批 ")]),_:1})]),default:f(()=>[Z("div",Vl,[(O(!0),B(X,null,fe(t.value,C=>(O(),B("div",{key:C.flowKey,class:"flow-item",onClick:T=>l(C)},[w(b(ie),{class:"flow-icon",icon:C.flowIcon,width:"60"},null,8,["icon"]),Z("div",Cl,W(C.flowName),1)],8,Dl))),128))])]),_:1})]),_:1})]),_:1}),w(y,{direction:"horizontal","content-position":"left"}),w(D,ne(re(b(n))),{"menu-left":f(()=>[w(I,{modelValue:b(c).status,"onUpdate:modelValue":[d[0]||(d[0]=C=>b(c).status=C),b(s)],button:"",dic:v},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:f(({row:C})=>[w(p,{type:"primary",underline:!1,onClick:T=>l(C)},{default:f(()=>[E(W(C.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Tl=ze(xl,[["__scopeId","data-v-de4a15fa"]]),Il={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Nl=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:r}=oe({tableOption:Il,crudOption:Vt()});i();const a=$(!1);async function u(n){o.value=n,a.value=!0}async function l(){await r(o.value,NaN,()=>a.value=!1,()=>{})}return(n,s)=>{const c=k("el-button"),v=k("avue-crud"),_=k("el-dialog");return O(),B(X,null,[w(v,ne(re(b(t))),{flowData:f(({row:d})=>[w(c,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>u(d)},{default:f(()=>[E(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(_,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value=d),title:`模型设计-${b(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[w(c,{type:"primary",onClick:l},{default:f(()=>[E(" 保存 ")]),_:1}),w(c,{onClick:s[1]||(s[1]=d=>a.value=!1)},{default:f(()=>[E(" 取消 ")]),_:1})]),default:f(()=>[w(Te,{modelValue:b(o).flowData,"onUpdate:modelValue":s[0]||(s[0]=d=>b(o).flowData=d),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ol={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Ll=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:r}=oe({tableOption:Ol,crudOption:Dt()});i();const a=$(!1);async function u(n){o.value={...n},a.value=!0}async function l(){await r(o.value,NaN,()=>a.value=!1,()=>{})}return(n,s)=>{const c=k("el-button"),v=k("avue-crud"),_=k("el-dialog");return O(),B(X,null,[w(v,ne(re(b(t))),{formOption:f(({row:d})=>[w(c,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>u(d)},{default:f(()=>[E(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),w(_,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=d=>a.value=d),title:`表单设计-${b(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[w(c,{type:"primary",onClick:l},{default:f(()=>[E(" 保存 ")]),_:1}),w(c,{onClick:s[1]||(s[1]=d=>a.value=!1)},{default:f(()=>[E(" 取消 ")]),_:1})]),default:f(()=>[w(et,{modelValue:b(o).formOption,"onUpdate:modelValue":s[0]||(s[0]=d=>b(o).formOption=d),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),$l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:de(Ct)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}]}}]},Sl=j({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,beforeOpen:r,beforeSubmit:a}=oe({crudOption:Me(),tableOption:$l});i();const{data:u}=Ie().useParam("table.default.fields");r(c=>{c==="add"?o.value.tableFields=u.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),a(c=>{c.tableFields=JSON.stringify(c.tableFields)});const{deploy:l}=Me(),n=$(!1);async function s(c){await De.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),n.value=!0,l({id:c.id}).then(()=>{le.success("部署成功"),i()}).finally(()=>{n.value=!1})}return(c,v)=>{const _=k("el-button"),d=k("avue-crud");return O(),P(d,ne(re(b(t))),{menu:f(({row:m})=>[w(_,{type:"text",icon:"el-icon-upload",onClick:h=>s(m)},{default:f(()=>[E(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Fa={install(e,t){e.component("FlowButton",al).component("FlowDefinition",xt).component("FlowDeploy",Tt).component("FlowForm",wt).component("FlowManage",wl).component("FlowOps",bl).component("FlowParam",hl).component("FlowTemplate",Nl).component("FormTemplate",Ll).component("TableTemplate",Sl).component("FlowWorkbench",Tl),H(e,t)}};export{Yo as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,al as FlowButton,xt as FlowDefinition,Tt as FlowDeploy,wt as FlowForm,wl as FlowManage,bl as FlowOps,hl as FlowParam,Nl as FlowTemplate,Tl as FlowWorkbench,Ll as FormTemplate,Sl as TableTemplate,bt as Whether,Fa as default,Jo as resolveFlowFormComponent,H as useConfigProvider,yt as useFlowForm,Go as useFlowFormOverlay,Ho as useFlowFormWindow,Ae as whetherDic};
