import{bQ as oe,dB as Pe,dC as de,dD as It,dE as te,bc as ge,dF as Ot,d4 as Nt,d6 as Lt,cw as $t,a5 as St,by as Ut,bR as De}from"../composables_use-crud_index.md.b279084a.js";import{L as Rt,M as re,s as Pt,N as Et,O as Ft}from"../app.11d90cc6.js";import{U as Ke,A as Ce,r as O,s as Le,d as U,e as ie,w as we,a6 as ee,u as g,n as pe,V as At,h as M,b as rt,ar as Ee,G as V,i as x,C as $,D as f,I as b,m as P,p as B,a0 as lt,aK as Be,a2 as je,B as X,E as z,j as A,N as fe,F as Y,J as Mt,_ as ze,av as ae,aw as ne,k as Kt,b2 as Bt,au as jt,aN as zt,l as Wt}from"./framework.22a77fa2.js";import{M as it,f as Qt,t as Fe,L as qt,u as Ht}from"./vuedraggable.umd.627d7d33.js";import"./mysqlWorkbench.3afe459a.js";import{d as Gt}from"./data.4cb21f02.js";import{a as Jt}from"../flow-design_flow-modeler_index.md.e755d908.js";import{u as ye,a as Yt,w as Xt,c as Zt}from"./theme.1d56182c.js";import"../components_icon-select_index.md.dc997862.js";import"../components_index.md.366cb56b.js";import"../components_v-text_index.md.306fe565.js";import"../composables_index.md.1bb90be4.js";import"../flow-design_flow-viewer_index.md.e9fcc2c5.js";import"../flow-design_index.md.e062cae5.js";import"../flow-pages_index.md.9ad8d77c.js";import"../flow-pages_pages_flow-button_index.md.2cf37f1f.js";import"../flow-pages_pages_flow-manage_index.md.3b729385.js";import"../flow-pages_pages_flow-ops_index.md.1351e2c2.js";import"../flow-pages_pages_flow-param_index.md.907e6ed8.js";import"../flow-pages_pages_flow-template_index.md.743ad38c.js";import"../flow-pages_pages_flow-workbench_index.md.e559c6b1.js";import"../flow-pages_pages_form-template_index.md.754d7c10.js";import"../flow-pages_pages_table-template_index.md.f196419b.js";import"../form-design_demo.md.f7fa8b02.js";import"../form-design_index.md.f8d915c9.js";import"../guide_changelog.md.71ace3ef.js";import"../guide_start.md.f25ec09d.js";import"../index.md.dedad964.js";import"../plugins_avue-patch_index.md.9a4d5705.js";import"../plugins_compatible-tips_index.md.3602f3a2.js";import"../plugins_env-dts_index.md.14017d50.js";import"../plugins_index.md.09238556.js";import"../plugins_load-proxy_index.md.1d58f036.js";import"../plugins_setup-extend_index.md.176ed99f.js";import"../plugins_uni-ui-patch_index.md.de2a1873.js";import"../plugins_uview-patch_index.md.a13b4ad1.js";import"../types_avue_index.md.31e36571.js";import"../types_index.md.aa1779e7.js";import"../utils_date_dateFormat.md.24466ffd.js";import"../utils_date_durationFormat.md.a91e1175.js";import"../utils_emitter_mittAsync.md.65520a0e.js";import"../utils_index.md.99824380.js";import"../utils_math_index.md.81fb7150.js";import"../utils_object_filterObj.md.d634698f.js";import"../utils_object_filterObjDeep.md.aee85325.js";import"../utils_object_getDataType.md.4c16fa33.js";import"../utils_string_deserialize.md.49b88e4f.js";import"../utils_string_serialize.md.175ca994.js";import"../utils_string_uuid.md.1b6743be.js";import"../utils_tool_awaitTo.md.907e2bd0.js";import"../utils_tool_enumToDic.md.f0182e11.js";import"../utils_tool_sleep.md.15440607.js";import"../utils_tree_buildTree.md.b95211e7.js";import"../utils_tree_filterTree.md.753c4098.js";import"../utils_tree_findTree.md.30184861.js";import"../utils_tree_flatTree.md.cb52189f.js";import"../utils_tree_treeMap.md.168ca5df.js";import"./vue.runtime.esm-bundler.ed40cebf.js";const eo={},to=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),oo=()=>eo,lo=e=>Array.isArray(e),We=e=>e!==null&&typeof e=="object",ut=e=>e instanceof Function,be=e=>e==null,Qe=typeof window>"u",ct=()=>{var e;return Qe||be((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ao=()=>{var e,t;return(e=!Qe&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},$e=()=>new Promise(()=>{}),le=e=>ee(e)?e.value:e,no=e=>We(e)?Object.assign(lo(e)?[]:{},e):e,he=new Map,so=e=>be(e)?void 0:he.get(e),ro=(e,t,o)=>{const i=he.get(e);i!=null&&i.timer&&clearTimeout(i.timer);const a=setTimeout(()=>he.delete(e),t);he.set(e,{...o,timer:a})},ue=e=>e;function dt(e,t,o){let i,a,n,u,l,s,r=0,d=!1,m=!1,_=!0;const p=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,We(o)&&(d=!!o.leading,m="maxWait"in o,n=m?Math.max(+o.maxWait||0,t):n,_="trailing"in o?!!o.trailing:_);function c(C){const I=i,T=a;return i=a=void 0,r=C,u=e.apply(T,I),u}function w(C,I){return p?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,I)}function v(C){if(p)return window.cancelAnimationFrame(C);clearTimeout(C)}function h(C){return r=C,l=w(k,t),d?c(C):u}function y(C){const I=C-s,T=C-r,j=t-I;return m?Math.min(j,n-T):j}function D(C){const I=C-s,T=C-r;return s===void 0||I>=t||I<0||m&&T>=n}function k(){const C=Date.now();if(D(C))return N(C);l=w(k,y(C))}function N(C){return l=void 0,_&&i?c(C):(i=a=void 0,u)}function L(){l!==void 0&&v(l),r=0,i=s=a=l=void 0}function S(){return l===void 0?u:N(Date.now())}function R(){return l!==void 0}function E(...C){const I=Date.now(),T=D(I);if(i=C,a=this,s=I,T){if(l===void 0)return h(s);if(m)return l=w(k,t),c(s)}return l===void 0&&(l=w(k,t)),u}return E.cancel=L,E.flush=S,E.pending=R,E}function io(e,t,o){let i=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return We(o)&&(i="leading"in o?!!o.leading:i,a="trailing"in o?!!o.trailing:a),dt(e,t,{leading:i,trailing:a,maxWait:t})}var uo=ue((e,{debounceInterval:t,debounceOptions:o,manual:i})=>{const a=O(!1),n=O(),u=U(()=>o),l=U(()=>le(t)),s=O(e.context.runAsync);return i||(a.value=!0),ie(r=>{be(l.value)||(n.value=dt(d=>d(),l.value,u.value),e.context.runAsync=(...d)=>new Promise((m,_)=>{a.value?(a.value=!1,s.value(...d).then(m).catch(_)):n.value(()=>{s.value(...d).then(m).catch(_)})}),r(()=>{var d;(d=n.value)===null||d===void 0||d.cancel(),e.context.runAsync=s.value}))}),{onCancel(){var r;(r=n.value)===null||r===void 0||r.cancel()}}}),co=ue((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const i=O(),a=O(0),n=U(()=>le(t)),u=U(()=>le(o));let l=!1;const s=()=>{a.value=0},r=U(()=>{if(u.value)return u.value;const _=1e3,p=1,c=9,w=Math.floor(Math.random()*2**Math.min(a.value,c)+p);return _*w}),d=()=>{let _;const p=n.value===-1,c=a.value<n.value;return(p||c)&&(p||(a.value+=1),_=setTimeout(()=>{l=!0,e.context.refresh()},r.value)),()=>_&&clearTimeout(_)},m=()=>{i.value&&i.value()};return{onBefore(){l||s(),l=!1,m()},onSuccess(){s()},onError(){i.value=d()},onCancel(){s(),m()}}}),po=ue((e,{ready:t=O(!0),manual:o,defaultParams:i=[]})=>(we(t,a=>{!o&&a&&e.context.run(...i)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),fo=ue((e,{refreshDeps:t=[],refreshDepsAction:o,manual:i})=>(t!=null&&t.length&&we(t,()=>{o?o():!i&&e.context.refresh()}),{})),mo=ue((e,{throttleInterval:t,throttleOptions:o})=>{const i=O(),a=U(()=>le(t)),n=U(()=>o),u=O(e.context.runAsync);return ie(l=>{if(be(t))return{};i.value=io(s=>s(),a.value,n.value),e.context.runAsync=(...s)=>new Promise((r,d)=>{i.value(()=>{u.value(...s).then(r).catch(d)})}),l(()=>{var s;(s=i.value)===null||s===void 0||s.cancel(),e.context.runAsync=u.value})}),{onCancel(){var l;(l=i.value)===null||l===void 0||l.cancel()}}});const vo=(e,t)=>o=>{Object.keys(o).forEach(i=>{e[i].value=o[i]}),t.forEach(i=>i(e))},_o=(e,t)=>()=>{let o=t;for(let i=e.length;i-- >0;)o=e[i](o);return o()},wo=(e,t,o)=>{var i,a;const{initialData:n,onSuccess:u,onError:l,onBefore:s,onAfter:r}=t,d=O((i=o==null?void 0:o.loading)!==null&&i!==void 0?i:!1),m=Le((a=o==null?void 0:o.data)!==null&&a!==void 0?a:n),_=Le(o==null?void 0:o.error),p=O(o==null?void 0:o.params),c=O([]),w=Le("pending"),v={},h=vo({status:w,loading:d,data:m,error:_,params:p},[]),y=(k,...N)=>{if(k==="onQuery"){const L=c.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:_o(L,N[0])()}}else{const L=c.value.map(S=>{var R;return(R=S[k])===null||R===void 0?void 0:R.call(S,...N)});return Object.assign({},...L)}},D=O(0);return v.runAsync=async(...k)=>{h({loading:!0,params:k,status:"pending"}),D.value+=1;const N=D.value,{isBreak:L,breakResult:S=$e()}=y("onBefore",k);if(L)return h({status:"settled"}),S;s==null||s(k);try{const R=()=>new Promise(I=>I(e(...p.value)));let{servicePromise:E}=y("onQuery",R);E||(E=R());const C=await E;return N!==D.value?$e():(h({data:C,loading:!1,error:void 0,status:"settled"}),y("onSuccess",C,k),u==null||u(C,k),y("onAfter",k,C,void 0),r==null||r(k),C)}catch(R){if(N!==D.value)return $e();throw h({loading:!1,error:R,status:"settled"}),y("onError",R,k),l==null||l(R,k),y("onAfter",k,void 0,R),r==null||r(k),R}},v.run=(...k)=>{v.runAsync(...k).catch(N=>{l||console.error(N)})},v.cancel=()=>{D.value+=1,h({loading:!1}),y("onCancel")},v.refresh=()=>{v.run(...p.value||[])},v.refreshAsync=()=>v.runAsync(...p.value||[]),v.mutate=k=>{const N=ut(k)?k(m.value):k,L=no(N);h({data:L}),y("onMutate",L)},{status:w,loading:d,data:m,error:_,params:p,plugins:c,context:v}};function yo(e,t={},o){const i=Ke(to,{}),a={...oo(),...i,...t},{manual:n=!1,defaultParams:u=[]}=a,l=wo(e,a);if(l.plugins.value=o.map(s=>s(l,a)),!n){const s=l.params.value||u;l.context.run(...s)}return Ce(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ke=new Map,bo=(e,t)=>{ke.set(e,t),t.then(o=>(ke.delete(e),o)).catch(()=>{ke.delete(e)})},go=e=>ke.get(e),ve=new Map,ho=(e,t)=>{ve.has(e)&&ve.get(e).forEach(o=>o(t))},ko=(e,t)=>(ve.has(e)?ve.get(e).push(t):ve.set(e,[t]),()=>{const o=ve.get(e).indexOf(t);ve.get(e).splice(o,1)});var Vo=ue((e,{cacheKey:t,cacheTime:o=6e5,staleTime:i=0,getCache:a,setCache:n})=>{if(!t)return{};const u=ut(t)?t:()=>t,l=O(()=>{});let s;const r=v=>a?a(v):so(v),d=(v,h,y)=>{n?n(v,y):ro(v,h,y),ho(v,y.data)},m=v=>i===-1||v+i>new Date().getTime(),_=(v,h)=>Object.prototype.hasOwnProperty.call(v,h),p=v=>{const h=u(v);return ko(h,y=>{e.data.value=y})},c=u(),w=r(c);return w&&_(w,"data")&&(e.data.value=w.data,e.params.value=w.params),c&&(l.value=p()),Ce(()=>{l.value()}),{onBefore(v){const h=u(v),y=r(h);if(!y||!_(y,"data"))return{};if(m(y.time))return e.data.value=y.data,e.loading.value=!1,{isBreak:!0,breakResult:y.data};e.data.value=y.data},onQuery(v){const h=e.params.value,y=u(h);let D=go(y);return D&&D!==s?()=>D:(D=v(),s=D,bo(y,D),()=>D)},onSuccess(v,h){const y=u(h);y&&(l.value(),d(y,o,{data:v,params:h,time:new Date().getTime()}),l.value=p(h))},onMutate(v){const h=u(e.params.value);h&&(l.value(),d(h,o,{data:v,params:e.params.value,time:new Date().getTime()}),l.value=p(e.params.value))}}});function Do(e){let t,o;class i extends Promise{constructor(n){super(n),this.cancel=()=>{o(),clearTimeout(t)}}}return new i(a=>{o=a,t=setTimeout(o,e)})}function Se(){return new Date().getTime()}var Co=ue((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const i=O(()=>{}),a=U(()=>le(t)),n=U(()=>le(o));let u=0,l={};const s=()=>{let r;return a.value&&(r=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>r&&clearTimeout(r)};return{onBefore(){e.loading.value=!a.value,i.value(),i.value=s(),u=Se()},onQuery(r){if(!n.value)return()=>r();l=Do(n.value+a.value);const d=async()=>{try{const _=await r();return Se()-u<=a.value&&l.cancel(),Promise.resolve(_)}catch(_){return Se()-u<=a.value&&l.cancel(),Promise.reject(_)}},m=Promise.allSettled([d(),l]).then(_=>{const p=_[0];return p.status==="fulfilled"?p.value:Promise.reject(p.reason)});return()=>m},onCancel(){i.value()},onAfter(){i.value()}}}),Ue;const pt=new Set,ft=new Set,mt=new Set,Ve=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=pt;break;case"RECONNECT_LISTENER":o=mt;break;case"VISIBLE_LISTENER":o=ft;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Re=e=>{e.forEach(t=>{t()})};!Qe&&(Ue=window)!==null&&Ue!==void 0&&Ue.addEventListener&&(window.addEventListener("visibilitychange",()=>{ct()&&Re(ft)},!1),window.addEventListener("focus",()=>Re(pt),!1),window.addEventListener("online",()=>Re(mt),!1));var xo=ue((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:i=!1,errorRetryCount:a=0})=>{const n=O(),u=O(!1),l=U(()=>le(t)),s=U(()=>le(a)),r=[],d=c=>{c&&r.push(c)},m=()=>(o||ct())&&(i||ao()),_=c=>{if(e.error.value&&s.value!==0)return;let w;if(!be(l.value)&&l.value>=0)if(m())w=setTimeout(c,l.value);else{u.value=!0;return}return()=>w&&clearTimeout(w)},p=()=>{u.value&&m()&&(e.context.refresh(),u.value=!1)};return we(l,()=>{n.value&&(n.value(),n.value=_(()=>e.context.refresh()))}),o||d(Ve("VISIBLE_LISTENER",p)),i||d(Ve("RECONNECT_LISTENER",p)),Ce(()=>{r.forEach(c=>c())}),{onBefore(){var c;(c=n.value)===null||c===void 0||c.call(n)},onCancel(){var c;(c=n.value)===null||c===void 0||c.call(n)},onAfter(){n.value=_(()=>e.context.refresh())}}});const To=(e,t)=>{let o=!1;return(...i)=>{o||(o=!0,e(...i),setTimeout(()=>{o=!1},t))}};var Io=ue((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const i=U(()=>le(t)),a=U(()=>le(o)),n=[],u=s=>{s&&n.push(s)},l=()=>{n.forEach(s=>s())};return ie(()=>{if(l(),i.value){const s=To(e.context.refresh,a.value);u(Ve("VISIBLE_LISTENER",s)),u(Ve("FOCUS_LISTENER",s))}}),Ce(()=>{l()}),{}});function _e(e,t){return yo(e,t,[Co,co,uo,xo,mo,Io,fo,po,Vo])}function xe(){const{request:e}=q(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:p=>e.get(t.detail,{params:p}),getApprovalNode:p=>e.post(t.approvalNode,p),startTask:p=>e.post(t.start,p),commitTask:p=>e.post(t.commit,p),saveDraft:p=>e.post(t.draft,p),revokeTask:p=>e.post(t.revoke,p),terminateTask:p=>e.post(t.terminate,p),withdrawTask:p=>e.post(t.withdraw,p),transferTask:p=>e.post(t.transfer,p),getPublishFlow:()=>e.get(t.publish),getTodoList:p=>e.get(t.todo,{params:p})}}function Oo(e){const{commitTask:t,revokeTask:o,saveDraft:i,startTask:a,terminateTask:n,transferTask:u,withdrawTask:l}=xe(),s=U(()=>{const{flowDetail:d,formVariables:m,approvalFormData:_,debug:p,fileIds:c}=e,{flowDeployId:w}=d.value.process??{},{taskId:v,flowInstanceId:h}=d.value.task??{};return{flowDeployId:w,taskId:v,flowInstanceId:h,variables:m.value,debug:p.value,fileIds:c.value,..._.value}}),r=()=>s.value.taskId&&s.value.flowInstanceId;return{flow_draft(){if(r())return i(s.value)},flow_pass(){return r()?t(s.value):a(s.value)},flow_revoke(){if(r())return o(s.value)},flow_withdraw(){if(r())return l(s.value)},flow_terminate(){if(r())return n(s.value)},flow_transfer(){if(r())return u(s.value)}}}function No(e){const t=O({});return ie(async()=>{var i;const{formProperty:o}=((i=g(e))==null?void 0:i.properties)||{};o!=null&&o.length&&(await pe(),Object.keys(t.value).forEach(a=>{var l,s,r,d;const n=((l=t.value[a])==null?void 0:l.label)||"",u=o==null?void 0:o.find(m=>m.prop===a);if(t.value[a].display=u==null?void 0:u.display,t.value[a].disabled=u==null?void 0:u.disabled,t.value[a].detail=u==null?void 0:u.detail,t.value[a].readonly=u==null?void 0:u.readonly,t.value[a].rules=t.value[a].rules??[],u!=null&&u.required&&((s=t.value[a].rules)!=null&&s.some(m=>m.required)))return null;u!=null&&u.required?(r=t.value[a].rules)==null||r.push({required:!0,message:`${n}为必填项`}):t.value[a].rules=(d=t.value[a].rules)==null?void 0:d.filter(m=>!m.required)}))}),t}function Lo(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function $o(){return{complete:e=>e}}const vt=Symbol("flowFormState");function So(e,t){const o=ye(e,void 0,{passive:!0,deep:!0}),{flowDetail:i,modelValue:a,formLoading:n}=o,{getFlowDetail:u}=xe();ie(()=>{const{flowKey:c,taskId:w,instanceId:v}=e;!c&&!w&&!v||(n.value=!0,u({flowKey:c,taskId:w,flowInstanceId:v}).then(h=>{i.value=h.data,a.value=h.data.formData||{}}).finally(()=>{n.value=!1}))});const l=U(()=>({fileTab:!0,trackTab:!0,...e.permission})),s=U(()=>{var c,w,v,h;return l.value.fileTab===!0&&((h=(v=(w=(c=i.value)==null?void 0:c.properties)==null?void 0:w.formProperty)==null?void 0:v.find(y=>y.prop==="fileTab"))==null?void 0:h.display)}),r=U(()=>{var c,w,v,h;return l.value.trackTab===!0&&((h=(v=(w=(c=i.value)==null?void 0:c.properties)==null?void 0:w.formProperty)==null?void 0:v.find(y=>y.prop==="trackTab"))==null?void 0:h.display)}),d=O(!1),m=U(()=>Object.entries(a.value||{}).filter(([c])=>!c.startsWith("$")).map(([c,w])=>({key:c,value:w}))),_=O(),p={...o,formData:a,formVariables:m,approvalVisible:d,showFileTab:s,showTrackTab:r,permission:l,fileIds:_,emit:t};return At(vt,p),p}function _t(){return Ke(vt)}function qe(e){return new Promise((t,o)=>{g(e).validate((a,n,u)=>{a?(n(),t(u)):o(u)})})}const Uo=M({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=ye(e,void 0,{passive:!0,deep:!0}),o=No(e.flowDetail),{proxy:i}=rt(),a=O({});ie(()=>{const{formOption:l}=e.flowDetail.process??{};a.value=it.bind(i)(l||'{"menuBtn":false}'),a.value.detail=!!e.detail});const n=O();function u(){return qe(n)}return{form:t,option:a,defaults:o,formRef:n,validate:u}},render(){return Ee(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Ro=M({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Yt(e,"modelValue"),{batchUpdate:i,create:a,remove:n,useList:u}=el(),l=O(!1),{activeBtn:s}=_t(),r=U(()=>{var D;return(D=s.value)==null?void 0:D.buttonKey}),{data:d,refresh:m}=u(r),_=U(()=>{var k,N,L;const D=o.value;if(D&&!((k=d.value)!=null&&k.some(S=>S.content===D))){const S=(((L=(N=d.value)==null?void 0:N[0])==null?void 0:L.sort)||1)-1;return[{content:D,sort:S},...d.value||[]]}return d.value});async function p(D){var k;await a({...D,type:(k=s.value)==null?void 0:k.buttonKey}),oe.success("添加成功"),m()}async function c(D){await n(D.id),oe.success("删除成功"),m()}async function w(D,k){let N=k.parent.data;N=N.map((L,S)=>({id:L.id,sort:S+1})),await i(N),oe.success("修改排序成功"),m(),l.value=!1}function v(){l.value=!0}const h=O();async function y(D){var k;o.value=D.content,await pe(),(k=h.value)==null||k.blur()}return(D,k)=>{const N=V("el-input"),L=V("el-text"),S=V("el-col"),R=V("el-button"),E=V("el-row"),C=V("el-tree"),I=V("el-popover");return x(),$(I,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:f(()=>[b(N,{ref_key:"inputRef",ref:h,modelValue:g(o),"onUpdate:modelValue":k[0]||(k[0]=T=>ee(o)?o.value=T:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:k[1]||(k[1]=T=>l.value=!0),onBlur:k[2]||(k[2]=T=>l.value=!1)},null,8,["modelValue"])]),default:f(()=>[b(C,{data:_.value,"node-key":"content",draggable:"","allow-drop":(T,j,Q)=>Q!=="inner",props:{label:"content"},onNodeClick:y,onNodeDrop:w,onNodeDragStart:v},{default:f(({data:T})=>[b(E,{style:{width:"250px"}},{default:f(()=>[b(S,{span:20},{default:f(()=>[b(L,{truncated:"",title:T.content},{default:f(()=>[P(B(T.content),1)]),_:2},1032,["title"])]),_:2},1024),b(S,{span:4},{default:f(()=>[T.id?(x(),$(R,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:lt(j=>c(T),["stop"])},null,8,["onClick"])):(x(),$(R,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:lt(j=>p(T),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Po=M({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=xe(),i={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:a,approvalFormData:n,activeBtn:u,approvalVisible:l,formVariables:s,flowDetail:r}=_t(),d=O([]),m=O([]),_=O([]),p=O([]),c=O(),w=O({}),v={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function h(I,T,j){var G;const Q=d.value[0].type==="ParallelGateway",W=(G=d.value[0].children)==null?void 0:G.every(ce=>Qt([ce],J=>m.value.some(Z=>Z.id===J.id)));if(m.value.length){if(Q&&!W)return j("请在每个节点选择审批人")}else return j("请选择审批人");return!0}const y=O(),D=U(()=>{var I,T;return(T=(I=u.value)==null?void 0:I.approval)==null?void 0:T.includes("assignee")}),k=U(()=>{var I,T;return(T=(I=u.value)==null?void 0:I.approval)==null?void 0:T.includes("circulate")}),N=U(()=>{var I,T;return(T=(I=u.value)==null?void 0:I.approval)==null?void 0:T.includes("copyUser")}),L=O(!1),S=O(!1);ie(async()=>{var Q,W,G,ce,J;if(!l.value||!c.value)return;const{flowKey:I}=((Q=r.value)==null?void 0:Q.process)||{},{taskId:T}=((W=r.value)==null?void 0:W.task)||{};d.value=[],m.value=[],_.value=[],p.value=[];const j=T?"":"发起";if(n.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:a.value.comment||j},pe(()=>{var Z,H;w.value.assignee.display=D.value,w.value.circulate.display=k.value,w.value.copyUser.display=N.value,w.value.comment.display=(H=(Z=u.value)==null?void 0:Z.approval)==null?void 0:H.includes("comment")}),D.value)try{S.value=!0;const Z=u.value.buttonKey!=="flow_transfer",H=await o({flowKey:I,variables:s.value,taskId:T,loadConfig:Z});d.value=Fe(H.data??[],(se,tt,K)=>{const me=se.id||Pe();return se.taskNodeKey=(K==null?void 0:K.taskNodeKey)??se.taskNodeKey,se.incoming=(K==null?void 0:K.incoming)??se.incoming,{...se,id:me,disabled:se.type!=="user"}}),await pe();const F=R(d.value);F&&((G=y.value)==null||G.setCheckedNodes([F]))}finally{S.value=!1}if(N.value){const Z=await o({flowKey:I,variables:s.value,taskId:T,loadConfig:!1});_.value=Fe(((J=(ce=Z.data)==null?void 0:ce[0])==null?void 0:J.children)??[],H=>{var F;return H.id||Pe(),{...H,label:H.title,disabled:H.type!=="user"&&!((F=H.children)!=null&&F.length)}})}});function R(I){var T;if(I.length===1)return(T=I[0].children)!=null&&T.length?R(I[0].children):I[0]}async function E(I,T){var Q,W;if(I.type!=="user")return;await pe(),await pe();const j=(Q=y.value)==null?void 0:Q.getCheckedNodes();m.value=j.filter(G=>G.type==="user"),(W=y.value)==null||W.setCheckedNodes(m.value)}async function C(){await qe(c),L.value=!0;const I={},T={},j=new Set;m.value.forEach(Q=>{const{taskNodeKey:W,incoming:G}=Q;I[W]||(I[W]=new Set),Q.userId&&I[W].add(Q.userId),T[W]=[...I[W]].join(","),j.add(G)}),n.value.assignee=T,n.value.outgoing=[...j],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",a),t("confirm")}return(I,T)=>{const j=V("el-col"),Q=V("el-tag"),W=V("el-tree-select"),G=V("avue-form"),ce=V("el-row"),J=V("el-button"),Z=V("el-dialog"),H=Be("loading");return x(),$(Z,{modelValue:g(l),"onUpdate:modelValue":T[6]||(T[6]=F=>ee(l)?l.value=F:null),title:g(u).name,width:D.value?"800px":"500px","append-to-body":""},{footer:f(()=>[b(J,{onClick:T[5]||(T[5]=F=>l.value=!1)},{default:f(()=>[P(" 取 消 ")]),_:1}),b(J,{type:"primary",onClick:C},{default:f(()=>[P(" 确 定 ")]),_:1})]),default:f(()=>[b(ce,{gutter:20},{default:f(()=>[D.value?(x(),$(j,{key:0,span:10},{default:f(()=>[je((x(),$(g(Rt),{ref_key:"treeRef",ref:y,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:d.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:E},{default:f(({data:F})=>[X("div",null,[b(g(re),{icon:i[F.type],style:{display:"inline-block"}},null,8,["icon"]),X("span",null,B(F.title),1)])]),_:1},8,["data"])),[[H,S.value]])]),_:1})):z("",!0),b(j,{span:D.value?14:24},{default:f(()=>[b(G,{ref_key:"formRef",ref:c,modelValue:g(n),"onUpdate:modelValue":T[3]||(T[3]=F=>ee(n)?n.value=F:null),defaults:w.value,"onUpdate:defaults":T[4]||(T[4]=F=>w.value=F),option:v},{assignee:f(()=>[(x(!0),A(Y,null,fe(m.value,F=>(x(),$(Q,{key:F.id,type:"info"},{default:f(()=>[P(B(F.title),1)]),_:2},1024))),128))]),copyUser:f(()=>[b(W,{modelValue:p.value,"onUpdate:modelValue":[T[0]||(T[0]=F=>p.value=F),T[1]||(T[1]=F=>g(n).copyUser=F.join(","))],data:_.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:f(()=>[b(Ro,{modelValue:g(n).comment,"onUpdate:modelValue":T[2]||(T[2]=F=>g(n).comment=F)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Eo=Jt,at=M({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:i}=ll(),a=U({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(r){t("update:modelValue",r.join(","))}}),n=U({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(r){t("update:modelValue",r)}}),u=O([]),l=O(!1),s=U(()=>{var r,d;return(d=(r=o.tableData)==null?void 0:r.row)==null?void 0:d.type});return we(s,r=>{["dept","post","user"].includes(r)&&(l.value=!0,i(r==="user"?"":r).then(d=>{u.value=Fe(d.data,m=>({label:m.title,value:m.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(r,d)=>{const m=V("el-tree-select"),_=V("el-input");return["dept","post","user"].includes(s.value)?(x(),$(m,{key:0,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=p=>a.value=p),data:u.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(x(),$(_,{key:1,modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=p=>n.value=p)},null,8,["modelValue"]))}}}),Fo={key:0,class:"flow-viewer"},Ao={class:"flow-status-legend"},Mo=M({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{FlowViewer:i,FlowModeler:a}=q(),n=U({get(){let c=Gt();return typeof o.modelValue=="string"&&o.modelValue?c=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(c=o.modelValue),c},set(c){t("update:modelValue",JSON.stringify(c))}}),u=U(()=>{const{column:c=[],group:w=[]}=JSON.parse(o.flowFormOption||"{}");return[...c,...w.map(h=>h.column??[]).flat()]}),{data:l}=Je().useList(),s=U(()=>{var c;return{formPropertyList:u.value,buttonList:(c=l.value)==null?void 0:c.filter(w=>w.status===1),fieldsDic:u.value.map(w=>({label:w.label,value:`\${${w.prop}}`,desc:`\${${w.prop}}`})),flowButtonDisplayDic:de(He),flowButtonApprovalDic:de(Ge)}}),r=O({}),d=O({});Xt(d,async c=>{var w,v,h,y,D,k,N,L,S;c&&((h=(v=(w=c.assignee)==null?void 0:w.children)==null?void 0:v.column)!=null&&h[1]&&(c.assignee.children.column[1].component=at),(S=(L=(N=(k=(D=(y=c.circulate)==null?void 0:y.children)==null?void 0:D.column)==null?void 0:k[1])==null?void 0:N.children)==null?void 0:L.column)!=null&&S[1]&&(c.circulate.children.column[1].children.column[1].component=at))},{debounce:1});const{data:m}=Ie().useParam("flow.task.status"),_=U(()=>{var c;return(c=o.flowHistory)==null?void 0:c.map(w=>{var h,y;const v=(y=(h=m.value)==null?void 0:h.find(D=>D.value===w.status))==null?void 0:y.style;return{id:w.taskNodeKey,style:v}})}),p=U(()=>{var c,w;return(w=(c=o.flowHistory)==null?void 0:c.filter(v=>v.taskNodeType==="userTask"))==null?void 0:w.map(v=>{var h;return{id:v.taskNodeKey,content:`<div>${v.assigneeName}</div>
        <div>${v.endTime??""}</div>
        <div>${((h=v.comment)==null?void 0:h.comment)??""}</div>`}})});return(c,w)=>c.view?(x(),A("div",Fo,[X("div",Ao,[(x(!0),A(Y,null,fe(g(m),v=>{var h;return x(),A("div",{key:v.label,class:"legend-item"},[X("div",{class:"legend-color",style:Mt({backgroundColor:(h=v.style)==null?void 0:h.fill})},null,4),X("span",null,B(v.label),1)])}),128))]),b(g(i),{"model-value":n.value,styles:_.value,tooltips:p.value},null,8,["model-value","styles","tooltips"])])):(x(),$(g(a),{key:1,modelValue:n.value,"onUpdate:modelValue":w[0]||(w[0]=v=>n.value=v),formData:r.value,"onUpdate:formData":w[1]||(w[1]=v=>r.value=v),formDefaults:d.value,"onUpdate:formDefaults":w[2]||(w[2]=v=>d.value=v),"form-options":g(Eo),"data-options":s.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const Te=ze(Mo,[["__scopeId","data-v-4ae21014"]]),Ko={class:"flow-track"},Bo={key:0},jo={key:1},zo=M({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=O("table"),i=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],a=U(()=>{var s,r,d;return((d=(r=(s=t.flowDetail)==null?void 0:s.flowHistory)==null?void 0:r.filter(m=>m.taskNodeType==="userTask"))==null?void 0:d.map(m=>({...m,duration:It(m.duration)})))??[]}),n={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:u}=Ie().useParam("flow.handle.type");function l(s){var r;return(r=u.value)==null?void 0:r.find(d=>d.value===s)}return(s,r)=>{var h,y,D;const d=V("el-radio-button"),m=V("el-radio-group"),_=V("avue-crud"),p=V("el-card"),c=V("el-timeline-item"),w=V("el-timeline"),v=V("el-empty");return x(),A(Y,null,[b(m,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=k=>o.value=k)},{default:f(()=>[(x(),A(Y,null,fe(i,k=>b(d,{key:k.label,label:k.label},{default:f(()=>[b(g(re),{icon:k.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),X("div",Ko,[o.value==="table"?(x(),$(_,{key:0,data:a.value,option:n},null,8,["data"])):z("",!0),o.value==="graph"?(x(),$(Te,{key:1,"model-value":(y=(h=s.flowDetail)==null?void 0:h.process)==null?void 0:y.flowData,"flow-history":(D=s.flowDetail)==null?void 0:D.flowHistory,view:""},null,8,["model-value","flow-history"])):z("",!0),o.value==="timeline"?(x(),A(Y,{key:2},[a.value.length?(x(),$(w,{key:0},{default:f(()=>[(x(!0),A(Y,null,fe([...a.value].reverse(),k=>(x(),$(c,{key:k.id,timestamp:k.endTime,placement:"top"},{default:f(()=>[b(p,null,{default:f(()=>{var N,L,S;return[X("div",null,B(k.assigneeName)+" 开始处理 ["+B(k.taskNodeName)+"] 环节 ",1),k.duration?(x(),A("div",Bo," 办理时长："+B(k.duration),1)):z("",!0),k.type&&((N=k.comment)!=null&&N.comment)?(x(),A("div",jo,B((L=l(k.type))==null?void 0:L.label)+"意见："+B((S=k.comment)==null?void 0:S.comment),1)):z("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(x(),$(v,{key:1}))],64)):z("",!0)])],64)}}});const Wo=ze(zo,[["__scopeId","data-v-430a7108"]]),Qo=M({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:i}=Je().useList();function a(u,l){return u.map(s=>{const r=l.find(m=>m.buttonKey===s.buttonKey);return{...s,...Pt(r,["display","approval"])}})}const n=U(()=>{var c,w,v,h,y;const u={userId:"1"},{assignee:l,status:s}=((c=o.flowDetail)==null?void 0:c.task)||{},{createUser:r,flowInstanceId:d,status:m}=((w=o.flowDetail)==null?void 0:w.flowInstance)||{},_={true:!0,false:!1,startUser:r==u.userId,assignee:l==u.userId,todo:s==2,done:s==1,notstarted:!d,started:!!d,finished:m===1,unfinished:m===2};return((y=a(i.value??[],((h=(v=o.flowDetail)==null?void 0:v.properties)==null?void 0:h.button)??[]))==null?void 0:y.filter(D=>{var k,N;return(N=(k=D.display)==null?void 0:k.split(","))==null?void 0:N.every(L=>_[L])}))??[]});return(u,l)=>{const s=V("el-button");return x(!0),A(Y,null,fe(n.value,r=>(x(),$(s,{key:r.buttonKey,type:r.buttonType,onClick:d=>t("click",r)},{default:f(()=>[b(g(re),{icon:r.icon},null,8,["icon"]),P(" "+B(r.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),qo=M({__name:"upload-table",props:{flowDetail:{},modelValue:{}},setup(e){const t=e,{modelValue:o}=ye(t,void 0,{passive:!0}),{upload:{action:i,headers:a,preview:n,download:u,props:l}}=q(),s=typeof a=="function"?a():a,r=U(()=>{var y,D;return((D=(y=t.flowDetail)==null?void 0:y.task)==null?void 0:D.flowInstanceId)??Pe()}),d={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:m,getDataList:_,handleDel:p,handleSave:c,afterGetList:w,crudStateRefs:{tableData:v}}=te({crudOption:{...tl(),saveSuccessMsg:"上传成功"},tableOption:d,queryForm:{isLatest:1,flowInstanceId:r.value}});w(()=>{o.value=v.value.map(y=>y.id).join(",")}),_();async function h(y,D){var C,I;const{fileName:k,fileType:N,fileSize:L,fileUrl:S,res:R}=l,E={fileName:ge({res:y},`${R}.${k}`),fileType:ge({res:y},`${R}.${N}`),fileSize:ge({res:y},`${R}.${L}`),fileUrl:ge({res:y},`${R}.${S}`),taskId:(I=(C=t.flowDetail)==null?void 0:C.task)==null?void 0:I.taskId,flowInstanceId:r.value,rootMark:(D==null?void 0:D.rootMark)||"",version:typeof(D==null?void 0:D.version)=="number"?D.version+1:1};await c(E,_,()=>{})}return(y,D)=>{const k=V("el-button"),N=V("el-upload"),L=V("avue-crud");return x(),$(L,ae(ne(g(m))),{"menu-left":f(()=>[b(N,{action:g(i),headers:g(s),"show-file-list":!1,onSuccess:D[0]||(D[0]=S=>h(S))},{default:f(()=>[b(k,{type:"primary",icon:"el-icon-upload"},{default:f(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:f(({row:S,index:R})=>[b(k,{type:"primary",text:"",icon:"el-icon-view",onClick:E=>{var C;return(C=g(n))==null?void 0:C(S,g(v))}},{default:f(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),b(k,{type:"primary",text:"",icon:"el-icon-download",onClick:E=>{var C;return(C=g(u))==null?void 0:C(S,g(v))}},{default:f(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),b(N,{action:g(i),headers:g(s),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:E=>h(E,S)},{default:f(()=>[b(k,{type:"primary",text:"",icon:"el-icon-upload"},{default:f(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),b(k,{type:"primary",text:"",icon:"el-icon-delete",onClick:E=>g(p)(S,R)},{default:f(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ho={class:"flow-form__title"},wt=M({__name:"index",props:Lo(),emits:$o(),setup(e,{emit:t}){const o=e,i=So(o,t),{flowDetail:a,modelValue:n,activeTab:u,activeBtn:l,formLoading:s,approvalVisible:r,submitLoading:d,fileIds:m}=i,_=O();async function p(v){var h,y;l.value=v,await((h=_.value)==null?void 0:h.validate()),await((y=o.beforeClick)==null?void 0:y.call(o,v)),(v==null?void 0:v.approval)!=="false"?r.value=!0:w()}const c=Oo(i);async function w(){var v,h;try{const{buttonKey:y}=l.value;d.value=!0,await((v=o.beforeSubmit)==null?void 0:v.call(o,l.value));const D=(h=c[y])==null?void 0:h.call(c);D instanceof Promise?(await D,oe.success("操作成功"),r.value=!1,t("complete",l.value)):oe.error("操作失败")}finally{d.value=!1}}return(v,h)=>{const y=V("el-skeleton"),D=V("el-main"),k=V("el-header"),N=V("el-tab-pane"),L=V("el-tabs"),S=V("el-container");return g(s)?(x(),$(D,{key:0},{default:f(()=>[b(y)]),_:1})):(x(),$(S,{key:1,class:"flow-form"},{default:f(()=>[b(k,{class:"flow-form__header"},{default:f(()=>{var R;return[X("div",Ho,B((R=g(a).flowInstance)==null?void 0:R.title),1),b(Qo,{"flow-detail":g(a),onClick:p},null,8,["flow-detail"])]}),_:1}),b(D,{class:"flow-form__main"},{default:f(()=>[b(L,{modelValue:g(u),"onUpdate:modelValue":h[2]||(h[2]=R=>ee(u)?u.value=R:null)},{default:f(()=>{var R,E;return[(E=(R=g(a))==null?void 0:R.process)!=null&&E.formPath?Kt(v.$slots,"default",{key:0}):(x(),$(N,{key:1,label:"审批信息",name:"form"},{default:f(()=>[b(Uo,{ref_key:"formRef",ref:_,modelValue:g(n),"onUpdate:modelValue":h[0]||(h[0]=C=>ee(n)?n.value=C:null),"flow-detail":g(a)},null,8,["modelValue","flow-detail"])]),_:1})),b(N,{label:"附件资料",name:"file",lazy:""},{default:f(()=>[b(qo,{modelValue:g(m),"onUpdate:modelValue":h[1]||(h[1]=C=>ee(m)?m.value=C:null),"flow-detail":g(a)},null,8,["modelValue","flow-detail"])]),_:1}),b(N,{label:"流程跟踪",name:"track",lazy:""},{default:f(()=>[b(Wo,{"flow-detail":g(a)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),b(Po,{onConfirm:w})]),_:3}))}}});function yt(e,t){switch(t.type){case"window":return Go(e,t);case"dialog":case"drawer":return Jo(e,t);default:return{open:()=>{},close:()=>{}}}}function Go(e,t){const{window:{url:o="",name:i="flow-form",features:a="left=0,top=0,width=1600,height=900"}={}}=t,n=O(null),u=U(()=>`${o}?${Ot(Nt(e,Lt($t,St)))}`);return{open:()=>{var r;n.value=window.open(u.value,i,a),(r=n.value)==null||r.addEventListener("message",d=>{const{event:m}=d.data,_=g(e)[m];typeof _=="function"&&_(d.data)})},close:()=>{var r;return(r=n.value)==null?void 0:r.close()},openedWindow:n}}function Jo(e,t){const{appContext:o}=rt();let i;const a=()=>{i=document.createElement("div"),i.className="flow-form-wrapper";const u=Yo(t.formPath),l=Ee(u,{...g(e)}),s=Ee(t.type==="dialog"?Et:Ft,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:n,...t.overlay},l);s.appContext=o,jt(s,i),document.body.appendChild(i)},n=()=>{i&&document.body.removeChild(i)};return{open:a,close:n}}function Yo(e){return e?Bt(()=>zt(()=>import(e),[])):wt}const nt=Symbol("flowPagesConfig"),Xo={FlowModeler:null,FlowViewer:null,FormDesign:null,request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var bt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(bt||{});const Ae=de(bt);function q(e,t){return e&&t?(e.provide(nt,Ut(Xo,t)),t):Ke(nt)}var gt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(gt||{}),He=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(He||{}),Ge=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(Ge||{}),ht=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(ht||{});function Je(){const{request:e}=q(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Zo(){const{request:e}=q(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function el(){const{request:e}=q(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=s=>e.get(t.list,{params:{type:s,ascs:"sort"}});return{url:t,getList:o,useList:s=>_e(()=>o(s.value).then(r=>r.data.records),{refreshDeps:[s]}),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),batchUpdate:s=>e.post(t.batchUpdate,s)}}function Ye(){const{request:e}=q(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var kt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(kt||{});function Xe(){const{request:e}=q(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:n=>e.get(t.list,{params:n}),getDetail:n=>e.get(t.detail,{params:n}),update:n=>e.post(t.update,n)}}function tl(){const{request:e}=q(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:n=>e.get(t.list,{params:n}),create:n=>e.post(t.save,n),remove:n=>e.post(t.remove,{},{params:{ids:n}})}}function ol(){const{request:e}=q(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:i=>e.get(t.list,{params:i})}}function Ie(){const{request:e}=q(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=r=>e.get(t.list,{params:r}),i=()=>e.get(t.all),a=r=>e.get(t.key,{params:{paramKey:r}});return{url:t,getList:o,getAllParam:i,getParam:a,useParam:r=>_e(()=>a(r).then(d=>d.data)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}})}}function Vt(){const{request:e}=q(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ll(){const{request:e}=q(),t={tree:"/sapier-flow/flow-user/tree"},o=a=>e.get(t.tree,{params:{filter:a}});return{url:t,getUserTree:o,useUserTree:()=>_e(()=>o().then(a=>a.data))}}function Dt(){const{request:e}=q(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Ct=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ct||{});function Me(){const{request:e}=q(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=s=>e.get(t.list,{params:s});return{url:t,getList:o,useList:()=>_e(()=>o({size:-1}).then(s=>s.data.records)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),deploy:s=>e.post(t.deploy,s)}}const al={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:de(gt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(He),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(Ge),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:de(ht)},{label:"按钮预览",prop:"buttonPreview",width:150}]},nl=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i}=te({tableOption:al,crudOption:Je(),sortOption:{ascs:"sort"}});return i(),(a,n)=>{const u=V("el-button"),l=V("avue-crud");return x(),$(l,ae(ne(g(t))),{icon:f(({row:s})=>[b(g(re),{icon:s.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:f(({row:s})=>[b(u,{type:s.buttonType},{default:f(()=>[b(g(re),{icon:s.icon},null,8,["icon"]),P(" "+B(s.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":f(()=>[b(u,{type:g(o).buttonType},{default:f(()=>[b(g(re),{icon:g(o).icon},null,8,["icon"]),P(" "+B(g(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ze={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},sl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Ze.column.map((e,t)=>({...e,search:t<=2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},xt=M({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:i,deploy:a}=Ye(),{bindVal:n,crudStateRefs:{searchForm:u},getDataList:l}=te({tableOption:sl,crudOption:{getList:i},searchForm:{categoryId:o.categoryId}});ie(()=>{u.value.categoryId=o.categoryId??"",l()});const s=O(!1);async function r(d){await De.confirm("发布新版本，是否确认？","提示",{type:"success"}),s.value=!0,a({flowModuleId:d.flowModuleId}).then(()=>{oe.success("发布成功"),l()}).finally(()=>{s.value=!1})}return(d,m)=>{const _=V("el-button"),p=V("avue-crud");return x(),$(p,ae(ne(g(n))),{"menu-left":f(()=>[b(_,{type:"primary",icon:"el-icon-plus",onClick:m[0]||(m[0]=c=>t("add"))},{default:f(()=>[P(" 新增 ")]),_:1})]),menu:f(({row:c})=>[b(_,{loading:s.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",c)},{default:f(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),b(_,{loading:s.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",c)},{default:f(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),b(_,{loading:s.value,type:"text",icon:"el-icon-upload",onClick:w=>r(c)},{default:f(()=>[P(" 发布 ")]),_:2},1032,["loading","onClick"]),b(_,{loading:s.value,type:"text",icon:"el-icon-switch",onClick:w=>t("version",c)},{default:f(()=>[P(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:f(({row:c})=>[b(g(re),{icon:c.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),rl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Ze.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Tt=M({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:i,update:a}=Xe(),{bindVal:n,crudStateRefs:{searchForm:u},getDataList:l}=te({tableOption:rl,crudOption:{getList:i,dataPath:"res.data"}});ie(()=>{o.flowModuleId&&(u.value.flowModuleId=o.flowModuleId,l())});const s=O(!1);async function r(d){await De.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),s.value=!0,a({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{oe.success("设置成功"),l()}).finally(()=>{s.value=!1})}return(d,m)=>{const _=V("el-button"),p=V("avue-crud");return x(),$(p,ae(ne(g(n))),{"menu-left":f(()=>[b(_,{loading:s.value,type:"primary",icon:"el-icon-arrow-left",onClick:m[0]||(m[0]=c=>t("back"))},{default:f(()=>[P(" 返回 ")]),_:1},8,["loading"])]),menu:f(({row:c})=>[b(_,{loading:s.value,type:"text",icon:"el-icon-view",onClick:w=>t("view",c)},{default:f(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),b(_,{loading:s.value,type:"text",icon:"el-icon-edit",onClick:w=>t("edit",c)},{default:f(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),b(_,{loading:s.value,disabled:c.mainVersion===g(kt).是,type:"text",icon:"el-icon-switch",onClick:w=>r(c)},{default:f(()=>[P(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:f(({row:c})=>[b(g(re),{icon:c.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},il=M({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:i},getDataList:a,handleSave:n,handleUpdate:u,handleDel:l}=te({crudOption:{rowKey:"id",...Zo(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});a();function s(m,_,p,c){n(_,p,c)}function r(m,_,p,c){u(_,NaN,p,c)}async function d(m,_){await l(m.data,NaN),_()}return(m,_)=>{const p=V("avue-tree");return x(),$(p,{modelValue:g(o),"onUpdate:modelValue":_[0]||(_[0]=c=>ee(o)?o.value=c:null),option:g(st),data:g(i),onNodeClick:_[1]||(_[1]=c=>t("node-click",c)),onSave:s,onUpdate:r,onDel:d},null,8,["modelValue","option","data"])}}}),et=M({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var s;const o=e,{FormDesign:i}=q(),a=U({get(){return o.modelValue?it(o.modelValue):{menuBtn:!1,span:24}},set(r){t("update:modelValue",qt(r,{useJson5:!1}))}}),n=U(()=>o.fields?JSON.parse(o.fields):[]),u=U(()=>{const r={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...r,props:{label:"name",value:"name",desc:"comment"}},{...r,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((s=Ht.settings)==null?void 0:s.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(r,d)=>{const m=V("avue-form");return r.view?(x(),$(m,{key:0,class:Wt(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(x(),$(g(i),{key:1,modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),"base-option":u.value,resources:l},null,8,["modelValue","base-option"]))}}}),ul=X("span",null,"流程设计",-1),cl={key:0},dl={key:1},pl={style:{height:"calc(100vh - 144px)"}},fl=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const i=ye(e),{visible:a,modelValue:n}=i,{create:u,deploy:l,getDetail:s,update:r}=Ye(),{getDetail:d,update:m}=Xe(),_=["流程信息","表单设计","模型设计","完成"],p=O(!1);we(a,async E=>{if(!E)return;const{flowModuleId:C}=n.value,{flowDeployId:I}=n.value;try{p.value=!0;let T={};I?T=await d({flowDeployId:I}):C&&(T=await s({flowModuleId:C})),n.value=T.data}finally{p.value=!1}},{immediate:!0});const{data:c}=Dt().useList(),{data:w}=Vt().useList(),{data:v}=Me().useList(),h=U(()=>{var E,C;return(C=(E=v.value)==null?void 0:E.find(I=>I.tableName===n.value.formDataTable))==null?void 0:C.tableFields}),y=O(0),D=U(()=>{var E,C;return y.value===1?((E=c.value)==null?void 0:E.map(I=>({label:I.formName,value:I.formOption})))??[]:y.value===2?((C=w.value)==null?void 0:C.map(I=>({label:I.flowName,value:I.flowData})))??[]:[]});function k(E){y.value===1?n.value.formOption=E.value:y.value===2&&(n.value.flowData=E.value)}const N=O();async function L(E){y.value===0&&await qe(N),p.value=!0;const{flowModuleId:C}=n.value,{flowDeployId:I}=n.value;try{I?await m(n.value):C?await r(n.value):await u(n.value).then(T=>{n.value.flowModuleId=T.data.flowModuleId}),oe.success("保存成功")}finally{p.value=!1}typeof E=="number"?y.value=E:y.value++}async function S(){await De.confirm("发布新版本，是否确认？","提示"),p.value=!0,l({flowModuleId:n.value.flowModuleId}).then(()=>{oe.success("发布成功")}).finally(()=>{p.value=!1})}function R(){a.value=!1,y.value=0,n.value={},t("close")}return(E,C)=>{const I=V("el-link"),T=V("el-dropdown-item"),j=V("el-dropdown-menu"),Q=V("el-dropdown"),W=V("el-col"),G=V("el-step"),ce=V("el-steps"),J=V("el-button"),Z=V("el-row"),H=V("avue-form"),F=V("el-result"),se=V("el-dialog"),tt=Be("loading");return x(),$(se,{modelValue:g(a),"onUpdate:modelValue":C[5]||(C[5]=K=>ee(a)?a.value=K:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:R},{header:f(()=>[b(Z,{justify:"center"},{default:f(()=>[b(W,{span:5},{default:f(()=>{var K,me,Oe,ot;return[X("div",null,[ul,(K=g(n))!=null&&K.flowName?(x(),A("span",cl," - "+B((me=g(n))==null?void 0:me.flowName),1)):z("",!0),(Oe=g(n))!=null&&Oe.version?(x(),A("span",dl," - V"+B((ot=g(n))==null?void 0:ot.version),1)):z("",!0)]),D.value.length?(x(),$(Q,{key:0},{dropdown:f(()=>[b(j,null,{default:f(()=>[(x(!0),A(Y,null,fe(D.value,Ne=>(x(),$(T,{key:Ne.label,onClick:Rl=>k(Ne)},{default:f(()=>[P(B(Ne.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:f(()=>[b(I,{icon:"el-icon-arrow-down",underline:!1},{default:f(()=>[P(" 选择模板 ")]),_:1})]),_:1})):z("",!0)]}),_:1}),b(W,{span:14},{default:f(()=>[b(ce,{active:y.value,simple:"","process-status":"finish","finish-status":"success"},{default:f(()=>[(x(),A(Y,null,fe(_,(K,me)=>b(G,{key:me,title:K,onClick:Oe=>L(me)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),b(W,{span:5,style:{"text-align":"right"}},{default:f(()=>[b(J,{disabled:y.value===0,loading:p.value,type:"primary",onClick:C[0]||(C[0]=K=>y.value--)},{default:f(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),b(J,{disabled:y.value===_.length-1,type:"primary",loading:p.value,onClick:C[1]||(C[1]=K=>L())},{default:f(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),b(J,{onClick:R},{default:f(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:f(()=>[je((x(),A("div",pl,[y.value===0?(x(),$(H,{key:0,ref_key:"formRef",ref:N,modelValue:g(n),"onUpdate:modelValue":C[2]||(C[2]=K=>ee(n)?n.value=K:null),option:g(Ze),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):z("",!0),y.value===1?(x(),$(et,{key:1,modelValue:g(n).formOption,"onUpdate:modelValue":C[3]||(C[3]=K=>g(n).formOption=K),fields:h.value},null,8,["modelValue","fields"])):z("",!0),y.value===2?(x(),$(Te,{key:2,modelValue:g(n).flowData,"onUpdate:modelValue":C[4]||(C[4]=K=>g(n).flowData=K),"flow-form-option":g(n).formOption},null,8,["modelValue","flow-form-option"])):z("",!0),y.value===3?(x(),$(F,{key:3,icon:"success",title:"流程设计完成"},{extra:f(()=>[g(n).flowDeployId?z("",!0):(x(),$(J,{key:0,type:"primary",onClick:S},{default:f(()=>[P(" 发布 ")]),_:1})),b(J,{onClick:R},{default:f(()=>[P(" 关闭 ")]),_:1})]),_:1})):z("",!0)])),[[tt,p.value]])]),_:1},8,["modelValue"])}}}),ml=X("span",null,"流程查看",-1),vl={key:0},_l={key:1},wl=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=ye(e),{visible:i,modelValue:a}=o,{getDetail:n}=Ye(),{getDetail:u}=Xe(),l=O("form"),s=O(!1);we(i,async d=>{if(!d)return;const{flowModuleId:m}=a.value,{flowDeployId:_}=a.value;try{s.value=!0;let p={};_?p=await u({flowDeployId:_}):m&&(p=await n({flowModuleId:m})),a.value={...p.data}}finally{s.value=!1}},{immediate:!0});function r(){a.value={},l.value="form"}return(d,m)=>{const _=V("el-tab-pane"),p=V("el-tabs"),c=V("el-dialog"),w=Be("loading");return x(),$(c,{modelValue:g(i),"onUpdate:modelValue":m[3]||(m[3]=v=>ee(i)?i.value=v:null),width:"60%",top:"0",onClose:r},{header:f(()=>{var v,h,y,D;return[ml,(v=g(a))!=null&&v.flowName?(x(),A("span",vl," - "+B((h=g(a))==null?void 0:h.flowName),1)):z("",!0),(y=g(a))!=null&&y.version?(x(),A("span",_l," - V"+B((D=g(a))==null?void 0:D.version),1)):z("",!0)]}),default:f(()=>[je((x(),$(p,{modelValue:l.value,"onUpdate:modelValue":m[2]||(m[2]=v=>l.value=v)},{default:f(()=>[b(_,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:f(()=>[l.value==="form"&&g(a).formOption?(x(),$(et,{key:0,modelValue:g(a).formOption,"onUpdate:modelValue":m[0]||(m[0]=v=>g(a).formOption=v),view:""},null,8,["modelValue"])):z("",!0)]),_:1}),b(_,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:f(()=>[l.value==="flow"?(x(),$(Te,{key:0,modelValue:g(a).flowData,"onUpdate:modelValue":m[1]||(m[1]=v=>g(a).flowData=v),view:""},null,8,["modelValue"])):z("",!0)]),_:1})]),_:1},8,["modelValue"])),[[w,s.value]])]),_:1},8,["modelValue"])}}}),yl=M({__name:"index",setup(e){const t=O("definition"),o=O({}),i=O(""),a=O("");function n(c){i.value===c.id?i.value="":i.value=c.id}const u=O(!1),l=O(!1);function s(){o.value={},u.value=!0}function r(c){o.value=c,u.value=!0}function d(c){o.value=c,l.value=!0}function m(c){a.value=c.flowModuleId||"",t.value="deploy"}function _(){a.value="",t.value="definition"}async function p(){const c=t.value;await pe(),t.value="",await pe(),t.value=`${c}`}return(c,w)=>{const v=V("el-col"),h=V("el-row");return x(),$(h,{gutter:20},{default:f(()=>[b(v,{span:4},{default:f(()=>[b(il,{onNodeClick:n})]),_:1}),b(v,{span:20},{default:f(()=>[t.value==="definition"?(x(),$(xt,{key:0,"category-id":i.value,onAdd:s,onEdit:r,onView:d,onVersion:m},null,8,["category-id"])):z("",!0),t.value==="deploy"?(x(),$(Tt,{key:1,"flow-module-id":a.value,onEdit:r,onView:d,onBack:_},null,8,["flow-module-id"])):z("",!0),b(fl,{modelValue:o.value,"onUpdate:modelValue":w[0]||(w[0]=y=>o.value=y),visible:u.value,"onUpdate:visible":w[1]||(w[1]=y=>u.value=y),onClose:p},null,8,["modelValue","visible"]),b(wl,{modelValue:o.value,"onUpdate:modelValue":w[2]||(w[2]=y=>o.value=y),visible:l.value,"onUpdate:visible":w[3]||(w[3]=y=>l.value=y)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),bl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},gl=M({__name:"index",setup(e){const t=Zt("debugMode",!1),{getList:o}=ol(),{bindVal:i,getDataList:a}=te({tableOption:bl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});a();const n=O({}),{open:u,close:l}=yt(n,{type:"drawer"});function s(r){n.value={flowKey:r.flowKey,taskId:r.taskId,instanceId:r.flowInstanceId,debug:t.value,onComplete:()=>{l(),a()}},u()}return(r,d)=>{const m=V("el-switch"),_=V("el-button"),p=V("el-link"),c=V("avue-crud");return x(),$(c,ae(ne(g(i))),{"menu-right":f(()=>[b(_,{type:"text"},{default:f(()=>[b(m,{modelValue:g(t),"onUpdate:modelValue":d[0]||(d[0]=w=>ee(t)?t.value=w:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:f(({row:w})=>[b(p,{type:"primary",underline:!1,onClick:v=>s(w)},{default:f(()=>[P(B(w.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),hl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ae},{label:"备注",prop:"remark"}]},kl=M({__name:"index",setup(e){const{bindVal:t,getDataList:o}=te({tableOption:hl,crudOption:Ie()});return o(),(i,a)=>{const n=V("avue-crud");return x(),$(n,ae(ne(g(t))),null,16)}}}),Vl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Dl={class:"flow-list"},Cl=["onClick"],xl={class:"flow-name"},Tl=M({__name:"index",setup(e){const t=O([]),{getPublishFlow:o,getTodoList:i}=xe();o().then(_=>{t.value=_.data});const a=O({}),{open:n,close:u}=yt(a,{type:"drawer"});function l(_){a.value={flowKey:_.flowKey,taskId:_.taskId,instanceId:_.flowInstanceId,onComplete:()=>{u(),r()}},n()}const{bindVal:s,getDataList:r,crudStateRefs:{searchForm:d}}=te({tableOption:Vl,crudOption:{getList:i},searchForm:{status:2}}),m=[{label:"待办",value:2},{label:"已办",value:1}];return(_,p)=>{const c=V("el-button"),w=V("el-collapse-item"),v=V("el-collapse"),h=V("el-card"),y=V("el-divider"),D=V("avue-radio"),k=V("el-link"),N=V("avue-crud");return x(),A(Y,null,[b(h,{"body-style":{padding:"0 20px"}},{default:f(()=>[b(v,{"model-value":"1"},{default:f(()=>[b(w,{name:"1"},{title:f(()=>[b(c,{text:"",icon:"el-icon-promotion"},{default:f(()=>[P(" 发起审批 ")]),_:1})]),default:f(()=>[X("div",Dl,[(x(!0),A(Y,null,fe(t.value,L=>(x(),A("div",{key:L.flowKey,class:"flow-item",onClick:S=>l(L)},[b(g(re),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),X("div",xl,B(L.flowName),1)],8,Cl))),128))])]),_:1})]),_:1})]),_:1}),b(y,{direction:"horizontal","content-position":"left"}),b(N,ae(ne(g(s))),{"menu-left":f(()=>[b(D,{modelValue:g(d).status,"onUpdate:modelValue":[p[0]||(p[0]=L=>g(d).status=L),g(r)],button:"",dic:m},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:f(({row:L})=>[b(k,{type:"primary",underline:!1,onClick:S=>l(L)},{default:f(()=>[P(B(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Il=ze(Tl,[["__scopeId","data-v-de4a15fa"]]),Ol={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Nl=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:a}=te({tableOption:Ol,crudOption:Vt()});i();const n=O(!1);async function u(s){o.value=s,n.value=!0}async function l(){await a(o.value,NaN,()=>n.value=!1,()=>{})}return(s,r)=>{const d=V("el-button"),m=V("avue-crud"),_=V("el-dialog");return x(),A(Y,null,[b(m,ae(ne(g(t))),{flowData:f(({row:p})=>[b(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:c=>u(p)},{default:f(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),b(_,{modelValue:n.value,"onUpdate:modelValue":r[2]||(r[2]=p=>n.value=p),title:`模型设计-${g(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[b(d,{type:"primary",onClick:l},{default:f(()=>[P(" 保存 ")]),_:1}),b(d,{onClick:r[1]||(r[1]=p=>n.value=!1)},{default:f(()=>[P(" 取消 ")]),_:1})]),default:f(()=>[b(Te,{modelValue:g(o).flowData,"onUpdate:modelValue":r[0]||(r[0]=p=>g(o).flowData=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ll={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},$l=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:a}=te({tableOption:Ll,crudOption:Dt()});i();const n=O(!1);async function u(s){o.value={...s},n.value=!0}async function l(){await a(o.value,NaN,()=>n.value=!1,()=>{})}return(s,r)=>{const d=V("el-button"),m=V("avue-crud"),_=V("el-dialog");return x(),A(Y,null,[b(m,ae(ne(g(t))),{formOption:f(({row:p})=>[b(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:c=>u(p)},{default:f(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),b(_,{modelValue:n.value,"onUpdate:modelValue":r[2]||(r[2]=p=>n.value=p),title:`表单设计-${g(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[b(d,{type:"primary",onClick:l},{default:f(()=>[P(" 保存 ")]),_:1}),b(d,{onClick:r[1]||(r[1]=p=>n.value=!1)},{default:f(()=>[P(" 取消 ")]),_:1})]),default:f(()=>[b(et,{modelValue:g(o).formOption,"onUpdate:modelValue":r[0]||(r[0]=p=>g(o).formOption=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:de(Ct)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}]}}]},Ul=M({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,beforeOpen:a,beforeSubmit:n}=te({crudOption:Me(),tableOption:Sl});i();const{data:u}=Ie().useParam("table.default.fields");a(d=>{d==="add"?o.value.tableFields=u.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),n(d=>{d.tableFields=JSON.stringify(d.tableFields)});const{deploy:l}=Me(),s=O(!1);async function r(d){await De.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),s.value=!0,l({id:d.id}).then(()=>{oe.success("部署成功"),i()}).finally(()=>{s.value=!1})}return(d,m)=>{const _=V("el-button"),p=V("avue-crud");return x(),$(p,ae(ne(g(t))),{menu:f(({row:c})=>[b(_,{type:"text",icon:"el-icon-upload",onClick:w=>r(c)},{default:f(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ma={install(e,t){e.component("FlowButton",nl).component("FlowDefinition",xt).component("FlowDeploy",Tt).component("FlowForm",wt).component("FlowManage",yl).component("FlowOps",gl).component("FlowParam",kl).component("FlowTemplate",Nl).component("FormTemplate",$l).component("TableTemplate",Ul).component("FlowWorkbench",Il),q(e,t)}};export{Xo as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,nl as FlowButton,xt as FlowDefinition,Tt as FlowDeploy,wt as FlowForm,yl as FlowManage,gl as FlowOps,kl as FlowParam,Nl as FlowTemplate,Il as FlowWorkbench,$l as FormTemplate,Ul as TableTemplate,bt as Whether,Ma as default,Yo as resolveFlowFormComponent,q as useConfigProvider,yt as useFlowForm,Jo as useFlowFormOverlay,Go as useFlowFormWindow,Ae as whetherDic};
