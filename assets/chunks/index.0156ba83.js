import{c as T,C as Se,t as Ae,d as Be,e as Ee,f as Re,g as ne,h as Ke,F as se,b as ze,i as je,T as q,j as We,k as _e,l as Je,m as Ge,n as He,o as Qe,p as Xe}from"./mobile.7cdf542b.js";import{K as jo,L as Wo,D as Jo,w as Go,v as Ho,s as Qo,x as Xo,r as Yo,_ as Zo,z as qo,H as el,N as tl,B as ol,O as ll,W as al,E as nl,I as sl,S as il,R as ul,M as rl,U as dl,X as cl,J as pl,P as ml,q as fl,Q as vl,y as _l,A as wl,a as yl,u as gl,V as bl,G as kl}from"./mobile.7cdf542b.js";import{h as x,a5 as me,aE as Ye,D as Ze,d as P,J as _,b as I,w as o,a9 as K,aa as z,l as m,o as b,N as r,e as N,a as F,t as B,A as ie,B as Q,g as W,n as qe,c as U,L as ee,R as we,K as J,z as ye,aF as ge,k as G,a7 as be,E as fe,_ as et}from"./framework.6b67ac47.js";import"./index.013eb64a.js";import{s as tt}from"./index.386fc70b.js";import{m as ue}from"./merge.0f72b880.js";import{a as ke}from"./omitBy.e7ddedc3.js";import{a as ot}from"./snakeCase.6293e677.js";import{y as lt}from"./baseSet.c6f802bb.js";import{i as at}from"./isNil.990ccdb3.js";import{E as nt,a as st}from"../app.e70e08ec.js";import{u as R}from"./index.3bec44c8.js";import{u as te}from"./index.es.1accc3d3.js";import{I as X}from"./iconify.924204c7.js";import"./index.bd63586e.js";import"./form.07a7ad88.js";import"./index.ba9357f8.js";import"./index.6700b933.js";import{j as it,d as ut}from"./tree.c7a66f34.js";import"./vuedraggable.umd.9831e9f5.js";import{d as rt}from"./union.a37b7994.js";import{a as Y,E}from"./index.6dee874e.js";import{p as De}from"./pick.3451ca24.js";import{w as oe,a as re,u as dt,b as ct,c as pt}from"./index.63550f19.js";import{f as mt,b as ft}from"./form.c7c8470f.js";import{e as vt}from"./index.0246ace1.js";import{d as _t}from"./zipWith.9574e409.js";import"./index.af03a1c8.js";import"./cloneDeep.707d050f.js";import"./initCloneObject.52366613.js";import"./getTag.0b794599.js";import"./data.09f78ca9.js";import"./basePickBy.93df484a.js";import"./pickBy.ee766c69.js";import"./baseMap.4525a961.js";import"./createCompounder.21553c6c.js";import"./theme.446fc1bf.js";import"./index.vue_vue_type_script_setup_true_lang.9d3d440b.js";import"./index.c02d6d41.js";import"./use-form-item.2570ef11.js";import"./isEqual.d232753d.js";import"./index.9dabad22.js";import"./config.287367be.js";import"./index.ac500038.js";import"./set.d1d08ef6.js";import"./kebabCase.9388dd24.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-bundler.21b58301.js";function Ve(d){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},i=f=>d.get(e.list,{params:f});return{getList:i,useList:()=>te(()=>i({size:-1,ascs:"sort"}).then(f=>f.data)),getTree:f=>d.get(e.tree,{params:f}),create:f=>d.post(e.save,f),update:f=>d.post(e.update,f),remove:f=>d.post(e.remove,{},{params:{ids:f}})}}function le(d){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},i=c=>d.get(e.list,{params:c});return{url:e,getList:i,useList:()=>te(()=>i({size:-1,ascs:"sort"}).then(c=>c.data.records)),create:c=>d.post(e.save,c),update:c=>d.post(e.update,c),remove:c=>d.post(e.remove,{},{params:{ids:c}}),deploy:c=>d.post(e.deploy,c),getDetail:c=>d.get(e.detail,{params:c})}}var Fe=(d=>(d[d.否=0]="否",d[d.是=1]="是",d))(Fe||{});function de(d){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:n=>d.get(e.list,{params:n}),getDetail:n=>d.get(e.detail,{params:n}),update:n=>d.post(e.update,n),remove:n=>d.post(e.remove,{},{params:{ids:n}})}}function wt(d){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>d.get(e.list,{params:t})}}function he(d){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},i=p=>d.get(e.list,{params:p});return{url:e,getList:i,useList:()=>te(()=>i({size:-1}).then(p=>p.data.records)),create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}})}}function Ce(d){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},i=p=>d.get(e.list,{params:p});return{url:e,getList:i,useList:()=>te(()=>i({size:-1}).then(p=>p.data.records)),create:p=>d.post(e.save,p),update:p=>d.post(e.update,p),remove:p=>d.post(e.remove,{},{params:{ids:p}})}}function Oe(d,e){return e in(Se.useFlowFormOptions??{})}function $e(d={}){const{useFlowFormOptions:e}=T(),i=ue({...e},{...d});switch(i==null?void 0:i.type){case"window":return yt(i);case"dialog":case"drawer":return gt(i);default:return{open:t=>{},close:()=>{}}}}function yt(d={}){const e=x(null);return{open:(l={})=>{var w;const a=ue({...d},{...l}),{window:[n,p,f]=[]}=a,c=`${n}?${tt(ke(a,ot(lt,at,Oe)))}`;e.value=window.open(c,p,f),(w=e.value)==null||w.addEventListener("message",k=>{const{event:y,data:g}=k.data,s=l[y];typeof s=="function"&&s(g)})},close:()=>{var l;return(l=e.value)==null?void 0:l.close()},openedWindow:e}}function gt(d={}){const{appContext:e}=Ze(),{FlowForm:i}=T();let t,l;const a=p=>{t=document.createElement("div"),t.className="flow-form-wrapper";const f=ue({...d},{...p}),c=me(i,ke(f,Oe));l=me(f.type==="dialog"?nt:st,{class:"flow-form-overlay",modelValue:!0,onClose:n,...f.overlay},c),l.appContext=e,Ye(l,t),document.body.appendChild(t)},n=()=>{var p,f;(f=(p=l==null?void 0:l.component)==null?void 0:p.props)!=null&&f.modelValue&&(l.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:a,close:n}}const bt=P({__name:"index",setup(d){const{request:e}=T(),{bindVal:i,crudStateRefs:{formData:t},getDataList:l}=R({tableOption:Ae,crudOption:Be(e),sortOption:{ascs:"sort"}});return l(),(a,n)=>{const p=_("el-button"),f=_("avue-crud");return b(),I(f,K(z(m(i))),{icon:o(({row:c})=>[r(m(X),{icon:c.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:c})=>[r(p,{type:c.buttonType},{default:o(()=>[c.icon?(b(),I(m(X),{key:0,icon:c.icon},null,8,["icon"])):N("",!0),F(" "+B(c.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[r(p,{type:m(t).buttonType},{default:o(()=>[m(t).icon?(b(),I(m(X),{key:0,icon:m(t).icon},null,8,["icon"])):N("",!0),F(" "+B(m(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ie=P({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(d,{emit:e}){const i=d,{request:t}=T(),{getList:l,deploy:a,update:n,remove:p}=le(t),{bindVal:f,crudStateRefs:{searchForm:c},getDataList:w}=R({tableOption:Ee,crudOption:{getList:l,remove:p},sortOption:{ascs:"sort"},searchForm:{categoryId:i.categoryId}});ie(()=>{c.value.categoryId=i.categoryId??""}),oe(c,w,{debounce:300,immediate:!0,deep:!0});const k=x(!1);async function y(v){await Y.confirm("发布新版本，是否确认？","提示",{type:"success"}),k.value=!0,a({flowModuleId:v.flowModuleId}).then(()=>{E.success("发布成功"),w()}).finally(()=>{k.value=!1})}async function g(v){if(v.mainVersion)return E.warning("请先删除已发布的流程");await Y.confirm("确认删除？","提示",{type:"warning"}),await p(v.flowModuleId),E.success("删除成功"),w()}function s(v){n(De(v,["flowModuleId","flowKey","sort"])),w()}const u=rt(s,500);return(v,D)=>{const h=_("el-button"),$=_("el-dropdown-item"),C=_("el-input-number"),L=_("avue-crud");return b(),I(L,K(z(m(f))),{"menu-left":o(()=>[r(h,{type:"primary",icon:"el-icon-plus",onClick:D[0]||(D[0]=O=>e("add"))},{default:o(()=>[F(" 新增 ")]),_:1})]),"menu-btn":o(({row:O})=>[r($,{icon:"el-icon-view",onClick:V=>e("view",O)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),r($,{icon:"el-icon-edit",onClick:V=>e("edit",O)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),r($,{icon:"el-icon-delete",onClick:V=>g(O)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),r($,{icon:"el-icon-upload",onClick:V=>y(O)},{default:o(()=>[F(" 发布 ")]),_:2},1032,["onClick"]),r($,{icon:"el-icon-switch",onClick:V=>e("version",O)},{default:o(()=>[F(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:O})=>[r(m(X),{icon:O.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:O})=>[r(C,{modelValue:O.sort,"onUpdate:modelValue":V=>O.sort=V,"controls-position":"right",style:{width:"100%"},onChange:V=>m(u)(O)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),xe=P({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(d,{emit:e}){const i=d,{request:t}=T(),{getList:l,update:a,remove:n}=de(t),{bindVal:p,crudStateRefs:{searchForm:f},getDataList:c}=R({tableOption:Re,crudOption:{getList:l,dataPath:"res.data"},sortOption:{descs:"version"}});ie(()=>{f.value.flowModuleId=i.flowModuleId}),oe(f,c,{debounce:300,immediate:!0,deep:!0});const w=x(!1);async function k(s){await Y.confirm(`确定将 ${s.flowName}(${s.flowKey}:v${s.version}) 设为主版本?`,"提示",{type:"warning"}),w.value=!0,a({flowDeployId:s.flowDeployId,flowModuleId:s.flowModuleId,mainVersion:1}).then(()=>{E.success("设置成功"),c()}).finally(()=>{w.value=!1})}async function y(s){const{value:u}=await Y.prompt("请输入确认删除的流程标识","提示",{type:"warning"});u===s.flowKey&&(await n(s.flowDeployId),E.success("删除成功"),c())}function g(s){a(De(s,["flowDeployId","flowModuleId","sort"]))}return(s,u)=>{const v=_("el-button"),D=_("el-dropdown-item"),h=_("el-input-number"),$=_("avue-crud");return b(),I($,K(z(m(p))),{"menu-left":o(()=>[r(v,{loading:w.value,type:"primary",icon:"el-icon-arrow-left",onClick:u[0]||(u[0]=C=>e("back"))},{default:o(()=>[F(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:C})=>[r(D,{icon:"el-icon-view",onClick:L=>e("view",C)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),r(D,{icon:"el-icon-edit",onClick:L=>e("edit",C)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),r(D,{icon:"el-icon-delete",onClick:L=>y(C)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),r(D,{icon:"el-icon-switch",disabled:C.mainVersion===m(Fe).是,onClick:L=>k(C)},{default:o(()=>[F(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:C})=>[r(m(X),{icon:C.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:C})=>[r(h,{modelValue:C.sort,"onUpdate:modelValue":L=>C.sort=L,"controls-position":"right",style:{width:"100%"},onChange:L=>g(C)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),ve={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},kt=P({__name:"index",emits:["node-click"],setup(d,{emit:e}){const{request:i}=T(),{crudStateRefs:{formData:t,tableData:l},getDataList:a,handleSave:n,handleUpdate:p,handleDel:f}=R({crudOption:{rowKey:"id",...Ve(i),dataPath:"res.data"},sortOption:{ascs:"sort"},tableOption:ve,pageOption:{pageSize:20}});a();function c(y,g,s,u){n(g,s,u)}function w(y,g,s,u){p(g,Number.NaN,s,u)}async function k(y,g){await f(y.data,Number.NaN),g()}return(y,g)=>{const s=_("avue-tree");return b(),I(s,{modelValue:m(t),"onUpdate:modelValue":g[0]||(g[0]=u=>Q(t)?t.value=u:null),option:m(ve),data:m(l),onNodeClick:g[1]||(g[1]=u=>e("node-click",u)),onSave:c,onUpdate:w,onDel:k},null,8,["modelValue","option","data"])}}}),ce=P({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(d,{emit:e}){var f;const i=d,{FormDesign:t}=T(),l=W({get(){return i.modelValue?it(i.modelValue):{menuBtn:!1,span:24}},set(c){e("update:modelValue",ut(c,{useJson5:!1}))}}),a=W(()=>i.fields?JSON.parse(i.fields):[]),n=W(()=>{const c={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return w=>{const k=ft(w);return[{...c,props:{label:"name",value:"name",desc:"comment"}},{...c,props:{label:"comment",value:"comment",desc:"name"}},...Array.from({length:((k==null?void 0:k.length)??0)-2}).fill({}).concat({label:"样式类",prop:"class"})]}}),p={form:{settings:Array.from({length:((f=mt.settings)==null?void 0:f.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(c,w)=>{const k=_("avue-form");return c.view?(b(),I(k,{key:0,class:qe(l.value.class),"model-value":{},option:l.value},null,8,["class","option"])):(b(),I(m(t),{key:1,modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),"base-option":n.value,resources:p},null,8,["modelValue","base-option"]))}}}),Dt={key:1},Vt=P({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(d){const e=d,{formData:i,activeStep:t}=re(e),{request:l}=T(),{getDetail:a,useList:n}=le(l),{data:p}=Ce(l).useList(),{data:f}=he(l).useList(),{data:c}=n(),w=W(()=>{var y,g,s,u;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((y=p.value)==null?void 0:y.map(v=>({label:v.formName,value:v.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((g=c.value)==null?void 0:g.map(v=>({label:v.flowName,value:v.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((s=f.value)==null?void 0:s.map(v=>({label:v.flowName,value:v.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((u=c.value)==null?void 0:u.map(v=>({label:v.flowName,value:v.flowModuleId,type:"definition"})))??[]]:[]});async function k(y){if((t==null?void 0:t.value)===1){if(y.type==="template")i.value.formOption=y.value;else if(y.type==="definition"){const g=await a({flowModuleId:y.value});i.value.formOption=g.data.formOption}}else if((t==null?void 0:t.value)===2){if(y.type==="template")i.value.flowData=y.value;else if(y.type==="definition"){const g=await a({flowModuleId:y.value});i.value.flowData=g.data.flowData}}}return(y,g)=>{const s=_("el-link"),u=_("el-divider"),v=_("el-dropdown-item"),D=_("el-scrollbar"),h=_("el-dropdown-menu"),$=_("el-dropdown");return w.value.length?(b(),I($,{key:0},{dropdown:o(()=>[r(h,null,{default:o(()=>[r(D,{"max-height":"600px"},{default:o(()=>[(b(!0),U(J,null,ee(w.value,C=>(b(),I(v,we({key:C.label},C,{disabled:C.type==="divider",onClick:L=>k(C)}),{default:o(()=>[C.type==="divider"?(b(),I(u,{key:0},{default:o(()=>[F(B(C.label),1)]),_:2},1024)):(b(),U("span",Dt,B(C.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[r(s,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[F(" 选择模板 ")]),_:1})]),_:1})):N("",!0)}}}),Ft=G("span",null,"流程设计",-1),ht={key:0},Ct={key:1},Ot={style:{height:"calc(100vh - 144px)"}},$t=P({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(d,{emit:e}){const t=re(d),{visible:l,modelValue:a}=t,{request:n}=T(),{create:p,deploy:f,getDetail:c,update:w}=le(n),{getDetail:k,update:y}=de(n),g=["流程信息","表单设计","模型设计","完成"],s=x(),u=x(!1);ye(()=>[l.value,s.value],async()=>{if(!l.value||!s.value)return;const{flowModuleId:O}=a.value,{flowDeployId:V}=a.value;try{u.value=!0;let S={};V?S=await k({flowDeployId:V}):O&&(S=await c({flowModuleId:O})),a.value=S.data}finally{u.value=!1}},{immediate:!0});const{data:v}=ne(n).useList(),D=W(()=>{var O,V;return(V=(O=v.value)==null?void 0:O.find(S=>S.tableName===a.value.formDataTable))==null?void 0:V.tableFields}),h=x(0);async function $(O){h.value===0&&await ze(s),u.value=!0;const{flowModuleId:V}=a.value,{flowDeployId:S}=a.value;try{S?await y(a.value):V?await w(a.value):await p(a.value).then(A=>{a.value.flowModuleId=A.data.flowModuleId}),E.success("保存成功")}finally{u.value=!1}typeof O=="number"?h.value=O:h.value++}async function C(){await Y.confirm("发布新版本，是否确认？","提示"),u.value=!0,f({flowModuleId:a.value.flowModuleId}).then(()=>{E.success("发布成功")}).finally(()=>{u.value=!1})}function L(){l.value=!1,h.value=0,a.value={},e("close")}return(O,V)=>{const S=_("el-col"),A=_("el-step"),j=_("el-steps"),H=_("el-button"),Te=_("el-row"),Le=_("avue-form"),Ne=_("el-result"),Pe=_("el-dialog"),Ue=ge("loading");return b(),I(Pe,{modelValue:m(l),"onUpdate:modelValue":V[6]||(V[6]=M=>Q(l)?l.value=M:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:L},{header:o(()=>[r(Te,{justify:"center"},{default:o(()=>[r(S,{span:5},{default:o(()=>{var M,Z,ae,pe;return[G("div",null,[Ft,(M=m(a))!=null&&M.flowName?(b(),U("span",ht," - "+B((Z=m(a))==null?void 0:Z.flowName),1)):N("",!0),(ae=m(a))!=null&&ae.version?(b(),U("span",Ct," - V"+B((pe=m(a))==null?void 0:pe.version),1)):N("",!0)]),r(Vt,{"form-data":m(a),"onUpdate:formData":V[0]||(V[0]=Me=>Q(a)?a.value=Me:null),"active-step":h.value},null,8,["form-data","active-step"])]}),_:1}),r(S,{span:14},{default:o(()=>[r(j,{active:h.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(b(),U(J,null,ee(g,(M,Z)=>r(A,{key:Z,title:M,style:{cursor:"pointer"},onClick:ae=>$(Z)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),r(S,{span:5,style:{"text-align":"right"}},{default:o(()=>[r(H,{disabled:h.value===0,loading:u.value,type:"primary",onClick:V[1]||(V[1]=M=>h.value--)},{default:o(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),r(H,{disabled:h.value===g.length-1,type:"primary",loading:u.value,onClick:V[2]||(V[2]=M=>$())},{default:o(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),r(H,{onClick:L},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[be((b(),U("div",Ot,[h.value===0?(b(),I(Le,{key:0,ref_key:"formRef",ref:s,modelValue:m(a),"onUpdate:modelValue":V[3]||(V[3]=M=>Q(a)?a.value=M:null),option:m(Ke),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):N("",!0),h.value===1?(b(),I(ce,{key:1,modelValue:m(a).formOption,"onUpdate:modelValue":V[4]||(V[4]=M=>m(a).formOption=M),fields:D.value},null,8,["modelValue","fields"])):N("",!0),h.value===2?(b(),I(se,{key:2,modelValue:m(a).flowData,"onUpdate:modelValue":V[5]||(V[5]=M=>m(a).flowData=M),"flow-form-option":m(a).formOption},null,8,["modelValue","flow-form-option"])):N("",!0),h.value===3?(b(),I(Ne,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[m(a).flowDeployId?N("",!0):(b(),I(H,{key:0,type:"primary",onClick:C},{default:o(()=>[F(" 发布 ")]),_:1})),r(H,{onClick:L},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})):N("",!0)])),[[Ue,u.value]])]),_:1},8,["modelValue"])}}}),It=G("span",null,"流程查看",-1),xt={key:0},Tt={key:1},Lt=P({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(d){const i=re(d),{visible:t,modelValue:l}=i,{request:a}=T(),{getDetail:n}=le(a),{getDetail:p}=de(a),f=x("form"),c=x(!1);ye(t,async k=>{if(!k)return;const{flowModuleId:y}=l.value,{flowDeployId:g}=l.value;try{c.value=!0;let s={};g?s=await p({flowDeployId:g}):y&&(s=await n({flowModuleId:y})),l.value={...s.data}}finally{c.value=!1}},{immediate:!0});function w(){l.value={},f.value="form"}return(k,y)=>{const g=_("el-tab-pane"),s=_("el-tabs"),u=_("el-dialog"),v=ge("loading");return b(),I(u,{modelValue:m(t),"onUpdate:modelValue":y[3]||(y[3]=D=>Q(t)?t.value=D:null),width:"60%",top:"0",onClose:w},{header:o(()=>{var D,h,$,C;return[It,(D=m(l))!=null&&D.flowName?(b(),U("span",xt," - "+B((h=m(l))==null?void 0:h.flowName),1)):N("",!0),($=m(l))!=null&&$.version?(b(),U("span",Tt," - V"+B((C=m(l))==null?void 0:C.version),1)):N("",!0)]}),default:o(()=>[be((b(),I(s,{modelValue:f.value,"onUpdate:modelValue":y[2]||(y[2]=D=>f.value=D)},{default:o(()=>[r(g,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[f.value==="form"&&m(l).formOption?(b(),I(ce,{key:0,modelValue:m(l).formOption,"onUpdate:modelValue":y[0]||(y[0]=D=>m(l).formOption=D),view:""},null,8,["modelValue"])):N("",!0)]),_:1}),r(g,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[f.value==="flow"?(b(),I(se,{key:0,modelValue:m(l).flowData,"onUpdate:modelValue":y[1]||(y[1]=D=>m(l).flowData=D),view:""},null,8,["modelValue"])):N("",!0)]),_:1})]),_:1},8,["modelValue"])),[[v,c.value]])]),_:1},8,["modelValue"])}}}),Nt=P({__name:"index",setup(d){const e=x("definition"),i=x({}),t=x(""),l=x("");function a(s){t.value===s.id?t.value="":t.value=s.id}const n=x(!1),p=x(!1);function f(){i.value={},n.value=!0}function c(s){i.value=s,n.value=!0}function w(s){i.value=s,p.value=!0}function k(s){l.value=s.flowModuleId||"",e.value="deploy"}function y(){l.value="",e.value="definition"}async function g(){const s=e.value;await fe(),e.value="",await fe(),e.value=`${s}`}return(s,u)=>{const v=_("el-card"),D=_("el-col"),h=_("el-row");return b(),I(h,{gutter:20},{default:o(()=>[r(D,{span:6},{default:o(()=>[r(v,{header:"流程分类",style:{height:"100%"}},{default:o(()=>[r(kt,{onNodeClick:a})]),_:1})]),_:1}),r(D,{span:18},{default:o(()=>[e.value==="definition"?(b(),I(Ie,{key:0,"category-id":t.value,onAdd:f,onEdit:c,onView:w,onVersion:k},null,8,["category-id"])):N("",!0),e.value==="deploy"&&l.value?(b(),I(xe,{key:1,"flow-module-id":l.value,onEdit:c,onView:w,onBack:y},null,8,["flow-module-id"])):N("",!0),r($t,{modelValue:i.value,"onUpdate:modelValue":u[0]||(u[0]=$=>i.value=$),visible:n.value,"onUpdate:visible":u[1]||(u[1]=$=>n.value=$),onClose:g},null,8,["modelValue","visible"]),r(Lt,{modelValue:i.value,"onUpdate:modelValue":u[2]||(u[2]=$=>i.value=$),visible:p.value,"onUpdate:visible":u[3]||(u[3]=$=>p.value=$)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Pt=P({__name:"index",setup(d){const e=dt("debugMode",!1),{request:i}=T(),{getTaskOpsList:t}=wt(i),{bindVal:l,getDataList:a,crudStateRefs:{searchForm:n}}=R({tableOption:je,crudOption:{getList:t},searchForm:{status:q.待办},sortOption:{descs:"start_time"}});oe(n,a,{debounce:300,immediate:!0,deep:!0});const{open:p,close:f}=$e();function c(w){p({flowKey:w.flowKey,taskId:w.taskId,instanceId:w.flowInstanceId,debug:e.value,onComplete(){f(),E.success("操作成功"),a()}})}return(w,k)=>{const y=_("el-switch"),g=_("el-button"),s=_("el-link"),u=_("avue-crud");return b(),I(u,K(z(m(l))),{"menu-right":o(()=>[r(g,{type:"text"},{default:o(()=>[r(y,{modelValue:m(e),"onUpdate:modelValue":k[0]||(k[0]=v=>Q(e)?e.value=v:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:v})=>[r(s,{type:"primary",underline:!1,onClick:D=>c(v)},{default:o(()=>[F(B(v.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),Ut=P({__name:"index",setup(d){const{request:e}=T(),{bindVal:i,getDataList:t}=R({tableOption:We,crudOption:_e(e)});return t(),(l,a)=>{const n=_("avue-crud");return b(),I(n,K(z(m(i))),null,16)}}}),Mt={class:"flow-list"},St=["onClick"],At={class:"flow-name"},Bt=P({__name:"index",setup(d){const{request:e}=T(),{useList:i}=Ve(e),{usePublishList:t,getTaskList:l}=Ge(e),{data:a}=i(),{data:n}=t(),p=W(()=>{var u;return(u=a.value)==null?void 0:u.map(v=>{var h;const D=((h=n.value)==null?void 0:h.filter($=>$.categoryId===v.id))??[];return{...v,list:D}}).filter(v=>{var D;return(D=v.list)==null?void 0:D.length})}),f=vt(q).filter((u,v)=>v<2).reverse(),{bindVal:c,getDataList:w,crudStateRefs:{searchForm:k}}=R({tableOption:Je,crudOption:{getList:l},searchForm:{status:q.待办}});oe(k,w,{debounce:300,immediate:!0,deep:!0});const{open:y,close:g}=$e();function s(u){y({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,detail:u.taskId?u.status===q.已办:!1,onComplete(){g(),E.success("操作成功"),w()}})}return(u,v)=>{const D=_("el-button"),h=_("el-divider"),$=_("el-collapse-item"),C=_("el-collapse"),L=_("el-card"),O=_("avue-radio"),V=_("el-link"),S=_("avue-crud");return b(),U(J,null,[r(L,{"body-style":{padding:"0 20px"}},{default:o(()=>[r(C,{"model-value":"1"},{default:o(()=>[r($,{name:"1"},{title:o(()=>[r(D,{text:"",icon:"el-icon-promotion"},{default:o(()=>[F(" 发起审批 ")]),_:1})]),default:o(()=>[G("div",Mt,[(b(!0),U(J,null,ee(p.value,A=>(b(),U("div",{key:A.id,class:"flow-category"},[r(h,{"content-position":"left"},{default:o(()=>[F(B(A.name),1)]),_:2},1024),(b(!0),U(J,null,ee(A.list,j=>(b(),U("div",{key:j.flowKey,class:"flow-item",onClick:H=>s(j)},[r(m(X),{class:"flow-icon",icon:j.flowIcon,width:"60"},null,8,["icon"]),G("div",At,B(j.flowName),1)],8,St))),128))]))),128))])]),_:1})]),_:1})]),_:1}),r(h),r(S,K(z(m(c))),{"menu-left":o(()=>[r(O,{modelValue:m(k).status,"onUpdate:modelValue":v[0]||(v[0]=A=>m(k).status=A),button:"",dic:m(f)},null,8,["modelValue","dic"])]),processTitle:o(({row:A})=>[r(V,{type:"primary",underline:!1,onClick:j=>s(A)},{default:o(()=>[F(B(A.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Et=et(Bt,[["__scopeId","data-v-5341e962"]]),Rt=P({__name:"index",setup(d){const{request:e}=T(),{bindVal:i,crudStateRefs:{formData:t},getDataList:l,handleUpdate:a}=R({tableOption:He,crudOption:he(e)});l();const n=x(!1);async function p(c){t.value=c,n.value=!0}async function f(){await a(t.value,Number.NaN,()=>n.value=!1,()=>{})}return(c,w)=>{const k=_("el-button"),y=_("avue-crud"),g=_("el-dialog");return b(),U(J,null,[r(y,K(z(m(i))),{menu:o(({row:s})=>[r(k,{type:"primary",text:"",icon:"el-icon-crop",onClick:u=>p(s)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),r(g,{modelValue:n.value,"onUpdate:modelValue":w[2]||(w[2]=s=>n.value=s),title:`模型设计-${m(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[r(k,{type:"primary",onClick:f},{default:o(()=>[F(" 保存 ")]),_:1}),r(k,{onClick:w[1]||(w[1]=s=>n.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[r(se,{modelValue:m(t).flowData,"onUpdate:modelValue":w[0]||(w[0]=s=>m(t).flowData=s),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Kt=P({__name:"index",setup(d){const{request:e}=T(),{bindVal:i,crudStateRefs:{formData:t},getDataList:l,handleUpdate:a}=R({tableOption:Qe,crudOption:Ce(e)});l();const n=x(!1);async function p(c){t.value={...c},n.value=!0}async function f(){await a(t.value,Number.NaN,()=>n.value=!1,()=>{})}return(c,w)=>{const k=_("el-button"),y=_("avue-crud"),g=_("el-dialog");return b(),U(J,null,[r(y,K(z(m(i))),{menu:o(({row:s})=>[r(k,{type:"primary",text:"",icon:"el-icon-crop",onClick:u=>p(s)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),r(g,{modelValue:n.value,"onUpdate:modelValue":w[2]||(w[2]=s=>n.value=s),title:`表单设计-${m(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[r(k,{type:"primary",onClick:f},{default:o(()=>[F(" 保存 ")]),_:1}),r(k,{onClick:w[1]||(w[1]=s=>n.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[r(ce,{modelValue:m(t).formOption,"onUpdate:modelValue":w[0]||(w[0]=s=>m(t).formOption=s),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),zt=G("br",null,null,-1),jt=P({__name:"index",setup(d){const{request:e}=T(),{bindVal:i,crudStateRefs:{formData:t,defaults:l},getDataList:a,afterOpen:n,beforeSubmit:p}=R({crudOption:ne(e),tableOption:Xe});a();const{data:f}=_e(e).useParam("table.default.fields");n(u=>{if(t.value.defaultFields=f.value??[],u==="edit"){const v=JSON.parse(t.value.tableFields);t.value.editFields=_t(v,f.value??[],"name")}}),p(u=>{const v=[...u.defaultFields,...u.editFields];u.tableFields=JSON.stringify(v)});const c=x(!1);ie(()=>{var u;(u=l.value)!=null&&u.defaultFields&&(l.value.defaultFields.display=c.value)});const{deploy:w,getFields:k}=ne(e),y=x(!1);async function g(u){await Y.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),y.value=!0,w({id:u.id}).then(()=>{E.success("部署成功"),a()}).finally(()=>{y.value=!1})}function s(){k({tableName:t.value.tableName}).then(u=>{var v;if(!((v=u.data)!=null&&v.length))return E.warning("未找到该表");t.value.editFields=u.data})}return(u,v)=>{const D=_("el-button"),h=_("el-input"),$=_("el-switch"),C=_("el-tooltip"),L=_("avue-crud");return b(),I(L,K(z(m(i))),{menu:o(({row:O})=>[r(D,{type:"text",icon:"el-icon-upload",onClick:V=>g(O)},{default:o(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[r(h,{modelValue:m(t).tableName,"onUpdate:modelValue":v[0]||(v[0]=O=>m(t).tableName=O),placeholder:"请输入 表名"},{append:o(()=>[r(D,{type:"primary",size:"default",onClick:s},{default:o(()=>[F(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[G("div",null,[F(" 数据库字段 "),zt,r(C,{content:"显示默认字段"},{default:o(()=>[r($,{modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=O=>c.value=O)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Wt=P({__name:"index",setup(d){const e=ct(),i=x({}),{FlowForm:t}=T(),l=W(()=>{const n=i.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${n==null?void 0:n.title}`:e.instanceId||e.taskId?`办理流程：${n==null?void 0:n.title}`:`发起流程：${n==null?void 0:n.title}`});pt(l);async function a(n){window.postMessage({event:"onComplete",data:{...n}})}return(n,p)=>(b(),I(m(t),we({flowDetail:i.value,"onUpdate:flowDetail":p[0]||(p[0]=f=>i.value=f)},m(e),{onComplete:a}),null,16,["flowDetail"]))}}),Jt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:bt,PageFlowDefinition:Ie,PageFlowDeploy:xe,PageFlowForm:Wt,PageFlowManage:Nt,PageFlowOps:Pt,PageFlowParam:Ut,PageFlowTemplate:Rt,PageFlowWorkbench:Et,PageFormTemplate:Kt,PageTableTemplate:jt},Symbol.toStringTag,{value:"Module"})),Ro={install(d,e){T(e),Object.entries(Jt).forEach(([i,t])=>{d.component(i,t)})}};export{jo as ApprovalForm,Wo as ButtonList,Se as CONFIG_DEFAULT,Jo as FieldType,Go as FlowButtonApproval,Ho as FlowButtonDisplay,Qo as FlowButtonKey,Xo as FlowButtonStatus,Yo as FlowButtonType,Zo as FlowForm,qo as FlowStatus,el as HandleType,tl as InternalForm,Fe as IsMainVersion,bt as PageFlowButton,Ie as PageFlowDefinition,xe as PageFlowDeploy,Wt as PageFlowForm,Nt as PageFlowManage,Pt as PageFlowOps,Ut as PageFlowParam,Rt as PageFlowTemplate,Et as PageFlowWorkbench,Kt as PageFormTemplate,jt as PageTableTemplate,ol as TablePrimary,q as TaskStatus,ll as UploadTable,al as Whether,ze as asyncValidate,Ro as default,nl as defineTableOption,sl as fieldTypeDic,il as flowFormEmits,ul as flowFormProps,rl as flowTrack,dl as injectionKey,cl as isMobile,pl as tablePrimaryDic,ml as useButtonHandler,fl as useCommonCommentApi,T as useConfigProvider,vl as useEmitter,Be as useFlowButtonApi,Ve as useFlowCategoryApi,le as useFlowDefinitionApi,de as useFlowDeployApi,_l as useFlowFileApi,$e as useFlowForm,gt as useFlowFormOverlay,yt as useFlowFormWindow,wt as useFlowOpsApi,_e as useFlowParamApi,Ge as useFlowTaskApi,he as useFlowTemplateApi,wl as useFlowUserApi,yl as useFormDefaults,Ce as useFormTemplateApi,gl as useInjectState,bl as useProvideState,ne as useTableTemplateApi,kl as whetherDic};
