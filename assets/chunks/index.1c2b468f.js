import{bQ as oe,dB as Ee,dC as de,dD as It,dE as te,bc as ge,dF as Nt,d4 as Ot,d6 as Lt,cw as $t,a5 as St,by as Ut,bR as De}from"../composables_use-crud_index.md.b279084a.js";import{L as Rt,M as re,s as Et,N as Pt,O as Ft}from"../app.ffe80b2a.js";import{U as Ke,A as Ce,r as N,s as Le,d as R,e as ie,w as _e,a6 as ee,u as b,n as pe,V as At,h as K,b as rt,ar as Pe,G as D,i as x,C as $,D as f,I as y,m as P,p as j,a0 as lt,aK as Be,a2 as je,B as X,E as z,j as M,N as fe,F as Y,J as Mt,_ as ze,av as ae,aw as ne,k as Kt,b2 as Bt,au as jt,aN as zt,l as Wt}from"./framework.22a77fa2.js";import{M as it,f as Qt,t as Fe,L as qt,u as Ht}from"./vuedraggable.umd.627d7d33.js";import"./mysqlWorkbench.954a482f.js";import{d as Gt}from"./data.4cb21f02.js";import{a as Jt}from"../flow-design_flow-modeler_index.md.07d02c14.js";import{u as ye,a as Yt,c as Xt}from"./theme.1d56182c.js";import"../components_icon-select_index.md.dc997862.js";import"../components_index.md.d18bb5a3.js";import"../components_v-text_index.md.306fe565.js";import"../composables_index.md.1bb90be4.js";import"../flow-design_flow-viewer_index.md.e9fcc2c5.js";import"../flow-design_index.md.e062cae5.js";import"../flow-pages_index.md.d27d2c75.js";import"../flow-pages_pages_flow-button_index.md.2cf37f1f.js";import"../flow-pages_pages_flow-manage_index.md.3b729385.js";import"../flow-pages_pages_flow-ops_index.md.1351e2c2.js";import"../flow-pages_pages_flow-param_index.md.907e6ed8.js";import"../flow-pages_pages_flow-template_index.md.743ad38c.js";import"../flow-pages_pages_flow-workbench_index.md.e559c6b1.js";import"../flow-pages_pages_form-template_index.md.754d7c10.js";import"../flow-pages_pages_table-template_index.md.f196419b.js";import"../form-design_demo.md.f7fa8b02.js";import"../form-design_index.md.f8d915c9.js";import"../guide_changelog.md.71ace3ef.js";import"../guide_start.md.f25ec09d.js";import"../index.md.dedad964.js";import"../plugins_avue-patch_index.md.298f53e4.js";import"../plugins_compatible-tips_index.md.4a4a879f.js";import"../plugins_env-dts_index.md.90c505c6.js";import"../plugins_index.md.09238556.js";import"../plugins_load-proxy_index.md.8c57e468.js";import"../plugins_setup-extend_index.md.ffc97dab.js";import"../plugins_uni-ui-patch_index.md.b8a395e2.js";import"../plugins_uview-patch_index.md.e65878da.js";import"../types_avue_index.md.31e36571.js";import"../types_index.md.aa1779e7.js";import"../utils_date_dateFormat.md.24466ffd.js";import"../utils_date_durationFormat.md.a91e1175.js";import"../utils_emitter_mittAsync.md.65520a0e.js";import"../utils_index.md.99824380.js";import"../utils_math_index.md.81fb7150.js";import"../utils_object_filterObj.md.d634698f.js";import"../utils_object_filterObjDeep.md.aee85325.js";import"../utils_object_getDataType.md.4c16fa33.js";import"../utils_string_deserialize.md.49b88e4f.js";import"../utils_string_serialize.md.175ca994.js";import"../utils_string_uuid.md.1b6743be.js";import"../utils_tool_awaitTo.md.907e2bd0.js";import"../utils_tool_enumToDic.md.f0182e11.js";import"../utils_tool_sleep.md.15440607.js";import"../utils_tree_buildTree.md.b95211e7.js";import"../utils_tree_filterTree.md.753c4098.js";import"../utils_tree_findTree.md.30184861.js";import"../utils_tree_flatTree.md.cb52189f.js";import"../utils_tree_treeMap.md.168ca5df.js";import"./vue.runtime.esm-bundler.ed40cebf.js";const Zt={},eo=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),to=()=>Zt,oo=e=>Array.isArray(e),We=e=>e!==null&&typeof e=="object",ut=e=>e instanceof Function,be=e=>e==null,Qe=typeof window>"u",ct=()=>{var e;return Qe||be((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},lo=()=>{var e,t;return(e=!Qe&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},$e=()=>new Promise(()=>{}),le=e=>ee(e)?e.value:e,ao=e=>We(e)?Object.assign(oo(e)?[]:{},e):e,he=new Map,no=e=>be(e)?void 0:he.get(e),so=(e,t,o)=>{const i=he.get(e);i!=null&&i.timer&&clearTimeout(i.timer);const a=setTimeout(()=>he.delete(e),t);he.set(e,{...o,timer:a})},ue=e=>e;function dt(e,t,o){let i,a,s,u,l,n,r=0,c=!1,v=!1,_=!0;const p=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,We(o)&&(c=!!o.leading,v="maxWait"in o,s=v?Math.max(+o.maxWait||0,t):s,_="trailing"in o?!!o.trailing:_);function m(C){const I=i,T=a;return i=a=void 0,r=C,u=e.apply(T,I),u}function V(C,I){return p?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,I)}function k(C){if(p)return window.cancelAnimationFrame(C);clearTimeout(C)}function w(C){return r=C,l=V(h,t),c?m(C):u}function d(C){const I=C-n,T=C-r,A=t-I;return v?Math.min(A,s-T):A}function g(C){const I=C-n,T=C-r;return n===void 0||I>=t||I<0||v&&T>=s}function h(){const C=Date.now();if(g(C))return O(C);l=V(h,d(C))}function O(C){return l=void 0,_&&i?m(C):(i=a=void 0,u)}function L(){l!==void 0&&k(l),r=0,i=n=a=l=void 0}function S(){return l===void 0?u:O(Date.now())}function U(){return l!==void 0}function E(...C){const I=Date.now(),T=g(I);if(i=C,a=this,n=I,T){if(l===void 0)return w(n);if(v)return l=V(h,t),m(n)}return l===void 0&&(l=V(h,t)),u}return E.cancel=L,E.flush=S,E.pending=U,E}function ro(e,t,o){let i=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return We(o)&&(i="leading"in o?!!o.leading:i,a="trailing"in o?!!o.trailing:a),dt(e,t,{leading:i,trailing:a,maxWait:t})}var io=ue((e,{debounceInterval:t,debounceOptions:o,manual:i})=>{const a=N(!1),s=N(),u=R(()=>o),l=R(()=>le(t)),n=N(e.context.runAsync);return i||(a.value=!0),ie(r=>{be(l.value)||(s.value=dt(c=>c(),l.value,u.value),e.context.runAsync=(...c)=>new Promise((v,_)=>{a.value?(a.value=!1,n.value(...c).then(v).catch(_)):s.value(()=>{n.value(...c).then(v).catch(_)})}),r(()=>{var c;(c=s.value)===null||c===void 0||c.cancel(),e.context.runAsync=n.value}))}),{onCancel(){var r;(r=s.value)===null||r===void 0||r.cancel()}}}),uo=ue((e,{errorRetryCount:t=0,errorRetryInterval:o=0})=>{const i=N(),a=N(0),s=R(()=>le(t)),u=R(()=>le(o));let l=!1;const n=()=>{a.value=0},r=R(()=>{if(u.value)return u.value;const _=1e3,p=1,m=9,V=Math.floor(Math.random()*2**Math.min(a.value,m)+p);return _*V}),c=()=>{let _;const p=s.value===-1,m=a.value<s.value;return(p||m)&&(p||(a.value+=1),_=setTimeout(()=>{l=!0,e.context.refresh()},r.value)),()=>_&&clearTimeout(_)},v=()=>{i.value&&i.value()};return{onBefore(){l||n(),l=!1,v()},onSuccess(){n()},onError(){i.value=c()},onCancel(){n(),v()}}}),co=ue((e,{ready:t=N(!0),manual:o,defaultParams:i=[]})=>(_e(t,a=>{!o&&a&&e.context.run(...i)},{flush:"sync"}),{onBefore(){if(!t.value)return e.loading.value=!1,{isBreak:!0}}})),po=ue((e,{refreshDeps:t=[],refreshDepsAction:o,manual:i})=>(t!=null&&t.length&&_e(t,()=>{o?o():!i&&e.context.refresh()}),{})),fo=ue((e,{throttleInterval:t,throttleOptions:o})=>{const i=N(),a=R(()=>le(t)),s=R(()=>o),u=N(e.context.runAsync);return ie(l=>{if(be(t))return{};i.value=ro(n=>n(),a.value,s.value),e.context.runAsync=(...n)=>new Promise((r,c)=>{i.value(()=>{u.value(...n).then(r).catch(c)})}),l(()=>{var n;(n=i.value)===null||n===void 0||n.cancel(),e.context.runAsync=u.value})}),{onCancel(){var l;(l=i.value)===null||l===void 0||l.cancel()}}});const mo=(e,t)=>o=>{Object.keys(o).forEach(i=>{e[i].value=o[i]}),t.forEach(i=>i(e))},vo=(e,t)=>()=>{let o=t;for(let i=e.length;i-- >0;)o=e[i](o);return o()},_o=(e,t,o)=>{var i,a;const{initialData:s,onSuccess:u,onError:l,onBefore:n,onAfter:r}=t,c=N((i=o==null?void 0:o.loading)!==null&&i!==void 0?i:!1),v=Le((a=o==null?void 0:o.data)!==null&&a!==void 0?a:s),_=Le(o==null?void 0:o.error),p=N(o==null?void 0:o.params),m=N([]),V=Le("pending"),k={},w=mo({status:V,loading:c,data:v,error:_,params:p},[]),d=(h,...O)=>{if(h==="onQuery"){const L=m.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:vo(L,O[0])()}}else{const L=m.value.map(S=>{var U;return(U=S[h])===null||U===void 0?void 0:U.call(S,...O)});return Object.assign({},...L)}},g=N(0);return k.runAsync=async(...h)=>{w({loading:!0,params:h,status:"pending"}),g.value+=1;const O=g.value,{isBreak:L,breakResult:S=$e()}=d("onBefore",h);if(L)return w({status:"settled"}),S;n==null||n(h);try{const U=()=>new Promise(I=>I(e(...p.value)));let{servicePromise:E}=d("onQuery",U);E||(E=U());const C=await E;return O!==g.value?$e():(w({data:C,loading:!1,error:void 0,status:"settled"}),d("onSuccess",C,h),u==null||u(C,h),d("onAfter",h,C,void 0),r==null||r(h),C)}catch(U){if(O!==g.value)return $e();throw w({loading:!1,error:U,status:"settled"}),d("onError",U,h),l==null||l(U,h),d("onAfter",h,void 0,U),r==null||r(h),U}},k.run=(...h)=>{k.runAsync(...h).catch(O=>{l||console.error(O)})},k.cancel=()=>{g.value+=1,w({loading:!1}),d("onCancel")},k.refresh=()=>{k.run(...p.value||[])},k.refreshAsync=()=>k.runAsync(...p.value||[]),k.mutate=h=>{const O=ut(h)?h(v.value):h,L=ao(O);w({data:L}),d("onMutate",L)},{status:V,loading:c,data:v,error:_,params:p,plugins:m,context:k}};function wo(e,t={},o){const i=Ke(eo,{}),a={...to(),...i,...t},{manual:s=!1,defaultParams:u=[]}=a,l=_o(e,a);if(l.plugins.value=o.map(n=>n(l,a)),!s){const n=l.params.value||u;l.context.run(...n)}return Ce(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ke=new Map,yo=(e,t)=>{ke.set(e,t),t.then(o=>(ke.delete(e),o)).catch(()=>{ke.delete(e)})},bo=e=>ke.get(e),ve=new Map,go=(e,t)=>{ve.has(e)&&ve.get(e).forEach(o=>o(t))},ho=(e,t)=>(ve.has(e)?ve.get(e).push(t):ve.set(e,[t]),()=>{const o=ve.get(e).indexOf(t);ve.get(e).splice(o,1)});var ko=ue((e,{cacheKey:t,cacheTime:o=6e5,staleTime:i=0,getCache:a,setCache:s})=>{if(!t)return{};const u=ut(t)?t:()=>t,l=N(()=>{});let n;const r=k=>a?a(k):no(k),c=(k,w,d)=>{s?s(k,d):so(k,w,d),go(k,d.data)},v=k=>i===-1||k+i>new Date().getTime(),_=(k,w)=>Object.prototype.hasOwnProperty.call(k,w),p=k=>{const w=u(k);return ho(w,d=>{e.data.value=d})},m=u(),V=r(m);return V&&_(V,"data")&&(e.data.value=V.data,e.params.value=V.params),m&&(l.value=p()),Ce(()=>{l.value()}),{onBefore(k){const w=u(k),d=r(w);if(!d||!_(d,"data"))return{};if(v(d.time))return e.data.value=d.data,e.loading.value=!1,{isBreak:!0,breakResult:d.data};e.data.value=d.data},onQuery(k){const w=e.params.value,d=u(w);let g=bo(d);return g&&g!==n?()=>g:(g=k(),n=g,yo(d,g),()=>g)},onSuccess(k,w){const d=u(w);d&&(l.value(),c(d,o,{data:k,params:w,time:new Date().getTime()}),l.value=p(w))},onMutate(k){const w=u(e.params.value);w&&(l.value(),c(w,o,{data:k,params:e.params.value,time:new Date().getTime()}),l.value=p(e.params.value))}}});function Vo(e){let t,o;class i extends Promise{constructor(s){super(s),this.cancel=()=>{o(),clearTimeout(t)}}}return new i(a=>{o=a,t=setTimeout(o,e)})}function Se(){return new Date().getTime()}var Do=ue((e,{loadingDelay:t=0,loadingKeep:o=0})=>{const i=N(()=>{}),a=R(()=>le(t)),s=R(()=>le(o));let u=0,l={};const n=()=>{let r;return a.value&&(r=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>r&&clearTimeout(r)};return{onBefore(){e.loading.value=!a.value,i.value(),i.value=n(),u=Se()},onQuery(r){if(!s.value)return()=>r();l=Vo(s.value+a.value);const c=async()=>{try{const _=await r();return Se()-u<=a.value&&l.cancel(),Promise.resolve(_)}catch(_){return Se()-u<=a.value&&l.cancel(),Promise.reject(_)}},v=Promise.allSettled([c(),l]).then(_=>{const p=_[0];return p.status==="fulfilled"?p.value:Promise.reject(p.reason)});return()=>v},onCancel(){i.value()},onAfter(){i.value()}}}),Ue;const pt=new Set,ft=new Set,mt=new Set,Ve=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=pt;break;case"RECONNECT_LISTENER":o=mt;break;case"VISIBLE_LISTENER":o=ft;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Re=e=>{e.forEach(t=>{t()})};!Qe&&(Ue=window)!==null&&Ue!==void 0&&Ue.addEventListener&&(window.addEventListener("visibilitychange",()=>{ct()&&Re(ft)},!1),window.addEventListener("focus",()=>Re(pt),!1),window.addEventListener("online",()=>Re(mt),!1));var Co=ue((e,{pollingInterval:t,pollingWhenHidden:o=!1,pollingWhenOffline:i=!1,errorRetryCount:a=0})=>{const s=N(),u=N(!1),l=R(()=>le(t)),n=R(()=>le(a)),r=[],c=m=>{m&&r.push(m)},v=()=>(o||ct())&&(i||lo()),_=m=>{if(e.error.value&&n.value!==0)return;let V;if(!be(l.value)&&l.value>=0)if(v())V=setTimeout(m,l.value);else{u.value=!0;return}return()=>V&&clearTimeout(V)},p=()=>{u.value&&v()&&(e.context.refresh(),u.value=!1)};return _e(l,()=>{s.value&&(s.value(),s.value=_(()=>e.context.refresh()))}),o||c(Ve("VISIBLE_LISTENER",p)),i||c(Ve("RECONNECT_LISTENER",p)),Ce(()=>{r.forEach(m=>m())}),{onBefore(){var m;(m=s.value)===null||m===void 0||m.call(s)},onCancel(){var m;(m=s.value)===null||m===void 0||m.call(s)},onAfter(){s.value=_(()=>e.context.refresh())}}});const xo=(e,t)=>{let o=!1;return(...i)=>{o||(o=!0,e(...i),setTimeout(()=>{o=!1},t))}};var To=ue((e,{refreshOnWindowFocus:t=!1,refocusTimespan:o=5e3})=>{const i=R(()=>le(t)),a=R(()=>le(o)),s=[],u=n=>{n&&s.push(n)},l=()=>{s.forEach(n=>n())};return ie(()=>{if(l(),i.value){const n=xo(e.context.refresh,a.value);u(Ve("VISIBLE_LISTENER",n)),u(Ve("FOCUS_LISTENER",n))}}),Ce(()=>{l()}),{}});function we(e,t){return wo(e,t,[Do,uo,io,Co,fo,To,po,co,ko])}function xe(){const{request:e}=q(),t={detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",publish:"/sapier-flow/flow-run/queryPublishFlowList",todo:"/sapier-flow/flow-run/userTaskList"};return{url:t,getFlowDetail:p=>e.get(t.detail,{params:p}),getApprovalNode:p=>e.post(t.approvalNode,p),startTask:p=>e.post(t.start,p),commitTask:p=>e.post(t.commit,p),saveDraft:p=>e.post(t.draft,p),revokeTask:p=>e.post(t.revoke,p),terminateTask:p=>e.post(t.terminate,p),withdrawTask:p=>e.post(t.withdraw,p),transferTask:p=>e.post(t.transfer,p),getPublishFlow:()=>e.get(t.publish),getTodoList:p=>e.get(t.todo,{params:p})}}function Io(e){const{commitTask:t,revokeTask:o,saveDraft:i,startTask:a,terminateTask:s,transferTask:u,withdrawTask:l}=xe(),n=R(()=>{const{flowDetail:c,formVariables:v,approvalFormData:_,debug:p,fileIds:m}=e,{flowDeployId:V}=c.value.process??{},{taskId:k,flowInstanceId:w}=c.value.task??{};return{flowDeployId:V,taskId:k,flowInstanceId:w,variables:v.value,debug:p.value,fileIds:m.value,..._.value}}),r=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(r())return i(n.value)},flow_pass(){return r()?t(n.value):a(n.value)},flow_revoke(){if(r())return o(n.value)},flow_withdraw(){if(r())return l(n.value)},flow_terminate(){if(r())return s(n.value)},flow_transfer(){if(r())return u(n.value)}}}function No(e){const t=N({});return ie(async()=>{var i;const{formProperty:o}=((i=b(e))==null?void 0:i.properties)||{};o!=null&&o.length&&(await pe(),Object.keys(t.value).forEach(a=>{var l,n,r,c;const s=((l=t.value[a])==null?void 0:l.label)||"",u=o==null?void 0:o.find(v=>v.prop===a);if(t.value[a].display=u==null?void 0:u.display,t.value[a].disabled=u==null?void 0:u.disabled,t.value[a].detail=u==null?void 0:u.detail,t.value[a].readonly=u==null?void 0:u.readonly,t.value[a].rules=t.value[a].rules??[],u!=null&&u.required&&((n=t.value[a].rules)!=null&&n.some(v=>v.required)))return null;u!=null&&u.required?(r=t.value[a].rules)==null||r.push({required:!0,message:`${s}为必填项`}):t.value[a].rules=(c=t.value[a].rules)==null?void 0:c.filter(v=>!v.required)}))}),t}function Oo(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Lo(){return{complete:e=>e}}const vt=Symbol("flowFormState");function $o(e,t){const o=ye(e,void 0,{passive:!0,deep:!0}),{flowDetail:i,modelValue:a,formLoading:s}=o,{getFlowDetail:u}=xe();ie(()=>{const{flowKey:m,taskId:V,instanceId:k}=e;!m&&!V&&!k||(s.value=!0,u({flowKey:m,taskId:V,flowInstanceId:k}).then(w=>{i.value=w.data,a.value=w.data.formData||{}}).finally(()=>{s.value=!1}))});const l=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),n=R(()=>{var m,V,k,w;return l.value.fileTab===!0&&((w=(k=(V=(m=i.value)==null?void 0:m.properties)==null?void 0:V.formProperty)==null?void 0:k.find(d=>d.prop==="fileTab"))==null?void 0:w.display)}),r=R(()=>{var m,V,k,w;return l.value.trackTab===!0&&((w=(k=(V=(m=i.value)==null?void 0:m.properties)==null?void 0:V.formProperty)==null?void 0:k.find(d=>d.prop==="trackTab"))==null?void 0:w.display)}),c=N(!1),v=R(()=>Object.entries(a.value||{}).filter(([m])=>!m.startsWith("$")).map(([m,V])=>({key:m,value:V}))),_=N(),p={...o,formData:a,formVariables:v,approvalVisible:c,showFileTab:n,showTrackTab:r,permission:l,fileIds:_,emit:t};return At(vt,p),p}function _t(){return Ke(vt)}function qe(e){return new Promise((t,o)=>{b(e).validate((a,s,u)=>{a?(s(),t(u)):o(u)})})}const So=K({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:t}=ye(e,void 0,{passive:!0,deep:!0}),o=No(e.flowDetail),{proxy:i}=rt(),a=N({});ie(()=>{const{formOption:l}=e.flowDetail.process??{};a.value=it.bind(i)(l||'{"menuBtn":false}'),a.value.detail=!!e.detail});const s=N();function u(){return qe(s)}return{form:t,option:a,defaults:o,formRef:s,validate:u}},render(){return Pe(D("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Uo=K({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const o=Yt(e,"modelValue"),{batchUpdate:i,create:a,remove:s,useList:u}=Zo(),l=N(!1),{activeBtn:n}=_t(),r=R(()=>{var g;return(g=n.value)==null?void 0:g.buttonKey}),{data:c,refresh:v}=u(r),_=R(()=>{var h,O,L;const g=o.value;if(g&&!((h=c.value)!=null&&h.some(S=>S.content===g))){const S=(((L=(O=c.value)==null?void 0:O[0])==null?void 0:L.sort)||1)-1;return[{content:g,sort:S},...c.value||[]]}return c.value});async function p(g){var h;await a({...g,type:(h=n.value)==null?void 0:h.buttonKey}),oe.success("添加成功"),v()}async function m(g){await s(g.id),oe.success("删除成功"),v()}async function V(g,h){let O=h.parent.data;O=O.map((L,S)=>({id:L.id,sort:S+1})),await i(O),oe.success("修改排序成功"),v(),l.value=!1}function k(){l.value=!0}const w=N();async function d(g){var h;o.value=g.content,await pe(),(h=w.value)==null||h.blur()}return(g,h)=>{const O=D("el-input"),L=D("el-text"),S=D("el-col"),U=D("el-button"),E=D("el-row"),C=D("el-tree"),I=D("el-popover");return x(),$(I,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:f(()=>[y(O,{ref_key:"inputRef",ref:w,modelValue:b(o),"onUpdate:modelValue":h[0]||(h[0]=T=>ee(o)?o.value=T:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:h[1]||(h[1]=T=>l.value=!0),onBlur:h[2]||(h[2]=T=>l.value=!1)},null,8,["modelValue"])]),default:f(()=>[y(C,{data:_.value,"node-key":"content",draggable:"","allow-drop":(T,A,Q)=>Q!=="inner",props:{label:"content"},onNodeClick:d,onNodeDrop:V,onNodeDragStart:k},{default:f(({data:T})=>[y(E,{style:{width:"250px"}},{default:f(()=>[y(S,{span:20},{default:f(()=>[y(L,{truncated:"",title:T.content},{default:f(()=>[P(j(T.content),1)]),_:2},1032,["title"])]),_:2},1024),y(S,{span:4},{default:f(()=>[T.id?(x(),$(U,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:lt(A=>m(T),["stop"])},null,8,["onClick"])):(x(),$(U,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:lt(A=>p(T),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Ro=K({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=xe(),i={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:a,approvalFormData:s,activeBtn:u,approvalVisible:l,formVariables:n,flowDetail:r}=_t(),c=N([]),v=N([]),_=N([]),p=N([]),m=N(),V=N({}),k={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:w}]},{label:"传阅人",prop:"circulate",span:24},{label:"抄送人",prop:"copyUser",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function w(I,T,A){var G;const Q=c.value[0].type==="ParallelGateway",W=(G=c.value[0].children)==null?void 0:G.every(ce=>Qt([ce],J=>v.value.some(Z=>Z.id===J.id)));if(v.value.length){if(Q&&!W)return A("请在每个节点选择审批人")}else return A("请选择审批人");return!0}const d=N(),g=R(()=>{var I,T;return(T=(I=u.value)==null?void 0:I.approval)==null?void 0:T.includes("assignee")}),h=R(()=>{var I,T;return(T=(I=u.value)==null?void 0:I.approval)==null?void 0:T.includes("circulate")}),O=R(()=>{var I,T;return(T=(I=u.value)==null?void 0:I.approval)==null?void 0:T.includes("copyUser")}),L=N(!1),S=N(!1);ie(async()=>{var Q,W,G,ce,J;if(!l.value||!m.value)return;const{flowKey:I}=((Q=r.value)==null?void 0:Q.process)||{},{taskId:T}=((W=r.value)==null?void 0:W.task)||{};c.value=[],v.value=[],_.value=[],p.value=[];const A=T?"":"发起";if(s.value={assignee:{},outgoing:[],circulate:"",copyUser:"",comment:a.value.comment||A},pe(()=>{var Z,H;V.value.assignee.display=g.value,V.value.circulate.display=h.value,V.value.copyUser.display=O.value,V.value.comment.display=(H=(Z=u.value)==null?void 0:Z.approval)==null?void 0:H.includes("comment")}),g.value)try{S.value=!0;const Z=u.value.buttonKey!=="flow_transfer",H=await o({flowKey:I,variables:n.value,taskId:T,loadConfig:Z});c.value=Fe(H.data??[],(se,tt,B)=>{const me=se.id||Ee();return se.taskNodeKey=(B==null?void 0:B.taskNodeKey)??se.taskNodeKey,se.incoming=(B==null?void 0:B.incoming)??se.incoming,{...se,id:me,disabled:se.type!=="user"}}),await pe();const F=U(c.value);F&&((G=d.value)==null||G.setCheckedNodes([F]))}finally{S.value=!1}if(O.value){const Z=await o({flowKey:I,variables:n.value,taskId:T,loadConfig:!1});_.value=Fe(((J=(ce=Z.data)==null?void 0:ce[0])==null?void 0:J.children)??[],H=>{var F;return H.id||Ee(),{...H,label:H.title,disabled:H.type!=="user"&&!((F=H.children)!=null&&F.length)}})}});function U(I){var T;if(I.length===1)return(T=I[0].children)!=null&&T.length?U(I[0].children):I[0]}async function E(I,T){var Q,W;if(I.type!=="user")return;await pe(),await pe();const A=(Q=d.value)==null?void 0:Q.getCheckedNodes();v.value=A.filter(G=>G.type==="user"),(W=d.value)==null||W.setCheckedNodes(v.value)}async function C(){await qe(m),L.value=!0;const I={},T={},A=new Set;v.value.forEach(Q=>{const{taskNodeKey:W,incoming:G}=Q;I[W]||(I[W]=new Set),Q.userId&&I[W].add(Q.userId),T[W]=[...I[W]].join(","),A.add(G)}),s.value.assignee=T,s.value.outgoing=[...A],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",a),t("confirm")}return(I,T)=>{const A=D("el-col"),Q=D("el-tag"),W=D("el-tree-select"),G=D("avue-form"),ce=D("el-row"),J=D("el-button"),Z=D("el-dialog"),H=Be("loading");return x(),$(Z,{modelValue:b(l),"onUpdate:modelValue":T[6]||(T[6]=F=>ee(l)?l.value=F:null),title:b(u).name,width:g.value?"800px":"500px","append-to-body":""},{footer:f(()=>[y(J,{onClick:T[5]||(T[5]=F=>l.value=!1)},{default:f(()=>[P(" 取 消 ")]),_:1}),y(J,{type:"primary",onClick:C},{default:f(()=>[P(" 确 定 ")]),_:1})]),default:f(()=>[y(ce,{gutter:20},{default:f(()=>[g.value?(x(),$(A,{key:0,span:10},{default:f(()=>[je((x(),$(b(Rt),{ref_key:"treeRef",ref:d,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:c.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:E},{default:f(({data:F})=>[X("div",null,[y(b(re),{icon:i[F.type],style:{display:"inline-block"}},null,8,["icon"]),X("span",null,j(F.title),1)])]),_:1},8,["data"])),[[H,S.value]])]),_:1})):z("",!0),y(A,{span:g.value?14:24},{default:f(()=>[y(G,{ref_key:"formRef",ref:m,modelValue:b(s),"onUpdate:modelValue":T[3]||(T[3]=F=>ee(s)?s.value=F:null),defaults:V.value,"onUpdate:defaults":T[4]||(T[4]=F=>V.value=F),option:k},{assignee:f(()=>[(x(!0),M(Y,null,fe(v.value,F=>(x(),$(Q,{key:F.id,type:"info"},{default:f(()=>[P(j(F.title),1)]),_:2},1024))),128))]),copyUser:f(()=>[y(W,{modelValue:p.value,"onUpdate:modelValue":[T[0]||(T[0]=F=>p.value=F),T[1]||(T[1]=F=>b(s).copyUser=F.join(","))],data:_.value,"node-key":"id",multiple:"","show-checkbox":"",clearable:""},null,8,["modelValue","data"])]),comment:f(()=>[y(Uo,{modelValue:b(s).comment,"onUpdate:modelValue":T[2]||(T[2]=F=>b(s).comment=F)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Eo=Jt,at=K({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{getUserTree:i}=ol(),a=R({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(r){t("update:modelValue",r.join(","))}}),s=R({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(r){t("update:modelValue",r)}}),u=N([]),l=N(!1),n=R(()=>{var r,c;return(c=(r=o.tableData)==null?void 0:r.row)==null?void 0:c.type});return _e(n,r=>{["dept","post","user"].includes(r)&&(l.value=!0,i(r==="user"?"":r).then(c=>{u.value=Fe(c.data,v=>({label:v.title,value:v.id}))}).finally(()=>l.value=!1))},{immediate:!0}),(r,c)=>{const v=D("el-tree-select"),_=D("el-input");return["dept","post","user"].includes(n.value)?(x(),$(v,{key:0,modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=p=>a.value=p),data:u.value,loading:l.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):(x(),$(_,{key:1,modelValue:s.value,"onUpdate:modelValue":c[1]||(c[1]=p=>s.value=p)},null,8,["modelValue"]))}}}),Po={key:0,class:"flow-viewer"},Fo={class:"flow-status-legend"},Ao=K({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,{FlowViewer:i,FlowModeler:a}=q(),s=N({}),u=N({}),l=R({get(){let w=Gt();return typeof o.modelValue=="string"&&o.modelValue?w=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(w=o.modelValue),w},set(w){t("update:modelValue",JSON.stringify(w))}}),n=R(()=>{const{column:w=[],group:d=[]}=JSON.parse(o.flowFormOption||"{}");return[...w,...d.map(h=>h.column??[]).flat()]}),{data:r}=Je().useList(),c=R(()=>{var w;return(w=r.value)==null?void 0:w.filter(d=>d.status===1)}),v=R(()=>n.value.map(d=>({label:d.label,value:`\${${d.prop}}`,desc:`\${${d.prop}}`}))),_=de(He),p=de(Ge);_e(u,w=>{var d,g,h,O,L,S,U,E,C,I,T;w&&(w.priority&&(w.priority.control=()=>({priority:{dicData:v.value}})),w.formTitle&&(w.formTitle.control=()=>({formTitle:{dicData:v.value}})),(h=(g=(d=w.assignee)==null?void 0:d.children)==null?void 0:g.column)!=null&&h[1]&&(w.assignee.children.column[1].component=at),(C=(E=(U=(S=(L=(O=w.circulate)==null?void 0:O.children)==null?void 0:L.column)==null?void 0:S[1])==null?void 0:U.children)==null?void 0:E.column)!=null&&C[1]&&(w.circulate.children.column[1].children.column[1].component=at),w.button&&((T=(I=w.button.children)==null?void 0:I.column)==null||T.forEach(A=>{A.prop==="display"&&(A.dicData=_),A.prop==="approval"&&(A.dicData=p)})))});const{data:m}=Ie().useParam("flow.task.status"),V=R(()=>{var w;return(w=o.flowHistory)==null?void 0:w.map(d=>{var h,O;const g=(O=(h=m.value)==null?void 0:h.find(L=>L.value===d.status))==null?void 0:O.style;return{id:d.taskNodeKey,style:g}})}),k=R(()=>{var w,d;return(d=(w=o.flowHistory)==null?void 0:w.filter(g=>g.taskNodeType==="userTask"))==null?void 0:d.map(g=>{var h;return{id:g.taskNodeKey,content:`<div>${g.assigneeName}</div>
        <div>${g.endTime??""}</div>
        <div>${((h=g.comment)==null?void 0:h.comment)??""}</div>`}})});return(w,d)=>w.view?(x(),M("div",Po,[X("div",Fo,[(x(!0),M(Y,null,fe(b(m),g=>{var h;return x(),M("div",{key:g.label,class:"legend-item"},[X("div",{class:"legend-color",style:Mt({backgroundColor:(h=g.style)==null?void 0:h.fill})},null,4),X("span",null,j(g.label),1)])}),128))]),y(b(i),{"model-value":l.value,styles:V.value,tooltips:k.value},null,8,["model-value","styles","tooltips"])])):(x(),$(b(a),{key:1,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=g=>l.value=g),formData:s.value,"onUpdate:formData":d[1]||(d[1]=g=>s.value=g),formDefaults:u.value,"onUpdate:formDefaults":d[2]||(d[2]=g=>u.value=g),"form-options":b(Eo),"data-options":{formPropertyColumn:n.value,buttonList:c.value},"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const Te=ze(Ao,[["__scopeId","data-v-b012ea56"]]),Mo={class:"flow-track"},Ko={key:0},Bo={key:1},jo=K({__name:"flow-track",props:{flowDetail:{}},setup(e){const t=e,o=N("table"),i=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],a=R(()=>{var n,r,c;return((c=(r=(n=t.flowDetail)==null?void 0:n.flowHistory)==null?void 0:r.filter(v=>v.taskNodeType==="userTask"))==null?void 0:c.map(v=>({...v,duration:It(v.duration)})))??[]}),s={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:u}=Ie().useParam("flow.handle.type");function l(n){var r;return(r=u.value)==null?void 0:r.find(c=>c.value===n)}return(n,r)=>{var w,d,g;const c=D("el-radio-button"),v=D("el-radio-group"),_=D("avue-crud"),p=D("el-card"),m=D("el-timeline-item"),V=D("el-timeline"),k=D("el-empty");return x(),M(Y,null,[y(v,{modelValue:o.value,"onUpdate:modelValue":r[0]||(r[0]=h=>o.value=h)},{default:f(()=>[(x(),M(Y,null,fe(i,h=>y(c,{key:h.label,label:h.label},{default:f(()=>[y(b(re),{icon:h.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),X("div",Mo,[o.value==="table"?(x(),$(_,{key:0,data:a.value,option:s},null,8,["data"])):z("",!0),o.value==="graph"?(x(),$(Te,{key:1,"model-value":(d=(w=n.flowDetail)==null?void 0:w.process)==null?void 0:d.flowData,"flow-history":(g=n.flowDetail)==null?void 0:g.flowHistory,view:""},null,8,["model-value","flow-history"])):z("",!0),o.value==="timeline"?(x(),M(Y,{key:2},[a.value.length?(x(),$(V,{key:0},{default:f(()=>[(x(!0),M(Y,null,fe([...a.value].reverse(),h=>(x(),$(m,{key:h.id,timestamp:h.endTime,placement:"top"},{default:f(()=>[y(p,null,{default:f(()=>{var O,L,S;return[X("div",null,j(h.assigneeName)+" 开始处理 ["+j(h.taskNodeName)+"] 环节 ",1),h.duration?(x(),M("div",Ko," 办理时长："+j(h.duration),1)):z("",!0),h.type&&((O=h.comment)!=null&&O.comment)?(x(),M("div",Bo,j((L=l(h.type))==null?void 0:L.label)+"意见："+j((S=h.comment)==null?void 0:S.comment),1)):z("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(x(),$(k,{key:1}))],64)):z("",!0)])],64)}}});const zo=ze(jo,[["__scopeId","data-v-430a7108"]]),Wo=K({__name:"button-list",props:{flowDetail:{}},emits:["click"],setup(e,{emit:t}){const o=e,{data:i}=Je().useList();function a(u,l){return u.map(n=>{const r=l.find(v=>v.buttonKey===n.buttonKey);return{...n,...Et(r,["display","approval"])}})}const s=R(()=>{var m,V,k,w,d;const u={userId:"1"},{assignee:l,status:n}=((m=o.flowDetail)==null?void 0:m.task)||{},{createUser:r,flowInstanceId:c,status:v}=((V=o.flowDetail)==null?void 0:V.flowInstance)||{},_={true:!0,false:!1,startUser:r==u.userId,assignee:l==u.userId,todo:n==2,done:n==1,notstarted:!c,started:!!c,finished:v===1,unfinished:v===2};return((d=a(i.value??[],((w=(k=o.flowDetail)==null?void 0:k.properties)==null?void 0:w.button)??[]))==null?void 0:d.filter(g=>{var h,O;return(O=(h=g.display)==null?void 0:h.split(","))==null?void 0:O.every(L=>_[L])}))??[]});return(u,l)=>{const n=D("el-button");return x(!0),M(Y,null,fe(s.value,r=>(x(),$(n,{key:r.buttonKey,type:r.buttonType,onClick:c=>t("click",r)},{default:f(()=>[y(b(re),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Qo=K({__name:"upload-table",props:{flowDetail:{},modelValue:{}},setup(e){const t=e,{modelValue:o}=ye(t,void 0,{passive:!0}),{upload:{action:i,headers:a,preview:s,download:u,props:l}}=q(),n=typeof a=="function"?a():a,r=R(()=>{var d,g;return((g=(d=t.flowDetail)==null?void 0:d.task)==null?void 0:g.flowInstanceId)??Ee()}),c={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:v,getDataList:_,handleDel:p,handleSave:m,afterGetList:V,crudStateRefs:{tableData:k}}=te({crudOption:{...el(),saveSuccessMsg:"上传成功"},tableOption:c,queryForm:{isLatest:1,flowInstanceId:r.value}});V(()=>{o.value=k.value.map(d=>d.id).join(",")}),_();async function w(d,g){var C,I;const{fileName:h,fileType:O,fileSize:L,fileUrl:S,res:U}=l,E={fileName:ge({res:d},`${U}.${h}`),fileType:ge({res:d},`${U}.${O}`),fileSize:ge({res:d},`${U}.${L}`),fileUrl:ge({res:d},`${U}.${S}`),taskId:(I=(C=t.flowDetail)==null?void 0:C.task)==null?void 0:I.taskId,flowInstanceId:r.value,rootMark:(g==null?void 0:g.rootMark)||"",version:typeof(g==null?void 0:g.version)=="number"?g.version+1:1};await m(E,_,()=>{})}return(d,g)=>{const h=D("el-button"),O=D("el-upload"),L=D("avue-crud");return x(),$(L,ae(ne(b(v))),{"menu-left":f(()=>[y(O,{action:b(i),headers:b(n),"show-file-list":!1,onSuccess:g[0]||(g[0]=S=>w(S))},{default:f(()=>[y(h,{type:"primary",icon:"el-icon-upload"},{default:f(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:f(({row:S,index:U})=>[y(h,{type:"primary",text:"",icon:"el-icon-view",onClick:E=>{var C;return(C=b(s))==null?void 0:C(S,b(k))}},{default:f(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),y(h,{type:"primary",text:"",icon:"el-icon-download",onClick:E=>{var C;return(C=b(u))==null?void 0:C(S,b(k))}},{default:f(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),y(O,{action:b(i),headers:b(n),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:E=>w(E,S)},{default:f(()=>[y(h,{type:"primary",text:"",icon:"el-icon-upload"},{default:f(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),y(h,{type:"primary",text:"",icon:"el-icon-delete",onClick:E=>b(p)(S,U)},{default:f(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),qo={class:"flow-form__title"},wt=K({__name:"index",props:Oo(),emits:Lo(),setup(e,{emit:t}){const o=e,i=$o(o,t),{flowDetail:a,modelValue:s,activeTab:u,activeBtn:l,formLoading:n,approvalVisible:r,submitLoading:c,fileIds:v}=i,_=N();async function p(k){var w,d;l.value=k,await((w=_.value)==null?void 0:w.validate()),await((d=o.beforeClick)==null?void 0:d.call(o,k)),(k==null?void 0:k.approval)!=="false"?r.value=!0:V()}const m=Io(i);async function V(){var k,w;try{const{buttonKey:d}=l.value;c.value=!0,await((k=o.beforeSubmit)==null?void 0:k.call(o,l.value));const g=(w=m[d])==null?void 0:w.call(m);g instanceof Promise?(await g,oe.success("操作成功"),r.value=!1,t("complete",l.value)):oe.error("操作失败")}finally{c.value=!1}}return(k,w)=>{const d=D("el-skeleton"),g=D("el-main"),h=D("el-header"),O=D("el-tab-pane"),L=D("el-tabs"),S=D("el-container");return b(n)?(x(),$(g,{key:0},{default:f(()=>[y(d)]),_:1})):(x(),$(S,{key:1,class:"flow-form"},{default:f(()=>[y(h,{class:"flow-form__header"},{default:f(()=>{var U;return[X("div",qo,j((U=b(a).flowInstance)==null?void 0:U.title),1),y(Wo,{"flow-detail":b(a),onClick:p},null,8,["flow-detail"])]}),_:1}),y(g,{class:"flow-form__main"},{default:f(()=>[y(L,{modelValue:b(u),"onUpdate:modelValue":w[2]||(w[2]=U=>ee(u)?u.value=U:null)},{default:f(()=>{var U,E;return[(E=(U=b(a))==null?void 0:U.process)!=null&&E.formPath?Kt(k.$slots,"default",{key:0}):(x(),$(O,{key:1,label:"审批信息",name:"form"},{default:f(()=>[y(So,{ref_key:"formRef",ref:_,modelValue:b(s),"onUpdate:modelValue":w[0]||(w[0]=C=>ee(s)?s.value=C:null),"flow-detail":b(a)},null,8,["modelValue","flow-detail"])]),_:1})),y(O,{label:"附件资料",name:"file",lazy:""},{default:f(()=>[y(Qo,{modelValue:b(v),"onUpdate:modelValue":w[1]||(w[1]=C=>ee(v)?v.value=C:null),"flow-detail":b(a)},null,8,["modelValue","flow-detail"])]),_:1}),y(O,{label:"流程跟踪",name:"track",lazy:""},{default:f(()=>[y(zo,{"flow-detail":b(a)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),y(Ro,{onConfirm:V})]),_:3}))}}});function yt(e,t){switch(t.type){case"window":return Ho(e,t);case"dialog":case"drawer":return Go(e,t);default:return{open:()=>{},close:()=>{}}}}function Ho(e,t){const{window:{url:o="",name:i="flow-form",features:a="left=0,top=0,width=1600,height=900"}={}}=t,s=N(null),u=R(()=>`${o}?${Nt(Ot(e,Lt($t,St)))}`);return{open:()=>{var r;s.value=window.open(u.value,i,a),(r=s.value)==null||r.addEventListener("message",c=>{const{event:v}=c.data,_=b(e)[v];typeof _=="function"&&_(c.data)})},close:()=>{var r;return(r=s.value)==null?void 0:r.close()},openedWindow:s}}function Go(e,t){const{appContext:o}=rt();let i;const a=()=>{i=document.createElement("div"),i.className="flow-form-wrapper";const u=Jo(t.formPath),l=Pe(u,{...b(e)}),n=Pe(t.type==="dialog"?Pt:Ft,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:s,...t.overlay},l);n.appContext=o,jt(n,i),document.body.appendChild(i)},s=()=>{i&&document.body.removeChild(i)};return{open:a,close:s}}function Jo(e){return e?Bt(()=>zt(()=>import(e),[])):wt}const nt=Symbol("flowPagesConfig"),Yo={FlowModeler:null,FlowViewer:null,FormDesign:null,request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var bt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(bt||{});const Ae=de(bt);function q(e,t){return e&&t?(e.provide(nt,Ut(Yo,t)),t):Ke(nt)}var gt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(gt||{}),He=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(He||{}),Ge=(e=>(e.不显示="false",e.审批人="assignee",e.传阅人="circulate",e.抄送人="copyUser",e.意见="comment",e))(Ge||{}),ht=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(ht||{});function Je(){const{request:e}=q(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Xo(){const{request:e}=q(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Zo(){const{request:e}=q(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=n=>e.get(t.list,{params:{type:n,ascs:"sort"}});return{url:t,getList:o,useList:n=>we(()=>o(n.value).then(r=>r.data.records),{refreshDeps:[n]}),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),batchUpdate:n=>e.post(t.batchUpdate,n)}}function Ye(){const{request:e}=q(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:l=>e.get(t.list,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),deploy:l=>e.post(t.deploy,l),getDetail:l=>e.get(t.detail,{params:l})}}var kt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(kt||{});function Xe(){const{request:e}=q(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:s=>e.get(t.list,{params:s}),getDetail:s=>e.get(t.detail,{params:s}),update:s=>e.post(t.update,s)}}function el(){const{request:e}=q(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:s=>e.get(t.list,{params:s}),create:s=>e.post(t.save,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function tl(){const{request:e}=q(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getList:i=>e.get(t.list,{params:i})}}function Ie(){const{request:e}=q(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=r=>e.get(t.list,{params:r}),i=()=>e.get(t.all),a=r=>e.get(t.key,{params:{paramKey:r}});return{url:t,getList:o,getAllParam:i,getParam:a,useParam:r=>we(()=>a(r).then(c=>c.data)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}})}}function Vt(){const{request:e}=q(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ol(){const{request:e}=q(),t={tree:"/sapier-flow/flow-user/tree"},o=a=>e.get(t.tree,{params:{filter:a}});return{url:t,getUserTree:o,useUserTree:()=>we(()=>o().then(a=>a.data))}}function Dt(){const{request:e}=q(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Ct=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ct||{});function Me(){const{request:e}=q(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=n=>e.get(t.list,{params:n});return{url:t,getList:o,useList:()=>we(()=>o({size:-1}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}}),deploy:n=>e.post(t.deploy,n)}}const ll={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:de(gt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(He),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:de(Ge),labelTip:`不显示: 不显示审批窗口;<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>
      抄送人: 显示抄送人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:de(ht)},{label:"按钮预览",prop:"buttonPreview",width:150}]},al=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i}=te({tableOption:ll,crudOption:Je(),sortOption:{ascs:"sort"}});return i(),(a,s)=>{const u=D("el-button"),l=D("avue-crud");return x(),$(l,ae(ne(b(t))),{icon:f(({row:n})=>[y(b(re),{icon:n.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:f(({row:n})=>[y(u,{type:n.buttonType},{default:f(()=>[y(b(re),{icon:n.icon},null,8,["icon"]),P(" "+j(n.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":f(()=>[y(u,{type:b(o).buttonType},{default:f(()=>[y(b(re),{icon:b(o).icon},null,8,["icon"]),P(" "+j(b(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ze={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},nl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...Ze.column.map((e,t)=>({...e,search:t<=2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},xt=K({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:i,deploy:a}=Ye(),{bindVal:s,crudStateRefs:{searchForm:u},getDataList:l}=te({tableOption:nl,crudOption:{getList:i},searchForm:{categoryId:o.categoryId}});ie(()=>{u.value.categoryId=o.categoryId??"",l()});const n=N(!1);async function r(c){await De.confirm("发布新版本，是否确认？","提示",{type:"success"}),n.value=!0,a({flowModuleId:c.flowModuleId}).then(()=>{oe.success("发布成功"),l()}).finally(()=>{n.value=!1})}return(c,v)=>{const _=D("el-button"),p=D("avue-crud");return x(),$(p,ae(ne(b(s))),{"menu-left":f(()=>[y(_,{type:"primary",icon:"el-icon-plus",onClick:v[0]||(v[0]=m=>t("add"))},{default:f(()=>[P(" 新增 ")]),_:1})]),menu:f(({row:m})=>[y(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:V=>t("view",m)},{default:f(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),y(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:V=>t("edit",m)},{default:f(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),y(_,{loading:n.value,type:"text",icon:"el-icon-upload",onClick:V=>r(m)},{default:f(()=>[P(" 发布 ")]),_:2},1032,["loading","onClick"]),y(_,{loading:n.value,type:"text",icon:"el-icon-switch",onClick:V=>t("version",m)},{default:f(()=>[P(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:f(({row:m})=>[y(b(re),{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),sl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...Ze.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Tt=K({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:i,update:a}=Xe(),{bindVal:s,crudStateRefs:{searchForm:u},getDataList:l}=te({tableOption:sl,crudOption:{getList:i,dataPath:"res.data"}});ie(()=>{o.flowModuleId&&(u.value.flowModuleId=o.flowModuleId,l())});const n=N(!1);async function r(c){await De.confirm(`确定将 ${c.flowName}(${c.flowKey}:v${c.version}) 设为主版本?`,"提示",{type:"warning"}),n.value=!0,a({flowDeployId:c.flowDeployId,flowModuleId:c.flowModuleId,mainVersion:1}).then(()=>{oe.success("设置成功"),l()}).finally(()=>{n.value=!1})}return(c,v)=>{const _=D("el-button"),p=D("avue-crud");return x(),$(p,ae(ne(b(s))),{"menu-left":f(()=>[y(_,{loading:n.value,type:"primary",icon:"el-icon-arrow-left",onClick:v[0]||(v[0]=m=>t("back"))},{default:f(()=>[P(" 返回 ")]),_:1},8,["loading"])]),menu:f(({row:m})=>[y(_,{loading:n.value,type:"text",icon:"el-icon-view",onClick:V=>t("view",m)},{default:f(()=>[P(" 查看 ")]),_:2},1032,["loading","onClick"]),y(_,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:V=>t("edit",m)},{default:f(()=>[P(" 编辑 ")]),_:2},1032,["loading","onClick"]),y(_,{loading:n.value,disabled:m.mainVersion===b(kt).是,type:"text",icon:"el-icon-switch",onClick:V=>r(m)},{default:f(()=>[P(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:f(({row:m})=>[y(b(re),{icon:m.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},rl=K({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:i},getDataList:a,handleSave:s,handleUpdate:u,handleDel:l}=te({crudOption:{rowKey:"id",...Xo(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});a();function n(v,_,p,m){s(_,p,m)}function r(v,_,p,m){u(_,NaN,p,m)}async function c(v,_){await l(v.data,NaN),_()}return(v,_)=>{const p=D("avue-tree");return x(),$(p,{modelValue:b(o),"onUpdate:modelValue":_[0]||(_[0]=m=>ee(o)?o.value=m:null),option:b(st),data:b(i),onNodeClick:_[1]||(_[1]=m=>t("node-click",m)),onSave:n,onUpdate:r,onDel:c},null,8,["modelValue","option","data"])}}}),et=K({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var n;const o=e,{FormDesign:i}=q(),a=R({get(){return o.modelValue?it(o.modelValue):{menuBtn:!1,span:24}},set(r){t("update:modelValue",qt(r,{useJson5:!1}))}}),s=R(()=>o.fields?JSON.parse(o.fields):[]),u=R(()=>{const r={type:"select",dicData:s.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...r,props:{label:"name",value:"name",desc:"comment"}},{...r,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((n=Ht.settings)==null?void 0:n.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(r,c)=>{const v=D("avue-form");return r.view?(x(),$(v,{key:0,class:Wt(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(x(),$(b(i),{key:1,modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=_=>a.value=_),"base-option":u.value,resources:l},null,8,["modelValue","base-option"]))}}}),il=X("span",null,"流程设计",-1),ul={key:0},cl={key:1},dl={style:{height:"calc(100vh - 144px)"}},pl=K({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const i=ye(e),{visible:a,modelValue:s}=i,{create:u,deploy:l,getDetail:n,update:r}=Ye(),{getDetail:c,update:v}=Xe(),_=["流程信息","表单设计","模型设计","完成"],p=N(!1);_e(a,async E=>{if(!E)return;const{flowModuleId:C}=s.value,{flowDeployId:I}=s.value;try{p.value=!0;let T={};I?T=await c({flowDeployId:I}):C&&(T=await n({flowModuleId:C})),s.value=T.data}finally{p.value=!1}},{immediate:!0});const{data:m}=Dt().useList(),{data:V}=Vt().useList(),{data:k}=Me().useList(),w=R(()=>{var E,C;return(C=(E=k.value)==null?void 0:E.find(I=>I.tableName===s.value.formDataTable))==null?void 0:C.tableFields}),d=N(0),g=R(()=>{var E,C;return d.value===1?((E=m.value)==null?void 0:E.map(I=>({label:I.formName,value:I.formOption})))??[]:d.value===2?((C=V.value)==null?void 0:C.map(I=>({label:I.flowName,value:I.flowData})))??[]:[]});function h(E){d.value===1?s.value.formOption=E.value:d.value===2&&(s.value.flowData=E.value)}const O=N();async function L(E){d.value===0&&await qe(O),p.value=!0;const{flowModuleId:C}=s.value,{flowDeployId:I}=s.value;try{I?await v(s.value):C?await r(s.value):await u(s.value).then(T=>{s.value.flowModuleId=T.data.flowModuleId}),oe.success("保存成功")}finally{p.value=!1}typeof E=="number"?d.value=E:d.value++}async function S(){await De.confirm("发布新版本，是否确认？","提示"),p.value=!0,l({flowModuleId:s.value.flowModuleId}).then(()=>{oe.success("发布成功")}).finally(()=>{p.value=!1})}function U(){a.value=!1,d.value=0,s.value={},t("close")}return(E,C)=>{const I=D("el-link"),T=D("el-dropdown-item"),A=D("el-dropdown-menu"),Q=D("el-dropdown"),W=D("el-col"),G=D("el-step"),ce=D("el-steps"),J=D("el-button"),Z=D("el-row"),H=D("avue-form"),F=D("el-result"),se=D("el-dialog"),tt=Be("loading");return x(),$(se,{modelValue:b(a),"onUpdate:modelValue":C[5]||(C[5]=B=>ee(a)?a.value=B:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:U},{header:f(()=>[y(Z,{justify:"center"},{default:f(()=>[y(W,{span:5},{default:f(()=>{var B,me,Ne,ot;return[X("div",null,[il,(B=b(s))!=null&&B.flowName?(x(),M("span",ul," - "+j((me=b(s))==null?void 0:me.flowName),1)):z("",!0),(Ne=b(s))!=null&&Ne.version?(x(),M("span",cl," - V"+j((ot=b(s))==null?void 0:ot.version),1)):z("",!0)]),g.value.length?(x(),$(Q,{key:0},{dropdown:f(()=>[y(A,null,{default:f(()=>[(x(!0),M(Y,null,fe(g.value,Oe=>(x(),$(T,{key:Oe.label,onClick:Ul=>h(Oe)},{default:f(()=>[P(j(Oe.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:f(()=>[y(I,{icon:"el-icon-arrow-down",underline:!1},{default:f(()=>[P(" 选择模板 ")]),_:1})]),_:1})):z("",!0)]}),_:1}),y(W,{span:14},{default:f(()=>[y(ce,{active:d.value,simple:"","process-status":"finish","finish-status":"success"},{default:f(()=>[(x(),M(Y,null,fe(_,(B,me)=>y(G,{key:me,title:B,onClick:Ne=>L(me)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),y(W,{span:5,style:{"text-align":"right"}},{default:f(()=>[y(J,{disabled:d.value===0,loading:p.value,type:"primary",onClick:C[0]||(C[0]=B=>d.value--)},{default:f(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),y(J,{disabled:d.value===_.length-1,type:"primary",loading:p.value,onClick:C[1]||(C[1]=B=>L())},{default:f(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),y(J,{onClick:U},{default:f(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:f(()=>[je((x(),M("div",dl,[d.value===0?(x(),$(H,{key:0,ref_key:"formRef",ref:O,modelValue:b(s),"onUpdate:modelValue":C[2]||(C[2]=B=>ee(s)?s.value=B:null),option:b(Ze),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):z("",!0),d.value===1?(x(),$(et,{key:1,modelValue:b(s).formOption,"onUpdate:modelValue":C[3]||(C[3]=B=>b(s).formOption=B),fields:w.value},null,8,["modelValue","fields"])):z("",!0),d.value===2?(x(),$(Te,{key:2,modelValue:b(s).flowData,"onUpdate:modelValue":C[4]||(C[4]=B=>b(s).flowData=B),"flow-form-option":b(s).formOption},null,8,["modelValue","flow-form-option"])):z("",!0),d.value===3?(x(),$(F,{key:3,icon:"success",title:"流程设计完成"},{extra:f(()=>[b(s).flowDeployId?z("",!0):(x(),$(J,{key:0,type:"primary",onClick:S},{default:f(()=>[P(" 发布 ")]),_:1})),y(J,{onClick:U},{default:f(()=>[P(" 关闭 ")]),_:1})]),_:1})):z("",!0)])),[[tt,p.value]])]),_:1},8,["modelValue"])}}}),fl=X("span",null,"流程查看",-1),ml={key:0},vl={key:1},_l=K({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=ye(e),{visible:i,modelValue:a}=o,{getDetail:s}=Ye(),{getDetail:u}=Xe(),l=N("form"),n=N(!1);_e(i,async c=>{if(!c)return;const{flowModuleId:v}=a.value,{flowDeployId:_}=a.value;try{n.value=!0;let p={};_?p=await u({flowDeployId:_}):v&&(p=await s({flowModuleId:v})),a.value={...p.data}}finally{n.value=!1}},{immediate:!0});function r(){a.value={},l.value="form"}return(c,v)=>{const _=D("el-tab-pane"),p=D("el-tabs"),m=D("el-dialog"),V=Be("loading");return x(),$(m,{modelValue:b(i),"onUpdate:modelValue":v[3]||(v[3]=k=>ee(i)?i.value=k:null),width:"60%",top:"0",onClose:r},{header:f(()=>{var k,w,d,g;return[fl,(k=b(a))!=null&&k.flowName?(x(),M("span",ml," - "+j((w=b(a))==null?void 0:w.flowName),1)):z("",!0),(d=b(a))!=null&&d.version?(x(),M("span",vl," - V"+j((g=b(a))==null?void 0:g.version),1)):z("",!0)]}),default:f(()=>[je((x(),$(p,{modelValue:l.value,"onUpdate:modelValue":v[2]||(v[2]=k=>l.value=k)},{default:f(()=>[y(_,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:f(()=>[l.value==="form"&&b(a).formOption?(x(),$(et,{key:0,modelValue:b(a).formOption,"onUpdate:modelValue":v[0]||(v[0]=k=>b(a).formOption=k),view:""},null,8,["modelValue"])):z("",!0)]),_:1}),y(_,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:f(()=>[l.value==="flow"?(x(),$(Te,{key:0,modelValue:b(a).flowData,"onUpdate:modelValue":v[1]||(v[1]=k=>b(a).flowData=k),view:""},null,8,["modelValue"])):z("",!0)]),_:1})]),_:1},8,["modelValue"])),[[V,n.value]])]),_:1},8,["modelValue"])}}}),wl=K({__name:"index",setup(e){const t=N("definition"),o=N({}),i=N(""),a=N("");function s(m){i.value===m.id?i.value="":i.value=m.id}const u=N(!1),l=N(!1);function n(){o.value={},u.value=!0}function r(m){o.value=m,u.value=!0}function c(m){o.value=m,l.value=!0}function v(m){a.value=m.flowModuleId||"",t.value="deploy"}function _(){a.value="",t.value="definition"}async function p(){const m=t.value;await pe(),t.value="",await pe(),t.value=`${m}`}return(m,V)=>{const k=D("el-col"),w=D("el-row");return x(),$(w,{gutter:20},{default:f(()=>[y(k,{span:4},{default:f(()=>[y(rl,{onNodeClick:s})]),_:1}),y(k,{span:20},{default:f(()=>[t.value==="definition"?(x(),$(xt,{key:0,"category-id":i.value,onAdd:n,onEdit:r,onView:c,onVersion:v},null,8,["category-id"])):z("",!0),t.value==="deploy"?(x(),$(Tt,{key:1,"flow-module-id":a.value,onEdit:r,onView:c,onBack:_},null,8,["flow-module-id"])):z("",!0),y(pl,{modelValue:o.value,"onUpdate:modelValue":V[0]||(V[0]=d=>o.value=d),visible:u.value,"onUpdate:visible":V[1]||(V[1]=d=>u.value=d),onClose:p},null,8,["modelValue","visible"]),y(_l,{modelValue:o.value,"onUpdate:modelValue":V[2]||(V[2]=d=>o.value=d),visible:l.value,"onUpdate:visible":V[3]||(V[3]=d=>l.value=d)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),yl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]},bl=K({__name:"index",setup(e){const t=Xt("debugMode",!1),{getList:o}=tl(),{bindVal:i,getDataList:a}=te({tableOption:yl,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});a();const s=N({}),{open:u,close:l}=yt(s,{type:"drawer"});function n(r){s.value={flowKey:r.flowKey,taskId:r.taskId,instanceId:r.flowInstanceId,debug:t.value,onComplete:()=>{l(),a()}},u()}return(r,c)=>{const v=D("el-switch"),_=D("el-button"),p=D("el-link"),m=D("avue-crud");return x(),$(m,ae(ne(b(i))),{"menu-right":f(()=>[y(_,{type:"text"},{default:f(()=>[y(v,{modelValue:b(t),"onUpdate:modelValue":c[0]||(c[0]=V=>ee(t)?t.value=V:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:f(({row:V})=>[y(p,{type:"primary",underline:!1,onClick:k=>n(V)},{default:f(()=>[P(j(V.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),gl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ae},{label:"备注",prop:"remark"}]},hl=K({__name:"index",setup(e){const{bindVal:t,getDataList:o}=te({tableOption:gl,crudOption:Ie()});return o(),(i,a)=>{const s=D("avue-crud");return x(),$(s,ae(ne(b(t))),null,16)}}}),kl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Vl={class:"flow-list"},Dl=["onClick"],Cl={class:"flow-name"},xl=K({__name:"index",setup(e){const t=N([]),{getPublishFlow:o,getTodoList:i}=xe();o().then(_=>{t.value=_.data});const a=N({}),{open:s,close:u}=yt(a,{type:"drawer"});function l(_){a.value={flowKey:_.flowKey,taskId:_.taskId,instanceId:_.flowInstanceId,onComplete:()=>{u(),r()}},s()}const{bindVal:n,getDataList:r,crudStateRefs:{searchForm:c}}=te({tableOption:kl,crudOption:{getList:i},searchForm:{status:2}}),v=[{label:"待办",value:2},{label:"已办",value:1}];return(_,p)=>{const m=D("el-button"),V=D("el-collapse-item"),k=D("el-collapse"),w=D("el-card"),d=D("el-divider"),g=D("avue-radio"),h=D("el-link"),O=D("avue-crud");return x(),M(Y,null,[y(w,{"body-style":{padding:"0 20px"}},{default:f(()=>[y(k,{"model-value":"1"},{default:f(()=>[y(V,{name:"1"},{title:f(()=>[y(m,{text:"",icon:"el-icon-promotion"},{default:f(()=>[P(" 发起审批 ")]),_:1})]),default:f(()=>[X("div",Vl,[(x(!0),M(Y,null,fe(t.value,L=>(x(),M("div",{key:L.flowKey,class:"flow-item",onClick:S=>l(L)},[y(b(re),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),X("div",Cl,j(L.flowName),1)],8,Dl))),128))])]),_:1})]),_:1})]),_:1}),y(d,{direction:"horizontal","content-position":"left"}),y(O,ae(ne(b(n))),{"menu-left":f(()=>[y(g,{modelValue:b(c).status,"onUpdate:modelValue":[p[0]||(p[0]=L=>b(c).status=L),b(r)],button:"",dic:v},null,8,["modelValue","onUpdate:modelValue"])]),processTitle:f(({row:L})=>[y(h,{type:"primary",underline:!1,onClick:S=>l(L)},{default:f(()=>[P(j(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Tl=ze(xl,[["__scopeId","data-v-de4a15fa"]]),Il={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Nl=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:a}=te({tableOption:Il,crudOption:Vt()});i();const s=N(!1);async function u(n){o.value=n,s.value=!0}async function l(){await a(o.value,NaN,()=>s.value=!1,()=>{})}return(n,r)=>{const c=D("el-button"),v=D("avue-crud"),_=D("el-dialog");return x(),M(Y,null,[y(v,ae(ne(b(t))),{flowData:f(({row:p})=>[y(c,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>u(p)},{default:f(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),y(_,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=p=>s.value=p),title:`模型设计-${b(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[y(c,{type:"primary",onClick:l},{default:f(()=>[P(" 保存 ")]),_:1}),y(c,{onClick:r[1]||(r[1]=p=>s.value=!1)},{default:f(()=>[P(" 取消 ")]),_:1})]),default:f(()=>[y(Te,{modelValue:b(o).flowData,"onUpdate:modelValue":r[0]||(r[0]=p=>b(o).flowData=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ol={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Ll=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,handleUpdate:a}=te({tableOption:Ol,crudOption:Dt()});i();const s=N(!1);async function u(n){o.value={...n},s.value=!0}async function l(){await a(o.value,NaN,()=>s.value=!1,()=>{})}return(n,r)=>{const c=D("el-button"),v=D("avue-crud"),_=D("el-dialog");return x(),M(Y,null,[y(v,ae(ne(b(t))),{formOption:f(({row:p})=>[y(c,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>u(p)},{default:f(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),y(_,{modelValue:s.value,"onUpdate:modelValue":r[2]||(r[2]=p=>s.value=p),title:`表单设计-${b(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:f(()=>[y(c,{type:"primary",onClick:l},{default:f(()=>[P(" 保存 ")]),_:1}),y(c,{onClick:r[1]||(r[1]=p=>s.value=!1)},{default:f(()=>[P(" 取消 ")]),_:1})]),default:f(()=>[y(et,{modelValue:b(o).formOption,"onUpdate:modelValue":r[0]||(r[0]=p=>b(o).formOption=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),$l={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:de(Ct)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}]}}]},Sl=K({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:i,beforeOpen:a,beforeSubmit:s}=te({crudOption:Me(),tableOption:$l});i();const{data:u}=Ie().useParam("table.default.fields");a(c=>{c==="add"?o.value.tableFields=u.value:o.value.tableFields=JSON.parse(o.value.tableFields)}),s(c=>{c.tableFields=JSON.stringify(c.tableFields)});const{deploy:l}=Me(),n=N(!1);async function r(c){await De.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),n.value=!0,l({id:c.id}).then(()=>{oe.success("部署成功"),i()}).finally(()=>{n.value=!1})}return(c,v)=>{const _=D("el-button"),p=D("avue-crud");return x(),$(p,ae(ne(b(t))),{menu:f(({row:m})=>[y(_,{type:"text",icon:"el-icon-upload",onClick:V=>r(m)},{default:f(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Aa={install(e,t){e.component("FlowButton",al).component("FlowDefinition",xt).component("FlowDeploy",Tt).component("FlowForm",wt).component("FlowManage",wl).component("FlowOps",bl).component("FlowParam",hl).component("FlowTemplate",Nl).component("FormTemplate",Ll).component("TableTemplate",Sl).component("FlowWorkbench",Tl),q(e,t)}};export{Yo as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,al as FlowButton,xt as FlowDefinition,Tt as FlowDeploy,wt as FlowForm,wl as FlowManage,bl as FlowOps,hl as FlowParam,Nl as FlowTemplate,Tl as FlowWorkbench,Ll as FormTemplate,Sl as TableTemplate,bt as Whether,Aa as default,Jo as resolveFlowFormComponent,q as useConfigProvider,yt as useFlowForm,Go as useFlowFormOverlay,Ho as useFlowFormWindow,Ae as whetherDic};
