import{d as ut}from"./index.a2682797.js";import{E as oe,m as it}from"./index.6538ad06.js";import{d as A,a as E,f as Z,u as V,n as ke,Z as ct,Y as Ce,M as dt,j as W,I as R,l as M,S as ae,F as H,k as I,E as $,G as L,K as S,q as Y,v as z,i as ne,a4 as Re,D as ee,_ as Te,w as pe,s as ue,H as X,L as pt,J as ft,O as Se,aa as mt,e as vt,a8 as bt,a9 as gt,C as fe}from"./framework.e6d5cdfe.js";import{I as Me}from"./iconify.0a9b5b72.js";import{a as me,w as Be,d as _t}from"./theme.71a909f8.js";import{_ as yt,a as wt,d as ht}from"./index.2a995bde.js";import"./index.cd139f4e.js";import{j as kt}from"./tree.833e2973.js";import{f as we,t as Ye,a as Ct}from"./vuedraggable.umd.1ba51a0e.js";import{p as Tt}from"./index.vue_vue_type_script_setup_true_lang.65cb5372.js";import{s as Nt,a as ze,e as G,u as Dt}from"./index.9e7c8c99.js";import{d as Vt}from"./differenceBy.b743b0b2.js";import{D as se}from"./index.19ba2f01.js";function xt(e){const{buttonHandler:t,request:a}=Q(),{commitTask:i,revokeTask:o,saveDraft:f,startTask:n,terminateTask:s,transferTask:c,withdrawTask:r,rejectTask:w,greenChannel:u,circulateTask:b}=Le(a),p=A(()=>{const{flowDetail:h,formVariables:g,approvalFormData:l,debug:m,fileIds:d}=e,{flowDeployId:_}=h.value.process??{},{taskId:y,flowInstanceId:N}=h.value.task??{};return{flowDeployId:_,taskId:y,flowInstanceId:N,variables:g.value,debug:m.value,fileIds:d==null?void 0:d.value,...l.value}}),v=()=>p.value.taskId&&p.value.flowInstanceId;return{flow_draft(){if(v())return f(p.value)},flow_pass(){return v()?i(p.value):n(p.value)},flow_revoke(){if(v())return o(p.value)},flow_withdraw(){if(v())return r(p.value)},flow_terminate(){if(v())return s(p.value)},flow_transfer(){if(v())return c(p.value)},flow_reject(){if(v())return w(p.value)},flow_green(){if(v())return u(p.value)},flow_circulate(){if(v()){const{approvalFormData:h,circulateId:g}=e;return b({id:g==null?void 0:g.value,comment:h==null?void 0:h.value.comment})}},...t==null?void 0:t(e)}}function It(e){const t=E({});return Z(async()=>{var i;const{formProperty:a}=((i=V(e))==null?void 0:i.properties)||{};a!=null&&a.length&&(await ke(),Object.keys(t.value).forEach(o=>{var s,c,r,w;const f=((s=t.value[o])==null?void 0:s.label)||"",n=a==null?void 0:a.find(u=>u.prop===o);if(t.value[o].display=n==null?void 0:n.display,t.value[o].disabled=n==null?void 0:n.disabled,t.value[o].detail=n==null?void 0:n.detail,t.value[o].readonly=n==null?void 0:n.readonly,t.value[o].rules=t.value[o].rules??[],n!=null&&n.required&&((c=t.value[o].rules)!=null&&c.some(u=>u.required)))return null;n!=null&&n.required?(r=t.value[o].rules)==null||r.push({required:!0,message:`${f}为必填项`}):t.value[o].rules=(w=t.value[o].rules)==null?void 0:w.filter(u=>!u.required)}))}),t}const Lt={modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalVisible:{type:Boolean},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},fileIds:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:[Boolean,String],default:!1},debug:{type:[Boolean,String],default:!1},circulateId:{type:String}},Ot={complete:e=>e},Ge=Symbol("flowFormState");function Et(e,t){const a=me(e,void 0,{passive:!0,deep:!0}),{flowDetail:i,modelValue:o,formLoading:f}=a,{tabs:n,customForm:s,request:c}=Q(),r=E({}),w=A(()=>(n==null?void 0:n.filter(g=>{var m,d,_;const l=(_=(d=(m=i.value)==null?void 0:m.properties)==null?void 0:d.formProperty)==null?void 0:_.find(y=>y.prop===g.prop);return(l==null?void 0:l.display)!==!1}))??[]),u=A(()=>{var m,d,_;const g=(m=w.value.find(y=>y.prop==="formTab"))==null?void 0:m.component,l=s==null?void 0:s[((_=(d=i==null?void 0:i.value)==null?void 0:d.process)==null?void 0:_.formPath)??""];return typeof l=="function"?dt(l):l??g}),{getFlowDetail:b}=Le(c);Z(()=>{const{flowKey:g,taskId:l,instanceId:m}=e;!g&&!l&&!m||(f.value=!0,b({flowKey:g,taskId:l,flowInstanceId:m}).then(d=>{i.value=d.data,o.value=d.data.formData||{}}).finally(()=>{f.value=!1}))});const p=A(()=>Object.entries(o.value||{}).filter(([g])=>!g.startsWith("$")).map(([g,l])=>({key:g,value:l}))),v=A(()=>e.detail===!0||e.detail==="true"),h={...a,formData:o,formVariables:p,tabRefs:r,tabList:w,formTabComponent:u,detail:v,emit:t};return ct(Ge,h),h}function te(){return Ce(Ge)}const Pt=W({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{userInfo:a,request:i}=Q(),{flowDetail:o,circulateId:f}=te(),{data:n}=et(i).useList();function s(r,w){return r.map(u=>{const b=w.find(v=>v.buttonKey===u.buttonKey);return{...u,...Tt(b,["display","approval"])}})}const c=A(()=>{var d,_,y,N,D,T;if(f!=null&&f.value){const O=(d=n.value)==null?void 0:d.find(k=>k.buttonKey==="flow_circulate");return O?[O]:[]}const r=typeof a=="function"?a():a,{assignee:w,status:u}=((_=o.value)==null?void 0:_.task)||{},{createUser:b,flowInstanceId:p,status:v}=((y=o.value)==null?void 0:y.flowInstance)||{},h={true:!0,false:!1,startUser:b==(r==null?void 0:r.userId),assignee:w==(r==null?void 0:r.userId),todo:u==2,done:u==1,notstarted:!p,started:!!p,finished:v===1,unfinished:v===2},g=((N=n.value)==null?void 0:N.filter(O=>O.buttonKey!=="flow_circulate"))??[],{button:l}=((D=o.value)==null?void 0:D.properties)||{};return((T=s(g,l??[]))==null?void 0:T.filter(O=>{var k,x;return(x=(k=O.display)==null?void 0:k.split(","))==null?void 0:x.every(C=>h[C])}))??[]});return(r,w)=>{const u=R("el-button");return I(!0),M(H,null,ae(c.value,b=>(I(),$(u,{key:b.buttonKey,type:b.buttonType,onClick:p=>t("click",b)},{default:L(()=>[S(V(Me),{icon:b.icon},null,8,["icon"]),Y(" "+z(b.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),Rt=W({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=me(t),{request:i}=Q(),{batchUpdate:o,create:f,remove:n,useList:s}=Na(i),c=E(!1),{activeBtn:r}=te(),w=A(()=>{var _;return(_=r.value)==null?void 0:_.buttonKey}),{data:u,refresh:b}=s(w),p=A(()=>{var y,N,D;const _=a.value;if(_&&!((y=u.value)!=null&&y.some(T=>T.content===_))){const T=(((D=(N=u.value)==null?void 0:N[0])==null?void 0:D.sort)||1)-1;return[{content:_,sort:T},...u.value||[]]}return u.value});async function v(_){var y;await f({..._,type:(y=r.value)==null?void 0:y.buttonKey}),oe.success("添加成功"),b()}async function h(_){await n(_.id),oe.success("删除成功"),b()}async function g(_,y){let N=y.parent.data;N=N.map((D,T)=>({id:D.id,sort:T+1})),await o(N),oe.success("修改排序成功"),b(),c.value=!1}function l(){c.value=!0}const m=E();async function d(_){var y;a.value=_.content??"",await ke(),(y=m.value)==null||y.blur()}return(_,y)=>{const N=R("el-input"),D=R("el-text"),T=R("el-col"),O=R("el-button"),k=R("el-row"),x=R("el-tree"),C=R("el-popover");return I(),$(C,{visible:c.value,placement:"bottom",title:"常用意见",width:600},{reference:L(()=>[S(N,{ref_key:"inputRef",ref:m,modelValue:V(a),"onUpdate:modelValue":y[0]||(y[0]=P=>ne(a)?a.value=P:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:y[1]||(y[1]=P=>c.value=!0),onBlur:y[2]||(y[2]=P=>c.value=!1)},null,8,["modelValue"])]),default:L(()=>[S(x,{data:p.value,"node-key":"content",draggable:"","allow-drop":(P,K,U)=>U!=="inner",props:{label:"content"},onNodeClick:d,onNodeDrop:g,onNodeDragStart:l},{default:L(({data:P})=>[S(k,{style:{width:"600px"}},{default:L(()=>[S(T,{span:22},{default:L(()=>[S(D,{truncated:"",title:P.content},{default:L(()=>[Y(z(P.content),1)]),_:2},1032,["title"])]),_:2},1024),S(T,{span:2},{default:L(()=>[P.id?(I(),$(O,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Re(K=>h(P),["stop"])},null,8,["onClick"])):(I(),$(O,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Re(K=>v(P),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),St=W({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:a}=me(t),i=E(),o={class(u){return`node-${u.type}`}},f=A(()=>Ye(t.data??[],(u,b,p)=>{const v=ze();return u.taskNodeKey=(p==null?void 0:p.taskNodeKey)??u.taskNodeKey,u.incoming=(p==null?void 0:p.incoming)??u.incoming,u.multiple=(p==null?void 0:p.multiple)??u.multiple,{...u,id:v,label:u.title,disabled:u.type!=="user"}})),n={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};Be(()=>[f.value,i.value],async()=>{if(!i.value||!f.value.length)return;if(t.autoCheck){const b=s(f.value);b&&w([b])}we(f.value,b=>{var p;return!!((p=b.children)!=null&&p.length)}).map(async b=>{var v;await Nt(100);const p=(v=i.value)==null?void 0:v.getNode(b);p==null||p.expand()})},{immediate:!0,debounce:100});function s(u){var b;if(u.length===1)return(b=u[0].children)!=null&&b.length?s(u[0].children):u[0]}async function c(u,{checkedNodes:b}){var h;let p=b.filter(g=>g.type==="user");const v=p.some(g=>g.id===u.id);if(f.value.every(g=>!g.multiple)&&v)p=[u];else if(!u.multiple&&v){const m=((h=i.value)==null?void 0:h.getNode(u)).parent.data.children.filter(d=>d.id!==u.id);p=Vt(p,m,"id")}w(p)}function r(u){const b=a.value.filter(p=>p.id!==u.id);w(b)}function w(u){var b;a.value=u,(b=i.value)==null||b.setCheckedNodes(u)}return(u,b)=>{const p=R("el-tag"),v=R("Icon"),h=R("el-tree");return I(),M(H,null,[(I(!0),M(H,null,ae(V(a),g=>(I(),$(p,{key:g.id,type:"info",closable:"",onClose:l=>r(g)},{default:L(()=>[Y(z(g.title),1)]),_:2},1032,["onClose"]))),128)),S(h,{ref_key:"treeRef",ref:i,class:"approval-tree",data:f.value,props:o,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:c},{default:L(({data:g})=>[ee("div",null,[S(v,{icon:n[g.type]||n.element,style:{display:"inline-block"}},null,8,["icon"]),ee("span",null,z(g.title),1)])]),_:1},8,["data"])],64)}}});const Ae=Te(St,[["__scopeId","data-v-e8348616"]]),At={key:0},Ue=W({__name:"assignee-setter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,i=A({get(){return typeof a.modelValue=="string"?a.modelValue?a.modelValue.split(","):[]:a.modelValue},set(v){var h;t("update:modelValue",v.join(",")),(h=a.tableData)!=null&&h.row&&(a.tableData.row.idVal=we(s.value,g=>v==null?void 0:v.includes(g.id)).map(g=>g[`${n.value}Id`]).join(","))}}),o=A({get(){return Array.isArray(a.modelValue)?a.modelValue.join(","):a.modelValue},set(v){t("update:modelValue",v)}}),f=E(!1),n=A(()=>{var v,h;return(h=(v=a.tableData)==null?void 0:v.row)==null?void 0:h.type}),s=E([]),c=E([]),{request:r}=Q(),{getUserTree:w}=La(r),{getParam:u}=ve(r);pe(n,v=>{["dept","post","user"].includes(v)?(f.value=!0,w(v==="user"?"":v).then(h=>{s.value=Ye(h.data,g=>({...g,label:g.title,value:g.id,disabled:v==="user"?g.type!=="user":!1}))}).finally(()=>f.value=!1)):n.value==="dynamic"&&(f.value=!0,u("flow.trends.user").then(h=>{c.value=h.data}).finally(()=>f.value=!1))},{immediate:!0});const b=E();function p(){i.value=we(s.value,v=>v.type===n.value).map(v=>v.id)}return(v,h)=>{const g=R("ElTreeSelect"),l=R("el-button"),m=R("el-input");return["dept","post","user"].includes(n.value)?(I(),M("div",At,[S(g,{ref_key:"treeRef",ref:b,modelValue:i.value,"onUpdate:modelValue":h[0]||(h[0]=d=>i.value=d),"check-on-click-node":"","check-strictly":"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",data:s.value,filterable:"",loading:f.value,"max-collapse-tags":3,multiple:"",placeholder:"请选择","show-checkbox":"",style:{width:"75%"}},null,8,["modelValue","data","loading"]),S(l,{text:"",type:"primary",icon:"el-icon-check",style:{width:"20%"},onClick:p},{default:L(()=>[Y(" 全选 ")]),_:1})])):n.value==="dynamic"?(I(),$(g,{key:1,modelValue:o.value,"onUpdate:modelValue":h[1]||(h[1]=d=>o.value=d),clearable:"",data:c.value,filterable:"",loading:f.value,placeholder:"请选择",style:{width:"100%"}},null,8,["modelValue","data","loading"])):n.value==="userTask"?(I(),$(V(yt),{key:2,modelValue:o.value,"onUpdate:modelValue":h[2]||(h[2]=d=>o.value=d),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(I(),$(m,{key:3,modelValue:o.value,"onUpdate:modelValue":h[3]||(h[3]=d=>o.value=d),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),Ut={key:0,class:"flow-viewer"},$t={key:0,class:"flow-status-legend"},jt=W({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const a=e,i=ue();_t(i,()=>{var l;(l=i.value)==null||l.on("node:click",m=>t("nodeClick",m))});const o=A({get(){let l=ht();return typeof a.modelValue=="string"&&a.modelValue?l=JSON.parse(a.modelValue):typeof a.modelValue=="object"&&Object.keys(a.modelValue)&&(l=a.modelValue),l},set(l){t("update:modelValue",JSON.stringify(l))}}),f=A(()=>{const{column:l=[],group:m=[]}=JSON.parse(a.flowFormOption||"{}");return[...l,...m.map(_=>_.column??[]).flat()]}),{FlowDesign:n,tabs:s,request:c}=Q(),{data:r}=et(c).useList(),w=A(()=>(s==null?void 0:s.map(l=>({...l,display:!0})))??[]),u=A(()=>{var l;return{formPropertyList:[...f.value,...w.value],buttonList:(l=r.value)==null?void 0:l.filter(m=>m.status===1),fieldsDic:f.value.map(m=>({label:m.label,value:`\${${m.prop}}`,desc:`\${${m.prop}}`})),flowButtonDisplayDic:G(xe),flowButtonApprovalDic:G(Ie)}}),b=E({}),p=E({});Be(p,l=>{var m,d,_,y,N,D;l&&((_=(d=(m=l.assignee)==null?void 0:m.children)==null?void 0:d.column)!=null&&_[1]&&(l.assignee.children.column[1].component=Ue),(D=(N=(y=l.circulate)==null?void 0:y.children)==null?void 0:N.column)!=null&&D[1]&&(l.circulate.children.column[1].component=Ue))},{debounce:1});const{data:v}=ve(c).useParam("flow.task.status"),h=A(()=>{var l;return(l=a.flowHistory)==null?void 0:l.map(m=>{var _,y;const d=(y=(_=v.value)==null?void 0:_.find(N=>N.value===m.status))==null?void 0:y.style;return{id:m.taskNodeKey,style:d}})}),g=A(()=>{var l,m;return(m=(l=a.flowHistory)==null?void 0:l.filter(d=>d.taskNodeType==="userTask"))==null?void 0:m.map(d=>{var _;return{id:d.taskNodeKey,content:`<div>${d.assigneeName}</div>
        <div>${d.endTime??""}</div>
        <div>${((_=d.comment)==null?void 0:_.handleComment)??""}</div>`}})});return(l,m)=>l.view?(I(),M("div",Ut,[l.showLegend!==!1?(I(),M("div",$t,[(I(!0),M(H,null,ae(V(v),d=>{var _;return I(),M("div",{key:d.label,class:"legend-item"},[ee("div",{class:"legend-color",style:pt({backgroundColor:(_=d.style)==null?void 0:_.fill})},null,4),ee("span",null,z(d.label),1)])}),128))])):X("",!0),S(V(n),{lf:i.value,"onUpdate:lf":m[0]||(m[0]=d=>i.value=d),"model-value":o.value,styles:h.value,tooltips:g.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(I(),$(V(n),{key:1,modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=d=>o.value=d),formData:b.value,"onUpdate:formData":m[2]||(m[2]=d=>b.value=d),formDefaults:p.value,"onUpdate:formDefaults":m[3]||(m[3]=d=>p.value=d),"form-options":V(wt),"data-options":u.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const We=Te(jt,[["__scopeId","data-v-fc890812"]]),Kt=W({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=me(t),{flowDetail:i}=te(),o=E(!1);function f({data:n}){n.type==="userTask"&&(o.value=!1,a.value=n.id)}return(n,s)=>{const c=R("el-button"),r=R("el-popover");return I(),$(r,{visible:o.value,"onUpdate:visible":s[0]||(s[0]=w=>o.value=w),placement:"bottom-start",width:"800px",trigger:"click"},{reference:L(()=>[S(c,null,{default:L(()=>[Y(" 点击选择节点 ")]),_:1})]),default:L(()=>{var w,u;return[S(We,{"model-value":(u=(w=V(i))==null?void 0:w.process)==null?void 0:u.flowData,view:"",style:{height:"600px"},onNodeClick:f},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Mt=W({__name:"approval-form",emits:["submit"],setup(e,{emit:t}){const{request:a}=Q(),{getApprovalNode:i}=Le(a),{useParam:o}=ve(a),{formData:f,approvalFormData:n,activeBtn:s,approvalVisible:c,formVariables:r,flowDetail:w}=te(),u=E([]),b=E([]),p=E([]),v=E([]),h=E(!1),g=E(!1),l=E(),m=E(),d={menuBtn:!1,labelWidth:100,column:[{label:"指定节点",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:_}]},{label:"传阅人",prop:"circulate",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function _(x,C,P){var B,j,Pe;const K=((B=u.value[0])==null?void 0:B.type)==="parallelGateway",U=(Pe=(j=u.value[0])==null?void 0:j.children)==null?void 0:Pe.every(nt=>Ct([nt],rt=>b.value.some(st=>st.id===rt.id)));if(b.value.length){if(K&&!U)return P("请在每个节点选择审批人")}else return P("请选择审批人");return!0}const{data:y}=o("flow.default.comment"),{data:N}=o("flow.approval.autocheck");Z(async()=>{var C;if(!c.value||!l.value||!m.value)return;D();const{taskId:x}=((C=w.value)==null?void 0:C.task)||{};ke(()=>{l.value.resetFields(),n.value.comment=f.value.comment||(x?"":y.value)||"",m.value.jumpTaskNodeKey.display=T("specifyNode"),m.value.assignee.display=T("assignee"),m.value.circulate.display=T("circulate"),m.value.comment.display=T("comment")})}),Z(async()=>{var P,K;if(!c.value||!T("assignee")||T("specifyNode")&&!n.value.jumpTaskNodeKey)return;D();const{flowKey:x}=((P=w.value)==null?void 0:P.process)||{},{taskId:C}=((K=w.value)==null?void 0:K.task)||{};try{g.value=!0;const U=await i({flowKey:x,taskId:C,variables:r.value,buttonType:s.value.buttonKey,jumpTaskNodeKey:n.value.jumpTaskNodeKey});u.value=U.data.approvalNodeList,p.value=U.data.circulateNodeList}finally{g.value=!1}});function D(){u.value=[],b.value=[],p.value=[],v.value=[]}function T(x){var C,P;return(P=(C=s.value)==null?void 0:C.approval)==null?void 0:P.includes(x)}async function O(){await ot(l),h.value=!0;const{data:x,outgoing:C}=k(b.value),{data:P}=k(v.value);n.value.assignee=x,n.value.outgoing=[...C],n.value.circulate=P,console.log("🚀 ~ file: approval-form.vue:133 ~ onConfirm ~ formData:",f),t("submit")}function k(x){const C={},P={},K=new Set;return x.forEach(U=>{const{taskNodeKey:B,incoming:j}=U;C[B]||(C[B]=new Set),U.userId&&C[B].add(U.userId),P[B]=[...C[B]].join(","),j&&K.add(j)}),{set:C,data:P,outgoing:K}}return(x,C)=>{const P=R("el-skeleton"),K=R("avue-form"),U=R("el-button"),B=R("el-dialog");return I(),$(B,{modelValue:V(c),"onUpdate:modelValue":C[7]||(C[7]=j=>ne(c)?c.value=j:null),class:"approlval-form",title:V(s).name,width:"900px","append-to-body":""},{footer:L(()=>[S(U,{onClick:C[6]||(C[6]=j=>c.value=!1)},{default:L(()=>[Y(" 取 消 ")]),_:1}),S(U,{type:"primary",onClick:O},{default:L(()=>[Y(" 确 定 ")]),_:1})]),default:L(()=>[S(K,{ref_key:"formRef",ref:l,modelValue:V(n),"onUpdate:modelValue":C[4]||(C[4]=j=>ne(n)?n.value=j:null),defaults:m.value,"onUpdate:defaults":C[5]||(C[5]=j=>m.value=j),option:d},{jumpTaskNodeKey:L(()=>[S(Kt,{modelValue:V(n).jumpTaskNodeKey,"onUpdate:modelValue":C[0]||(C[0]=j=>V(n).jumpTaskNodeKey=j)},null,8,["modelValue"])]),assignee:L(()=>[g.value?(I(),$(P,{key:0})):(I(),$(Ae,{key:"AssigneeTree",modelValue:b.value,"onUpdate:modelValue":C[1]||(C[1]=j=>b.value=j),data:u.value,"auto-check":V(N)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:L(()=>[g.value?(I(),$(P,{key:0})):(I(),$(Ae,{key:"CirculateTree",modelValue:v.value,"onUpdate:modelValue":C[2]||(C[2]=j=>v.value=j),data:p.value},null,8,["modelValue","data"]))]),comment:L(()=>[S(Rt,{modelValue:V(n).comment,"onUpdate:modelValue":C[3]||(C[3]=j=>V(n).comment=j)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Bt={class:"flow-form__title"},Yt=W({__name:"index",props:Lt,emits:Ot,setup(e,{emit:t}){const i=Et(e,t),{ApprovalForm:o,tabsProps:f}=Q(),n=o??Mt,{title:s,detail:c,flowDetail:r,tabRefs:w,tabList:u,activeTab:b,activeBtn:p,formLoading:v,formTabComponent:h,approvalVisible:g,submitLoading:l,beforeClick:m,beforeSubmit:d}=i;async function _(D){var T,O;p.value=D;for(const k of Object.values(w.value))await((T=k==null?void 0:k.validate)==null?void 0:T.call(k));await((O=m==null?void 0:m.value)==null?void 0:O.call(m,D)),(D==null?void 0:D.approval)!=="false"?g.value=!0:N()}const y=xt(i);async function N(){var D;try{const{buttonKey:T}=p.value;l.value=!0,await((D=d==null?void 0:d.value)==null?void 0:D.call(d,p.value));const O=y[T];O?(await(O==null?void 0:O()),oe.success("操作成功"),g.value=!1,t("complete",p.value)):oe.error("无法找到相应的操作")}finally{l.value=!1}}return(D,T)=>{const O=R("el-skeleton"),k=R("el-main"),x=R("el-header"),C=R("el-tab-pane"),P=R("el-tabs"),K=R("el-container");return V(v)?(I(),$(k,{key:0},{default:L(()=>[S(O)]),_:1})):(I(),$(K,{key:1,class:"flow-form"},{default:L(()=>[S(x,{class:"flow-form__header",height:"auto"},{default:L(()=>{var U;return[ee("div",Bt,z(V(s)??((U=V(r).flowInstance)==null?void 0:U.title)),1),V(c)?X("",!0):(I(),$(Pt,{key:0,onClick:_}))]}),_:1}),S(k,{class:"flow-form__main"},{default:L(()=>[S(P,ft({modelValue:V(b),"onUpdate:modelValue":T[0]||(T[0]=U=>ne(b)?b.value=U:null)},V(f)),{default:L(()=>[(I(!0),M(H,null,ae(V(u),U=>(I(),$(C,{key:U.prop,label:U.label,name:U.prop,lazy:U.lazy,disabled:U.disabled,closable:U.closable},{default:L(()=>[U.prop==="formTab"?(I(),$(Se(V(h)),{key:0,ref_for:!0,ref:B=>V(w)[U.prop]=B},null,512)):(I(),$(Se(U.component),{key:1,ref_for:!0,ref:B=>V(w)[U.prop]=B},null,512))]),_:2},1032,["label","name","lazy","disabled","closable"]))),128))]),_:1},16,["modelValue"])]),_:1}),S(V(n),{onSubmit:N})]),_:1}))}}});const zt=W({setup(){const{flowDetail:e,formData:t,detail:a}=te(),i=It(e.value),{proxy:o}=vt(),f=E({});Z(()=>{const{formOption:c}=e.value.process??{};f.value=kt.bind(o)(c||'{"menuBtn":false}'),f.value.detail=!!a.value});const n=E();function s(){return ot(n)}return{form:t,option:f,defaults:i,formRef:n,validate:s}},render(){return mt(R("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,class:this.option.class,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Gt=W({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:a}=te(),{upload:{action:i,headers:o,preview:f,download:n,props:s}={},request:c}=Q(),r=typeof o=="function"?o():o,w=A(()=>{var d,_;return((_=(d=t.value)==null?void 0:d.task)==null?void 0:_.flowInstanceId)??ze()}),u={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:b,getDataList:p,handleDel:v,handleSave:h,afterGetList:g,crudStateRefs:{tableData:l}}=Dt({crudOption:{...Va(c),saveSuccessMsg:"上传成功"},tableOption:u,queryForm:{isLatest:1,flowInstanceId:w.value}});g(()=>{a.value=l.value.map(d=>d.id).join(",")}),p();async function m(d,_){var x,C;const{fileName:y,fileType:N,fileSize:D,fileUrl:T,res:O}=s,k={fileName:se({res:d},`${O}.${y}`),fileType:se({res:d},`${O}.${N}`),fileSize:se({res:d},`${O}.${D}`),fileUrl:se({res:d},`${O}.${T}`),taskId:(C=(x=t.value)==null?void 0:x.task)==null?void 0:C.taskId,flowInstanceId:w.value,rootMark:(_==null?void 0:_.rootMark)||"",version:typeof(_==null?void 0:_.version)=="number"?_.version+1:1};await h(k,p,()=>{})}return(d,_)=>{const y=R("el-button"),N=R("el-upload"),D=R("avue-crud");return I(),$(D,bt(gt(V(b))),{"menu-left":L(()=>[S(N,{action:V(i),headers:V(r),"show-file-list":!1,onSuccess:_[0]||(_[0]=T=>m(T))},{default:L(()=>[S(y,{type:"primary",icon:"el-icon-upload"},{default:L(()=>[Y(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:L(({row:T,index:O})=>[S(y,{type:"primary",text:"",icon:"el-icon-view",onClick:k=>{var x;return(x=V(f))==null?void 0:x(T,V(l))}},{default:L(()=>[Y(" 预览 ")]),_:2},1032,["onClick"]),S(y,{type:"primary",text:"",icon:"el-icon-download",onClick:k=>{var x;return(x=V(n))==null?void 0:x(T,V(l))}},{default:L(()=>[Y(" 下载 ")]),_:2},1032,["onClick"]),S(N,{action:V(i),headers:V(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:k=>m(k,T)},{default:L(()=>[S(y,{type:"primary",text:"",icon:"el-icon-upload"},{default:L(()=>[Y(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),S(y,{type:"primary",text:"",icon:"el-icon-delete",onClick:k=>V(v)(T,O)},{default:L(()=>[Y(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),Wt={class:"flow-track"},Ft={key:0},Qt={key:1},Ht=W({__name:"flow-track",setup(e){const{flowDetail:t}=te(),a=E("table"),i=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],o=A(()=>{var r,w,u;return((u=(w=(r=t.value)==null?void 0:r.flowHistory)==null?void 0:w.filter(b=>b.taskNodeType==="userTask"))==null?void 0:u.map(b=>({...b,duration:ut(b.duration)})))??[]}),f={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},{request:n}=Q(),{data:s}=ve(n).useParam("flow.handle.type");function c(r){var w;return(w=s.value)==null?void 0:w.find(u=>u.value===r)}return(r,w)=>{var m,d,_;const u=R("el-radio-button"),b=R("el-radio-group"),p=R("avue-crud"),v=R("el-card"),h=R("el-timeline-item"),g=R("el-timeline"),l=R("el-empty");return I(),M(H,null,[S(b,{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=y=>a.value=y)},{default:L(()=>[(I(),M(H,null,ae(i,y=>S(u,{key:y.label,label:y.label},{default:L(()=>[S(V(Me),{icon:y.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),ee("div",Wt,[a.value==="table"?(I(),$(p,{key:0,data:o.value,option:f},null,8,["data"])):X("",!0),a.value==="graph"?(I(),$(We,{key:1,"model-value":(d=(m=V(t))==null?void 0:m.process)==null?void 0:d.flowData,"flow-history":(_=V(t))==null?void 0:_.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):X("",!0),a.value==="timeline"?(I(),M(H,{key:2},[o.value.length?(I(),$(g,{key:0},{default:L(()=>[(I(!0),M(H,null,ae([...o.value].reverse(),y=>(I(),$(h,{key:y.id,timestamp:y.endTime,placement:"top"},{default:L(()=>[S(v,null,{default:L(()=>{var N,D,T;return[ee("div",null,z(y.assigneeName)+" 开始处理 ["+z(y.taskNodeName)+"] 环节 ",1),y.duration?(I(),M("div",Ft," 办理时长："+z(y.duration),1)):X("",!0),y.type&&((N=y.comment)!=null&&N.handleComment)?(I(),M("div",Qt,z((D=c(y.type))==null?void 0:D.label)+"意见："+z((T=y.comment)==null?void 0:T.handleComment),1)):X("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(I(),$(l,{key:1}))],64)):X("",!0)])],64)}}});const Jt=Te(Ht,[["__scopeId","data-v-ff68835f"]]),$e=Symbol("flowPagesConfig"),Zt={FlowDesign:{},FormDesign:{},FlowForm:Yt,tabs:[{label:"审批表单",prop:"formTab",component:zt},{label:"附件资料",prop:"fileTab",component:Gt},{label:"流程跟踪",prop:"trackTab",component:Jt}],request:()=>{},useFlowFormOptions:{type:"drawer",window:["","flow-form","left=0,top=0,width=1600,height=900"],overlay:{width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0}},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}},Xt={},qt=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),ea=()=>Xt,J=e=>e,he=e=>Array.isArray(e),Ne=e=>e!==null&&typeof e=="object",De=e=>e instanceof Function,re=e=>e==null,Ve=typeof window>"u",Fe=()=>{var e;return Ve||re((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ta=()=>{var e,t;return(e=!Ve&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},be=()=>new Promise(()=>{}),F=e=>ne(e)?e.value:e,aa=e=>Ne(e)?Object.assign(he(e)?[]:{},e):e,ie=new Map,la=e=>re(e)?void 0:ie.get(e),oa=(e,t,a)=>{const i=ie.get(e);i!=null&&i.timer&&clearTimeout(i.timer);const o=setTimeout(()=>ie.delete(e),t);ie.set(e,{...a,timer:o})};function Qe(e,t,a){let i,o,f,n,s,c,r=0,w=!1,u=!1,b=!0;const p=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Ne(a)&&(w=!!a.leading,u="maxWait"in a,f=u?Math.max(+a.maxWait||0,t):f,b="trailing"in a?!!a.trailing:b);function v(k){const x=i,C=o;return i=o=void 0,r=k,n=e.apply(C,x),n}function h(k,x){return p?(window.cancelAnimationFrame(s),window.requestAnimationFrame(k)):setTimeout(k,x)}function g(k){if(p)return window.cancelAnimationFrame(k);clearTimeout(k)}function l(k){return r=k,s=h(_,t),w?v(k):n}function m(k){const x=k-c,C=k-r,P=t-x;return u?Math.min(P,f-C):P}function d(k){const x=k-c,C=k-r;return c===void 0||x>=t||x<0||u&&C>=f}function _(){const k=Date.now();if(d(k))return y(k);s=h(_,m(k))}function y(k){return s=void 0,b&&i?v(k):(i=o=void 0,n)}function N(){s!==void 0&&g(s),r=0,i=c=o=s=void 0}function D(){return s===void 0?n:y(Date.now())}function T(){return s!==void 0}function O(){const k=Date.now(),x=d(k);for(var C=arguments.length,P=new Array(C),K=0;K<C;K++)P[K]=arguments[K];if(i=P,o=this,c=k,x){if(s===void 0)return l(c);if(u)return s=h(_,t),v(c)}return s===void 0&&(s=h(_,t)),n}return O.cancel=N,O.flush=D,O.pending=T,O}function na(e,t,a){let i=!0,o=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Ne(a)&&(i="leading"in a?!!a.leading:i,o="trailing"in a?!!a.trailing:o),Qe(e,t,{leading:i,trailing:o,maxWait:t})}var ra=J((e,t)=>{let{debounceInterval:a,debounceOptions:i,manual:o}=t;const f=E(!1),n=E(),s=A(()=>i),c=A(()=>F(a)),r=E(e.context.runAsync);return o||(f.value=!0),Z(w=>{re(c.value)||(n.value=Qe(u=>u(),c.value,s.value),e.context.runAsync=function(){for(var u=arguments.length,b=new Array(u),p=0;p<u;p++)b[p]=arguments[p];return new Promise((v,h)=>{f.value?(f.value=!1,r.value(...b).then(v).catch(h)):n.value(()=>{r.value(...b).then(v).catch(h)})})},w(()=>{var u;(u=n.value)===null||u===void 0||u.cancel(),e.context.runAsync=r.value}))}),{onCancel(){var w;(w=n.value)===null||w===void 0||w.cancel()}}}),sa=J((e,t)=>{let{errorRetryCount:a=0,errorRetryInterval:i=0}=t;const o=E(),f=E(0),n=A(()=>F(a)),s=A(()=>F(i));let c=!1;const r=()=>{f.value=0},w=A(()=>{if(s.value)return s.value;const p=1e3,v=1,h=9,g=Math.floor(Math.random()*2**Math.min(f.value,h)+v);return p*g}),u=()=>{let p;const v=n.value===-1,h=f.value<n.value;return(v||h)&&(v||(f.value+=1),p=setTimeout(()=>{c=!0,e.context.refresh()},w.value)),()=>p&&clearTimeout(p)},b=()=>{o.value&&o.value()};return{onBefore(){c||r(),c=!1,b()},onSuccess(){r()},onError(){o.value=u()},onCancel(){r(),b()}}}),ua=J((e,t)=>{let{ready:a=E(!0),manual:i,defaultParams:o=[]}=t;return pe(a,f=>{!i&&f&&e.context.run(...o)},{flush:"sync"}),{onBefore(){if(!(De(a)?a():a.value))return e.loading.value=!1,{isBreak:!0}}}}),ia=J((e,t)=>{let{refreshDeps:a,refreshDepsAction:i,manual:o}=t;if(a===void 0||he(a)&&a.length===0)return{};const f=he(a)?a:[a];return pe(f,()=>{i?i():!o&&e.context.refresh()}),{}}),ca=J((e,t)=>{let{throttleInterval:a,throttleOptions:i}=t;const o=E(),f=A(()=>F(a)),n=A(()=>i),s=E(e.context.runAsync);return Z(c=>{if(re(a))return{};o.value=na(r=>r(),f.value,n.value),e.context.runAsync=function(){for(var r=arguments.length,w=new Array(r),u=0;u<r;u++)w[u]=arguments[u];return new Promise((b,p)=>{o.value(()=>{s.value(...w).then(b).catch(p)})})},c(()=>{var r;(r=o.value)===null||r===void 0||r.cancel(),e.context.runAsync=s.value})}),{onCancel(){var c;(c=o.value)===null||c===void 0||c.cancel()}}});const da=(e,t)=>a=>{Object.keys(a).forEach(i=>{e[i].value=a[i]}),t.forEach(i=>i(e))},pa=(e,t)=>()=>{let a=t;for(let i=e.length;i-- >0;)a=e[i](a);return a()},fa=(e,t,a)=>{var i,o;const{initialData:f,onSuccess:n,onError:s,onBefore:c,onAfter:r}=t,w=E((i=a==null?void 0:a.loading)!==null&&i!==void 0?i:!1),u=ue((o=a==null?void 0:a.data)!==null&&o!==void 0?o:f),b=ue(a==null?void 0:a.error),p=E(a==null?void 0:a.params),v=E([]),h=ue("pending"),g={},l=da({status:h,loading:w,data:u,error:b,params:p},[]),m=function(_){for(var y=arguments.length,N=new Array(y>1?y-1:0),D=1;D<y;D++)N[D-1]=arguments[D];if(_==="onQuery"){const T=v.value.map(O=>O.onQuery).filter(Boolean);return{servicePromise:pa(T,N[0])()}}else{const T=v.value.map(O=>{var k;return(k=O[_])===null||k===void 0?void 0:k.call(O,...N)});return Object.assign({},...T)}},d=E(0);return g.runAsync=async function(){for(var _=arguments.length,y=new Array(_),N=0;N<_;N++)y[N]=arguments[N];l({loading:!0,params:y,status:"pending"}),d.value+=1;const D=d.value,{isBreak:T,breakResult:O=be()}=m("onBefore",y);if(T)return l({status:"settled"}),O;c==null||c(y);try{const k=()=>new Promise(P=>P(e(...p.value)));let{servicePromise:x}=m("onQuery",k);x||(x=k());const C=await x;return D!==d.value?be():(l({data:C,loading:!1,error:void 0,status:"settled"}),m("onSuccess",C,y),n==null||n(C,y),D===d.value&&m("onAfter",y,C,void 0),r==null||r(y),C)}catch(k){if(D!==d.value)return be();throw l({loading:!1,error:k,status:"settled"}),m("onError",k,y),s==null||s(k,y),D===d.value&&m("onAfter",y,void 0,k),r==null||r(y),k}},g.run=function(){g.runAsync(...arguments).catch(_=>{s||console.error(_)})},g.cancel=()=>{d.value+=1,l({loading:!1}),m("onCancel")},g.refresh=()=>{g.run(...p.value||[])},g.refreshAsync=()=>g.runAsync(...p.value||[]),g.mutate=_=>{const y=De(_)?_(u.value):_,N=aa(y);l({data:N}),m("onMutate",N)},{status:h,loading:w,data:u,error:b,params:p,plugins:v,context:g}};function ma(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const i=Ce(qt,{}),o={...ea(),...i,...t},{manual:f=!1,defaultParams:n=[]}=o,s=fa(e,o);if(s.plugins.value=a.map(c=>c(s,o)),!f){const c=s.params.value||n;s.context.run(...c)}return fe(()=>{s.context.cancel()}),{loading:s.loading,data:s.data,error:s.error,params:s.params,cancel:s.context.cancel,refresh:s.context.refresh,refreshAsync:s.context.refreshAsync,mutate:s.context.mutate,run:s.context.run,runAsync:s.context.runAsync}}const ce=new Map,va=(e,t)=>{ce.set(e,t),t.then(a=>(ce.delete(e),a)).catch(()=>{ce.delete(e)})},ba=e=>ce.get(e),q=new Map,ga=(e,t)=>{q.has(e)&&q.get(e).forEach(a=>a(t))},_a=(e,t)=>(q.has(e)?q.get(e).push(t):q.set(e,[t]),()=>{const a=q.get(e).indexOf(t);q.get(e).splice(a,1)});var ya=J((e,t)=>{let{cacheKey:a,cacheTime:i=6e5,staleTime:o=0,getCache:f,setCache:n}=t;if(!a)return{};const s=De(a)?a:()=>a,c=E(()=>{});let r;const w=l=>f?f(l):la(l),u=(l,m,d)=>{n?n(l,d):oa(l,m,d),ga(l,d.data)},b=l=>o===-1||l+o>new Date().getTime(),p=(l,m)=>Object.prototype.hasOwnProperty.call(l,m),v=l=>{const m=s(l);return _a(m,d=>{e.data.value=d})},h=s(),g=w(h);return g&&p(g,"data")&&(e.data.value=g.data,e.params.value=g.params),h&&(c.value=v()),fe(()=>{c.value()}),{onBefore(l){const m=s(l),d=w(m);if(!d||!p(d,"data"))return{};if(b(d.time))return e.data.value=d.data,e.loading.value=!1,{isBreak:!0,breakResult:d.data};e.data.value=d.data},onQuery(l){const m=e.params.value,d=s(m);let _=ba(d);return _&&_!==r?()=>_:(_=l(),r=_,va(d,_),()=>_)},onSuccess(l,m){const d=s(m);d&&(c.value(),u(d,i,{data:l,params:m,time:new Date().getTime()}),c.value=v(m))},onMutate(l){const m=s(e.params.value);m&&(c.value(),u(m,i,{data:l,params:e.params.value,time:new Date().getTime()}),c.value=v(e.params.value))}}});function wa(e){let t,a;class i extends Promise{constructor(f){super(f),this.cancel=()=>{a(),clearTimeout(t)}}}return new i(o=>{a=o,t=setTimeout(a,e)})}function ge(){return new Date().getTime()}var ha=J((e,t)=>{let{loadingDelay:a=0,loadingKeep:i=0}=t;const o=E(()=>{}),f=A(()=>F(a)),n=A(()=>F(i));let s=0,c={};const r=()=>{let w;return f.value&&(w=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},f.value)),()=>w&&clearTimeout(w)};return{onBefore(){e.loading.value=!f.value,o.value(),o.value=r(),s=ge()},onQuery(w){if(!n.value)return()=>w();c=wa(n.value+f.value);const u=async()=>{try{const p=await w();return ge()-s<=f.value&&c.cancel(),Promise.resolve(p)}catch(p){return ge()-s<=f.value&&c.cancel(),Promise.reject(p)}},b=Promise.allSettled([u(),c]).then(p=>{const v=p[0];return v.status==="fulfilled"?v.value:Promise.reject(v.reason)});return()=>b},onCancel(){o.value()},onAfter(){o.value()}}}),_e;const He=new Set,Je=new Set,Ze=new Set,de=(e,t)=>{let a;switch(e){case"FOCUS_LISTENER":a=He;break;case"RECONNECT_LISTENER":a=Ze;break;case"VISIBLE_LISTENER":a=Je;break}if(!a.has(t))return a.add(t),()=>{a.delete(t)}},ye=e=>{e.forEach(t=>{t()})};!Ve&&(_e=window)!==null&&_e!==void 0&&_e.addEventListener&&(window.addEventListener("visibilitychange",()=>{Fe()&&ye(Je)},!1),window.addEventListener("focus",()=>ye(He),!1),window.addEventListener("online",()=>ye(Ze),!1));var ka=J((e,t)=>{let{pollingInterval:a,pollingWhenHidden:i=!1,pollingWhenOffline:o=!1,errorRetryCount:f=0}=t;const n=E(),s=E(!1),c=A(()=>F(a)),r=A(()=>F(f)),w=[],u=h=>{h&&w.push(h)},b=()=>(i||Fe())&&(o||ta()),p=h=>{if(e.error.value&&r.value!==0)return;let g;if(!re(c.value)&&c.value>=0)if(b())g=setTimeout(h,c.value);else{s.value=!0;return}return()=>g&&clearTimeout(g)},v=()=>{s.value&&b()&&(e.context.refresh(),s.value=!1)};return pe(c,()=>{n.value&&(n.value(),n.value=p(()=>e.context.refresh()))}),i||u(de("VISIBLE_LISTENER",v)),o||u(de("RECONNECT_LISTENER",v)),fe(()=>{w.forEach(h=>h())}),{onBefore(){var h;(h=n.value)===null||h===void 0||h.call(n)},onCancel(){var h;(h=n.value)===null||h===void 0||h.call(n)},onAfter(){n.value=p(()=>e.context.refresh())}}});const Ca=(e,t)=>{let a=!1;return function(){a||(a=!0,e(...arguments),setTimeout(()=>{a=!1},t))}};var Ta=J((e,t)=>{let{refreshOnWindowFocus:a=!1,refocusTimespan:i=5e3}=t;const o=A(()=>F(a)),f=A(()=>F(i)),n=[],s=r=>{r&&n.push(r)},c=()=>{n.forEach(r=>r())};return Z(()=>{if(c(),o.value){const r=Ca(e.context.refresh,f.value);s(de("VISIBLE_LISTENER",r)),s(de("FOCUS_LISTENER",r))}}),fe(()=>{c()}),{}});function le(e,t){return ma(e,t,[ha,sa,ra,ka,ca,Ta,ia,ua,ya])}function Na(e){const t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},a=c=>e.get(t.list,{params:{type:c,ascs:"sort"}});return{url:t,getList:a,useList:c=>le(()=>a(c.value).then(r=>r.data.records),{refreshDeps:[c]}),create:c=>e.post(t.save,c),update:c=>e.post(t.update,c),remove:c=>e.post(t.remove,{},{params:{ids:c}}),batchUpdate:c=>e.post(t.batchUpdate,c)}}var Xe=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Xe||{}),Da=(e=>(e.保存草稿="flow_draft",e.发送="flow_pass",e.退回="flow_reject",e.终止="flow_terminate",e.撤销="flow_revoke",e.撤回到发起="flow_withdraw",e.打印="flow_print",e.转办="flow_transfer",e.加签="flow_add_instance",e.减签="flow_del_instance",e.指定回退="flow_rollback",e.绿色通道="flow_green",e.传阅="flow_circulate",e))(Da||{}),xe=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(xe||{}),Ie=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(Ie||{}),qe=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(qe||{});function et(e){const t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},a=s=>e.get(t.list,{params:s});return{url:t,getList:a,useList:()=>le(()=>a({size:-1,ascs:"sort"}).then(s=>s.data.records)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function Va(e){const t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:f=>e.get(t.list,{params:f}),create:f=>e.post(t.save,f),remove:f=>e.post(t.remove,{},{params:{ids:f}})}}function ve(e){const t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},a=r=>e.get(t.list,{params:r}),i=()=>e.get(t.all),o=r=>e.get(t.key,{params:{paramKey:r}});return{url:t,getList:a,getAllParam:i,getParam:o,useParam:r=>le(()=>o(r).then(w=>w.data)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}})}}var tt=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(tt||{}),xa=(e=>(e[e.已办结=1]="已办结",e[e.未办结=2]="未办结",e[e.已终止=3]="已终止",e))(xa||{}),Ia=(e=>(e[e.系统执行=1]="系统执行",e[e.用户办理=2]="用户办理",e[e.任务撤销=3]="任务撤销",e[e.任务退回=4]="任务退回",e[e.流程终止=5]="流程终止",e[e.任务转办=6]="任务转办",e[e.绿色通道=7]="绿色通道",e))(Ia||{});function Le(e){const t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"},a=l=>e.get(t.detail,{params:l}),i=l=>e.post(t.approvalNode,l),o=l=>e.post(t.start,l),f=l=>e.post(t.commit,l),n=l=>e.post(t.draft,l),s=l=>e.post(t.revoke,l),c=l=>e.post(t.terminate,l),r=l=>e.post(t.withdraw,l),w=l=>e.post(t.transfer,l),u=l=>e.post(t.reject,l),b=l=>e.post(t.circulate,l),p=l=>e.post(t.green,l),v=()=>e.get(t.publishList);return{url:t,getFlowDetail:a,getApprovalNode:i,startTask:o,commitTask:f,saveDraft:n,revokeTask:s,terminateTask:c,withdrawTask:r,transferTask:w,rejectTask:u,greenChannel:p,circulateTask:b,getPublishList:v,usePublishList:()=>le(()=>v().then(l=>l.data)),getTaskList:l=>e.get(t.taskList,{params:l})}}function La(e){const t={tree:"/sapier-flow/flow-user/tree"},a=o=>e.get(t.tree,{params:{filter:o}});return{url:t,getUserTree:a,useUserTree:()=>le(()=>a().then(o=>o.data))}}var Oe=(e=>(e.ASSIGN_ID="ASSIGN_ID",e.ASSIGN_UUID="ASSIGN_UUID",e.AUTO="AUTO",e.INPUT="INPUT",e.NONE="NONE",e))(Oe||{}),Ee=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ee||{});function Wa(e){const t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy",getFields:"/sapier-flow/dev-table/getTableFields"},a=r=>e.get(t.list,{params:r});return{url:t,getList:a,useList:()=>le(()=>a({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r),getFields:r=>e.get(t.getFields,{params:r})}}var at=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(at||{});const je=G(at),Fa=G(Ee),Qa=G(Oe);function Q(e,t){return e&&t?(e.provide($e,it(Zt,t)),t):Ce($e)}const Ha={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:G(Xe)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:G(xe),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:G(Ie),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:G(qe)},{label:"按钮预览",prop:"buttonPreview",width:150}]},lt={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",editDisabled:!0,rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",dicQuery:{size:-1},props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},Ja={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...lt.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Za={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...lt.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Oa=[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:tt.待办,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),Ea=[{label:"审批人",prop:"assignee"},{label:"节点名称",prop:"taskNodeName"},{label:"接收时间",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"结束时间",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"耗时",prop:"duration"},{label:"传阅意见",prop:"comment"}].map(e=>({...e,hide:!0})),Xa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Oa,...Ea]};const Ke=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:G(Ee)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:je,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:je,value:1}],qa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:G(Oe)},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:Ke}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:Ke}}]};function ot(e){return new Promise((t,a)=>{V(e).validate((o,f,n)=>{o?(f(),t(n)):a(n)})})}export{Ee as A,$e as B,Zt as C,Fa as D,Qa as E,We as F,Mt as G,Ia as H,Pt as I,Jt as J,zt as K,Gt as L,xt as M,Lt as N,Ot as O,Ge as P,Et as Q,tt as T,at as W,Yt as _,It as a,ot as b,le as c,Q as d,et as e,Ja as f,Za as g,Wa as h,lt as i,Xa as j,ve as k,Le as l,qa as m,Na as n,Xe as o,Da as p,xe as q,Ie as r,qe as s,Ha as t,te as u,Va as v,je as w,xa as x,La as y,Oe as z};
