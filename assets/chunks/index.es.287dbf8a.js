import{M as re,r as Q,O as C,a as y,D as Y,K as z,P as $,T as oe}from"./framework.102072c0.js";const ae={},ue=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),ie=()=>ae,I=e=>e,H=e=>Array.isArray(e),J=e=>e!==null&&typeof e=="object",X=e=>e instanceof Function,B=e=>e==null,Z=typeof window>"u",k=()=>{var e;return Z||B((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},se=()=>{var e,t;return(e=!Z&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},j=()=>new Promise(()=>{}),S=e=>oe(e)?e.value:e,le=e=>J(e)?Object.assign(H(e)?[]:{},e):e,M=new Map,ce=e=>B(e)?void 0:M.get(e),fe=(e,t,n)=>{const o=M.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const a=setTimeout(()=>M.delete(e),t);M.set(e,{...n,timer:a})};function q(e,t,n){let o,a,s,l,r,u,i=0,m=!1,f=!1,E=!0;const d=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,J(n)&&(m=!!n.leading,f="maxWait"in n,s=f?Math.max(+n.maxWait||0,t):s,E="trailing"in n?!!n.trailing:E);function R(c){const P=o,A=a;return o=a=void 0,i=c,l=e.apply(A,P),l}function v(c,P){return d?(window.cancelAnimationFrame(r),window.requestAnimationFrame(c)):setTimeout(c,P)}function w(c){if(d)return window.cancelAnimationFrame(c);clearTimeout(c)}function g(c){return i=c,r=v(T,t),m?R(c):l}function p(c){const P=c-u,A=c-i,N=t-P;return f?Math.min(N,s-A):N}function h(c){const P=c-u,A=c-i;return u===void 0||P>=t||P<0||f&&A>=s}function T(){const c=Date.now();if(h(c))return b(c);r=v(T,p(c))}function b(c){return r=void 0,E&&o?R(c):(o=a=void 0,l)}function O(){r!==void 0&&w(r),i=0,o=u=a=r=void 0}function L(){return r===void 0?l:b(Date.now())}function D(){return r!==void 0}function x(){const c=Date.now(),P=h(c);for(var A=arguments.length,N=new Array(A),F=0;F<A;F++)N[F]=arguments[F];if(o=N,a=this,u=c,P){if(r===void 0)return g(u);if(f)return r=v(T,t),R(u)}return r===void 0&&(r=v(T,t)),l}return x.cancel=O,x.flush=L,x.pending=D,x}function de(e,t,n){let o=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return J(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),q(e,t,{leading:o,trailing:a,maxWait:t})}var ve=I((e,t)=>{let{debounceInterval:n,debounceOptions:o,manual:a}=t;const s=C(!1),l=C(),r=y(()=>o),u=y(()=>S(n)),i=C(e.context.runAsync);return a||(s.value=!0),Y(m=>{B(u.value)||(l.value=q(f=>f(),u.value,r.value),e.context.runAsync=function(){for(var f=arguments.length,E=new Array(f),d=0;d<f;d++)E[d]=arguments[d];return new Promise((R,v)=>{s.value?(s.value=!1,i.value(...E).then(R).catch(v)):l.value(()=>{i.value(...E).then(R).catch(v)})})},m(()=>{var f;(f=l.value)===null||f===void 0||f.cancel(),e.context.runAsync=i.value}))}),{onCancel(){var m;(m=l.value)===null||m===void 0||m.cancel()}}}),me=I((e,t)=>{let{errorRetryCount:n=0,errorRetryInterval:o=0}=t;const a=C(),s=C(0),l=y(()=>S(n)),r=y(()=>S(o));let u=!1;const i=()=>{s.value=0},m=y(()=>{if(r.value)return r.value;const d=1e3,R=1,v=9,w=Math.floor(Math.random()*2**Math.min(s.value,v)+R);return d*w}),f=()=>{let d;const R=l.value===-1,v=s.value<l.value;return(R||v)&&(R||(s.value+=1),d=setTimeout(()=>{u=!0,e.context.refresh()},m.value)),()=>d&&clearTimeout(d)},E=()=>{a.value&&a.value()};return{onBefore(){u||i(),u=!1,E()},onSuccess(){i()},onError(){a.value=f()},onCancel(){i(),E()}}}),ge=I((e,t)=>{let{ready:n=C(!0),manual:o,defaultParams:a=[]}=t;return z(n,s=>{!o&&s&&e.context.run(...a)},{flush:"sync"}),{onBefore(){if(!(X(n)?n():n.value))return e.loading.value=!1,{isBreak:!0}}}}),he=I((e,t)=>{let{refreshDeps:n,refreshDepsAction:o,manual:a}=t;if(n===void 0||H(n)&&n.length===0)return{};const s=H(n)?n:[n];return z(s,()=>{o?o():!a&&e.context.refresh()}),{}}),pe=I((e,t)=>{let{throttleInterval:n,throttleOptions:o}=t;const a=C(),s=y(()=>S(n)),l=y(()=>o),r=C(e.context.runAsync);return Y(u=>{if(B(n))return{};a.value=de(i=>i(),s.value,l.value),e.context.runAsync=function(){for(var i=arguments.length,m=new Array(i),f=0;f<i;f++)m[f]=arguments[f];return new Promise((E,d)=>{a.value(()=>{r.value(...m).then(E).catch(d)})})},u(()=>{var i;(i=a.value)===null||i===void 0||i.cancel(),e.context.runAsync=r.value})}),{onCancel(){var u;(u=a.value)===null||u===void 0||u.cancel()}}});const Re=(e,t)=>n=>{Object.keys(n).forEach(o=>{e[o].value=n[o]}),t.forEach(o=>o(e))},Te=(e,t)=>()=>{let n=t;for(let o=e.length;o-- >0;)n=e[o](n);return n()},we=(e,t,n)=>{var o,a;const{initialData:s,onSuccess:l,onError:r,onBefore:u,onAfter:i}=t,m=C((o=n==null?void 0:n.loading)!==null&&o!==void 0?o:!1),f=$((a=n==null?void 0:n.data)!==null&&a!==void 0?a:s),E=$(n==null?void 0:n.error),d=C(n==null?void 0:n.params),R=C([]),v=$("pending"),w={},g=Re({status:v,loading:m,data:f,error:E,params:d},[]),p=function(T){for(var b=arguments.length,O=new Array(b>1?b-1:0),L=1;L<b;L++)O[L-1]=arguments[L];if(T==="onQuery"){const D=R.value.map(x=>x.onQuery).filter(Boolean);return{servicePromise:Te(D,O[0])()}}else{const D=R.value.map(x=>{var c;return(c=x[T])===null||c===void 0?void 0:c.call(x,...O)});return Object.assign({},...D)}},h=C(0);return w.runAsync=async function(){for(var T=arguments.length,b=new Array(T),O=0;O<T;O++)b[O]=arguments[O];g({loading:!0,params:b,status:"pending"}),h.value+=1;const L=h.value,{isBreak:D,breakResult:x=j()}=p("onBefore",b);if(D)return g({status:"settled"}),x;u==null||u(b);try{const c=()=>new Promise(N=>N(e(...d.value)));let{servicePromise:P}=p("onQuery",c);P||(P=c());const A=await P;return L!==h.value?j():(g({data:A,loading:!1,error:void 0,status:"settled"}),p("onSuccess",A,b),l==null||l(A,b),L===h.value&&p("onAfter",b,A,void 0),i==null||i(b),A)}catch(c){if(L!==h.value)return j();throw g({loading:!1,error:c,status:"settled"}),p("onError",c,b),r==null||r(c,b),L===h.value&&p("onAfter",b,void 0,c),i==null||i(b),c}},w.run=function(){w.runAsync(...arguments).catch(T=>{r||console.error(T)})},w.cancel=()=>{h.value+=1,g({loading:!1}),p("onCancel")},w.refresh=()=>{w.run(...d.value||[])},w.refreshAsync=()=>w.runAsync(...d.value||[]),w.mutate=T=>{const b=X(T)?T(f.value):T,O=le(b);g({data:O}),p("onMutate",O)},{status:v,loading:m,data:f,error:E,params:d,plugins:R,context:w}};function Ee(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const o=re(ue,{}),a={...ie(),...o,...t},{manual:s=!1,defaultParams:l=[]}=a,r=we(e,a);if(r.plugins.value=n.map(u=>u(r,a)),!s){const u=r.params.value||l;r.context.run(...u)}return Q(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const W=new Map,be=(e,t)=>{W.set(e,t),t.then(n=>(W.delete(e),n)).catch(()=>{W.delete(e)})},Ce=e=>W.get(e),_=new Map,Pe=(e,t)=>{_.has(e)&&_.get(e).forEach(n=>n(t))},Ae=(e,t)=>(_.has(e)?_.get(e).push(t):_.set(e,[t]),()=>{const n=_.get(e).indexOf(t);_.get(e).splice(n,1)});var Oe=I((e,t)=>{let{cacheKey:n,cacheTime:o=6e5,staleTime:a=0,getCache:s,setCache:l}=t;if(!n)return{};const r=X(n)?n:()=>n,u=C(()=>{});let i;const m=g=>s?s(g):ce(g),f=(g,p,h)=>{l?l(g,h):fe(g,p,h),Pe(g,h.data)},E=g=>a===-1||g+a>new Date().getTime(),d=(g,p)=>Object.prototype.hasOwnProperty.call(g,p),R=g=>{const p=r(g);return Ae(p,h=>{e.data.value=h})},v=r(),w=m(v);return w&&d(w,"data")&&(e.data.value=w.data,e.params.value=w.params),v&&(u.value=R()),Q(()=>{u.value()}),{onBefore(g){const p=r(g),h=m(p);if(!h||!d(h,"data"))return{};if(E(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(g){const p=e.params.value,h=r(p);let T=Ce(h);return T&&T!==i?()=>T:(T=g(),i=T,be(h,T),()=>T)},onSuccess(g,p){const h=r(p);h&&(u.value(),f(h,o,{data:g,params:p,time:new Date().getTime()}),u.value=R(p))},onMutate(g){const p=r(e.params.value);p&&(u.value(),f(p,o,{data:g,params:e.params.value,time:new Date().getTime()}),u.value=R(e.params.value))}}});function ye(e){let t,n;class o extends Promise{constructor(s){super(s),this.cancel=()=>{n(),clearTimeout(t)}}}return new o(a=>{n=a,t=setTimeout(n,e)})}function V(){return new Date().getTime()}var Le=I((e,t)=>{let{loadingDelay:n=0,loadingKeep:o=0}=t;const a=C(()=>{}),s=y(()=>S(n)),l=y(()=>S(o));let r=0,u={};const i=()=>{let m;return s.value&&(m=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},s.value)),()=>m&&clearTimeout(m)};return{onBefore(){e.loading.value=!s.value,a.value(),a.value=i(),r=V()},onQuery(m){if(!l.value)return()=>m();u=ye(l.value+s.value);const f=async()=>{try{const d=await m();return V()-r<=s.value&&u.cancel(),Promise.resolve(d)}catch(d){return V()-r<=s.value&&u.cancel(),Promise.reject(d)}},E=Promise.allSettled([f(),u]).then(d=>{const R=d[0];return R.status==="fulfilled"?R.value:Promise.reject(R.reason)});return()=>E},onCancel(){a.value()},onAfter(){a.value()}}}),G;const ee=new Set,ne=new Set,te=new Set,K=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=ee;break;case"RECONNECT_LISTENER":n=te;break;case"VISIBLE_LISTENER":n=ne;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},U=e=>{e.forEach(t=>{t()})};!Z&&(G=window)!==null&&G!==void 0&&G.addEventListener&&(window.addEventListener("visibilitychange",()=>{k()&&U(ne)},!1),window.addEventListener("focus",()=>U(ee),!1),window.addEventListener("online",()=>U(te),!1));var xe=I((e,t)=>{let{pollingInterval:n,pollingWhenHidden:o=!1,pollingWhenOffline:a=!1,errorRetryCount:s=0}=t;const l=C(),r=C(!1),u=y(()=>S(n)),i=y(()=>S(s)),m=[],f=v=>{v&&m.push(v)},E=()=>(o||k())&&(a||se()),d=v=>{if(e.error.value&&i.value!==0)return;let w;if(!B(u.value)&&u.value>=0)if(E())w=setTimeout(v,u.value);else{r.value=!0;return}return()=>w&&clearTimeout(w)},R=()=>{r.value&&E()&&(e.context.refresh(),r.value=!1)};return z(u,()=>{l.value&&(l.value(),l.value=d(()=>e.context.refresh()))}),o||f(K("VISIBLE_LISTENER",R)),a||f(K("RECONNECT_LISTENER",R)),Q(()=>{m.forEach(v=>v())}),{onBefore(){var v;(v=l.value)===null||v===void 0||v.call(l)},onCancel(){var v;(v=l.value)===null||v===void 0||v.call(l)},onAfter(){l.value=d(()=>e.context.refresh())}}});const Se=(e,t)=>{let n=!1;return function(){n||(n=!0,e(...arguments),setTimeout(()=>{n=!1},t))}};var Ie=I((e,t)=>{let{refreshOnWindowFocus:n=!1,refocusTimespan:o=5e3}=t;const a=y(()=>S(n)),s=y(()=>S(o)),l=[],r=i=>{i&&l.push(i)},u=()=>{l.forEach(i=>i())};return Y(()=>{if(u(),a.value){const i=Se(e.context.refresh,s.value);r(K("VISIBLE_LISTENER",i)),r(K("FOCUS_LISTENER",i))}}),Q(()=>{u()}),{}});function Ne(e,t,n){return Ee(e,t,[...n||[],Le,me,ve,xe,pe,Ie,he,ge,Oe])}export{Ne as u};
