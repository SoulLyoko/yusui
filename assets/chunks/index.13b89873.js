import{u as Pe,aJ as Wt,aK as Xe,aQ as Ht,aR as Qt,aH as et,_ as xe,aS as qt,aD as Jt,ax as tt,aT as Gt,aU as Ge,aV as Yt,aW as ot,aX as Zt,aY as Xt,aZ as _e,x as lt,a_ as nt,a$ as at,b0 as eo,y as rt,J as to,aq as oo,b1 as X,b2 as re,b3 as le,b4 as he,b5 as lo,b6 as no,b7 as ao,aO as ro,b8 as so,aP as io,z as uo}from"../composables_use-crud_index.md.fba15c80.js";import{r as co}from"./axios.76d92975.js";import{al as fo,f as K,R as we,c as R,h as $,i as B,z as Q,j as Y,l as J,u as c,t as j,G as h,B as v,A as N,I as po,C as M,W as Fe,r as O,w as oe,n as te,e as mo,d as Ae,a0 as vo,S as st,a1 as me,E as it,ay as yo,ag as ut,T as ct,aw as dt,D as V,$ as Le,y as ke,s as Te,b as ne,ac as q,k as A,ao as ie,ap as ue,F as Z,L as se,_ as Ue,aI as Be,ai as Ne,am as bo,a_ as _o,aL as wo}from"./framework.58691f2b.js";import{e as go,c as Ye,a as ho,d as Ce,q as ko,x as Co}from"./theme.79d710c4.js";import{A as Vo,_ as $o,a5 as ft,a4 as Do,a7 as pt,a8 as To,a9 as Oo}from"./index.vue_vue_type_script_setup_true_lang.f706c474.js";import{a as Io,_ as So}from"./index.vue_vue_type_script_setup_true_lang.beec5675.js";import{d as Eo}from"./data.4cb21f02.js";import{a as Lo}from"../flow-design_flow-modeler_index.md.09bbbfe3.js";import{fM as No}from"../app.ff731f0e.js";import"./vue.runtime.esm-bundler.9b9f3da3.js";import"../components_basic-container_index.md.9b371e9c.js";import"../components_icon-select_index.md.2adaa6f9.js";import"../components_index.md.eb74fc9b.js";import"../components_v-text_index.md.fffa2334.js";import"../composables_index.md.4f63e5ec.js";import"../flow-design_flow-viewer_index.md.0f2bbce1.js";import"../flow-design_index.md.36aaaa61.js";import"../flow-pages_index.md.96a87367.js";import"../flow-pages_pages_flow-button_index.md.1f7d435d.js";import"../flow-pages_pages_flow-manage_index.md.6605ff50.js";import"../flow-pages_pages_flow-ops_index.md.48c2710e.js";import"../flow-pages_pages_flow-param_index.md.a838fc38.js";import"../flow-pages_pages_flow-template_index.md.3343aa48.js";import"../flow-pages_pages_flow-workbench_index.md.aed1688c.js";import"../flow-pages_pages_form-template_index.md.4c26b2a2.js";import"../flow-pages_pages_table-template_index.md.2f954a1a.js";import"../form-design_demo.md.7ed33b13.js";import"../form-design_index.md.646ff874.js";import"../guide_changelog.md.c4dd5b98.js";import"../guide_start.md.ac582e3a.js";import"../index.md.01cb05dd.js";import"../plugins_avue-patch_index.md.ff5dae71.js";import"../plugins_env-dts_index.md.d9ffa256.js";import"../plugins_index.md.85630059.js";import"../plugins_load-proxy_index.md.ee64d94d.js";import"../plugins_uni-ui-patch_index.md.369156f2.js";import"../plugins_uview-patch_index.md.0f6ccb1d.js";import"../types_avue_index.md.6dd55393.js";import"../utils_date_dateFormat.md.46292425.js";import"../utils_date_durationFormat.md.a9466ca5.js";import"../utils_emitter_mittAsync.md.fa0c1888.js";import"../utils_index.md.6539ff35.js";import"../utils_math_index.md.74592475.js";import"../utils_object_filterObj.md.7e4e2a5d.js";import"../utils_object_filterObjDeep.md.30ba6b3d.js";import"../utils_object_getDataType.md.e91e1325.js";import"../utils_string_deserialize.md.53d74973.js";import"../utils_string_serialize.md.46d95769.js";import"../utils_string_uuid.md.0357bc06.js";import"../utils_tool_awaitTo.md.02770430.js";import"../utils_tool_enumToDic.md.9f356deb.js";import"../utils_tool_sleep.md.1f530da0.js";import"../utils_tree_buildTree.md.90191de7.js";import"../utils_tree_filterTree.md.75f848cc.js";import"../utils_tree_findTree.md.19218304.js";import"../utils_tree_flatTree.md.aad7510e.js";import"../utils_tree_treeMap.md.d5162fe5.js";const Ro=(...e)=>o=>{e.forEach(t=>{fo(t)?t(o):t.value=o})},mt=Symbol("dialogInjectionKey"),vt=Pe({center:{type:Boolean,default:!1},alignCenter:{type:Boolean,default:!1},closeIcon:{type:Wt},customClass:{type:String,default:""},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},showClose:{type:Boolean,default:!0},title:{type:String,default:""}}),Po={close:()=>!0},xo=["aria-label"],Fo=["id"],Ao=K({name:"ElDialogContent"}),Uo=K({...Ao,props:vt,emits:Po,setup(e){const o=e,{t}=Xe(),{Close:l}=qt,{dialogRef:n,headerRef:a,bodyId:s,ns:r,style:i}=we(mt),{focusTrapRef:u}=we(Ht),d=Ro(u,n),_=R(()=>o.draggable);return Qt(n,a,_),(f,p)=>($(),B("div",{ref:c(d),class:J([c(r).b(),c(r).is("fullscreen",f.fullscreen),c(r).is("draggable",c(_)),c(r).is("align-center",f.alignCenter),{[c(r).m("center")]:f.center},f.customClass]),style:Fe(c(i)),tabindex:"-1"},[Q("header",{ref_key:"headerRef",ref:a,class:J(c(r).e("header"))},[Y(f.$slots,"header",{},()=>[Q("span",{role:"heading",class:J(c(r).e("title"))},j(f.title),3)]),f.showClose?($(),B("button",{key:0,"aria-label":c(t)("el.dialog.close"),class:J(c(r).e("headerbtn")),type:"button",onClick:p[0]||(p[0]=m=>f.$emit("close"))},[h(c(et),{class:J(c(r).e("close"))},{default:v(()=>[($(),N(po(f.closeIcon||c(l))))]),_:1},8,["class"])],10,xo)):M("v-if",!0)],2),Q("div",{id:c(s),class:J(c(r).e("body"))},[Y(f.$slots,"default")],10,Fo),f.$slots.footer?($(),B("footer",{key:0,class:J(c(r).e("footer"))},[Y(f.$slots,"footer")],2)):M("v-if",!0)],6))}});var Bo=xe(Uo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog-content.vue"]]);const yt=Pe({...vt,appendToBody:{type:Boolean,default:!1},beforeClose:{type:Jt(Function)},destroyOnClose:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:{type:Boolean,default:!1},modalClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:{type:Boolean,default:!1}}),bt={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[tt]:e=>go(e),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},_t=(e,o)=>{const l=Ae().emit,{nextZIndex:n}=Gt();let a="";const s=Ge(),r=Ge(),i=O(!1),u=O(!1),d=O(!1),_=O(e.zIndex||n());let f,p;const m=Yt("namespace",Xt),w=R(()=>{const U={},H=`--${m.value}-dialog`;return e.fullscreen||(e.top&&(U[`${H}-margin-top`]=e.top),e.width&&(U[`${H}-width`]=ot(e.width))),U}),k=R(()=>e.alignCenter?{display:"flex"}:{});function S(){l("opened")}function y(){l("closed"),l(tt,!1),e.destroyOnClose&&(d.value=!1)}function C(){l("close")}function b(){p==null||p(),f==null||f(),e.openDelay&&e.openDelay>0?{stop:f}=Ye(()=>I(),e.openDelay):I()}function g(){f==null||f(),p==null||p(),e.closeDelay&&e.closeDelay>0?{stop:p}=Ye(()=>P(),e.closeDelay):P()}function T(){function U(H){H||(u.value=!0,i.value=!1)}e.beforeClose?e.beforeClose(U):g()}function E(){e.closeOnClickModal&&T()}function I(){ho&&(i.value=!0)}function P(){i.value=!1}function D(){l("openAutoFocus")}function x(){l("closeAutoFocus")}function F(U){var H;((H=U.detail)==null?void 0:H.focusReason)==="pointer"&&U.preventDefault()}e.lockScroll&&Zt(i);function W(){e.closeOnPressEscape&&T()}return oe(()=>e.modelValue,U=>{U?(u.value=!1,b(),d.value=!0,_.value=e.zIndex?_.value++:n(),te(()=>{l("open"),o.value&&(o.value.scrollTop=0)})):i.value&&g()}),oe(()=>e.fullscreen,U=>{o.value&&(U?(a=o.value.style.transform,o.value.style.transform=""):o.value.style.transform=a)}),mo(()=>{e.modelValue&&(i.value=!0,d.value=!0,b())}),{afterEnter:S,afterLeave:y,beforeLeave:C,handleClose:T,onModalClick:E,close:g,doClose:P,onOpenAutoFocus:D,onCloseAutoFocus:x,onCloseRequested:W,onFocusoutPrevented:F,titleId:s,bodyId:r,closed:u,style:w,overlayDialogStyle:k,rendered:d,visible:i,zIndex:_}},Mo=["aria-label","aria-labelledby","aria-describedby"],Ko=K({name:"ElDialog",inheritAttrs:!1}),zo=K({...Ko,props:yt,emits:bt,setup(e,{expose:o}){const t=e,l=vo();_e({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},R(()=>!!l.title)),_e({scope:"el-dialog",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/dialog.html#attributes",type:"Attribute"},R(()=>!!t.customClass));const n=lt("dialog"),a=O(),s=O(),r=O(),{visible:i,titleId:u,bodyId:d,style:_,overlayDialogStyle:f,rendered:p,zIndex:m,afterEnter:w,afterLeave:k,beforeLeave:S,handleClose:y,onModalClick:C,onOpenAutoFocus:b,onCloseAutoFocus:g,onCloseRequested:T,onFocusoutPrevented:E}=_t(t,a);st(mt,{dialogRef:a,headerRef:s,bodyId:d,ns:n,rendered:p,style:_});const I=eo(C),P=R(()=>t.draggable&&!t.fullscreen);return o({visible:i,dialogContentRef:r}),(D,x)=>($(),N(dt,{to:"body",disabled:!D.appendToBody},[h(ct,{name:"dialog-fade",onAfterEnter:c(w),onAfterLeave:c(k),onBeforeLeave:c(S),persisted:""},{default:v(()=>[me(h(c(nt),{"custom-mask-event":"",mask:D.modal,"overlay-class":D.modalClass,"z-index":c(m)},{default:v(()=>[Q("div",{role:"dialog","aria-modal":"true","aria-label":D.title||void 0,"aria-labelledby":D.title?void 0:c(u),"aria-describedby":c(d),class:J(`${c(n).namespace.value}-overlay-dialog`),style:Fe(c(f)),onClick:x[0]||(x[0]=(...F)=>c(I).onClick&&c(I).onClick(...F)),onMousedown:x[1]||(x[1]=(...F)=>c(I).onMousedown&&c(I).onMousedown(...F)),onMouseup:x[2]||(x[2]=(...F)=>c(I).onMouseup&&c(I).onMouseup(...F))},[h(c(at),{loop:"",trapped:c(i),"focus-start-el":"container",onFocusAfterTrapped:c(b),onFocusAfterReleased:c(g),onFocusoutPrevented:c(E),onReleaseRequested:c(T)},{default:v(()=>[c(p)?($(),N(Bo,it({key:0,ref_key:"dialogContentRef",ref:r},D.$attrs,{"custom-class":D.customClass,center:D.center,"align-center":D.alignCenter,"close-icon":D.closeIcon,draggable:c(P),fullscreen:D.fullscreen,"show-close":D.showClose,title:D.title,onClose:c(y)}),yo({header:v(()=>[D.$slots.title?Y(D.$slots,"title",{key:1}):Y(D.$slots,"header",{key:0,close:c(y),titleId:c(u),titleClass:c(n).e("title")})]),default:v(()=>[Y(D.$slots,"default")]),_:2},[D.$slots.footer?{name:"footer",fn:v(()=>[Y(D.$slots,"footer")])}:void 0]),1040,["custom-class","center","align-center","close-icon","draggable","fullscreen","show-close","title","onClose"])):M("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,Mo)]),_:3},8,["mask","overlay-class","z-index"]),[[ut,c(i)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"]))}});var jo=xe(zo,[["__file","/home/runner/work/element-plus/element-plus/packages/components/dialog/src/dialog.vue"]]);const Wo=rt(jo),Ho=Pe({...yt,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0}}),Qo=bt,qo=K({name:"ElDrawer",components:{ElOverlay:nt,ElFocusTrap:at,ElIcon:et,Close:to},inheritAttrs:!1,props:Ho,emits:Qo,setup(e,{slots:o}){_e({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},R(()=>!!o.title)),_e({scope:"el-drawer",from:"custom-class",replacement:"class",version:"2.3.0",ref:"https://element-plus.org/en-US/component/drawer.html#attributes",type:"Attribute"},R(()=>!!e.customClass));const t=O(),l=O(),n=lt("drawer"),{t:a}=Xe(),s=R(()=>e.direction==="rtl"||e.direction==="ltr"),r=R(()=>ot(e.size));return{..._t(e,t),drawerRef:t,focusStartRef:l,isHorizontal:s,drawerSize:r,ns:n,t:a}}}),Jo=["aria-label","aria-labelledby","aria-describedby"],Go=["id"],Yo=["aria-label"],Zo=["id"];function Xo(e,o,t,l,n,a){const s=V("close"),r=V("el-icon"),i=V("el-focus-trap"),u=V("el-overlay");return $(),N(dt,{to:"body",disabled:!e.appendToBody},[h(ct,{name:e.ns.b("fade"),onAfterEnter:e.afterEnter,onAfterLeave:e.afterLeave,onBeforeLeave:e.beforeLeave,persisted:""},{default:v(()=>[me(h(u,{mask:e.modal,"overlay-class":e.modalClass,"z-index":e.zIndex,onClick:e.onModalClick},{default:v(()=>[h(i,{loop:"",trapped:e.visible,"focus-trap-el":e.drawerRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:v(()=>[Q("div",it({ref:"drawerRef","aria-modal":"true","aria-label":e.title||void 0,"aria-labelledby":e.title?void 0:e.titleId,"aria-describedby":e.bodyId},e.$attrs,{class:[e.ns.b(),e.direction,e.visible&&"open",e.customClass],style:e.isHorizontal?"width: "+e.drawerSize:"height: "+e.drawerSize,role:"dialog",onClick:o[1]||(o[1]=Le(()=>{},["stop"]))}),[Q("span",{ref:"focusStartRef",class:J(e.ns.e("sr-focus")),tabindex:"-1"},null,2),e.withHeader?($(),B("header",{key:0,class:J(e.ns.e("header"))},[e.$slots.title?Y(e.$slots,"title",{key:1},()=>[M(" DEPRECATED SLOT ")]):Y(e.$slots,"header",{key:0,close:e.handleClose,titleId:e.titleId,titleClass:e.ns.e("title")},()=>[e.$slots.title?M("v-if",!0):($(),B("span",{key:0,id:e.titleId,role:"heading",class:J(e.ns.e("title"))},j(e.title),11,Go))]),e.showClose?($(),B("button",{key:2,"aria-label":e.t("el.drawer.close"),class:J(e.ns.e("close-btn")),type:"button",onClick:o[0]||(o[0]=(...d)=>e.handleClose&&e.handleClose(...d))},[h(r,{class:J(e.ns.e("close"))},{default:v(()=>[h(s)]),_:1},8,["class"])],10,Yo)):M("v-if",!0)],2)):M("v-if",!0),e.rendered?($(),B("div",{key:1,id:e.bodyId,class:J(e.ns.e("body"))},[Y(e.$slots,"default")],10,Zo)):M("v-if",!0),e.$slots.footer?($(),B("div",{key:2,class:J(e.ns.e("footer"))},[Y(e.$slots,"footer")],2)):M("v-if",!0)],16,Jo)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[ut,e.visible]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])],8,["disabled"])}var el=xe(qo,[["render",Xo],["__file","/home/runner/work/element-plus/element-plus/packages/components/drawer/src/drawer.vue"]]);const tl=rt(el);var ol=co();const ll=oo(ol),nl={},al=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),rl=()=>nl,sl=e=>Array.isArray(e),Me=e=>e!==null&&typeof e=="object",wt=e=>e instanceof Function,ve=e=>e==null,Ke=typeof window>"u",gt=()=>{var e;return Ke||ve((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},il=()=>{var e,o;return(e=!Ke&&((o=window.navigator)===null||o===void 0?void 0:o.onLine))!==null&&e!==void 0?e:!0},Oe=()=>new Promise(()=>{}),ee=e=>q(e)?e.value:e,ul=e=>Me(e)?Object.assign(sl(e)?[]:{},e):e,ye=new Map,cl=e=>ve(e)?void 0:ye.get(e),dl=(e,o,t)=>{const l=ye.get(e);l!=null&&l.timer&&clearTimeout(l.timer);const n=setTimeout(()=>ye.delete(e),o);ye.set(e,{...t,timer:n})},ae=e=>e;function ht(e,o,t){let l,n,a,s,r,i,u=0,d=!1,_=!1,f=!0;const p=!o&&o!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");o=+o||0,Me(t)&&(d=!!t.leading,_="maxWait"in t,a=_?Math.max(+t.maxWait||0,o):a,f="trailing"in t?!!t.trailing:f);function m(D){const x=l,F=n;return l=n=void 0,u=D,s=e.apply(F,x),s}function w(D,x){return p?(window.cancelAnimationFrame(r),window.requestAnimationFrame(D)):setTimeout(D,x)}function k(D){if(p)return window.cancelAnimationFrame(D);clearTimeout(D)}function S(D){return u=D,r=w(b,o),d?m(D):s}function y(D){const x=D-i,F=D-u,W=o-x;return _?Math.min(W,a-F):W}function C(D){const x=D-i,F=D-u;return i===void 0||x>=o||x<0||_&&F>=a}function b(){const D=Date.now();if(C(D))return g(D);r=w(b,y(D))}function g(D){return r=void 0,f&&l?m(D):(l=n=void 0,s)}function T(){r!==void 0&&k(r),u=0,l=i=n=r=void 0}function E(){return r===void 0?s:g(Date.now())}function I(){return r!==void 0}function P(...D){const x=Date.now(),F=C(x);if(l=D,n=this,i=x,F){if(r===void 0)return S(i);if(_)return r=w(b,o),m(i)}return r===void 0&&(r=w(b,o)),s}return P.cancel=T,P.flush=E,P.pending=I,P}function fl(e,o,t){let l=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Me(t)&&(l="leading"in t?!!t.leading:l,n="trailing"in t?!!t.trailing:n),ht(e,o,{leading:l,trailing:n,maxWait:o})}var pl=ae((e,{debounceInterval:o,debounceOptions:t,manual:l})=>{const n=O(!1),a=O(),s=R(()=>t),r=R(()=>ee(o)),i=O(e.context.runAsync);return l||(n.value=!0),ne(u=>{ve(r.value)||(a.value=ht(d=>d(),r.value,s.value),e.context.runAsync=(...d)=>new Promise((_,f)=>{n.value?(n.value=!1,i.value(...d).then(_).catch(f)):a.value(()=>{i.value(...d).then(_).catch(f)})}),u(()=>{var d;(d=a.value)===null||d===void 0||d.cancel(),e.context.runAsync=i.value}))}),{onCancel(){var u;(u=a.value)===null||u===void 0||u.cancel()}}}),ml=ae((e,{errorRetryCount:o=0,errorRetryInterval:t=0})=>{const l=O(),n=O(0),a=R(()=>ee(o)),s=R(()=>ee(t));let r=!1;const i=()=>{n.value=0},u=R(()=>{if(s.value)return s.value;const f=1e3,p=1,m=9,w=Math.floor(Math.random()*2**Math.min(n.value,m)+p);return f*w}),d=()=>{let f;const p=a.value===-1,m=n.value<a.value;return(p||m)&&(p||(n.value+=1),f=setTimeout(()=>{r=!0,e.context.refresh()},u.value)),()=>f&&clearTimeout(f)},_=()=>{l.value&&l.value()};return{onBefore(){r||i(),r=!1,_()},onSuccess(){i()},onError(){l.value=d()},onCancel(){i(),_()}}}),vl=ae((e,{ready:o=O(!0),manual:t,defaultParams:l=[]})=>(oe(o,n=>{!t&&n&&e.context.run(...l)},{flush:"sync"}),{onBefore(){if(!o.value)return e.loading.value=!1,{isBreak:!0}}})),yl=ae((e,{refreshDeps:o=[],refreshDepsAction:t,manual:l})=>(o!=null&&o.length&&oe(o,()=>{t?t():!l&&e.context.refresh()}),{})),bl=ae((e,{throttleInterval:o,throttleOptions:t})=>{const l=O(),n=R(()=>ee(o)),a=R(()=>t),s=O(e.context.runAsync);return ne(r=>{if(ve(o))return{};l.value=fl(i=>i(),n.value,a.value),e.context.runAsync=(...i)=>new Promise((u,d)=>{l.value(()=>{s.value(...i).then(u).catch(d)})}),r(()=>{var i;(i=l.value)===null||i===void 0||i.cancel(),e.context.runAsync=s.value})}),{onCancel(){var r;(r=l.value)===null||r===void 0||r.cancel()}}});const _l=(e,o)=>t=>{Object.keys(t).forEach(l=>{e[l].value=t[l]}),o.forEach(l=>l(e))},wl=(e,o)=>()=>{let t=o;for(let l=e.length;l-- >0;)t=e[l](t);return t()},gl=(e,o,t)=>{var l,n;const{initialData:a,onSuccess:s,onError:r,onBefore:i,onAfter:u}=o,d=O((l=t==null?void 0:t.loading)!==null&&l!==void 0?l:!1),_=Te((n=t==null?void 0:t.data)!==null&&n!==void 0?n:a),f=Te(t==null?void 0:t.error),p=O(t==null?void 0:t.params),m=O([]),w=Te("pending"),k={},S=_l({status:w,loading:d,data:_,error:f,params:p},[]),y=(b,...g)=>{if(b==="onQuery"){const T=m.value.map(E=>E.onQuery).filter(Boolean);return{servicePromise:wl(T,g[0])()}}else{const T=m.value.map(E=>{var I;return(I=E[b])===null||I===void 0?void 0:I.call(E,...g)});return Object.assign({},...T)}},C=O(0);return k.runAsync=async(...b)=>{S({loading:!0,params:b,status:"pending"}),C.value+=1;const g=C.value,{isBreak:T,breakResult:E=Oe()}=y("onBefore",b);if(T)return S({status:"settled"}),E;i==null||i(b);try{const I=()=>new Promise(x=>x(e(...p.value)));let{servicePromise:P}=y("onQuery",I);P||(P=I());const D=await P;return g!==C.value?Oe():(S({data:D,loading:!1,error:void 0,status:"settled"}),y("onSuccess",D,b),s==null||s(D,b),y("onAfter",b,D,void 0),u==null||u(b),D)}catch(I){if(g!==C.value)return Oe();throw S({loading:!1,error:I,status:"settled"}),y("onError",I,b),r==null||r(I,b),y("onAfter",b,void 0,I),u==null||u(b),I}},k.run=(...b)=>{k.runAsync(...b).catch(g=>{r||console.error(g)})},k.cancel=()=>{C.value+=1,S({loading:!1}),y("onCancel")},k.refresh=()=>{k.run(...p.value||[])},k.refreshAsync=()=>k.runAsync(...p.value||[]),k.mutate=b=>{const g=wt(b)?b(_.value):b,T=ul(g);S({data:T}),y("onMutate",T)},{status:w,loading:d,data:_,error:f,params:p,plugins:m,context:k}};function hl(e,o={},t){const l=we(al,{}),n={...rl(),...l,...o},{manual:a=!1,defaultParams:s=[]}=n,r=gl(e,n);if(r.plugins.value=t.map(i=>i(r,n)),!a){const i=r.params.value||s;r.context.run(...i)}return ke(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const be=new Map,kl=(e,o)=>{be.set(e,o),o.then(t=>(be.delete(e),t)).catch(()=>{be.delete(e)})},Cl=e=>be.get(e),de=new Map,Vl=(e,o)=>{de.has(e)&&de.get(e).forEach(t=>t(o))},$l=(e,o)=>(de.has(e)?de.get(e).push(o):de.set(e,[o]),()=>{const t=de.get(e).indexOf(o);de.get(e).splice(t,1)});var Dl=ae((e,{cacheKey:o,cacheTime:t=6e5,staleTime:l=0,getCache:n,setCache:a})=>{if(!o)return{};const s=wt(o)?o:()=>o,r=O(()=>{});let i;const u=k=>n?n(k):cl(k),d=(k,S,y)=>{a?a(k,y):dl(k,S,y),Vl(k,y.data)},_=k=>l===-1||k+l>new Date().getTime(),f=(k,S)=>Object.prototype.hasOwnProperty.call(k,S),p=k=>{const S=s(k);return $l(S,y=>{e.data.value=y})},m=s(),w=u(m);return w&&f(w,"data")&&(e.data.value=w.data,e.params.value=w.params),m&&(r.value=p()),ke(()=>{r.value()}),{onBefore(k){const S=s(k),y=u(S);if(!y||!f(y,"data"))return{};if(_(y.time))return e.data.value=y.data,e.loading.value=!1,{isBreak:!0,breakResult:y.data};e.data.value=y.data},onQuery(k){const S=e.params.value,y=s(S);let C=Cl(y);return C&&C!==i?()=>C:(C=k(),i=C,kl(y,C),()=>C)},onSuccess(k,S){const y=s(S);y&&(r.value(),d(y,t,{data:k,params:S,time:new Date().getTime()}),r.value=p(S))},onMutate(k){const S=s(e.params.value);S&&(r.value(),d(S,t,{data:k,params:e.params.value,time:new Date().getTime()}),r.value=p(e.params.value))}}});function Tl(e){let o,t;class l extends Promise{constructor(a){super(a),this.cancel=()=>{t(),clearTimeout(o)}}}return new l(n=>{t=n,o=setTimeout(t,e)})}function Ie(){return new Date().getTime()}var Ol=ae((e,{loadingDelay:o=0,loadingKeep:t=0})=>{const l=O(()=>{}),n=R(()=>ee(o)),a=R(()=>ee(t));let s=0,r={};const i=()=>{let u;return n.value&&(u=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},n.value)),()=>u&&clearTimeout(u)};return{onBefore(){e.loading.value=!n.value,l.value(),l.value=i(),s=Ie()},onQuery(u){if(!a.value)return()=>u();r=Tl(a.value+n.value);const d=async()=>{try{const f=await u();return Ie()-s<=n.value&&r.cancel(),Promise.resolve(f)}catch(f){return Ie()-s<=n.value&&r.cancel(),Promise.reject(f)}},_=Promise.allSettled([d(),r]).then(f=>{const p=f[0];return p.status==="fulfilled"?p.value:Promise.reject(p.reason)});return()=>_},onCancel(){l.value()},onAfter(){l.value()}}}),Se;const kt=new Set,Ct=new Set,Vt=new Set,ge=(e,o)=>{let t;switch(e){case"FOCUS_LISTENER":t=kt;break;case"RECONNECT_LISTENER":t=Vt;break;case"VISIBLE_LISTENER":t=Ct;break}if(!t.has(o))return t.add(o),()=>{t.delete(o)}},Ee=e=>{e.forEach(o=>{o()})};!Ke&&(Se=window)!==null&&Se!==void 0&&Se.addEventListener&&(window.addEventListener("visibilitychange",()=>{gt()&&Ee(Ct)},!1),window.addEventListener("focus",()=>Ee(kt),!1),window.addEventListener("online",()=>Ee(Vt),!1));var Il=ae((e,{pollingInterval:o,pollingWhenHidden:t=!1,pollingWhenOffline:l=!1,errorRetryCount:n=0})=>{const a=O(),s=O(!1),r=R(()=>ee(o)),i=R(()=>ee(n)),u=[],d=m=>{m&&u.push(m)},_=()=>(t||gt())&&(l||il()),f=m=>{if(e.error.value&&i.value!==0)return;let w;if(!ve(r.value)&&r.value>=0)if(_())w=setTimeout(m,r.value);else{s.value=!0;return}return()=>w&&clearTimeout(w)},p=()=>{s.value&&_()&&(e.context.refresh(),s.value=!1)};return oe(r,()=>{a.value&&(a.value(),a.value=f(()=>e.context.refresh()))}),t||d(ge("VISIBLE_LISTENER",p)),l||d(ge("RECONNECT_LISTENER",p)),ke(()=>{u.forEach(m=>m())}),{onBefore(){var m;(m=a.value)===null||m===void 0||m.call(a)},onCancel(){var m;(m=a.value)===null||m===void 0||m.call(a)},onAfter(){a.value=f(()=>e.context.refresh())}}});const Sl=(e,o)=>{let t=!1;return(...l)=>{t||(t=!0,e(...l),setTimeout(()=>{t=!1},o))}};var El=ae((e,{refreshOnWindowFocus:o=!1,refocusTimespan:t=5e3})=>{const l=R(()=>ee(o)),n=R(()=>ee(t)),a=[],s=i=>{i&&a.push(i)},r=()=>{a.forEach(i=>i())};return ne(()=>{if(r(),l.value){const i=Sl(e.context.refresh,n.value);s(ge("VISIBLE_LISTENER",i)),s(ge("FOCUS_LISTENER",i))}}),ke(()=>{r()}),{}});function fe(e,o){return hl(e,o,[Ol,ml,pl,Il,bl,El,yl,vl,Dl])}const L=ll.create();L.interceptors.response.use(e=>{const o=e.data;return o.code!==200?(X.error(o.msg),Promise.reject(o.msg)):o});var $t=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))($t||{}),ze=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(ze||{}),je=(e=>(e.不显示="false",e.审批人="assignee",e.抄送人="copyUser",e.意见="comment",e))(je||{}),Dt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Dt||{});function Tt(e){return L.get("/sapier-flow/dev-button/list",{params:e})}function Ot(){return fe(()=>Tt({size:-1,ascs:"sort"}).then(e=>e.data.records))}function Ll(e){return L.post("/sapier-flow/dev-button/save",e)}function Nl(e){return L.post("/sapier-flow/dev-button/update",e)}function Rl(e){return L.post("/sapier-flow/dev-button/remove",{},{params:{ids:e}})}const Pl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:re($t)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:re(ze),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示:始终显示;隐藏:始终隐藏;
      发起人:用户为发起人时显示;处理人:用户为处理人时显示;
      已办:任务状态为已办时显示;待办:任务状态为待办时显示;
      未发起:流程未发起时显示;已发起:流程已发起时显示;
      未办结:流程未办结时显示;已办结:流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:re(je),labelTip:"不显示:不显示审批窗口;审批人:显示审批人选择框;抄送人:显示抄送人选择框;意见:显示意见输入框;"},{label:"状态",prop:"status",type:"switch",value:1,dicData:re(Dt)},{label:"排序",prop:"sort",type:"number",value:0},{label:"按钮预览",prop:"buttonPreview",width:200}]},xl=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l}=le({tableOption:Pl,crudOption:{getList:Tt,create:Ll,update:Nl,remove:Rl},sortOption:{ascs:"sort"}});return l(),(n,a)=>{const s=V("v-icon"),r=V("el-button"),i=V("avue-crud");return $(),N(i,ie(ue(c(o))),{icon:v(({row:u})=>[h(s,{icon:u.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:v(({row:u})=>[h(r,{type:u.buttonType},{default:v(()=>[h(s,{icon:u.icon},null,8,["icon"]),A(" "+j(u.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":v(()=>[h(r,{type:c(t).buttonType},{default:v(()=>[h(s,{icon:c(t).icon},null,8,["icon"]),A(" "+j(c(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),We={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},Fl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...We.column,{label:"流程主版本",prop:"mainVersion",formatter(e,o){return o?`V${o||""}`:""}}]};function Al(e){return L.get("/sapier-flow/flow-definition/list",{params:e})}function It(e){return L.get("/sapier-flow/flow-definition/detail",{params:e})}function Ul(e){return L.post("/sapier-flow/flow-definition/save",e)}function Bl(e){return L.post("/sapier-flow/flow-definition/update",e)}function St(e){return L.post("/sapier-flow/flow-definition/deployFlow",e)}const Et=K({__name:"index",props:{categoryId:null},emits:["add","view","edit","version"],setup(e,{emit:o}){const t=e,{bindVal:l,crudStateRefs:{searchForm:n},getDataList:a}=le({tableOption:Fl,crudOption:{getList:Al},searchForm:{categoryId:t.categoryId}});ne(()=>{n.value.categoryId=t.categoryId??"",a()});const s=O(!1);async function r(i){await he.confirm("发布新版本，是否确认？","提示",{type:"success"}),s.value=!0,St({flowModuleId:i.flowModuleId}).then(()=>{X.success("发布成功"),a()}).finally(()=>{s.value=!1})}return(i,u)=>{const d=V("el-button"),_=V("v-icon"),f=V("avue-crud");return $(),N(f,ie(ue(c(l))),{"menu-left":v(()=>[h(d,{type:"primary",icon:"el-icon-plus",onClick:u[0]||(u[0]=p=>o("add"))},{default:v(()=>[A(" 新增 ")]),_:1})]),menu:v(({row:p})=>[h(d,{loading:s.value,type:"text",icon:"el-icon-view",onClick:m=>o("view",p)},{default:v(()=>[A(" 查看 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:s.value,type:"text",icon:"el-icon-edit",onClick:m=>o("edit",p)},{default:v(()=>[A(" 编辑 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:s.value,type:"text",icon:"el-icon-upload",onClick:m=>r(p)},{default:v(()=>[A(" 发布 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:s.value,type:"text",icon:"el-icon-switch",onClick:m=>o("version",p)},{default:v(()=>[A(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:v(({row:p})=>[h(_,{icon:p.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Ml={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...We.column,{label:"流程版本",prop:"version",formatter(e,o){return o?`V${o||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]};var Lt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Lt||{});function Kl(e){return L.get("/sapier-flow/flow-deploy/list",{params:e})}function Nt(e){return L.get("/sapier-flow/flow-deploy/detail",{params:e})}function Rt(e){return L.post("/sapier-flow/flow-deploy/update",e)}function zl(){return L.get("/sapier-flow/flow-run/queryPublishFlowList")}const Pt=K({__name:"index",props:{flowModuleId:null},emits:["back","view","edit"],setup(e,{emit:o}){const t=e,{bindVal:l,crudStateRefs:{searchForm:n},getDataList:a}=le({tableOption:Ml,crudOption:{getList:Kl,dataPath:"res.data"}});ne(()=>{t.flowModuleId&&(n.value.flowModuleId=t.flowModuleId,a())});const s=O(!1);async function r(i){await he.confirm(`确定将 ${i.flowName}(${i.flowKey}:v${i.version}) 设为主版本?`,"提示",{type:"warning"}),s.value=!0,Rt({flowDeployId:i.flowDeployId,flowModuleId:i.flowModuleId,mainVersion:1}).then(()=>{X.success("设置成功"),a()}).finally(()=>{s.value=!1})}return(i,u)=>{const d=V("el-button"),_=V("v-icon"),f=V("avue-crud");return $(),N(f,ie(ue(c(l))),{"menu-left":v(()=>[h(d,{loading:s.value,type:"primary",icon:"el-icon-arrow-left",onClick:u[0]||(u[0]=p=>o("back"))},{default:v(()=>[A(" 返回 ")]),_:1},8,["loading"])]),menu:v(({row:p})=>[h(d,{loading:s.value,type:"text",icon:"el-icon-view",onClick:m=>o("view",p)},{default:v(()=>[A(" 查看 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:s.value,type:"text",icon:"el-icon-edit",onClick:m=>o("edit",p)},{default:v(()=>[A(" 编辑 ")]),_:2},1032,["loading","onClick"]),h(d,{loading:s.value,disabled:p.mainVersion===c(Lt).是,type:"text",icon:"el-icon-switch",onClick:m=>r(p)},{default:v(()=>[A(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:v(({row:p})=>[h(_,{icon:p.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}});function jl(e){return L.get("/sapier-flow/flow-category/list",{params:e})}function Wl(e){return L.post("/sapier-flow/flow-category/save",e)}function Hl(e){return L.post("/sapier-flow/flow-category/update",e)}function Ql(e){return L.post("/sapier-flow/flow-category/remove",{},{params:{ids:e}})}const Ze={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},ql=K({__name:"index",emits:["node-click"],setup(e,{emit:o}){const t={rowKey:"id",getList:jl,create:Wl,update:Hl,remove:Ql,dataPath:"res.data"},{crudStateRefs:{formData:l,tableData:n},getDataList:a,handleSave:s,handleUpdate:r,handleDel:i}=le({crudOption:t,tableOption:Ze,pageOption:{pageSize:20},mockCache:"flow-category"});a();function u(f,p,m,w){s(p,m,w)}function d(f,p,m,w){r(p,NaN,m,w)}async function _(f,p){await i(f.data,NaN),p()}return(f,p)=>{const m=V("avue-tree");return $(),N(m,{modelValue:c(l),"onUpdate:modelValue":p[0]||(p[0]=w=>q(l)?l.value=w:null),option:c(Ze),data:c(n),onNodeClick:p[1]||(p[1]=w=>o("node-click",w)),onSave:u,onUpdate:d,onDel:_},null,8,["modelValue","option","data"])}}}),He=K({__name:"index",props:{modelValue:null,view:{type:Boolean},fields:null},emits:["update:modelValue"],setup(e,{emit:o}){var r;const t=e,l=R({get(){return t.modelValue?ft(t.modelValue):{menuBtn:!1,span:24}},set(i){o("update:modelValue",Do(i,{useJson5:!1}))}}),n=R(()=>t.fields?JSON.parse(t.fields):[]),a=R(()=>{const i={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...i,props:{label:"name",value:"name",desc:"comment"}},{...i,props:{label:"comment",value:"comment",desc:"name"}}]}),s={form:{settings:Array.from({length:((r=Vo.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(i,u)=>{const d=V("avue-form");return e.view?($(),N(d,{key:0,class:J(c(l).class),"model-value":{},option:c(l)},null,8,["class","option"])):($(),N(c($o),{key:1,modelValue:c(l),"onUpdate:modelValue":u[0]||(u[0]=_=>q(l)?l.value=_:null),"base-option":c(a),resources:s},null,8,["modelValue","base-option"]))}}});function Jl(e){return L.get("/sapier-flow/flow-param/list",{params:e})}function Gl(e){return L.get("/sapier-flow/flow-param/getParam",{params:{paramKey:e}})}function Qe(e){return fe(()=>Gl(e).then(o=>o.data))}function Yl(e){return L.post("/sapier-flow/flow-param/save",e)}function Zl(e){return L.post("/sapier-flow/flow-param/update",e)}function Xl(e){return L.post("/sapier-flow/flow-param/remove",{},{params:{ids:e}})}const en=Lo;function tn(e){return L.get("/sapier-flow/flow-user/tree",{params:{filter:e}})}const on=K({__name:"assignee-setter",props:{modelValue:null,tableData:null},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,l=R({get(){return typeof t.modelValue=="string"?t.modelValue?t.modelValue.split(","):[]:t.modelValue},set(i){o("update:modelValue",i.join(","))}}),n=R({get(){return Array.isArray(t.modelValue)?t.modelValue.join(","):t.modelValue},set(i){o("update:modelValue",i)}}),a=O([]),s=O(!1),r=R(()=>{var i,u;return(u=(i=t.tableData)==null?void 0:i.row)==null?void 0:u.type});return oe(r,i=>{["dept","post","user"].includes(i)&&(s.value=!0,tn(i==="user"?"":i).then(u=>{a.value=pt(u.data,d=>({label:d.title,value:d.id}))}).finally(()=>s.value=!1))},{immediate:!0}),(i,u)=>{const d=V("el-tree-select"),_=V("el-input");return["dept","post","user"].includes(c(r))?($(),N(d,{key:0,modelValue:c(l),"onUpdate:modelValue":u[0]||(u[0]=f=>q(l)?l.value=f:null),data:a.value,loading:s.value,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"","expand-on-click-node":!1},null,8,["modelValue","data","loading"])):($(),N(_,{key:1,modelValue:c(n),"onUpdate:modelValue":u[1]||(u[1]=f=>q(n)?n.value=f:null)},null,8,["modelValue"]))}}}),ln={key:0,class:"flow-viewer"},nn={class:"flow-status-legend"},an=K({__name:"index",props:{modelValue:null,view:{type:Boolean},flowFormOption:null,flowHistory:null},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,l=O({}),n=O({}),a=R({get(){let y=Eo();return typeof t.modelValue=="string"&&t.modelValue?y=JSON.parse(t.modelValue):typeof t.modelValue=="object"&&Object.keys(t.modelValue)&&(y=t.modelValue),y},set(y){o("update:modelValue",JSON.stringify(y))}}),s=R(()=>{const{column:y=[],group:C=[]}=JSON.parse(t.flowFormOption||"{}");return[...y,...C.map(g=>g.column??[]).flat()]}),r=R(()=>s.value.map(C=>({label:C.label,value:`\${${C.prop}}`,desc:`\${${C.prop}}`}))),i=re(ze),u=re(je),{data:d}=Ot();oe(n,y=>{var C,b,g,T,E;y&&(y.priority&&(y.priority.dicData=r.value),y.formTitle&&(y.formTitle.dicData=r.value),(g=(b=(C=y.assignee)==null?void 0:C.children)==null?void 0:b.column)!=null&&g[1]&&(y.assignee.children.column[1].component=on),y.formProperty&&(l.value.formProperty=_(s.value,l.value.formProperty||[])),y.button&&((E=(T=y.button.children)==null?void 0:T.column)==null||E.forEach(I=>{I.prop==="display"&&(I.dicData=i),I.prop==="approval"&&(I.dicData=u)}),l.value.button=f(d.value||[],l.value.button||[])))});function _(y,C){return y.map(b=>{var H,z;const g=C.find(ce=>ce.prop===b.prop),{label:T,prop:E,display:I=!0,disabled:P=!1,detail:D=!1,readonly:x=!1,rules:F}=b,W=(F==null?void 0:F.some(ce=>ce.required))??!1,U={label:T,prop:E,display:I,disabled:P,detail:D,readonly:x,required:W,...g};return b.type==="dynamic"&&((z=(H=b.children)==null?void 0:H.column)!=null&&z.length)&&(U.children=_(b.children.column,(g==null?void 0:g.children)??[])),U})}function f(y,C){return y.filter(b=>b.status===1).map(b=>{const g=C.find(x=>x.buttonKey===b.buttonKey),{name:T,buttonKey:E,display:I,approval:P}=b;return{name:T,buttonKey:E,display:I,approval:P,...g}})}const{data:p}=Qe("flow.task.status"),m=R(()=>{var y;return(y=t.flowHistory)==null?void 0:y.map(C=>{var g,T;const b=(T=(g=p.value)==null?void 0:g.find(E=>E.value===C.status))==null?void 0:T.style;return{id:C.taskNodeKey,style:b}})}),w=R(()=>{var y,C;return(C=(y=t.flowHistory)==null?void 0:y.filter(b=>b.taskNodeType==="userTask"))==null?void 0:C.map(b=>{var g;return{id:b.taskNodeKey,content:`<div>${b.assigneeName}</div>
        <div>${b.endTime??""}</div>
        <div>${((g=b.comment)==null?void 0:g.comment)??""}</div>`}})});function k(){var y,C;(C=(y=a.value)==null?void 0:y.flowElementList)==null||C.forEach(b=>{var g;(g=b.properties)!=null&&g.button&&(b.properties.button=f(d.value||[],[]))}),a.value={...a.value}}function S(){var y,C;(C=(y=a.value)==null?void 0:y.flowElementList)==null||C.forEach(b=>{var g;(g=b.properties)!=null&&g.formProperty&&(b.properties.formProperty=_(s.value,[]))}),a.value={...a.value}}return(y,C)=>{const b=V("el-button");return e.view?($(),B("div",ln,[Q("div",nn,[($(!0),B(Z,null,se(c(p),g=>{var T;return $(),B("div",{key:g.label,class:"legend-item"},[Q("div",{class:"legend-color",style:Fe({backgroundColor:(T=g.style)==null?void 0:T.fill})},null,4),Q("span",null,j(g.label),1)])}),128))]),h(c(Io),{"model-value":c(a),styles:c(m),tooltips:c(w)},null,8,["model-value","styles","tooltips"])])):($(),N(c(So),{key:1,modelValue:c(a),"onUpdate:modelValue":C[0]||(C[0]=g=>q(a)?a.value=g:null),formData:l.value,"onUpdate:formData":C[1]||(C[1]=g=>l.value=g),formDefaults:n.value,"onUpdate:formDefaults":C[2]||(C[2]=g=>n.value=g),"form-options":c(en),"form-width":"30%"},{"form-top":v(()=>[h(b,{type:"default",onClick:k},{default:v(()=>[A(" 重置所有按钮配置 ")]),_:1}),h(b,{type:"default",onClick:S},{default:v(()=>[A(" 重置所有表单配置 ")]),_:1})]),_:1},8,["modelValue","formData","formDefaults","form-options"]))}}});const Ve=Ue(an,[["__scopeId","data-v-0e1bbf9e"]]);function xt(e){return L.get("/sapier-flow/dev-form/list",{params:e})}function rn(){return fe(()=>xt({size:-1}).then(e=>e.data.records))}function sn(e){return L.post("/sapier-flow/dev-form/submit",e)}function un(e){return L.post("/sapier-flow/dev-form/submit",e)}function cn(e){return L.post("/sapier-flow/dev-form/remove",{},{params:{ids:e}})}function Ft(e){return L.get("/sapier-flow/dev-flow/list",{params:e})}function dn(){return fe(()=>Ft({size:-1}).then(e=>e.data.records))}function fn(e){return L.post("/sapier-flow/dev-flow/submit",e)}function pn(e){return L.post("/sapier-flow/dev-flow/submit",e)}function mn(e){return L.post("/sapier-flow/dev-flow/remove",{},{params:{ids:e}})}var At=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(At||{});function Ut(e){return L.get("/sapier-flow/dev-table/list",{params:e})}function vn(){return fe(()=>Ut({size:-1}).then(e=>e.data.records))}function yn(e){return L.post("/sapier-flow/dev-table/save",e)}function bn(e){return L.post("/sapier-flow/dev-table/update",e)}function _n(e){return L.post("/sapier-flow/dev-table/remove",{},{params:{ids:e}})}function wn(e){return L.post("/sapier-flow/dev-table/deploy",e)}function qe(e){return new Promise((o,t)=>{(q(e)?e.value:e).validate((n,a,s)=>{n?(a(),o(s)):t(s)})})}const gn=Q("span",null,"流程设计",-1),hn={key:0},kn={key:1},Cn={style:{height:"calc(100vh - 144px)"}},Vn=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},emits:["close"],setup(e,{emit:o}){const l=Ce(e),{visible:n,modelValue:a}=l,s=["流程信息","表单设计","模型设计","完成"],r=O(!1);oe(n,async C=>{if(!C)return;const{flowModuleId:b}=a.value,{flowDeployId:g}=a.value;try{r.value=!0;let T={};g?T=await Nt({flowDeployId:g}):b&&(T=await It({flowModuleId:b})),a.value=T.data}finally{r.value=!1}},{immediate:!0});const{data:i}=rn(),{data:u}=dn(),{data:d}=vn(),_=R(()=>{var C,b;return(b=(C=d.value)==null?void 0:C.find(g=>g.tableName===a.value.formDataTable))==null?void 0:b.tableFields}),f=O(0),p=R(()=>{var C,b;return f.value===1?((C=i.value)==null?void 0:C.map(g=>({label:g.formName,value:g.formOption})))??[]:f.value===2?((b=u.value)==null?void 0:b.map(g=>({label:g.flowName,value:g.flowData})))??[]:[]});function m(C){f.value===1?a.value.formOption=C.value:f.value===2&&(a.value.flowData=C.value)}const w=O();async function k(C){f.value===0&&await qe(w),r.value=!0;const{flowModuleId:b}=a.value,{flowDeployId:g}=a.value;try{g?await Rt(a.value):b?await Bl(a.value):await Ul(a.value).then(T=>{a.value.flowModuleId=T.data.flowModuleId}),X.success("保存成功")}finally{r.value=!1}typeof C=="number"?f.value=C:f.value++}async function S(){await he.confirm("发布新版本，是否确认？","提示"),r.value=!0,St({flowModuleId:a.value.flowModuleId}).then(()=>{X.success("发布成功")}).finally(()=>{r.value=!1})}function y(){n.value=!1,f.value=0,a.value={},o("close")}return(C,b)=>{const g=V("el-link"),T=V("el-dropdown-item"),E=V("el-dropdown-menu"),I=V("el-dropdown"),P=V("el-col"),D=V("el-step"),x=V("el-steps"),F=V("el-button"),W=V("el-row"),U=V("avue-form"),H=V("el-result"),z=V("el-dialog"),ce=Be("loading");return $(),N(z,{modelValue:c(n),"onUpdate:modelValue":b[4]||(b[4]=G=>q(n)?n.value=G:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:y},{header:v(()=>[h(W,{align:"center",justify:"center"},{default:v(()=>[h(P,{span:5},{default:v(()=>{var G,pe,$e,Je;return[Q("div",null,[gn,(G=c(a))!=null&&G.flowName?($(),B("span",hn," - "+j((pe=c(a))==null?void 0:pe.flowName),1)):M("",!0),($e=c(a))!=null&&$e.version?($(),B("span",kn," - V"+j((Je=c(a))==null?void 0:Je.version),1)):M("",!0)]),c(p).length?($(),N(I,{key:0},{dropdown:v(()=>[h(E,null,{default:v(()=>[($(!0),B(Z,null,se(c(p),De=>($(),N(T,{key:De.label,onClick:ha=>m(De)},{default:v(()=>[A(j(De.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:v(()=>[h(g,{icon:"el-icon-arrow-down",underline:!1},{default:v(()=>[A(" 选择模板 ")]),_:1})]),_:1})):M("",!0)]}),_:1}),h(P,{span:14},{default:v(()=>[h(x,{active:f.value,simple:"","process-status":"finish","finish-status":"success"},{default:v(()=>[($(),B(Z,null,se(s,(G,pe)=>h(D,{key:pe,title:G,onClick:$e=>k(pe)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),h(P,{span:5,style:{"text-align":"right"}},{default:v(()=>[h(F,{disabled:f.value===0,loading:r.value,type:"primary",onClick:b[0]||(b[0]=G=>f.value--)},{default:v(()=>[A(" 上一步 ")]),_:1},8,["disabled","loading"]),h(F,{disabled:f.value===s.length-1,type:"primary",loading:r.value,onClick:k},{default:v(()=>[A(" 下一步 ")]),_:1},8,["disabled","loading"]),h(F,{onClick:y},{default:v(()=>[A(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:v(()=>[me(($(),B("div",Cn,[f.value===0?($(),N(U,{key:0,ref_key:"formRef",ref:w,modelValue:c(a),"onUpdate:modelValue":b[1]||(b[1]=G=>q(a)?a.value=G:null),option:c(We),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):M("",!0),f.value===1?($(),N(He,{key:1,modelValue:c(a).formOption,"onUpdate:modelValue":b[2]||(b[2]=G=>c(a).formOption=G),fields:c(_)},null,8,["modelValue","fields"])):M("",!0),f.value===2?($(),N(Ve,{key:2,modelValue:c(a).flowData,"onUpdate:modelValue":b[3]||(b[3]=G=>c(a).flowData=G),"flow-form-option":c(a).formOption},null,8,["modelValue","flow-form-option"])):M("",!0),f.value===3?($(),N(H,{key:3,icon:"success",title:"流程设计完成"},{extra:v(()=>[c(a).flowDeployId?M("",!0):($(),N(F,{key:0,type:"primary",onClick:S},{default:v(()=>[A(" 发布 ")]),_:1})),h(F,{onClick:y},{default:v(()=>[A(" 关闭 ")]),_:1})]),_:1})):M("",!0)])),[[ce,r.value]])]),_:1},8,["modelValue"])}}}),$n=Q("span",null,"流程查看",-1),Dn={key:0},Tn={key:1},On=K({__name:"index",props:{modelValue:null,visible:{type:Boolean}},setup(e){const t=Ce(e),{visible:l,modelValue:n}=t,a=O("form"),s=O(!1);oe(l,async i=>{if(!i)return;const{flowModuleId:u}=n.value,{flowDeployId:d}=n.value;try{s.value=!0;let _={};d?_=await Nt({flowDeployId:d}):u&&(_=await It({flowModuleId:u})),n.value={..._.data}}finally{s.value=!1}},{immediate:!0});function r(){n.value={},a.value="form"}return(i,u)=>{const d=V("el-tab-pane"),_=V("el-tabs"),f=V("el-dialog"),p=Be("loading");return $(),N(f,{modelValue:c(l),"onUpdate:modelValue":u[3]||(u[3]=m=>q(l)?l.value=m:null),width:"60%",top:"0",onClose:r},{header:v(()=>{var m,w,k,S;return[$n,(m=c(n))!=null&&m.flowName?($(),B("span",Dn," - "+j((w=c(n))==null?void 0:w.flowName),1)):M("",!0),(k=c(n))!=null&&k.version?($(),B("span",Tn," - V"+j((S=c(n))==null?void 0:S.version),1)):M("",!0)]}),default:v(()=>[me(($(),N(_,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=m=>a.value=m)},{default:v(()=>[h(d,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:v(()=>[a.value==="form"&&c(n).formOption?($(),N(He,{key:0,modelValue:c(n).formOption,"onUpdate:modelValue":u[0]||(u[0]=m=>c(n).formOption=m),view:""},null,8,["modelValue"])):M("",!0)]),_:1}),h(d,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:v(()=>[a.value==="flow"?($(),N(Ve,{key:0,modelValue:c(n).flowData,"onUpdate:modelValue":u[1]||(u[1]=m=>c(n).flowData=m),view:""},null,8,["modelValue"])):M("",!0)]),_:1})]),_:1},8,["modelValue"])),[[p,s.value]])]),_:1},8,["modelValue"])}}}),In=K({__name:"index",setup(e){const o=O("definition"),t=O({}),l=O(""),n=O("");function a(m){l.value===m.id?l.value="":l.value=m.id}const s=O(!1),r=O(!1);function i(){t.value={},s.value=!0}function u(m){t.value=m,s.value=!0}function d(m){t.value=m,r.value=!0}function _(m){n.value=m.flowModuleId||"",o.value="deploy"}function f(){n.value="",o.value="definition"}async function p(){const m=o.value;await te(),o.value="",await te(),o.value=`${m}`}return(m,w)=>{const k=V("el-col"),S=V("el-row");return $(),N(S,{gutter:20},{default:v(()=>[h(k,{span:4},{default:v(()=>[h(ql,{onNodeClick:a})]),_:1}),h(k,{span:20},{default:v(()=>[o.value==="definition"?($(),N(Et,{key:0,"category-id":l.value,onAdd:i,onEdit:u,onView:d,onVersion:_},null,8,["category-id"])):M("",!0),o.value==="deploy"?($(),N(Pt,{key:1,"flow-module-id":n.value,onEdit:u,onView:d,onBack:f},null,8,["flow-module-id"])):M("",!0),h(Vn,{modelValue:t.value,"onUpdate:modelValue":w[0]||(w[0]=y=>t.value=y),visible:s.value,"onUpdate:visible":w[1]||(w[1]=y=>s.value=y),onClose:p},null,8,["modelValue","visible"]),h(On,{modelValue:t.value,"onUpdate:modelValue":w[2]||(w[2]=y=>t.value=y),visible:r.value,"onUpdate:visible":w[3]||(w[3]=y=>r.value=y)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Sn={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]};function En(e){return L.get("/sapier-flow/flow-ops/list",{params:e})}function Ln(e){return L.get("/sapier-flow/flow-run/queryPublishFlowDetail",{params:e})}function Nn(e){return L.post("/sapier-flow/flow-run/queryApprovalNode",e)}function Rn(e){return L.post("/sapier-flow/flow-run/startProcess",e)}function Pn(e){return L.post("/sapier-flow/flow-run/commitTask",e)}function xn(e){return L.post("/sapier-flow/flow-run/saveDraft",e)}function Fn(e){return L.post("/sapier-flow/flow-run/revokeTask",e)}function An(e){const{flowDetail:o,formVariables:t,approvalFormData:l,debug:n}=e,{flowDeployId:a}=o.value.process??{},{taskId:s,flowInstanceId:r}=o.value.task??{},i={flowDeployId:a,taskId:s,flowInstanceId:r,variables:t.value,debug:n.value,...l.value};return{flow_draft(){if(s&&r)return xn(i)},flow_pass(){return s&&r?Pn(i):Rn(i)},flow_revoke(){if(s&&r)return Fn(i)}}}function Un(e){const o=O({});return ne(async()=>{const t=q(e)?e.value:e,{formProperty:l}=(t==null?void 0:t.properties)||{};l!=null&&l.length&&(await te(),Object.keys(o.value).forEach(n=>{var r,i,u,d;const a=((r=o.value[n])==null?void 0:r.label)||"",s=l==null?void 0:l.find(_=>_.prop===n);if(o.value[n].display=s==null?void 0:s.display,o.value[n].disabled=s==null?void 0:s.disabled,o.value[n].detail=s==null?void 0:s.detail,o.value[n].readonly=s==null?void 0:s.readonly,o.value[n].rules=o.value[n].rules??[],s!=null&&s.required&&((i=o.value[n].rules)!=null&&i.some(_=>_.required)))return null;s!=null&&s.required?(u=o.value[n].rules)==null||u.push({required:!0,message:`${a}为必填项`}):o.value[n].rules=(d=o.value[n].rules)==null?void 0:d.filter(_=>!_.required)}))}),o}function Bn(){return{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"form"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean}}}function Mn(){return{complete:e=>e}}const Bt=Symbol("flowFormState");function Kn(e,o){const t=Ce(e,void 0,{passive:!0,deep:!0}),{flowDetail:l,modelValue:n,formLoading:a}=t;ne(()=>{const{flowKey:f,taskId:p,instanceId:m}=e;!f&&!p&&!m||(a.value=!0,Ln({flowKey:f,taskId:p,flowInstanceId:m}).then(w=>{l.value=w.data,n.value=w.data.formData||{}}).finally(()=>{a.value=!1}))});const s=R(()=>({fileTab:!0,trackTab:!0,...e.permission})),r=R(()=>{var f,p,m,w;return s.value.fileTab===!0&&((w=(m=(p=(f=l.value)==null?void 0:f.properties)==null?void 0:p.formProperty)==null?void 0:m.find(k=>k.prop==="fileTab"))==null?void 0:w.display)}),i=R(()=>{var f,p,m,w;return s.value.trackTab===!0&&((w=(m=(p=(f=l.value)==null?void 0:f.properties)==null?void 0:p.formProperty)==null?void 0:m.find(k=>k.prop==="trackTab"))==null?void 0:w.display)}),u=O(!1),d=R(()=>Object.entries(n.value||{}).filter(([f])=>!f.startsWith("$")).map(([f,p])=>({key:f,value:p}))),_={...t,formData:n,formVariables:d,approvalVisible:u,showFileTab:r,showTrackTab:i,permission:s,emit:o};return st(Bt,_),_}function Mt(){return we(Bt)}const zn=K({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:o}=Ce(e,void 0,{passive:!0,deep:!0}),t=Un(e.flowDetail),{proxy:l}=Ae(),n=O({});ne(()=>{const{formOption:r}=e.flowDetail.process??{};n.value=ft.bind(l)(r||'{"menuBtn":false}'),n.value.detail=!!e.detail});const a=O();function s(){return qe(a)}return{form:o,option:n,defaults:t,formRef:a,validate:s}},render(){return Ne(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}});function jn(e){return L.get("/sapier-flow/flow-user-common/list",{params:{type:e,ascs:"sort"}})}function Wn(e){return fe(()=>jn(e.value).then(o=>o.data.records),{refreshDeps:[e]})}function Hn(e){return L.post("/sapier-flow/flow-user-common/save",e)}function Qn(e){return L.post("/sapier-flow/flow-user-common/remove",{},{params:{ids:e}})}function qn(e){return L.post("/sapier-flow/flow-user-common/batchUpdate",e)}const Jn=K({__name:"common-comments",props:{modelValue:{type:String}},setup(e){const t=ko(e,"modelValue"),l=O(!1),{activeBtn:n}=Mt(),a=R(()=>{var w;return(w=n.value)==null?void 0:w.buttonKey}),{data:s,refresh:r}=Wn(a),i=R(()=>{var k,S,y;const w=t.value;if(w&&!((k=s.value)!=null&&k.some(C=>C.content===w))){const C=(((y=(S=s.value)==null?void 0:S[0])==null?void 0:y.sort)||1)-1;return[{content:w,sort:C},...s.value||[]]}return s.value});async function u(w){var k;await Hn({...w,type:(k=n.value)==null?void 0:k.buttonKey}),X.success("添加成功"),r()}async function d(w){await Qn(w.id),X.success("删除成功"),r()}async function _(w,k){let S=k.parent.data;S=S.map((y,C)=>({id:y.id,sort:C+1})),await qn(S),X.success("修改排序成功"),r(),l.value=!1}function f(){l.value=!0}const p=O();async function m(w){var k;t.value=w.content,await te(),(k=p.value)==null||k.blur()}return(w,k)=>{const S=V("el-input"),y=V("el-text"),C=V("el-col"),b=V("el-button"),g=V("el-row"),T=V("el-tree"),E=V("el-popover");return $(),N(E,{visible:l.value,placement:"bottom",title:"常用意见",width:300},{reference:v(()=>[h(S,{ref_key:"inputRef",ref:p,modelValue:c(t),"onUpdate:modelValue":k[0]||(k[0]=I=>q(t)?t.value=I:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:k[1]||(k[1]=I=>l.value=!0),onBlur:k[2]||(k[2]=I=>l.value=!1)},null,8,["modelValue"])]),default:v(()=>[h(T,{data:c(i),"node-key":"content",draggable:"","allow-drop":(I,P,D)=>D!=="inner",props:{label:"content"},onNodeClick:m,onNodeDrop:_,onNodeDragStart:f},{default:v(({data:I})=>[h(g,{style:{width:"250px"}},{default:v(()=>[h(C,{span:20},{default:v(()=>[h(y,{truncated:"",title:I.content},{default:v(()=>[A(j(I.content),1)]),_:2},1032,["title"])]),_:2},1024),h(C,{span:4},{default:v(()=>[I.id?($(),N(b,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Le(P=>d(I),["stop"])},null,8,["onClick"])):($(),N(b,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Le(P=>u(I),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),Gn=K({__name:"approval-form",emits:["confirm"],setup(e,{emit:o}){const t={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},{formData:l,approvalFormData:n,activeBtn:a,approvalVisible:s,formVariables:r,flowDetail:i}=Mt(),u=O([]),d=O([]),_=O(),f=O({}),p={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:m}]},{label:"抄送人",prop:"copyUser",span:24,rules:[{required:!0,message:"请选择抄送人"}]},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function m(T,E,I){var x;const P=u.value[0].type==="ParallelGateway",D=(x=u.value[0].children)==null?void 0:x.every(F=>To([F],W=>d.value.some(U=>U.id===W.id)));if(d.value.length){if(P&&!D)return I("请在每个节点选择审批人")}else return I("请选择审批人");return!0}const w=O(),k=R(()=>{var T,E;return(E=(T=a.value)==null?void 0:T.approval)==null?void 0:E.includes("assignee")}),S=O(!1),y=O(!1);ne(async()=>{var P,D,x;if(!s.value||!_.value)return;const{flowKey:T}=((P=i.value)==null?void 0:P.process)||{},{taskId:E}=((D=i.value)==null?void 0:D.task)||{};u.value=[],d.value=[];const I=E?"":"发起";if(n.value={assignee:{},outgoing:[],comment:l.value.comment||I},te(()=>{var F,W,U,H;f.value.assignee.display=k.value,f.value.copyUser.display=(W=(F=a.value)==null?void 0:F.approval)==null?void 0:W.includes("copyUser"),f.value.comment.display=(H=(U=a.value)==null?void 0:U.approval)==null?void 0:H.includes("comment")}),k.value)try{y.value=!0;const F=await Nn({flowKey:T,variables:r.value,taskId:E});u.value=pt(F.data??[],(U,H,z)=>{const ce=U.id||lo();return U.taskNodeKey=(z==null?void 0:z.taskNodeKey)??U.taskNodeKey,U.incoming=(z==null?void 0:z.incoming)??U.incoming,{...U,id:ce,disabled:U.type!=="user"}}),await te();const W=C(u.value);W&&((x=w.value)==null||x.setCheckedNodes([W]))}finally{y.value=!1}});function C(T){var E;if(T.length===1)return(E=T[0].children)!=null&&E.length?C(T[0].children):T[0]}async function b(T,E){var P,D;if(T.type!=="user")return;await te(),await te();const I=(P=w.value)==null?void 0:P.getCheckedNodes();d.value=I.filter(x=>x.type==="user"),(D=w.value)==null||D.setCheckedNodes(d.value)}async function g(){await qe(_),S.value=!0;const T={},E={},I=new Set;d.value.forEach(P=>{const{taskNodeKey:D,incoming:x}=P;T[D]||(T[D]=new Set),P.userId&&T[D].add(P.userId),E[D]=[...T[D]].join(","),I.add(x)}),n.value.assignee=E,n.value.outgoing=[...I],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",l),o("confirm")}return(T,E)=>{const I=V("v-icon"),P=V("el-col"),D=V("el-tag"),x=V("avue-form"),F=V("el-row"),W=V("el-button"),U=V("el-dialog"),H=Be("loading");return $(),N(U,{modelValue:c(s),"onUpdate:modelValue":E[4]||(E[4]=z=>q(s)?s.value=z:null),title:c(a).name,width:c(k)?"800px":"500px","append-to-body":""},{footer:v(()=>[h(W,{onClick:E[3]||(E[3]=z=>s.value=!1)},{default:v(()=>[A(" 取 消 ")]),_:1}),h(W,{type:"primary",onClick:g},{default:v(()=>[A(" 确 定 ")]),_:1})]),default:v(()=>[h(F,{gutter:20},{default:v(()=>[c(k)?($(),N(P,{key:0,span:10},{default:v(()=>[me(($(),N(c(Oo),{ref_key:"treeRef",ref:w,class:"approval-tree","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:u.value,style:{"max-height":"500px",overflow:"auto"},onCheckChange:b},{default:v(({data:z})=>[Q("div",null,[h(I,{icon:t[z.type],style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(z.title),1)])]),_:1},8,["data"])),[[H,y.value]])]),_:1})):M("",!0),h(P,{span:c(k)?14:24},{default:v(()=>[h(x,{ref_key:"formRef",ref:_,modelValue:c(n),"onUpdate:modelValue":E[1]||(E[1]=z=>q(n)?n.value=z:null),defaults:f.value,"onUpdate:defaults":E[2]||(E[2]=z=>f.value=z),option:p},{assignee:v(()=>[($(!0),B(Z,null,se(d.value,z=>($(),N(D,{key:z.id,type:"info"},{default:v(()=>[A(j(z.title),1)]),_:2},1024))),128))]),copyUser:v(()=>[]),comment:v(()=>[h(Jn,{modelValue:c(n).comment,"onUpdate:modelValue":E[0]||(E[0]=z=>c(n).comment=z)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","title","width"])}}}),Yn={class:"flow-track"},Zn={key:0},Xn={key:1},ea=K({__name:"flow-track",props:{flowDetail:null},setup(e){const o=e,t=O("table"),l=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=R(()=>{var i,u,d;return((d=(u=(i=o.flowDetail)==null?void 0:i.flowHistory)==null?void 0:u.filter(_=>_.taskNodeType==="userTask"))==null?void 0:d.map(_=>({..._,duration:no(_.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:s}=Qe("flow.handle.type");function r(i){var u;return(u=s.value)==null?void 0:u.find(d=>d.value===i)}return(i,u)=>{var y,C,b;const d=V("v-icon"),_=V("el-radio-button"),f=V("el-radio-group"),p=V("avue-crud"),m=V("el-card"),w=V("el-timeline-item"),k=V("el-timeline"),S=V("el-empty");return $(),B(Z,null,[h(f,{modelValue:t.value,"onUpdate:modelValue":u[0]||(u[0]=g=>t.value=g)},{default:v(()=>[($(),B(Z,null,se(l,g=>h(_,{key:g.label,label:g.label},{default:v(()=>[h(d,{icon:g.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",Yn,[t.value==="table"?($(),N(p,{key:0,data:c(n),option:a},null,8,["data"])):M("",!0),t.value==="graph"?($(),N(Ve,{key:1,"model-value":(C=(y=e.flowDetail)==null?void 0:y.process)==null?void 0:C.flowData,"flow-history":(b=e.flowDetail)==null?void 0:b.flowHistory,view:""},null,8,["model-value","flow-history"])):M("",!0),t.value==="timeline"?($(),B(Z,{key:2},[c(n).length?($(),N(k,{key:0},{default:v(()=>[($(!0),B(Z,null,se([...c(n)].reverse(),g=>($(),N(w,{key:g.id,timestamp:g.endTime,placement:"top"},{default:v(()=>[h(m,null,{default:v(()=>{var T,E,I;return[Q("div",null,j(g.assigneeName)+" 开始处理 ["+j(g.taskNodeName)+"] 环节 ",1),g.duration?($(),B("div",Zn," 办理时长："+j(g.duration),1)):M("",!0),g.type&&((T=g.comment)!=null&&T.comment)?($(),B("div",Xn,j((E=r(g.type))==null?void 0:E.label)+"意见："+j((I=g.comment)==null?void 0:I.comment),1)):M("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):($(),N(S,{key:1}))],64)):M("",!0)])],64)}}});const ta=Ue(ea,[["__scopeId","data-v-3ea86146"]]),oa=K({__name:"button-list",props:{flowDetail:null},emits:["click"],setup(e,{emit:o}){const t=e,{data:l}=Ot();function n(s,r){return s.map(i=>{const u=r.find(_=>_.buttonKey===i.buttonKey);return{...i,...No(u,["display","approval"])}})}const a=R(()=>{var m,w,k,S,y;const s={userId:"1"},{assignee:r,status:i}=((m=t.flowDetail)==null?void 0:m.task)||{},{createUser:u,flowInstanceId:d,status:_}=((w=t.flowDetail)==null?void 0:w.flowInstance)||{},f={true:!0,false:!1,startUser:u==s.userId,assignee:r==s.userId,todo:i==2,done:i==1,notstarted:!d,started:!!d,finished:_===1,unfinished:_===2};return((y=n(l.value??[],((S=(k=t.flowDetail)==null?void 0:k.properties)==null?void 0:S.button)??[]))==null?void 0:y.filter(C=>{var b,g;return(g=(b=C.display)==null?void 0:b.split(","))==null?void 0:g.every(T=>f[T])}))??[]});return(s,r)=>{const i=V("v-icon"),u=V("el-button");return $(!0),B(Z,null,se(c(a),d=>($(),N(u,{key:d.buttonKey,type:d.buttonType,onClick:_=>o("click",d)},{default:v(()=>[h(i,{icon:d.icon},null,8,["icon"]),A(" "+j(d.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),la={class:"flow-form__title"},Kt=K({__name:"index",props:Bn(),emits:Mn(),setup(e,{emit:o}){const t=e,l=Kn(t,o),{flowDetail:n,modelValue:a,activeTab:s,activeBtn:r,formLoading:i,approvalVisible:u,submitLoading:d}=l,_=O();async function f(m){var w,k;r.value=m,await((w=_.value)==null?void 0:w.validate()),await((k=t.beforeClick)==null?void 0:k.call(t,m)),(m==null?void 0:m.approval)!=="false"?u.value=!0:p()}async function p(){var w,k;const m=An(l);try{const{buttonKey:S}=r.value;d.value=!0,await((w=t.beforeSubmit)==null?void 0:w.call(t,r.value)),await((k=m[S])==null?void 0:k.call(m)),X.success("操作成功"),u.value=!1,o("complete",r.value)}finally{d.value=!1}}return(m,w)=>{const k=V("el-skeleton"),S=V("el-main"),y=V("el-header"),C=V("el-tab-pane"),b=V("el-tabs"),g=V("el-container");return c(i)?($(),N(S,{key:0},{default:v(()=>[h(k)]),_:1})):($(),N(g,{key:1,class:"flow-form"},{default:v(()=>[h(y,{class:"flow-form__header"},{default:v(()=>{var T;return[Q("div",la,j((T=c(n).flowInstance)==null?void 0:T.title),1),h(oa,{"flow-detail":c(n),onClick:f},null,8,["flow-detail"])]}),_:1}),h(S,{class:"flow-form__main"},{default:v(()=>[h(b,{modelValue:c(s),"onUpdate:modelValue":w[1]||(w[1]=T=>q(s)?s.value=T:null)},{default:v(()=>{var T,E;return[(E=(T=c(n))==null?void 0:T.process)!=null&&E.formPath?Y(m.$slots,"default",{key:0}):($(),N(C,{key:1,label:"审批信息",name:"form"},{default:v(()=>[h(zn,{ref_key:"formRef",ref:_,modelValue:c(a),"onUpdate:modelValue":w[0]||(w[0]=I=>q(a)?a.value=I:null),"flow-detail":c(n)},null,8,["modelValue","flow-detail"])]),_:1})),h(C,{label:"附件资料",name:"file",lazy:""}),h(C,{label:"流程跟踪",name:"track",lazy:""},{default:v(()=>[h(ta,{"flow-detail":c(n)},null,8,["flow-detail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3}),h(Gn,{onConfirm:p})]),_:3}))}}});function zt(e,o){switch(o.type){case"window":return na(e,o);case"dialog":case"drawer":return aa(e,o);default:return{open:()=>{},close:()=>{}}}}function na(e,o){const{window:{url:t="",name:l="flow-form",features:n="left=0,top=0,width=1600,height=900"}={}}=o,a=O(null),s=R(()=>`${t}?${ao(ro(e,so(io,uo)))}`);return{open:()=>{var u;a.value=window.open(s.value,l,n),(u=a.value)==null||u.addEventListener("message",d=>{const{event:_}=d.data,f=c(e)[_];typeof f=="function"&&f(d.data)})},close:()=>{var u;return(u=a.value)==null?void 0:u.close()},openedWindow:a}}function aa(e,o){const{appContext:t}=Ae();let l;const n=()=>{l=document.createElement("div"),l.className="flow-form-wrapper";const s=ra(o.formPath),r=Ne(s,{...c(e)}),i=Ne(o.type==="dialog"?Wo:tl,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...o.overlay},r);i.appContext=t,bo(i,l),document.body.appendChild(l)},a=()=>{l&&document.body.removeChild(l)};return{open:n,close:a}}function ra(e){return e?_o(()=>wo(()=>import(e),[])):Kt}const sa=K({__name:"index",setup(e){const o=Co("debugMode",!1),{bindVal:t,getDataList:l}=le({tableOption:Sn,crudOption:{getList:En},searchForm:{status:2},sortOption:{descs:"start_time"}});l();const n=O({}),{open:a,close:s}=zt(n,{type:"drawer"});function r(i){n.value={flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:o.value,onComplete:()=>{s(),l()}},a()}return(i,u)=>{const d=V("el-switch"),_=V("el-button"),f=V("el-link"),p=V("avue-crud");return $(),N(p,ie(ue(c(t))),{"menu-right":v(()=>[h(_,{type:"text"},{default:v(()=>[h(d,{modelValue:c(o),"onUpdate:modelValue":u[0]||(u[0]=m=>q(o)?o.value=m:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:v(({row:m})=>[h(f,{type:"primary",underline:!1,onClick:w=>r(m)},{default:v(()=>[A(j(m.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}});var jt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(jt||{});const Re=re(jt),ia={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:Re},{label:"备注",prop:"remark"}]},ua=K({__name:"index",setup(e){const{bindVal:o,getDataList:t}=le({tableOption:ia,crudOption:{getList:Jl,create:Yl,update:Zl,remove:Xl}});return t(),(l,n)=>{const a=V("avue-crud");return $(),N(a,ie(ue(c(o))),null,16)}}}),ca={class:"flow-list"},da=["onClick"],fa={class:"flow-name"},pa=K({__name:"index",setup(e){const o=O([]);zl().then(s=>{o.value=s.data});const t=O({}),{open:l,close:n}=zt(t,{type:"drawer"});function a(s){t.value={flowKey:s.flowKey,onComplete:n},l()}return(s,r)=>{const i=V("v-icon");return $(),B("div",ca,[($(!0),B(Z,null,se(o.value,u=>($(),B("div",{key:u.flowKey,class:"flow-item",onClick:d=>a(u)},[h(i,{class:"flow-icon",icon:u.flowIcon,width:"60"},null,8,["icon"]),Q("div",fa,j(u.flowName),1)],8,da))),128))])}}});const ma=Ue(pa,[["__scopeId","data-v-144fd383"]]),va={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},ya=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,handleUpdate:n}=le({tableOption:va,crudOption:{getList:Ft,create:fn,update:pn,remove:mn}});l();const a=O(!1);async function s(i){t.value=i,a.value=!0}async function r(){await n(t.value,NaN,()=>a.value=!1,()=>{})}return(i,u)=>{const d=V("el-button"),_=V("avue-crud"),f=V("el-dialog");return $(),B(Z,null,[h(_,ie(ue(c(o))),{flowData:v(({row:p})=>[h(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>s(p)},{default:v(()=>[A(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),h(f,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=p=>a.value=p),title:`模型设计-${c(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:v(()=>[h(d,{type:"primary",onClick:r},{default:v(()=>[A(" 保存 ")]),_:1}),h(d,{onClick:u[1]||(u[1]=p=>a.value=!1)},{default:v(()=>[A(" 取消 ")]),_:1})]),default:v(()=>[h(Ve,{modelValue:c(t).flowData,"onUpdate:modelValue":u[0]||(u[0]=p=>c(t).flowData=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),ba={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},_a=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,handleUpdate:n}=le({tableOption:ba,crudOption:{getList:xt,create:sn,update:un,remove:cn},mockCache:"form-template"});l();const a=O(!1);async function s(i){t.value={...i},a.value=!0}async function r(){await n(t.value,NaN,()=>a.value=!1,()=>{})}return(i,u)=>{const d=V("el-button"),_=V("avue-crud"),f=V("el-dialog");return $(),B(Z,null,[h(_,ie(ue(c(o))),{formOption:v(({row:p})=>[h(d,{type:"primary",text:"",icon:"el-icon-crop",onClick:m=>s(p)},{default:v(()=>[A(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),h(f,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=p=>a.value=p),title:`表单设计-${c(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:v(()=>[h(d,{type:"primary",onClick:r},{default:v(()=>[A(" 保存 ")]),_:1}),h(d,{onClick:u[1]||(u[1]=p=>a.value=!1)},{default:v(()=>[A(" 取消 ")]),_:1})]),default:v(()=>[h(He,{modelValue:c(t).formOption,"onUpdate:modelValue":u[0]||(u[0]=p=>c(t).formOption=p),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),wa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreated:!0,defaultFirstOption:!0,dicData:re(At)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Re,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Re,value:1}]}}]},ga=K({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:t},getDataList:l,beforeOpen:n,beforeSave:a,beforeUpdate:s}=le({crudOption:{getList:Ut,create:yn,update:bn,remove:_n},tableOption:wa}),{data:r}=Qe("table.default.fields");l(),n(d=>{d==="add"?t.value.tableFields=r.value:t.value.tableFields=JSON.parse(t.value.tableFields)}),a(d=>{d.tableFields=JSON.stringify(d.tableFields)}),s(d=>{d.tableFields=JSON.stringify(d.tableFields)});const i=O(!1);async function u(d){await he.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),i.value=!0,wn({id:d.id}).then(()=>{X.success("部署成功"),l()}).finally(()=>{i.value=!1})}return(d,_)=>{const f=V("el-button"),p=V("avue-crud");return $(),N(p,ie(ue(c(o))),{menu:v(({row:m})=>[h(f,{type:"text",icon:"el-icon-upload",onClick:w=>u(m)},{default:v(()=>[A(" 部署 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),$r={install(e){e.component("FlowButton",xl),e.component("FlowDefinition",Et),e.component("FlowDeploy",Pt),e.component("FlowForm",Kt),e.component("FlowManage",In),e.component("FlowOps",sa),e.component("FlowParam",ua),e.component("FlowTemplate",ya),e.component("FormTemplate",_a),e.component("TableTemplate",ga),e.component("FlowWorkbench",ma)}};export{xl as FlowButton,Et as FlowDefinition,Pt as FlowDeploy,Kt as FlowForm,In as FlowManage,sa as FlowOps,ua as FlowParam,ya as FlowTemplate,_a as FormTemplate,ga as TableTemplate,ma as Workbench,$r as default};
