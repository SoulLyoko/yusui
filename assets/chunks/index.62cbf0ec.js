var qt=Object.defineProperty;var Yt=(e,t,n)=>t in e?qt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Q=(e,t,n)=>(Yt(e,typeof t!="symbol"?t+"":t,n),n);import{d as Ht,a as Jt,b as Kt}from"../flow-design_demo.md.1ded304f.js";import{f as Mi,g as Ii,h as Oi,i as Ti,c as Li,e as Pi,j as Si,k as Di,m as Ci,n as Ri,p as Fi,l as ji,s as Ai,o as Vi,q as Bi,r as Gi}from"../flow-design_demo.md.1ded304f.js";import{C as Xt,G as ve,M as Qt,D as Zt,l as $e,S as en,a as tn,I as nn,B as We,b as Ue}from"./index.16846c61.js";import{E as $i,f as Wi,g as Ui,h as qi,t as Yi,u as Hi,r as Ji,s as Ki,N as Xi,q as Qi,i as Zi,j as es,P as ts,c as ns,o as os,p as rs,m as is,n as ss,d as as,e as ls,U as ds,k as cs}from"./index.16846c61.js";import{bR as on,d3 as Re}from"../composables_use-crud_index.md.5b4b07c5.js";import{i as Fe,u as rn}from"./uniqueId.34f2fc50.js";import{p as Me,w as qe,d as yt,j as sn,l as an,H as Z,o as oe,D as se,E as re,r as Ie,J as le,a as ln,e as H,k as ae,C as dn,v as cn,c as un,aE as fn}from"./framework.893d3c69.js";const Ye={rect:{radius:5,stroke:"black"},circle:{r:18,stroke:"black"},polygon:{stroke:"black"},polyline:{stroke:"black",hoverStroke:"black",selectedStroke:"black"},edgeText:{background:{fill:"white",height:14,stroke:"transparent",radius:3}},nodeText:{}},hn=[{label:"开始",value:"start"},{label:"任务",value:"task"},{label:"结束",value:"end"}],pn=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],vn=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],wi=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:hn},{label:"类型",prop:"eventType",type:"select",dicData:pn},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:vn},{label:"值",prop:"fieldValue"}]}}]}}],mn=[{label:"创建",value:"create"},{label:"指派",value:"assignment"},{label:"完成",value:"complete"},{label:"删除",value:"delete"},{label:"更新",value:"update"},{label:"超时",value:"timeout"}],yn=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],bn=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],gi=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:mn},{label:"类型",prop:"eventType",type:"select",dicData:yn},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:bn},{label:"值",prop:"fieldValue"}]}}]}}],xi=[{label:"",labelWidth:0,prop:"timeLimit",type:"dynamic",children:{column:[{label:"名称",prop:"name"},{label:"最小值",prop:"min",type:"number"},{label:"最大值",prop:"max",type:"number"}]},value:[]}];function He(e,t){return e.map(n=>{const o=t.find(d=>d.buttonKey===n.buttonKey),{name:r,buttonKey:i,display:a,approval:s}=n;return{name:r,buttonKey:i,display:a,approval:s,...o}})}function Oe(e,t){return e.map(n=>{var h,p;const o=t.find(v=>v.prop===n.prop),{label:r,prop:i,display:a=!0,disabled:s=!1,detail:l=!1,readonly:d=!1,rules:c}=n,f=(c==null?void 0:c.some(v=>v.required))??!1,u={label:r,prop:i,display:a,disabled:s,detail:l,readonly:d,required:f,...o};return n.type==="dynamic"&&((p=(h=n.children)==null?void 0:h.column)!=null&&p.length)&&(u.children=Oe(n.children.column,(o==null?void 0:o.children)??[])),u})}function wn({lf:e,graphData:t,elementData:n,formData:o,formLoading:r,formOption:i,formOptions:a,editorVisible:s,dataOptions:l,formRef:d,formDefaults:c}){var h,p,v,b,w,M,P,A,J;async function f({data:y,isForce:N}={data:{},isForce:!1}){var j,C,W,m,T,S,O;const L=(j=e.value)==null?void 0:j.graphModel.nodes.find(R=>R.type==="process");!y&&(L!=null&&L.id)&&(y=(C=e.value)==null?void 0:C.getNodeDataById(L.id)),!((y==null?void 0:y.id)===((W=n.value)==null?void 0:W.id)&&(y==null?void 0:y.type)===((m=n.value)==null?void 0:m.type)&&!N)&&(y.type!=="process"&&((T=e.value)==null||T.selectElementById(y.id)),r.value=!0,await Me(),n.value=y,i.value={menuBtn:!1,span:24,labelPosition:"left",group:((S=a.value)==null?void 0:S[y.type])??Ht},o.value={...y.properties,id:y.id,name:((O=y.text)==null?void 0:O.value)||""},r.value=!1,await Me(),u())}async function u(){var m,T,S,O,R,x,_;const{formPropertyList:y,buttonList:N,fieldsDic:L,flowButtonDisplayDic:j,flowButtonApprovalDic:C}=l.value??{},W=E=>{var I,V;return(V=(I=i.value)==null?void 0:I.group)==null?void 0:V.some(B=>{var G;return(G=B.column)==null?void 0:G.some(K=>K.prop===E)})};W("button")&&(o.value.button=He(N||[],((m=o.value)==null?void 0:m.button)||[]),(O=(S=(T=c.value)==null?void 0:T.button.children)==null?void 0:S.column)==null||O.forEach(E=>{E.prop==="display"&&(E.dicData=j),E.prop==="approval"&&(E.dicData=C)})),W("formProperty")&&(o.value.formProperty=Oe(y||[],((R=o.value)==null?void 0:R.formProperty)||[])),W("priority")&&((x=d.value)==null||x.updateDic("priority",L)),W("formTitle")&&((_=d.value)==null||_.updateDic("formTitle",L))}(h=e.value)==null||h.on("element:click",f),(p=e.value)==null||p.on("blank:click",f),(v=e.value)==null||v.on("node:add",f),(b=e.value)==null||b.on("node:dnd-add",f),(w=e.value)==null||w.on("node:delete",()=>f()),(M=e.value)==null||M.on("history:change",()=>{var y;t.value=(y=e.value)==null?void 0:y.getGraphData()}),(P=e.value)==null||P.on("custom:edit-click",()=>{s.value=!0}),(A=e.value)==null||A.on("custom:reset-form-property",()=>{var y,N;(N=(y=t.value)==null?void 0:y.flowElementList)==null||N.forEach(L=>{var j,C;(j=L.properties)!=null&&j.formProperty&&(L.properties.formProperty=Oe(((C=l.value)==null?void 0:C.formPropertyList)||[],[]))}),t.value={...t.value}}),(J=e.value)==null||J.on("custom:reset-button",()=>{var y,N;(N=(y=t.value)==null?void 0:y.flowElementList)==null||N.forEach(L=>{var j,C;(j=L.properties)!=null&&j.button&&(L.properties.button=He(((C=l.value)==null?void 0:C.buttonList)||[],[]))}),t.value={...t.value}})}class gn extends Xt{constructor({lf:t}){super({lf:t}),[{key:"clear",iconClass:"lf-control-clear",title:"清空",text:"清空",onClick:()=>t.clearData()},{key:"edit",iconClass:"lf-control-edit",title:"编辑",text:"编辑",onClick:()=>t.emit("custom:edit-click",{})},{key:"mini-map",iconClass:"lf-control-mini-map",title:"导航",text:"导航",onClick:()=>{const{isShow:o,show:r,hide:i}=t.extension.miniMap??{};o?i():r()}},{key:"reset",iconClass:"lf-control-reset",title:"重置",text:"重置",onClick:()=>{on.confirm("选择重置的配置","提示",{confirmButtonText:"重置表单配置",cancelButtonText:"重置按钮配置"}).then(()=>{t.emit("custom:reset-form-property",{})}).catch(()=>{t.emit("custom:reset-button",{})})}},{key:"layout",iconClass:"lf-control-layout",title:"自动布局",text:"自动布局",onClick:()=>t.extension.dagre.layout()}].forEach(o=>this.addItem(o))}}class xn{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.hiddenNodes=[],this.hiddenEdges=[],this.hiddenCombos=[],this.vedges=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(t){return this.init(t),this.execute(!0)}init(t){this.nodes=t.nodes||[],this.edges=t.edges||[],this.combos=t.combos||[],this.comboEdges=t.comboEdges||[],this.hiddenNodes=t.hiddenNodes||[],this.hiddenEdges=t.hiddenEdges||[],this.hiddenCombos=t.hiddenCombos||[],this.vedges=t.vedges||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){t&&Object.assign(this,t)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}}const En=e=>typeof e=="string",Je=Array.isArray,he=e=>typeof e=="number",bt=e=>e!==null&&typeof e=="object",pe=e=>{if(e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach(n=>{t.push(n)}),t.map(n=>pe(n))}if(typeof e=="object"&&Object.keys(e).length){const t=Object.assign({},e);return Object.keys(t).forEach(n=>{t[n]=pe(t[n])}),t}return e},ne=(e,t)=>{const n=e[t];return bt(n)?n.cell:n},Ke=(e,t,n)=>{let o;return n?o=n:he(e)?o=()=>e:o=()=>t,o},kn=(e,t)=>{if(e!=="next"&&e!=="prev")return t},Xe=e=>{e.prev.next=e.next,e.next.prev=e.prev,delete e.next,delete e.prev};let _n=class{constructor(){const t={};t.prev=t,t.next=t.prev,this.shortcut=t}dequeue(){const t=this.shortcut,n=t.prev;if(n&&n!==t)return Xe(n),n}enqueue(t){const n=this.shortcut;t.prev&&t.next&&Xe(t),t.next=n.next,n.next.prev=t,n.next=t,t.prev=n}toString(){const t=[],n=this.shortcut;let o=n.prev;for(;o!==n;)t.push(JSON.stringify(o,kn)),o=o==null?void 0:o.prev;return`[${t.join(", ")}]`}};function Qe(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Nn(e,t,n){return t&&Qe(e.prototype,t),n&&Qe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Mn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var wt=Nn(function e(){var t=this;Mn(this,e),this.arr=[],this.keyIndice=new Map,this.size=function(){return t.arr.length},this.keys=function(){return t.arr.map(function(n){return n.key})},this.has=function(n){return t.keyIndice.has(n)},this.priority=function(n){var o=t.keyIndice.get(n);if(o!==void 0)return t.arr[o].priority},this.swap=function(n,o){var r=t.arr,i=t.keyIndice,a=[r[n],r[o]],s=a[0],l=a[1];r[n]=l,r[o]=s,i.set(s.key,o),i.set(l.key,n)},this.innerDecrease=function(n){for(var o=t.arr,r=o[n].priority,i,a=n;a!==0;){var s;if(i=a>>1,((s=o[i])===null||s===void 0?void 0:s.priority)<r)break;t.swap(a,i),a=i}},this.heapify=function(n){var o=t.arr,r=n<<1,i=r+1,a=n;r<o.length&&(a=o[r].priority<o[a].priority?r:a,i<o.length&&(a=o[i].priority<o[a].priority?i:a),a!==n&&(t.swap(n,a),t.heapify(a)))},this.min=function(){if(t.size()===0)throw new Error("Queue underflow");return t.arr[0].key},this.add=function(n,o){var r=t.keyIndice,i=t.arr;if(!r.has(n)){var a=i.length;return r.set(n,a),i.push({key:n,priority:o}),t.innerDecrease(a),!0}return!1},this.removeMin=function(){t.swap(0,t.arr.length-1);var n=t.arr.pop();return t.keyIndice.delete(n.key),t.heapify(0),n.key},this.decrease=function(n,o){if(!t.has(n))throw new Error("There's no key named ".concat(n));var r=t.keyIndice.get(n);if(o>t.arr[r].priority)throw new Error("New priority is greater than current priority.Key: ".concat(n," Old: + ").concat(t.arr[r].priority," New: ").concat(o));t.arr[r].priority=o,t.innerDecrease(r)}}),In=function(t,n){var o=new ve,r=new Map,i=new wt,a;function s(c){var f=c.v===a?c.w:c.v,u=i.priority(f);if(u!==void 0){var h=n(c);h<u&&(r.set(f,a),i.decrease(f,h))}}if(t.nodeCount()===0)return o;t.nodes().forEach(function(c){i.add(c,Number.POSITIVE_INFINITY),o.setNode(c)}),i.decrease(t.nodes()[0],0);for(var l=!1;i.size()>0;){var d;if(a=i.removeMin(),r.has(a))o.setEdge(a,r.get(a));else{if(l)throw new Error("Input graph is not connected: "+t.graph());l=!0}(d=t.nodeEdges(a))===null||d===void 0||d.forEach(s)}return o},On=function(t){var n=new Set,o=[],r=t.nodes();return r.forEach(function(i){for(var a=[],s=[i];s.length>0;){var l=s.pop();if(!n.has(l)){var d,c;n.add(l),a.push(l),(d=t.successors(l))===null||d===void 0||d.forEach(function(f){return s.push(f)}),(c=t.predecessors(l))===null||c===void 0||c.forEach(function(f){return s.push(f)})}}a.length&&o.push(a)}),o},Tn=function e(t,n,o,r,i,a){r.includes(n)||(r.push(n),o||a.push(n),i(n).forEach(function(s){return e(t,s,o,r,i,a)}),o&&a.push(n))},je=function(t,n,o){var r=Array.isArray(n)?n:[n],i=function(d){return t.isDirected()?t.successors(d):t.neighbors(d)},a=[],s=[];return r.forEach(function(l){if(t.hasNode(l))Tn(t,l,o==="post",s,i,a);else throw new Error("Graph does not have node: "+l)}),a};function Ln(e,t){return Cn(e)||Dn(e,t)||Sn(e,t)||Pn()}function Pn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sn(e,t){if(e){if(typeof e=="string")return Ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ze(e,t)}}function Ze(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Dn(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var o=[],r=!0,i=!1,a,s;try{for(n=n.call(e);!(r=(a=n.next()).done)&&(o.push(a.value),!(t&&o.length===t));r=!0);}catch(l){i=!0,s=l}finally{try{!r&&n.return!=null&&n.return()}finally{if(i)throw s}}return o}}function Cn(e){if(Array.isArray(e))return e}var Rn=function(){return 1},gt=function(t,n,o,r){return Fn(t,n,o||Rn,r||function(i){return t.outEdges(i)})},Fn=function(t,n,o,r){var i=new Map,a=new wt,s,l,d=function(u){var h=u.v!==s?u.v:u.w,p=i.get(h),v=o(u),b=l.distance+v;if(v<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+u+" Weight: "+v);b<p.distance&&(p.distance=b,p.predecessor=s,a.decrease(h,b))};for(t.nodes().forEach(function(f){var u=f===n?0:Number.POSITIVE_INFINITY;i.set(f,{distance:u}),a.add(f,u)});a.size()>0&&(s=a.removeMin(),l=i.get(s),!(l&&l.distance===Number.POSITIVE_INFINITY));)r(s).forEach(d);var c={};return Array.from(i.entries()).forEach(function(f){var u=Ln(f,2),h=u[0],p=u[1];return c[String(h)]=p,c}),c},jn=function(t,n,o){var r={};return t.nodes().forEach(function(i){return r[String(i)]=gt(t,i,n,o),r}),r},xt=function(t){var n=0,o=[],r=new Map,i=[];function a(s){var l,d={onStack:!0,lowlink:n,index:n};if(r.set(s,d),n+=1,o.push(s),(l=t.successors(s))===null||l===void 0||l.forEach(function(h){var p;if(r.has(h)){if(!((p=r.get(h))===null||p===void 0)&&p.onStack){var b=r.get(h);d.lowlink=Math.min(d.lowlink,b.index)}}else{a(h);var v=r.get(h);d.lowlink=Math.min(d.lowlink,v.lowlink)}}),d.lowlink===d.index){var c=[],f;do{f=o.pop();var u=r.get(f);u.onStack=!1,c.push(f)}while(s!==f);i.push(c)}}return t.nodes().forEach(function(s){r.has(s)||a(s)}),i},An=function(t){return xt(t).filter(function(n){return n.length>1||n.length===1&&t.hasEdge(n[0],n[0])})};function Te(e){return Te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Te(e)}function et(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Vn(e,t,n){return t&&et(e.prototype,t),n&&et(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Bn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&de(e,t)}function zn(e){var t=Et();return function(){var o=ce(e),r;if(t){var i=ce(this).constructor;r=Reflect.construct(o,arguments,i)}else r=o.apply(this,arguments);return $n(this,r)}}function $n(e,t){if(t&&(Te(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wn(e)}function Wn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Le(e){var t=typeof Map=="function"?new Map:void 0;return Le=function(o){if(o===null||!Un(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(o))return t.get(o);t.set(o,r)}function r(){return fe(o,arguments,ce(this).constructor)}return r.prototype=Object.create(o.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),de(r,o)},Le(e)}function fe(e,t,n){return Et()?fe=Reflect.construct:fe=function(r,i,a){var s=[null];s.push.apply(s,i);var l=Function.bind.apply(r,s),d=new l;return a&&de(d,a.prototype),d},fe.apply(null,arguments)}function Et(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Un(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function de(e,t){return de=Object.setPrototypeOf||function(o,r){return o.__proto__=r,o},de(e,t)}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)},ce(e)}var Pe=function(e){Gn(n,e);var t=zn(n);function n(){return Bn(this,n),t.apply(this,arguments)}return Vn(n)}(Le(Error));function kt(e){var t=new Set,n=new Set,o=[];function r(i){if(n.has(i))throw new Pe;if(!t.has(i)){var a;n.add(i),t.add(i),(a=e.predecessors(i))===null||a===void 0||a.forEach(r),n.delete(i),o.push(i)}}if(e.sinks().forEach(r),t.size!==e.nodeCount())throw new Pe;return o}var qn=function(t){try{kt(t)}catch(n){if(n instanceof Pe)return!1;throw n}return!0},Yn=function(t,n){return je(t,n,"post")},Hn=function(t,n){return je(t,n,"pre")},Jn=function(){return 1};function Kn(e,t,n){return Xn(e,t||Jn,n||function(o){return e.outEdges(o)})}function Xn(e,t,n){var o={},r=e.nodes();return r.forEach(function(i){var a=String(i);o[a]={},o[a][a]={distance:0},r.forEach(function(s){i!==s&&(o[a][String(s)]={distance:Number.POSITIVE_INFINITY})}),n(i).forEach(function(s){var l=s.v===i?s.w:s.v,d=t(s);o[a][String(l)]={distance:d,predecessor:i}})}),r.forEach(function(i){var a=String(i),s=o[a];r.forEach(function(l){var d=String(l),c=o[d];r.forEach(function(f){var u=String(f),h=c[a],p=s[u],v=c[u],b=h.distance+p.distance;b<v.distance&&(v.distance=b,v.predecessor=p.predecessor)})})}),o}const Qn=Object.freeze(Object.defineProperty({__proto__:null,components:On,dfs:je,dijkstra:gt,dijkstraAll:jn,findCycles:An,floydWarshall:Kn,isAcyclic:qn,postorder:Yn,preorder:Hn,prim:In,tarjan:xt,topsort:kt},Symbol.toStringTag,{value:"Module"}));class Zn extends _n{}class eo extends ve{}const to=()=>1,no=(e,t)=>{var n;if(e.nodeCount()<=1)return[];const o=ro(e,t||to);return(n=oo(o.graph,o.buckets,o.zeroIdx).map(i=>e.outEdges(i.v,i.w)))===null||n===void 0?void 0:n.flat()},oo=(e,t,n)=>{let o=[];const r=t[t.length-1],i=t[0];let a;for(;e.nodeCount();){for(;a=i.dequeue();)be(e,t,n,a);for(;a=r.dequeue();)be(e,t,n,a);if(e.nodeCount()){for(let s=t.length-2;s>0;--s)if(a=t[s].dequeue(),a){o=o.concat(be(e,t,n,a,!0));break}}}return o},be=(e,t,n,o,r)=>{var i,a;const s=[];return(i=e.inEdges(o.v))===null||i===void 0||i.forEach(l=>{const d=e.edge(l),c=e.node(l.v);r&&s.push({v:l.v,w:l.w,in:0,out:0}),c.out===void 0&&(c.out=0),c.out-=d,Se(t,n,c)}),(a=e.outEdges(o.v))===null||a===void 0||a.forEach(l=>{const d=e.edge(l),c=l.w,f=e.node(c);f.in===void 0&&(f.in=0),f.in-=d,Se(t,n,f)}),e.removeNode(o.v),r?s:void 0},ro=(e,t)=>{const n=new eo;let o=0,r=0;e.nodes().forEach(l=>{n.setNode(l,{v:l,in:0,out:0})}),e.edges().forEach(l=>{const d=n.edge(l)||0,c=(t==null?void 0:t(l))||1,f=d+c;n.setEdge(l.v,l.w,f),r=Math.max(r,n.node(l.v).out+=c),o=Math.max(o,n.node(l.w).in+=c)});const i=[],a=r+o+3;for(let l=0;l<a;l++)i.push(new Zn);const s=o+1;return n.nodes().forEach(l=>{Se(i,s,n.node(l))}),{buckets:i,zeroIdx:s,graph:n}},Se=(e,t,n)=>{n.out?n.in?e[n.out-n.in+t].enqueue(n):e[e.length-1].enqueue(n):e[0].enqueue(n)},io=e=>{const t=o=>r=>{var i;return((i=o.edge(r))===null||i===void 0?void 0:i.weight)||1},n=e.graph().acyclicer==="greedy"?no(e,t(e)):so(e);n==null||n.forEach(o=>{const r=e.edge(o);e.removeEdgeObj(o),r.forwardName=o.name,r.reversed=!0,e.setEdge(o.w,o.v,r,`rev-${Math.random()}`)})},so=e=>{const t=[],n={},o={},r=i=>{var a;o[i]||(o[i]=!0,n[i]=!0,(a=e.outEdges(i))===null||a===void 0||a.forEach(s=>{n[s.w]?t.push(s):r(s.w)}),delete n[i])};return e.nodes().forEach(r),t},ao=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n.reversed){e.removeEdgeObj(t);const o=n.forwardName;delete n.reversed,delete n.forwardName,e.setEdge(t.w,t.v,n,o)}})},tt={run:io,undo:ao};class ee extends ve{}const lo=(e,t)=>Number(e)-Number(t),ie=(e,t,n,o)=>{let r;do r=`${o}${Math.random()}`;while(e.hasNode(r));return n.dummy=t,e.setNode(r,n),r},co=e=>{const t=new ee().setGraph(e.graph());return e.nodes().forEach(n=>{t.setNode(n,e.node(n))}),e.edges().forEach(n=>{const o=t.edgeFromArgs(n.v,n.w)||{weight:0,minlen:1},r=e.edge(n);t.setEdge(n.v,n.w,{weight:o.weight+r.weight,minlen:Math.max(o.minlen,r.minlen)})}),t},_t=e=>{const t=new ee({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(n=>{var o;!((o=e.children(n))===null||o===void 0)&&o.length||t.setNode(n,e.node(n))}),e.edges().forEach(n=>{t.setEdgeObj(n,e.edge(n))}),t},uo=(e,t)=>e==null?void 0:e.reduce((n,o,r)=>(n[o]=t[r],n),{}),nt=(e,t)=>{const n=Number(e.x),o=Number(e.y),r=Number(t.x)-n,i=Number(t.y)-o;let a=Number(e.width)/2,s=Number(e.height)/2;if(!r&&!i)return{x:0,y:0};let l,d;return Math.abs(i)*a>Math.abs(r)*s?(i<0&&(s=-s),l=s*r/i,d=s):(r<0&&(a=-a),l=a,d=a*i/r),{x:n+l,y:o+d}},ue=e=>{const t=[],n=Nt(e)+1;for(let o=0;o<n;o++)t.push([]);e.nodes().forEach(o=>{const r=e.node(o);if(!r)return;const i=r.rank;i!==void 0&&t[i]&&t[i].push(o)});for(let o=0;o<n;o++)t[o]=t[o].sort((r,i)=>{var a,s;return lo((a=e.node(r))===null||a===void 0?void 0:a.order,(s=e.node(i))===null||s===void 0?void 0:s.order)});return t},fo=e=>{const t=e.nodes().filter(o=>{var r;return((r=e.node(o))===null||r===void 0?void 0:r.rank)!==void 0}).map(o=>e.node(o).rank),n=Math.min(...t);e.nodes().forEach(o=>{const r=e.node(o);r.hasOwnProperty("rank")&&n!==1/0&&(r.rank-=n)})},ho=e=>{const t=e.nodes(),n=t.filter(s=>{var l;return((l=e.node(s))===null||l===void 0?void 0:l.rank)!==void 0}).map(s=>e.node(s).rank),o=Math.min(...n),r=[];t.forEach(s=>{var l;const d=(((l=e.node(s))===null||l===void 0?void 0:l.rank)||0)-o;r[d]||(r[d]=[]),r[d].push(s)});let i=0;const a=e.graph().nodeRankFactor||0;for(let s=0;s<r.length;s++){const l=r[s];l===void 0?s%a!==0&&(i-=1):i&&(l==null||l.forEach(d=>{const c=e.node(d);c&&(c.rank=c.rank||0,c.rank+=i)}))}},ot=(e,t,n,o)=>{const r={width:0,height:0};return he(n)&&he(o)&&(r.rank=n,r.order=o),ie(e,"border",r,t)},Nt=e=>{let t;return e.nodes().forEach(n=>{var o;const r=(o=e.node(n))===null||o===void 0?void 0:o.rank;r!==void 0&&(t===void 0||r>t)&&(t=r)}),t||(t=0),t},po=(e,t)=>{const n={lhs:[],rhs:[]};return e==null||e.forEach(o=>{t(o)?n.lhs.push(o):n.rhs.push(o)}),n},Mt=(e,t)=>{const n=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-n}ms`)}},It=(e,t)=>t(),Ae=(e,t)=>e.reduce((n,o)=>{const r=t(n),i=t(o);return r>i?o:n}),vo=e=>{e.graph().dummyChains=[],e.edges().forEach(t=>mo(e,t))},mo=(e,t)=>{let n=t.v,o=e.node(n).rank;const r=t.w,i=e.node(r).rank,a=t.name,s=e.edge(t),l=s.labelRank;if(i===o+1)return;e.removeEdgeObj(t);const d=e.graph();let c,f,u;for(u=0,++o;o<i;++u,++o)s.points=[],f={edgeLabel:s,width:0,height:0,edgeObj:t,rank:o},c=ie(e,"edge",f,"_d"),o===l&&(f.width=s.width,f.height=s.height,f.dummy="edge-label",f.labelpos=s.labelpos),e.setEdge(n,c,{weight:s.weight},a),u===0&&(d.dummyChains||(d.dummyChains=[]),d.dummyChains.push(c)),n=c;e.setEdge(n,r,{weight:s.weight},a)},yo=e=>{var t;(t=e.graph().dummyChains)===null||t===void 0||t.forEach(n=>{let o=e.node(n);const r=o.edgeLabel;let i;o.edgeObj&&e.setEdgeObj(o.edgeObj,r);let a=n;for(;o.dummy;)i=e.successors(a)[0],e.removeNode(a),r.points.push({x:o.x,y:o.y}),o.dummy==="edge-label"&&(r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height),a=i,o=e.node(a)})},rt={run:vo,undo:yo},Ot=e=>{var t;const n={},o=r=>{var i;const a=e.node(r);if(!a)return 0;if(n[r])return a.rank;n[r]=!0;let s;return(i=e.outEdges(r))===null||i===void 0||i.forEach(l=>{const d=o(l.w),c=e.edge(l).minlen,f=d-c;f&&(s===void 0||f<s)&&(s=f)}),s||(s=0),a.rank=s,s};(t=e.sources())===null||t===void 0||t.forEach(r=>o(r))},bo=e=>{var t;const n={};let o;const r=s=>{var l;const d=e.node(s);if(!d)return 0;if(n[s])return d.rank;n[s]=!0;let c;return(l=e.outEdges(s))===null||l===void 0||l.forEach(f=>{const u=r(f.w),h=e.edge(f).minlen,p=u-h;p&&(c===void 0||p<c)&&(c=p)}),c||(c=0),(o===void 0||c<o)&&(o=c),d.rank=c,c};(t=e.sources())===null||t===void 0||t.forEach(s=>{e.node(s)&&r(s)}),o===void 0&&(o=0);const i={},a=(s,l)=>{var d;const c=e.node(s),f=isNaN(c.layer)?l:c.layer;(c.rank===void 0||c.rank<f)&&(c.rank=f),!i[s]&&(i[s]=!0,(d=e.outEdges(s))===null||d===void 0||d.map(u=>{a(u.w,f+e.edge(u).minlen)}))};e.nodes().forEach(s=>{const l=e.node(s);l&&(isNaN(l.layer)?l.rank-=o:a(s,l.layer))})},te=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,wo=e=>{const t=new ee({directed:!1}),n=e.nodes()[0],o=e.nodeCount();t.setNode(n,{});let r,i;for(;go(t,e)<o;)r=Tt(t,e),i=t.hasNode(r.v)?te(e,r):-te(e,r),Lt(t,e,i);return t},go=(e,t)=>{const n=o=>{t.nodeEdges(o).forEach(r=>{const i=r.v,a=o===i?r.w:i;!e.hasNode(a)&&!te(t,r)&&(e.setNode(a,{}),e.setEdge(o,a,{}),n(a))})};return e.nodes().forEach(n),e.nodeCount()},xo=e=>{const t=new ee({directed:!1}),n=e.nodes()[0],o=e.nodes().filter(a=>!!e.node(a)).length;t.setNode(n,{});let r,i;for(;Eo(t,e)<o;)r=Tt(t,e),i=t.hasNode(r.v)?te(e,r):-te(e,r),Lt(t,e,i);return t},Eo=(e,t)=>{const n=o=>{var r;(r=t.nodeEdges(o))===null||r===void 0||r.forEach(i=>{const a=i.v,s=o===a?i.w:a;!e.hasNode(s)&&(t.node(s).layer!==void 0||!te(t,i))&&(e.setNode(s,{}),e.setEdge(o,s,{}),n(s))})};return e.nodes().forEach(n),e.nodeCount()},Tt=(e,t)=>Ae(t.edges(),n=>e.hasNode(n.v)!==e.hasNode(n.w)?te(t,n):1/0),Lt=(e,t,n)=>{e.nodes().forEach(o=>{t.node(o).rank||(t.node(o).rank=0),t.node(o).rank+=n})},{preorder:ko,postorder:_o}=Qn,No=e=>{const t=co(e);Ot(t);const n=wo(t);St(n),Pt(n,t);let o,r;for(;o=Oo(n);)r=To(n,t,o),Lo(n,t,o,r)},Pt=(e,t)=>{let n=_o(e,e.nodes());n=n==null?void 0:n.slice(0,(n==null?void 0:n.length)-1),n==null||n.forEach(o=>{Mo(e,t,o)})},Mo=(e,t,n)=>{const r=e.node(n).parent;e.edgeFromArgs(n,r).cutvalue=Io(e,t,n)},Io=(e,t,n)=>{var o;const i=e.node(n).parent;let a=!0,s=t.edgeFromArgs(n,i),l=0;return s||(a=!1,s=t.edgeFromArgs(i,n)),l=s.weight,(o=t.nodeEdges(n))===null||o===void 0||o.forEach(d=>{const c=d.v===n,f=c?d.w:d.v;if(f!==i){const u=c===a,h=t.edge(d).weight;if(l+=u?h:-h,So(e,n,f)){const p=e.edgeFromArgs(n,f).cutvalue;l+=u?-p:p}}}),l},St=(e,t=e.nodes()[0])=>{Dt(e,{},1,t)},Dt=(e,t,n,o,r)=>{var i;const a=n;let s=n;const l=e.node(o);return t[o]=!0,(i=e.neighbors(o))===null||i===void 0||i.forEach(d=>{t[d]||(s=Dt(e,t,s,d,o))}),l.low=a,l.lim=s++,r?l.parent=r:delete l.parent,s},Oo=e=>e.edges().find(t=>e.edge(t).cutvalue<0),To=(e,t,n)=>{let o=n.v,r=n.w;t.hasEdge(o,r)||(o=n.w,r=n.v);const i=e.node(o),a=e.node(r);let s=i,l=!1;i.lim>a.lim&&(s=a,l=!0);const d=t.edges().filter(c=>l===it(e,e.node(c.v),s)&&l!==it(e,e.node(c.w),s));return Ae(d,c=>te(t,c))},Lo=(e,t,n,o)=>{const r=n.v,i=n.w;e.removeEdge(r,i),e.setEdge(o.v,o.w,{}),St(e),Pt(e,t),Po(e,t)},Po=(e,t)=>{const n=e.nodes().find(r=>{var i;return!(!((i=t.node(r))===null||i===void 0)&&i.parent)});let o=ko(e,n);o=o==null?void 0:o.slice(1),o==null||o.forEach(r=>{const i=e.node(r).parent;let a=t.edgeFromArgs(r,i),s=!1;a||(a=t.edgeFromArgs(i,r),s=!0),t.node(r).rank=t.node(i).rank+(s?a.minlen:-a.minlen)})},So=(e,t,n)=>e.hasEdge(t,n),it=(e,t,n)=>n.low<=t.lim&&t.lim<=n.lim,Do=e=>{switch(e.graph().ranker){case"network-simplex":Ro(e);break;case"tight-tree":st(e);break;case"longest-path":Co(e);break;default:st(e)}},Co=Ot,st=e=>{bo(e),xo(e)},Ro=e=>{No(e)},Fo=e=>{var t;const n={};let o=0;const r=i=>{var a;const s=o;(a=e.children(i))===null||a===void 0||a.forEach(r),n[i]={low:s,lim:o++}};return(t=e.children())===null||t===void 0||t.forEach(r),n},jo=(e,t,n,o)=>{const r=[],i=[],a=Math.min(t[n].low,t[o].low),s=Math.max(t[n].lim,t[o].lim);let l,d;l=n;do l=e.parent(l),r.push(l);while(l&&(t[l].low>a||s>t[l].lim));for(d=l,l=o;l&&l!==d;)i.push(l),l=e.parent(l);return{lca:d,path:r.concat(i.reverse())}},Ao=e=>{var t;const n=Fo(e);(t=e.graph().dummyChains)===null||t===void 0||t.forEach(o=>{var r,i;let a=o,s=e.node(a);const l=s.edgeObj;if(!l)return;const d=jo(e,n,l.v,l.w),c=d.path,f=d.lca;let u=0,h=c[u],p=!0;for(;a!==l.w;){if(s=e.node(a),p){for(;h!==f&&((r=e.node(h))===null||r===void 0?void 0:r.maxRank)<s.rank;)u++,h=c[u];h===f&&(p=!1)}if(!p){for(;u<c.length-1&&((i=e.node(c[u+1]))===null||i===void 0?void 0:i.minRank)<=s.rank;)u++;h=c[u]}e.setParent(a,h),a=e.successors(a)[0]}})},Vo=e=>{var t;const n=ie(e,"root",{},"_root"),o=Bo(e);let r=Math.max(...Object.values(o));Math.abs(r)===1/0&&(r=1);const i=r-1,a=2*i+1;e.graph().nestingRoot=n,e.edges().forEach(l=>{e.edge(l).minlen*=a});const s=Go(e)+1;(t=e.children())===null||t===void 0||t.forEach(l=>{Ct(e,n,a,s,i,o,l)}),e.graph().nodeRankFactor=a},Ct=(e,t,n,o,r,i,a)=>{const s=e.children(a);if(!(s!=null&&s.length)){a!==t&&e.setEdge(t,a,{weight:0,minlen:n});return}const l=ot(e,"_bt"),d=ot(e,"_bb"),c=e.node(a);e.setParent(l,a),c.borderTop=l,e.setParent(d,a),c.borderBottom=d,s==null||s.forEach(f=>{Ct(e,t,n,o,r,i,f);const u=e.node(f),h=u.borderTop?u.borderTop:f,p=u.borderBottom?u.borderBottom:f,v=u.borderTop?o:2*o,b=h!==p?1:r-i[a]+1;e.setEdge(l,h,{minlen:b,weight:v,nestingEdge:!0}),e.setEdge(p,d,{minlen:b,weight:v,nestingEdge:!0})}),e.parent(a)||e.setEdge(t,l,{weight:0,minlen:r+i[a]})},Bo=e=>{var t;const n={},o=(r,i)=>{const a=e.children(r);a==null||a.forEach(s=>o(s,i+1)),n[r]=i};return(t=e.children())===null||t===void 0||t.forEach(r=>o(r,1)),n},Go=e=>{let t=0;return e.edges().forEach(n=>{t+=e.edge(n).weight}),t},zo=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(n=>{e.edge(n).nestingEdge&&e.removeEdgeObj(n)})},at={run:Vo,cleanup:zo},$o=e=>{var t;const n=o=>{const r=e.children(o),i=e.node(o);if(r!=null&&r.length&&r.forEach(a=>n(a)),i.hasOwnProperty("minRank")){i.borderLeft=[],i.borderRight=[];for(let a=i.minRank,s=i.maxRank+1;a<s;a+=1)lt(e,"borderLeft","_bl",o,i,a),lt(e,"borderRight","_br",o,i,a)}};(t=e.children())===null||t===void 0||t.forEach(o=>n(o))},lt=(e,t,n,o,r,i)=>{const a={rank:i,borderType:t,width:0,height:0},s=r[t][i-1],l=ie(e,"border",a,n);r[t][i]=l,e.setParent(l,o),s&&e.setEdge(s,l,{weight:1})},Wo=e=>{var t;const n=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(n==="lr"||n==="rl")&&Rt(e)},Uo=e=>{var t;const n=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(n==="bt"||n==="rl")&&qo(e),(n==="lr"||n==="rl")&&(Yo(e),Rt(e))},Rt=e=>{e.nodes().forEach(t=>{dt(e.node(t))}),e.edges().forEach(t=>{dt(e.edge(t))})},dt=e=>{const t=e.width;e.width=e.height,e.height=t},qo=e=>{e.nodes().forEach(t=>{we(e.node(t))}),e.edges().forEach(t=>{var n;const o=e.edge(t);(n=o.points)===null||n===void 0||n.forEach(r=>we(r)),o.hasOwnProperty("y")&&we(o)})},we=e=>{e!=null&&e.y&&(e.y=-e.y)},Yo=e=>{e.nodes().forEach(t=>{ge(e.node(t))}),e.edges().forEach(t=>{var n;const o=e.edge(t);(n=o.points)===null||n===void 0||n.forEach(r=>ge(r)),o.hasOwnProperty("x")&&ge(o)})},ge=e=>{const t=e.x;e.x=e.y,e.y=t},ct={adjust:Wo,undo:Uo};var Ho={}.toString,Jo=function(e,t){return Ho.call(e)==="[object "+t+"]"};const Ko=Jo,Ft=function(e){return Array.isArray?Array.isArray(e):Ko(e,"Array")},De=function(e){if(Ft(e))return e.reduce(function(t,n){return Math.max(t,n)},e[0])},ut=function(e){if(Ft(e))return e.reduce(function(t,n){return Math.min(t,n)},e[0])},ft=e=>{const t={},n=e.nodes().filter(c=>{var f;return!(!((f=e.children(c))===null||f===void 0)&&f.length)}),o=n.map(c=>e.node(c).rank),r=De(o),i=[];for(let c=0;c<r+1;c++)i.push([]);const a=c=>{var f;if(t.hasOwnProperty(c))return;t[c]=!0;const u=e.node(c);isNaN(u.rank)||i[u.rank].push(c),(f=e.successors(c))===null||f===void 0||f.forEach(h=>a(h))},s=n.sort((c,f)=>e.node(c).rank-e.node(f).rank),d=s.filter(c=>e.node(c).fixorder!==void 0).sort((c,f)=>e.node(c).fixorder-e.node(f).fixorder);return d==null||d.forEach(c=>{isNaN(e.node(c).rank)||i[e.node(c).rank].push(c),t[c]=!0}),s==null||s.forEach(a),i},Xo=(e,t,n)=>{const o=uo(n,n.map((c,f)=>f)),i=t.map(c=>{var f;const u=(f=e.outEdges(c))===null||f===void 0?void 0:f.map(h=>({pos:o[h.w]||0,weight:e.edge(h).weight}));return u==null?void 0:u.sort((h,p)=>h.pos-p.pos)}).flat().filter(c=>c!==void 0);let a=1;for(;a<n.length;)a<<=1;const s=2*a-1;a-=1;const l=Array(s).fill(0,0,s);let d=0;return i==null||i.forEach(c=>{if(c){let f=c.pos+a;l[f]+=c.weight;let u=0;for(;f>0;)f%2&&(u+=l[f+1]),f=f-1>>1,l[f]+=c.weight;d+=c.weight*u}}),d},ht=(e,t)=>{let n=0;for(let o=1;o<(t==null?void 0:t.length);o+=1)n+=Xo(e,t[o-1],t[o]);return n},Qo=(e,t,n)=>{const o=Zo(e),r=new ee({compound:!0}).setGraph({root:o}).setDefaultNodeLabel(i=>e.node(i));return e.nodes().forEach(i=>{var a;const s=e.node(i),l=e.parent(i);(s.rank===t||s.minRank<=t&&t<=s.maxRank)&&(r.setNode(i),r.setParent(i,l||o),(a=e[n](i))===null||a===void 0||a.forEach(d=>{const c=d.v===i?d.w:d.v,f=r.edgeFromArgs(c,i),u=f!==void 0?f.weight:0;r.setEdge(c,i,{weight:e.edge(d).weight+u})}),s.hasOwnProperty("minRank")&&r.setNode(i,{borderLeft:s.borderLeft[t],borderRight:s.borderRight[t]}))}),r},Zo=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},er=(e,t,n)=>{const o={};let r;n==null||n.forEach(i=>{let a=e.parent(i),s,l;for(;a;){if(s=e.parent(a),s?(l=o[s],o[s]=a):(l=r,r=a),l&&l!==a){t.setEdge(l,a);return}a=s}})},tr=(e,t)=>t.map(n=>{const o=e.inEdges(n);if(!(o!=null&&o.length))return{v:n};{const r={sum:0,weight:0};return o==null||o.forEach(i=>{const a=e.edge(i),s=e.node(i.v);r.sum+=a.weight*s.order,r.weight+=a.weight}),{v:n,barycenter:r.sum/r.weight,weight:r.weight}}}),nr=(e,t)=>{var n,o,r;const i={};e==null||e.forEach((s,l)=>{i[s.v]={i:l,indegree:0,in:[],out:[],vs:[s.v]};const d=i[s.v];s.barycenter!==void 0&&(d.barycenter=s.barycenter,d.weight=s.weight)}),(n=t.edges())===null||n===void 0||n.forEach(s=>{const l=i[s.v],d=i[s.w];l!==void 0&&d!==void 0&&(d.indegree++,l.out.push(i[s.w]))});const a=(r=(o=Object.values(i)).filter)===null||r===void 0?void 0:r.call(o,s=>!s.indegree);return or(a)},or=e=>{var t,n;const o=[],r=l=>d=>{d.merged||(d.barycenter===void 0||l.barycenter===void 0||d.barycenter>=l.barycenter)&&rr(l,d)},i=l=>d=>{d.in.push(l),--d.indegree===0&&e.push(d)};for(;e!=null&&e.length;){const l=e.pop();o.push(l),(t=l.in.reverse())===null||t===void 0||t.forEach(d=>r(l)(d)),(n=l.out)===null||n===void 0||n.forEach(d=>i(l)(d))}const a=o.filter(l=>!l.merged),s=["vs","i","barycenter","weight"];return a.map(l=>{const d={};return s==null||s.forEach(c=>{l[c]!==void 0&&(d[c]=l[c])}),d})},rr=(e,t)=>{var n;let o=0,r=0;e.weight&&(o+=e.barycenter*e.weight,r+=e.weight),t.weight&&(o+=t.barycenter*t.weight,r+=t.weight),e.vs=(n=t.vs)===null||n===void 0?void 0:n.concat(e.vs),e.barycenter=o/r,e.weight=r,e.i=Math.min(t.i,e.i),t.merged=!0},ir=(e,t,n,o)=>{const r=po(e,u=>{const h=u.hasOwnProperty("fixorder")&&!isNaN(u.fixorder);return o?!h&&u.hasOwnProperty("barycenter"):h||u.hasOwnProperty("barycenter")}),i=r.lhs,a=r.rhs.sort((u,h)=>-u.i- -h.i),s=[];let l=0,d=0,c=0;i==null||i.sort(sr(!!t,!!n)),c=pt(s,a,c),i==null||i.forEach(u=>{var h;c+=(h=u.vs)===null||h===void 0?void 0:h.length,s.push(u.vs),l+=u.barycenter*u.weight,d+=u.weight,c=pt(s,a,c)});const f={vs:s.flat()};return d&&(f.barycenter=l/d,f.weight=d),f},pt=(e,t,n)=>{let o=n,r;for(;t.length&&(r=t[t.length-1]).i<=o;)t.pop(),e==null||e.push(r.vs),o++;return o},sr=(e,t)=>(n,o)=>{if(n.fixorder!==void 0&&o.fixorder!==void 0)return n.fixorder-o.fixorder;if(n.barycenter<o.barycenter)return-1;if(n.barycenter>o.barycenter)return 1;if(t&&n.order!==void 0&&o.order!==void 0){if(n.order<o.order)return-1;if(n.order>o.order)return 1}return e?o.i-n.i:n.i-o.i},jt=(e,t,n,o,r,i)=>{var a,s,l,d;let c=e.children(t);const f=e.node(t),u=f?f.borderLeft:void 0,h=f?f.borderRight:void 0,p={};u&&(c=c==null?void 0:c.filter(M=>M!==u&&M!==h));const v=tr(e,c||[]);v==null||v.forEach(M=>{var P;if(!((P=e.children(M.v))===null||P===void 0)&&P.length){const A=jt(e,M.v,n,o,i);p[M.v]=A,A.hasOwnProperty("barycenter")&&lr(M,A)}});const b=nr(v,n);ar(b,p),(a=b.filter(M=>M.vs.length>0))===null||a===void 0||a.forEach(M=>{const P=e.node(M.vs[0]);P&&(M.fixorder=P.fixorder,M.order=P.order)});const w=ir(b,o,r,i);if(u&&(w.vs=[u,w.vs,h].flat(),!((s=e.predecessors(u))===null||s===void 0)&&s.length)){const M=e.node(((l=e.predecessors(u))===null||l===void 0?void 0:l[0])||""),P=e.node(((d=e.predecessors(h))===null||d===void 0?void 0:d[0])||"");w.hasOwnProperty("barycenter")||(w.barycenter=0,w.weight=0),w.barycenter=(w.barycenter*w.weight+M.order+P.order)/(w.weight+2),w.weight+=2}return w},ar=(e,t)=>{e==null||e.forEach(n=>{var o;const r=(o=n.vs)===null||o===void 0?void 0:o.map(i=>t[i]?t[i].vs:i);n.vs=r.flat()})},lr=(e,t)=>{e.barycenter!==void 0?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},dr=(e,t)=>{const n=Nt(e),o=[],r=[];for(let c=1;c<n+1;c++)o.push(c);for(let c=n-1;c>-1;c--)r.push(c);const i=vt(e,o,"inEdges"),a=vt(e,r,"outEdges");let s=ft(e);xe(e,s);let l=Number.POSITIVE_INFINITY,d;for(let c=0,f=0;f<4;++c,++f){mt(c%2?i:a,c%4>=2,!1,t),s=ue(e);const u=ht(e,s);u<l&&(f=0,d=pe(s),l=u)}s=ft(e),xe(e,s);for(let c=0,f=0;f<4;++c,++f){mt(c%2?i:a,c%4>=2,!0,t),s=ue(e);const u=ht(e,s);u<l&&(f=0,d=pe(s),l=u)}xe(e,d)},vt=(e,t,n)=>t.map(o=>Qo(e,o,n)),mt=(e,t,n,o)=>{const r=new ee;e==null||e.forEach(i=>{var a;const s=i.graph().root,l=jt(i,s,r,t,n,o);for(let d=0;d<((a=l.vs)===null||a===void 0?void 0:a.length);d++){const c=i.node(l.vs[d]);c&&(c.order=d)}er(i,r,l.vs)})},xe=(e,t)=>{t==null||t.forEach(n=>{n==null||n.forEach((o,r)=>{e.node(o).order=r})})};class cr extends ve{}const ur=(e,t)=>{const n={},o=(r,i)=>{let a=0,s=0;const l=r.length,d=i==null?void 0:i[(i==null?void 0:i.length)-1];return i==null||i.forEach((c,f)=>{var u;const h=hr(e,c),p=h?e.node(h).order:l;(h||c===d)&&((u=i.slice(s,f+1))===null||u===void 0||u.forEach(v=>{var b;(b=e.predecessors(v))===null||b===void 0||b.forEach(w=>{var M;const P=e.node(w),A=P.order;(A<a||p<A)&&!(P.dummy&&(!((M=e.node(v))===null||M===void 0)&&M.dummy))&&At(n,w,v)})}),s=f+1,a=p)}),i};return t!=null&&t.length&&t.reduce(o),n},fr=(e,t)=>{const n={};function o(s,l,d,c,f){var u,h;let p;for(let v=l;v<d;v++)p=s[v],!((u=e.node(p))===null||u===void 0)&&u.dummy&&((h=e.predecessors(p))===null||h===void 0||h.forEach(b=>{const w=e.node(b);w.dummy&&(w.order<c||w.order>f)&&At(n,b,p)}))}function r(s){return JSON.stringify(s.slice(1))}function i(s,l){const d=r(s);l.get(d)||(o(...s),l.set(d,!0))}const a=(s,l)=>{let d=-1,c,f=0;const u=new Map;return l==null||l.forEach((h,p)=>{var v;if(((v=e.node(h))===null||v===void 0?void 0:v.dummy)==="border"){const b=e.predecessors(h)||[];b.length&&(c=e.node(b[0]).order,i([l,f,p,d,c],u),f=p,d=c)}i([l,f,l.length,c,s.length],u)}),l};return t!=null&&t.length&&t.reduce(a),n},hr=(e,t)=>{var n,o;if(!((n=e.node(t))===null||n===void 0)&&n.dummy)return(o=e.predecessors(t))===null||o===void 0?void 0:o.find(r=>e.node(r).dummy)},At=(e,t,n)=>{let o=t,r=n;if(o>r){const a=o;o=r,r=a}let i=e[o];i||(e[o]=i={}),i[r]=!0},pr=(e,t,n)=>{let o=t,r=n;if(o>r){const i=t;o=r,r=i}return!!e[o]},vr=(e,t,n,o)=>{const r={},i={},a={};return t==null||t.forEach(s=>{s==null||s.forEach((l,d)=>{r[l]=l,i[l]=l,a[l]=d})}),t==null||t.forEach(s=>{let l=-1;s==null||s.forEach(d=>{let c=o(d);if(c.length){c=c.sort((u,h)=>a[u]-a[h]);const f=(c.length-1)/2;for(let u=Math.floor(f),h=Math.ceil(f);u<=h;++u){const p=c[u];i[d]===d&&l<a[p]&&!pr(n,d,p)&&(i[p]=d,i[d]=r[d]=r[p],l=a[p])}}})}),{root:r,align:i}},mr=(e,t,n,o,r)=>{var i;const a={},s=yr(e,t,n,r),l=r?"borderLeft":"borderRight",d=(u,h)=>{let p=s.nodes(),v=p.pop();const b={};for(;v;)b[v]?u(v):(b[v]=!0,p.push(v),p=p.concat(h(v))),v=p.pop()},c=u=>{a[u]=(s.inEdges(u)||[]).reduce((h,p)=>Math.max(h,(a[p.v]||0)+s.edge(p)),0)},f=u=>{const h=(s.outEdges(u)||[]).reduce((v,b)=>Math.min(v,(a[b.w]||0)-s.edge(b)),Number.POSITIVE_INFINITY),p=e.node(u);h!==Number.POSITIVE_INFINITY&&p.borderType!==l&&(a[u]=Math.max(a[u],h))};return d(c,s.predecessors.bind(s)),d(f,s.successors.bind(s)),(i=Object.values(o))===null||i===void 0||i.forEach(u=>{a[u]=a[n[u]]}),a},yr=(e,t,n,o)=>{const r=new cr,i=e.graph(),a=xr(i.nodesep,i.edgesep,o);return t==null||t.forEach(s=>{let l;s==null||s.forEach(d=>{const c=n[d];if(r.setNode(c),l){const f=n[l],u=r.edgeFromArgs(f,c);r.setEdge(f,c,Math.max(a(e,d,l),u||0))}l=d})}),r},br=(e,t)=>Ae(Object.values(t),n=>{var o;let r=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;return(o=Object.keys(n))===null||o===void 0||o.forEach(a=>{const s=n[a],l=Er(e,a)/2;r=Math.max(s+l,r),i=Math.min(s-l,i)}),r-i});function wr(e,t){const n=Object.values(t),o=ut(n),r=De(n);["u","d"].forEach(i=>{["l","r"].forEach(a=>{const s=i+a,l=e[s];let d;if(l===t)return;const c=Object.values(l);d=a==="l"?o-ut(c):r-De(c),d&&(e[s]={},Object.keys(l).forEach(f=>{e[s][f]=l[f]+d}))})})}const gr=(e,t)=>{const n={};return Object.keys(e.ul).forEach(o=>{if(t)n[o]=e[t.toLowerCase()][o];else{const r=Object.values(e).map(i=>i[o]);n[o]=(r[0]+r[1])/2}}),n},xr=(e,t,n)=>(o,r,i)=>{const a=o.node(r),s=o.node(i);let l=0,d;if(l+=a.width/2,a.hasOwnProperty("labelpos"))switch((a.labelpos||"").toLowerCase()){case"l":d=-a.width/2;break;case"r":d=a.width/2;break}if(d&&(l+=n?d:-d),d=0,l+=(a.dummy?t:e)/2,l+=(s.dummy?t:e)/2,l+=s.width/2,s.labelpos)switch((s.labelpos||"").toLowerCase()){case"l":d=s.width/2;break;case"r":d=-s.width/2;break}return d&&(l+=n?d:-d),d=0,l},Er=(e,t)=>e.node(t).width||0,kr=e=>{const t=ue(e),n=e.graph().ranksep;let o=0;t==null||t.forEach(r=>{const i=r.map(s=>e.node(s).height),a=Math.max(...i,0);r==null||r.forEach(s=>{e.node(s).y=o+a/2}),o+=a+n})},_r=e=>{const t=ue(e),n=Object.assign(ur(e,t),fr(e,t)),o={};let r=[];["u","d"].forEach(a=>{r=a==="u"?t:Object.values(t).reverse(),["l","r"].forEach(s=>{s==="r"&&(r=r.map(f=>Object.values(f).reverse()));const l=(a==="u"?e.predecessors:e.successors).bind(e),d=vr(e,r,n,l),c=mr(e,r,d.root,d.align,s==="r");s==="r"&&Object.keys(c).forEach(f=>c[f]=-c[f]),o[a+s]=c})});const i=br(e,o);return i&&wr(o,i),gr(o,e.graph().align)},Nr=e=>{var t;const n=_t(e);kr(n);const o=_r(n);(t=Object.keys(o))===null||t===void 0||t.forEach(r=>{n.node(r).x=o[r]})},Mr=(e,t)=>{const o=e.nodes().filter(a=>{var s;return!(!((s=e.children(a))===null||s===void 0)&&s.length)}).map(a=>e.node(a).rank),r=Math.max(...o),i=[];for(let a=0;a<r+1;a++)i[a]=[];t==null||t.forEach(a=>{const s=e.node(a);!s||s!=null&&s.dummy||isNaN(s.rank)||(s.fixorder=i[s.rank].length,i[s.rank].push(a))})},Ir=(e,t)=>{const n=t&&t.debugTiming?Mt:It;n("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&n("  inheritOrder",()=>{Tr(e,t.prevGraph)});const o=n("  buildLayoutGraph",()=>jr(e));t&&t.edgeLabelSpace===!1||n("  makeSpaceForEdgeLabels",()=>{Ar(o)});try{n("  runLayout",()=>{Or(o,n,t)})}catch(r){if(r.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,r);return}throw r}n("  updateInputGraph",()=>{Lr(e,o)})})},Or=(e,t,n)=>{t("    removeSelfEdges",()=>{Yr(e)}),t("    acyclic",()=>{tt.run(e)}),t("    nestingGraph.run",()=>{at.run(e)}),t("    rank",()=>{Do(_t(e))}),t("    injectEdgeLabelProxies",()=>{Vr(e)}),t("    removeEmptyRanks",()=>{ho(e)}),t("    nestingGraph.cleanup",()=>{at.cleanup(e)}),t("    normalizeRanks",()=>{fo(e)}),t("    assignRankMinMax",()=>{Br(e)}),t("    removeEdgeLabelProxies",()=>{Gr(e)}),t("    normalize.run",()=>{rt.run(e)}),t("    parentDummyChains",()=>{Ao(e)}),t("    addBorderSegments",()=>{$o(e)}),n&&n.keepNodeOrder&&t("    initDataOrder",()=>{Mr(e,n.nodeOrder)}),t("    order",()=>{dr(e,n==null?void 0:n.keepNodeOrder)}),t("    insertSelfEdges",()=>{Hr(e)}),t("    adjustCoordinateSystem",()=>{ct.adjust(e)}),t("    position",()=>{Nr(e)}),t("    positionSelfEdges",()=>{Jr(e)}),t("    removeBorderNodes",()=>{qr(e)}),t("    normalize.undo",()=>{rt.undo(e)}),t("    fixupEdgeLabelCoords",()=>{Wr(e)}),t("    undoCoordinateSystem",()=>{ct.undo(e)}),t("    translateGraph",()=>{zr(e)}),t("    assignNodeIntersects",()=>{$r(e)}),t("    reversePoints",()=>{Ur(e)}),t("    acyclic.undo",()=>{tt.undo(e)})},Tr=(e,t)=>{e.nodes().forEach(n=>{const o=e.node(n),r=t.node(n);r!==void 0?(o.fixorder=r._order,delete r._order):delete o.fixorder})},Lr=(e,t)=>{e.nodes().forEach(n=>{var o;const r=e.node(n);if(r){const i=t.node(n);r.x=i.x,r.y=i.y,r._order=i.order,r._rank=i.rank,!((o=t.children(n))===null||o===void 0)&&o.length&&(r.width=i.width,r.height=i.height)}}),e.edges().forEach(n=>{const o=e.edge(n),r=t.edge(n);o.points=r?r.points:[],r&&r.hasOwnProperty("x")&&(o.x=r.x,o.y=r.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},Pr=["nodesep","edgesep","ranksep","marginx","marginy"],Sr={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Ee=["acyclicer","ranker","rankdir","align"],Dr=["width","height","layer","fixorder"],Cr={width:0,height:0},Rr=["minlen","weight","width","height","labeloffset"],Fr={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},ke=["labelpos"],jr=e=>{const t=new ee({multigraph:!0,compound:!0}),n=Ne(e.graph()),o={};return Ee==null||Ee.forEach(r=>{n[r]!==void 0&&(o[r]=n[r])}),t.setGraph(Object.assign({},Sr,_e(n,Pr),o)),e.nodes().forEach(r=>{const i=Ne(e.node(r)),a=Object.assign(Object.assign({},Cr),i),s=_e(a,Dr);t.setNode(r,s),t.setParent(r,e.parent(r))}),e.edges().forEach(r=>{const i=Ne(e.edge(r)),a={};ke==null||ke.forEach(s=>{i[s]!==void 0&&(a[s]=i[s])}),t.setEdgeObj(r,Object.assign({},Fr,_e(i,Rr),a))}),t},Ar=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach(n=>{const o=e.node(n);isNaN(o.layer)||o.layer||(o.layer=0)}),e.edges().forEach(n=>{var o;const r=e.edge(n);r.minlen*=2,((o=r.labelpos)===null||o===void 0?void 0:o.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?r.width+=r.labeloffset:r.height+=r.labeloffset)})},Vr=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n.width&&n.height){const o=e.node(t.v),r=e.node(t.w),i={e:t,rank:(r.rank-o.rank)/2+o.rank};ie(e,"edge-proxy",i,"_ep")}})},Br=e=>{let t=0;e.nodes().forEach(n=>{var o,r;const i=e.node(n);i.borderTop&&(i.minRank=(o=e.node(i.borderTop))===null||o===void 0?void 0:o.rank,i.maxRank=(r=e.node(i.borderBottom))===null||r===void 0?void 0:r.rank,t=Math.max(t,i.maxRank||-1/0))}),e.graph().maxRank=t},Gr=e=>{e.nodes().forEach(t=>{const n=e.node(t);n.dummy==="edge-proxy"&&(e.edge(n.e).labelRank=n.rank,e.removeNode(t))})},zr=e=>{let t,n=0,o,r=0;const i=e.graph(),a=i.marginx||0,s=i.marginy||0,l=d=>{if(!d)return;const c=d.x,f=d.y,u=d.width,h=d.height;!isNaN(c)&&!isNaN(u)&&(t===void 0&&(t=c-u/2),t=Math.min(t,c-u/2),n=Math.max(n,c+u/2)),!isNaN(f)&&!isNaN(h)&&(o===void 0&&(o=f-h/2),o=Math.min(o,f-h/2),r=Math.max(r,f+h/2))};e.nodes().forEach(d=>{l(e.node(d))}),e.edges().forEach(d=>{const c=e.edge(d);c!=null&&c.hasOwnProperty("x")&&l(c)}),t-=a,o-=s,e.nodes().forEach(d=>{const c=e.node(d);c&&(c.x-=t,c.y-=o)}),e.edges().forEach(d=>{var c;const f=e.edge(d);(c=f.points)===null||c===void 0||c.forEach(u=>{u.x-=t,u.y-=o}),f.hasOwnProperty("x")&&(f.x-=t),f.hasOwnProperty("y")&&(f.y-=o)}),i.width=n-t+a,i.height=r-o+s},$r=e=>{e.edges().forEach(t=>{const n=e.edge(t),o=e.node(t.v),r=e.node(t.w);let i,a;n.points?(i=n.points[0],a=n.points[n.points.length-1]):(n.points=[],i=r,a=o),n.points.unshift(nt(o,i)),n.points.push(nt(r,a))})},Wr=e=>{e.edges().forEach(t=>{const n=e.edge(t);if(n!=null&&n.hasOwnProperty("x"))switch((n.labelpos==="l"||n.labelpos==="r")&&(n.width-=n.labeloffset),n.labelpos){case"l":n.x-=n.width/2+n.labeloffset;break;case"r":n.x+=n.width/2+n.labeloffset;break}})},Ur=e=>{e.edges().forEach(t=>{var n;const o=e.edge(t);o.reversed&&((n=o.points)===null||n===void 0||n.reverse())})},qr=e=>{e.nodes().forEach(t=>{var n,o,r;if(!((n=e.children(t))===null||n===void 0)&&n.length){const i=e.node(t),a=e.node(i.borderTop),s=e.node(i.borderBottom),l=e.node(i.borderLeft[((o=i.borderLeft)===null||o===void 0?void 0:o.length)-1]),d=e.node(i.borderRight[((r=i.borderRight)===null||r===void 0?void 0:r.length)-1]);i.width=Math.abs((d==null?void 0:d.x)-(l==null?void 0:l.x))||10,i.height=Math.abs((s==null?void 0:s.y)-(a==null?void 0:a.y))||10,i.x=((l==null?void 0:l.x)||0)+i.width/2,i.y=((a==null?void 0:a.y)||0)+i.height/2}}),e.nodes().forEach(t=>{var n;((n=e.node(t))===null||n===void 0?void 0:n.dummy)==="border"&&e.removeNode(t)})},Yr=e=>{e.edges().forEach(t=>{if(t.v===t.w){const n=e.node(t.v);n.selfEdges||(n.selfEdges=[]),n.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdgeObj(t)}})},Hr=e=>{const t=ue(e);t==null||t.forEach(n=>{let o=0;n==null||n.forEach((r,i)=>{var a;const s=e.node(r);s.order=i+o,(a=s.selfEdges)===null||a===void 0||a.forEach(l=>{ie(e,"selfedge",{width:l.label.width,height:l.label.height,rank:s.rank,order:i+ ++o,e:l.e,label:l.label},"_se")}),delete s.selfEdges})})},Jr=e=>{e.nodes().forEach(t=>{const n=e.node(t);if(n.dummy==="selfedge"){const o=e.node(n.e.v),r=o.x+o.width/2,i=o.y,a=n.x-r,s=o.height/2;e.setEdgeObj(n.e,n.label),e.removeNode(t),n.label.points=[{x:r+2*a/3,y:i-s},{x:r+5*a/6,y:i-s},{y:i,x:r+a},{x:r+5*a/6,y:i+s},{x:r+2*a/3,y:i+s}],n.label.x=n.x,n.label.y=n.y}})},_e=(e,t)=>{const n={};return t==null||t.forEach(o=>{e[o]!==void 0&&(n[o]=+e[o])}),n},Ne=(e={})=>{const t={};return Object.keys(e).forEach(n=>{t[n.toLowerCase()]=e[n]}),t},Kr={layout:Ir,util:{time:Mt,notime:It}};class Xr extends xn{constructor(t){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.radial=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=n=>{const o=this,{nodes:r}=o,i=r.find(a=>a.id===n);return i?i.layout!==!1:!0},this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1,radial:!1,focusNode:null}}execute(){var t,n,o,r;const i=this,{nodes:a,nodeSize:s,rankdir:l,combos:d,begin:c,radial:f,comboEdges:u=[],vedges:h=[]}=i;if(!a)return;const p=i.edges||[],v=new ee({multigraph:!0,compound:!0});i.nodeMap={};const b={};a.forEach(m=>{i.nodeMap[m.id]=m,m.comboId&&(b[m.comboId]=b[m.comboId]||[],b[m.comboId].push(m.id))});let w=[];const M={};!((t=i.nodeOrder)===null||t===void 0)&&t.length?(i.nodeOrder.forEach(m=>{M[m]=!0,w.push(i.nodeMap[m])}),a.forEach(m=>{M[m.id]||w.push(m)})):w=a;let P;s?Je(s)?P=()=>s:P=()=>[s,s]:P=m=>m.size?Je(m.size)?m.size:bt(m.size)?[m.size.width||40,m.size.height||40]:[m.size,m.size]:[40,40];const A=Ke(i.ranksep,50,i.ranksepFunc),J=Ke(i.nodesep,50,i.nodesepFunc);let y=J,N=A;(l==="LR"||l==="RL")&&(y=A,N=J),v.setDefaultEdgeLabel(()=>({})),v.setGraph(i);const L={};this.sortByCombo&&d&&d.forEach(m=>{if(L[m.id]=m,m.collapsed){const T=P(m),S=N(m),O=y(m),R=T[0]+2*O,x=T[1]+2*S;v.setNode(m.id,{width:R,height:x})}m.parentId&&(L[m.parentId]||v.setNode(m.parentId,{}),v.setParent(m.id,m.parentId))}),w.filter(m=>m.layout!==!1).forEach(m=>{const T=P(m),S=N(m),O=y(m),R=T[0]+2*O,x=T[1]+2*S,_=m.layer;he(_)?v.setNode(m.id,{width:R,height:x,layer:_}):v.setNode(m.id,{width:R,height:x}),this.sortByCombo&&m.comboId&&(L[m.comboId]||(L[m.comboId]={id:m.comboId},v.setNode(m.comboId,{})),v.setParent(m.id,m.comboId))}),p.forEach(m=>{const T=ne(m,"source"),S=ne(m,"target");this.layoutNode(T)&&this.layoutNode(S)&&v.setEdge(T,S,{weight:m.weight||1})}),(n=u==null?void 0:u.concat(h||[]))===null||n===void 0||n.forEach(m=>{var T,S;const{source:O,target:R}=m,x=!((T=L[O])===null||T===void 0)&&T.collapsed?[O]:b[O]||[O],_=!((S=L[R])===null||S===void 0)&&S.collapsed?[R]:b[R]||[R];x.forEach(E=>{_.forEach(I=>{v.setEdge(E,I,{weight:m.weight||1})})})});let j;!((o=i.preset)===null||o===void 0)&&o.nodes&&(j=new ee({multigraph:!0,compound:!0}),i.preset.nodes.forEach(m=>{j==null||j.setNode(m.id,m)})),Kr.layout(v,{prevGraph:j,edgeLabelSpace:i.edgeLabelSpace,keepNodeOrder:!!i.nodeOrder,nodeOrder:i.nodeOrder});const C=[0,0];if(c){let m=1/0,T=1/0;v.nodes().forEach(S=>{const O=v.node(S);m>O.x&&(m=O.x),T>O.y&&(T=O.y)}),v.edges().forEach(S=>{var O;(O=v.edge(S).points)===null||O===void 0||O.forEach(x=>{m>x.x&&(m=x.x),T>x.y&&(T=x.y)})}),C[0]=c[0]-m,C[1]=c[1]-T}const W=l==="LR"||l==="RL";if(f){const{focusNode:m,ranksep:T,getRadialPos:S}=this,O=En(m)?m:m==null?void 0:m.id,R=O?(r=v.node(O))===null||r===void 0?void 0:r._rank:0,x=[],_=W?"y":"x",E=W?"height":"width";let I=1/0,V=-1/0;v.nodes().forEach(g=>{const k=v.node(g);if(!i.nodeMap[g])return;const z=J(i.nodeMap[g]);if(R===0)x[k._rank]||(x[k._rank]={nodes:[],totalWidth:0,maxSize:-1/0}),x[k._rank].nodes.push(g),x[k._rank].totalWidth+=z*2+k[E],x[k._rank].maxSize<Math.max(k.width,k.height)&&(x[k._rank].maxSize=Math.max(k.width,k.height));else{const D=k._rank-R;if(D===0)x[D]||(x[D]={nodes:[],totalWidth:0,maxSize:-1/0}),x[D].nodes.push(g),x[D].totalWidth+=z*2+k[E],x[D].maxSize<Math.max(k.width,k.height)&&(x[D].maxSize=Math.max(k.width,k.height));else{const F=Math.abs(D);x[F]||(x[F]={left:[],right:[],totalWidth:0,maxSize:-1/0}),x[F].totalWidth+=z*2+k[E],x[F].maxSize<Math.max(k.width,k.height)&&(x[F].maxSize=Math.max(k.width,k.height)),D<0?x[F].left.push(g):x[F].right.push(g)}}const Y=k[_]-k[E]/2-z,$=k[_]+k[E]/2+z;Y<I&&(I=Y),$>V&&(V=$)});let B=T||50;const G={},K=(V-I)/.9,Ve=[(I+V-K)*.5,(I+V+K)*.5],me=(g,k,z=-1/0,Y=[0,1])=>{let $=z;return g.forEach(D=>{const F=v.node(D);G[D]=k;const{x:X,y:U}=S(F[_],Ve,K,k,Y);if(!i.nodeMap[D])return;i.nodeMap[D].x=X+C[0],i.nodeMap[D].y=U+C[1],i.nodeMap[D]._order=F._order;const q=A(i.nodeMap[D]);$<q&&($=q)}),$};let ye=!0;const zt=0;x.forEach(g=>{var k,z,Y,$,D,F,X;if(!(!((k=g==null?void 0:g.nodes)===null||k===void 0)&&k.length)&&!(!((z=g==null?void 0:g.left)===null||z===void 0)&&z.length)&&!(!((Y=g==null?void 0:g.right)===null||Y===void 0)&&Y.length))return;if(ye&&g.nodes.length===1){const q=g.nodes[0];if(!i.nodeMap[q])return;i.nodeMap[q].x=C[0],i.nodeMap[q].y=C[1],G[g.nodes[0]]=0,B=A(i.nodeMap[q]),ye=!1;return}B=Math.max(B,g.totalWidth/(2*Math.PI));let U=-1/0;if(R===0||!(($=g.nodes)===null||$===void 0)&&$.length)U=me(g.nodes,B,U,[0,1]);else{const q=((D=g.left)===null||D===void 0?void 0:D.length)/(((F=g.left)===null||F===void 0?void 0:F.length)+((X=g.right)===null||X===void 0?void 0:X.length));U=me(g.left,B,U,[0,q]),U=me(g.right,B,U,[q+.05,1])}B+=U,ye=!1,zt-g.maxSize}),v.edges().forEach(g=>{var k,z,Y;const $=v.edge(g),D=p.findIndex(F=>{const X=ne(F,"source"),U=ne(F,"target");return X===g.v&&U===g.w});if(!(D<=-1)&&i.edgeLabelSpace&&i.controlPoints&&p[D].type!=="loop"){const F=_==="x"?"y":"x",X=(k=$==null?void 0:$.points)===null||k===void 0?void 0:k.slice(1,$.points.length-1),U=[],q=(z=v.node(g.v))===null||z===void 0?void 0:z[F],$t=q-((Y=v.node(g.w))===null||Y===void 0?void 0:Y[F]),Be=G[g.v],Wt=Be-G[g.w];X==null||X.forEach(Ge=>{const Ut=(Ge[F]-q)/$t*Wt+Be,ze=S(Ge[_],Ve,K,Ut);U.push({x:ze.x+C[0],y:ze.y+C[1]})}),p[D].controlPoints=U}})}else{const m=new Set,S=l==="BT"||l==="RL"?(_,E)=>E-_:(_,E)=>_-E;v.nodes().forEach(_=>{const E=v.node(_);if(!E)return;let I=this.nodeMap[_];I||(I=d==null?void 0:d.find(V=>V.id===_)),I&&(I.x=E.x+C[0],I.y=E.y+C[1],I._order=E._order,m.add(W?I.x:I.y))});const O=Array.from(m).sort(S),R=W?(_,E)=>_.x!==E.x:(_,E)=>_.y!==E.y,x=W?(_,E,I)=>{const V=Math.max(E.y,I.y),B=Math.min(E.y,I.y);return _.filter(G=>G.y<=V&&G.y>=B)}:(_,E,I)=>{const V=Math.max(E.x,I.x),B=Math.min(E.x,I.x);return _.filter(G=>G.x<=V&&G.x>=B)};v.edges().forEach(_=>{var E;const I=v.edge(_),V=p.findIndex(B=>{const G=ne(B,"source"),K=ne(B,"target");return G===_.v&&K===_.w});if(!(V<=-1)&&i.edgeLabelSpace&&i.controlPoints&&p[V].type!=="loop"){(E=I==null?void 0:I.points)===null||E===void 0||E.forEach(K=>{K.x+=C[0],K.y+=C[1]});const B=i.nodeMap[_.v],G=i.nodeMap[_.w];p[V].controlPoints=Qr(I==null?void 0:I.points,B,G,O,W,R,x)}})}return i.onLayoutEnd&&i.onLayoutEnd(),{nodes:a,edges:p}}getRadialPos(t,n,o,r,i=[0,1]){let a=(t-n[0])/o;a=a*(i[1]-i[0])+i[0];const s=a*2*Math.PI;return{x:Math.cos(s)*r,y:Math.sin(s)*r}}getType(){return"dagre"}}const Qr=(e,t,n,o,r,i,a)=>{let s=(e==null?void 0:e.slice(1,e.length-1))||[];if(t&&n){let{x:l,y:d}=t,{x:c,y:f}=n;if(r&&(l=t.y,d=t.x,c=n.y,f=n.x),f!==d&&l!==c){const u=o.indexOf(d),h=o[u+1];if(h){const b=s[0],w=r?{x:(d+h)/2,y:(b==null?void 0:b.y)||c}:{x:(b==null?void 0:b.x)||c,y:(d+h)/2};(!b||i(b,w))&&s.unshift(w)}const p=o.indexOf(f),v=Math.abs(p-u);if(v===1)s=a(s,t,n),s.length||s.push(r?{x:(d+f)/2,y:l}:{x:l,y:(d+f)/2});else if(v>1){const b=o[p-1];if(b){const w=s[s.length-1],M=r?{x:(f+b)/2,y:(w==null?void 0:w.y)||c}:{x:(w==null?void 0:w.x)||l,y:(f+b)/2};(!w||i(w,M))&&s.push(M)}}}}return s};class Vt{constructor(){Q(this,"lf");Q(this,"option")}render(t){this.lf=t}getBytesLength(t){if(!t)return 0;let n=0;for(let o=0;o<t.length;o++){const r=t.charCodeAt(o);t.match(/[A-Z]/)?n+=1.5:r>=1&&r<=126||r>=65376&&r<=65439?n+=1:n+=2}return n}layout(t={}){const{nodes:n,edges:o,gridSize:r}=this.lf.graphModel;let i=40,a=40;r>20&&(i=r*2,a=r*2),this.option={type:"dagre",rankdir:"LR",align:"DR",nodesep:i,ranksep:a,begin:[120,120],...t};const l=new Xr(this.option).layout({nodes:n.map(c=>({id:c.id,size:{width:c.width,height:c.height},model:c})),edges:o.map(c=>({source:c.sourceNodeId,target:c.targetNodeId,model:c}))}),d={nodes:[],edges:[]};l.nodes.forEach(c=>{const{model:f}=c,u=f.getData();u.x=c.x,u.y=c.y,u.text&&u.text.value&&(u.text={x:u.x,y:u.y+10,value:u.text.value}),d.nodes.push(u)}),l.edges.forEach(c=>{const{model:f}=c,u=f.getData();if(u.pointsList=this.calcPointsList(f,d.nodes),u.pointsList){const h=u.pointsList[0],p=u.pointsList[u.pointsList.length-1];u.startPoint={x:h.x,y:h.y},u.endPoint={x:p.x,y:p.y},u.text&&u.text.value&&(u.text={x:(h.x+p.x)/2,y:p.y,value:u.text.value})}else u.startPoint=void 0,u.endPoint=void 0,u.text&&u.text.value&&(u.text=u.text.value);d.edges.push(u)}),this.lf.renderRawData(d)}pointFilter(t){const n=t;let o=1;for(;o<n.length-1;){const r=n[o-1],i=n[o],a=n[o+1];r.x===i.x&&i.x===a.x||r.y===i.y&&i.y===a.y?n.splice(o,1):o++}return n}calcPointsList(t,n){const o=[];if(this.option.rankdir==="LR"&&t.modelType==="polyline-edge"){const r=this.lf.getNodeModelById(t.sourceNodeId),i=this.lf.getNodeModelById(t.targetNodeId),a=n.find(l=>l.id===t.sourceNodeId),s=n.find(l=>l.id===t.targetNodeId);if(a.x<s.x)return o.push({x:a.x+r.width/2,y:a.y}),o.push({x:a.x+r.width/2+(t.offset||50),y:a.y}),o.push({x:a.x+r.width/2+(t.offset||50),y:s.y}),o.push({x:s.x-i.width/2,y:s.y}),this.pointFilter(o);if(a.x>s.x)return a.y>=s.y?(o.push({x:a.x,y:a.y+r.height/2}),o.push({x:a.x,y:a.y+r.height/2+(t.offset||50)}),o.push({x:s.x,y:a.y+r.height/2+(t.offset||50)}),o.push({x:s.x,y:s.y+i.height/2})):(o.push({x:a.x,y:a.y-r.height/2}),o.push({x:a.x,y:a.y-r.height/2-(t.offset||50)}),o.push({x:s.x,y:a.y-r.height/2-(t.offset||50)}),o.push({x:s.x,y:s.y-i.height/2})),this.pointFilter(o)}}}Q(Vt,"pluginName","dagre");class Zr extends Qt{constructor({lf:t}){super({lf:t});const n={text:"复制",icon:!0,className:"lf-menu-copy",callback:y=>t.cloneNode(y.id)},o={text:"删除",icon:!0,className:"lf-menu-delete",callback:y=>{t.deleteNode(y.id),t.deleteEdge(y.id)}},r={text:"编辑文本",icon:!0,className:"lf-menu-edit",callback:y=>t.graphModel.editText(y.id)},i={text:"删除文本",icon:!0,className:"lf-menu-delete",callback:y=>t.updateText(y.id,"")},a={text:"框选",icon:!0,className:"lf-menu-select",callback(){t.openSelectionSelect(),t.once("selection:selected",t.closeSelectionSelect)}},s={text:"清空",icon:!0,className:"lf-menu-clear",callback:()=>t.clearData()},l={text:"",icon:!0,className:"lf-menu-back",callback:y=>this.changeMenuList(y,J.nodeMenu)},d={text:"添加",icon:!0,className:"lf-menu-add",callback:y=>{let N=[];switch(y.type){case"startEvent":case"userTask":case"exclusiveGateway":case"parallelGateway":N=[l,c,f,h,p,u,v];break;case"endEvent":case"sequenceFlow":case"group":case"serviceTask":N=[l,v];break;default:N=[l]}this.changeMenuList(y,N)}},c={text:"用户任务",icon:!0,className:"lf-menu-user-task",callback:y=>this.addNode(y,{type:"userTask",x:y.x+200,y:y.y})},f={text:"服务任务",icon:!0,className:"lf-menu-service-task",callback:y=>this.addNode(y,{type:"serviceTask",x:y.x+200,y:y.y})},u={text:"结束",icon:!0,className:"lf-menu-end-event",callback:y=>this.addNode(y,{type:"endEvent",x:y.x+150,y:y.y})},h={text:"互斥网关",icon:!0,className:"lf-menu-exclusive-gateway",callback:y=>this.addNode(y,{type:"exclusiveGateway",x:y.x+150,y:y.y})},p={text:"并行网关",icon:!0,className:"lf-menu-parallel-gateway",callback:y=>this.addNode(y,{type:"parallelGateway",x:y.x+150,y:y.y})},v={text:"注释",icon:!0,className:"lf-menu-note",callback:y=>this.addNode(y,{type:"note",x:y.x,y:y.y-150})},b={text:"切换类型",icon:!0,className:"lf-menu-switch",callback:y=>{let N=[];switch(y.type){case"exclusiveGateway":N=[l,P];break;case"parallelGateway":N=[l,A];break;case"startEvent":N=[l,M];break;case"endEvent":N=[l,w];break;default:N=[l]}this.changeMenuList(y,N)}},w={text:"开始",icon:!0,className:"lf-menu-start-event",callback:y=>this.changeNodeType(y,"startEvent")},M={text:"结束",icon:!0,className:"lf-menu-end-event",callback:y=>this.changeNodeType(y,"endEvent")},P={text:"并行网关",icon:!0,className:"lf-menu-parallel-gateway",callback:y=>this.changeNodeType(y,"parallelGateway")},A={text:"互斥网关",icon:!0,className:"lf-menu-exclusive-gateway",callback:y=>this.changeNodeType(y,"exclusiveGateway")},J={nodeMenu:[d,n,o,b,r,i],edgeMenu:[o,r,i],graphMenu:[a,s]};this.setMenuConfig(J)}changeMenuList(t,n){setTimeout(()=>{this.__currentData=t;const{left:o,top:r}=this.__menuDOM.style;this.showMenu(o,r,n)})}addNode(t,n){const o=this.lf.addNode(n),r=["serviceTask","note"].includes(n.type);this.lf.addEdge({type:r?"noteFlow":void 0,sourceNodeId:t.id,targetNodeId:o.id})}changeNodeType(t,n){this.lf.changeNodeType(t.id,n),Object.keys(t.properties||{}).forEach(o=>this.lf.deleteProperty(t.id,o)),this.lf.emit("element:click",{data:{...t,type:n,properties:{}}})}}class ei extends Zt{constructor({lf:t}){super({lf:t}),this.setPatternItems([{label:"框选",icon:"https://api.iconify.design/bpmn/lasso-tool.svg?width=24&height=24",callback(){t.openSelectionSelect(),t.once("selection:selected",t.closeSelectionSelect)}},{type:"group",label:"子流程",icon:"https://api.iconify.design/bpmn/subprocess-expanded.svg?width=24&height=24"},{type:"startEvent",text:"开始",label:"开始节点",icon:"https://api.iconify.design/bpmn/start-event.svg?width=24&height=24"},{type:"endEvent",text:"结束",label:"结束节点",icon:"https://api.iconify.design/bpmn/end-event.svg?width=24&height=24"},{type:"userTask",label:"用户任务",icon:"https://api.iconify.design/bpmn/user-task.svg?width=24&height=24"},{type:"serviceTask",label:"服务任务",icon:"https://api.iconify.design/bpmn/service-task.svg?width=24&height=24"},{type:"exclusiveGateway",label:"互斥网关",icon:"https://api.iconify.design/bpmn/gateway-xor.svg?width=24&height=24"},{type:"parallelGateway",label:"并行网关",icon:"https://api.iconify.design/bpmn/gateway-parallel.svg?width=24&height=24"},{type:"note",label:"注释",icon:"https://api.iconify.design/bpmn/text-annotation.svg?width=24&height=24"}])}}const Bt={type:"process",key:"Process",properties:{}};function ti(e){const{id:t,type:n,x:o,y:r,properties:i,children:a,text:s}=e;return{incoming:[],outgoing:[],children:a,type:n,key:t,groupKey:i==null?void 0:i.groupKey,properties:{...i,name:Fe(s)?s:(s==null?void 0:s.value)??"",x:o,y:r,text:s}}}function ni(e){const{id:t,type:n,sourceNodeId:o,targetNodeId:r,startPoint:i,endPoint:a,pointsList:s,properties:l,text:d}=e;return{incoming:[o],outgoing:[r],type:n,key:t,groupKey:l==null?void 0:l.groupKey,properties:{...l,name:Fe(d)?d:(d==null?void 0:d.value)??"",text:d,startPoint:i,endPoint:a,pointsList:s}}}function oi(e){const{id:t,type:n,properties:o,text:r}=e;return{type:n,key:t,properties:{...o,name:Fe(r)?r:(r==null?void 0:r.value)??""}}}function ri(e){const t=new Map,n={processData:Bt,flowElementList:[]};return e.nodes.forEach(o=>{var r;if(o.type==="process")n.processData=oi(o);else{const i=ti(o);(r=n.flowElementList)==null||r.push(i),t.set(o.id,i)}}),e.edges.forEach(o=>{var s;const r=ni(o);t.get(o.sourceNodeId).outgoing.push(r.key),t.get(o.targetNodeId).incoming.push(r.key),(s=n.flowElementList)==null||s.push(r)}),n}function ii(e){const{incoming:t,outgoing:n,properties:o,key:r,type:i}=e,{text:a,name:s,startPoint:l,endPoint:d,pointsList:c}=o??{},f={id:r,type:i,sourceNodeId:(t==null?void 0:t[0])??"",targetNodeId:(n==null?void 0:n[0])??"",text:a||s,startPoint:l,endPoint:d,pointsList:c,properties:{}},u=["startPoint","endPoint","pointsList","text"];return f.properties=Re(o,u),f}function si(e){const{properties:t,key:n,type:o,children:r}=e,{x:i,y:a,text:s,name:l}=t??{},d={id:n,type:o??"",x:i,y:a,text:s||l,children:r,properties:{}},c=["x","y","text"];return d.properties=Re(t,c),d}function ai(e){const{properties:t,key:n,type:o}=e,{name:r}=t??{},i={id:n,type:o??"",text:r,x:0,y:0},a=["x","y","text"];return i.properties=Re(t,a),i}function li(e){const{flowElementList:t}=e,n=a=>["sequenceFlow","noteFlow"].includes(a),o=(t==null?void 0:t.filter(a=>!n(a.type)).map(si))??[],r=(t==null?void 0:t.filter(a=>n(a.type)).map(ii))??[];return o.unshift(ai(e.processData??Bt)),{nodes:o,edges:r}}class Ce{constructor({lf:t}){t.adapterIn=this.adapterIn,t.adapterOut=this.adapterOut}adapterOut(t){return ri(t)}adapterIn(t){return li(t)}}Q(Ce,"pluginName","turboAdapter");class Gt{constructor({lf:t}){Q(this,"lf");Q(this,"container");Q(this,"__tooltipDOM");Q(this,"__tooltips",[]);this.__tooltipDOM=document.createElement("div"),this.__tooltipDOM.className="lf-tooltip",this.__tooltipDOM.style.position="absolute",this.__tooltipDOM.style.display="none",this.lf=t}render(t,n){this.container=n,n.appendChild(this.__tooltipDOM),t.on("node:mouseenter,edge:mouseenter",({data:o,e:r})=>{var d;const i=(d=this.__tooltips.find(c=>c.id===o.id))==null?void 0:d.content;if(!i)return;this.__tooltipDOM.innerHTML=i;const a=t.getPointByClient(r.x,r.y),{domOverlayPosition:{x:s,y:l}}=a;this.__tooltipDOM.style.top=`${l+10}px`,this.__tooltipDOM.style.left=`${s+10}px`,this.__tooltipDOM.style.display="block"}),t.on("node:mouseleave,edge:mouseleave",()=>{this.__tooltipDOM.style.display="none"})}setTooltips(t){this.__tooltips=t}}Q(Gt,"pluginName","tooltip");function di({props:e,state:t}){const{lf:n,graphData:o}=t;function r(a){var s;n.value=new $e.LogicFlow({container:a,grid:{type:"dot",size:10},nodeTextDraggable:!0,edgeTextDraggable:!0,nodeTextEdit:!0,edgeTextEdit:!0,plugins:[gn,ei,en,Zr,tn,nn,We,Ue,Ce,Vt],edgeGenerator:(l,d)=>{if(["note","serviceTask"].includes(d.type))return"noteFlow"},...e.initOptions}),(s=n.value)==null||s.setTheme(Ye),wn(t),qe(o,l=>{var u,h,p;const d=JSON.stringify(l),c=JSON.stringify((u=n.value)==null?void 0:u.getGraphData());d!==c&&((h=n.value)==null||h.render(l),(p=n.value)==null||p.emit("element:click",{isForce:!0}))},{immediate:!0})}function i(a){var s;n.value=new $e.LogicFlow({container:a,grid:{type:"dot",size:10},isSilentMode:!0,plugins:[We,Ue,Ce,Gt],...e.initOptions}),(s=n.value)==null||s.setTheme(Ye),qe(()=>[o.value,e.styles,e.tooltips],async()=>{var l,d,c,f;(l=n.value)==null||l.render(o.value),await Me(),(d=e.styles)==null||d.forEach(({id:u,style:h})=>{var p,v;u&&((v=(p=n.value)==null?void 0:p.graphModel)==null||v.updateAttributes(u,{style:h}))}),(f=(c=n.value)==null?void 0:c.extension.tooltip)==null||f.setTooltips(e.tooltips??[])},{immediate:!0})}return{initViewer:i,initModeler:r}}const ci=dn("span",null,"编辑JSON",-1),ui=yt({__name:"flow-editor",props:{modelValue:{},visible:{type:Boolean}},emits:["confirm"],setup(e,{emit:t}){const o=Jt(e),{modelValue:r,visible:i}=o,a=sn("");function s(){const l=JSON.parse(a.value);r.value=l,t("confirm",l),i.value=!1}return an(()=>{a.value=JSON.stringify(r.value,null,2)}),(l,d)=>{const c=Z("el-input"),f=Z("el-button"),u=Z("el-drawer");return oe(),se(u,{modelValue:H(i),"onUpdate:modelValue":d[1]||(d[1]=h=>ae(i)?i.value=h:null)},{header:re(()=>[ci,Ie(l.$slots,"header")]),default:re(()=>[le(c,{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=h=>a.value=h),class:"flow-editor__textarea",type:"textarea"},null,8,["modelValue"]),le(f,{class:"flow-editor__confirm-btn",type:"primary",onClick:s},{default:re(()=>[ln(" 确定 ")]),_:1})]),_:3},8,["modelValue"])}}}),fi=["id"],ki=yt({__name:"index",props:{lf:{},initOptions:{},modelValue:{},elementData:{},formOptions:{},formData:{},formOption:{},formDefaults:{},formWidth:{},dataOptions:{},type:{},styles:{},tooltips:{}},setup(e){const t=e,n=Kt(t),{lf:o,graphData:r,formRef:i,formData:a,formOption:s,formDefaults:l,formLoading:d,editorVisible:c,onUpdateFormData:f}=n,{initModeler:u,initViewer:h}=di({props:t,state:n}),p=rn("logicflow-container");return cn(()=>{const v=document.querySelector(`#${p}`);t.type==="viewer"?h(v):u(v)}),(v,b)=>{const w=Z("el-main"),M=Z("el-empty"),P=Z("el-skeleton"),A=Z("avue-form"),J=Z("el-aside"),y=Z("el-container");return v.type==="viewer"?(oe(),un("div",{key:0,id:H(p),class:"lf-container"},null,8,fi)):(oe(),se(y,{key:1,class:"lf-container"},{default:re(()=>[le(w,{id:H(p),class:"lf-main"},null,8,["id"]),le(J,{width:v.formWidth,class:"lf-aside"},{default:re(()=>{var N,L;return[Ie(v.$slots,"form-top"),(L=(N=H(s))==null?void 0:N.group)!=null&&L.length?H(d)?(oe(),se(P,{key:1})):(oe(),se(A,{key:2,ref_key:"formRef",ref:i,modelValue:H(a),"onUpdate:modelValue":[b[0]||(b[0]=j=>ae(a)?a.value=j:null),H(f)],defaults:H(l),"onUpdate:defaults":b[1]||(b[1]=j=>ae(l)?l.value=j:null),option:H(s)},null,8,["modelValue","defaults","option","onUpdate:modelValue"])):(oe(),se(M,{key:0,description:"选择元素以编辑数据"}))]}),_:3},8,["width"]),le(ui,{modelValue:H(r),"onUpdate:modelValue":b[2]||(b[2]=N=>ae(r)?r.value=N:null),visible:H(c),"onUpdate:visible":b[3]||(b[3]=N=>ae(c)?c.value=N:null),onConfirm:b[4]||(b[4]=N=>{var L;return(L=H(o))==null?void 0:L.render(N)})},fn({_:2},[v.$slots["editor-header"]?{name:"header",fn:re(()=>[Ie(v.$slots,"editor-header")]),key:"0"}:void 0]),1032,["modelValue","visible"])]),_:3}))}}});export{We as BpmnExtend,gn as Control,Vt as Dagre,$i as EndEventModel,Wi as EndEventView,Ui as ExclusiveGatewayModel,qi as ExclusiveGatewayView,ki as FlowDesign,Ue as Group,Yi as GroupModel,Hi as GroupView,Zr as Menu,Ji as NoteFlowModel,Ki as NoteFlowView,Xi as NoteModel,Qi as NoteView,ei as Panel,Zi as ParallelGatewayModel,es as ParallelGatewayView,ts as ProcessModel,ns as ProcessView,os as SequenceFlowModel,rs as SequenceFlowView,is as ServiceTaskModel,ss as ServiceTaskView,as as StartEventModel,ls as StartEventView,Gt as Tooltip,Ce as TurboAdapter,ds as UserTaskModel,cs as UserTaskView,Mi as assigneeColumn,Ii as baseColumn,Oi as buttonColumn,Ti as circulateColumn,Li as defaultGraphData,Ht as defaultGroup,Pi as defaultOptions,Ye as defaultTheme,wi as executionListenerColumn,Si as formPropertyColumn,Di as gatewayColumn,Ci as multiInstanceColumn,Ri as noteColumn,Fi as processColumn,ji as propertyColumn,Ai as sequenceFlowColumn,Vi as serialColumn,Bi as serviceTaskColumn,gi as taskListenerColumn,xi as timeLimitColumn,li as toLogicflowData,ri as toTurboData,Gi as userTaskColumn};
