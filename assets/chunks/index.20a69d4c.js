import{Q as G,aM as ut,aN as Ut,aO as ne,aP as Et,al as At,an as Kt,aQ as Z,aR as Mt,K as Bt,R as de}from"../composables_use-crud_index.md.48b0a24a.js";import{I as se}from"../components_icon-select_index.md.d0d43ced.js";import{X as Me,B as De,r as N,s as he,d as U,e as J,w as pe,i as ee,u as k,n as _e,Y as jt,h as A,H as V,j as T,k as E,R as X,F as W,D as $,E as w,J as g,p as P,q as j,a3 as tt,C as Q,_ as Te,G as B,K as Ht,l as zt,O as ot,b as it,L as Wt,a5 as Ue,aA as Yt,M as qt,ai as oe,aj as le,m as Qt,aM as ct,aa as dt,I as Gt}from"./framework.1d422142.js";import{a as Jt,c as Xt,e as Zt}from"../flow-design_demo.md.d62e10e5.js";import"./index.ec236ddf.js";import{t as pt,P as mt,f as eo,M as ft,L as to,u as oo}from"./vuedraggable.umd.f8fce840.js";import{u as me,w as xe,d as lo,e as ao}from"./theme.8df2a84c.js";import{p as no}from"../components_input-tree_index.md.13d0ff03.js";import{d as vt}from"./differenceBy.05cd6a28.js";import{a9 as so,au as ro,aj as ge}from"./index.6f48f4cc.js";import{J as uo,K as io}from"../app.3591ea7f.js";import"./vue.runtime.esm-bundler.f54a6e78.js";import"../components_index.md.ed574200.js";import"../components_v-text_index.md.57fcf476.js";import"../composables_index.md.89926003.js";import"../flow-design_index.md.f1ee796f.js";import"../flow-pages_index.md.f537077e.js";import"../flow-pages_pages_flow-button_index.md.edc4c66c.js";import"../flow-pages_pages_flow-manage_index.md.beb8e2a9.js";import"../flow-pages_pages_flow-ops_index.md.dad6d105.js";import"../flow-pages_pages_flow-param_index.md.e37087dc.js";import"../flow-pages_pages_flow-template_index.md.1e0c8ffd.js";import"../flow-pages_pages_flow-workbench_index.md.edb2d8bd.js";import"../flow-pages_pages_form-template_index.md.45f44974.js";import"../flow-pages_pages_table-template_index.md.501eedc1.js";import"../form-design_demo.md.b1554396.js";import"../form-design_index.md.3d2472a1.js";import"../guide_changelog.md.dd7dcebf.js";import"../guide_start.md.b957fce8.js";import"../index.md.fd18855f.js";import"../plugins_avue-patch_index.md.d0615ce8.js";import"../plugins_compatible-tips_index.md.9c615e5a.js";import"../plugins_env-dts_index.md.ee222427.js";import"../plugins_index.md.14cfbd27.js";import"../plugins_load-proxy_index.md.2b165bf9.js";import"../plugins_setup-extend_index.md.9fe322e5.js";import"../plugins_uni-ui-patch_index.md.5efa77bc.js";import"../plugins_uview-patch_index.md.4ead0e74.js";import"../types_avue_index.md.f7c69920.js";import"../types_index.md.bc889cae.js";import"../utils_date_dateFormat.md.d569be23.js";import"../utils_date_durationFormat.md.867acb13.js";import"../utils_emitter_mittAsync.md.15be3108.js";import"../utils_index.md.f9614baf.js";import"../utils_math_index.md.b373ac2c.js";import"../utils_object_filterObj.md.eee4ca82.js";import"../utils_object_filterObjDeep.md.ab95bd01.js";import"../utils_object_getDataType.md.b0332010.js";import"../utils_string_deserialize.md.e28d6a15.js";import"../utils_string_serialize.md.d2c59757.js";import"../utils_string_uuid.md.52281c59.js";import"../utils_tool_awaitTo.md.74d6774f.js";import"../utils_tool_enumToDic.md.ab28ad3d.js";import"../utils_tool_sleep.md.aa5d330d.js";import"../utils_tree_buildTree.md.c38f7d68.js";import"../utils_tree_filterTree.md.12fe1fef.js";import"../utils_tree_findTree.md.b928ae2a.js";import"../utils_tree_flatTree.md.a2813919.js";import"../utils_tree_treeMap.md.3e9922c0.js";const co={},po=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),mo=()=>co,ae=e=>e,Ee=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",je=e=>e instanceof Function,we=e=>e==null,He=typeof window>"u",_t=()=>{var e;return He||we((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},fo=()=>{var e,t;return(e=!He&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Se=()=>new Promise(()=>{}),te=e=>ee(e)?e.value:e,vo=e=>Be(e)?Object.assign(Ee(e)?[]:{},e):e,ke=new Map,_o=e=>we(e)?void 0:ke.get(e),wo=(e,t,o)=>{const p=ke.get(e);p!=null&&p.timer&&clearTimeout(p.timer);const s=setTimeout(()=>ke.delete(e),t);ke.set(e,{...o,timer:s})};function wt(e,t,o){let p,s,a,c,l,r,m=0,_=!1,n=!1,d=!0;const u=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Be(o)&&(_=!!o.leading,n="maxWait"in o,a=n?Math.max(+o.maxWait||0,t):a,d="trailing"in o?!!o.trailing:d);function y(C){const x=p,L=s;return p=s=void 0,m=C,c=e.apply(L,x),c}function b(C,x){return u?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,x)}function i(C){if(u)return window.cancelAnimationFrame(C);clearTimeout(C)}function v(C){return m=C,l=b(D,t),_?y(C):c}function f(C){const x=C-r,L=C-m,K=t-x;return n?Math.min(K,a-L):K}function h(C){const x=C-r,L=C-m;return r===void 0||x>=t||x<0||n&&L>=a}function D(){const C=Date.now();if(h(C))return O(C);l=b(D,f(C))}function O(C){return l=void 0,d&&p?y(C):(p=s=void 0,c)}function R(){l!==void 0&&i(l),m=0,p=r=s=l=void 0}function I(){return l===void 0?c:O(Date.now())}function F(){return l!==void 0}function S(){const C=Date.now(),x=h(C);for(var L=arguments.length,K=new Array(L),H=0;H<L;H++)K[H]=arguments[H];if(p=K,s=this,r=C,x){if(l===void 0)return v(r);if(n)return l=b(D,t),y(r)}return l===void 0&&(l=b(D,t)),c}return S.cancel=R,S.flush=I,S.pending=F,S}function bo(e,t,o){let p=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(o)&&(p="leading"in o?!!o.leading:p,s="trailing"in o?!!o.trailing:s),wt(e,t,{leading:p,trailing:s,maxWait:t})}var yo=ae((e,t)=>{let{debounceInterval:o,debounceOptions:p,manual:s}=t;const a=N(!1),c=N(),l=U(()=>p),r=U(()=>te(o)),m=N(e.context.runAsync);return s||(a.value=!0),J(_=>{we(r.value)||(c.value=wt(n=>n(),r.value,l.value),e.context.runAsync=function(){for(var n=arguments.length,d=new Array(n),u=0;u<n;u++)d[u]=arguments[u];return new Promise((y,b)=>{a.value?(a.value=!1,m.value(...d).then(y).catch(b)):c.value(()=>{m.value(...d).then(y).catch(b)})})},_(()=>{var n;(n=c.value)===null||n===void 0||n.cancel(),e.context.runAsync=m.value}))}),{onCancel(){var _;(_=c.value)===null||_===void 0||_.cancel()}}}),go=ae((e,t)=>{let{errorRetryCount:o=0,errorRetryInterval:p=0}=t;const s=N(),a=N(0),c=U(()=>te(o)),l=U(()=>te(p));let r=!1;const m=()=>{a.value=0},_=U(()=>{if(l.value)return l.value;const u=1e3,y=1,b=9,i=Math.floor(Math.random()*2**Math.min(a.value,b)+y);return u*i}),n=()=>{let u;const y=c.value===-1,b=a.value<c.value;return(y||b)&&(y||(a.value+=1),u=setTimeout(()=>{r=!0,e.context.refresh()},_.value)),()=>u&&clearTimeout(u)},d=()=>{s.value&&s.value()};return{onBefore(){r||m(),r=!1,d()},onSuccess(){m()},onError(){s.value=n()},onCancel(){m(),d()}}}),ho=ae((e,t)=>{let{ready:o=N(!0),manual:p,defaultParams:s=[]}=t;return pe(o,a=>{!p&&a&&e.context.run(...s)},{flush:"sync"}),{onBefore(){if(!(je(o)?o():o.value))return e.loading.value=!1,{isBreak:!0}}}}),ko=ae((e,t)=>{let{refreshDeps:o,refreshDepsAction:p,manual:s}=t;if(o===void 0||Ee(o)&&o.length===0)return{};const a=Ee(o)?o:[o];return pe(a,()=>{p?p():!s&&e.context.refresh()}),{}}),Co=ae((e,t)=>{let{throttleInterval:o,throttleOptions:p}=t;const s=N(),a=U(()=>te(o)),c=U(()=>p),l=N(e.context.runAsync);return J(r=>{if(we(o))return{};s.value=bo(m=>m(),a.value,c.value),e.context.runAsync=function(){for(var m=arguments.length,_=new Array(m),n=0;n<m;n++)_[n]=arguments[n];return new Promise((d,u)=>{s.value(()=>{l.value(..._).then(d).catch(u)})})},r(()=>{var m;(m=s.value)===null||m===void 0||m.cancel(),e.context.runAsync=l.value})}),{onCancel(){var r;(r=s.value)===null||r===void 0||r.cancel()}}});const Vo=(e,t)=>o=>{Object.keys(o).forEach(p=>{e[p].value=o[p]}),t.forEach(p=>p(e))},Do=(e,t)=>()=>{let o=t;for(let p=e.length;p-- >0;)o=e[p](o);return o()},To=(e,t,o)=>{var p,s;const{initialData:a,onSuccess:c,onError:l,onBefore:r,onAfter:m}=t,_=N((p=o==null?void 0:o.loading)!==null&&p!==void 0?p:!1),n=he((s=o==null?void 0:o.data)!==null&&s!==void 0?s:a),d=he(o==null?void 0:o.error),u=N(o==null?void 0:o.params),y=N([]),b=he("pending"),i={},v=Vo({status:b,loading:_,data:n,error:d,params:u},[]),f=function(D){for(var O=arguments.length,R=new Array(O>1?O-1:0),I=1;I<O;I++)R[I-1]=arguments[I];if(D==="onQuery"){const F=y.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:Do(F,R[0])()}}else{const F=y.value.map(S=>{var C;return(C=S[D])===null||C===void 0?void 0:C.call(S,...R)});return Object.assign({},...F)}},h=N(0);return i.runAsync=async function(){for(var D=arguments.length,O=new Array(D),R=0;R<D;R++)O[R]=arguments[R];v({loading:!0,params:O,status:"pending"}),h.value+=1;const I=h.value,{isBreak:F,breakResult:S=Se()}=f("onBefore",O);if(F)return v({status:"settled"}),S;r==null||r(O);try{const C=()=>new Promise(K=>K(e(...u.value)));let{servicePromise:x}=f("onQuery",C);x||(x=C());const L=await x;return I!==h.value?Se():(v({data:L,loading:!1,error:void 0,status:"settled"}),f("onSuccess",L,O),c==null||c(L,O),I===h.value&&f("onAfter",O,L,void 0),m==null||m(O),L)}catch(C){if(I!==h.value)return Se();throw v({loading:!1,error:C,status:"settled"}),f("onError",C,O),l==null||l(C,O),I===h.value&&f("onAfter",O,void 0,C),m==null||m(O),C}},i.run=function(){i.runAsync(...arguments).catch(D=>{l||console.error(D)})},i.cancel=()=>{h.value+=1,v({loading:!1}),f("onCancel")},i.refresh=()=>{i.run(...u.value||[])},i.refreshAsync=()=>i.runAsync(...u.value||[]),i.mutate=D=>{const O=je(D)?D(n.value):D,R=vo(O);v({data:R}),f("onMutate",R)},{status:b,loading:_,data:n,error:d,params:u,plugins:y,context:i}};function xo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const p=Me(po,{}),s={...mo(),...p,...t},{manual:a=!1,defaultParams:c=[]}=s,l=To(e,s);if(l.plugins.value=o.map(r=>r(l,s)),!a){const r=l.params.value||c;l.context.run(...r)}return De(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const Ce=new Map,Lo=(e,t)=>{Ce.set(e,t),t.then(o=>(Ce.delete(e),o)).catch(()=>{Ce.delete(e)})},No=e=>Ce.get(e),ue=new Map,Io=(e,t)=>{ue.has(e)&&ue.get(e).forEach(o=>o(t))},Oo=(e,t)=>(ue.has(e)?ue.get(e).push(t):ue.set(e,[t]),()=>{const o=ue.get(e).indexOf(t);ue.get(e).splice(o,1)});var $o=ae((e,t)=>{let{cacheKey:o,cacheTime:p=6e5,staleTime:s=0,getCache:a,setCache:c}=t;if(!o)return{};const l=je(o)?o:()=>o,r=N(()=>{});let m;const _=v=>a?a(v):_o(v),n=(v,f,h)=>{c?c(v,h):wo(v,f,h),Io(v,h.data)},d=v=>s===-1||v+s>new Date().getTime(),u=(v,f)=>Object.prototype.hasOwnProperty.call(v,f),y=v=>{const f=l(v);return Oo(f,h=>{e.data.value=h})},b=l(),i=_(b);return i&&u(i,"data")&&(e.data.value=i.data,e.params.value=i.params),b&&(r.value=y()),De(()=>{r.value()}),{onBefore(v){const f=l(v),h=_(f);if(!h||!u(h,"data"))return{};if(d(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(v){const f=e.params.value,h=l(f);let D=No(h);return D&&D!==m?()=>D:(D=v(),m=D,Lo(h,D),()=>D)},onSuccess(v,f){const h=l(f);h&&(r.value(),n(h,p,{data:v,params:f,time:new Date().getTime()}),r.value=y(f))},onMutate(v){const f=l(e.params.value);f&&(r.value(),n(f,p,{data:v,params:e.params.value,time:new Date().getTime()}),r.value=y(e.params.value))}}});function So(e){let t,o;class p extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new p(s=>{o=s,t=setTimeout(o,e)})}function Re(){return new Date().getTime()}var Ro=ae((e,t)=>{let{loadingDelay:o=0,loadingKeep:p=0}=t;const s=N(()=>{}),a=U(()=>te(o)),c=U(()=>te(p));let l=0,r={};const m=()=>{let _;return a.value&&(_=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>_&&clearTimeout(_)};return{onBefore(){e.loading.value=!a.value,s.value(),s.value=m(),l=Re()},onQuery(_){if(!c.value)return()=>_();r=So(c.value+a.value);const n=async()=>{try{const u=await _();return Re()-l<=a.value&&r.cancel(),Promise.resolve(u)}catch(u){return Re()-l<=a.value&&r.cancel(),Promise.reject(u)}},d=Promise.allSettled([n(),r]).then(u=>{const y=u[0];return y.status==="fulfilled"?y.value:Promise.reject(y.reason)});return()=>d},onCancel(){s.value()},onAfter(){s.value()}}}),Fe;const bt=new Set,yt=new Set,gt=new Set,Ve=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=bt;break;case"RECONNECT_LISTENER":o=gt;break;case"VISIBLE_LISTENER":o=yt;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!He&&(Fe=window)!==null&&Fe!==void 0&&Fe.addEventListener&&(window.addEventListener("visibilitychange",()=>{_t()&&Pe(yt)},!1),window.addEventListener("focus",()=>Pe(bt),!1),window.addEventListener("online",()=>Pe(gt),!1));var Fo=ae((e,t)=>{let{pollingInterval:o,pollingWhenHidden:p=!1,pollingWhenOffline:s=!1,errorRetryCount:a=0}=t;const c=N(),l=N(!1),r=U(()=>te(o)),m=U(()=>te(a)),_=[],n=b=>{b&&_.push(b)},d=()=>(p||_t())&&(s||fo()),u=b=>{if(e.error.value&&m.value!==0)return;let i;if(!we(r.value)&&r.value>=0)if(d())i=setTimeout(b,r.value);else{l.value=!0;return}return()=>i&&clearTimeout(i)},y=()=>{l.value&&d()&&(e.context.refresh(),l.value=!1)};return pe(r,()=>{c.value&&(c.value(),c.value=u(()=>e.context.refresh()))}),p||n(Ve("VISIBLE_LISTENER",y)),s||n(Ve("RECONNECT_LISTENER",y)),De(()=>{_.forEach(b=>b())}),{onBefore(){var b;(b=c.value)===null||b===void 0||b.call(c)},onCancel(){var b;(b=c.value)===null||b===void 0||b.call(c)},onAfter(){c.value=u(()=>e.context.refresh())}}});const Po=(e,t)=>{let o=!1;return function(){o||(o=!0,e(...arguments),setTimeout(()=>{o=!1},t))}};var Uo=ae((e,t)=>{let{refreshOnWindowFocus:o=!1,refocusTimespan:p=5e3}=t;const s=U(()=>te(o)),a=U(()=>te(p)),c=[],l=m=>{m&&c.push(m)},r=()=>{c.forEach(m=>m())};return J(()=>{if(r(),s.value){const m=Po(e.context.refresh,a.value);l(Ve("VISIBLE_LISTENER",m)),l(Ve("FOCUS_LISTENER",m))}}),De(()=>{r()}),{}});function ie(e,t){return xo(e,t,[Ro,go,yo,Fo,Co,Uo,ko,ho,$o])}var ht=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(ht||{});function Le(){const{request:e}=z(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"};return{url:t,getPublishList:()=>e.get(t.publishList),getTaskList:i=>e.get(t.taskList,{params:i}),getFlowDetail:i=>e.get(t.detail,{params:i}),getApprovalNode:i=>e.post(t.approvalNode,i),startTask:i=>e.post(t.start,i),commitTask:i=>e.post(t.commit,i),saveDraft:i=>e.post(t.draft,i),revokeTask:i=>e.post(t.revoke,i),terminateTask:i=>e.post(t.terminate,i),withdrawTask:i=>e.post(t.withdraw,i),transferTask:i=>e.post(t.transfer,i),rejectTask:i=>e.post(t.reject,i),greenChannel:i=>e.post(t.green,i),circulateTask:i=>e.post(t.circulate,i)}}function Eo(e){const{commitTask:t,revokeTask:o,saveDraft:p,startTask:s,terminateTask:a,transferTask:c,withdrawTask:l,rejectTask:r,greenChannel:m,circulateTask:_}=Le(),n=U(()=>{const{flowDetail:u,formVariables:y,approvalFormData:b,debug:i,fileIds:v}=e,{flowDeployId:f}=u.value.process??{},{taskId:h,flowInstanceId:D}=u.value.task??{};return{flowDeployId:f,taskId:h,flowInstanceId:D,variables:y.value,debug:i.value,fileIds:v.value,...b.value}}),d=()=>n.value.taskId&&n.value.flowInstanceId;return{flow_draft(){if(d())return p(n.value)},flow_pass(){return d()?t(n.value):s(n.value)},flow_revoke(){if(d())return o(n.value)},flow_withdraw(){if(d())return l(n.value)},flow_terminate(){if(d())return a(n.value)},flow_transfer(){if(d())return c(n.value)},flow_reject(){if(d())return r(n.value)},flow_green(){if(d())return m(n.value)},flow_circulate(){if(d()){const{approvalFormData:u,circulateId:y}=e;return _({id:y==null?void 0:y.value,comment:u==null?void 0:u.value.comment})}}}}function Ao(e){const t=N({});return J(async()=>{var p;const{formProperty:o}=((p=k(e))==null?void 0:p.properties)||{};o!=null&&o.length&&(await _e(),Object.keys(t.value).forEach(s=>{var l,r,m,_;const a=((l=t.value[s])==null?void 0:l.label)||"",c=o==null?void 0:o.find(n=>n.prop===s);if(t.value[s].display=c==null?void 0:c.display,t.value[s].disabled=c==null?void 0:c.disabled,t.value[s].detail=c==null?void 0:c.detail,t.value[s].readonly=c==null?void 0:c.readonly,t.value[s].rules=t.value[s].rules??[],c!=null&&c.required&&((r=t.value[s].rules)!=null&&r.some(n=>n.required)))return null;c!=null&&c.required?(m=t.value[s].rules)==null||m.push({required:!0,message:`${a}为必填项`}):t.value[s].rules=(_=t.value[s].rules)==null?void 0:_.filter(n=>!n.required)}))}),t}function Ko(){return{modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}}}function Mo(){return{complete:e=>e}}const kt=Symbol("flowFormState");function Bo(e,t){const o=me(e,void 0,{passive:!0,deep:!0}),{flowDetail:p,modelValue:s,formLoading:a}=o,{getFlowDetail:c}=Le(),{tabs:l}=z(),r=U(()=>(l==null?void 0:l.filter(u=>{var b,i,v;const y=(v=(i=(b=p.value)==null?void 0:b.properties)==null?void 0:i.formProperty)==null?void 0:v.find(f=>f.prop===u.prop);return(y==null?void 0:y.display)!==!1}))??[]);J(()=>{const{flowKey:u,taskId:y,instanceId:b}=e;!u&&!y&&!b||(a.value=!0,c({flowKey:u,taskId:y,flowInstanceId:b}).then(i=>{p.value=i.data,s.value=i.data.formData||{}}).finally(()=>{a.value=!1}))});const m=N(!1),_=U(()=>Object.entries(s.value||{}).filter(([u])=>!u.startsWith("$")).map(([u,y])=>({key:u,value:y}))),n=N(),d={...o,formData:s,formVariables:_,approvalVisible:m,tabList:r,fileIds:n,emit:t};return jt(kt,d),d}function ce(){return Me(kt)}const jo=A({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:o,circulateId:p}=ce(),{data:s}=Qe().useList(),{userInfo:a}=z();function c(r,m){return r.map(_=>{const n=m.find(u=>u.buttonKey===_.buttonKey);return{..._,...no(n,["display","approval"])}})}const l=U(()=>{var f,h,D,O,R,I;if(p!=null&&p.value){const F=(f=s.value)==null?void 0:f.find(S=>S.buttonKey==="flow_circulate");return F?[F]:[]}const r=typeof a=="function"?a():a,{assignee:m,status:_}=((h=o.value)==null?void 0:h.task)||{},{createUser:n,flowInstanceId:d,status:u}=((D=o.value)==null?void 0:D.flowInstance)||{},y={true:!0,false:!1,startUser:n==(r==null?void 0:r.userId),assignee:m==(r==null?void 0:r.userId),todo:_==2,done:_==1,notstarted:!d,started:!!d,finished:u===1,unfinished:u===2},b=((O=s.value)==null?void 0:O.filter(F=>F.buttonKey!=="flow_circulate"))??[],{button:i}=((R=o.value)==null?void 0:R.properties)||{};return((I=c(b,i??[]))==null?void 0:I.filter(F=>{var S,C;return(C=(S=F.display)==null?void 0:S.split(","))==null?void 0:C.every(x=>y[x])}))??[]});return(r,m)=>{const _=V("el-button");return T(!0),E(W,null,X(l.value,n=>(T(),$(_,{key:n.buttonKey,type:n.buttonType,onClick:d=>t("click",n)},{default:w(()=>[g(k(se),{icon:n.icon},null,8,["icon"]),P(" "+j(n.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function ze(e){return new Promise((t,o)=>{k(e).validate((s,a,c)=>{s?(a(),t(c)):o(c)})})}const Ho=A({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=me(t),{batchUpdate:p,create:s,remove:a,useList:c}=il(),l=N(!1),{activeBtn:r}=ce(),m=U(()=>{var h;return(h=r.value)==null?void 0:h.buttonKey}),{data:_,refresh:n}=c(m),d=U(()=>{var D,O,R;const h=o.value;if(h&&!((D=_.value)!=null&&D.some(I=>I.content===h))){const I=(((R=(O=_.value)==null?void 0:O[0])==null?void 0:R.sort)||1)-1;return[{content:h,sort:I},..._.value||[]]}return _.value});async function u(h){var D;await s({...h,type:(D=r.value)==null?void 0:D.buttonKey}),G.success("添加成功"),n()}async function y(h){await a(h.id),G.success("删除成功"),n()}async function b(h,D){let O=D.parent.data;O=O.map((R,I)=>({id:R.id,sort:I+1})),await p(O),G.success("修改排序成功"),n(),l.value=!1}function i(){l.value=!0}const v=N();async function f(h){var D;o.value=h.content??"",await _e(),(D=v.value)==null||D.blur()}return(h,D)=>{const O=V("el-input"),R=V("el-text"),I=V("el-col"),F=V("el-button"),S=V("el-row"),C=V("el-tree"),x=V("el-popover");return T(),$(x,{visible:l.value,placement:"bottom",title:"常用意见",width:600},{reference:w(()=>[g(O,{ref_key:"inputRef",ref:v,modelValue:k(o),"onUpdate:modelValue":D[0]||(D[0]=L=>ee(o)?o.value=L:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:D[1]||(D[1]=L=>l.value=!0),onBlur:D[2]||(D[2]=L=>l.value=!1)},null,8,["modelValue"])]),default:w(()=>[g(C,{data:d.value,"node-key":"content",draggable:"","allow-drop":(L,K,H)=>H!=="inner",props:{label:"content"},onNodeClick:f,onNodeDrop:b,onNodeDragStart:i},{default:w(({data:L})=>[g(S,{style:{width:"600px"}},{default:w(()=>[g(I,{span:22},{default:w(()=>[g(R,{truncated:"",title:L.content},{default:w(()=>[P(j(L.content),1)]),_:2},1032,["title"])]),_:2},1024),g(I,{span:2},{default:w(()=>[L.id?(T(),$(F,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:tt(K=>y(L),["stop"])},null,8,["onClick"])):(T(),$(F,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:tt(K=>u(L),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),zo=A({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:o}=me(t),p=N(),s={class(n){return`node-${n.type}`}},a=U(()=>pt(t.data??[],(n,d,u)=>{const y=ut();return n.taskNodeKey=(u==null?void 0:u.taskNodeKey)??n.taskNodeKey,n.incoming=(u==null?void 0:u.incoming)??n.incoming,n.multiple=(u==null?void 0:u.multiple)??n.multiple,{...n,id:y,label:n.title,disabled:n.type!=="user"}})),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};xe(()=>[a.value,p.value],async()=>{if(!p.value||!a.value.length)return;if(t.autoCheck){const d=l(a.value);d&&_([d])}mt(a.value,d=>{var u;return!!((u=d.children)!=null&&u.length)}).map(async d=>{var y;await Ut(100);const u=(y=p.value)==null?void 0:y.getNode(d);u==null||u.expand()})},{immediate:!0,debounce:100});function l(n){var d;if(n.length===1)return(d=n[0].children)!=null&&d.length?l(n[0].children):n[0]}async function r(n,{checkedNodes:d}){var b;let u=d.filter(i=>i.type==="user");const y=u.some(i=>i.id===n.id);if(a.value.every(i=>!i.multiple)&&y)u=[n];else if(!n.multiple&&y){const f=((b=p.value)==null?void 0:b.getNode(n)).parent.data.children.filter(h=>h.id!==n.id);u=vt(u,f,"id")}_(u)}function m(n){const d=o.value.filter(u=>u.id!==n.id);_(d)}function _(n){var d;o.value=n,(d=p.value)==null||d.setCheckedNodes(n)}return(n,d)=>{const u=V("el-tag"),y=V("Icon"),b=V("el-tree");return T(),E(W,null,[(T(!0),E(W,null,X(k(o),i=>(T(),$(u,{key:i.id,type:"info",closable:"",onClose:v=>m(i)},{default:w(()=>[P(j(i.title),1)]),_:2},1032,["onClose"]))),128)),g(b,{ref_key:"treeRef",ref:p,class:"approval-tree",data:a.value,props:s,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:r},{default:w(({data:i})=>[Q("div",null,[g(y,{icon:c[i.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(i.title),1)])]),_:1},8,["data"])],64)}}});const lt=Te(zo,[["__scopeId","data-v-f1318efd"]]),at=A({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,p=U({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(n){var d;t("update:modelValue",n.join(",")),(d=o.tableData)!=null&&d.row&&(o.tableData.row.idVal=mt(l.value,u=>n==null?void 0:n.includes(u.id)).map(u=>u[`${c.value}Id`]).join(","))}}),s=U({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(n){t("update:modelValue",n)}}),a=N(!1),c=U(()=>{var n,d;return(d=(n=o.tableData)==null?void 0:n.row)==null?void 0:d.type}),l=N([]),r=N([]),{getUserTree:m}=ml(),{getParam:_}=fe();return pe(c,n=>{["dept","post","user"].includes(n)?(a.value=!0,m(n==="user"?"":n).then(d=>{l.value=pt(d.data,u=>({...u,label:u.title,value:u.id,disabled:n==="user"?u.type!=="user":!1}))}).finally(()=>a.value=!1)):c.value==="dynamic"&&(a.value=!0,_("flow.trends.user").then(d=>{r.value=d.data}).finally(()=>a.value=!1))},{immediate:!0}),(n,d)=>{const u=V("el-tree-select"),y=V("el-input");return["dept","post","user"].includes(c.value)?(T(),$(u,{key:0,modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=b=>p.value=b),data:l.value,loading:a.value,"expand-on-click-node":!1,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="dynamic"?(T(),$(u,{key:1,modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=b=>s.value=b),data:r.value,loading:a.value,clearable:"",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="userTask"?(T(),$(k(Jt),{key:2,modelValue:s.value,"onUpdate:modelValue":d[2]||(d[2]=b=>s.value=b),"filter-type":"userTask"},null,8,["modelValue"])):(T(),$(y,{key:3,modelValue:s.value,"onUpdate:modelValue":d[3]||(d[3]=b=>s.value=b)},null,8,["modelValue"]))}}}),Wo={key:0,class:"flow-viewer"},Yo={key:0,class:"flow-status-legend"},qo=A({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const o=e,{FlowDesign:p,tabs:s}=z(),a=he();lo(a,()=>{var i;(i=a.value)==null||i.on("node:click",v=>t("nodeClick",v))});const c=U({get(){let i=Xt();return typeof o.modelValue=="string"&&o.modelValue?i=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(i=o.modelValue),i},set(i){t("update:modelValue",JSON.stringify(i))}}),l=U(()=>{const{column:i=[],group:v=[]}=JSON.parse(o.flowFormOption||"{}");return[...i,...v.map(h=>h.column??[]).flat()]}),{data:r}=Qe().useList(),m=U(()=>(s==null?void 0:s.map(i=>({...i,display:!0})))??[]),_=U(()=>{var i;return{formPropertyList:[...l.value,...m.value],buttonList:(i=r.value)==null?void 0:i.filter(v=>v.status===1),fieldsDic:l.value.map(v=>({label:v.label,value:`\${${v.prop}}`,desc:`\${${v.prop}}`})),flowButtonDisplayDic:ne(Ye),flowButtonApprovalDic:ne(qe)}}),n=N({}),d=N({});xe(d,i=>{var v,f,h,D,O,R;i&&((h=(f=(v=i.assignee)==null?void 0:v.children)==null?void 0:f.column)!=null&&h[1]&&(i.assignee.children.column[1].component=at),(R=(O=(D=i.circulate)==null?void 0:D.children)==null?void 0:O.column)!=null&&R[1]&&(i.circulate.children.column[1].component=at))},{debounce:1});const{data:u}=fe().useParam("flow.task.status"),y=U(()=>{var i;return(i=o.flowHistory)==null?void 0:i.map(v=>{var h,D;const f=(D=(h=u.value)==null?void 0:h.find(O=>O.value===v.status))==null?void 0:D.style;return{id:v.taskNodeKey,style:f}})}),b=U(()=>{var i,v;return(v=(i=o.flowHistory)==null?void 0:i.filter(f=>f.taskNodeType==="userTask"))==null?void 0:v.map(f=>{var h;return{id:f.taskNodeKey,content:`<div>${f.assigneeName}</div>
        <div>${f.endTime??""}</div>
        <div>${((h=f.comment)==null?void 0:h.handleComment)??""}</div>`}})});return(i,v)=>i.view?(T(),E("div",Wo,[i.showLegend!==!1?(T(),E("div",Yo,[(T(!0),E(W,null,X(k(u),f=>{var h;return T(),E("div",{key:f.label,class:"legend-item"},[Q("div",{class:"legend-color",style:Ht({backgroundColor:(h=f.style)==null?void 0:h.fill})},null,4),Q("span",null,j(f.label),1)])}),128))])):B("",!0),g(k(p),{lf:a.value,"onUpdate:lf":v[0]||(v[0]=f=>a.value=f),"model-value":c.value,styles:y.value,tooltips:b.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(T(),$(k(p),{key:1,modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=f=>c.value=f),formData:n.value,"onUpdate:formData":v[2]||(v[2]=f=>n.value=f),formDefaults:d.value,"onUpdate:formDefaults":v[3]||(v[3]=f=>d.value=f),"form-options":k(Zt),"data-options":_.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const be=Te(qo,[["__scopeId","data-v-0b8d2722"]]),Qo=A({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=me(t),{flowDetail:p}=ce(),s=N(!1);function a({data:c}){c.type==="userTask"&&(s.value=!1,o.value=c.id)}return(c,l)=>{const r=V("el-button"),m=V("el-popover");return T(),$(m,{visible:s.value,"onUpdate:visible":l[0]||(l[0]=_=>s.value=_),placement:"bottom-start",width:"800px",trigger:"click"},{reference:w(()=>[g(r,null,{default:w(()=>[P(" 点击选择节点 ")]),_:1})]),default:w(()=>{var _,n;return[g(be,{"model-value":(n=(_=k(p))==null?void 0:_.process)==null?void 0:n.flowData,view:"",style:{height:"600px"},onNodeClick:a},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Go=A({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Le(),{useParam:p}=fe(),{formData:s,approvalFormData:a,activeBtn:c,approvalVisible:l,formVariables:r,flowDetail:m}=ce(),_=N([]),n=N([]),d=N([]),u=N([]),y=N(!1),b=N(!1),i=N(),v=N(),f={menuBtn:!1,labelWidth:100,column:[{label:"指定节点",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"传阅人",prop:"circulate",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function h(C,x,L){var Y,M,ye;const K=((Y=_.value[0])==null?void 0:Y.type)==="parallelGateway",H=(ye=(M=_.value[0])==null?void 0:M.children)==null?void 0:ye.every(re=>eo([re],Ne=>n.value.some(Ie=>Ie.id===Ne.id)));if(n.value.length){if(K&&!H)return L("请在每个节点选择审批人")}else return L("请选择审批人");return!0}const{data:D}=p("flow.default.comment"),{data:O}=p("flow.approval.autocheck");J(async()=>{var x;if(!l.value||!i.value||!v.value)return;R();const{taskId:C}=((x=m.value)==null?void 0:x.task)||{};_e(()=>{i.value.resetFields(),a.value.comment=s.value.comment||(C?"":D.value),v.value.jumpTaskNodeKey.display=I("specifyNode"),v.value.assignee.display=I("assignee"),v.value.circulate.display=I("circulate"),v.value.comment.display=I("comment")})}),J(async()=>{var L,K;if(!l.value||!I("assignee")||I("specifyNode")&&!a.value.jumpTaskNodeKey)return;R();const{flowKey:C}=((L=m.value)==null?void 0:L.process)||{},{taskId:x}=((K=m.value)==null?void 0:K.task)||{};try{b.value=!0;const H=await o({flowKey:C,taskId:x,variables:r.value,buttonType:c.value.buttonKey,jumpTaskNodeKey:a.value.jumpTaskNodeKey});_.value=H.data.approvalNodeList,d.value=H.data.circulateNodeList}finally{b.value=!1}});function R(){_.value=[],n.value=[],d.value=[],u.value=[]}function I(C){var x,L;return(L=(x=c.value)==null?void 0:x.approval)==null?void 0:L.includes(C)}async function F(){await ze(i),y.value=!0;const{data:C,outgoing:x}=S(n.value),{data:L}=S(u.value);a.value.assignee=C,a.value.outgoing=[...x],a.value.circulate=L,console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",s),t("confirm")}function S(C){const x={},L={},K=new Set;return C.forEach(H=>{const{taskNodeKey:Y,incoming:M}=H;x[Y]||(x[Y]=new Set),H.userId&&x[Y].add(H.userId),L[Y]=[...x[Y]].join(","),M&&K.add(M)}),{set:x,data:L,outgoing:K}}return(C,x)=>{const L=V("el-skeleton"),K=V("avue-form"),H=V("el-button"),Y=V("el-dialog");return T(),$(Y,{modelValue:k(l),"onUpdate:modelValue":x[7]||(x[7]=M=>ee(l)?l.value=M:null),class:"approlval-form",title:k(c).name,width:"900px","append-to-body":""},{footer:w(()=>[g(H,{onClick:x[6]||(x[6]=M=>l.value=!1)},{default:w(()=>[P(" 取 消 ")]),_:1}),g(H,{type:"primary",onClick:F},{default:w(()=>[P(" 确 定 ")]),_:1})]),default:w(()=>[g(K,{ref_key:"formRef",ref:i,modelValue:k(a),"onUpdate:modelValue":x[4]||(x[4]=M=>ee(a)?a.value=M:null),defaults:v.value,"onUpdate:defaults":x[5]||(x[5]=M=>v.value=M),option:f},{jumpTaskNodeKey:w(()=>[g(Qo,{modelValue:k(a).jumpTaskNodeKey,"onUpdate:modelValue":x[0]||(x[0]=M=>k(a).jumpTaskNodeKey=M)},null,8,["modelValue"])]),assignee:w(()=>[b.value?(T(),$(L,{key:0})):(T(),$(lt,{key:"AssigneeTree",modelValue:n.value,"onUpdate:modelValue":x[1]||(x[1]=M=>n.value=M),data:_.value,"auto-check":k(O)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:w(()=>[b.value?(T(),$(L,{key:0})):(T(),$(lt,{key:"CirculateTree",modelValue:u.value,"onUpdate:modelValue":x[2]||(x[2]=M=>u.value=M),data:d.value},null,8,["modelValue","data"]))]),comment:w(()=>[g(Ho,{modelValue:k(a).comment,"onUpdate:modelValue":x[3]||(x[3]=M=>k(a).comment=M)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Jo={class:"flow-form__title"},We=A({__name:"index",props:Ko(),emits:Mo(),setup(e,{emit:t}){const o=e,p=Bo(o,t),{flowDetail:s,tabList:a,activeTab:c,activeBtn:l,formLoading:r,approvalVisible:m,submitLoading:_}=p,n=N();async function d(b){var i,v;l.value=b,await((i=n.value)==null?void 0:i.validate()),await((v=o.beforeClick)==null?void 0:v.call(o,b)),(b==null?void 0:b.approval)!=="false"?m.value=!0:y()}const u=Eo(p);async function y(){var b,i;try{const{buttonKey:v}=l.value;_.value=!0,await((b=o.beforeSubmit)==null?void 0:b.call(o,l.value));const f=(i=u[v])==null?void 0:i.call(u);f instanceof Promise?(await f,G.success("操作成功"),m.value=!1,t("complete",l.value)):G.error("操作失败")}finally{_.value=!1}}return(b,i)=>{const v=V("el-skeleton"),f=V("el-main"),h=V("el-header"),D=V("el-tab-pane"),O=V("el-tabs"),R=V("el-container");return k(r)?(T(),$(f,{key:0},{default:w(()=>[g(v)]),_:1})):(T(),$(R,{key:1,class:"flow-form"},{default:w(()=>[g(h,{class:"flow-form__header",height:"auto"},{default:w(()=>{var I;return[Q("div",Jo,j(o.title??((I=k(s).flowInstance)==null?void 0:I.title)),1),b.detail?B("",!0):(T(),$(jo,{key:0,onClick:d})),zt(b.$slots,"button")]}),_:3}),g(f,{class:"flow-form__main"},{default:w(()=>[g(O,{modelValue:k(c),"onUpdate:modelValue":i[0]||(i[0]=I=>ee(c)?c.value=I:null)},{default:w(()=>[(T(!0),E(W,null,X(k(a),I=>(T(),$(D,{key:I.prop,label:I.label,name:I.prop,lazy:""},{default:w(()=>[I.prop==="formTab"?(T(),$(ot(b.$slots.default??I.component),{key:0,ref_for:!0,ref:F=>n.value=F},null,512)):(T(),$(ot(I.component),{key:1}))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(Go,{onConfirm:y})]),_:3}))}}});function Ct(e,t){switch(t.type){case"window":return Xo(e,t);case"dialog":case"drawer":return Zo(e,t);default:return{open:o=>{},close:()=>{}}}}function Xo(e,t){const{window:[o="",p="flow-form",s="left=0,top=0,width=1600,height=900"]=[]}=t,a=N(null),c=U(()=>`${o}?${Et(At(e,Kt(so,ro)))}`);return{open:m=>{var _;a.value=window.open(c.value,p,s),(_=a.value)==null||_.addEventListener("message",n=>{const{event:d}=n.data,u={...k(e),...k(m)}[d];typeof u=="function"&&u(n.data)})},close:()=>{var m;return(m=a.value)==null?void 0:m.close()},openedWindow:a}}function Zo(e,t){const{appContext:o}=it();let p;const s=c=>{p=document.createElement("div"),p.className="flow-form-wrapper";const l=el(t.formPath),r=Ue(l,{...k(e),...k(c)}),m=Ue(t.type==="dialog"?uo:io,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},r);m.appContext=o,Yt(m,p),document.body.appendChild(p)},a=()=>{p&&document.body.removeChild(p)};return{open:s,close:a}}function el(e){return e?Wt(()=>qt(()=>import(e),[])):We}const tl=A({setup(){const{flowDetail:e,formData:t,detail:o}=ce(),p=Ao(e.value),{proxy:s}=it(),a=N({});J(()=>{const{formOption:r}=e.value.process??{};a.value=ft.bind(s)(r||'{"menuBtn":false}'),a.value.detail=!!o.value});const c=N();function l(){return ze(c)}return{form:t,option:a,defaults:p,formRef:c,validate:l}},render(){return Ue(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),ol=A({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:o}=ce(),{upload:{action:p,headers:s,preview:a,download:c,props:l}={}}=z(),r=typeof s=="function"?s():s,m=U(()=>{var f,h;return((h=(f=t.value)==null?void 0:f.task)==null?void 0:h.flowInstanceId)??ut()}),_={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:n,getDataList:d,handleDel:u,handleSave:y,afterGetList:b,crudStateRefs:{tableData:i}}=Z({crudOption:{...dl(),saveSuccessMsg:"上传成功"},tableOption:_,queryForm:{isLatest:1,flowInstanceId:m.value}});b(()=>{o.value=i.value.map(f=>f.id).join(",")}),d();async function v(f,h){var C,x;const{fileName:D,fileType:O,fileSize:R,fileUrl:I,res:F}=l,S={fileName:ge({res:f},`${F}.${D}`),fileType:ge({res:f},`${F}.${O}`),fileSize:ge({res:f},`${F}.${R}`),fileUrl:ge({res:f},`${F}.${I}`),taskId:(x=(C=t.value)==null?void 0:C.task)==null?void 0:x.taskId,flowInstanceId:m.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await y(S,d,()=>{})}return(f,h)=>{const D=V("el-button"),O=V("el-upload"),R=V("avue-crud");return T(),$(R,oe(le(k(n))),{"menu-left":w(()=>[g(O,{action:k(p),headers:k(r),"show-file-list":!1,onSuccess:h[0]||(h[0]=I=>v(I))},{default:w(()=>[g(D,{type:"primary",icon:"el-icon-upload"},{default:w(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:w(({row:I,index:F})=>[g(D,{type:"primary",text:"",icon:"el-icon-view",onClick:S=>{var C;return(C=k(a))==null?void 0:C(I,k(i))}},{default:w(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),g(D,{type:"primary",text:"",icon:"el-icon-download",onClick:S=>{var C;return(C=k(c))==null?void 0:C(I,k(i))}},{default:w(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),g(O,{action:k(p),headers:k(r),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:S=>v(S,I)},{default:w(()=>[g(D,{type:"primary",text:"",icon:"el-icon-upload"},{default:w(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),g(D,{type:"primary",text:"",icon:"el-icon-delete",onClick:S=>k(u)(I,F)},{default:w(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),ll={class:"flow-track"},al={key:0},nl={key:1},sl=A({__name:"flow-track",setup(e){const{flowDetail:t}=ce(),o=N("table"),p=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],s=U(()=>{var r,m,_;return((_=(m=(r=t.value)==null?void 0:r.flowHistory)==null?void 0:m.filter(n=>n.taskNodeType==="userTask"))==null?void 0:_.map(n=>({...n,duration:Mt(n.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},{data:c}=fe().useParam("flow.handle.type");function l(r){var m;return(m=c.value)==null?void 0:m.find(_=>_.value===r)}return(r,m)=>{var v,f,h;const _=V("el-radio-button"),n=V("el-radio-group"),d=V("avue-crud"),u=V("el-card"),y=V("el-timeline-item"),b=V("el-timeline"),i=V("el-empty");return T(),E(W,null,[g(n,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=D=>o.value=D)},{default:w(()=>[(T(),E(W,null,X(p,D=>g(_,{key:D.label,label:D.label},{default:w(()=>[g(k(se),{icon:D.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",ll,[o.value==="table"?(T(),$(d,{key:0,data:s.value,option:a},null,8,["data"])):B("",!0),o.value==="graph"?(T(),$(be,{key:1,"model-value":(f=(v=k(t))==null?void 0:v.process)==null?void 0:f.flowData,"flow-history":(h=k(t))==null?void 0:h.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):B("",!0),o.value==="timeline"?(T(),E(W,{key:2},[s.value.length?(T(),$(b,{key:0},{default:w(()=>[(T(!0),E(W,null,X([...s.value].reverse(),D=>(T(),$(y,{key:D.id,timestamp:D.endTime,placement:"top"},{default:w(()=>[g(u,null,{default:w(()=>{var O,R,I;return[Q("div",null,j(D.assigneeName)+" 开始处理 ["+j(D.taskNodeName)+"] 环节 ",1),D.duration?(T(),E("div",al," 办理时长："+j(D.duration),1)):B("",!0),D.type&&((O=D.comment)!=null&&O.handleComment)?(T(),E("div",nl,j((R=l(D.type))==null?void 0:R.label)+"意见："+j((I=D.comment)==null?void 0:I.handleComment),1)):B("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),$(i,{key:1}))],64)):B("",!0)])],64)}}});const rl=Te(sl,[["__scopeId","data-v-0411478e"]]),nt=Symbol("flowPagesConfig"),ul={FlowDesign:{},FormDesign:{},FlowForm:We,tabs:[{label:"审批表单",prop:"formTab",component:tl},{label:"附件资料",prop:"fileTab",component:ol},{label:"流程跟踪",prop:"trackTab",component:rl}],request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Vt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Vt||{});const Ae=ne(Vt);function z(e,t){return e&&t?(e.provide(nt,Bt(ul,t)),t):Me(nt)}function il(){const{request:e}=z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=r=>e.get(t.list,{params:{type:r,ascs:"sort"}});return{url:t,getList:o,useList:r=>ie(()=>o(r.value).then(m=>m.data.records),{refreshDeps:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),batchUpdate:r=>e.post(t.batchUpdate,r)}}var Dt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Dt||{}),Ye=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Ye||{}),qe=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(qe||{}),Tt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Tt||{});function Qe(){const{request:e}=z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function cl(){const{request:e}=z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function xt(){const{request:e}=z(),t={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:t,getCirculateList:c=>e.get(t.list,{params:c}),getCirculateOpsList:c=>e.get(t.list,{params:c}),updateCirculate:c=>e.post(t.update,c),removeCirculate:c=>e.post(t.remove,{},{params:{ids:c}})}}function Ge(){const{request:e}=z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:r=>e.get(t.list,{params:r}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r),getDetail:r=>e.get(t.detail,{params:r})}}var Lt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Lt||{});function Je(){const{request:e}=z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:c=>e.get(t.list,{params:c}),getDetail:c=>e.get(t.detail,{params:c}),update:c=>e.post(t.update,c),remove:c=>e.post(t.remove,{},{params:{ids:c}})}}function dl(){const{request:e}=z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function pl(){const{request:e}=z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getTaskOpsList:p=>e.get(t.list,{params:p})}}function fe(){const{request:e}=z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=m=>e.get(t.list,{params:m}),p=()=>e.get(t.all),s=m=>e.get(t.key,{params:{paramKey:m}});return{url:t,getList:o,getAllParam:p,getParam:s,useParam:m=>ie(()=>s(m).then(_=>_.data)),create:m=>e.post(t.save,m),update:m=>e.post(t.update,m),remove:m=>e.post(t.remove,{},{params:{ids:m}})}}function Nt(){const{request:e}=z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ml(){const{request:e}=z(),t={tree:"/sapier-flow/flow-user/tree"},o=s=>e.get(t.tree,{params:{filter:s}});return{url:t,getUserTree:o,useUserTree:()=>ie(()=>o().then(s=>s.data))}}function It(){const{request:e}=z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var Ot=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Ot||{});function Ke(){const{request:e}=z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=r=>e.get(t.list,{params:r});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(r=>r.data.records)),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}}),deploy:r=>e.post(t.deploy,r)}}const fl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ne(Dt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(Ye),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(qe),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:ne(Tt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},vl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:p}=Z({tableOption:fl,crudOption:Qe(),sortOption:{ascs:"sort"}});return p(),(s,a)=>{const c=V("el-button"),l=V("avue-crud");return T(),$(l,oe(le(k(t))),{icon:w(({row:r})=>[g(k(se),{icon:r.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:w(({row:r})=>[g(c,{type:r.buttonType},{default:w(()=>[g(k(se),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":w(()=>[g(c,{type:k(o).buttonType},{default:w(()=>[g(k(se),{icon:k(o).icon},null,8,["icon"]),P(" "+j(k(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},_l={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Xe.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},$t=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:p,deploy:s,remove:a}=Ge(),{bindVal:c,crudStateRefs:{searchForm:l},getDataList:r}=Z({tableOption:_l,crudOption:{getList:p,remove:a},searchForm:{categoryId:o.categoryId}});J(()=>{l.value.categoryId=o.categoryId??"",r()});const m=N(!1);async function _(d){await de.confirm("发布新版本，是否确认？","提示",{type:"success"}),m.value=!0,s({flowModuleId:d.flowModuleId}).then(()=>{G.success("发布成功"),r()}).finally(()=>{m.value=!1})}async function n(d){if(console.log("🚀 ~ file: index.vue:49 ~ handleDel ~ row:",d),d.mainVersion)return G.warning("请先删除已发布的流程");await de.confirm("确认删除？","提示",{type:"warning"}),await a(d.flowModuleId),G.success("删除成功"),r()}return(d,u)=>{const y=V("el-button"),b=V("el-dropdown-item"),i=V("avue-crud");return T(),$(i,oe(le(k(c))),{"menu-left":w(()=>[g(y,{type:"primary",icon:"el-icon-plus",onClick:u[0]||(u[0]=v=>t("add"))},{default:w(()=>[P(" 新增 ")]),_:1})]),"menu-btn":w(({row:v})=>[g(b,{icon:"el-icon-view",onClick:f=>t("view",v)},{default:w(()=>[P(" 查看 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-edit",onClick:f=>t("edit",v)},{default:w(()=>[P(" 编辑 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-delete",onClick:f=>n(v)},{default:w(()=>[P(" 删除 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-upload",onClick:f=>_(v)},{default:w(()=>[P(" 发布 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-switch",onClick:f=>t("version",v)},{default:w(()=>[P(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:w(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),wl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Xe.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},St=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:p,update:s,remove:a}=Je(),{bindVal:c,crudStateRefs:{searchForm:l},getDataList:r}=Z({tableOption:wl,crudOption:{getList:p,dataPath:"res.data"}});J(()=>{o.flowModuleId&&(l.value.flowModuleId=o.flowModuleId,r())});const m=N(!1);async function _(d){await de.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),m.value=!0,s({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{G.success("设置成功"),r()}).finally(()=>{m.value=!1})}async function n(d){const{value:u}=await de.prompt("请输入确认删除的流程标识","提示",{type:"warning"});u===d.flowKey&&(await a(d.flowDeployId),G.success("删除成功"),r())}return(d,u)=>{const y=V("el-button"),b=V("el-dropdown-item"),i=V("avue-crud");return T(),$(i,oe(le(k(c))),{"menu-left":w(()=>[g(y,{loading:m.value,type:"primary",icon:"el-icon-arrow-left",onClick:u[0]||(u[0]=v=>t("back"))},{default:w(()=>[P(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":w(({row:v})=>[g(b,{icon:"el-icon-view",onClick:f=>t("view",v)},{default:w(()=>[P(" 查看 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-edit",onClick:f=>t("edit",v)},{default:w(()=>[P(" 编辑 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-delete",onClick:f=>n(v)},{default:w(()=>[P(" 删除 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-switch",disabled:v.mainVersion===k(Lt).是,onClick:f=>_(v)},{default:w(()=>[P(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:w(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},bl=A({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:p},getDataList:s,handleSave:a,handleUpdate:c,handleDel:l}=Z({crudOption:{rowKey:"id",...cl(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});s();function r(n,d,u,y){a(d,u,y)}function m(n,d,u,y){c(d,NaN,u,y)}async function _(n,d){await l(n.data,NaN),d()}return(n,d)=>{const u=V("avue-tree");return T(),$(u,{modelValue:k(o),"onUpdate:modelValue":d[0]||(d[0]=y=>ee(o)?o.value=y:null),option:k(st),data:k(p),onNodeClick:d[1]||(d[1]=y=>t("node-click",y)),onSave:r,onUpdate:m,onDel:_},null,8,["modelValue","option","data"])}}}),Ze=A({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var r;const o=e,{FormDesign:p}=z(),s=U({get(){return o.modelValue?ft(o.modelValue):{menuBtn:!1,span:24}},set(m){t("update:modelValue",to(m,{useJson5:!1}))}}),a=U(()=>o.fields?JSON.parse(o.fields):[]),c=U(()=>{const m={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...m,props:{label:"name",value:"name",desc:"comment"}},{...m,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((r=oo.settings)==null?void 0:r.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(m,_)=>{const n=V("avue-form");return m.view?(T(),$(n,{key:0,class:Qt(s.value.class),"model-value":{},option:s.value},null,8,["class","option"])):(T(),$(k(p),{key:1,modelValue:s.value,"onUpdate:modelValue":_[0]||(_[0]=d=>s.value=d),"base-option":c.value,resources:l},null,8,["modelValue","base-option"]))}}}),yl=Q("span",null,"流程设计",-1),gl={key:0},hl={key:1},kl={style:{height:"calc(100vh - 144px)"}},Cl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const p=me(e),{visible:s,modelValue:a}=p,{create:c,deploy:l,getDetail:r,update:m}=Ge(),{getDetail:_,update:n}=Je(),d=["流程信息","表单设计","模型设计","完成"],u=N(!1);pe(s,async S=>{if(!S)return;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{u.value=!0;let L={};x?L=await _({flowDeployId:x}):C&&(L=await r({flowModuleId:C})),a.value=L.data}finally{u.value=!1}},{immediate:!0});const{data:y}=It().useList(),{data:b}=Nt().useList(),{data:i}=Ke().useList(),v=U(()=>{var S,C;return(C=(S=i.value)==null?void 0:S.find(x=>x.tableName===a.value.formDataTable))==null?void 0:C.tableFields}),f=N(0),h=U(()=>{var S,C;return f.value===1?((S=y.value)==null?void 0:S.map(x=>({label:x.formName,value:x.formOption})))??[]:f.value===2?((C=b.value)==null?void 0:C.map(x=>({label:x.flowName,value:x.flowData})))??[]:[]});function D(S){f.value===1?a.value.formOption=S.value:f.value===2&&(a.value.flowData=S.value)}const O=N();async function R(S){f.value===0&&await ze(O),u.value=!0;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{x?await n(a.value):C?await m(a.value):await c(a.value).then(L=>{a.value.flowModuleId=L.data.flowModuleId}),G.success("保存成功")}finally{u.value=!1}typeof S=="number"?f.value=S:f.value++}async function I(){await de.confirm("发布新版本，是否确认？","提示"),u.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{G.success("发布成功")}).finally(()=>{u.value=!1})}function F(){s.value=!1,f.value=0,a.value={},t("close")}return(S,C)=>{const x=V("el-link"),L=V("el-dropdown-item"),K=V("el-dropdown-menu"),H=V("el-dropdown"),Y=V("el-col"),M=V("el-step"),ye=V("el-steps"),re=V("el-button"),Ne=V("el-row"),Ie=V("avue-form"),Rt=V("el-result"),Ft=V("el-dialog"),Pt=ct("loading");return T(),$(Ft,{modelValue:k(s),"onUpdate:modelValue":C[5]||(C[5]=q=>ee(s)?s.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:F},{header:w(()=>[g(Ne,{justify:"center"},{default:w(()=>[g(Y,{span:5},{default:w(()=>{var q,ve,Oe,et;return[Q("div",null,[yl,(q=k(a))!=null&&q.flowName?(T(),E("span",gl," - "+j((ve=k(a))==null?void 0:ve.flowName),1)):B("",!0),(Oe=k(a))!=null&&Oe.version?(T(),E("span",hl," - V"+j((et=k(a))==null?void 0:et.version),1)):B("",!0)]),h.value.length?(T(),$(H,{key:0},{dropdown:w(()=>[g(K,null,{default:w(()=>[(T(!0),E(W,null,X(h.value,$e=>(T(),$(L,{key:$e.label,onClick:ql=>D($e)},{default:w(()=>[P(j($e.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:w(()=>[g(x,{icon:"el-icon-arrow-down",underline:!1},{default:w(()=>[P(" 选择模板 ")]),_:1})]),_:1})):B("",!0)]}),_:1}),g(Y,{span:14},{default:w(()=>[g(ye,{active:f.value,simple:"","process-status":"finish","finish-status":"success"},{default:w(()=>[(T(),E(W,null,X(d,(q,ve)=>g(M,{key:ve,title:q,onClick:Oe=>R(ve)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),g(Y,{span:5,style:{"text-align":"right"}},{default:w(()=>[g(re,{disabled:f.value===0,loading:u.value,type:"primary",onClick:C[0]||(C[0]=q=>f.value--)},{default:w(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),g(re,{disabled:f.value===d.length-1,type:"primary",loading:u.value,onClick:C[1]||(C[1]=q=>R())},{default:w(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),g(re,{onClick:F},{default:w(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:w(()=>[dt((T(),E("div",kl,[f.value===0?(T(),$(Ie,{key:0,ref_key:"formRef",ref:O,modelValue:k(a),"onUpdate:modelValue":C[2]||(C[2]=q=>ee(a)?a.value=q:null),option:k(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),f.value===1?(T(),$(Ze,{key:1,modelValue:k(a).formOption,"onUpdate:modelValue":C[3]||(C[3]=q=>k(a).formOption=q),fields:v.value},null,8,["modelValue","fields"])):B("",!0),f.value===2?(T(),$(be,{key:2,modelValue:k(a).flowData,"onUpdate:modelValue":C[4]||(C[4]=q=>k(a).flowData=q),"flow-form-option":k(a).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),f.value===3?(T(),$(Rt,{key:3,icon:"success",title:"流程设计完成"},{extra:w(()=>[k(a).flowDeployId?B("",!0):(T(),$(re,{key:0,type:"primary",onClick:I},{default:w(()=>[P(" 发布 ")]),_:1})),g(re,{onClick:F},{default:w(()=>[P(" 关闭 ")]),_:1})]),_:1})):B("",!0)])),[[Pt,u.value]])]),_:1},8,["modelValue"])}}}),Vl=Q("span",null,"流程查看",-1),Dl={key:0},Tl={key:1},xl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=me(e),{visible:p,modelValue:s}=o,{getDetail:a}=Ge(),{getDetail:c}=Je(),l=N("form"),r=N(!1);pe(p,async _=>{if(!_)return;const{flowModuleId:n}=s.value,{flowDeployId:d}=s.value;try{r.value=!0;let u={};d?u=await c({flowDeployId:d}):n&&(u=await a({flowModuleId:n})),s.value={...u.data}}finally{r.value=!1}},{immediate:!0});function m(){s.value={},l.value="form"}return(_,n)=>{const d=V("el-tab-pane"),u=V("el-tabs"),y=V("el-dialog"),b=ct("loading");return T(),$(y,{modelValue:k(p),"onUpdate:modelValue":n[3]||(n[3]=i=>ee(p)?p.value=i:null),width:"60%",top:"0",onClose:m},{header:w(()=>{var i,v,f,h;return[Vl,(i=k(s))!=null&&i.flowName?(T(),E("span",Dl," - "+j((v=k(s))==null?void 0:v.flowName),1)):B("",!0),(f=k(s))!=null&&f.version?(T(),E("span",Tl," - V"+j((h=k(s))==null?void 0:h.version),1)):B("",!0)]}),default:w(()=>[dt((T(),$(u,{modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=i=>l.value=i)},{default:w(()=>[g(d,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:w(()=>[l.value==="form"&&k(s).formOption?(T(),$(Ze,{key:0,modelValue:k(s).formOption,"onUpdate:modelValue":n[0]||(n[0]=i=>k(s).formOption=i),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),g(d,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:w(()=>[l.value==="flow"?(T(),$(be,{key:0,modelValue:k(s).flowData,"onUpdate:modelValue":n[1]||(n[1]=i=>k(s).flowData=i),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[b,r.value]])]),_:1},8,["modelValue"])}}}),Ll=A({__name:"index",setup(e){const t=N("definition"),o=N({}),p=N(""),s=N("");function a(y){p.value===y.id?p.value="":p.value=y.id}const c=N(!1),l=N(!1);function r(){o.value={},c.value=!0}function m(y){o.value=y,c.value=!0}function _(y){o.value=y,l.value=!0}function n(y){s.value=y.flowModuleId||"",t.value="deploy"}function d(){s.value="",t.value="definition"}async function u(){const y=t.value;await _e(),t.value="",await _e(),t.value=`${y}`}return(y,b)=>{const i=V("el-col"),v=V("el-row");return T(),$(v,{gutter:20},{default:w(()=>[g(i,{span:4},{default:w(()=>[g(bl,{onNodeClick:a})]),_:1}),g(i,{span:20},{default:w(()=>[t.value==="definition"?(T(),$($t,{key:0,"category-id":p.value,onAdd:r,onEdit:m,onView:_,onVersion:n},null,8,["category-id"])):B("",!0),t.value==="deploy"?(T(),$(St,{key:1,"flow-module-id":s.value,onEdit:m,onView:_,onBack:d},null,8,["flow-module-id"])):B("",!0),g(Cl,{modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=f=>o.value=f),visible:c.value,"onUpdate:visible":b[1]||(b[1]=f=>c.value=f),onClose:u},null,8,["modelValue","visible"]),g(xl,{modelValue:o.value,"onUpdate:modelValue":b[2]||(b[2]=f=>o.value=f),visible:l.value,"onUpdate:visible":b[3]||(b[3]=f=>l.value=f)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Nl=[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),Il=[{label:"审批人",prop:"assignee"},{label:"节点名称",prop:"taskNodeName"},{label:"接收时间",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"结束时间",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"耗时",prop:"duration"},{label:"传阅意见",prop:"comment"}].map(e=>({...e,hide:!0})),Ol={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Nl,...Il]},$l=A({__name:"index",setup(e){const t=ao("debugMode",!1),{getTaskOpsList:o}=pl(),{getCirculateOpsList:p,updateCirculate:s,removeCirculate:a}=xt(),{bindVal:c,getDataList:l,crudStateRefs:{searchForm:r,crudOption:m}}=Z({tableOption:Ol,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});xe(r,l,{debounce:300,immediate:!0,deep:!0});const _=N("task"),n=[{label:"任务",name:"task",getList:o},{label:"传阅",name:"circulate",getList:p,update:s,remove:a}];function d({paneName:i}){const v=n.find(f=>f.name===i);m.value.getList=v.getList,m.value.update=v.update,m.value.remove=v.remove,l()}const{open:u,close:y}=Ct({onComplete:()=>(y(),l())},{type:"drawer"});function b(i){u({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,debug:t.value,circulateId:i.id})}return(i,v)=>{const f=V("el-tab-pane"),h=V("el-tabs"),D=V("el-switch"),O=V("el-button"),R=V("el-link"),I=V("avue-crud");return T(),E(W,null,[g(h,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=F=>_.value=F),onTabClick:d},{default:w(()=>[(T(),E(W,null,X(n,F=>g(f,{key:F.name,label:F.label,name:F.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(I,Gt(k(c),{permission:{menu:_.value==="circulate"}}),{"menu-right":w(()=>[g(O,{type:"text"},{default:w(()=>[g(D,{modelValue:k(t),"onUpdate:modelValue":v[1]||(v[1]=F=>ee(t)?t.value=F:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:w(({row:F})=>[g(R,{type:"primary",underline:!1,onClick:S=>b(F)},{default:w(()=>[P(j(F.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ae},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Rl=A({__name:"index",setup(e){const{bindVal:t,getDataList:o}=Z({tableOption:Sl,crudOption:fe()});return o(),(p,s)=>{const a=V("avue-crud");return T(),$(a,oe(le(k(t))),null,16)}}}),Fl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Pl={class:"flow-list"},Ul=["onClick"],El={class:"flow-name"},Al=A({__name:"index",setup(e){const t=N([]),{getPublishList:o,getTaskList:p}=Le(),{getCirculateList:s}=xt();o().then(i=>{t.value=i.data});const a=[{label:"待办",value:2},{label:"已办",value:1}],{bindVal:c,getDataList:l,crudStateRefs:{searchForm:r,crudOption:m}}=Z({tableOption:Fl,crudOption:{getList:p},searchForm:{status:2}});xe(r,l,{debounce:300,immediate:!0,deep:!0});const _=N("task"),n=[{label:"任务",name:"task",getList:p},{label:"传阅",name:"circulate",getList:s}];function d({paneName:i}){const v=n.find(f=>f.name===i);m.value.getList=v.getList,l()}const{open:u,close:y}=Ct({onComplete:()=>(y(),l())},{type:"drawer"});function b(i){u({flowKey:i.flowKey,taskId:i.taskId,instanceId:i.flowInstanceId,circulateId:i.id,detail:i.taskId?i.status===ht.已办:!1})}return(i,v)=>{const f=V("el-button"),h=V("el-collapse-item"),D=V("el-collapse"),O=V("el-card"),R=V("el-divider"),I=V("el-tab-pane"),F=V("el-tabs"),S=V("avue-radio"),C=V("el-link"),x=V("avue-crud");return T(),E(W,null,[g(O,{"body-style":{padding:"0 20px"}},{default:w(()=>[g(D,{"model-value":"1"},{default:w(()=>[g(h,{name:"1"},{title:w(()=>[g(f,{text:"",icon:"el-icon-promotion"},{default:w(()=>[P(" 发起审批 ")]),_:1})]),default:w(()=>[Q("div",Pl,[(T(!0),E(W,null,X(t.value,L=>(T(),E("div",{key:L.flowKey,class:"flow-item",onClick:K=>b(L)},[g(k(se),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),Q("div",El,j(L.flowName),1)],8,Ul))),128))])]),_:1})]),_:1})]),_:1}),g(R,{direction:"horizontal","content-position":"left"}),g(F,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=L=>_.value=L),onTabClick:d},{default:w(()=>[(T(),E(W,null,X(n,L=>g(I,{key:L.name,label:L.label,name:L.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(x,oe(le(k(c))),{"menu-left":w(()=>[g(S,{modelValue:k(r).status,"onUpdate:modelValue":v[1]||(v[1]=L=>k(r).status=L),button:"",dic:a},null,8,["modelValue"])]),processTitle:w(({row:L})=>[g(C,{type:"primary",underline:!1,onClick:K=>b(L)},{default:w(()=>[P(j(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Kl=Te(Al,[["__scopeId","data-v-e1f72e36"]]),Ml={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Bl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:p,handleUpdate:s}=Z({tableOption:Ml,crudOption:Nt()});p();const a=N(!1);async function c(r){o.value=r,a.value=!0}async function l(){await s(o.value,NaN,()=>a.value=!1,()=>{})}return(r,m)=>{const _=V("el-button"),n=V("avue-crud"),d=V("el-dialog");return T(),E(W,null,[g(n,oe(le(k(t))),{flowData:w(({row:u})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(u)},{default:w(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=u=>a.value=u),title:`模型设计-${k(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:w(()=>[g(_,{type:"primary",onClick:l},{default:w(()=>[P(" 保存 ")]),_:1}),g(_,{onClick:m[1]||(m[1]=u=>a.value=!1)},{default:w(()=>[P(" 取消 ")]),_:1})]),default:w(()=>[g(be,{modelValue:k(o).flowData,"onUpdate:modelValue":m[0]||(m[0]=u=>k(o).flowData=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),jl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Hl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:p,handleUpdate:s}=Z({tableOption:jl,crudOption:It()});p();const a=N(!1);async function c(r){o.value={...r},a.value=!0}async function l(){await s(o.value,NaN,()=>a.value=!1,()=>{})}return(r,m)=>{const _=V("el-button"),n=V("avue-crud"),d=V("el-dialog");return T(),E(W,null,[g(n,oe(le(k(t))),{formOption:w(({row:u})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(u)},{default:w(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=u=>a.value=u),title:`表单设计-${k(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:w(()=>[g(_,{type:"primary",onClick:l},{default:w(()=>[P(" 保存 ")]),_:1}),g(_,{onClick:m[1]||(m[1]=u=>a.value=!1)},{default:w(()=>[P(" 取消 ")]),_:1})]),default:w(()=>[g(Ze,{modelValue:k(o).formOption,"onUpdate:modelValue":m[0]||(m[0]=u=>k(o).formOption=u),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),rt=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ne(Ot)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}],zl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:rt}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:rt}}]},Wl=Q("br",null,null,-1),Yl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o,defaults:p},getDataList:s,afterOpen:a,beforeSubmit:c}=Z({crudOption:Ke(),tableOption:zl});s();const{data:l}=fe().useParam("table.default.fields");a(d=>{if(o.value.defaultFields=l.value??[],d==="edit"){const u=JSON.parse(o.value.tableFields);o.value.editFields=vt(u,l.value??[],"name")}}),c(d=>{const u=[...d.defaultFields,...d.editFields];d.tableFields=JSON.stringify(u)});const r=N(!1);J(()=>{var d;(d=p.value)!=null&&d.defaultFields&&(p.value.defaultFields.display=r.value)});const{deploy:m}=Ke(),_=N(!1);async function n(d){await de.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,m({id:d.id}).then(()=>{G.success("部署成功"),s()}).finally(()=>{_.value=!1})}return(d,u)=>{const y=V("el-button"),b=V("el-switch"),i=V("el-tooltip"),v=V("avue-crud");return T(),$(v,oe(le(k(t))),{menu:w(({row:f})=>[g(y,{type:"text",icon:"el-icon-upload",onClick:h=>n(f)},{default:w(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),"editFields-label":w(()=>[Q("div",null,[P(" 数据库字段 "),Wl,g(i,{content:"显示默认字段"},{default:w(()=>[g(b,{modelValue:r.value,"onUpdate:modelValue":u[0]||(u[0]=f=>r.value=f)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),en={install(e,t){e.component("FlowButton",vl).component("FlowDefinition",$t).component("FlowDeploy",St).component("FlowForm",We).component("FlowManage",Ll).component("FlowOps",$l).component("FlowParam",Rl).component("FlowTemplate",Bl).component("FormTemplate",Hl).component("TableTemplate",Yl).component("FlowWorkbench",Kl),z(e,t)}};export{ul as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,vl as FlowButton,$t as FlowDefinition,St as FlowDeploy,We as FlowForm,Ll as FlowManage,$l as FlowOps,Rl as FlowParam,Bl as FlowTemplate,Kl as FlowWorkbench,Hl as FormTemplate,Yl as TableTemplate,Vt as Whether,en as default,el as resolveFlowFormComponent,z as useConfigProvider,Ct as useFlowForm,Zo as useFlowFormOverlay,Xo as useFlowFormWindow,Ae as whetherDic};
