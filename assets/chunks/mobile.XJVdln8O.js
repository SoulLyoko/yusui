import{d as Me}from"./index.o5MRxqVR.js";import"./index.es.NPg-IaLe.js";import{I as Ie}from"./iconify.ioxkyuwC.js";import{a as me,f as Ge,g as He,w as Fe,h as Je}from"./index.HumRCL84.js";import{j as Qe}from"./tree.2A7-G9Fa.js";import"./index.9cJsAPUu.js";import"./vuedraggable.umd._uxLVrZP.js";import{e as X}from"./index.kqOif1Uk.js";import{u as ee}from"./index.ozuDmZct.js";import{b as We}from"./index.uLAdNeiK.js";import"./form.o6KC_1qt.js";import"./index.cMPhMb2R.js";import{ai as Te,y as Xe,g as R,h as G,z as re,m as i,P as be,$ as Ye,N as Ze,X as qe,d as q,D as $,c as H,E as oe,F as Y,o as _,b as x,w as y,e as F,a as J,t as Q,I as A,a5 as de,a2 as Ne,M as $e,k as le,_ as we,J as Pe,a4 as et,a7 as tt,ac as at,ad as ot,G as lt,O as nt}from"./framework.9dEYo5Bo.js";import{m as rt,u as st}from"./index.vr3L8IcF.js";import{E as pe}from"./index.0wEB5RRz.js";import{p as it}from"./pick.hwSZBMEn.js";import{t as Oe,a as ut}from"./index.qJIJBhna.js";import{u as Le}from"./index.uIvVZULY.js";import{d as ct}from"./zipWith.cDKToSoU.js";import{d as pt}from"./data.qFFybvHa.js";import{g as ce}from"./get.ibBWnMyK.js";import{c as dt}from"./cloneDeep.r1x5-OIa.js";import{m as mt}from"./merge.etFcUWJt.js";function ae(e){const{tableOption:t}=te(),a=Te({...t,...e});return Xe(t,()=>Object.assign(a,t)),a}function ft(e){const{buttonHandler:t,request:a}=te(),{commitTask:n,revokeTask:f,saveDraft:l,startTask:s,terminateTask:g,transferTask:c,withdrawTask:b,rejectTask:r,greenChannel:k}=ge(a),o=R(()=>{const{flowDetail:v,formVariables:S,approvalFormData:O,debug:u,fileIds:j}=e,{flowDeployId:C}=v.value.process??{},{taskId:w,flowInstanceId:d}=v.value.task??{};return{flowDeployId:C,taskId:w,flowInstanceId:d,variables:S.value,debug:u.value,fileIds:j==null?void 0:j.value,...O.value}}),p=()=>o.value.taskId&&o.value.flowInstanceId;return{flow_draft(){if(p())return l(o.value)},flow_pass(){return p()?n(o.value):s(o.value)},flow_revoke(){if(p())return f(o.value)},flow_withdraw(){if(p())return b(o.value)},flow_terminate(){if(p())return g(o.value)},flow_transfer(){if(p())return c(o.value)},flow_reject(){if(p())return r(o.value)},flow_green(){if(p())return k(o.value)},...t==null?void 0:t(e)}}function vt(){const e=rt();return{emitter:e,onAfterGetDetail:l=>{e.on("afterGetDetail",async(...s)=>await(l==null?void 0:l(...s)))},onBeforeClick:l=>{e.on("beforeClick",async(...s)=>await(l==null?void 0:l(...s)))},onBeforeSubmit:l=>{e.on("beforeSubmit",async(...s)=>await(l==null?void 0:l(...s)))},onAfterSubmit:l=>{e.on("afterSubmit",async(...s)=>await(l==null?void 0:l(...s)))}}}function Ue(e,t){e.forEach(a=>{var f,l,s,g,c,b;const n=t==null?void 0:t.find(r=>r.prop===a.prop);n&&(a.display=n.display,a.disabled=n.disabled,a.detail=n.detail,a.readonly=n.readonly,a.rules=n.validate?a.rules??[]:[],n.required&&!((f=a.rules)!=null&&f.some(r=>r.required))?(l=a.rules)==null||l.push({required:!0,message:`${a.label}为必填项`}):n.required||(a.rules=a.rules.filter(r=>!r.required)),(g=(s=a.children)==null?void 0:s.column)!=null&&g.length&&((c=n.children)!=null&&c.length)&&Ue((b=a.children)==null?void 0:b.column,n.children))})}function bt(e){const t=G({});return re(async()=>{var n;const{formProperty:a}=((n=i(e))==null?void 0:n.properties)||{};a!=null&&a.length&&(await be(),Ue(Object.values(t.value),a))}),t}const wt={modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalVisible:{type:Boolean},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},fileIds:{type:String},permission:{type:Object},afterGetDetail:{type:Function},beforeClick:{type:Function},beforeSubmit:{type:Function},afterSubmit:{type:Function},detail:{type:[Boolean,String],default:!1},debug:{type:[Boolean,String],default:!1}},yt={complete:e=>e},Se=Symbol("flowFormState");function _t(e,t){const a=me(e,void 0,{passive:!0,deep:!0}),{flowDetail:n,modelValue:f,formLoading:l,submitLoading:s,activeTab:g,activeBtn:c,approvalVisible:b,afterGetDetail:r,beforeClick:k,beforeSubmit:o,afterSubmit:p}=a,v=vt(),{tabs:S,customForm:O,request:u,flowParams:j}=te(),C=G({}),w=R(()=>(S==null?void 0:S.filter(I=>{var B,M,ue;const N=(ue=(M=(B=n.value)==null?void 0:B.properties)==null?void 0:M.formProperty)==null?void 0:ue.find(fe=>fe.prop===I.prop),E={...I,display:(N==null?void 0:N.display)??I.display};return(E==null?void 0:E.display)!==!1}).map(I=>{var E,B;let N=I.component;if(I.prop==="formTab"){const M=O==null?void 0:O[((B=(E=n==null?void 0:n.value)==null?void 0:E.process)==null?void 0:B.formPath)??""];typeof M=="function"?N=qe(M):M&&(N=M)}return{...I,component:N}}))??[]),d=G();Z()&&Ge(d,{threshold:300,onSwipeEnd(I,N){if(!["left","right"].includes(N))return;const E=w.value.findIndex(M=>M.prop===g.value),B=He(E+(N==="right"?-1:1),0,w.value.length-1);g.value=w.value[B].prop}});const{getFlowDetail:L}=ge(u);re(()=>{const{flowKey:I,taskId:N,instanceId:E}=e;!I&&!N&&!E||(l.value=!0,L({flowKey:I,taskId:N,flowInstanceId:E}).then(async B=>{n.value=B.data,f.value={...B.data.formData,...f.value},setTimeout(async()=>{var M;await((M=r==null?void 0:r.value)==null?void 0:M.call(r,B.data)),await v.emitter.emitAsync("afterGetDetail",B.data)},300)}).finally(()=>{l.value=!1}))});const{useParams:T}=je(u),{data:m}=T(),V=R(()=>({...j,...m.value}));function U(I){return R(()=>V.value[I])}const P=R(()=>Object.entries(f.value||{}).filter(([I])=>!I.startsWith("$")).map(([I,N])=>({key:I,value:N}))),z=R(()=>e.detail===!0||e.detail==="true"),D={...a,...v,formData:f,formVariables:P,tabRefs:C,tabList:w,detail:z,tabsRef:d,emit:t,onButtonClick:h,onSubmit:W,flowParams:V,useFlowParam:U};Ye(Se,D);async function h(I){var N,E;if(c.value=I,I.validate===1)for(const B of Object.values(C.value))await((N=B==null?void 0:B.validate)==null?void 0:N.call(B));await((E=k==null?void 0:k.value)==null?void 0:E.call(k,I)),await v.emitter.emitAsync("beforeClick",I),(I==null?void 0:I.approval)!=="false"?b.value=!0:W()}const K=ft(D);async function W(){var I,N;try{s.value=!0,await((I=o==null?void 0:o.value)==null?void 0:I.call(o,c.value)),await v.emitter.emitAsync("beforeSubmit",c.value);const{buttonKey:E}=c.value,B=K[E];if(!B){pe.error("没有找到相应的操作");return}const M=await(B==null?void 0:B());await((N=p==null?void 0:p.value)==null?void 0:N.call(p,M)),await v.emitter.emitAsync("afterSubmit",M),b.value=!1,t("complete",c.value)}finally{s.value=!1}}return D}function ne(){return Ze(Se)}const De=q({__name:"ButtonList",emits:["click"],setup(e,{emit:t}){const a=t,{userInfo:n,request:f}=te(),{flowDetail:l,submitLoading:s}=ne(),{data:g}=Ke(f).useList();function c(r,k){return r.map(o=>{const p=k.find(S=>S.buttonKey===o.buttonKey);return{...o,...it(p,["display","approval","validate"])}})}const b=R(()=>{var w,d,L,T;const r=typeof n=="function"?n():n,{assignee:k,status:o}=((w=l.value)==null?void 0:w.task)||{},{createUser:p,flowInstanceId:v,status:S}=((d=l.value)==null?void 0:d.flowInstance)||{},O={false:!1,startUser:p===String(r==null?void 0:r.userId),assignee:k===String(r==null?void 0:r.userId),todo:o===se.待办,done:o===se.已办,unfinished:S===ve.未办结,finished:S===ve.已办结,started:!!v},u={true:!0,notstarted:!v},{button:j}=((L=l.value)==null?void 0:L.properties)||{};return((T=c(g.value??[],j??[]))==null?void 0:T.filter(m=>{var z;const V=(z=m.display)==null?void 0:z.split(","),U=V==null?void 0:V.filter(D=>D in O).every(D=>O[D]),P=V==null?void 0:V.filter(D=>D in u).some(D=>u[D]);return U||P}))??[]});return(r,k)=>{const o=$("el-button");return _(!0),H(Y,null,oe(b.value,p=>(_(),x(o,{key:p.buttonKey,type:p.buttonType,loading:i(s),onClick:v=>a("click",p)},{default:y(()=>[p.icon?(_(),x(i(Ie),{key:0,icon:p.icon},null,8,["icon"])):F("",!0),J(" "+Q(p.name),1)]),_:2},1032,["type","loading","onClick"]))),128)}}}),gt=q({__name:"CommonComments",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=me(t),{request:n}=te(),{batchUpdate:f,create:l,remove:s,useList:g}=St(n),c=G(!1),{activeBtn:b}=ne(),r=R(()=>{var w;return(w=b.value)==null?void 0:w.buttonKey}),{data:k,refresh:o}=g(r),p=R(()=>{var d,L,T;const w=a.value;if(w&&!((d=k.value)!=null&&d.some(m=>m.content===w))){const m=(((T=(L=k.value)==null?void 0:L[0])==null?void 0:T.sort)||1)-1;return[{content:w,sort:m},...k.value||[]]}return k.value});async function v(w){var d;await l({...w,type:(d=b.value)==null?void 0:d.buttonKey}),pe.success("添加成功"),o()}async function S(w){await s(w.id),pe.success("删除成功"),o()}async function O(w,d){let L=d.parent.data;L=L.map((T,m)=>({id:T.id,sort:m+1})),await f(L),pe.success("修改排序成功"),o(),c.value=!1}function u(){c.value=!0}const j=G();async function C(w){var d;a.value=w.content??"",await be(),(d=j.value)==null||d.blur()}return(w,d)=>{const L=$("el-input"),T=$("el-text"),m=$("el-col"),V=$("el-button"),U=$("el-row"),P=$("el-tree"),z=$("el-popover");return _(),x(z,{visible:c.value,placement:"bottom",title:"常用意见",width:i(Z)()?"98%":"600px"},{reference:y(()=>[A(L,{ref_key:"inputRef",ref:j,modelValue:i(a),"onUpdate:modelValue":d[0]||(d[0]=D=>de(a)?a.value=D:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:d[1]||(d[1]=D=>c.value=!0),onBlur:d[2]||(d[2]=D=>c.value=!1)},null,8,["modelValue"])]),default:y(()=>[A(P,{data:p.value,"node-key":"content",draggable:"","allow-drop":(D,h,K)=>K!=="inner",props:{label:"content"},onNodeClick:C,onNodeDrop:O,onNodeDragStart:u},{default:y(({data:D})=>[A(U,{style:{width:"100%"}},{default:y(()=>[A(m,{span:22},{default:y(()=>[A(T,{truncated:"",title:D.content},{default:y(()=>[J(Q(D.content),1)]),_:2},1032,["title"])]),_:2},1024),A(m,{span:2},{default:y(()=>[D.id?(_(),x(V,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Ne(h=>S(D),["stop"])},null,8,["onClick"])):(_(),x(V,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Ne(h=>v(D),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible","width"])}}}),kt=q({__name:"ApprovalTree",props:{modelValue:{},data:{},autoCheck:{type:Boolean},mode:{}},setup(e){const t=e,{modelValue:a}=me(t),n={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},f=G(),l=R(()=>Oe(t.data??[],(o,p,v)=>{const S=Le();return o.taskNodeKey=(v==null?void 0:v.taskNodeKey)??o.taskNodeKey,o.incoming=(v==null?void 0:v.incoming)??o.incoming,o.multiple=(v==null?void 0:v.multiple)??o.multiple,o.parentId=(v==null?void 0:v.id)??o.parentId,{...o,id:S}})),g={defaultExpandAll:!0,lazy:!0,showCheckbox:!0,nodeKey:"id",load:(o,p)=>{o.level===0?p(l.value):p(o.data.children??[])},onCheck:b,props:{label:"title",class(o){return`node-${o.type}`}}};Fe(()=>[l.value,f.value],async()=>{if(!(!f.value||!l.value.length)&&t.autoCheck){const o=c(l.value);o&&k([o])}},{immediate:!0,debounce:100});function c(o){var p;if(o.length===1)return(p=o[0].children)!=null&&p.length?c(o[0].children):o[0]}async function b(o,{checkedNodes:p}){var O;let v=p.filter(u=>u.type==="user");const S=v.some(u=>u.id===o.id);if(l.value.every(u=>!u.multiple)&&S)v=[o];else if(!o.multiple&&S){const C=((O=f.value)==null?void 0:O.getNode(o)).parent.data.children.filter(w=>w.id!==o.id);v=ct(v,C,"id")}k(v)}function r(o){const p=a.value.filter(v=>v.id!==o.id);k(p)}function k(o){var p;a.value=o,(p=f.value)==null||p.setCheckedNodes(o)}return(o,p)=>{const v=$("el-tag"),S=$("el-space"),O=$("el-popover"),u=$("Icon"),j=$("el-tree");return _(),H(Y,null,[A(O,{placement:"bottom",width:600,disabled:i(a).length<=9},{reference:y(()=>[A(S,{wrap:""},{default:y(()=>[(_(!0),H(Y,null,oe(i(a).filter((C,w)=>w<9),C=>(_(),x(v,{key:C.id,type:"info",closable:"",onClose:w=>r(C)},{default:y(()=>[J(Q(C.title),1)]),_:2},1032,["onClose"]))),128)),i(a).length>9?(_(),x(v,{key:0,type:"info"},{default:y(()=>[J(" +"+Q(i(a).length-9),1)]),_:1})):F("",!0)]),_:1})]),default:y(()=>[A(S,{wrap:"",size:"small"},{default:y(()=>[(_(!0),H(Y,null,oe(i(a).filter((C,w)=>w>=9),C=>(_(),x(v,{key:C.id,type:"info",closable:"",onClose:w=>r(C)},{default:y(()=>[J(Q(C.title),1)]),_:2},1032,["onClose"]))),128))]),_:1})]),_:1},8,["disabled"]),A(j,$e({ref_key:"treeRef",ref:f,class:["approval-tree",`mode-${o.mode}`],data:l.value},g),{default:y(({data:C})=>[le("div",null,[A(u,{icon:n[C.type]||n.element,style:{display:"inline-block"}},null,8,["icon"]),le("span",null,Q(C.title),1)])]),_:1},16,["class","data"])],64)}}}),Ce=we(kt,[["__scopeId","data-v-f3d40716"]]),ht=q({__name:"NodeSelect",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=me(t),{flowDetail:n}=ne(),f=G(!1);function l({data:s}){s.type==="userTask"&&(f.value=!1,a.value=s.id)}return(s,g)=>{const c=$("el-button"),b=$("el-popover");return _(),x(b,{visible:f.value,"onUpdate:visible":g[0]||(g[0]=r=>f.value=r),placement:"bottom-start",width:"800px",trigger:"click"},{reference:y(()=>[A(c,null,{default:y(()=>[J(" 点击选择节点 ")]),_:1})]),default:y(()=>{var r,k;return[A(i(Ee),{"model-value":(k=(r=i(n))==null?void 0:r.process)==null?void 0:k.flowData,view:"",style:{height:"600px"},onNodeClick:l},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Nt=q({__name:"ApprovalForm",emits:["submit"],setup(e,{emit:t}){const a=t,{request:n}=te(),{getApprovalNode:f}=ge(n),{formData:l,approvalFormData:s,activeBtn:g,approvalVisible:c,formVariables:b,flowDetail:r,submitLoading:k,useFlowParam:o}=ne(),p=o("flow.approval.autocheck"),v=o("flow.approval.autocomment"),S=o("flow.approval.tree.horizontal"),O=G([]),u=G([]),j=G([]),C=G([]),w=G(!1),d=G(),L=R(()=>{const D=O.value.length,h=j.value.length&&!O.value.length;return{menuBtn:!1,labelWidth:"auto",span:24,column:[{label:"指定节点",prop:"jumpTaskNodeKey",display:T("specifyNode"),rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",display:T("assignee"),rules:D?[{required:!0,validator:m}]:[]},{label:"传阅人",prop:"circulate",display:T("circulate"),rules:h?[{required:!0,validator:V}]:[]},{label:"意见",prop:"comment",display:T("comment"),rules:[{required:!0,message:"请填写意见"}]}]}});function T(D){var h,K;return(K=(h=g.value)==null?void 0:h.approval)==null?void 0:K.includes(D)}function m(D,h,K){var N,E,B;const W=((N=O.value[0])==null?void 0:N.type)==="parallelGateway",I=(B=(E=O.value[0])==null?void 0:E.children)==null?void 0:B.every(M=>ut([M],ue=>u.value.some(fe=>fe.id===ue.id)));if(u.value.length){if(W&&!I)return K("请在每个节点选择审批人")}else return K("请选择审批人");return!0}function V(D,h,K){return C.value.length?!0:K("请选择传阅人")}re(async()=>{!c.value||!d.value||(be(()=>{d.value.resetForm(),s.value.comment=l.value.comment||v.value&&g.value.name||""}),U())}),re(async()=>{var D,h;if(!(!T("assignee")||!c.value)&&!(T("specifyNode")&&!s.value.jumpTaskNodeKey)){await U();try{w.value=!0;const{taskId:K}=((D=r.value)==null?void 0:D.task)||{},{flowKey:W}=((h=r.value)==null?void 0:h.process)||{},I=await f({flowKey:W,taskId:K,variables:b.value,buttonType:g.value.buttonKey,jumpTaskNodeKey:s.value.jumpTaskNodeKey});O.value=I.data.approvalNodeList,j.value=I.data.circulateNodeList}finally{w.value=!1}}});function U(){O.value=[],u.value=[],j.value=[],C.value=[]}async function P(){await Re(d);const{data:D,outgoing:h}=z(u.value),{data:K}=z(C.value);s.value.assignee=D,s.value.circulate=K,s.value.outgoing=[...h],a("submit")}function z(D){const h={},K={},W=new Set;return D.forEach(I=>{const{taskNodeKey:N,incoming:E}=I;h[N]||(h[N]=new Set),I.userId&&h[N].add(I.userId),K[N]=[...h[N]].join(","),E&&W.add(E)}),{dataSet:h,data:K,outgoing:W}}return(D,h)=>{const K=$("el-skeleton"),W=$("avue-form"),I=$("el-button");return _(),x(Pe(i(Z)()?"el-drawer":"el-dialog"),{modelValue:i(c),"onUpdate:modelValue":h[6]||(h[6]=N=>de(c)?c.value=N:null),class:"approval-form-overlay",title:i(g).name,"append-to-body":"",width:"900px",size:"50%",direction:"btt","destroy-on-close":""},{footer:y(()=>[A(I,{onClick:h[5]||(h[5]=N=>c.value=!1)},{default:y(()=>[J(" 取 消 ")]),_:1}),A(I,{type:"primary",loading:i(k),onClick:P},{default:y(()=>[J(" 确 定 ")]),_:1},8,["loading"])]),default:y(()=>[A(W,{ref_key:"formRef",ref:d,modelValue:i(s),"onUpdate:modelValue":h[4]||(h[4]=N=>de(s)?s.value=N:null),class:"approval-form",option:L.value},{jumpTaskNodeKey:y(()=>[A(ht,{modelValue:i(s).jumpTaskNodeKey,"onUpdate:modelValue":h[0]||(h[0]=N=>i(s).jumpTaskNodeKey=N)},null,8,["modelValue"])]),assignee:y(()=>[w.value?(_(),x(K,{key:0})):(_(),x(Ce,{key:"AssigneeTree",modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=N=>u.value=N),data:O.value,"auto-check":i(p),mode:i(Z)()||!i(S)?"vertical":"horizontal"},null,8,["modelValue","data","auto-check","mode"]))]),circulate:y(()=>[w.value?(_(),x(K,{key:0})):(_(),x(Ce,{key:"CirculateTree",modelValue:C.value,"onUpdate:modelValue":h[2]||(h[2]=N=>C.value=N),data:j.value,mode:i(Z)()||!i(S)?"vertical":"horizontal"},null,8,["modelValue","data","mode"]))]),comment:y(()=>[A(gt,{modelValue:i(s).comment,"onUpdate:modelValue":h[3]||(h[3]=N=>i(s).comment=N)},null,8,["modelValue"])]),_:1},8,["modelValue","option"])]),_:1},8,["modelValue","title"])}}}),Dt={class:"flow-form__title"},Ct=q({__name:"index",props:wt,emits:yt,setup(e,{emit:t}){const f=_t(e,t),{ApprovalForm:l,tabsProps:s}=te(),g=l??Nt,{title:c,detail:b,flowDetail:r,tabRefs:k,tabList:o,activeTab:p,formLoading:v,tabsRef:S,onButtonClick:O,onSubmit:u}=f;return(j,C)=>{const w=$("el-skeleton"),d=$("el-main"),L=$("el-header"),T=$("el-tab-pane"),m=$("el-tabs"),V=$("el-footer"),U=$("el-container");return i(v)?(_(),x(d,{key:0},{default:y(()=>[A(w)]),_:1})):(_(),x(U,{key:1,class:"flow-form"},{default:y(()=>[A(L,{class:"flow-form__header",height:"auto"},{default:y(()=>{var P;return[le("div",Dt,Q(i(c)??((P=i(r).flowInstance)==null?void 0:P.title)),1),!i(b)&&!i(Z)()?(_(),x(De,{key:0,onClick:i(O)},null,8,["onClick"])):F("",!0)]}),_:1}),A(d,{class:"flow-form__main"},{default:y(()=>[A(m,$e({ref_key:"tabsRef",ref:S,modelValue:i(p),"onUpdate:modelValue":C[0]||(C[0]=P=>de(p)?p.value=P:null)},i(s)),{default:y(()=>[(_(!0),H(Y,null,oe(i(o),P=>(_(),x(T,{key:P.prop,label:P.label,name:P.prop,lazy:P.lazy,disabled:P.disabled,closable:P.closable},{default:y(()=>[(_(),x(Pe(P.component),{ref_for:!0,ref:z=>i(k)[P.prop]=z},null,512))]),_:2},1032,["label","name","lazy","disabled","closable"]))),128))]),_:1},16,["modelValue"])]),_:1}),!i(b)&&i(Z)()?(_(),x(V,{key:0,class:"flow-form__footer",height:"auto"},{default:y(()=>[A(De,{onClick:i(O)},null,8,["onClick"])]),_:1})):F("",!0),A(i(g),{onSubmit:i(u)},null,8,["onSubmit"])]),_:1}))}}}),Vt=q({setup(){const{flowDetail:e,formData:t,detail:a}=ne(),n=bt(e.value),{proxy:f}=tt(),l=G({});re(()=>{const{formOption:c}=e.value.process??{},b=e.value.task&&e.value.task.status!==se.待办;l.value=Qe.bind(f)(c||'{"menuBtn":false}'),l.value.detail=a.value||b});const s=G();function g(){return Re(s)}return{form:t,option:l,defaults:n,formRef:s,validate:g}},render(){return et($("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,class:this.option.class,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),It=q({__name:"UploadTable",setup(e){const{flowDetail:t,fileIds:a,detail:n}=ne(),{upload:{action:f,headers:l,preview:s,download:g,props:c}={},request:b}=te(),r=typeof l=="function"?l():l,k=R(()=>{var L,T;return((T=(L=t.value)==null?void 0:L.task)==null?void 0:T.flowInstanceId)??Le()}),o=[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}],p=o.filter(L=>L.prop==="fileName"),v={rowKey:"id",align:"center",index:!1,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuType:"menu",menuBtnTitle:"操作",column:Z()?p:o},{bindVal:S,getDataList:O,handleDel:u,handleSave:j,afterGetList:C,crudStateRefs:{tableData:w}}=st({crudOption:{...xt(b),saveSuccessMsg:"上传成功"},tableOption:v,queryForm:{isLatest:1,flowInstanceId:k.value}});C(()=>{a.value=w.value.map(L=>L.id).join(",")}),O();async function d(L,T){var h,K;const{fileName:m,fileType:V,fileSize:U,fileUrl:P,res:z}=c,D={fileName:ce({res:L},`${z}.${m}`),fileType:ce({res:L},`${z}.${V}`),fileSize:ce({res:L},`${z}.${U}`),fileUrl:ce({res:L},`${z}.${P}`),taskId:(K=(h=t.value)==null?void 0:h.task)==null?void 0:K.taskId,flowInstanceId:k.value,rootMark:(T==null?void 0:T.rootMark)||"",version:typeof(T==null?void 0:T.version)=="number"?T.version+1:1};await j(D,O,()=>{})}return(L,T)=>{const m=$("el-button"),V=$("el-upload"),U=$("el-dropdown-item"),P=$("avue-crud");return _(),x(P,at(ot(i(S))),{"menu-left":y(()=>[i(n)?F("",!0):(_(),x(V,{key:0,action:i(f),headers:i(r),"show-file-list":!1,onSuccess:T[0]||(T[0]=z=>d(z))},{default:y(()=>[A(m,{type:"primary",icon:"el-icon-upload"},{default:y(()=>[J(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"]))]),"menu-btn":y(({row:z,index:D})=>[A(U,{icon:"el-icon-view",onClick:h=>{var K;return(K=i(s))==null?void 0:K(z,i(w))}},{default:y(()=>[J(" 预览 ")]),_:2},1032,["onClick"]),A(U,{icon:"el-icon-download",onClick:h=>{var K;return(K=i(g))==null?void 0:K(z,i(w))}},{default:y(()=>[J(" 下载 ")]),_:2},1032,["onClick"]),i(n)?F("",!0):(_(),x(U,{key:0,icon:"el-icon-upload"},{default:y(()=>[A(V,{action:i(f),headers:i(r),"show-file-list":!1,onSuccess:h=>d(h,z)},{default:y(()=>[J(" 更新版本 ")]),_:2},1032,["action","headers","onSuccess"])]),_:2},1024)),i(n)?F("",!0):(_(),x(U,{key:1,icon:"el-icon-delete",onClick:h=>i(u)(z,D)},{default:y(()=>[J(" 删除 ")]),_:2},1032,["onClick"]))]),_:1},16)}}}),Tt={class:"flow-track"},$t={key:0},Pt={key:1},Ot=q({__name:"FlowTrack",setup(e){const{flowDetail:t,useFlowParam:a}=ne(),n=G(Z()?"timeline":"table"),f=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],l=R(()=>{var b,r,k;return((k=(r=(b=t.value)==null?void 0:b.flowHistory)==null?void 0:r.filter(o=>/Task/.test(o.taskNodeType??"")))==null?void 0:k.map(o=>({...o,duration:Me(o.duration)})))??[]}),s={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},g=a("flow.handle.type");function c(b){var r;return(r=g.value)==null?void 0:r.find(k=>k.value===b)}return(b,r)=>{var j,C,w;const k=$("el-radio-button"),o=$("el-radio-group"),p=$("avue-crud"),v=$("el-card"),S=$("el-timeline-item"),O=$("el-timeline"),u=$("el-empty");return _(),H(Y,null,[i(Z)()?F("",!0):(_(),x(o,{key:0,modelValue:n.value,"onUpdate:modelValue":r[0]||(r[0]=d=>n.value=d)},{default:y(()=>[(_(),H(Y,null,oe(f,d=>A(k,{key:d.label,label:d.label},{default:y(()=>[A(i(Ie),{icon:d.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])),le("div",Tt,[n.value==="table"?(_(),x(p,{key:0,data:l.value,option:s},null,8,["data"])):F("",!0),n.value==="graph"?(_(),x(i(Ee),{key:1,"model-value":(C=(j=i(t))==null?void 0:j.process)==null?void 0:C.flowData,"flow-history":(w=i(t))==null?void 0:w.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):F("",!0),n.value==="timeline"?(_(),H(Y,{key:2},[l.value.length?(_(),x(O,{key:0},{default:y(()=>[(_(!0),H(Y,null,oe([...l.value].reverse(),d=>(_(),x(S,{key:d.id,timestamp:d.endTime,placement:"top"},{default:y(()=>[A(v,null,{default:y(()=>{var L,T,m;return[le("div",null,Q(d.assigneeName)+" 开始处理 ["+Q(d.taskNodeName)+"] 环节 ",1),d.duration?(_(),H("div",$t," 办理时长："+Q(d.duration),1)):F("",!0),d.type&&((L=d.comment)!=null&&L.handleComment)?(_(),H("div",Pt,Q((T=c(d.type))==null?void 0:T.label)+"意见："+Q((m=d.comment)==null?void 0:m.handleComment),1)):F("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(_(),x(u,{key:1}))],64)):F("",!0)])],64)}}}),Lt=we(Ot,[["__scopeId","data-v-efaeae32"]]),Ut={FlowDesign:{},FormDesign:{},FlowForm:Ct,request:{},tabs:[{label:"审批表单",prop:"formTab",component:Vt},{label:"附件资料",prop:"fileTab",component:It},{label:"流程跟踪",prop:"trackTab",component:Lt}],useFlowFormOptions:{type:"drawer",window:["","flow-form","left=0,top=0,width=1600,height=900"],overlay:{width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0}},tableOption:{align:"center",border:!0,card:!0,stripe:!0,searchMenuSpan:6,span:24},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}},flowParams:{"flow.approval.autocheck":!0,"flow.approval.autocomment":!0,"flow.approval.tree.horizontal":!0}};function St(e){const t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},a=c=>e.get(t.list,{params:{type:c,ascs:"sort"}});return{url:t,getList:a,useList:c=>ee(()=>a(c.value),{res:"data.records",modify:!1,refreshDeps:[c]}),create:c=>e.post(t.save,c),update:c=>e.post(t.update,c),remove:c=>e.post(t.remove,{},{params:{ids:c}}),batchUpdate:c=>e.post(t.batchUpdate,c)}}var Ae=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Ae||{}),At=(e=>(e.保存草稿="flow_draft",e.发送="flow_pass",e.退回="flow_reject",e.终止="flow_terminate",e.撤销="flow_revoke",e.撤回到发起="flow_withdraw",e.打印="flow_print",e.转办="flow_transfer",e.加签="flow_add_instance",e.减签="flow_del_instance",e.指定回退="flow_rollback",e.绿色通道="flow_green",e))(At||{}),ye=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.已办结="finished",e.未办结="unfinished",e.已发起="started",e.未发起="notstarted",e))(ye||{}),_e=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(_e||{}),xe=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(xe||{});function Ke(e){const t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},a=g=>e.get(t.list,{params:g}),n=ee(a,{res:"data.records",defaultParams:[{size:-1,ascs:"sort",status:1}]});return{url:t,getList:a,useList:n,create:g=>e.post(t.save,g),update:g=>e.post(t.update,g),remove:g=>e.post(t.remove,{},{params:{ids:g}})}}function xt(e){const t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"},a=s=>e.get(t.list,{params:s}),n=ee(a,{res:"data"});return{getList:a,useList:n,create:s=>e.post(t.save,s),remove:s=>e.post(t.remove,{},{params:{ids:s}})}}function je(e){const t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},a=r=>e.get(t.list,{params:r}),n=()=>e.get(t.all),f=ee(n,{res:"data"}),l=r=>e.get(t.key,{params:{paramKey:r}});return{url:t,getList:a,getParams:n,useParams:f,getParam:l,useParam:r=>ee(l,{res:"data",modify:!1,defaultParams:[r]}),create:r=>e.post(t.save,r),update:r=>e.post(t.update,r),remove:r=>e.post(t.remove,{},{params:{ids:r}})}}var se=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e[e.退回=6]="退回",e))(se||{}),ve=(e=>(e[e.已办结=1]="已办结",e[e.未办结=2]="未办结",e[e.已终止=3]="已终止",e))(ve||{}),Kt=(e=>(e[e.系统执行=1]="系统执行",e[e.用户办理=2]="用户办理",e[e.任务撤销=3]="任务撤销",e[e.任务退回=4]="任务退回",e[e.流程终止=5]="流程终止",e[e.任务转办=6]="任务转办",e[e.绿色通道=7]="绿色通道",e))(Kt||{});function ge(e){const t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask"},a=u=>e.get(t.detail,{params:u}),n=u=>e.post(t.approvalNode,u),f=u=>e.post(t.start,u),l=u=>e.post(t.commit,u),s=u=>e.post(t.draft,u),g=u=>e.post(t.revoke,u),c=u=>e.post(t.terminate,u),b=u=>e.post(t.withdraw,u),r=u=>e.post(t.transfer,u),k=u=>e.post(t.reject,u),o=u=>e.post(t.green,u),p=u=>e.get(t.publishList,{params:u}),v=ee(p,{res:"data",defaultParams:[{ascs:"sort"}]}),S=u=>e.get(t.taskList,{params:u}),O=ee(S,{res:"data.records"});return{url:t,getFlowDetail:a,getApprovalNode:n,startTask:f,commitTask:l,saveDraft:s,revokeTask:g,terminateTask:c,withdrawTask:b,transferTask:r,rejectTask:k,greenChannel:o,getPublishList:p,usePublishList:v,getTaskList:S,useTaskList:O}}function jt(e){const t={tree:"/sapier-flow/flow-user/tree"},a=f=>e.get(t.tree,{params:{filter:f}}),n=ee(a,{res:"data"});return{url:t,getUserTree:a,useUserTree:n}}var ke=(e=>(e.ASSIGN_ID="ASSIGN_ID",e.ASSIGN_UUID="ASSIGN_UUID",e.AUTO="AUTO",e.INPUT="INPUT",e.NONE="NONE",e))(ke||{}),he=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(he||{});function ma(e){const t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy",getFields:"/sapier-flow/dev-table/getTableFields"},a=b=>e.get(t.list,{params:b}),n=ee(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:t,getList:a,useList:n,create:b=>e.post(t.save,b),update:b=>e.post(t.update,b),remove:b=>e.post(t.remove,{},{params:{ids:b}}),deploy:b=>e.post(t.deploy,b),getFields:b=>e.get(t.getFields,{params:b})}}var ze=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(ze||{});const ie=X(ze),fa=X(he),va=X(ke),ba=[{label:"审批",value:"userTask"},{label:"传阅",value:"circulateTask"}],Be={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",editDisabled:!0,rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",dicQuery:{size:-1,ascs:"sort"},props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"排序",prop:"sort",type:"number",width:110},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},zt=Te(dt(Ut));function te(e){return mt(zt,e)}const wa=ae({rowKey:"id",labelWidth:150,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:X(Ae)},{label:"默认显示条件",prop:"display",type:"select",overHidden:!0,multiple:!0,dataType:"string",value:"false",dicData:X(ye),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示，或运算条件;<br/>隐藏: 始终隐藏，与运算条件;<br/>
      发起人: 用户为发起人时显示，与运算条件;<br/>处理人: 用户为处理人时显示，与运算条件;<br/>
      已办: 任务状态为已办时显示，与运算条件;<br/>待办: 任务状态为待办时显示，与运算条件;<br/>
      已办结: 流程已办结时显示，与运算条件;<br/>未办结: 流程未办结时显示，与运算条件;<br/>
      已发起: 流程已发起时显示，与运算条件;<br/>未发起: 流程未发起时显示，或运算条件;`},{label:"默认审批窗口显示",prop:"approval",type:"select",overHidden:!0,multiple:!0,dataType:"string",value:"false",dicData:X(_e),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"默认是否校验",prop:"validate",type:"switch",value:1,dicData:ie,labelTip:"是: 点击按钮时先执行每个tab的校验;<br/>否: 点击按钮不执行校验;"},{label:"备注",prop:"remarks",overHidden:!0},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:X(xe)},{label:"按钮预览",prop:"buttonPreview",width:150}]}),ya=ae({rowKey:"flowModuleId",dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Be.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]}),_a=ae({rowKey:"flowDeloyId",dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Be.column,{prop:"sort",hide:!0},{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]}),ga=ae({rowKey:"id",menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0,overHidden:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"状态",prop:"status",type:"select",search:!0,searchValue:se.待办,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]}),ka=ae({rowKey:"id",column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:ie},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]}),ha=ae({rowKey:"id",column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]}),Bt={key:0,class:"flow-viewer"},Et={key:0,class:"flow-status-legend"},Rt={class:"legend-text"},Mt=q({__name:"FlowDesignWrapper",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const a=e,n=t,f=lt();Je(f,()=>{var m;(m=f.value)==null||m.on("node:click",V=>n("nodeClick",V))});const l=R({get(){let m=pt();return typeof a.modelValue=="string"&&a.modelValue?m=JSON.parse(a.modelValue):typeof a.modelValue=="object"&&Object.keys(a.modelValue)&&(m=a.modelValue),m},set(m){n("update:modelValue",JSON.stringify(m))}}),s=R(()=>{const{column:m=[],group:V=[]}=JSON.parse(a.flowFormOption||"{}");return[...m,...V.map(P=>P.column??[]).flat()]}),{FlowDesign:g,tabs:c,request:b}=te(),r=R(()=>(c==null?void 0:c.map(m=>({...m,display:m.display??!0})))??[]),k=R(()=>!a.view),{data:o}=Ke(b).useList({ready:k}),{useUserTree:p}=jt(b),{data:v}=p({ready:k}),{data:S}=p({ready:k,defaultParams:["dept"]}),{data:O}=p({ready:k,defaultParams:["post"]}),{useParam:u}=je(b),{data:j}=u("flow.trends.user");function C(m){return Oe(m,V=>({...V,label:V.title,value:V.id}))}const w=R(()=>({formPropertyList:[...s.value,...r.value],buttonList:o.value,fieldsDic:s.value.map(m=>({label:m.label,value:`\${${m.prop}}`,desc:`\${${m.prop}}`})),flowButtonDisplayDic:X(ye),flowButtonApprovalDic:X(_e),flowButtonValidateDic:ie.map(m=>({...m,label:""})),flowAssigneeUserDic:C(v.value??[]),flowAssigneeDeptDic:C(S.value??[]),flowAssigneePostDic:C(O.value??[]),flowAssigneeDynamicDic:j.value})),{data:d}=u("flow.task.status"),L=R(()=>{var m;return(m=a.flowHistory)==null?void 0:m.map(V=>{var P,z;const U=(z=(P=d.value)==null?void 0:P.find(D=>D.value===V.status))==null?void 0:z.style;return{id:V.taskNodeKey,style:U}})}),T=R(()=>{var m,V;return(V=(m=a.flowHistory)==null?void 0:m.filter(U=>U.taskNodeType==="userTask"))==null?void 0:V.map(U=>{var P;return{id:U.taskNodeKey,content:`<div>${U.assigneeName}</div>
        <div>${U.endTime??""}</div>
        <div>${((P=U.comment)==null?void 0:P.handleComment)??""}</div>`}})});return(m,V)=>m.view?(_(),H("div",Bt,[m.showLegend!==!1?(_(),H("div",Et,[(_(!0),H(Y,null,oe(i(d),U=>{var P;return _(),H("div",{key:U.label,class:"legend-item"},[le("div",{class:"legend-color",style:nt({backgroundColor:(P=U.style)==null?void 0:P.fill})},null,4),le("span",Rt,Q(U.label),1)])}),128))])):F("",!0),A(i(g),{lf:f.value,"onUpdate:lf":V[0]||(V[0]=U=>f.value=U),"model-value":l.value,styles:L.value,tooltips:T.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(_(),x(i(g),{key:1,modelValue:l.value,"onUpdate:modelValue":V[1]||(V[1]=U=>l.value=U),"form-options":i(We),"data-options":w.value,"form-width":"30%"},null,8,["modelValue","form-options","data-options"]))}}),Ee=we(Mt,[["__scopeId","data-v-34a13d90"]]),Na=ae({rowKey:"id",column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]}),Ve=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:X(he)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:ie,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:ie,value:1}],Da=ae({rowKey:"id",dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:X(ke)},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:Ve}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:Ve}}]});function Re(e){return new Promise((t,a)=>{i(e).validate((f,l,s)=>{f?(l(),t(s)):a(s)})})}function Z(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}export{Z as $,jt as A,ke as B,Ut as C,he as D,ae as E,Ee as F,ie as G,Kt as H,fa as I,va as J,Nt as K,Ce as L,De as M,gt as N,Lt as O,Vt as P,It as Q,ft as R,vt as S,se as T,Ue as U,wt as V,ze as W,yt as X,Se as Y,_t as Z,Ct as _,bt as a,Re as b,te as c,Ke as d,ya as e,_a as f,ma as g,Be as h,ga as i,ba as j,ka as k,je as l,ge as m,ha as n,Na as o,Da as p,St as q,Ae as r,At as s,wa as t,ne as u,ye as v,_e as w,xe as x,xt as y,ve as z};
