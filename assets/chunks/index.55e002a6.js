import{h as T,a9 as be,aB as Se,D as Be,d as S,J as f,b as I,w as o,a7 as j,a8 as J,l as m,o as D,N as n,a as F,t as K,A as ce,B as Q,g as H,n as Ke,c as P,L as Y,R as pe,K as E,e as B,z as De,aM as Ve,k as G,a5 as Fe,E as ge,_ as Ae}from"./framework.c2983551.js";import"./index.deecc6ab.js";import{b as Ee,u as R,e as Re}from"./index.b928f55e.js";import{c as oe,d as M,C as ze,t as je,e as Je,f as We,g as He,h as de,i as Ge,F as me,b as Qe,j as Ye,T as te,w as Xe,k as Ce,l as Ze,m as qe}from"./mobile.be7fd467.js";import{G as ko,I as Do,B as Vo,A as Fo,r as Co,q as ho,p as Oo,s as Lo,o as xo,_ as Io,x as $o,H as To,K as No,z as Po,L as Mo,W as Uo,D as So,O as Bo,N as Ko,J as Ao,P as Eo,R as Ro,E as zo,M as jo,n as Jo,v as Wo,y as Ho,a as Go,u as Qo,Q as Yo}from"./mobile.be7fd467.js";import{m as fe,a as X,E as z}from"./index.ce0b877c.js";import{o as he}from"./omitBy.d2a19f53.js";import{a as et}from"./snakeCase.7099c4a4.js";import{K as tt}from"./index.ccfd64e4.js";import{C as ot}from"./index.2fcafa0b.js";import{J as lt,K as at}from"../app.a094a19c.js";import{I as Z}from"./iconify.4639d8e3.js";import"./index.038acb2e.js";import"./index.ebd85431.js";import{j as nt,H as st}from"./tree.82fe43ad.js";import"./vuedraggable.umd.482073e4.js";import{w as le,a as ve,u as it,h as ut,i as rt}from"./index.d990ce32.js";import{f as dt}from"./form.87a8a395.js";import{d as ct}from"./differenceBy.22dbfb8b.js";import"./dayjs.min.50666642.js";import"./omit.1bac3483.js";import"./index.vue_vue_type_script_setup_true_lang.c9440674.js";import"./createCompounder.45a3c61a.js";import"./theme.cfb2a457.js";import"./kebabCase.f05af6b4.js";import"./vue.runtime.esm-bundler.3b5cdda3.js";function Oe(s){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},i=p=>s.get(e.list,{params:p});return{getList:i,useList:()=>oe(()=>i({size:-1}).then(p=>p.data)),getTree:p=>s.get(e.tree,{params:p}),create:p=>s.post(e.save,p),update:p=>s.post(e.update,p),remove:p=>s.post(e.remove,{},{params:{ids:p}})}}function Le(s){const e={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:e,getCirculateList:l=>s.get(e.list,{params:l}),getCirculateOpsList:l=>s.get(e.list,{params:l}),updateCirculate:l=>s.post(e.update,l),removeCirculate:l=>s.post(e.remove,{},{params:{ids:l}})}}function ae(s){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},i=d=>s.get(e.list,{params:d});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(d=>d.data.records)),create:d=>s.post(e.save,d),update:d=>s.post(e.update,d),remove:d=>s.post(e.remove,{},{params:{ids:d}}),deploy:d=>s.post(e.deploy,d),getDetail:d=>s.get(e.detail,{params:d})}}var xe=(s=>(s[s.否=0]="否",s[s.是=1]="是",s))(xe||{});function _e(s){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:l=>s.get(e.list,{params:l}),getDetail:l=>s.get(e.detail,{params:l}),update:l=>s.post(e.update,l),remove:l=>s.post(e.remove,{},{params:{ids:l}})}}function pt(s){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>s.get(e.list,{params:t})}}function Ie(s){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},i=c=>s.get(e.list,{params:c});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(c=>c.data.records)),create:c=>s.post(e.save,c),update:c=>s.post(e.update,c),remove:c=>s.post(e.remove,{},{params:{ids:c}})}}function $e(s){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},i=c=>s.get(e.list,{params:c});return{url:e,getList:i,useList:()=>oe(()=>i({size:-1}).then(c=>c.data.records)),create:c=>s.post(e.save,c),update:c=>s.post(e.update,c),remove:c=>s.post(e.remove,{},{params:{ids:c}})}}function Te(s,e){return e in(ze.useFlowFormOptions??{})}function Ne(s={}){const{useFlowFormOptions:e}=M(),i=fe({...e},{...s});switch(i==null?void 0:i.type){case"window":return mt(i);case"dialog":case"drawer":return ft(i);default:return{open:t=>{},close:()=>{}}}}function mt(s={}){const e=T(null);return{open:(a={})=>{var b;const u=fe({...s},{...a}),{window:[l,c,p]=[]}=u,d=`${l}?${Ee(he(u,et(tt,ot,Te)))}`;e.value=window.open(d,c,p),(b=e.value)==null||b.addEventListener("message",V=>{const{event:_,data:v}=V.data,r=a[_];typeof r=="function"&&r(v)})},close:()=>{var a;return(a=e.value)==null?void 0:a.close()},openedWindow:e}}function ft(s={}){const{appContext:e}=Be(),{FlowForm:i}=M();let t,a;const u=c=>{t=document.createElement("div"),t.className="flow-form-wrapper";const p=fe({...s},{...c}),d=be(i,he(p,Te));a=be(p.type==="dialog"?lt:at,{class:"flow-form-overlay",modelValue:!0,onClose:l,...p.overlay},d),a.appContext=e,Se(a,t),document.body.appendChild(t)},l=()=>{var c,p;(p=(c=a==null?void 0:a.component)==null?void 0:c.props)!=null&&p.modelValue&&(a.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:u,close:l}}const vt=S({__name:"index",setup(s){const{request:e}=M(),{bindVal:i,crudStateRefs:{formData:t},getDataList:a}=R({tableOption:je,crudOption:Je(e),sortOption:{ascs:"sort"}});return a(),(u,l)=>{const c=f("el-button"),p=f("avue-crud");return D(),I(p,j(J(m(i))),{icon:o(({row:d})=>[n(m(Z),{icon:d.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:d})=>[n(c,{type:d.buttonType},{default:o(()=>[n(m(Z),{icon:d.icon},null,8,["icon"]),F(" "+K(d.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[n(c,{type:m(t).buttonType},{default:o(()=>[n(m(Z),{icon:m(t).icon},null,8,["icon"]),F(" "+K(m(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Pe=S({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(s,{emit:e}){const i=s,{request:t}=M(),{getList:a,deploy:u,remove:l}=ae(t),{bindVal:c,crudStateRefs:{searchForm:p},getDataList:d}=R({tableOption:We,crudOption:{getList:a,remove:l},searchForm:{categoryId:i.categoryId}});ce(()=>{p.value.categoryId=i.categoryId??""}),le(p,d,{debounce:300,immediate:!0,deep:!0});const b=T(!1);async function V(v){await X.confirm("发布新版本，是否确认？","提示",{type:"success"}),b.value=!0,u({flowModuleId:v.flowModuleId}).then(()=>{z.success("发布成功"),d()}).finally(()=>{b.value=!1})}async function _(v){if(v.mainVersion)return z.warning("请先删除已发布的流程");await X.confirm("确认删除？","提示",{type:"warning"}),await l(v.flowModuleId),z.success("删除成功"),d()}return(v,r)=>{const w=f("el-button"),y=f("el-dropdown-item"),k=f("avue-crud");return D(),I(k,j(J(m(c))),{"menu-left":o(()=>[n(w,{type:"primary",icon:"el-icon-plus",onClick:r[0]||(r[0]=g=>e("add"))},{default:o(()=>[F(" 新增 ")]),_:1})]),"menu-btn":o(({row:g})=>[n(y,{icon:"el-icon-view",onClick:L=>e("view",g)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-edit",onClick:L=>e("edit",g)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-delete",onClick:L=>_(g)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-upload",onClick:L=>V(g)},{default:o(()=>[F(" 发布 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-switch",onClick:L=>e("version",g)},{default:o(()=>[F(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:g})=>[n(m(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Me=S({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(s,{emit:e}){const i=s,{request:t}=M(),{getList:a,update:u,remove:l}=_e(t),{bindVal:c,crudStateRefs:{searchForm:p},getDataList:d}=R({tableOption:He,crudOption:{getList:a,dataPath:"res.data"}});ce(()=>{p.value.flowModuleId=i.flowModuleId}),le(p,d,{debounce:300,immediate:!0,deep:!0});const b=T(!1);async function V(v){await X.confirm(`确定将 ${v.flowName}(${v.flowKey}:v${v.version}) 设为主版本?`,"提示",{type:"warning"}),b.value=!0,u({flowDeployId:v.flowDeployId,flowModuleId:v.flowModuleId,mainVersion:1}).then(()=>{z.success("设置成功"),d()}).finally(()=>{b.value=!1})}async function _(v){const{value:r}=await X.prompt("请输入确认删除的流程标识","提示",{type:"warning"});r===v.flowKey&&(await l(v.flowDeployId),z.success("删除成功"),d())}return(v,r)=>{const w=f("el-button"),y=f("el-dropdown-item"),k=f("avue-crud");return D(),I(k,j(J(m(c))),{"menu-left":o(()=>[n(w,{loading:b.value,type:"primary",icon:"el-icon-arrow-left",onClick:r[0]||(r[0]=g=>e("back"))},{default:o(()=>[F(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:g})=>[n(y,{icon:"el-icon-view",onClick:L=>e("view",g)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-edit",onClick:L=>e("edit",g)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-delete",onClick:L=>_(g)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),n(y,{icon:"el-icon-switch",disabled:g.mainVersion===m(xe).是,onClick:L=>V(g)},{default:o(()=>[F(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:g})=>[n(m(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),ke={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},_t=S({__name:"index",emits:["node-click"],setup(s,{emit:e}){const{request:i}=M(),{crudStateRefs:{formData:t,tableData:a},getDataList:u,handleSave:l,handleUpdate:c,handleDel:p}=R({crudOption:{rowKey:"id",...Oe(i),dataPath:"res.data"},tableOption:ke,pageOption:{pageSize:20}});u();function d(_,v,r,w){l(v,r,w)}function b(_,v,r,w){c(v,NaN,r,w)}async function V(_,v){await p(_.data,NaN),v()}return(_,v)=>{const r=f("avue-tree");return D(),I(r,{modelValue:m(t),"onUpdate:modelValue":v[0]||(v[0]=w=>Q(t)?t.value=w:null),option:m(ke),data:m(a),onNodeClick:v[1]||(v[1]=w=>e("node-click",w)),onSave:d,onUpdate:b,onDel:V},null,8,["modelValue","option","data"])}}}),we=S({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(s,{emit:e}){var p;const i=s,{FormDesign:t}=M(),a=H({get(){return i.modelValue?nt(i.modelValue):{menuBtn:!1,span:24}},set(d){e("update:modelValue",st(d,{useJson5:!1}))}}),u=H(()=>i.fields?JSON.parse(i.fields):[]),l=H(()=>{const d={type:"select",dicData:u.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...d,props:{label:"name",value:"name",desc:"comment"}},{...d,props:{label:"comment",value:"comment",desc:"name"}}]}),c={form:{settings:Array.from({length:((p=dt.settings)==null?void 0:p.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(d,b)=>{const V=f("avue-form");return d.view?(D(),I(V,{key:0,class:Ke(a.value.class),"model-value":{},option:a.value},null,8,["class","option"])):(D(),I(m(t),{key:1,modelValue:a.value,"onUpdate:modelValue":b[0]||(b[0]=_=>a.value=_),"base-option":l.value,resources:c},null,8,["modelValue","base-option"]))}}}),wt={key:1},yt=S({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(s){const e=s,{formData:i,activeStep:t}=ve(e),{request:a}=M(),{getDetail:u,useList:l}=ae(a),{data:c}=$e(a).useList(),{data:p}=Ie(a).useList(),{data:d}=l(),b=H(()=>{var _,v,r,w;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((_=c.value)==null?void 0:_.map(y=>({label:y.formName,value:y.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((v=d.value)==null?void 0:v.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((r=p.value)==null?void 0:r.map(y=>({label:y.flowName,value:y.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((w=d.value)==null?void 0:w.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:[]});async function V(_){if((t==null?void 0:t.value)===1){if(_.type==="template")i.value.formOption=_.value;else if(_.type==="definition"){const v=await u({flowModuleId:_.value});i.value.formOption=v.data.formOption}}else if((t==null?void 0:t.value)===2){if(_.type==="template")i.value.flowData=_.value;else if(_.type==="definition"){const v=await u({flowModuleId:_.value});i.value.flowData=v.data.flowData}}}return(_,v)=>{const r=f("el-link"),w=f("el-divider"),y=f("el-dropdown-item"),k=f("el-scrollbar"),g=f("el-dropdown-menu"),L=f("el-dropdown");return b.value.length?(D(),I(L,{key:0},{dropdown:o(()=>[n(g,null,{default:o(()=>[n(k,{"max-height":"600px"},{default:o(()=>[(D(!0),P(E,null,Y(b.value,h=>(D(),I(y,pe({key:h.label},h,{disabled:h.type==="divider",onClick:$=>V(h)}),{default:o(()=>[h.type==="divider"?(D(),I(w,{key:0},{default:o(()=>[F(K(h.label),1)]),_:2},1024)):(D(),P("span",wt,K(h.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[n(r,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[F(" 选择模板 ")]),_:1})]),_:1})):B("",!0)}}}),bt=G("span",null,"流程设计",-1),gt={key:0},kt={key:1},Dt={style:{height:"calc(100vh - 144px)"}},Vt=S({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(s,{emit:e}){const t=ve(s),{visible:a,modelValue:u}=t,{request:l}=M(),{create:c,deploy:p,getDetail:d,update:b}=ae(l),{getDetail:V,update:_}=_e(l),v=["流程信息","表单设计","模型设计","完成"],r=T(!1);De(a,async x=>{if(!x)return;const{flowModuleId:C}=u.value,{flowDeployId:U}=u.value;try{r.value=!0;let N={};U?N=await V({flowDeployId:U}):C&&(N=await d({flowModuleId:C})),u.value=N.data}finally{r.value=!1}},{immediate:!0});const{data:w}=de(l).useList(),y=H(()=>{var x,C;return(C=(x=w.value)==null?void 0:x.find(U=>U.tableName===u.value.formDataTable))==null?void 0:C.tableFields}),k=T(0),g=T();async function L(x){k.value===0&&await Qe(g),r.value=!0;const{flowModuleId:C}=u.value,{flowDeployId:U}=u.value;try{U?await _(u.value):C?await b(u.value):await c(u.value).then(N=>{u.value.flowModuleId=N.data.flowModuleId}),z.success("保存成功")}finally{r.value=!1}typeof x=="number"?k.value=x:k.value++}async function h(){await X.confirm("发布新版本，是否确认？","提示"),r.value=!0,p({flowModuleId:u.value.flowModuleId}).then(()=>{z.success("发布成功")}).finally(()=>{r.value=!1})}function $(){a.value=!1,k.value=0,u.value={},e("close")}return(x,C)=>{const U=f("el-col"),N=f("el-step"),q=f("el-steps"),W=f("el-button"),ne=f("el-row"),se=f("avue-form"),ie=f("el-result"),ue=f("el-dialog"),re=Ve("loading");return D(),I(ue,{modelValue:m(a),"onUpdate:modelValue":C[6]||(C[6]=O=>Q(a)?a.value=O:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:$},{header:o(()=>[n(ne,{justify:"center"},{default:o(()=>[n(U,{span:5},{default:o(()=>{var O,A,ee,ye;return[G("div",null,[bt,(O=m(u))!=null&&O.flowName?(D(),P("span",gt," - "+K((A=m(u))==null?void 0:A.flowName),1)):B("",!0),(ee=m(u))!=null&&ee.version?(D(),P("span",kt," - V"+K((ye=m(u))==null?void 0:ye.version),1)):B("",!0)]),n(yt,{"form-data":m(u),"onUpdate:formData":C[0]||(C[0]=Ue=>Q(u)?u.value=Ue:null),"active-step":k.value},null,8,["form-data","active-step"])]}),_:1}),n(U,{span:14},{default:o(()=>[n(q,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(D(),P(E,null,Y(v,(O,A)=>n(N,{key:A,title:O,style:{cursor:"pointer"},onClick:ee=>L(A)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),n(U,{span:5,style:{"text-align":"right"}},{default:o(()=>[n(W,{disabled:k.value===0,loading:r.value,type:"primary",onClick:C[1]||(C[1]=O=>k.value--)},{default:o(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),n(W,{disabled:k.value===v.length-1,type:"primary",loading:r.value,onClick:C[2]||(C[2]=O=>L())},{default:o(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),n(W,{onClick:$},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[Fe((D(),P("div",Dt,[k.value===0?(D(),I(se,{key:0,ref_key:"formRef",ref:g,modelValue:m(u),"onUpdate:modelValue":C[3]||(C[3]=O=>Q(u)?u.value=O:null),option:m(Ge),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),k.value===1?(D(),I(we,{key:1,modelValue:m(u).formOption,"onUpdate:modelValue":C[4]||(C[4]=O=>m(u).formOption=O),fields:y.value},null,8,["modelValue","fields"])):B("",!0),k.value===2?(D(),I(me,{key:2,modelValue:m(u).flowData,"onUpdate:modelValue":C[5]||(C[5]=O=>m(u).flowData=O),"flow-form-option":m(u).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),k.value===3?(D(),I(ie,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[m(u).flowDeployId?B("",!0):(D(),I(W,{key:0,type:"primary",onClick:h},{default:o(()=>[F(" 发布 ")]),_:1})),n(W,{onClick:$},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})):B("",!0)])),[[re,r.value]])]),_:1},8,["modelValue"])}}}),Ft=G("span",null,"流程查看",-1),Ct={key:0},ht={key:1},Ot=S({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(s){const i=ve(s),{visible:t,modelValue:a}=i,{request:u}=M(),{getDetail:l}=ae(u),{getDetail:c}=_e(u),p=T("form"),d=T(!1);De(t,async V=>{if(!V)return;const{flowModuleId:_}=a.value,{flowDeployId:v}=a.value;try{d.value=!0;let r={};v?r=await c({flowDeployId:v}):_&&(r=await l({flowModuleId:_})),a.value={...r.data}}finally{d.value=!1}},{immediate:!0});function b(){a.value={},p.value="form"}return(V,_)=>{const v=f("el-tab-pane"),r=f("el-tabs"),w=f("el-dialog"),y=Ve("loading");return D(),I(w,{modelValue:m(t),"onUpdate:modelValue":_[3]||(_[3]=k=>Q(t)?t.value=k:null),width:"60%",top:"0",onClose:b},{header:o(()=>{var k,g,L,h;return[Ft,(k=m(a))!=null&&k.flowName?(D(),P("span",Ct," - "+K((g=m(a))==null?void 0:g.flowName),1)):B("",!0),(L=m(a))!=null&&L.version?(D(),P("span",ht," - V"+K((h=m(a))==null?void 0:h.version),1)):B("",!0)]}),default:o(()=>[Fe((D(),I(r,{modelValue:p.value,"onUpdate:modelValue":_[2]||(_[2]=k=>p.value=k)},{default:o(()=>[n(v,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[p.value==="form"&&m(a).formOption?(D(),I(we,{key:0,modelValue:m(a).formOption,"onUpdate:modelValue":_[0]||(_[0]=k=>m(a).formOption=k),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),n(v,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[p.value==="flow"?(D(),I(me,{key:0,modelValue:m(a).flowData,"onUpdate:modelValue":_[1]||(_[1]=k=>m(a).flowData=k),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[y,d.value]])]),_:1},8,["modelValue"])}}}),Lt=S({__name:"index",setup(s){const e=T("definition"),i=T({}),t=T(""),a=T("");function u(r){t.value===r.id?t.value="":t.value=r.id}const l=T(!1),c=T(!1);function p(){i.value={},l.value=!0}function d(r){i.value=r,l.value=!0}function b(r){i.value=r,c.value=!0}function V(r){a.value=r.flowModuleId||"",e.value="deploy"}function _(){a.value="",e.value="definition"}async function v(){const r=e.value;await ge(),e.value="",await ge(),e.value=`${r}`}return(r,w)=>{const y=f("el-col"),k=f("el-row");return D(),I(k,{gutter:20},{default:o(()=>[n(y,{span:4},{default:o(()=>[n(_t,{onNodeClick:u})]),_:1}),n(y,{span:20},{default:o(()=>[e.value==="definition"?(D(),I(Pe,{key:0,"category-id":t.value,onAdd:p,onEdit:d,onView:b,onVersion:V},null,8,["category-id"])):B("",!0),e.value==="deploy"&&a.value?(D(),I(Me,{key:1,"flow-module-id":a.value,onEdit:d,onView:b,onBack:_},null,8,["flow-module-id"])):B("",!0),n(Vt,{modelValue:i.value,"onUpdate:modelValue":w[0]||(w[0]=g=>i.value=g),visible:l.value,"onUpdate:visible":w[1]||(w[1]=g=>l.value=g),onClose:v},null,8,["modelValue","visible"]),n(Ot,{modelValue:i.value,"onUpdate:modelValue":w[2]||(w[2]=g=>i.value=g),visible:c.value,"onUpdate:visible":w[3]||(w[3]=g=>c.value=g)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),xt=S({__name:"index",setup(s){const e=it("debugMode",!1),{request:i}=M(),{getTaskOpsList:t}=pt(i),{getCirculateOpsList:a,updateCirculate:u,removeCirculate:l}=Le(i),{bindVal:c,getDataList:p,crudStateRefs:{searchForm:d,crudOption:b}}=R({tableOption:Ye,crudOption:{getList:t},searchForm:{status:te.待办},sortOption:{descs:"start_time"}});le(d,p,{debounce:300,immediate:!0,deep:!0});const V=T("task"),_=[{label:"任务",name:"task",getList:t},{label:"传阅",name:"circulate",getList:a,update:u,remove:l}];function v({paneName:k}){const g=_.find(L=>L.name===k);b.value.getList=g.getList,b.value.update=g.update,b.value.remove=g.remove,p()}const{open:r,close:w}=Ne();function y(k){r({flowKey:k.flowKey,taskId:k.taskId,instanceId:k.flowInstanceId,debug:e.value,circulateId:k.id,onComplete(){w(),p()}})}return(k,g)=>{const L=f("el-tab-pane"),h=f("el-tabs"),$=f("el-switch"),x=f("el-button"),C=f("el-link"),U=f("avue-crud");return D(),P(E,null,[n(h,{modelValue:V.value,"onUpdate:modelValue":g[0]||(g[0]=N=>V.value=N),onTabClick:v},{default:o(()=>[(D(),P(E,null,Y(_,N=>n(L,{key:N.name,label:N.label,name:N.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),n(U,pe(m(c),{permission:{menu:V.value==="circulate"}}),{"menu-right":o(()=>[n(x,{type:"text"},{default:o(()=>[n($,{modelValue:m(e),"onUpdate:modelValue":g[1]||(g[1]=N=>Q(e)?e.value=N:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:N})=>[n(C,{type:"primary",underline:!1,onClick:q=>y(N)},{default:o(()=>[F(K(N.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),It={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Xe},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},$t=S({__name:"index",setup(s){const{request:e}=M(),{bindVal:i,getDataList:t}=R({tableOption:It,crudOption:Ce(e)});return t(),(a,u)=>{const l=f("avue-crud");return D(),I(l,j(J(m(i))),null,16)}}}),Tt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Nt={class:"flow-list"},Pt=["onClick"],Mt={class:"flow-name"},Ut=S({__name:"index",setup(s){const{request:e}=M(),{useList:i}=Oe(e),{usePublishList:t,getTaskList:a}=Ze(e),{getCirculateList:u}=Le(e),{data:l}=i(),{data:c}=t(),p=H(()=>{var h;return(h=l.value)==null?void 0:h.map($=>{var C;const x=((C=c.value)==null?void 0:C.filter(U=>U.categoryId===$.id))??[];return{...$,list:x}}).filter($=>{var x;return(x=$.list)==null?void 0:x.length})}),d=Re(te).filter((h,$)=>$<2).reverse(),{bindVal:b,getDataList:V,crudStateRefs:{searchForm:_,crudOption:v}}=R({tableOption:Tt,crudOption:{getList:a},searchForm:{status:te.待办}});le(_,V,{debounce:300,immediate:!0,deep:!0});const r=T("task"),w=[{label:"任务",name:"task",getList:a},{label:"传阅",name:"circulate",getList:u}];function y({paneName:h}){const $=w.find(x=>x.name===h);v.value.getList=$.getList,V()}const{open:k,close:g}=Ne();function L(h){k({flowKey:h.flowKey,taskId:h.taskId,instanceId:h.flowInstanceId,circulateId:h.id,detail:h.taskId?h.status===te.已办:!1,onComplete(){g(),V()}})}return(h,$)=>{const x=f("el-button"),C=f("el-divider"),U=f("Icon"),N=f("el-collapse-item"),q=f("el-collapse"),W=f("el-card"),ne=f("el-tab-pane"),se=f("el-tabs"),ie=f("avue-radio"),ue=f("el-link"),re=f("avue-crud");return D(),P(E,null,[n(W,{"body-style":{padding:"0 20px"}},{default:o(()=>[n(q,{"model-value":"1"},{default:o(()=>[n(N,{name:"1"},{title:o(()=>[n(x,{text:"",icon:"el-icon-promotion"},{default:o(()=>[F(" 发起审批 ")]),_:1})]),default:o(()=>[G("div",Nt,[(D(!0),P(E,null,Y(p.value,O=>(D(),P("div",{key:O.id,class:"flow-category"},[n(C,{"content-position":"left"},{default:o(()=>[F(K(O.name),1)]),_:2},1024),(D(!0),P(E,null,Y(O.list,A=>(D(),P("div",{key:A.flowKey,class:"flow-item",onClick:ee=>L(A)},[n(U,{class:"flow-icon",icon:A.flowIcon,width:"60"},null,8,["icon"]),G("div",Mt,K(A.flowName),1)],8,Pt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),n(C,{direction:"horizontal","content-position":"left"}),n(se,{modelValue:r.value,"onUpdate:modelValue":$[0]||($[0]=O=>r.value=O),onTabClick:y},{default:o(()=>[(D(),P(E,null,Y(w,O=>n(ne,{key:O.name,label:O.label,name:O.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),n(re,j(J(m(b))),{"menu-left":o(()=>[n(ie,{modelValue:m(_).status,"onUpdate:modelValue":$[1]||($[1]=O=>m(_).status=O),button:"",dic:m(d)},null,8,["modelValue","dic"])]),processTitle:o(({row:O})=>[n(ue,{type:"primary",underline:!1,onClick:A=>L(O)},{default:o(()=>[F(K(O.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),St=Ae(Ut,[["__scopeId","data-v-2a79bd12"]]),Bt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Kt=S({__name:"index",setup(s){const{request:e}=M(),{bindVal:i,crudStateRefs:{formData:t},getDataList:a,handleUpdate:u}=R({tableOption:Bt,crudOption:Ie(e)});a();const l=T(!1);async function c(d){t.value=d,l.value=!0}async function p(){await u(t.value,NaN,()=>l.value=!1,()=>{})}return(d,b)=>{const V=f("el-button"),_=f("avue-crud"),v=f("el-dialog");return D(),P(E,null,[n(_,j(J(m(i))),{menu:o(({row:r})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>c(r)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(v,{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=r=>l.value=r),title:`模型设计-${m(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(V,{type:"primary",onClick:p},{default:o(()=>[F(" 保存 ")]),_:1}),n(V,{onClick:b[1]||(b[1]=r=>l.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[n(me,{modelValue:m(t).flowData,"onUpdate:modelValue":b[0]||(b[0]=r=>m(t).flowData=r),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),At={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Et=S({__name:"index",setup(s){const{request:e}=M(),{bindVal:i,crudStateRefs:{formData:t},getDataList:a,handleUpdate:u}=R({tableOption:At,crudOption:$e(e)});a();const l=T(!1);async function c(d){t.value={...d},l.value=!0}async function p(){await u(t.value,NaN,()=>l.value=!1,()=>{})}return(d,b)=>{const V=f("el-button"),_=f("avue-crud"),v=f("el-dialog");return D(),P(E,null,[n(_,j(J(m(i))),{menu:o(({row:r})=>[n(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>c(r)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),n(v,{modelValue:l.value,"onUpdate:modelValue":b[2]||(b[2]=r=>l.value=r),title:`表单设计-${m(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[n(V,{type:"primary",onClick:p},{default:o(()=>[F(" 保存 ")]),_:1}),n(V,{onClick:b[1]||(b[1]=r=>l.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[n(we,{modelValue:m(t).formOption,"onUpdate:modelValue":b[0]||(b[0]=r=>m(t).formOption=r),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Rt=G("br",null,null,-1),zt=S({__name:"index",setup(s){const{request:e}=M(),{bindVal:i,crudStateRefs:{formData:t,defaults:a},getDataList:u,afterOpen:l,beforeSubmit:c}=R({crudOption:de(e),tableOption:qe});u();const{data:p}=Ce(e).useParam("table.default.fields");l(w=>{if(t.value.defaultFields=p.value??[],w==="edit"){const y=JSON.parse(t.value.tableFields);t.value.editFields=ct(y,p.value??[],"name")}}),c(w=>{const y=[...w.defaultFields,...w.editFields];w.tableFields=JSON.stringify(y)});const d=T(!1);ce(()=>{var w;(w=a.value)!=null&&w.defaultFields&&(a.value.defaultFields.display=d.value)});const{deploy:b,getFields:V}=de(e),_=T(!1);async function v(w){await X.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,b({id:w.id}).then(()=>{z.success("部署成功"),u()}).finally(()=>{_.value=!1})}function r(){V({tableName:t.value.tableName}).then(w=>{var y;if(!((y=w.data)!=null&&y.length))return z.warning("未找到该表");t.value.editFields=w.data})}return(w,y)=>{const k=f("el-button"),g=f("el-input"),L=f("el-switch"),h=f("el-tooltip"),$=f("avue-crud");return D(),I($,j(J(m(i))),{menu:o(({row:x})=>[n(k,{type:"text",icon:"el-icon-upload",onClick:C=>v(x)},{default:o(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[n(g,{modelValue:m(t).tableName,"onUpdate:modelValue":y[0]||(y[0]=x=>m(t).tableName=x),placeholder:"请输入 表名"},{append:o(()=>[n(k,{type:"primary",size:"default",onClick:r},{default:o(()=>[F(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[G("div",null,[F(" 数据库字段 "),Rt,n(h,{content:"显示默认字段"},{default:o(()=>[n(L,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=x=>d.value=x)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),jt=S({__name:"index",setup(s){const e=ut(),i=T({}),{FlowForm:t}=M(),a=H(()=>{const l=i.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${l==null?void 0:l.title}`:e.instanceId||e.taskId?`办理流程：${l==null?void 0:l.title}`:`发起流程：${l==null?void 0:l.title}`});rt(a);async function u(l){window.postMessage({event:"onComplete",data:{...l}})}return(l,c)=>(D(),I(m(t),pe({flowDetail:i.value,"onUpdate:flowDetail":c[0]||(c[0]=p=>i.value=p)},m(e),{onComplete:u}),null,16,["flowDetail"]))}}),Jt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:vt,PageFlowDefinition:Pe,PageFlowDeploy:Me,PageFlowForm:jt,PageFlowManage:Lt,PageFlowOps:xt,PageFlowParam:$t,PageFlowTemplate:Kt,PageFlowWorkbench:St,PageFormTemplate:Et,PageTableTemplate:zt},Symbol.toStringTag,{value:"Module"})),yo={install(s,e){Object.entries(Jt).forEach(([i,t])=>{s.component(i,t)}),M(s,e)}};export{ko as ApprovalForm,Do as ButtonList,ze as CONFIG_DEFAULT,Vo as CONFIG_PROVIDE_KEY,Fo as FieldType,Co as FlowButtonApproval,ho as FlowButtonDisplay,Oo as FlowButtonKey,Lo as FlowButtonStatus,xo as FlowButtonType,Io as FlowForm,$o as FlowStatus,To as HandleType,No as InternalForm,xe as IsMainVersion,vt as PageFlowButton,Pe as PageFlowDefinition,Me as PageFlowDeploy,jt as PageFlowForm,Lt as PageFlowManage,xt as PageFlowOps,$t as PageFlowParam,Kt as PageFlowTemplate,St as PageFlowWorkbench,Et as PageFormTemplate,zt as PageTableTemplate,Po as TablePrimary,te as TaskStatus,Mo as UploadTable,Uo as Whether,Qe as asyncValidate,yo as default,So as fieldTypeDic,Bo as flowFormEmits,Ko as flowFormProps,Ao as flowTrack,Eo as injectionKey,Ro as isMobile,zo as tablePrimaryDic,jo as useButtonHandler,Jo as useCommonCommentApi,M as useConfigProvider,Je as useFlowButtonApi,Oe as useFlowCategoryApi,Le as useFlowCirculateApi,ae as useFlowDefinitionApi,_e as useFlowDeployApi,Wo as useFlowFileApi,Ne as useFlowForm,ft as useFlowFormOverlay,mt as useFlowFormWindow,pt as useFlowOpsApi,Ce as useFlowParamApi,Ze as useFlowTaskApi,Ie as useFlowTemplateApi,Ho as useFlowUserApi,Go as useFormDefaults,$e as useFormTemplateApi,Qo as useInjectState,Yo as useProvideState,de as useTableTemplateApi,Xe as whetherDic};
