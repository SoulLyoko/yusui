import{aq as ze,aA as te,A as Je,aB as Z,aC as H,aD as se,aE as He}from"../composables_use-crud_index.md.5c8a71dd.js";import{r as We}from"./axios.126f0189.js";import{x as Ge,y as Qe,d as ae,z as Xe}from"./theme.cce338c9.js";import{s as re,r as x,f as R,E as _,h as k,B as O,C as n,H as u,l as N,t as B,u as i,ao as Q,ap as X,b as ne,i as q,ai as Ye,d as Ze,A as G,D as j,j as A,M as oe,F as J,n as ee,c as W,k as et,m as tt,w as xe,aI as $e,a2 as Oe,_ as lt}from"./framework.73e971ba.js";import{a5 as Ce,a7 as ot,a8 as at,A as nt,_ as rt,a4 as st}from"./index.vue_vue_type_script_setup_true_lang.36e93ea2.js";import{a as it,_ as ut}from"./index.vue_vue_type_script_setup_true_lang.f0274809.js";import{d as pt}from"./data.ee8ef805.js";import{a as dt}from"../flow-design_flow-modeler_index.md.a99cd182.js";import"../app.2c59da0d.js";import"../components_basic-container_index.md.33e2e73d.js";import"../components_icon-select_index.md.70a43974.js";import"../components_index.md.c728d524.js";import"../components_v-text_index.md.35803233.js";import"../composables_index.md.82d92869.js";import"../eslint-config_index.md.490589a3.js";import"../flow-design_flow-viewer_index.md.712f2e4b.js";import"../flow-design_index.md.024ac947.js";import"../flow-pages_flow-button_index.md.0bf1c0cd.js";import"../flow-pages_flow-manage_index.md.be05be89.js";import"../flow-pages_flow-ops_index.md.434b4f7c.js";import"../flow-pages_flow-param_index.md.4a369660.js";import"../flow-pages_flow-template_index.md.7367bc54.js";import"../flow-pages_form-template_index.md.b8c1d1c5.js";import"../flow-pages_index.md.e9ff3758.js";import"../flow-pages_table-template_index.md.763245d3.js";import"../flow-pages_workbench_index.md.02bdf58f.js";import"../form-design_demo.md.8708b1a5.js";import"../form-design_index.md.4fdd5bbe.js";import"../guide_changelog.md.02388c11.js";import"../guide_start.md.24de7cab.js";import"../index.md.f19876de.js";import"../plugins_avue-patch_index.md.d561e9ae.js";import"../plugins_env-dts_index.md.572f9051.js";import"../plugins_index.md.d83e8e8e.js";import"../plugins_load-proxy_index.md.084158d7.js";import"../plugins_uni-ui-patch_index.md.3ced42bf.js";import"../plugins_uview-patch_index.md.ee7eb1f0.js";import"../prettier-config_index.md.b6cd0e2f.js";import"../types_avue_index.md.7143d382.js";import"../utils_date_dateFormat.md.5985d0cd.js";import"../utils_date_durationFormat.md.2966e0ac.js";import"../utils_emitter_mittAsync.md.4b5e511a.js";import"../utils_index.md.ee4575ad.js";import"../utils_math_index.md.1e53b96c.js";import"../utils_object_filterObj.md.1511070c.js";import"../utils_object_filterObjDeep.md.40363797.js";import"../utils_object_getDataType.md.6da89c66.js";import"../utils_string_deserialize.md.f43e813e.js";import"../utils_string_serialize.md.95a7c84a.js";import"../utils_string_uuid.md.68f2dd09.js";import"../utils_tool_awaitTo.md.279f6b99.js";import"../utils_tool_enumToDic.md.b627017e.js";import"../utils_tool_sleep.md.b763f9a2.js";import"../utils_tree_buildTree.md.d003b4c2.js";import"../utils_tree_filterTree.md.62427dda.js";import"../utils_tree_findTree.md.7bbe0e64.js";import"../utils_tree_flatTree.md.24978388.js";import"../utils_tree_treeMap.md.71c0e77f.js";import"./vue.runtime.esm-bundler.349ba31b.js";var ce=We();const fe=ze(ce);var ct=Object.defineProperty,ft=Object.defineProperties,mt=Object.getOwnPropertyDescriptors,Ve=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable,ke=(e,o,a)=>o in e?ct(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,de=(e,o)=>{for(var a in o||(o={}))vt.call(o,a)&&ke(e,a,o[a]);if(Ve)for(var a of Ve(o))_t.call(o,a)&&ke(e,a,o[a]);return e},he=(e,o)=>ft(e,mt(o));function bt(...e){const o=typeof e[0]=="string"?e[0]:void 0,a=Ge(o)?1:0;let d={},r=fe,l={immediate:!!a,shallow:!0};const f=g=>!!(g!=null&&g.request);e.length>0+a&&(f(e[0+a])?r=e[0+a]:d=e[0+a]),e.length>1+a&&f(e[1+a])&&(r=e[1+a]),(e.length===2+a&&!f(e[1+a])||e.length===3+a)&&(l=e[e.length-1]);const m=re(),w=l.shallow?re():x(),s=x(!1),V=x(!1),p=x(!1),v=re(),y=fe.CancelToken.source;let t=y();const c=g=>{s.value||!V.value||(t.cancel(g),t=y(),p.value=!0,V.value=!1,s.value=!1)},h=g=>{V.value=g,s.value=!g},I=()=>new Promise((g,C)=>{Qe(s).toBe(!0).then(()=>g(b)).catch(C)}),$=(g,C)=>I().then(g,C),U=(g=o,C={})=>{v.value=void 0;const L=typeof g=="string"?g:o??C.url;return L===void 0?(v.value=new ce.AxiosError(ce.AxiosError.ERR_INVALID_URL),s.value=!0,{then:$}):(c(),h(!0),r(L,he(de(de({},d),typeof g=="object"?g:C),{cancelToken:t.token})).then(S=>{var M;m.value=S;const F=S.data;w.value=F,(M=l.onSuccess)==null||M.call(l,F)}).catch(S=>{var M;v.value=S,(M=l.onError)==null||M.call(l,S)}).finally(()=>h(!1)),{then:$})};l.immediate&&o&&U();const b={response:m,data:w,error:v,finished:s,loading:V,isFinished:s,isLoading:V,cancel:c,isAborted:p,canceled:p,aborted:p,isCanceled:p,abort:c,execute:U};return he(de({},b),{then:$})}const D=fe.create();D.interceptors.response.use(e=>{const o=e.data;return o.code!==200?(te.error(o.msg),Promise.reject(o.msg)):o});function ve(e,o,a){const d=D;o!=null&&o.dataPath&&(o.transformResponse=l=>(l=JSON.parse(l),{...l,data:Je({res:l},o.dataPath)}));const r=[];return r.push(e),o&&r.push(o),r.push(d),a&&r.push(a),bt(...r)}var Ie=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Ie||{}),Ne=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Ne||{}),Ue=(e=>(e.不显示="false",e.审批人="approver",e.抄送人="copyUser",e.意见="comment",e))(Ue||{}),Pe=(e=>(e[e.禁用=1]="禁用",e[e.正常=0]="正常",e))(Pe||{});function wt(e){return D.get("/sapier-flow/dev-button/list",{params:e})}function yt(e){return D.post("/sapier-flow/dev-button/save",e)}function gt(e){return D.post("/sapier-flow/dev-button/update",e)}function Vt(e){return D.post("/sapier-flow/dev-button/remove",{},{params:{ids:e}})}const kt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,labelWidth:130,column:[{label:"按钮名称",prop:"name"},{label:"按钮标识",prop:"buttonKey"},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:Z(Ie)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:Z(Ne)},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:Z(Ue)},{label:"状态",prop:"status",type:"switch",value:1,dicData:Z(Pe)},{label:"排序",prop:"sort",type:"number",value:0},{label:"按钮预览",prop:"buttonPreview",width:200}]},ht=R({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:a},getDataList:d}=H({crudOption:{rowKey:"id",getList:wt,create:yt,update:gt,remove:Vt},tableOption:kt,sortOption:{ascs:"sort"}});return d(),(r,l)=>{const f=_("v-icon"),m=_("el-button"),w=_("avue-crud");return k(),O(w,Q(X(i(o))),{icon:n(({row:s})=>[u(f,{icon:s.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:n(({row:s})=>[u(m,{type:s.buttonType},{default:n(()=>[u(f,{icon:s.icon},null,8,["icon"]),N(" "+B(s.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":n(()=>[u(m,{type:i(a).buttonType},{default:n(()=>[u(f,{icon:i(a).icon},null,8,["icon"]),N(" "+B(i(a).name),1)]),_:1},8,["type"])]),_:1},16)}}}),_e={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},Dt={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[..._e.column,{label:"流程主版本",prop:"mainVersion",formatter(e,o){return o?`V${o||""}`:""}}]};function xt(e){return D.get("/sapier-flow/flow-definition/list",{params:e})}function Me(e){return D.get("/sapier-flow/flow-definition/detail",{params:e})}function $t(e){return D.post("/sapier-flow/flow-definition/save",e)}function Ot(e){return D.post("/sapier-flow/flow-definition/update",e)}function Se(e){return D.post("/sapier-flow/flow-definition/deployFlow",e)}const Le=R({__name:"index",props:{categoryId:null},emits:["add","view","edit","version"],setup(e,{emit:o}){const a=e,d={rowKey:"flowModuleId",getList:xt},{bindVal:r,crudStateRefs:{searchForm:l},getDataList:f}=H({crudOption:d,tableOption:Dt,searchForm:{categoryId:a.categoryId}});ne(()=>{l.value.categoryId=a.categoryId??"",f()});const m=x(!1);async function w(s){await se.confirm("发布新版本，是否确认？","提示",{type:"success"}),m.value=!0,Se({flowModuleId:s.flowModuleId}).then(()=>{te.success("发布成功"),f()}).finally(()=>{m.value=!1})}return(s,V)=>{const p=_("el-button"),v=_("v-icon"),y=_("avue-crud");return k(),O(y,Q(X(i(r))),{"menu-left":n(()=>[u(p,{type:"primary",icon:"el-icon-plus",onClick:V[0]||(V[0]=t=>o("add"))},{default:n(()=>[N("新增")]),_:1})]),menu:n(({row:t})=>[u(p,{loading:m.value,type:"text",icon:"el-icon-view",onClick:c=>o("view",t)},{default:n(()=>[N(" 查看 ")]),_:2},1032,["loading","onClick"]),u(p,{loading:m.value,type:"text",icon:"el-icon-edit",onClick:c=>o("edit",t)},{default:n(()=>[N(" 编辑 ")]),_:2},1032,["loading","onClick"]),u(p,{loading:m.value,type:"text",icon:"el-icon-upload",onClick:c=>w(t)},{default:n(()=>[N(" 发布 ")]),_:2},1032,["loading","onClick"]),u(p,{loading:m.value,type:"text",icon:"el-icon-switch",onClick:c=>o("version",t)},{default:n(()=>[N(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),flowIcon:n(({row:t})=>[u(v,{icon:t.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Ct={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[..._e.column,{label:"流程版本",prop:"version",formatter(e,o){return o?`V${o||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]};var Ke=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Ke||{});function It(e){return D.get("/sapier-flow/flow-deploy/list",{params:e})}function Fe(e){return D.get("/sapier-flow/flow-deploy/detail",{params:e})}function Re(e){return D.post("/sapier-flow/flow-deploy/update",e)}function Nt(){return D.get("/sapier-flow/flow-run/queryPublishFlowList")}const Ee=R({__name:"index",props:{flowModuleId:null},emits:["back","view","edit"],setup(e,{emit:o}){const a=e,d={rowKey:"flowDeloyId",getList:It,dataPath:"res.data"},{bindVal:r,crudStateRefs:{searchForm:l},getDataList:f}=H({crudOption:d,tableOption:Ct});ne(()=>{a.flowModuleId&&(l.value.flowModuleId=a.flowModuleId,f())});const m=x(!1);async function w(s){await se.confirm(`确定将 ${s.flowName}(${s.flowKey}:v${s.version}) 设为主版本?`,"提示",{type:"warning"}),m.value=!0,Re({flowDeployId:s.flowDeployId,flowModuleId:s.flowModuleId,mainVersion:1}).then(()=>{te.success("设置成功"),f()}).finally(()=>{m.value=!1})}return(s,V)=>{const p=_("el-button"),v=_("v-icon"),y=_("avue-crud");return k(),O(y,Q(X(i(r))),{"menu-left":n(()=>[u(p,{loading:m.value,type:"primary",icon:"el-icon-arrow-left",onClick:V[0]||(V[0]=t=>o("back"))},{default:n(()=>[N("返回")]),_:1},8,["loading"])]),menu:n(({row:t})=>[u(p,{loading:m.value,type:"text",icon:"el-icon-view",onClick:c=>o("view",t)},{default:n(()=>[N(" 查看 ")]),_:2},1032,["loading","onClick"]),u(p,{loading:m.value,type:"text",icon:"el-icon-edit",onClick:c=>o("edit",t)},{default:n(()=>[N(" 编辑 ")]),_:2},1032,["loading","onClick"]),u(p,{loading:m.value,disabled:t.mainVersion===i(Ke).是,type:"text",icon:"el-icon-switch",onClick:c=>w(t)},{default:n(()=>[N(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),flowIcon:n(({row:t})=>[u(v,{icon:t.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}});function Ut(e){return D.get("/sapier-flow/flow-run/queryPublishFlowDetail",{params:e})}function Pt(e){return D.post("/sapier-flow/flow-run/startProcess",e)}function Mt(e){return D.post("/sapier-flow/flow-run/commitTask",e)}function St(e){return D.post("/sapier-flow/flow-run/queryApprovalNode",e)}function be(e){return new Promise((o,a)=>{(q(e)?e.value:e).validate((r,l)=>{r?(l(),o(r)):a(r)})})}const Lt=R({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:o}=ae(e,void 0,{passive:!0,deep:!0}),a=x({}),{proxy:d}=Ze(),r=x({});ne(()=>{const{formOption:m}=e.flowDetail.process??{};r.value=Ce.bind(d)(m||'{"menuBtn":false}'),r.value.detail=!!e.detail});const l=x();function f(){return be(l)}return{form:o,option:r,defaults:a,formRef:l,validate:f}},render(){return Ye(_("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Kt=R({__name:"approval-form",props:{modelValue:null,visible:{type:Boolean},variables:null,flowDetail:null},emits:["confirm"],setup(e,{emit:o}){const a=e,d={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},r=ae(a),{modelValue:l,visible:f,flowDetail:m}=r,w=x([]),s=x({approver:[],copyUser:"",comment:""}),V=x(),p=x({}),v={menuBtn:!1,labelWidth:70,column:[{label:"审批人",prop:"approver",span:24,rules:[{required:!0,validator:y}]},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function y(b,g,C){var M;const L=w.value[0].type==="ParallelGateway",S=(M=w.value[0].children)==null?void 0:M.every(F=>ot([F],P=>g.some(K=>K.id===P.id)));if(g.length){if(L&&!S)return C("请在每个节点选择审批人")}else return C("请选择审批人");return!0}const t=x(!0),c=x(!1);ne(async()=>{var L,S,M;if(!f.value||!V.value)return;const{flowKey:b}=((L=m.value)==null?void 0:L.process)||{},{taskId:g}=((S=m.value)==null?void 0:S.task)||{},C=g?"":"发起";if(w.value=[],s.value={approver:[],copyUser:"",comment:l.value.comment||C},ee(()=>{}),t.value){console.log("🚀 ~ file: approval-form.vue:120 ~ watchEffect ~ flowDetail:",m);const F=await St({flowKey:b,variables:a.variables,taskId:g});w.value=at(F.data??[],(K,Y,z)=>{const E=K.id||He();return K.taskNodeKey=(z==null?void 0:z.taskNodeKey)??K.taskNodeKey,K.incoming=(z==null?void 0:z.incoming)??K.incoming,{...K,id:E,disabled:K.type!=="user"}}),await ee();const P=h(w.value);P&&((M=I.value)==null||M.setCheckedNodes([P]))}});function h(b){var g;if(b.length===1)return(g=b[0].children)!=null&&g.length?h(b[0].children):b[0]}const I=x();async function $(b,g){var L,S;if(b.type!=="user")return;await ee(),await ee();const C=(L=I.value)==null?void 0:L.getCheckedNodes();s.value.approver=C.filter(M=>M.type==="user"),(S=I.value)==null||S.setCheckedNodes(s.value.approver)}async function U(){await be(V),c.value=!0;const{approver:b,copyUser:g,comment:C}=s.value,L={},S={},M=new Set;b.forEach(F=>{const{taskNodeKey:P,incoming:K}=F;L[P]||(L[P]=new Set),F.userId&&L[P].add(F.userId),S[P]=[...L[P]].join(","),M.add(K)}),l.value.assignee=S,l.value.comment=C,l.value.outgoing=[...M],console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",l),o("confirm")}return(b,g)=>{const C=_("v-icon"),L=_("el-tree"),S=_("el-col"),M=_("el-tag"),F=_("el-input"),P=_("avue-form"),K=_("el-row"),Y=_("el-button"),z=_("el-dialog");return k(),O(z,{modelValue:i(f),"onUpdate:modelValue":g[4]||(g[4]=E=>q(f)?f.value=E:null),width:t.value?"800px":"500px","append-to-body":""},{footer:n(()=>[u(Y,{onClick:g[3]||(g[3]=E=>f.value=!1)},{default:n(()=>[N("取 消")]),_:1}),u(Y,{type:"primary",onClick:U},{default:n(()=>[N("确 定")]),_:1})]),default:n(()=>[u(K,{gutter:20},{default:n(()=>[t.value?(k(),O(S,{key:0,span:10},{default:n(()=>[u(L,{ref_key:"treeRef",ref:I,class:"approval-tree","w-full":"","h-400px":"","overflow-y-scroll":"","node-key":"id","empty-text":"无需选择审批人","default-expand-all":"","show-checkbox":"","check-on-click-node":"",data:w.value,style:{"max-height":"600px",overflow:"auto"},onCheckChange:$},{default:n(({data:E})=>[G("div",null,[u(C,{icon:d[E.type],style:{display:"inline-block"}},null,8,["icon"]),G("span",null,B(E.title),1)])]),_:1},8,["data"])]),_:1})):j("",!0),u(S,{span:t.value?14:24},{default:n(()=>[u(P,{ref_key:"formRef",ref:V,modelValue:s.value,"onUpdate:modelValue":g[1]||(g[1]=E=>s.value=E),defaults:p.value,"onUpdate:defaults":g[2]||(g[2]=E=>p.value=E),option:v},{approver:n(()=>[(k(!0),A(J,null,oe(s.value.approver,E=>(k(),O(M,{key:E.id,type:"info"},{default:n(()=>[N(B(E.title),1)]),_:2},1024))),128))]),copyUser:n(()=>[]),comment:n(()=>[u(F,{modelValue:s.value.comment,"onUpdate:modelValue":g[0]||(g[0]=E=>s.value.comment=E),type:"textarea"},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["span"])]),_:1})]),_:1},8,["modelValue","width"])}}}),Ft=dt,ie=R({__name:"index",props:{modelValue:null,view:{type:Boolean},formOption:null,flowHistory:null},emits:["update:modelValue"],setup(e,{emit:o}){const a=e,d=x({}),r=x();function l(v,y){return v.map(t=>{var M,F;const c=y.find(P=>P.prop===t.prop),{label:h,prop:I,display:$=!0,disabled:U=!1,detail:b=!1,readonly:g=!1,rules:C}=t,L=(C==null?void 0:C.some(P=>P.required))??!1,S={label:h,prop:I,display:$,disabled:U,detail:b,readonly:g,required:L,...c};return t.type==="dynamic"&&((F=(M=t.children)==null?void 0:M.column)!=null&&F.length)&&(S.children=l(t.children.column,(c==null?void 0:c.children)??[])),S})}async function f(v){var h;if(await ee(),!((h=d.value.group)!=null&&h.some(I=>I.prop==="formProperty")))return v;const{column:y=[],group:t=[]}=JSON.parse(a.formOption||"{}"),c=l([...y,...t.map(I=>I.column??[]).flat()],v.formProperty||[]);return{...v,formProperty:c}}function m(v){var I;const{column:y=[],group:t=[]}=JSON.parse(a.formOption||"{}"),h=[...y,...t.map($=>$.column??[]).flat()].map($=>({label:$.label,value:`\${${$.prop}}`,desc:`\${${$.prop}}`}));return(I=v.group)==null||I.forEach($=>{var U;$.prop==="base"&&((U=$.column)==null||U.forEach(b=>{b.prop==="priority"&&(b.type="select",b.filterable=!0,b.allowCreate=!0,b.defaultFirstOption=!0,b.dicData=h),b.prop==="formTitle"&&(b.type="select",b.dataType="string",b.multiple=!0,b.filterable=!0,b.allowCreate=!0,b.defaultFirstOption=!0,b.dicData=h)}))}),v}const w=W({get(){let v=pt();return typeof a.modelValue=="string"&&a.modelValue?v=JSON.parse(a.modelValue):typeof a.modelValue=="object"&&Object.keys(a.modelValue)&&(v=a.modelValue),v},set(v){o("update:modelValue",JSON.stringify(v))}}),s={1:"lightgreen",2:"lightblue"},V=W(()=>{var y;const v=((y=a.flowHistory)==null?void 0:y.map(t=>{const c={fill:s[t.status]};return[t.taskNodeKey,c]}))??[];return Object.fromEntries(v)}),p=re();return(v,y)=>e.view?(k(),O(i(it),{key:0,lf:i(p),"onUpdate:lf":y[0]||(y[0]=t=>q(p)?p.value=t:null),modelValue:i(w),styles:i(V)},null,8,["lf","modelValue","styles"])):(k(),O(i(ut),{key:1,modelValue:i(w),"onUpdate:modelValue":y[1]||(y[1]=t=>q(w)?w.value=t:null),lf:i(p),"onUpdate:lf":y[2]||(y[2]=t=>q(p)?p.value=t:null),elementData:r.value,"onUpdate:elementData":y[3]||(y[3]=t=>r.value=t),formOption:d.value,"onUpdate:formOption":y[4]||(y[4]=t=>d.value=t),formOptions:i(Ft),formDataFormat:f,formOptionFormat:m,formWidth:"30%"},null,8,["modelValue","lf","elementData","formOption","formOptions"]))}}),Rt={style:{height:"700px"}},Et=R({__name:"flow-track",props:{flowDetail:null},setup(e){const o=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],a=x("graph");return(d,r)=>{var w,s,V;const l=_("v-icon"),f=_("el-radio-button"),m=_("el-radio-group");return k(),A(J,null,[u(m,{modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=p=>a.value=p)},{default:n(()=>[(k(),A(J,null,oe(o,p=>u(f,{key:p.label,label:p.label},{default:n(()=>[u(l,{icon:p.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),G("div",Rt,[a.value==="graph"?(k(),O(ie,{key:0,modelValue:(s=(w=e.flowDetail)==null?void 0:w.process)==null?void 0:s.flowData,flowHistory:(V=e.flowDetail)==null?void 0:V.flowHistory,view:""},null,8,["modelValue","flowHistory"])):j("",!0)])],64)}}}),we=R({__name:"index",props:{flowKey:null,taskId:null,instanceId:null,visible:{type:Boolean},flowDetail:null,modelValue:null,formOption:null,loading:{type:Boolean},activeTab:null,debug:{type:Boolean}},setup(e){const o=e,a=ae(o,void 0,{passive:!0,deep:!0}),{visible:d,flowDetail:r,modelValue:l,loading:f,activeTab:m}=a;function w(c){m.value="form",r.value={},l.value={},c==null||c()}ne(()=>{const{flowKey:c,taskId:h,instanceId:I}=o;!c&&!h&&!I||d.value&&(w(),f.value=!0,Ut({flowKey:c,taskId:h,flowInstanceId:I}).then($=>{r.value=$.data,l.value=$.data.formData||{}}).finally(()=>{f.value=!1}))});const s=x(!1),V=W(()=>Object.entries(l.value||{}).filter(([c])=>!c.startsWith("$")).map(([c,h])=>({key:c,value:h}))),p=x();async function v(){var c;await((c=p.value)==null?void 0:c.validate()),s.value=!0}const y=x({});async function t(){var U,b;const{flowDeployId:c}=((U=r.value)==null?void 0:U.process)??{},{taskId:h,flowInstanceId:I}=((b=r.value)==null?void 0:b.task)??{},$={flowDeployId:c,taskId:h,flowInstanceId:I,variables:V.value,debug:o.debug,...y.value};await(h&&I?Mt($):Pt($)),te.success("操作成功"),s.value=!1,d.value=!1}return(c,h)=>{var M,F;const I=_("el-skeleton"),$=_("el-button"),U=_("el-header"),b=_("el-tab-pane"),g=_("el-tabs"),C=_("el-main"),L=_("el-container"),S=_("el-drawer");return k(),O(S,{modelValue:i(d),"onUpdate:modelValue":h[4]||(h[4]=P=>q(d)?d.value=P:null),title:(F=(M=i(r))==null?void 0:M.process)==null?void 0:F.flowName,"destroy-on-close":"","before-close":w,size:"60%"},{default:n(()=>[i(f)?(k(),O(I,{key:0})):(k(),O(L,{key:1},{default:n(()=>[u(U,{height:"40px",style:{padding:"0"}},{default:n(()=>[u($,{type:"primary",onClick:v},{default:n(()=>[N("发送")]),_:1})]),_:1}),u(C,{style:{padding:"0"}},{default:n(()=>[u(g,{modelValue:i(m),"onUpdate:modelValue":h[1]||(h[1]=P=>q(m)?m.value=P:null)},{default:n(()=>{var P,K;return[(K=(P=i(r))==null?void 0:P.process)!=null&&K.formPath?et(c.$slots,"default",{key:0}):(k(),O(b,{key:1,label:"审批信息",name:"form"},{default:n(()=>[u(Lt,{ref_key:"formRef",ref:p,modelValue:i(l),"onUpdate:modelValue":h[0]||(h[0]=Y=>q(l)?l.value=Y:null),flowDetail:i(r)},null,8,["modelValue","flowDetail"])]),_:1})),u(b,{label:"流程跟踪",name:"track",lazy:""},{default:n(()=>[u(Et,{flowDetail:i(r)},null,8,["flowDetail"])]),_:1})]}),_:3},8,["modelValue"])]),_:3})]),_:3})),u(Kt,{modelValue:y.value,"onUpdate:modelValue":h[2]||(h[2]=P=>y.value=P),visible:s.value,"onUpdate:visible":h[3]||(h[3]=P=>s.value=P),variables:i(V),flowDetail:i(r),onConfirm:t},null,8,["modelValue","visible","variables","flowDetail"])]),_:3},8,["modelValue","title"])}}});function jt(e){return D.get("/sapier-flow/flow-category/list",{params:e})}function At(e){return D.post("/sapier-flow/flow-category/save",e)}function qt(e){return D.post("/sapier-flow/flow-category/update",e)}function Tt(e){return D.post("/sapier-flow/flow-category/remove",{},{params:{ids:e}})}const De={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},Bt=R({__name:"index",emits:["node-click"],setup(e,{emit:o}){const a={rowKey:"id",getList:jt,create:At,update:qt,remove:Tt,dataPath:"res.data"},{crudStateRefs:{formData:d,tableData:r},getDataList:l,handleSave:f,handleUpdate:m,handleDel:w}=H({crudOption:a,tableOption:De,pageOption:{pageSize:20},mockCache:"flow-category"});l();function s(v,y,t,c){f(y,t,c)}function V(v,y,t,c){m(y,NaN,t,c)}async function p(v,y){await w(v.data,NaN),y()}return(v,y)=>{const t=_("avue-tree");return k(),O(t,{modelValue:i(d),"onUpdate:modelValue":y[0]||(y[0]=c=>q(d)?d.value=c:null),option:i(De),data:i(r),onNodeClick:y[1]||(y[1]=c=>o("node-click",c)),onSave:s,onUpdate:V,onDel:p},null,8,["modelValue","option","data"])}}}),ye=R({__name:"index",props:{modelValue:null,view:{type:Boolean},fields:null},emits:["update:modelValue"],setup(e,{emit:o}){var m;const a=e,d=W({get(){return a.modelValue?Ce(a.modelValue):{menuBtn:!1,span:24}},set(w){o("update:modelValue",st(w,{useJson5:!1}))}}),r=W(()=>a.fields?JSON.parse(a.fields):[]),l=W(()=>{const w={type:"select",dicData:r.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...w,props:{label:"name",value:"name",desc:"comment"}},{...w,props:{label:"comment",value:"comment",desc:"name"}}]}),f={form:{settings:Array.from({length:((m=nt.settings)==null?void 0:m.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(w,s)=>{const V=_("avue-form");return e.view?(k(),O(V,{key:0,class:tt(i(d).class),modelValue:{},option:i(d)},null,8,["class","option"])):(k(),O(i(rt),{key:1,modelValue:i(d),"onUpdate:modelValue":s[0]||(s[0]=p=>q(d)?d.value=p:null),baseOption:i(l),resources:f},null,8,["modelValue","baseOption"]))}}});function zt(e){return D.get("/sapier-flow/dev-form/list",{params:e})}function Jt(){return ve("/sapier-flow/dev-form/list",{params:{size:-1},dataPath:"res.data.records"})}function Ht(e){return D.post("/sapier-flow/dev-form/submit",e)}function Wt(e){return D.post("/sapier-flow/dev-form/submit",e)}function Gt(e){return D.post("/sapier-flow/dev-form/remove",{},{params:{ids:e}})}function Qt(e){return D.get("/sapier-flow/dev-flow/list",{params:e})}function Xt(){return ve("/sapier-flow/dev-flow/list",{params:{size:-1},dataPath:"res.data.records"})}function Yt(e){return D.post("/sapier-flow/dev-flow/submit",e)}function Zt(e){return D.post("/sapier-flow/dev-flow/submit",e)}function el(e){return D.post("/sapier-flow/dev-flow/remove",{},{params:{ids:e}})}var je=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(je||{});function tl(e){return D.get("/sapier-flow/dev-table/list",{params:e})}function ll(){return ve("/sapier-flow/dev-table/list",{params:{size:-1},dataPath:"res.data.records"})}function ol(e){return D.post("/sapier-flow/dev-table/save",e)}function al(e){return D.post("/sapier-flow/dev-table/update",e)}function nl(e){return D.post("/sapier-flow/dev-table/remove",{},{params:{ids:e}})}function rl(e){return D.post("/sapier-flow/dev-table/deploy",e)}const sl=G("span",null,"流程设计",-1),il={key:0},ul={key:1},pl={style:{height:"calc(100vh - 144px)"}},dl=R({__name:"index",props:{modelValue:null,visible:{type:Boolean}},emits:["close"],setup(e,{emit:o}){const d=ae(e),{visible:r,modelValue:l}=d,f=["流程信息","表单设计","模型设计","完成"],m=x(!1);xe(r,async U=>{if(!U)return;const{flowModuleId:b}=l.value,{flowDeployId:g}=l.value;try{m.value=!0;let C={};g?C=await Fe({flowDeployId:g}):b&&(C=await Me({flowModuleId:b})),l.value=C.data}finally{m.value=!1}},{immediate:!0});const{data:w}=Jt(),{data:s}=Xt(),{data:V}=ll(),p=W(()=>{var U,b;return(b=(U=V.value)==null?void 0:U.find(g=>g.tableName===l.value.formDataTable))==null?void 0:b.tableFields}),v=x(0),y=W(()=>{var U,b;return v.value===1?((U=w.value)==null?void 0:U.map(g=>({label:g.formName,value:g.formOption})))??[]:v.value===2?((b=s.value)==null?void 0:b.map(g=>({label:g.flowName,value:g.flowData})))??[]:[]});function t(U){v.value===1?l.value.formOption=U.value:v.value===2&&(l.value.flowData=U.value)}const c=x();async function h(U){v.value===0&&await be(c),m.value=!0;const{flowModuleId:b}=l.value,{flowDeployId:g}=l.value;try{g?await Re(l.value):b?await Ot(l.value):await $t(l.value).then(C=>{l.value.flowModuleId=C.data.flowModuleId}),te.success("保存成功")}finally{m.value=!1}typeof U=="number"?v.value=U:v.value++}async function I(){await se.confirm("发布新版本，是否确认？","提示"),m.value=!0,Se({flowModuleId:l.value.flowModuleId}).then(()=>{te.success("发布成功")}).finally(()=>{m.value=!1})}function $(){r.value=!1,v.value=0,l.value={},o("close")}return(U,b)=>{const g=_("el-link"),C=_("el-dropdown-item"),L=_("el-dropdown-menu"),S=_("el-dropdown"),M=_("el-col"),F=_("el-step"),P=_("el-steps"),K=_("el-button"),Y=_("el-row"),z=_("avue-form"),E=_("el-result"),Te=_("el-dialog"),Be=$e("loading");return k(),O(Te,{modelValue:i(r),"onUpdate:modelValue":b[4]||(b[4]=T=>q(r)?r.value=T:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:$},{header:n(()=>[u(Y,{align:"center",justify:"center"},{default:n(()=>[u(M,{span:5},{default:n(()=>{var T,le,ue,ge;return[G("div",null,[sl,(T=i(l))!=null&&T.flowName?(k(),A("span",il," - "+B((le=i(l))==null?void 0:le.flowName),1)):j("",!0),(ue=i(l))!=null&&ue.version?(k(),A("span",ul," - V"+B((ge=i(l))==null?void 0:ge.version),1)):j("",!0)]),i(y).length?(k(),O(S,{key:0},{dropdown:n(()=>[u(L,null,{default:n(()=>[(k(!0),A(J,null,oe(i(y),pe=>(k(),O(C,{key:pe.label,onClick:Rl=>t(pe)},{default:n(()=>[N(B(pe.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:n(()=>[u(g,{icon:"el-icon-arrow-down",underline:!1},{default:n(()=>[N("选择模板")]),_:1})]),_:1})):j("",!0)]}),_:1}),u(M,{span:14},{default:n(()=>[u(P,{active:v.value,simple:"","process-status":"finish","finish-status":"success"},{default:n(()=>[(k(),A(J,null,oe(f,(T,le)=>u(F,{key:le,title:T,onClick:ue=>h(le)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),u(M,{span:5,style:{"text-align":"right"}},{default:n(()=>[u(K,{disabled:v.value===0,loading:m.value,type:"primary",onClick:b[0]||(b[0]=T=>v.value--)},{default:n(()=>[N(" 上一步 ")]),_:1},8,["disabled","loading"]),u(K,{disabled:v.value===f.length-1,type:"primary",loading:m.value,onClick:h},{default:n(()=>[N(" 下一步 ")]),_:1},8,["disabled","loading"]),u(K,{onClick:$},{default:n(()=>[N("关闭")]),_:1})]),_:1})]),_:1})]),default:n(()=>[Oe((k(),A("div",pl,[v.value===0?(k(),O(z,{key:0,ref_key:"formRef",ref:c,modelValue:i(l),"onUpdate:modelValue":b[1]||(b[1]=T=>q(l)?l.value=T:null),option:i(_e),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):j("",!0),v.value===1?(k(),O(ye,{key:1,modelValue:i(l).formOption,"onUpdate:modelValue":b[2]||(b[2]=T=>i(l).formOption=T),fields:i(p)},null,8,["modelValue","fields"])):j("",!0),v.value===2?(k(),O(ie,{key:2,modelValue:i(l).flowData,"onUpdate:modelValue":b[3]||(b[3]=T=>i(l).flowData=T),formOption:i(l).formOption},null,8,["modelValue","formOption"])):j("",!0),v.value===3?(k(),O(E,{key:3,icon:"success",title:"流程设计完成"},{extra:n(()=>[i(l).flowDeployId?j("",!0):(k(),O(K,{key:0,type:"primary",onClick:I},{default:n(()=>[N("发布")]),_:1})),u(K,{onClick:$},{default:n(()=>[N("关闭")]),_:1})]),_:1})):j("",!0)])),[[Be,m.value]])]),_:1},8,["modelValue"])}}}),cl=G("span",null,"流程查看",-1),fl={key:0},ml={key:1},vl=R({__name:"index",props:{modelValue:null,visible:{type:Boolean}},setup(e){const a=ae(e),{visible:d,modelValue:r}=a,l=x("form"),f=x(!1);xe(d,async w=>{if(!w)return;const{flowModuleId:s}=r.value,{flowDeployId:V}=r.value;try{f.value=!0;let p={};V?p=await Fe({flowDeployId:V}):s&&(p=await Me({flowModuleId:s})),r.value={...p.data}}finally{f.value=!1}},{immediate:!0});function m(){r.value={},l.value="form"}return(w,s)=>{const V=_("el-tab-pane"),p=_("el-tabs"),v=_("el-dialog"),y=$e("loading");return k(),O(v,{modelValue:i(d),"onUpdate:modelValue":s[3]||(s[3]=t=>q(d)?d.value=t:null),width:"60%",top:"0",onClose:m},{header:n(()=>{var t,c,h,I;return[cl,(t=i(r))!=null&&t.flowName?(k(),A("span",fl," - "+B((c=i(r))==null?void 0:c.flowName),1)):j("",!0),(h=i(r))!=null&&h.version?(k(),A("span",ml," - V"+B((I=i(r))==null?void 0:I.version),1)):j("",!0)]}),default:n(()=>[Oe((k(),O(p,{modelValue:l.value,"onUpdate:modelValue":s[2]||(s[2]=t=>l.value=t)},{default:n(()=>[u(V,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:n(()=>[l.value==="form"&&i(r).formOption?(k(),O(ye,{key:0,ref:"formRef",modelValue:i(r).formOption,"onUpdate:modelValue":s[0]||(s[0]=t=>i(r).formOption=t),view:""},null,8,["modelValue"])):j("",!0)]),_:1}),u(V,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:n(()=>[l.value==="flow"?(k(),O(ie,{key:0,modelValue:i(r).flowData,"onUpdate:modelValue":s[1]||(s[1]=t=>i(r).flowData=t),view:""},null,8,["modelValue"])):j("",!0)]),_:1})]),_:1},8,["modelValue"])),[[y,f.value]])]),_:1},8,["modelValue"])}}}),_l=R({__name:"index",setup(e){const o=x("definition"),a=x({}),d=x(""),r=x("");function l(t){d.value===t.id?d.value="":d.value=t.id}const f=x(!1),m=x(!1);function w(){a.value={},f.value=!0}function s(t){a.value=t,f.value=!0}function V(t){a.value=t,m.value=!0}function p(t){r.value=t.flowModuleId||"",o.value="deploy"}function v(){r.value="",o.value="definition"}async function y(){const t=o.value;await ee(),o.value="",await ee(),o.value=t+""}return(t,c)=>{const h=_("el-col"),I=_("el-row");return k(),O(I,{gutter:20},{default:n(()=>[u(h,{span:4},{default:n(()=>[u(Bt,{onNodeClick:l})]),_:1}),u(h,{span:20},{default:n(()=>[o.value==="definition"?(k(),O(Le,{key:0,categoryId:d.value,onAdd:w,onEdit:s,onView:V,onVersion:p},null,8,["categoryId"])):j("",!0),o.value==="deploy"?(k(),O(Ee,{key:1,flowModuleId:r.value,onEdit:s,onView:V,onBack:v},null,8,["flowModuleId"])):j("",!0),u(dl,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=$=>a.value=$),visible:f.value,"onUpdate:visible":c[1]||(c[1]=$=>f.value=$),onClose:y},null,8,["modelValue","visible"]),u(vl,{modelValue:a.value,"onUpdate:modelValue":c[2]||(c[2]=$=>a.value=$),visible:m.value,"onUpdate:visible":c[3]||(c[3]=$=>m.value=$)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}});var Ae=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e))(Ae||{});function bl(e){return D.get("/sapier-flow/flow-ops/list",{params:e})}const wl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId"},{label:"标题",prop:"processTitle"},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"createTime"},{label:"任务状态",prop:"status",type:"select",dicData:Z(Ae)}]},yl=R({__name:"index",setup(e){const o=Xe("debugMode",!1),a={rowKey:"id",getList:bl},{bindVal:d,crudStateRefs:{formData:r},getDataList:l}=H({crudOption:a,tableOption:wl});l();const f=x(!1);async function m(w){r.value=w,f.value=!0}return(w,s)=>{const V=_("el-switch"),p=_("el-button"),v=_("el-link"),y=_("avue-crud");return k(),A(J,null,[u(y,Q(X(i(d))),{"menu-right":n(()=>[u(p,{type:"text"},{default:n(()=>[u(V,{modelValue:i(o),"onUpdate:modelValue":s[0]||(s[0]=t=>q(o)?o.value=t:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:n(({row:t})=>[u(v,{type:"primary",underline:!1,onClick:c=>m(t)},{default:n(()=>[N(B(t.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16),u(we,{visible:f.value,"onUpdate:visible":s[1]||(s[1]=t=>f.value=t),taskId:i(r).taskId,instanceId:i(r).flowInstanceId,debug:i(o)},null,8,["visible","taskId","instanceId","debug"])],64)}}});var qe=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(qe||{});const me=Z(qe),gl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"配置名称",prop:"paramName"},{label:"配置Key",prop:"paramKey"},{label:"配置值",prop:"paramValue",type:"textarea",overHidden:!0},{label:"系统内置",prop:"paramType",type:"switch",dicData:me},{label:"备注",prop:"remark"}]};function Vl(e){return D.get("/sapier-flow/flow-param/list",{params:e})}function kl(e){return D.get("/sapier-flow/flow-param/getParam",{params:{paramKey:e}})}function hl(e){return D.post("/sapier-flow/flow-param/save",e)}function Dl(e){return D.post("/sapier-flow/flow-param/update",e)}function xl(e){return D.post("/sapier-flow/flow-param/remove",{},{params:{ids:e}})}const $l=R({__name:"index",setup(e){const{bindVal:o,getDataList:a}=H({crudOption:{rowKey:"id",getList:Vl,create:hl,update:Dl,remove:xl},tableOption:gl});return a(),(d,r)=>{const l=_("avue-crud");return k(),O(l,Q(X(i(o))),null,16)}}}),Ol={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Cl=R({__name:"index",setup(e){const o={rowKey:"id",getList:Qt,create:Yt,update:Zt,remove:el},{bindVal:a,crudStateRefs:{formData:d},getDataList:r,handleUpdate:l}=H({crudOption:o,tableOption:Ol,mockCache:"model-template"});r();const f=x(!1);async function m(s){d.value=s,f.value=!0}async function w(){await l(d.value,NaN,()=>f.value=!1,()=>{})}return(s,V)=>{const p=_("el-button"),v=_("avue-crud"),y=_("el-dialog");return k(),A(J,null,[u(v,Q(X(i(a))),{flowData:n(({row:t})=>[u(p,{type:"primary",text:"",icon:"el-icon-crop",onClick:c=>m(t)},{default:n(()=>[N("设计")]),_:2},1032,["onClick"])]),_:1},16),u(y,{modelValue:f.value,"onUpdate:modelValue":V[2]||(V[2]=t=>f.value=t),title:`模型设计-${i(d).flowName}`,fullscreen:"","destroy-on-close":""},{footer:n(()=>[u(p,{type:"primary",onClick:w},{default:n(()=>[N("保存")]),_:1}),u(p,{onClick:V[1]||(V[1]=t=>f.value=!1)},{default:n(()=>[N("取消")]),_:1})]),default:n(()=>[u(ie,{modelValue:i(d).flowData,"onUpdate:modelValue":V[0]||(V[0]=t=>i(d).flowData=t),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Il={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Nl=R({__name:"index",setup(e){const o={rowKey:"id",getList:zt,create:Ht,update:Wt,remove:Gt},{bindVal:a,crudStateRefs:{formData:d},getDataList:r,handleUpdate:l}=H({crudOption:o,tableOption:Il,mockCache:"form-template"});r();const f=x(!1);async function m(s){d.value={...s},f.value=!0}async function w(){await l(d.value,NaN,()=>f.value=!1,()=>{})}return(s,V)=>{const p=_("el-button"),v=_("avue-crud"),y=_("el-dialog");return k(),A(J,null,[u(v,Q(X(i(a))),{formOption:n(({row:t})=>[u(p,{type:"primary",text:"",icon:"el-icon-crop",onClick:c=>m(t)},{default:n(()=>[N("设计")]),_:2},1032,["onClick"])]),_:1},16),u(y,{modelValue:f.value,"onUpdate:modelValue":V[2]||(V[2]=t=>f.value=t),title:`表单设计-${i(d).formName}`,fullscreen:"","destroy-on-close":""},{footer:n(()=>[u(p,{type:"primary",onClick:w},{default:n(()=>[N("保存")]),_:1}),u(p,{onClick:V[1]||(V[1]=t=>f.value=!1)},{default:n(()=>[N("取消")]),_:1})]),default:n(()=>[u(ye,{modelValue:i(d).formOption,"onUpdate:modelValue":V[0]||(V[0]=t=>i(d).formOption=t),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Ul={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName"},{label:"表注释",prop:"tableComment"},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"tableFields",hide:!0,type:"dynamic",children:{column:[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreated:!0,defaultFirstOption:!0,dicData:Z(je)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:me,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:me,value:1}]}}]},Pl=R({__name:"index",setup(e){const{bindVal:o,crudStateRefs:{formData:a},getDataList:d,afterGetList:r,beforeOpen:l,beforeSave:f,beforeUpdate:m}=H({crudOption:{rowKey:"id",getList:tl,create:ol,update:al,remove:nl},tableOption:Ul}),w=x([]);r(()=>{kl("table.default.fields").then(p=>{w.value=p.data})}),d(),l(p=>{p==="add"?a.value.tableFields=w.value:a.value.tableFields=JSON.parse(a.value.tableFields)}),f(p=>{p.tableFields=JSON.stringify(p.tableFields)}),m(p=>{p.tableFields=JSON.stringify(p.tableFields)});const s=x(!1);async function V(p){await se.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),s.value=!0,rl({id:p.id}).then(()=>{te.success("部署成功"),d()}).finally(()=>{s.value=!1})}return(p,v)=>{const y=_("el-button"),t=_("avue-crud");return k(),O(t,Q(X(i(o))),{menu:n(({row:c})=>[u(y,{type:"text",icon:"el-icon-upload",onClick:h=>V(c)},{default:n(()=>[N("部署")]),_:2},1032,["onClick"])]),_:1},16)}}}),Ml={class:"flow-list"},Sl=["onClick"],Ll={class:"flow-name"},Kl=R({__name:"index",setup(e){const o=x([]);Nt().then(l=>{o.value=l.data});const a=x(!1),d=x("");function r(l){d.value=l.flowKey,a.value=!0}return(l,f)=>{const m=_("v-icon");return k(),A(J,null,[G("div",Ml,[(k(!0),A(J,null,oe(o.value,w=>(k(),A("div",{key:w.flowKey,class:"flow-item",onClick:s=>r(w)},[u(m,{class:"flow-icon",icon:w.flowIcon,width:"60"},null,8,["icon"]),G("div",Ll,B(w.flowName),1)],8,Sl))),128))]),u(we,{visible:a.value,"onUpdate:visible":f[0]||(f[0]=w=>a.value=w),flowKey:d.value},null,8,["visible","flowKey"])],64)}}});const Fl=lt(Kl,[["__scopeId","data-v-45dc9a2f"]]);const zo={install(e){e.component("FlowButton",ht),e.component("FlowDefinition",Le),e.component("FlowDeploy",Ee),e.component("FlowForm",we),e.component("FlowManage",_l),e.component("FlowOps",yl),e.component("FlowParam",$l),e.component("FlowTemplate",Cl),e.component("FormTemplate",Nl),e.component("TableTemplate",Pl),e.component("Workbench",Fl)}};export{ht as FlowButton,Le as FlowDefinition,Ee as FlowDeploy,we as FlowForm,_l as FlowManage,yl as FlowOps,$l as FlowParam,Cl as FlowTemplate,Nl as FormTemplate,Pl as TableTemplate,Fl as Workbench,zo as default};
