import{d as ct}from"./index.deecc6ab.js";import{E as le,m as dt}from"./index.ce0b877c.js";import{g as E,h as L,A as ee,l as D,E as Ne,$ as pt,S as De,Y as ft,d as Q,J as O,c as B,L as ae,K as Y,o as I,b as U,w as x,N as $,a as z,t as G,B as ne,a3 as Ae,k as q,R as pe,_ as Ve,z as ve,C as ie,e as M,U as mt,O as Ge,a9 as vt,D as bt,a7 as gt,a8 as _t,H as be}from"./framework.c2983551.js";import{I as We}from"./iconify.4639d8e3.js";import{a as ge,d as wt,e as yt,w as Qe,f as ht}from"./index.d990ce32.js";import{_ as kt,a as Ct,d as Tt}from"./index.038acb2e.js";import"./index.88bb5e9d.js";import{j as Nt}from"./tree.82fe43ad.js";import{t as Dt,f as $e,a as Vt}from"./vuedraggable.umd.5daff888.js";import{p as It}from"./index.vue_vue_type_script_setup_true_lang.c9440674.js";import{a as Fe,e as W,u as xt}from"./index.013ebf7e.js";import{d as Lt}from"./differenceBy.63625a6b.js";import{B as ue}from"./index.2fcafa0b.js";function Ot(e){const{buttonHandler:t,request:a}=H(),{commitTask:c,revokeTask:l,saveDraft:m,startTask:o,terminateTask:n,transferTask:s,withdrawTask:u,rejectTask:w,greenChannel:f}=Ee(a),i=E(()=>{const{flowDetail:h,formVariables:y,approvalFormData:p,debug:r,fileIds:d}=e,{flowDeployId:b}=h.value.process??{},{taskId:v,flowInstanceId:_}=h.value.task??{};return{flowDeployId:b,taskId:v,flowInstanceId:_,variables:y.value,debug:r.value,fileIds:d==null?void 0:d.value,...p.value}}),g=()=>i.value.taskId&&i.value.flowInstanceId;return{flow_draft(){if(g())return m(i.value)},flow_pass(){return g()?c(i.value):o(i.value)},flow_revoke(){if(g())return l(i.value)},flow_withdraw(){if(g())return u(i.value)},flow_terminate(){if(g())return n(i.value)},flow_transfer(){if(g())return s(i.value)},flow_reject(){if(g())return w(i.value)},flow_green(){if(g())return f(i.value)},...t==null?void 0:t(e)}}function Pt(e){const t=L({});return ee(async()=>{var c;const{formProperty:a}=((c=D(e))==null?void 0:c.properties)||{};a!=null&&a.length&&(await Ne(),Object.keys(t.value).forEach(l=>{var n,s,u,w;const m=((n=t.value[l])==null?void 0:n.label)||"",o=a==null?void 0:a.find(f=>f.prop===l);if(t.value[l].display=o==null?void 0:o.display,t.value[l].disabled=o==null?void 0:o.disabled,t.value[l].detail=o==null?void 0:o.detail,t.value[l].readonly=o==null?void 0:o.readonly,t.value[l].rules=t.value[l].rules??[],o!=null&&o.required&&((s=t.value[l].rules)!=null&&s.some(f=>f.required)))return null;o!=null&&o.required?(u=t.value[l].rules)==null||u.push({required:!0,message:`${m}为必填项`}):t.value[l].rules=(w=t.value[l].rules)==null?void 0:w.filter(f=>!f.required)}))}),t}const Et={modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalVisible:{type:Boolean},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},fileIds:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:[Boolean,String],default:!1},debug:{type:[Boolean,String],default:!1}},St={complete:e=>e},Je=Symbol("flowFormState");function Rt(e,t){const a=ge(e,void 0,{passive:!0,deep:!0}),{flowDetail:c,modelValue:l,formLoading:m,activeTab:o}=a,{tabs:n,customForm:s,request:u}=H(),w=L({}),f=E(()=>(n==null?void 0:n.filter(r=>{var b,v,_;const d=(_=(v=(b=c.value)==null?void 0:b.properties)==null?void 0:v.formProperty)==null?void 0:_.find(C=>C.prop===r.prop);return(d==null?void 0:d.display)!==!1}).map(r=>{var b,v;let d=r.component;if(r.prop==="formTab"){const _=s==null?void 0:s[((v=(b=c==null?void 0:c.value)==null?void 0:b.process)==null?void 0:v.formPath)??""];typeof _=="function"?d=ft(_):_&&(d=_)}return{...r,component:d}}))??[]),i=L();F()&&wt(i,{onSwipeEnd(r,d){if(!["left","right"].includes(d))return;const b=f.value.findIndex(_=>_.prop===o.value),v=yt(b+(d==="right"?-1:1),0,f.value.length-1);o.value=f.value[v].prop}});const{getFlowDetail:g}=Ee(u);ee(()=>{const{flowKey:r,taskId:d,instanceId:b}=e;!r&&!d&&!b||(m.value=!0,g({flowKey:r,taskId:d,flowInstanceId:b}).then(v=>{c.value=v.data,l.value=v.data.formData||{}}).finally(()=>{m.value=!1}))});const h=E(()=>Object.entries(l.value||{}).filter(([r])=>!r.startsWith("$")).map(([r,d])=>({key:r,value:d}))),y=E(()=>e.detail===!0||e.detail==="true"),p={...a,formData:l,formVariables:h,tabRefs:w,tabList:f,detail:y,tabsRef:i,emit:t};return pt(Je,p),p}function te(){return De(Je)}const Ue=Q({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{userInfo:a,request:c}=H(),{flowDetail:l}=te(),{data:m}=ot(c).useList();function o(s,u){return s.map(w=>{const f=u.find(g=>g.buttonKey===w.buttonKey);return{...w,...It(f,["display","approval"])}})}const n=E(()=>{var r,d,b,v;const s=typeof a=="function"?a():a,{assignee:u,status:w}=((r=l.value)==null?void 0:r.task)||{},{createUser:f,flowInstanceId:i,status:g}=((d=l.value)==null?void 0:d.flowInstance)||{},h={true:!0,false:!1,startUser:f==(s==null?void 0:s.userId),assignee:u==(s==null?void 0:s.userId),todo:w==me.待办,done:w==me.已办,notstarted:!i,started:!!i,finished:g===Te.已办结,unfinished:g===Te.未办结},{button:y}=((b=l.value)==null?void 0:b.properties)||{};return((v=o(m.value??[],y??[]))==null?void 0:v.filter(_=>{var C,T;return(T=(C=_.display)==null?void 0:C.split(","))==null?void 0:T.every(P=>h[P])}))??[]});return(s,u)=>{const w=O("el-button");return I(!0),B(Y,null,ae(n.value,f=>(I(),U(w,{key:f.buttonKey,type:f.buttonType,onClick:i=>t("click",f)},{default:x(()=>[$(D(We),{icon:f.icon},null,8,["icon"]),z(" "+G(f.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),At=Q({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=ge(t),{request:c}=H(),{batchUpdate:l,create:m,remove:o,useList:n}=Va(c),s=L(!1),{activeBtn:u}=te(),w=E(()=>{var v;return(v=u.value)==null?void 0:v.buttonKey}),{data:f,refresh:i}=n(w),g=E(()=>{var _,C,T;const v=a.value;if(v&&!((_=f.value)!=null&&_.some(P=>P.content===v))){const P=(((T=(C=f.value)==null?void 0:C[0])==null?void 0:T.sort)||1)-1;return[{content:v,sort:P},...f.value||[]]}return f.value});async function h(v){var _;await m({...v,type:(_=u.value)==null?void 0:_.buttonKey}),le.success("添加成功"),i()}async function y(v){await o(v.id),le.success("删除成功"),i()}async function p(v,_){let C=_.parent.data;C=C.map((T,P)=>({id:T.id,sort:P+1})),await l(C),le.success("修改排序成功"),i(),s.value=!1}function r(){s.value=!0}const d=L();async function b(v){var _;a.value=v.content??"",await Ne(),(_=d.value)==null||_.blur()}return(v,_)=>{const C=O("el-input"),T=O("el-text"),P=O("el-col"),A=O("el-button"),k=O("el-row"),N=O("el-tree"),V=O("el-popover");return I(),U(V,{visible:s.value,placement:"bottom",title:"常用意见",width:D(F)()?"98%":"600px"},{reference:x(()=>[$(C,{ref_key:"inputRef",ref:d,modelValue:D(a),"onUpdate:modelValue":_[0]||(_[0]=S=>ne(a)?a.value=S:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:_[1]||(_[1]=S=>s.value=!0),onBlur:_[2]||(_[2]=S=>s.value=!1)},null,8,["modelValue"])]),default:x(()=>[$(N,{data:g.value,"node-key":"content",draggable:"","allow-drop":(S,j,R)=>R!=="inner",props:{label:"content"},onNodeClick:b,onNodeDrop:p,onNodeDragStart:r},{default:x(({data:S})=>[$(k,{style:{width:"100%"}},{default:x(()=>[$(P,{span:22},{default:x(()=>[$(T,{truncated:"",title:S.content},{default:x(()=>[z(G(S.content),1)]),_:2},1032,["title"])]),_:2},1024),$(P,{span:2},{default:x(()=>[S.id?(I(),U(A,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Ae(j=>y(S),["stop"])},null,8,["onClick"])):(I(),U(A,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Ae(j=>h(S),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible","width"])}}}),$t=Q({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean},mode:{}},setup(e){const t=e,{modelValue:a}=ge(t),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},m={defaultExpandAll:!0,lazy:!0,showCheckbox:!0,nodeKey:"id",load:(i,g)=>{i.level===0?g(n.value):g(i.data.children??[])},onCheck:u,props:{label:"title",class(i){return`node-${i.type}`}}},o=L(),n=E(()=>Dt(t.data??[],(i,g,h)=>{const y=Fe();return i.taskNodeKey=(h==null?void 0:h.taskNodeKey)??i.taskNodeKey,i.incoming=(h==null?void 0:h.incoming)??i.incoming,i.multiple=(h==null?void 0:h.multiple)??i.multiple,i.parentId=(h==null?void 0:h.id)??i.parentId,{...i,id:y}}));Qe(()=>[n.value,o.value],async()=>{if(!(!o.value||!n.value.length)&&t.autoCheck){const i=s(n.value);i&&f([i])}},{immediate:!0,debounce:100});function s(i){var g;if(i.length===1)return(g=i[0].children)!=null&&g.length?s(i[0].children):i[0]}async function u(i,{checkedNodes:g}){var p;let h=g.filter(r=>r.type==="user");const y=h.some(r=>r.id===i.id);if(n.value.every(r=>!r.multiple)&&y)h=[i];else if(!i.multiple&&y){const b=((p=o.value)==null?void 0:p.getNode(i)).parent.data.children.filter(v=>v.id!==i.id);h=Lt(h,b,"id")}f(h)}function w(i){const g=a.value.filter(h=>h.id!==i.id);f(g)}function f(i){var g;a.value=i,(g=o.value)==null||g.setCheckedNodes(i)}return(i,g)=>{const h=O("el-tag"),y=O("Icon"),p=O("el-tree");return I(),B(Y,null,[(I(!0),B(Y,null,ae(D(a),r=>(I(),U(h,{key:r.id,type:"info",closable:"",onClose:d=>w(r)},{default:x(()=>[z(G(r.title),1)]),_:2},1032,["onClose"]))),128)),$(p,pe({ref_key:"treeRef",ref:o,class:["approval-tree",`mode-${i.mode}`],data:n.value},m),{default:x(({data:r})=>[q("div",null,[$(y,{icon:c[r.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),q("span",null,G(r.title),1)])]),_:1},16,["class","data"])],64)}}});const je=Ve($t,[["__scopeId","data-v-69f0e83b"]]),Ut={key:0},Ke=Q({__name:"assignee-setter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,c=E({get(){return typeof a.modelValue=="string"?a.modelValue?a.modelValue.split(","):[]:a.modelValue},set(y){var p;t("update:modelValue",y.join(",")),(p=a.tableData)!=null&&p.row&&(a.tableData.row.values=$e(n.value,r=>y==null?void 0:y.includes(r.id)),a.tableData.row.idVal=a.tableData.row.values.map(r=>r[`${o.value}Id`]).join(","))}}),l=E({get(){return Array.isArray(a.modelValue)?a.modelValue.join(","):a.modelValue},set(y){t("update:modelValue",y)}}),m=L(!1),o=E(()=>{var y,p;return(p=(y=a.tableData)==null?void 0:y.row)==null?void 0:p.type}),n=L([]),s=L([]),{request:u}=H(),{getUserTree:w}=Oa(u),{getParam:f}=_e(u);ve(o,async y=>{try{if(m.value=!0,["dept","post","user"].includes(y)){const p=await w(y==="user"?"":y);n.value=p.data}else if(o.value==="dynamic"){const p=await f("flow.trends.user");s.value=p.data}}finally{m.value=!1}},{immediate:!0});function i(){c.value=$e(n.value,y=>y.type===o.value).map(y=>y.id)}const g=E(()=>({checkStrictly:o.value!=="user",clearable:!0,collapseTags:!0,collapseTagsTooltip:!0,data:n.value,filterable:!0,loading:m.value,maxCollapseTags:3,multiple:!0,nodeKey:"id",props:{label:"title"},placeholder:"请选择",showCheckbox:!0})),h=E(()=>({clearable:!0,data:s.value,filterable:!0,loading:m.value,nodeKey:"id",props:{label:"title"},placeholder:"请选择"}));return(y,p)=>{const r=O("ElTreeSelect"),d=O("el-button"),b=O("el-input");return["dept","post","user"].includes(o.value)?(I(),B("div",Ut,[$(r,pe({modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=v=>c.value=v)},g.value,{style:{width:"75%"}}),null,16,["modelValue"]),$(d,{text:"",type:"primary",icon:"el-icon-check",style:{width:"20%"},onClick:i},{default:x(()=>[z(" 全选 ")]),_:1})])):o.value==="dynamic"?(I(),U(r,pe({key:1,modelValue:l.value,"onUpdate:modelValue":p[1]||(p[1]=v=>l.value=v)},h.value,{style:{width:"100%"}}),null,16,["modelValue"])):o.value==="userTask"?(I(),U(D(kt),{key:2,modelValue:l.value,"onUpdate:modelValue":p[2]||(p[2]=v=>l.value=v),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(I(),U(b,{key:3,modelValue:l.value,"onUpdate:modelValue":p[3]||(p[3]=v=>l.value=v),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),jt={key:0,class:"flow-viewer"},Kt={key:0,class:"flow-status-legend"},Bt=Q({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const a=e,c=ie();ht(c,()=>{var r;(r=c.value)==null||r.on("node:click",d=>t("nodeClick",d))});const l=E({get(){let r=Tt();return typeof a.modelValue=="string"&&a.modelValue?r=JSON.parse(a.modelValue):typeof a.modelValue=="object"&&Object.keys(a.modelValue)&&(r=a.modelValue),r},set(r){t("update:modelValue",JSON.stringify(r))}}),m=E(()=>{const{column:r=[],group:d=[]}=JSON.parse(a.flowFormOption||"{}");return[...r,...d.map(v=>v.column??[]).flat()]}),{FlowDesign:o,tabs:n,request:s}=H(),{data:u}=ot(s).useList(),w=E(()=>(n==null?void 0:n.map(r=>({...r,display:!0})))??[]),f=E(()=>{var r;return{formPropertyList:[...m.value,...w.value],buttonList:(r=u.value)==null?void 0:r.filter(d=>d.status===1),fieldsDic:m.value.map(d=>({label:d.label,value:`\${${d.prop}}`,desc:`\${${d.prop}}`})),flowButtonDisplayDic:W(Oe),flowButtonApprovalDic:W(Pe)}}),i=L({}),g=L({});Qe(g,r=>{var d,b,v,_,C,T;r&&((v=(b=(d=r.assignee)==null?void 0:d.children)==null?void 0:b.column)!=null&&v[1]&&(r.assignee.children.column[1].component=Ke),(T=(C=(_=r.circulate)==null?void 0:_.children)==null?void 0:C.column)!=null&&T[1]&&(r.circulate.children.column[1].component=Ke))},{debounce:1});const{data:h}=_e(s).useParam("flow.task.status"),y=E(()=>{var r;return(r=a.flowHistory)==null?void 0:r.map(d=>{var v,_;const b=(_=(v=h.value)==null?void 0:v.find(C=>C.value===d.status))==null?void 0:_.style;return{id:d.taskNodeKey,style:b}})}),p=E(()=>{var r,d;return(d=(r=a.flowHistory)==null?void 0:r.filter(b=>b.taskNodeType==="userTask"))==null?void 0:d.map(b=>{var v;return{id:b.taskNodeKey,content:`<div>${b.assigneeName}</div>
        <div>${b.endTime??""}</div>
        <div>${((v=b.comment)==null?void 0:v.handleComment)??""}</div>`}})});return(r,d)=>r.view?(I(),B("div",jt,[r.showLegend!==!1?(I(),B("div",Kt,[(I(!0),B(Y,null,ae(D(h),b=>{var v;return I(),B("div",{key:b.label,class:"legend-item"},[q("div",{class:"legend-color",style:mt({backgroundColor:(v=b.style)==null?void 0:v.fill})},null,4),q("span",null,G(b.label),1)])}),128))])):M("",!0),$(D(o),{lf:c.value,"onUpdate:lf":d[0]||(d[0]=b=>c.value=b),"model-value":l.value,styles:y.value,tooltips:p.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(I(),U(D(o),{key:1,modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=b=>l.value=b),formData:i.value,"onUpdate:formData":d[2]||(d[2]=b=>i.value=b),formDefaults:g.value,"onUpdate:formDefaults":d[3]||(d[3]=b=>g.value=b),"form-options":D(Ct),"data-options":f.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const He=Ve(Bt,[["__scopeId","data-v-fc890812"]]),Mt=Q({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=ge(t),{flowDetail:c}=te(),l=L(!1);function m({data:o}){o.type==="userTask"&&(l.value=!1,a.value=o.id)}return(o,n)=>{const s=O("el-button"),u=O("el-popover");return I(),U(u,{visible:l.value,"onUpdate:visible":n[0]||(n[0]=w=>l.value=w),placement:"bottom-start",width:"800px",trigger:"click"},{reference:x(()=>[$(s,null,{default:x(()=>[z(" 点击选择节点 ")]),_:1})]),default:x(()=>{var w,f;return[$(He,{"model-value":(f=(w=D(c))==null?void 0:w.process)==null?void 0:f.flowData,view:"",style:{height:"600px"},onNodeClick:m},null,8,["model-value"])]}),_:1},8,["visible"])}}}),zt=Q({__name:"approval-form",emits:["submit"],setup(e,{emit:t}){const{request:a}=H(),{getApprovalNode:c}=Ee(a),{useParam:l}=_e(a),{formData:m,approvalFormData:o,activeBtn:n,approvalVisible:s,formVariables:u,flowDetail:w}=te(),f=L([]),i=L([]),g=L([]),h=L([]),y=L(!1),p=L(!1),r=L(),d=E(()=>{const k=f.value.length,N=g.value.length&&!f.value.length;return{menuBtn:!1,labelWidth:"auto",span:24,column:[{label:"指定节点",prop:"jumpTaskNodeKey",display:b("specifyNode"),rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",display:b("assignee"),rules:k?[{required:!0,validator:v}]:[]},{label:"传阅人",prop:"circulate",display:b("circulate"),rules:N?[{required:!0,message:"请选择传阅人"}]:[]},{label:"意见",prop:"comment",display:b("comment"),rules:[{required:!0,message:"请填写意见"}]}]}});function b(k){var N,V;return(V=(N=n.value)==null?void 0:N.approval)==null?void 0:V.includes(k)}function v(k,N,V){var R,K,se;const S=((R=f.value[0])==null?void 0:R.type)==="parallelGateway",j=(se=(K=f.value[0])==null?void 0:K.children)==null?void 0:se.every(st=>Vt([st],ut=>i.value.some(it=>it.id===ut.id)));if(i.value.length){if(S&&!j)return V("请在每个节点选择审批人")}else return V("请选择审批人");return!0}const{data:_}=l("flow.approval.autocheck"),{data:C}=l("flow.approval.autocomment");ee(async()=>{var V,S;if(!s.value||!r.value)return;Ne(()=>{r.value.resetFields(),o.value.comment=m.value.comment||C.value==="true"&&n.value.name||""});const{taskId:k}=((V=w.value)==null?void 0:V.task)||{},{flowKey:N}=((S=w.value)==null?void 0:S.process)||{};if(T(),!!b("assignee")&&!(b("specifyNode")&&!o.value.jumpTaskNodeKey))try{p.value=!0;const j=await c({flowKey:N,taskId:k,variables:u.value,buttonType:n.value.buttonKey,jumpTaskNodeKey:o.value.jumpTaskNodeKey});f.value=j.data.approvalNodeList,g.value=j.data.circulateNodeList}finally{p.value=!1}});function T(){f.value=[],i.value=[],g.value=[],h.value=[]}async function P(){await rt(r),y.value=!0;const{data:k,outgoing:N}=A(i.value),{data:V}=A(h.value);o.value.assignee=k,o.value.circulate=V,o.value.outgoing=[...N],t("submit")}function A(k){const N={},V={},S=new Set;return k.forEach(j=>{const{taskNodeKey:R,incoming:K}=j;N[R]||(N[R]=new Set),j.userId&&N[R].add(j.userId),V[R]=[...N[R]].join(","),K&&S.add(K)}),{dataSet:N,data:V,outgoing:S}}return(k,N)=>{const V=O("el-skeleton"),S=O("avue-form"),j=O("el-button");return I(),U(Ge(D(F)()?"el-drawer":"el-dialog"),{modelValue:D(s),"onUpdate:modelValue":N[6]||(N[6]=R=>ne(s)?s.value=R:null),class:"approval-form-overlay",title:D(n).name,"append-to-body":"",width:"900px",size:"50%",direction:"btt"},{footer:x(()=>[$(j,{onClick:N[5]||(N[5]=R=>s.value=!1)},{default:x(()=>[z(" 取 消 ")]),_:1}),$(j,{type:"primary",onClick:P},{default:x(()=>[z(" 确 定 ")]),_:1})]),default:x(()=>[$(S,{ref_key:"formRef",ref:r,modelValue:D(o),"onUpdate:modelValue":N[4]||(N[4]=R=>ne(o)?o.value=R:null),class:"approval-form",option:d.value},{jumpTaskNodeKey:x(()=>[$(Mt,{modelValue:D(o).jumpTaskNodeKey,"onUpdate:modelValue":N[0]||(N[0]=R=>D(o).jumpTaskNodeKey=R)},null,8,["modelValue"])]),assignee:x(()=>[p.value?(I(),U(V,{key:0})):(I(),U(je,{key:"AssigneeTree",modelValue:i.value,"onUpdate:modelValue":N[1]||(N[1]=R=>i.value=R),data:f.value,"auto-check":D(_)==="true",mode:D(F)()?"vertical":"horizontal"},null,8,["modelValue","data","auto-check","mode"]))]),circulate:x(()=>[p.value?(I(),U(V,{key:0})):(I(),U(je,{key:"CirculateTree",modelValue:h.value,"onUpdate:modelValue":N[2]||(N[2]=R=>h.value=R),data:g.value,mode:D(F)()?"vertical":"horizontal"},null,8,["modelValue","data","mode"]))]),comment:x(()=>[$(At,{modelValue:D(o).comment,"onUpdate:modelValue":N[3]||(N[3]=R=>D(o).comment=R)},null,8,["modelValue"])]),_:1},8,["modelValue","option"])]),_:1},8,["modelValue","title"])}}});const Gt={class:"flow-form__title"},Wt=Q({__name:"index",props:Et,emits:St,setup(e,{emit:t}){const c=Rt(e,t),{ApprovalForm:l,tabsProps:m}=H(),o=l??zt,{title:n,detail:s,flowDetail:u,tabRefs:w,tabList:f,activeTab:i,activeBtn:g,formLoading:h,approvalVisible:y,submitLoading:p,beforeClick:r,beforeSubmit:d,tabsRef:b}=c;async function v(T){var P,A;g.value=T;for(const k of Object.values(w.value))await((P=k==null?void 0:k.validate)==null?void 0:P.call(k));await((A=r==null?void 0:r.value)==null?void 0:A.call(r,T)),(T==null?void 0:T.approval)!=="false"?y.value=!0:C()}const _=Ot(c);async function C(){var T;try{const{buttonKey:P}=g.value;p.value=!0,await((T=d==null?void 0:d.value)==null?void 0:T.call(d,g.value));const A=_[P];A?(await(A==null?void 0:A()),le.success("操作成功"),y.value=!1,t("complete",g.value)):le.error("无法找到相应的操作")}finally{p.value=!1}}return(T,P)=>{const A=O("el-skeleton"),k=O("el-main"),N=O("el-header"),V=O("el-tab-pane"),S=O("el-tabs"),j=O("el-footer"),R=O("el-container");return D(h)?(I(),U(k,{key:0},{default:x(()=>[$(A)]),_:1})):(I(),U(R,{key:1,class:"flow-form"},{default:x(()=>[$(N,{class:"flow-form__header",height:"auto"},{default:x(()=>{var K;return[q("div",Gt,G(D(n)??((K=D(u).flowInstance)==null?void 0:K.title)),1),!D(s)&&!D(F)()?(I(),U(Ue,{key:0,onClick:v})):M("",!0)]}),_:1}),$(k,{class:"flow-form__main"},{default:x(()=>[$(S,pe({ref_key:"tabsRef",ref:b,modelValue:D(i),"onUpdate:modelValue":P[0]||(P[0]=K=>ne(i)?i.value=K:null)},D(m)),{default:x(()=>[(I(!0),B(Y,null,ae(D(f),K=>(I(),U(V,{key:K.prop,label:K.label,name:K.prop,lazy:K.lazy,disabled:K.disabled,closable:K.closable},{default:x(()=>[(I(),U(Ge(K.component),{ref_for:!0,ref:se=>D(w)[K.prop]=se},null,512))]),_:2},1032,["label","name","lazy","disabled","closable"]))),128))]),_:1},16,["modelValue"])]),_:1}),!D(s)&&D(F)()?(I(),U(j,{key:0,class:"flow-form__footer",height:"auto"},{default:x(()=>[$(Ue,{onClick:v})]),_:1})):M("",!0),$(D(o),{onSubmit:C})]),_:1}))}}});const Qt=Q({setup(){const{flowDetail:e,formData:t,detail:a}=te(),c=Pt(e.value),{proxy:l}=bt(),m=L({});ee(()=>{const{formOption:s}=e.value.process??{};m.value=Nt.bind(l)(s||'{"menuBtn":false}'),m.value.detail=!!a.value});const o=L();function n(){return rt(o)}return{form:t,option:m,defaults:c,formRef:o,validate:n}},render(){return vt(O("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,class:this.option.class,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Ft=Q({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:a,detail:c}=te(),{upload:{action:l,headers:m,preview:o,download:n,props:s}={},request:u}=H(),w=typeof m=="function"?m():m,f=E(()=>{var C,T;return((T=(C=t.value)==null?void 0:C.task)==null?void 0:T.flowInstanceId)??Fe()}),i=[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}],g=i.filter(C=>C.prop==="fileName"),h={rowKey:"id",align:"center",index:!1,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuType:"menu",column:F()?g:i},{bindVal:y,getDataList:p,handleDel:r,handleSave:d,afterGetList:b,crudStateRefs:{tableData:v}}=xt({crudOption:{...xa(u),saveSuccessMsg:"上传成功"},tableOption:h,queryForm:{isLatest:1,flowInstanceId:f.value}});b(()=>{a.value=v.value.map(C=>C.id).join(",")}),p();async function _(C,T){var j,R;const{fileName:P,fileType:A,fileSize:k,fileUrl:N,res:V}=s,S={fileName:ue({res:C},`${V}.${P}`),fileType:ue({res:C},`${V}.${A}`),fileSize:ue({res:C},`${V}.${k}`),fileUrl:ue({res:C},`${V}.${N}`),taskId:(R=(j=t.value)==null?void 0:j.task)==null?void 0:R.taskId,flowInstanceId:f.value,rootMark:(T==null?void 0:T.rootMark)||"",version:typeof(T==null?void 0:T.version)=="number"?T.version+1:1};await d(S,p,()=>{})}return(C,T)=>{const P=O("el-button"),A=O("el-upload"),k=O("el-dropdown-item"),N=O("avue-crud");return I(),U(N,gt(_t(D(y))),{"menu-left":x(()=>[D(c)?M("",!0):(I(),U(A,{key:0,action:D(l),headers:D(w),"show-file-list":!1,onSuccess:T[0]||(T[0]=V=>_(V))},{default:x(()=>[$(P,{type:"primary",icon:"el-icon-upload"},{default:x(()=>[z(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"]))]),"menu-btn":x(({row:V,index:S})=>[$(k,{icon:"el-icon-view",onClick:j=>{var R;return(R=D(o))==null?void 0:R(V,D(v))}},{default:x(()=>[z(" 预览 ")]),_:2},1032,["onClick"]),$(k,{icon:"el-icon-download",onClick:j=>{var R;return(R=D(n))==null?void 0:R(V,D(v))}},{default:x(()=>[z(" 下载 ")]),_:2},1032,["onClick"]),D(c)?M("",!0):(I(),U(k,{key:0,icon:"el-icon-upload"},{default:x(()=>[$(A,{action:D(l),headers:D(w),"show-file-list":!1,onSuccess:j=>_(j,V)},{default:x(()=>[z(" 更新版本 ")]),_:2},1032,["action","headers","onSuccess"])]),_:2},1024)),D(c)?M("",!0):(I(),U(k,{key:1,icon:"el-icon-delete",onClick:j=>D(r)(V,S)},{default:x(()=>[z(" 删除 ")]),_:2},1032,["onClick"]))]),_:1},16)}}}),Jt={class:"flow-track"},Ht={key:0},Yt={key:1},Xt=Q({__name:"flow-track",setup(e){const{flowDetail:t}=te(),a=L(F()?"timeline":"table"),c=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],l=E(()=>{var u,w,f;return((f=(w=(u=t.value)==null?void 0:u.flowHistory)==null?void 0:w.filter(i=>i.taskNodeType==="userTask"))==null?void 0:f.map(i=>({...i,duration:ct(i.duration)})))??[]}),m={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},{request:o}=H(),{data:n}=_e(o).useParam("flow.handle.type");function s(u){var w;return(w=n.value)==null?void 0:w.find(f=>f.value===u)}return(u,w)=>{var d,b,v;const f=O("el-radio-button"),i=O("el-radio-group"),g=O("avue-crud"),h=O("el-card"),y=O("el-timeline-item"),p=O("el-timeline"),r=O("el-empty");return I(),B(Y,null,[D(F)()?M("",!0):(I(),U(i,{key:0,modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=_=>a.value=_)},{default:x(()=>[(I(),B(Y,null,ae(c,_=>$(f,{key:_.label,label:_.label},{default:x(()=>[$(D(We),{icon:_.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])),q("div",Jt,[a.value==="table"?(I(),U(g,{key:0,data:l.value,option:m},null,8,["data"])):M("",!0),a.value==="graph"?(I(),U(He,{key:1,"model-value":(b=(d=D(t))==null?void 0:d.process)==null?void 0:b.flowData,"flow-history":(v=D(t))==null?void 0:v.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):M("",!0),a.value==="timeline"?(I(),B(Y,{key:2},[l.value.length?(I(),U(p,{key:0},{default:x(()=>[(I(!0),B(Y,null,ae([...l.value].reverse(),_=>(I(),U(y,{key:_.id,timestamp:_.endTime,placement:"top"},{default:x(()=>[$(h,null,{default:x(()=>{var C,T,P;return[q("div",null,G(_.assigneeName)+" 开始处理 ["+G(_.taskNodeName)+"] 环节 ",1),_.duration?(I(),B("div",Ht," 办理时长："+G(_.duration),1)):M("",!0),_.type&&((C=_.comment)!=null&&C.handleComment)?(I(),B("div",Yt,G((T=s(_.type))==null?void 0:T.label)+"意见："+G((P=_.comment)==null?void 0:P.handleComment),1)):M("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(I(),U(r,{key:1}))],64)):M("",!0)])],64)}}});const Zt=Ve(Xt,[["__scopeId","data-v-a1713c28"]]),Be=Symbol("flowPagesConfig"),qt={FlowDesign:{},FormDesign:{},FlowForm:Wt,tabs:[{label:"审批表单",prop:"formTab",component:Qt},{label:"附件资料",prop:"fileTab",component:Ft},{label:"流程跟踪",prop:"trackTab",component:Zt}],request:()=>{},useFlowFormOptions:{type:"drawer",window:["","flow-form","left=0,top=0,width=1600,height=900"],overlay:{width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0}},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}},ea={},ta=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),aa=()=>ea,X=e=>e,Ce=e=>Array.isArray(e),Ie=e=>e!==null&&typeof e=="object",xe=e=>e instanceof Function,re=e=>e==null,Le=typeof window>"u",Ye=()=>{var e;return Le||re((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},oa=()=>{var e,t;return(e=!Le&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},we=()=>new Promise(()=>{}),J=e=>ne(e)?e.value:e,la=e=>Ie(e)?Object.assign(Ce(e)?[]:{},e):e,ce=new Map,na=e=>re(e)?void 0:ce.get(e),ra=(e,t,a)=>{const c=ce.get(e);c!=null&&c.timer&&clearTimeout(c.timer);const l=setTimeout(()=>ce.delete(e),t);ce.set(e,{...a,timer:l})};function Xe(e,t,a){let c,l,m,o,n,s,u=0,w=!1,f=!1,i=!0;const g=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Ie(a)&&(w=!!a.leading,f="maxWait"in a,m=f?Math.max(+a.maxWait||0,t):m,i="trailing"in a?!!a.trailing:i);function h(k){const N=c,V=l;return c=l=void 0,u=k,o=e.apply(V,N),o}function y(k,N){return g?(window.cancelAnimationFrame(n),window.requestAnimationFrame(k)):setTimeout(k,N)}function p(k){if(g)return window.cancelAnimationFrame(k);clearTimeout(k)}function r(k){return u=k,n=y(v,t),w?h(k):o}function d(k){const N=k-s,V=k-u,S=t-N;return f?Math.min(S,m-V):S}function b(k){const N=k-s,V=k-u;return s===void 0||N>=t||N<0||f&&V>=m}function v(){const k=Date.now();if(b(k))return _(k);n=y(v,d(k))}function _(k){return n=void 0,i&&c?h(k):(c=l=void 0,o)}function C(){n!==void 0&&p(n),u=0,c=s=l=n=void 0}function T(){return n===void 0?o:_(Date.now())}function P(){return n!==void 0}function A(){const k=Date.now(),N=b(k);for(var V=arguments.length,S=new Array(V),j=0;j<V;j++)S[j]=arguments[j];if(c=S,l=this,s=k,N){if(n===void 0)return r(s);if(f)return n=y(v,t),h(s)}return n===void 0&&(n=y(v,t)),o}return A.cancel=C,A.flush=T,A.pending=P,A}function sa(e,t,a){let c=!0,l=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Ie(a)&&(c="leading"in a?!!a.leading:c,l="trailing"in a?!!a.trailing:l),Xe(e,t,{leading:c,trailing:l,maxWait:t})}var ua=X((e,t)=>{let{debounceInterval:a,debounceOptions:c,manual:l}=t;const m=L(!1),o=L(),n=E(()=>c),s=E(()=>J(a)),u=L(e.context.runAsync);return l||(m.value=!0),ee(w=>{re(s.value)||(o.value=Xe(f=>f(),s.value,n.value),e.context.runAsync=function(){for(var f=arguments.length,i=new Array(f),g=0;g<f;g++)i[g]=arguments[g];return new Promise((h,y)=>{m.value?(m.value=!1,u.value(...i).then(h).catch(y)):o.value(()=>{u.value(...i).then(h).catch(y)})})},w(()=>{var f;(f=o.value)===null||f===void 0||f.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var w;(w=o.value)===null||w===void 0||w.cancel()}}}),ia=X((e,t)=>{let{errorRetryCount:a=0,errorRetryInterval:c=0}=t;const l=L(),m=L(0),o=E(()=>J(a)),n=E(()=>J(c));let s=!1;const u=()=>{m.value=0},w=E(()=>{if(n.value)return n.value;const g=1e3,h=1,y=9,p=Math.floor(Math.random()*2**Math.min(m.value,y)+h);return g*p}),f=()=>{let g;const h=o.value===-1,y=m.value<o.value;return(h||y)&&(h||(m.value+=1),g=setTimeout(()=>{s=!0,e.context.refresh()},w.value)),()=>g&&clearTimeout(g)},i=()=>{l.value&&l.value()};return{onBefore(){s||u(),s=!1,i()},onSuccess(){u()},onError(){l.value=f()},onCancel(){u(),i()}}}),ca=X((e,t)=>{let{ready:a=L(!0),manual:c,defaultParams:l=[]}=t;return ve(a,m=>{!c&&m&&e.context.run(...l)},{flush:"sync"}),{onBefore(){if(!(xe(a)?a():a.value))return e.loading.value=!1,{isBreak:!0}}}}),da=X((e,t)=>{let{refreshDeps:a,refreshDepsAction:c,manual:l}=t;if(a===void 0||Ce(a)&&a.length===0)return{};const m=Ce(a)?a:[a];return ve(m,()=>{c?c():!l&&e.context.refresh()}),{}}),pa=X((e,t)=>{let{throttleInterval:a,throttleOptions:c}=t;const l=L(),m=E(()=>J(a)),o=E(()=>c),n=L(e.context.runAsync);return ee(s=>{if(re(a))return{};l.value=sa(u=>u(),m.value,o.value),e.context.runAsync=function(){for(var u=arguments.length,w=new Array(u),f=0;f<u;f++)w[f]=arguments[f];return new Promise((i,g)=>{l.value(()=>{n.value(...w).then(i).catch(g)})})},s(()=>{var u;(u=l.value)===null||u===void 0||u.cancel(),e.context.runAsync=n.value})}),{onCancel(){var s;(s=l.value)===null||s===void 0||s.cancel()}}});const fa=(e,t)=>a=>{Object.keys(a).forEach(c=>{e[c].value=a[c]}),t.forEach(c=>c(e))},ma=(e,t)=>()=>{let a=t;for(let c=e.length;c-- >0;)a=e[c](a);return a()},va=(e,t,a)=>{var c,l;const{initialData:m,onSuccess:o,onError:n,onBefore:s,onAfter:u}=t,w=L((c=a==null?void 0:a.loading)!==null&&c!==void 0?c:!1),f=ie((l=a==null?void 0:a.data)!==null&&l!==void 0?l:m),i=ie(a==null?void 0:a.error),g=L(a==null?void 0:a.params),h=L([]),y=ie("pending"),p={},r=fa({status:y,loading:w,data:f,error:i,params:g},[]),d=function(v){for(var _=arguments.length,C=new Array(_>1?_-1:0),T=1;T<_;T++)C[T-1]=arguments[T];if(v==="onQuery"){const P=h.value.map(A=>A.onQuery).filter(Boolean);return{servicePromise:ma(P,C[0])()}}else{const P=h.value.map(A=>{var k;return(k=A[v])===null||k===void 0?void 0:k.call(A,...C)});return Object.assign({},...P)}},b=L(0);return p.runAsync=async function(){for(var v=arguments.length,_=new Array(v),C=0;C<v;C++)_[C]=arguments[C];r({loading:!0,params:_,status:"pending"}),b.value+=1;const T=b.value,{isBreak:P,breakResult:A=we()}=d("onBefore",_);if(P)return r({status:"settled"}),A;s==null||s(_);try{const k=()=>new Promise(S=>S(e(...g.value)));let{servicePromise:N}=d("onQuery",k);N||(N=k());const V=await N;return T!==b.value?we():(r({data:V,loading:!1,error:void 0,status:"settled"}),d("onSuccess",V,_),o==null||o(V,_),T===b.value&&d("onAfter",_,V,void 0),u==null||u(_),V)}catch(k){if(T!==b.value)return we();throw r({loading:!1,error:k,status:"settled"}),d("onError",k,_),n==null||n(k,_),T===b.value&&d("onAfter",_,void 0,k),u==null||u(_),k}},p.run=function(){p.runAsync(...arguments).catch(v=>{n||console.error(v)})},p.cancel=()=>{b.value+=1,r({loading:!1}),d("onCancel")},p.refresh=()=>{p.run(...g.value||[])},p.refreshAsync=()=>p.runAsync(...g.value||[]),p.mutate=v=>{const _=xe(v)?v(f.value):v,C=la(_);r({data:C}),d("onMutate",C)},{status:y,loading:w,data:f,error:i,params:g,plugins:h,context:p}};function ba(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const c=De(ta,{}),l={...aa(),...c,...t},{manual:m=!1,defaultParams:o=[]}=l,n=va(e,l);if(n.plugins.value=a.map(s=>s(n,l)),!m){const s=n.params.value||o;n.context.run(...s)}return be(()=>{n.context.cancel()}),{loading:n.loading,data:n.data,error:n.error,params:n.params,cancel:n.context.cancel,refresh:n.context.refresh,refreshAsync:n.context.refreshAsync,mutate:n.context.mutate,run:n.context.run,runAsync:n.context.runAsync}}const de=new Map,ga=(e,t)=>{de.set(e,t),t.then(a=>(de.delete(e),a)).catch(()=>{de.delete(e)})},_a=e=>de.get(e),Z=new Map,wa=(e,t)=>{Z.has(e)&&Z.get(e).forEach(a=>a(t))},ya=(e,t)=>(Z.has(e)?Z.get(e).push(t):Z.set(e,[t]),()=>{const a=Z.get(e).indexOf(t);Z.get(e).splice(a,1)});var ha=X((e,t)=>{let{cacheKey:a,cacheTime:c=6e5,staleTime:l=0,getCache:m,setCache:o}=t;if(!a)return{};const n=xe(a)?a:()=>a,s=L(()=>{});let u;const w=r=>m?m(r):na(r),f=(r,d,b)=>{o?o(r,b):ra(r,d,b),wa(r,b.data)},i=r=>l===-1||r+l>new Date().getTime(),g=(r,d)=>Object.prototype.hasOwnProperty.call(r,d),h=r=>{const d=n(r);return ya(d,b=>{e.data.value=b})},y=n(),p=w(y);return p&&g(p,"data")&&(e.data.value=p.data,e.params.value=p.params),y&&(s.value=h()),be(()=>{s.value()}),{onBefore(r){const d=n(r),b=w(d);if(!b||!g(b,"data"))return{};if(i(b.time))return e.data.value=b.data,e.loading.value=!1,{isBreak:!0,breakResult:b.data};e.data.value=b.data},onQuery(r){const d=e.params.value,b=n(d);let v=_a(b);return v&&v!==u?()=>v:(v=r(),u=v,ga(b,v),()=>v)},onSuccess(r,d){const b=n(d);b&&(s.value(),f(b,c,{data:r,params:d,time:new Date().getTime()}),s.value=h(d))},onMutate(r){const d=n(e.params.value);d&&(s.value(),f(d,c,{data:r,params:e.params.value,time:new Date().getTime()}),s.value=h(e.params.value))}}});function ka(e){let t,a;class c extends Promise{constructor(m){super(m),this.cancel=()=>{a(),clearTimeout(t)}}}return new c(l=>{a=l,t=setTimeout(a,e)})}function ye(){return new Date().getTime()}var Ca=X((e,t)=>{let{loadingDelay:a=0,loadingKeep:c=0}=t;const l=L(()=>{}),m=E(()=>J(a)),o=E(()=>J(c));let n=0,s={};const u=()=>{let w;return m.value&&(w=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},m.value)),()=>w&&clearTimeout(w)};return{onBefore(){e.loading.value=!m.value,l.value(),l.value=u(),n=ye()},onQuery(w){if(!o.value)return()=>w();s=ka(o.value+m.value);const f=async()=>{try{const g=await w();return ye()-n<=m.value&&s.cancel(),Promise.resolve(g)}catch(g){return ye()-n<=m.value&&s.cancel(),Promise.reject(g)}},i=Promise.allSettled([f(),s]).then(g=>{const h=g[0];return h.status==="fulfilled"?h.value:Promise.reject(h.reason)});return()=>i},onCancel(){l.value()},onAfter(){l.value()}}}),he;const Ze=new Set,qe=new Set,et=new Set,fe=(e,t)=>{let a;switch(e){case"FOCUS_LISTENER":a=Ze;break;case"RECONNECT_LISTENER":a=et;break;case"VISIBLE_LISTENER":a=qe;break}if(!a.has(t))return a.add(t),()=>{a.delete(t)}},ke=e=>{e.forEach(t=>{t()})};!Le&&(he=window)!==null&&he!==void 0&&he.addEventListener&&(window.addEventListener("visibilitychange",()=>{Ye()&&ke(qe)},!1),window.addEventListener("focus",()=>ke(Ze),!1),window.addEventListener("online",()=>ke(et),!1));var Ta=X((e,t)=>{let{pollingInterval:a,pollingWhenHidden:c=!1,pollingWhenOffline:l=!1,errorRetryCount:m=0}=t;const o=L(),n=L(!1),s=E(()=>J(a)),u=E(()=>J(m)),w=[],f=y=>{y&&w.push(y)},i=()=>(c||Ye())&&(l||oa()),g=y=>{if(e.error.value&&u.value!==0)return;let p;if(!re(s.value)&&s.value>=0)if(i())p=setTimeout(y,s.value);else{n.value=!0;return}return()=>p&&clearTimeout(p)},h=()=>{n.value&&i()&&(e.context.refresh(),n.value=!1)};return ve(s,()=>{o.value&&(o.value(),o.value=g(()=>e.context.refresh()))}),c||f(fe("VISIBLE_LISTENER",h)),l||f(fe("RECONNECT_LISTENER",h)),be(()=>{w.forEach(y=>y())}),{onBefore(){var y;(y=o.value)===null||y===void 0||y.call(o)},onCancel(){var y;(y=o.value)===null||y===void 0||y.call(o)},onAfter(){o.value=g(()=>e.context.refresh())}}});const Na=(e,t)=>{let a=!1;return function(){a||(a=!0,e(...arguments),setTimeout(()=>{a=!1},t))}};var Da=X((e,t)=>{let{refreshOnWindowFocus:a=!1,refocusTimespan:c=5e3}=t;const l=E(()=>J(a)),m=E(()=>J(c)),o=[],n=u=>{u&&o.push(u)},s=()=>{o.forEach(u=>u())};return ee(()=>{if(s(),l.value){const u=Na(e.context.refresh,m.value);n(fe("VISIBLE_LISTENER",u)),n(fe("FOCUS_LISTENER",u))}}),be(()=>{s()}),{}});function oe(e,t){return ba(e,t,[Ca,ia,ua,Ta,pa,Da,da,ca,ha])}function Va(e){const t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},a=s=>e.get(t.list,{params:{type:s,ascs:"sort"}});return{url:t,getList:a,useList:s=>oe(()=>a(s.value).then(u=>u.data.records),{refreshDeps:[s]}),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),batchUpdate:s=>e.post(t.batchUpdate,s)}}var tt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(tt||{}),Ia=(e=>(e.保存草稿="flow_draft",e.发送="flow_pass",e.退回="flow_reject",e.终止="flow_terminate",e.撤销="flow_revoke",e.撤回到发起="flow_withdraw",e.打印="flow_print",e.转办="flow_transfer",e.加签="flow_add_instance",e.减签="flow_del_instance",e.指定回退="flow_rollback",e.绿色通道="flow_green",e))(Ia||{}),Oe=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Oe||{}),Pe=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(Pe||{}),at=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(at||{});function ot(e){const t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},a=n=>e.get(t.list,{params:n});return{url:t,getList:a,useList:()=>oe(()=>a({size:-1,ascs:"sort"}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}})}}function xa(e){const t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:m=>e.get(t.list,{params:m}),create:m=>e.post(t.save,m),remove:m=>e.post(t.remove,{},{params:{ids:m}})}}function _e(e){const t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},a=u=>e.get(t.list,{params:u}),c=()=>e.get(t.all),l=u=>e.get(t.key,{params:{paramKey:u}});return{url:t,getList:a,getAllParam:c,getParam:l,useParam:u=>oe(()=>l(u).then(w=>w.data)),create:u=>e.post(t.save,u),update:u=>e.post(t.update,u),remove:u=>e.post(t.remove,{},{params:{ids:u}})}}var me=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(me||{}),Te=(e=>(e[e.已办结=1]="已办结",e[e.未办结=2]="未办结",e[e.已终止=3]="已终止",e))(Te||{}),La=(e=>(e[e.系统执行=1]="系统执行",e[e.用户办理=2]="用户办理",e[e.任务撤销=3]="任务撤销",e[e.任务退回=4]="任务退回",e[e.流程终止=5]="流程终止",e[e.任务转办=6]="任务转办",e[e.绿色通道=7]="绿色通道",e))(La||{});function Ee(e){const t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask"},a=p=>e.get(t.detail,{params:p}),c=p=>e.post(t.approvalNode,p),l=p=>e.post(t.start,p),m=p=>e.post(t.commit,p),o=p=>e.post(t.draft,p),n=p=>e.post(t.revoke,p),s=p=>e.post(t.terminate,p),u=p=>e.post(t.withdraw,p),w=p=>e.post(t.transfer,p),f=p=>e.post(t.reject,p),i=p=>e.post(t.green,p),g=()=>e.get(t.publishList);return{url:t,getFlowDetail:a,getApprovalNode:c,startTask:l,commitTask:m,saveDraft:o,revokeTask:n,terminateTask:s,withdrawTask:u,transferTask:w,rejectTask:f,greenChannel:i,getPublishList:g,usePublishList:()=>oe(()=>g().then(p=>p.data)),getTaskList:p=>e.get(t.taskList,{params:p})}}function Oa(e){const t={tree:"/sapier-flow/flow-user/tree"},a=l=>e.get(t.tree,{params:{filter:l}});return{url:t,getUserTree:a,useUserTree:()=>oe(()=>a().then(l=>l.data))}}var Se=(e=>(e.ASSIGN_ID="ASSIGN_ID",e.ASSIGN_UUID="ASSIGN_UUID",e.AUTO="AUTO",e.INPUT="INPUT",e.NONE="NONE",e))(Se||{}),Re=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Re||{});function Wa(e){const t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy",getFields:"/sapier-flow/dev-table/getTableFields"},a=u=>e.get(t.list,{params:u});return{url:t,getList:a,useList:()=>oe(()=>a({size:-1}).then(u=>u.data.records)),create:u=>e.post(t.save,u),update:u=>e.post(t.update,u),remove:u=>e.post(t.remove,{},{params:{ids:u}}),deploy:u=>e.post(t.deploy,u),getFields:u=>e.get(t.getFields,{params:u})}}var lt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(lt||{});const Me=W(lt),Qa=W(Re),Fa=W(Se);function H(e,t){return e&&t?(e.provide(Be,dt(qt,t)),t):De(Be)}const Ja={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:W(tt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:W(Oe),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:W(Pe),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:W(at)},{label:"按钮预览",prop:"buttonPreview",width:150}]},nt={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",editDisabled:!0,rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",dicQuery:{size:-1},props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"排序",prop:"sort",type:"number",width:110},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},Ha={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...nt.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Ya={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...nt.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Xa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:me.待办,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]};const ze=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:W(Re)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Me,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Me,value:1}],Za={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:W(Se)},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:ze}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:ze}}]};function rt(e){return new Promise((t,a)=>{D(e).validate((l,m,o)=>{l?(m(),t(o)):a(o)})})}function F(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}export{Re as A,Be as B,qt as C,Qa as D,Fa as E,He as F,zt as G,La as H,Ue as I,Zt as J,Qt as K,Ft as L,Ot as M,Et as N,St as O,Je as P,Rt as Q,F as R,me as T,lt as W,Wt as _,Pt as a,rt as b,oe as c,H as d,ot as e,Ha as f,Ya as g,Wa as h,nt as i,Xa as j,_e as k,Ee as l,Za as m,Va as n,tt as o,Ia as p,Oe as q,Pe as r,at as s,Ja as t,te as u,xa as v,Me as w,Te as x,Oa as y,Se as z};
