import{d as dt}from"./index.21eae476.js";import{I as ze}from"./iconify.e6294576.js";import{a as be,g as pt,h as ft,w as We,i as mt}from"./index.95595333.js";import{_ as vt,a as bt,d as gt}from"./index.90304c61.js";import"./index.a9414782.js";import{H as _t}from"./tree.6cf6949a.js";import"./index.0a173eea.js";import{t as yt,b as $e,f as wt}from"./vuedraggable.umd.47e8adaf.js";import{a as Ge,e as G,u as ht}from"./index.5ca0e709.js";import{ah as Qe,g as R,h as x,A as te,l as V,E as De,$ as kt,S as Fe,Y as Ct,d as Q,J as O,c as B,L as oe,K as Y,o as I,b as U,w as L,N as $,a as z,t as W,B as ne,a3 as Ue,k as ee,R as fe,_ as Ie,z as ge,C as ie,e as M,U as Nt,O as He,a9 as Tt,D as Vt,a7 as Dt,a8 as It,H as _e}from"./framework.25a4be6c.js";import{p as Lt}from"./index.vue_vue_type_script_setup_true_lang.ab20c269.js";import{E as ce,m as xt}from"./index.0a95bdf1.js";import{d as Ot}from"./differenceBy.82665355.js";import{B as ue}from"./index.9559e405.js";function X(e){const{tableOption:t}=F();return Qe({...t,...e})}function Pt(e){const{buttonHandler:t,request:a}=F(),{commitTask:c,revokeTask:l,saveDraft:m,startTask:o,terminateTask:n,transferTask:s,withdrawTask:u,rejectTask:y,greenChannel:f}=Ae(a),i=R(()=>{const{flowDetail:h,formVariables:w,approvalFormData:p,debug:r,fileIds:d}=e,{flowDeployId:b}=h.value.process??{},{taskId:v,flowInstanceId:_}=h.value.task??{};return{flowDeployId:b,taskId:v,flowInstanceId:_,variables:w.value,debug:r.value,fileIds:d==null?void 0:d.value,...p.value}}),g=()=>i.value.taskId&&i.value.flowInstanceId;return{flow_draft(){if(g())return m(i.value)},flow_pass(){return g()?c(i.value):o(i.value)},flow_revoke(){if(g())return l(i.value)},flow_withdraw(){if(g())return u(i.value)},flow_terminate(){if(g())return n(i.value)},flow_transfer(){if(g())return s(i.value)},flow_reject(){if(g())return y(i.value)},flow_green(){if(g())return f(i.value)},...t==null?void 0:t(e)}}function Rt(e){const t=x({});return te(async()=>{var c;const{formProperty:a}=((c=V(e))==null?void 0:c.properties)||{};a!=null&&a.length&&(await De(),Object.keys(t.value).forEach(l=>{var n,s,u,y;const m=((n=t.value[l])==null?void 0:n.label)||"",o=a==null?void 0:a.find(f=>f.prop===l);if(t.value[l].display=o==null?void 0:o.display,t.value[l].disabled=o==null?void 0:o.disabled,t.value[l].detail=o==null?void 0:o.detail,t.value[l].readonly=o==null?void 0:o.readonly,t.value[l].rules=t.value[l].rules??[],o!=null&&o.required&&((s=t.value[l].rules)!=null&&s.some(f=>f.required)))return null;o!=null&&o.required?(u=t.value[l].rules)==null||u.push({required:!0,message:`${m}为必填项`}):t.value[l].rules=(y=t.value[l].rules)==null?void 0:y.filter(f=>!f.required)}))}),t}const At={modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalVisible:{type:Boolean},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},fileIds:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:[Boolean,String],default:!1},debug:{type:[Boolean,String],default:!1}},Et={complete:e=>e},Je=Symbol("flowFormState");function St(e,t){const a=be(e,void 0,{passive:!0,deep:!0}),{flowDetail:c,modelValue:l,formLoading:m,activeTab:o}=a,{tabs:n,customForm:s,request:u}=F(),y=x({}),f=R(()=>(n==null?void 0:n.filter(r=>{var b,v,_;const d=(_=(v=(b=c.value)==null?void 0:b.properties)==null?void 0:v.formProperty)==null?void 0:_.find(C=>C.prop===r.prop);return(d==null?void 0:d.display)!==!1}).map(r=>{var b,v;let d=r.component;if(r.prop==="formTab"){const _=s==null?void 0:s[((v=(b=c==null?void 0:c.value)==null?void 0:b.process)==null?void 0:v.formPath)??""];typeof _=="function"?d=Ct(_):_&&(d=_)}return{...r,component:d}}))??[]),i=x();H()&&pt(i,{onSwipeEnd(r,d){if(!["left","right"].includes(d))return;const b=f.value.findIndex(_=>_.prop===o.value),v=ft(b+(d==="right"?-1:1),0,f.value.length-1);o.value=f.value[v].prop}});const{getFlowDetail:g}=Ae(u);te(()=>{const{flowKey:r,taskId:d,instanceId:b}=e;!r&&!d&&!b||(m.value=!0,g({flowKey:r,taskId:d,flowInstanceId:b}).then(v=>{c.value=v.data,l.value=v.data.formData||{}}).finally(()=>{m.value=!1}))});const h=R(()=>Object.entries(l.value||{}).filter(([r])=>!r.startsWith("$")).map(([r,d])=>({key:r,value:d}))),w=R(()=>e.detail===!0||e.detail==="true"),p={...a,formData:l,formVariables:h,tabRefs:y,tabList:f,detail:w,tabsRef:i,emit:t};return kt(Je,p),p}function ae(){return Fe(Je)}const Ke=Q({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{userInfo:a,request:c}=F(),{flowDetail:l}=ae(),{data:m}=lt(c).useList();function o(s,u){return s.map(y=>{const f=u.find(g=>g.buttonKey===y.buttonKey);return{...y,...Lt(f,["display","approval"])}})}const n=R(()=>{var r,d,b,v;const s=typeof a=="function"?a():a,{assignee:u,status:y}=((r=l.value)==null?void 0:r.task)||{},{createUser:f,flowInstanceId:i,status:g}=((d=l.value)==null?void 0:d.flowInstance)||{},h={true:!0,false:!1,startUser:f==(s==null?void 0:s.userId),assignee:u==(s==null?void 0:s.userId),todo:y==ve.待办,done:y==ve.已办,notstarted:!i,started:!!i,finished:g===Te.已办结,unfinished:g===Te.未办结},{button:w}=((b=l.value)==null?void 0:b.properties)||{};return((v=o(m.value??[],w??[]))==null?void 0:v.filter(_=>{var C,N;return(N=(C=_.display)==null?void 0:C.split(","))==null?void 0:N.every(P=>h[P])}))??[]});return(s,u)=>{const y=O("el-button");return I(!0),B(Y,null,oe(n.value,f=>(I(),U(y,{key:f.buttonKey,type:f.buttonType,onClick:i=>t("click",f)},{default:L(()=>[$(V(ze),{icon:f.icon},null,8,["icon"]),z(" "+W(f.name),1)]),_:2},1032,["type","onClick"]))),128)}}}),$t=Q({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=be(t),{request:c}=F(),{batchUpdate:l,create:m,remove:o,useList:n}=La(c),s=x(!1),{activeBtn:u}=ae(),y=R(()=>{var v;return(v=u.value)==null?void 0:v.buttonKey}),{data:f,refresh:i}=n(y),g=R(()=>{var _,C,N;const v=a.value;if(v&&!((_=f.value)!=null&&_.some(P=>P.content===v))){const P=(((N=(C=f.value)==null?void 0:C[0])==null?void 0:N.sort)||1)-1;return[{content:v,sort:P},...f.value||[]]}return f.value});async function h(v){var _;await m({...v,type:(_=u.value)==null?void 0:_.buttonKey}),ce.success("添加成功"),i()}async function w(v){await o(v.id),ce.success("删除成功"),i()}async function p(v,_){let C=_.parent.data;C=C.map((N,P)=>({id:N.id,sort:P+1})),await l(C),ce.success("修改排序成功"),i(),s.value=!1}function r(){s.value=!0}const d=x();async function b(v){var _;a.value=v.content??"",await De(),(_=d.value)==null||_.blur()}return(v,_)=>{const C=O("el-input"),N=O("el-text"),P=O("el-col"),S=O("el-button"),k=O("el-row"),T=O("el-tree"),D=O("el-popover");return I(),U(D,{visible:s.value,placement:"bottom",title:"常用意见",width:V(H)()?"98%":"600px"},{reference:L(()=>[$(C,{ref_key:"inputRef",ref:d,modelValue:V(a),"onUpdate:modelValue":_[0]||(_[0]=A=>ne(a)?a.value=A:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:_[1]||(_[1]=A=>s.value=!0),onBlur:_[2]||(_[2]=A=>s.value=!1)},null,8,["modelValue"])]),default:L(()=>[$(T,{data:g.value,"node-key":"content",draggable:"","allow-drop":(A,K,E)=>E!=="inner",props:{label:"content"},onNodeClick:b,onNodeDrop:p,onNodeDragStart:r},{default:L(({data:A})=>[$(k,{style:{width:"100%"}},{default:L(()=>[$(P,{span:22},{default:L(()=>[$(N,{truncated:"",title:A.content},{default:L(()=>[z(W(A.content),1)]),_:2},1032,["title"])]),_:2},1024),$(P,{span:2},{default:L(()=>[A.id?(I(),U(S,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Ue(K=>w(A),["stop"])},null,8,["onClick"])):(I(),U(S,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Ue(K=>h(A),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible","width"])}}}),Ut=Q({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean},mode:{}},setup(e){const t=e,{modelValue:a}=be(t),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"},m={defaultExpandAll:!0,lazy:!0,showCheckbox:!0,nodeKey:"id",load:(i,g)=>{i.level===0?g(n.value):g(i.data.children??[])},onCheck:u,props:{label:"title",class(i){return`node-${i.type}`}}},o=x(),n=R(()=>yt(t.data??[],(i,g,h)=>{const w=Ge();return i.taskNodeKey=(h==null?void 0:h.taskNodeKey)??i.taskNodeKey,i.incoming=(h==null?void 0:h.incoming)??i.incoming,i.multiple=(h==null?void 0:h.multiple)??i.multiple,i.parentId=(h==null?void 0:h.id)??i.parentId,{...i,id:w}}));We(()=>[n.value,o.value],async()=>{if(!(!o.value||!n.value.length)&&t.autoCheck){const i=s(n.value);i&&f([i])}},{immediate:!0,debounce:100});function s(i){var g;if(i.length===1)return(g=i[0].children)!=null&&g.length?s(i[0].children):i[0]}async function u(i,{checkedNodes:g}){var p;let h=g.filter(r=>r.type==="user");const w=h.some(r=>r.id===i.id);if(n.value.every(r=>!r.multiple)&&w)h=[i];else if(!i.multiple&&w){const b=((p=o.value)==null?void 0:p.getNode(i)).parent.data.children.filter(v=>v.id!==i.id);h=Ot(h,b,"id")}f(h)}function y(i){const g=a.value.filter(h=>h.id!==i.id);f(g)}function f(i){var g;a.value=i,(g=o.value)==null||g.setCheckedNodes(i)}return(i,g)=>{const h=O("el-tag"),w=O("Icon"),p=O("el-tree");return I(),B(Y,null,[(I(!0),B(Y,null,oe(V(a),r=>(I(),U(h,{key:r.id,type:"info",closable:"",onClose:d=>y(r)},{default:L(()=>[z(W(r.title),1)]),_:2},1032,["onClose"]))),128)),$(p,fe({ref_key:"treeRef",ref:o,class:["approval-tree",`mode-${i.mode}`],data:n.value},m),{default:L(({data:r})=>[ee("div",null,[$(w,{icon:c[r.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),ee("span",null,W(r.title),1)])]),_:1},16,["class","data"])],64)}}});const je=Ie(Ut,[["__scopeId","data-v-9646bed9"]]),Kt={key:0},Be=Q({__name:"assignee-setter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,c=R({get(){return typeof a.modelValue=="string"?a.modelValue?a.modelValue.split(","):[]:a.modelValue},set(w){var p;t("update:modelValue",w.join(",")),(p=a.tableData)!=null&&p.row&&(a.tableData.row.values=$e(n.value,r=>w==null?void 0:w.includes(r.id)),a.tableData.row.idVal=a.tableData.row.values.map(r=>r[`${o.value}Id`]).join(","))}}),l=R({get(){return Array.isArray(a.modelValue)?a.modelValue.join(","):a.modelValue},set(w){t("update:modelValue",w)}}),m=x(!1),o=R(()=>{var w,p;return(p=(w=a.tableData)==null?void 0:w.row)==null?void 0:p.type}),n=x([]),s=x([]),{request:u}=F(),{getUserTree:y}=Ra(u),{getParam:f}=ye(u);ge(o,async w=>{try{if(m.value=!0,["dept","post","user"].includes(w)){const p=await y(w==="user"?"":w);n.value=p.data}else if(o.value==="dynamic"){const p=await f("flow.trends.user");s.value=p.data}}finally{m.value=!1}},{immediate:!0});function i(){c.value=$e(n.value,w=>w.type===o.value).map(w=>w.id)}const g=R(()=>({checkStrictly:o.value!=="user",clearable:!0,collapseTags:!0,collapseTagsTooltip:!0,data:n.value,filterable:!0,loading:m.value,maxCollapseTags:3,multiple:!0,nodeKey:"id",props:{label:"title"},placeholder:"请选择",showCheckbox:!0})),h=R(()=>({clearable:!0,data:s.value,filterable:!0,loading:m.value,nodeKey:"id",props:{label:"title"},placeholder:"请选择"}));return(w,p)=>{const r=O("el-tree-select"),d=O("el-button"),b=O("el-input");return["dept","post","user"].includes(o.value)?(I(),B("div",Kt,[$(r,fe({modelValue:c.value,"onUpdate:modelValue":p[0]||(p[0]=v=>c.value=v)},g.value,{style:{width:"75%"}}),null,16,["modelValue"]),$(d,{text:"",type:"primary",icon:"el-icon-check",style:{width:"20%"},onClick:i},{default:L(()=>[z(" 全选 ")]),_:1})])):o.value==="dynamic"?(I(),U(r,fe({key:1,modelValue:l.value,"onUpdate:modelValue":p[1]||(p[1]=v=>l.value=v)},h.value,{style:{width:"100%"}}),null,16,["modelValue"])):o.value==="userTask"?(I(),U(V(vt),{key:2,modelValue:l.value,"onUpdate:modelValue":p[2]||(p[2]=v=>l.value=v),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(I(),U(b,{key:3,modelValue:l.value,"onUpdate:modelValue":p[3]||(p[3]=v=>l.value=v),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),jt={key:0,class:"flow-viewer"},Bt={key:0,class:"flow-status-legend"},Mt={class:"legend-text"},zt=Q({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const a=e,c=ie();mt(c,()=>{var r;(r=c.value)==null||r.on("node:click",d=>t("nodeClick",d))});const l=R({get(){let r=gt();return typeof a.modelValue=="string"&&a.modelValue?r=JSON.parse(a.modelValue):typeof a.modelValue=="object"&&Object.keys(a.modelValue)&&(r=a.modelValue),r},set(r){t("update:modelValue",JSON.stringify(r))}}),m=R(()=>{const{column:r=[],group:d=[]}=JSON.parse(a.flowFormOption||"{}");return[...r,...d.map(v=>v.column??[]).flat()]}),{FlowDesign:o,tabs:n,request:s}=F(),{data:u}=lt(s).useList(),y=R(()=>(n==null?void 0:n.map(r=>({...r,display:!0})))??[]),f=R(()=>{var r;return{formPropertyList:[...m.value,...y.value],buttonList:(r=u.value)==null?void 0:r.filter(d=>d.status===1),fieldsDic:m.value.map(d=>({label:d.label,value:`\${${d.prop}}`,desc:`\${${d.prop}}`})),flowButtonDisplayDic:G(Pe),flowButtonApprovalDic:G(Re)}}),i=x({}),g=x({});We(g,r=>{var d,b,v,_,C,N;r&&((v=(b=(d=r.assignee)==null?void 0:d.children)==null?void 0:b.column)!=null&&v[1]&&(r.assignee.children.column[1].component=Be),(N=(C=(_=r.circulate)==null?void 0:_.children)==null?void 0:C.column)!=null&&N[1]&&(r.circulate.children.column[1].component=Be))},{debounce:1});const{data:h}=ye(s).useParam("flow.task.status"),w=R(()=>{var r;return(r=a.flowHistory)==null?void 0:r.map(d=>{var v,_;const b=(_=(v=h.value)==null?void 0:v.find(C=>C.value===d.status))==null?void 0:_.style;return{id:d.taskNodeKey,style:b}})}),p=R(()=>{var r,d;return(d=(r=a.flowHistory)==null?void 0:r.filter(b=>b.taskNodeType==="userTask"))==null?void 0:d.map(b=>{var v;return{id:b.taskNodeKey,content:`<div>${b.assigneeName}</div>
        <div>${b.endTime??""}</div>
        <div>${((v=b.comment)==null?void 0:v.handleComment)??""}</div>`}})});return(r,d)=>r.view?(I(),B("div",jt,[r.showLegend!==!1?(I(),B("div",Bt,[(I(!0),B(Y,null,oe(V(h),b=>{var v;return I(),B("div",{key:b.label,class:"legend-item"},[ee("div",{class:"legend-color",style:Nt({backgroundColor:(v=b.style)==null?void 0:v.fill})},null,4),ee("span",Mt,W(b.label),1)])}),128))])):M("",!0),$(V(o),{lf:c.value,"onUpdate:lf":d[0]||(d[0]=b=>c.value=b),"model-value":l.value,styles:w.value,tooltips:p.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(I(),U(V(o),{key:1,modelValue:l.value,"onUpdate:modelValue":d[1]||(d[1]=b=>l.value=b),formData:i.value,"onUpdate:formData":d[2]||(d[2]=b=>i.value=b),formDefaults:g.value,"onUpdate:formDefaults":d[3]||(d[3]=b=>g.value=b),"form-options":V(bt),"data-options":f.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const Ye=Ie(zt,[["__scopeId","data-v-79c19aa8"]]),Wt=Q({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=be(t),{flowDetail:c}=ae(),l=x(!1);function m({data:o}){o.type==="userTask"&&(l.value=!1,a.value=o.id)}return(o,n)=>{const s=O("el-button"),u=O("el-popover");return I(),U(u,{visible:l.value,"onUpdate:visible":n[0]||(n[0]=y=>l.value=y),placement:"bottom-start",width:"800px",trigger:"click"},{reference:L(()=>[$(s,null,{default:L(()=>[z(" 点击选择节点 ")]),_:1})]),default:L(()=>{var y,f;return[$(Ye,{"model-value":(f=(y=V(c))==null?void 0:y.process)==null?void 0:f.flowData,view:"",style:{height:"600px"},onNodeClick:m},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Gt=Q({__name:"approval-form",emits:["submit"],setup(e,{emit:t}){const{request:a}=F(),{getApprovalNode:c}=Ae(a),{useParam:l}=ye(a),{formData:m,approvalFormData:o,activeBtn:n,approvalVisible:s,formVariables:u,flowDetail:y}=ae(),f=x([]),i=x([]),g=x([]),h=x([]),w=x(!1),p=x(!1),r=x(),d=R(()=>{const k=f.value.length,T=g.value.length&&!f.value.length;return{menuBtn:!1,labelWidth:"auto",span:24,column:[{label:"指定节点",prop:"jumpTaskNodeKey",display:b("specifyNode"),rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",display:b("assignee"),rules:k?[{required:!0,validator:v}]:[]},{label:"传阅人",prop:"circulate",display:b("circulate"),rules:T?[{required:!0,message:"请选择传阅人"}]:[]},{label:"意见",prop:"comment",display:b("comment"),rules:[{required:!0,message:"请填写意见"}]}]}});function b(k){var T,D;return(D=(T=n.value)==null?void 0:T.approval)==null?void 0:D.includes(k)}function v(k,T,D){var E,j,se;const A=((E=f.value[0])==null?void 0:E.type)==="parallelGateway",K=(se=(j=f.value[0])==null?void 0:j.children)==null?void 0:se.every(ut=>wt([ut],it=>i.value.some(ct=>ct.id===it.id)));if(i.value.length){if(A&&!K)return D("请在每个节点选择审批人")}else return D("请选择审批人");return!0}const{data:_}=l("flow.approval.autocheck"),{data:C}=l("flow.approval.autocomment");te(async()=>{var D,A;if(!s.value||!r.value)return;De(()=>{r.value.resetFields(),o.value.comment=m.value.comment||C.value==="true"&&n.value.name||""});const{taskId:k}=((D=y.value)==null?void 0:D.task)||{},{flowKey:T}=((A=y.value)==null?void 0:A.process)||{};if(N(),!!b("assignee")&&!(b("specifyNode")&&!o.value.jumpTaskNodeKey))try{p.value=!0;const K=await c({flowKey:T,taskId:k,variables:u.value,buttonType:n.value.buttonKey,jumpTaskNodeKey:o.value.jumpTaskNodeKey});f.value=K.data.approvalNodeList,g.value=K.data.circulateNodeList}finally{p.value=!1}});function N(){f.value=[],i.value=[],g.value=[],h.value=[]}async function P(){await st(r),w.value=!0;const{data:k,outgoing:T}=S(i.value),{data:D}=S(h.value);o.value.assignee=k,o.value.circulate=D,o.value.outgoing=[...T],t("submit")}function S(k){const T={},D={},A=new Set;return k.forEach(K=>{const{taskNodeKey:E,incoming:j}=K;T[E]||(T[E]=new Set),K.userId&&T[E].add(K.userId),D[E]=[...T[E]].join(","),j&&A.add(j)}),{dataSet:T,data:D,outgoing:A}}return(k,T)=>{const D=O("el-skeleton"),A=O("avue-form"),K=O("el-button");return I(),U(He(V(H)()?"el-drawer":"el-dialog"),{modelValue:V(s),"onUpdate:modelValue":T[6]||(T[6]=E=>ne(s)?s.value=E:null),class:"approval-form-overlay",title:V(n).name,"append-to-body":"",width:"900px",size:"50%",direction:"btt"},{footer:L(()=>[$(K,{onClick:T[5]||(T[5]=E=>s.value=!1)},{default:L(()=>[z(" 取 消 ")]),_:1}),$(K,{type:"primary",onClick:P},{default:L(()=>[z(" 确 定 ")]),_:1})]),default:L(()=>[$(A,{ref_key:"formRef",ref:r,modelValue:V(o),"onUpdate:modelValue":T[4]||(T[4]=E=>ne(o)?o.value=E:null),class:"approval-form",option:d.value},{jumpTaskNodeKey:L(()=>[$(Wt,{modelValue:V(o).jumpTaskNodeKey,"onUpdate:modelValue":T[0]||(T[0]=E=>V(o).jumpTaskNodeKey=E)},null,8,["modelValue"])]),assignee:L(()=>[p.value?(I(),U(D,{key:0})):(I(),U(je,{key:"AssigneeTree",modelValue:i.value,"onUpdate:modelValue":T[1]||(T[1]=E=>i.value=E),data:f.value,"auto-check":V(_)==="true",mode:V(H)()?"vertical":"horizontal"},null,8,["modelValue","data","auto-check","mode"]))]),circulate:L(()=>[p.value?(I(),U(D,{key:0})):(I(),U(je,{key:"CirculateTree",modelValue:h.value,"onUpdate:modelValue":T[2]||(T[2]=E=>h.value=E),data:g.value,mode:V(H)()?"vertical":"horizontal"},null,8,["modelValue","data","mode"]))]),comment:L(()=>[$($t,{modelValue:V(o).comment,"onUpdate:modelValue":T[3]||(T[3]=E=>V(o).comment=E)},null,8,["modelValue"])]),_:1},8,["modelValue","option"])]),_:1},8,["modelValue","title"])}}});const Qt={class:"flow-form__title"},Ft=Q({__name:"index",props:At,emits:Et,setup(e,{emit:t}){const c=St(e,t),{ApprovalForm:l,tabsProps:m}=F(),o=l??Gt,{title:n,detail:s,flowDetail:u,tabRefs:y,tabList:f,activeTab:i,activeBtn:g,formLoading:h,approvalVisible:w,submitLoading:p,beforeClick:r,beforeSubmit:d,tabsRef:b}=c;async function v(N){var P,S;g.value=N;for(const k of Object.values(y.value))await((P=k==null?void 0:k.validate)==null?void 0:P.call(k));await((S=r==null?void 0:r.value)==null?void 0:S.call(r,N)),(N==null?void 0:N.approval)!=="false"?w.value=!0:C()}const _=Pt(c);async function C(){var N;try{const{buttonKey:P}=g.value;p.value=!0,await((N=d==null?void 0:d.value)==null?void 0:N.call(d,g.value));const S=_[P];S?(await(S==null?void 0:S()),w.value=!1,t("complete",g.value)):ce.error("无法找到相应的操作")}finally{p.value=!1}}return(N,P)=>{const S=O("el-skeleton"),k=O("el-main"),T=O("el-header"),D=O("el-tab-pane"),A=O("el-tabs"),K=O("el-footer"),E=O("el-container");return V(h)?(I(),U(k,{key:0},{default:L(()=>[$(S)]),_:1})):(I(),U(E,{key:1,class:"flow-form"},{default:L(()=>[$(T,{class:"flow-form__header",height:"auto"},{default:L(()=>{var j;return[ee("div",Qt,W(V(n)??((j=V(u).flowInstance)==null?void 0:j.title)),1),!V(s)&&!V(H)()?(I(),U(Ke,{key:0,onClick:v})):M("",!0)]}),_:1}),$(k,{class:"flow-form__main"},{default:L(()=>[$(A,fe({ref_key:"tabsRef",ref:b,modelValue:V(i),"onUpdate:modelValue":P[0]||(P[0]=j=>ne(i)?i.value=j:null)},V(m)),{default:L(()=>[(I(!0),B(Y,null,oe(V(f),j=>(I(),U(D,{key:j.prop,label:j.label,name:j.prop,lazy:j.lazy,disabled:j.disabled,closable:j.closable},{default:L(()=>[(I(),U(He(j.component),{ref_for:!0,ref:se=>V(y)[j.prop]=se},null,512))]),_:2},1032,["label","name","lazy","disabled","closable"]))),128))]),_:1},16,["modelValue"])]),_:1}),!V(s)&&V(H)()?(I(),U(K,{key:0,class:"flow-form__footer",height:"auto"},{default:L(()=>[$(Ke,{onClick:v})]),_:1})):M("",!0),$(V(o),{onSubmit:C})]),_:1}))}}});const Ht=Q({setup(){const{flowDetail:e,formData:t,detail:a}=ae(),c=Rt(e.value),{proxy:l}=Vt(),m=x({});te(()=>{const{formOption:s}=e.value.process??{};m.value=_t.bind(l)(s||'{"menuBtn":false}'),m.value.detail=!!a.value});const o=x();function n(){return st(o)}return{form:t,option:m,defaults:c,formRef:o,validate:n}},render(){return Tt(O("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,class:this.option.class,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Jt=Q({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:a,detail:c}=ae(),{upload:{action:l,headers:m,preview:o,download:n,props:s}={},request:u}=F(),y=typeof m=="function"?m():m,f=R(()=>{var C,N;return((N=(C=t.value)==null?void 0:C.task)==null?void 0:N.flowInstanceId)??Ge()}),i=[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}],g=i.filter(C=>C.prop==="fileName"),h={rowKey:"id",align:"center",index:!1,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuType:"menu",menuBtnTitle:"操作",column:H()?g:i},{bindVal:w,getDataList:p,handleDel:r,handleSave:d,afterGetList:b,crudStateRefs:{tableData:v}}=ht({crudOption:{...Oa(u),saveSuccessMsg:"上传成功"},tableOption:h,queryForm:{isLatest:1,flowInstanceId:f.value}});b(()=>{a.value=v.value.map(C=>C.id).join(",")}),p();async function _(C,N){var K,E;const{fileName:P,fileType:S,fileSize:k,fileUrl:T,res:D}=s,A={fileName:ue({res:C},`${D}.${P}`),fileType:ue({res:C},`${D}.${S}`),fileSize:ue({res:C},`${D}.${k}`),fileUrl:ue({res:C},`${D}.${T}`),taskId:(E=(K=t.value)==null?void 0:K.task)==null?void 0:E.taskId,flowInstanceId:f.value,rootMark:(N==null?void 0:N.rootMark)||"",version:typeof(N==null?void 0:N.version)=="number"?N.version+1:1};await d(A,p,()=>{})}return(C,N)=>{const P=O("el-button"),S=O("el-upload"),k=O("el-dropdown-item"),T=O("avue-crud");return I(),U(T,Dt(It(V(w))),{"menu-left":L(()=>[V(c)?M("",!0):(I(),U(S,{key:0,action:V(l),headers:V(y),"show-file-list":!1,onSuccess:N[0]||(N[0]=D=>_(D))},{default:L(()=>[$(P,{type:"primary",icon:"el-icon-upload"},{default:L(()=>[z(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"]))]),"menu-btn":L(({row:D,index:A})=>[$(k,{icon:"el-icon-view",onClick:K=>{var E;return(E=V(o))==null?void 0:E(D,V(v))}},{default:L(()=>[z(" 预览 ")]),_:2},1032,["onClick"]),$(k,{icon:"el-icon-download",onClick:K=>{var E;return(E=V(n))==null?void 0:E(D,V(v))}},{default:L(()=>[z(" 下载 ")]),_:2},1032,["onClick"]),V(c)?M("",!0):(I(),U(k,{key:0,icon:"el-icon-upload"},{default:L(()=>[$(S,{action:V(l),headers:V(y),"show-file-list":!1,onSuccess:K=>_(K,D)},{default:L(()=>[z(" 更新版本 ")]),_:2},1032,["action","headers","onSuccess"])]),_:2},1024)),V(c)?M("",!0):(I(),U(k,{key:1,icon:"el-icon-delete",onClick:K=>V(r)(D,A)},{default:L(()=>[z(" 删除 ")]),_:2},1032,["onClick"]))]),_:1},16)}}}),Yt={class:"flow-track"},Xt={key:0},Zt={key:1},qt=Q({__name:"flow-track",setup(e){const{flowDetail:t}=ae(),a=x(H()?"timeline":"table"),c=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],l=R(()=>{var u,y,f;return((f=(y=(u=t.value)==null?void 0:u.flowHistory)==null?void 0:y.filter(i=>i.taskNodeType==="userTask"))==null?void 0:f.map(i=>({...i,duration:dt(i.duration)})))??[]}),m={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},{request:o}=F(),{data:n}=ye(o).useParam("flow.handle.type");function s(u){var y;return(y=n.value)==null?void 0:y.find(f=>f.value===u)}return(u,y)=>{var d,b,v;const f=O("el-radio-button"),i=O("el-radio-group"),g=O("avue-crud"),h=O("el-card"),w=O("el-timeline-item"),p=O("el-timeline"),r=O("el-empty");return I(),B(Y,null,[V(H)()?M("",!0):(I(),U(i,{key:0,modelValue:a.value,"onUpdate:modelValue":y[0]||(y[0]=_=>a.value=_)},{default:L(()=>[(I(),B(Y,null,oe(c,_=>$(f,{key:_.label,label:_.label},{default:L(()=>[$(V(ze),{icon:_.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])),ee("div",Yt,[a.value==="table"?(I(),U(g,{key:0,data:l.value,option:m},null,8,["data"])):M("",!0),a.value==="graph"?(I(),U(Ye,{key:1,"model-value":(b=(d=V(t))==null?void 0:d.process)==null?void 0:b.flowData,"flow-history":(v=V(t))==null?void 0:v.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):M("",!0),a.value==="timeline"?(I(),B(Y,{key:2},[l.value.length?(I(),U(p,{key:0},{default:L(()=>[(I(!0),B(Y,null,oe([...l.value].reverse(),_=>(I(),U(w,{key:_.id,timestamp:_.endTime,placement:"top"},{default:L(()=>[$(h,null,{default:L(()=>{var C,N,P;return[ee("div",null,W(_.assigneeName)+" 开始处理 ["+W(_.taskNodeName)+"] 环节 ",1),_.duration?(I(),B("div",Xt," 办理时长："+W(_.duration),1)):M("",!0),_.type&&((C=_.comment)!=null&&C.handleComment)?(I(),B("div",Zt,W((N=s(_.type))==null?void 0:N.label)+"意见："+W((P=_.comment)==null?void 0:P.handleComment),1)):M("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(I(),U(r,{key:1}))],64)):M("",!0)])],64)}}});const ea=Ie(qt,[["__scopeId","data-v-a1713c28"]]),ta={FlowDesign:{},FormDesign:{},FlowForm:Ft,request:{},tabs:[{label:"审批表单",prop:"formTab",component:Ht},{label:"附件资料",prop:"fileTab",component:Jt},{label:"流程跟踪",prop:"trackTab",component:ea}],useFlowFormOptions:{type:"drawer",window:["","flow-form","left=0,top=0,width=1600,height=900"],overlay:{width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0}},tableOption:{align:"center",border:!0,card:!0,stripe:!0,searchMenuSpan:6,span:24},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}},aa={},oa=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),la=()=>aa,Z=e=>e,Ne=e=>Array.isArray(e),Le=e=>e!==null&&typeof e=="object",xe=e=>e instanceof Function,re=e=>e==null,Oe=typeof window>"u",Xe=()=>{var e;return Oe||re((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},na=()=>{var e,t;return(e=!Oe&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},we=()=>new Promise(()=>{}),J=e=>ne(e)?e.value:e,ra=e=>Le(e)?Object.assign(Ne(e)?[]:{},e):e,de=new Map,sa=e=>re(e)?void 0:de.get(e),ua=(e,t,a)=>{const c=de.get(e);c!=null&&c.timer&&clearTimeout(c.timer);const l=setTimeout(()=>de.delete(e),t);de.set(e,{...a,timer:l})};function Ze(e,t,a){let c,l,m,o,n,s,u=0,y=!1,f=!1,i=!0;const g=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Le(a)&&(y=!!a.leading,f="maxWait"in a,m=f?Math.max(+a.maxWait||0,t):m,i="trailing"in a?!!a.trailing:i);function h(k){const T=c,D=l;return c=l=void 0,u=k,o=e.apply(D,T),o}function w(k,T){return g?(window.cancelAnimationFrame(n),window.requestAnimationFrame(k)):setTimeout(k,T)}function p(k){if(g)return window.cancelAnimationFrame(k);clearTimeout(k)}function r(k){return u=k,n=w(v,t),y?h(k):o}function d(k){const T=k-s,D=k-u,A=t-T;return f?Math.min(A,m-D):A}function b(k){const T=k-s,D=k-u;return s===void 0||T>=t||T<0||f&&D>=m}function v(){const k=Date.now();if(b(k))return _(k);n=w(v,d(k))}function _(k){return n=void 0,i&&c?h(k):(c=l=void 0,o)}function C(){n!==void 0&&p(n),u=0,c=s=l=n=void 0}function N(){return n===void 0?o:_(Date.now())}function P(){return n!==void 0}function S(){const k=Date.now(),T=b(k);for(var D=arguments.length,A=new Array(D),K=0;K<D;K++)A[K]=arguments[K];if(c=A,l=this,s=k,T){if(n===void 0)return r(s);if(f)return n=w(v,t),h(s)}return n===void 0&&(n=w(v,t)),o}return S.cancel=C,S.flush=N,S.pending=P,S}function ia(e,t,a){let c=!0,l=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Le(a)&&(c="leading"in a?!!a.leading:c,l="trailing"in a?!!a.trailing:l),Ze(e,t,{leading:c,trailing:l,maxWait:t})}var ca=Z((e,t)=>{let{debounceInterval:a,debounceOptions:c,manual:l}=t;const m=x(!1),o=x(),n=R(()=>c),s=R(()=>J(a)),u=x(e.context.runAsync);return l||(m.value=!0),te(y=>{re(s.value)||(o.value=Ze(f=>f(),s.value,n.value),e.context.runAsync=function(){for(var f=arguments.length,i=new Array(f),g=0;g<f;g++)i[g]=arguments[g];return new Promise((h,w)=>{m.value?(m.value=!1,u.value(...i).then(h).catch(w)):o.value(()=>{u.value(...i).then(h).catch(w)})})},y(()=>{var f;(f=o.value)===null||f===void 0||f.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var y;(y=o.value)===null||y===void 0||y.cancel()}}}),da=Z((e,t)=>{let{errorRetryCount:a=0,errorRetryInterval:c=0}=t;const l=x(),m=x(0),o=R(()=>J(a)),n=R(()=>J(c));let s=!1;const u=()=>{m.value=0},y=R(()=>{if(n.value)return n.value;const g=1e3,h=1,w=9,p=Math.floor(Math.random()*2**Math.min(m.value,w)+h);return g*p}),f=()=>{let g;const h=o.value===-1,w=m.value<o.value;return(h||w)&&(h||(m.value+=1),g=setTimeout(()=>{s=!0,e.context.refresh()},y.value)),()=>g&&clearTimeout(g)},i=()=>{l.value&&l.value()};return{onBefore(){s||u(),s=!1,i()},onSuccess(){u()},onError(){l.value=f()},onCancel(){u(),i()}}}),pa=Z((e,t)=>{let{ready:a=x(!0),manual:c,defaultParams:l=[]}=t;return ge(a,m=>{!c&&m&&e.context.run(...l)},{flush:"sync"}),{onBefore(){if(!(xe(a)?a():a.value))return e.loading.value=!1,{isBreak:!0}}}}),fa=Z((e,t)=>{let{refreshDeps:a,refreshDepsAction:c,manual:l}=t;if(a===void 0||Ne(a)&&a.length===0)return{};const m=Ne(a)?a:[a];return ge(m,()=>{c?c():!l&&e.context.refresh()}),{}}),ma=Z((e,t)=>{let{throttleInterval:a,throttleOptions:c}=t;const l=x(),m=R(()=>J(a)),o=R(()=>c),n=x(e.context.runAsync);return te(s=>{if(re(a))return{};l.value=ia(u=>u(),m.value,o.value),e.context.runAsync=function(){for(var u=arguments.length,y=new Array(u),f=0;f<u;f++)y[f]=arguments[f];return new Promise((i,g)=>{l.value(()=>{n.value(...y).then(i).catch(g)})})},s(()=>{var u;(u=l.value)===null||u===void 0||u.cancel(),e.context.runAsync=n.value})}),{onCancel(){var s;(s=l.value)===null||s===void 0||s.cancel()}}});const va=(e,t)=>a=>{Object.keys(a).forEach(c=>{e[c].value=a[c]}),t.forEach(c=>c(e))},ba=(e,t)=>()=>{let a=t;for(let c=e.length;c-- >0;)a=e[c](a);return a()},ga=(e,t,a)=>{var c,l;const{initialData:m,onSuccess:o,onError:n,onBefore:s,onAfter:u}=t,y=x((c=a==null?void 0:a.loading)!==null&&c!==void 0?c:!1),f=ie((l=a==null?void 0:a.data)!==null&&l!==void 0?l:m),i=ie(a==null?void 0:a.error),g=x(a==null?void 0:a.params),h=x([]),w=ie("pending"),p={},r=va({status:w,loading:y,data:f,error:i,params:g},[]),d=function(v){for(var _=arguments.length,C=new Array(_>1?_-1:0),N=1;N<_;N++)C[N-1]=arguments[N];if(v==="onQuery"){const P=h.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:ba(P,C[0])()}}else{const P=h.value.map(S=>{var k;return(k=S[v])===null||k===void 0?void 0:k.call(S,...C)});return Object.assign({},...P)}},b=x(0);return p.runAsync=async function(){for(var v=arguments.length,_=new Array(v),C=0;C<v;C++)_[C]=arguments[C];r({loading:!0,params:_,status:"pending"}),b.value+=1;const N=b.value,{isBreak:P,breakResult:S=we()}=d("onBefore",_);if(P)return r({status:"settled"}),S;s==null||s(_);try{const k=()=>new Promise(A=>A(e(...g.value)));let{servicePromise:T}=d("onQuery",k);T||(T=k());const D=await T;return N!==b.value?we():(r({data:D,loading:!1,error:void 0,status:"settled"}),d("onSuccess",D,_),o==null||o(D,_),N===b.value&&d("onAfter",_,D,void 0),u==null||u(_),D)}catch(k){if(N!==b.value)return we();throw r({loading:!1,error:k,status:"settled"}),d("onError",k,_),n==null||n(k,_),N===b.value&&d("onAfter",_,void 0,k),u==null||u(_),k}},p.run=function(){p.runAsync(...arguments).catch(v=>{n||console.error(v)})},p.cancel=()=>{b.value+=1,r({loading:!1}),d("onCancel")},p.refresh=()=>{p.run(...g.value||[])},p.refreshAsync=()=>p.runAsync(...g.value||[]),p.mutate=v=>{const _=xe(v)?v(f.value):v,C=ra(_);r({data:C}),d("onMutate",C)},{status:w,loading:y,data:f,error:i,params:g,plugins:h,context:p}};function _a(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const c=Fe(oa,{}),l={...la(),...c,...t},{manual:m=!1,defaultParams:o=[]}=l,n=ga(e,l);if(n.plugins.value=a.map(s=>s(n,l)),!m){const s=n.params.value||o;n.context.run(...s)}return _e(()=>{n.context.cancel()}),{loading:n.loading,data:n.data,error:n.error,params:n.params,cancel:n.context.cancel,refresh:n.context.refresh,refreshAsync:n.context.refreshAsync,mutate:n.context.mutate,run:n.context.run,runAsync:n.context.runAsync}}const pe=new Map,ya=(e,t)=>{pe.set(e,t),t.then(a=>(pe.delete(e),a)).catch(()=>{pe.delete(e)})},wa=e=>pe.get(e),q=new Map,ha=(e,t)=>{q.has(e)&&q.get(e).forEach(a=>a(t))},ka=(e,t)=>(q.has(e)?q.get(e).push(t):q.set(e,[t]),()=>{const a=q.get(e).indexOf(t);q.get(e).splice(a,1)});var Ca=Z((e,t)=>{let{cacheKey:a,cacheTime:c=6e5,staleTime:l=0,getCache:m,setCache:o}=t;if(!a)return{};const n=xe(a)?a:()=>a,s=x(()=>{});let u;const y=r=>m?m(r):sa(r),f=(r,d,b)=>{o?o(r,b):ua(r,d,b),ha(r,b.data)},i=r=>l===-1||r+l>new Date().getTime(),g=(r,d)=>Object.prototype.hasOwnProperty.call(r,d),h=r=>{const d=n(r);return ka(d,b=>{e.data.value=b})},w=n(),p=y(w);return p&&g(p,"data")&&(e.data.value=p.data,e.params.value=p.params),w&&(s.value=h()),_e(()=>{s.value()}),{onBefore(r){const d=n(r),b=y(d);if(!b||!g(b,"data"))return{};if(i(b.time))return e.data.value=b.data,e.loading.value=!1,{isBreak:!0,breakResult:b.data};e.data.value=b.data},onQuery(r){const d=e.params.value,b=n(d);let v=wa(b);return v&&v!==u?()=>v:(v=r(),u=v,ya(b,v),()=>v)},onSuccess(r,d){const b=n(d);b&&(s.value(),f(b,c,{data:r,params:d,time:new Date().getTime()}),s.value=h(d))},onMutate(r){const d=n(e.params.value);d&&(s.value(),f(d,c,{data:r,params:e.params.value,time:new Date().getTime()}),s.value=h(e.params.value))}}});function Na(e){let t,a;class c extends Promise{constructor(m){super(m),this.cancel=()=>{a(),clearTimeout(t)}}}return new c(l=>{a=l,t=setTimeout(a,e)})}function he(){return new Date().getTime()}var Ta=Z((e,t)=>{let{loadingDelay:a=0,loadingKeep:c=0}=t;const l=x(()=>{}),m=R(()=>J(a)),o=R(()=>J(c));let n=0,s={};const u=()=>{let y;return m.value&&(y=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},m.value)),()=>y&&clearTimeout(y)};return{onBefore(){e.loading.value=!m.value,l.value(),l.value=u(),n=he()},onQuery(y){if(!o.value)return()=>y();s=Na(o.value+m.value);const f=async()=>{try{const g=await y();return he()-n<=m.value&&s.cancel(),Promise.resolve(g)}catch(g){return he()-n<=m.value&&s.cancel(),Promise.reject(g)}},i=Promise.allSettled([f(),s]).then(g=>{const h=g[0];return h.status==="fulfilled"?h.value:Promise.reject(h.reason)});return()=>i},onCancel(){l.value()},onAfter(){l.value()}}}),ke;const qe=new Set,et=new Set,tt=new Set,me=(e,t)=>{let a;switch(e){case"FOCUS_LISTENER":a=qe;break;case"RECONNECT_LISTENER":a=tt;break;case"VISIBLE_LISTENER":a=et;break}if(!a.has(t))return a.add(t),()=>{a.delete(t)}},Ce=e=>{e.forEach(t=>{t()})};!Oe&&(ke=window)!==null&&ke!==void 0&&ke.addEventListener&&(window.addEventListener("visibilitychange",()=>{Xe()&&Ce(et)},!1),window.addEventListener("focus",()=>Ce(qe),!1),window.addEventListener("online",()=>Ce(tt),!1));var Va=Z((e,t)=>{let{pollingInterval:a,pollingWhenHidden:c=!1,pollingWhenOffline:l=!1,errorRetryCount:m=0}=t;const o=x(),n=x(!1),s=R(()=>J(a)),u=R(()=>J(m)),y=[],f=w=>{w&&y.push(w)},i=()=>(c||Xe())&&(l||na()),g=w=>{if(e.error.value&&u.value!==0)return;let p;if(!re(s.value)&&s.value>=0)if(i())p=setTimeout(w,s.value);else{n.value=!0;return}return()=>p&&clearTimeout(p)},h=()=>{n.value&&i()&&(e.context.refresh(),n.value=!1)};return ge(s,()=>{o.value&&(o.value(),o.value=g(()=>e.context.refresh()))}),c||f(me("VISIBLE_LISTENER",h)),l||f(me("RECONNECT_LISTENER",h)),_e(()=>{y.forEach(w=>w())}),{onBefore(){var w;(w=o.value)===null||w===void 0||w.call(o)},onCancel(){var w;(w=o.value)===null||w===void 0||w.call(o)},onAfter(){o.value=g(()=>e.context.refresh())}}});const Da=(e,t)=>{let a=!1;return function(){a||(a=!0,e(...arguments),setTimeout(()=>{a=!1},t))}};var Ia=Z((e,t)=>{let{refreshOnWindowFocus:a=!1,refocusTimespan:c=5e3}=t;const l=R(()=>J(a)),m=R(()=>J(c)),o=[],n=u=>{u&&o.push(u)},s=()=>{o.forEach(u=>u())};return te(()=>{if(s(),l.value){const u=Da(e.context.refresh,m.value);n(me("VISIBLE_LISTENER",u)),n(me("FOCUS_LISTENER",u))}}),_e(()=>{s()}),{}});function le(e,t){return _a(e,t,[Ta,da,ca,Va,ma,Ia,fa,pa,Ca])}function La(e){const t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},a=s=>e.get(t.list,{params:{type:s,ascs:"sort"}});return{url:t,getList:a,useList:s=>le(()=>a(s.value).then(u=>u.data.records),{refreshDeps:[s]}),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),batchUpdate:s=>e.post(t.batchUpdate,s)}}var at=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(at||{}),xa=(e=>(e.保存草稿="flow_draft",e.发送="flow_pass",e.退回="flow_reject",e.终止="flow_terminate",e.撤销="flow_revoke",e.撤回到发起="flow_withdraw",e.打印="flow_print",e.转办="flow_transfer",e.加签="flow_add_instance",e.减签="flow_del_instance",e.指定回退="flow_rollback",e.绿色通道="flow_green",e))(xa||{}),Pe=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Pe||{}),Re=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(Re||{}),ot=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(ot||{});function lt(e){const t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},a=n=>e.get(t.list,{params:n});return{url:t,getList:a,useList:()=>le(()=>a({size:-1,ascs:"sort"}).then(n=>n.data.records)),create:n=>e.post(t.save,n),update:n=>e.post(t.update,n),remove:n=>e.post(t.remove,{},{params:{ids:n}})}}function Oa(e){const t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:m=>e.get(t.list,{params:m}),create:m=>e.post(t.save,m),remove:m=>e.post(t.remove,{},{params:{ids:m}})}}function ye(e){const t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},a=u=>e.get(t.list,{params:u}),c=()=>e.get(t.all),l=u=>e.get(t.key,{params:{paramKey:u}});return{url:t,getList:a,getAllParam:c,getParam:l,useParam:u=>le(()=>l(u).then(y=>y.data)),create:u=>e.post(t.save,u),update:u=>e.post(t.update,u),remove:u=>e.post(t.remove,{},{params:{ids:u}})}}var ve=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(ve||{}),Te=(e=>(e[e.已办结=1]="已办结",e[e.未办结=2]="未办结",e[e.已终止=3]="已终止",e))(Te||{}),Pa=(e=>(e[e.系统执行=1]="系统执行",e[e.用户办理=2]="用户办理",e[e.任务撤销=3]="任务撤销",e[e.任务退回=4]="任务退回",e[e.流程终止=5]="流程终止",e[e.任务转办=6]="任务转办",e[e.绿色通道=7]="绿色通道",e))(Pa||{});function Ae(e){const t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask"},a=p=>e.get(t.detail,{params:p}),c=p=>e.post(t.approvalNode,p),l=p=>e.post(t.start,p),m=p=>e.post(t.commit,p),o=p=>e.post(t.draft,p),n=p=>e.post(t.revoke,p),s=p=>e.post(t.terminate,p),u=p=>e.post(t.withdraw,p),y=p=>e.post(t.transfer,p),f=p=>e.post(t.reject,p),i=p=>e.post(t.green,p),g=()=>e.get(t.publishList);return{url:t,getFlowDetail:a,getApprovalNode:c,startTask:l,commitTask:m,saveDraft:o,revokeTask:n,terminateTask:s,withdrawTask:u,transferTask:y,rejectTask:f,greenChannel:i,getPublishList:g,usePublishList:()=>le(()=>g().then(p=>p.data)),getTaskList:p=>e.get(t.taskList,{params:p})}}function Ra(e){const t={tree:"/sapier-flow/flow-user/tree"},a=l=>e.get(t.tree,{params:{filter:l}});return{url:t,getUserTree:a,useUserTree:()=>le(()=>a().then(l=>l.data))}}var Ee=(e=>(e.ASSIGN_ID="ASSIGN_ID",e.ASSIGN_UUID="ASSIGN_UUID",e.AUTO="AUTO",e.INPUT="INPUT",e.NONE="NONE",e))(Ee||{}),Se=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Se||{});function Ja(e){const t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy",getFields:"/sapier-flow/dev-table/getTableFields"},a=u=>e.get(t.list,{params:u});return{url:t,getList:a,useList:()=>le(()=>a({size:-1}).then(u=>u.data.records)),create:u=>e.post(t.save,u),update:u=>e.post(t.update,u),remove:u=>e.post(t.remove,{},{params:{ids:u}}),deploy:u=>e.post(t.deploy,u),getFields:u=>e.get(t.getFields,{params:u})}}var nt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(nt||{});const Ve=G(nt),Ya=G(Se),Xa=G(Ee),Aa=Qe(ta);function F(e){return xt(Aa,e)}const Za=X({rowKey:"id",labelWidth:150,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:G(at)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:G(Pe),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:G(Re),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:G(ot)},{label:"按钮预览",prop:"buttonPreview",width:150}]}),rt={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",editDisabled:!0,rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",dicQuery:{size:-1},props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"排序",prop:"sort",type:"number",width:110},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},qa=X({rowKey:"flowModuleId",dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...rt.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]}),eo=X({rowKey:"flowDeloyId",dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...rt.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]}),to=X({rowKey:"id",menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:ve.待办,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}]}),ao=X({rowKey:"id",column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ve},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]}),oo=X({rowKey:"id",menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]});const lo=X({rowKey:"id",column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]}),no=X({rowKey:"id",column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]}),Me=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:G(Se)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ve,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ve,value:1}],ro=X({rowKey:"id",dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:G(Ee)},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:Me}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:Me}}]});function st(e){return new Promise((t,a)=>{V(e).validate((l,m,o)=>{l?(m(),t(o)):a(o)})})}function H(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}export{Ee as A,Se as B,ta as C,X as D,Ve as E,Ye as F,Ya as G,Pa as H,Xa as I,Gt as J,Ke as K,ea as L,Ht as M,Jt as N,Pt as O,Rt as P,At as Q,Et as R,Je as S,ve as T,St as U,ae as V,nt as W,H as X,Ft as _,F as a,lt as b,qa as c,eo as d,Ja as e,rt as f,st as g,to as h,ao as i,ye as j,oo as k,Ae as l,lo as m,no as n,ro as o,La as p,at as q,xa as r,Pe as s,Za as t,le as u,Re as v,ot as w,Oa as x,Te as y,Ra as z};
