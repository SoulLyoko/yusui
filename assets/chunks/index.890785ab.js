import{a as U,d as pe}from"./index.63550f19.js";import"./index.013eb64a.js";import{e as re,s as E}from"./index.0246ace1.js";import{f as I}from"./index.af03a1c8.js";import{h as O,$ as se,S as ue,d as C,g as y,J as h,b as T,o as f,c as B,N as D,R as ce,w as R,a as ie,e as A,l as F,B as K,j as M,k as $,K as de}from"./framework.6b67ac47.js";import{d as W}from"./form.07a7ad88.js";var z=(a=>(a.用户="user",a.部门="dept",a.岗位="post",a.动态="dynamic",a.指定节点="userTask",a.指定用户="specifyUser",a.自定义="custom",a))(z||{});const J=Symbol("flowDesignState");function qe(a){const t=U(a,void 0,{passive:!0}),{lf:l,modelValue:p,elementData:e,formOptions:n,formData:s,formOption:u,formDefaults:b,dataOptions:_}=t,v=O(!1),g=O(!1);function c(r){var m,k,w;const i=(m=e.value)==null?void 0:m.id;i&&((k=l.value)==null||k.setProperties(i,r)),i&&((w=l.value)==null||w.updateText(i,r.name))}const d=O(),o={lf:l,graphData:p,elementData:e,formRef:d,formData:s,formDefaults:b,formLoading:v,formOption:u,formOptions:n,editorVisible:g,dataOptions:_,onUpdateFormData:c};return se(J,o),o}function N(){return ue(J)}const j=C({__name:"FlowNodeSelect",props:{filterType:{},dic:{}},setup(a){const t=a,{lf:l}=N(),p=y(()=>{var e;return(e=l.value)==null?void 0:e.graphModel.nodes.filter(n=>t.filterType?t.filterType.includes(n.type):!0).map(n=>({label:n.text.value,value:n.id,desc:n.id}))});return(e,n)=>{const s=h("avue-select");return f(),T(s,{dic:p.value},null,8,["dic"])}}}),me={key:0,style:{display:"flex"}},be=C({__name:"FlowAssigneeSetter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(a,{emit:t}){const l=a,p=O(!1),e=y(()=>{var o,r;return(r=(o=l.tableData)==null?void 0:o.row)==null?void 0:r.type}),n=y(()=>["dept","post","user","specifyUser"].includes(e.value)),s=y({get(){return l.modelValue?l.modelValue.split(","):[]},set(o){var r;if(t("update:modelValue",o.join(",")),(r=l.tableData)!=null&&r.row){const i=I(c.value,m=>o==null?void 0:o.includes(m.id));l.tableData.row.idVal=i.map(m=>m[`${e.value}Id`]).join(",")}}}),u=y({get(){return l.modelValue},set(o){t("update:modelValue",o)}}),b=y({get(){return n.value?s.value:u.value},set(o){n.value?s.value=o:u.value=o}});function _(){b.value=I(c.value,o=>o.type===e.value).map(o=>o.id)}const{dataOptions:v}=N(),g=y(()=>{const{flowAssigneeUserDic:o=[],flowAssigneeDeptDic:r=[],flowAssigneePostDic:i=[],flowAssigneeDynamicDic:m=[]}=v.value??{};return{user:o,dept:r,post:i,dynamic:m,specifyUser:o,userTask:[]}}),c=y(()=>g.value[e.value]??[]),d=y(()=>{const o={clearable:!0,data:c.value,filterable:!0,loading:p.value,nodeKey:"value",placeholder:"请选择"},r={checkStrictly:!["user","specifyUser"].includes(e.value),multiple:!0,showCheckbox:!0,collapseTags:!0,collapseTagsTooltip:!0,maxCollapseTags:3};return{...o,...n.value?r:{}}});return(o,r)=>{const i=h("el-tree-select"),m=h("el-button"),k=h("el-input");return["dept","post","user","specifyUser","dynamic"].includes(e.value)?(f(),B("div",me,[D(i,ce({modelValue:b.value,"onUpdate:modelValue":r[0]||(r[0]=w=>b.value=w)},d.value,{style:{width:"100%"}}),null,16,["modelValue"]),d.value.multiple?(f(),T(m,{key:0,text:"",type:"primary",icon:"el-icon-check",onClick:_},{default:R(()=>[ie(" 全选 ")]),_:1})):A("",!0)])):e.value==="userTask"?(f(),T(j,{key:1,modelValue:u.value,"onUpdate:modelValue":r[1]||(r[1]=w=>u.value=w),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(f(),T(k,{key:2,modelValue:u.value,"onUpdate:modelValue":r[2]||(r[2]=w=>u.value=w),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),ye=C({__name:"FlowAssignee",props:{modelValue:{}},setup(a){const t=a,{modelValue:l}=U(t,void 0,{defaultValue:[]}),p=y(()=>({rowKey:"type",addBtn:!0,column:[{label:"类型",prop:"type",type:"select",width:120,dicData:re(z)},{label:"值",prop:"value",component:be}]}));return(e,n)=>{const s=h("avue-dynamic");return f(),B("div",null,[D(s,{modelValue:F(l),"onUpdate:modelValue":n[0]||(n[0]=u=>K(l)?l.value=u:null),children:p.value},null,8,["modelValue","children"])])}}}),H=[{label:"",labelWidth:0,prop:"assignee",type:"dynamic",component:ye,value:[]}],V=[{label:"节点id",prop:"id",readonly:!0},{label:"节点名称",prop:"name"},{label:"节点描述",prop:"desc"}];function ve(a,t){const l=[];return a.forEach(p=>{const e=t.find(u=>u.buttonKey===p.buttonKey);!e||[p.display===(e==null?void 0:e.display),p.approval===(e==null?void 0:e.approval)].every(u=>u)||l.push(e)}),l}function Q(a,t){const l=[];return a.forEach(p=>{var d,o,r;const e=t.find(i=>i.prop===p.prop);if(!e)return;p.type==="dynamic"&&((o=(d=p.children)==null?void 0:d.column)!=null&&o.length)&&(e.children=Q(p.children.column,(e==null?void 0:e.children)??[]));let{display:n,disabled:s,detail:u,readonly:b,rules:_,required:v}={...W,...p};v=(_==null?void 0:_.some(i=>i.required))??v,!([n===(e==null?void 0:e.display),s===(e==null?void 0:e.disabled),u===(e==null?void 0:e.detail),b===(e==null?void 0:e.readonly),v===e.required].every(i=>i)&&!((r=e.children)!=null&&r.length))&&l.push(e)}),l}function Se(a,t){return{...a,...t,plugins:[...(a==null?void 0:a.plugins)??[],...(t==null?void 0:t.plugins)??[]]}}function X(a){return a.map(t=>{var p,e,n;const l={label:t.label,value:t.prop,desc:t.prop};return t.type==="dynamic"&&((e=(p=t.children)==null?void 0:p.column)!=null&&e.length)&&(l.children=X((n=t.children)==null?void 0:n.column)),l})}const fe=C({__name:"FlowButton",props:{modelValue:{}},setup(a){const t=a,{modelValue:l}=U(t,void 0,{defaultValue:[]}),{dataOptions:p}=N();M(async()=>{var n;await E(),l.value=ve(((n=p.value)==null?void 0:n.buttonList)??[],l.value??[])});const e=y(()=>{const{flowButtonDisplayDic:n=[],flowButtonApprovalDic:s=[],flowButtonValidateDic:u=[],buttonList:b=[]}=p.value??{};return{rowKey:"buttonKey",column:[{label:"按钮",prop:"buttonKey",width:100,type:"select",dicData:(b==null?void 0:b.map(v=>({label:v.name,value:v.buttonKey,desc:v.buttonKey})))??[]},{label:"显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",dicData:n??[]},{label:"审批窗口",prop:"approval",type:"select",multiple:!0,dataType:"string",dicData:s??[]},{label:"是否校验",prop:"validate",type:"switch",width:60,dicData:u??[]}]}});return(n,s)=>{const u=h("avue-dynamic");return f(),B("div",null,[D(u,{modelValue:F(l),"onUpdate:modelValue":s[0]||(s[0]=b=>K(l)?l.value=b:null),children:e.value},null,8,["modelValue","children"])])}}}),q=[{label:"",labelWidth:0,prop:"button",type:"dynamic",component:fe,value:[],tip:"需要覆盖默认按钮配置时从这里添加"}],Y=[{label:"",labelWidth:0,prop:"circulate",type:"dynamic",children:{rowKey:"type",addBtn:!0,column:[{label:"类型",prop:"type",type:"select",width:120,dicData:[{label:"用户",value:"user"},{label:"部门",value:"dept"},{label:"岗位",value:"post"},{label:"动态",value:"dynamic"},{label:"指定节点",value:"userTask"},{label:"自定义",value:"custom"}]},{label:"值",prop:"value"}]},value:[]}],he=[{label:"开始",value:"start"},{label:"任务",value:"task"},{label:"结束",value:"end"}],_e=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],we=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],Ve=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:he},{label:"类型",prop:"eventType",type:"select",dicData:_e},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:we},{label:"值",prop:"fieldValue"}]}}]}}],G=C({__name:"FlowCheckbox",props:{modelValue:{type:Boolean}},setup(a){const t=a,{modelValue:l}=U(t);return(p,e)=>{const n=h("el-checkbox");return f(),B("span",null,[D(n,{modelValue:F(l),"onUpdate:modelValue":e[0]||(e[0]=s=>K(l)?l.value=s:null)},null,8,["modelValue"])])}}}),De={style:{display:"flex"}},xe={style:{position:"absolute",left:"12px",top:"16px","z-index":"10"}},Ce=$("strong",null," 字段",-1),ge=C({__name:"FlowFormProperty",props:{modelValue:{}},setup(a){const t=a,{modelValue:l}=U(t,void 0,{defaultValue:[]}),[p,e]=pe(),{dataOptions:n}=N();M(async()=>{var c;await E(),l.value=Q(((c=n.value)==null?void 0:c.formPropertyList)??[],l.value??[])});const s=y(()=>{var c;return X(((c=n.value)==null?void 0:c.formPropertyList)??[])}),u=y(()=>({rowKey:"prop",defaultExpandAll:!0,column:[{prop:"_index",hide:!0},{label:"",prop:"prop",component:e,type:"select",dicData:s.value??[]},{label:"显示",prop:"display",width:40,component:G},{label:"禁用",prop:"disabled",width:40,component:G},{label:"详情",prop:"detail",width:40,component:G},{label:"只读",prop:"readonly",width:40,component:G},{label:"必填",prop:"required",width:40,component:G}]}));function b(){l.value.push({...W})}function _(c){const d=l.value.find(o=>o.prop===c);d.children||(d.children=[]),d.children.push({...W,$cellEdit:!0})}function v(c){l.value=I(l.value,d=>d.prop!==c,{flat:!1})}function g(c){return!!s.value.find(o=>{var r;return o.value===c&&((r=o.children)==null?void 0:r.length)})}return(c,d)=>{const o=h("avue-input-tree"),r=h("el-button"),i=h("avue-dynamic");return f(),B(de,null,[D(F(p),null,{default:R(({modelValue:m,"onUpdate:modelValue":k})=>[$("div",De,[D(o,{"model-value":m,dic:s.value,"default-expand-all":"","onUpdate:modelValue":k},null,8,["model-value","dic","onUpdate:modelValue"]),g(m)?(f(),T(r,{key:0,type:"primary",icon:"el-icon-plus",text:"",onClick:w=>_(m)},null,8,["onClick"])):A("",!0),D(r,{type:"danger",icon:"el-icon-delete",text:"",onClick:w=>v(m)},null,8,["onClick"])])]),_:1}),$("div",null,[$("div",xe,[D(r,{type:"primary",icon:"el-icon-plus",size:"small",circle:"",onClick:b}),Ce]),D(i,{modelValue:F(l),"onUpdate:modelValue":d[0]||(d[0]=m=>K(l)?l.value=m:null),children:u.value},null,8,["modelValue","children"])])],64)}}}),P=[{label:"",labelWidth:0,prop:"formProperty",type:"dynamic",component:ge,value:[],tip:"需要覆盖默认表单配置时从这里添加"}],Z=[{label:"网关类型",prop:"inout",type:"radio",button:!0,value:"in",dicData:[{label:"进",value:"in"},{label:"出",value:"out"}]},{label:"完成条件",prop:"completionCondition",type:"slider",showInput:!0,showInputControls:!1,labelPosition:"top",step:.01,max:1,value:0,labelTip:"任务完成的百分比，如2人接收，需同时完成才往下进行时=100%，只需1人完成时=50%",span:23,offset:1}],S=[{label:"多实例类型",prop:"multiInstanceType",tip:"选择后节点变更为多人任务",type:"select",dicData:[{label:"并行审批",value:"parallel",desc:"同时接收审批"},{label:"顺序审批",value:"sequential",desc:"按顺序审批"}]},{label:"完成条件",prop:"completionCondition",type:"slider",showInput:!0,showInputControls:!1,labelPosition:"top",step:.01,max:1,value:0,labelTip:"任务完成的百分比，如2人接收，需同时完成才往下进行时=100%，只需1人完成时=50%",span:23,offset:1},{label:"回收任务",prop:"isRecall",type:"switch",value:!1,labelTip:"满足完成条件时，该节点未审批任务是否回收，回收的任务仅保留记录，对应人员无需再办理"}],ee=[{label:"节点id",prop:"id",readonly:!0},{label:"节点描述",prop:"name",type:"textarea"}],L=C({__name:"FlowFieldsSelect",props:{dic:{}},setup(a){const{dataOptions:t}=N(),l=y(()=>{var p;return((p=t.value)==null?void 0:p.fieldsDic)??[]});return(p,e)=>{const n=h("avue-select");return f(),T(n,{dic:l.value},null,8,["dic"])}}}),le=[{label:"跳过第一节点",prop:"skipFirstNode",type:"switch",labelWidth:100,value:!0},{label:"默认驳回节点",prop:"rollbackNode",type:"select",labelWidth:100,component:j,params:{filterType:"userTask"}},{label:"优先级字段",prop:"priority",type:"select",component:L,filterable:!0,allowCreate:!0,defaultFirstOption:!0},{label:"表单标题",prop:"formTitle",separator:"-",type:"select",component:L,dataType:"string",multiple:!0,filterable:!0,allowCreate:!0,defaultFirstOption:!0},{label:"标题分隔符",prop:"formTitleSeparator",value:"-",control(a){return{formTitle:{separator:a}}}}],x=[{label:"",labelWidth:0,prop:"property",type:"dynamic",children:{column:[{label:"属性名",prop:"name"},{label:"属性值",prop:"value",type:"textarea",minRows:1}]},value:[]}],ae=[{label:"条件表达式",prop:"conditionsequenceflow"},{label:"是否为默认分支",prop:"defaultConditions",labelWidth:120,type:"switch",value:!1,change({row:a,value:t}){a.isDefaultFlow=t}}],te=[{label:"",labelWidth:0,prop:"serial",component:"avue-form",option:{menuBtn:!1,span:24,column:[{label:"名称",prop:"name"},{label:"前缀",prop:"prefix"},{label:"日期格式",prop:"dateFormat"},{label:"后缀位数",prop:"suffixLength"},{label:"初始数值",prop:"startSequence"},{label:"连接符",prop:"connector"},{label:"重置周期",prop:"cycle",type:"select",dicData:[{label:"不重置",value:"none"},{label:"按天重置",value:"day"},{label:"按周重置",value:"week"},{label:"按月重置",value:"month"},{label:"按年重置",value:"year"}]}]}}],oe=[{label:"类",prop:"className"},{label:"异步",prop:"isAsync",type:"switch",value:!1}],ke=[{label:"创建",value:"create"},{label:"指派",value:"assignment"},{label:"完成",value:"complete"},{label:"删除",value:"delete"},{label:"更新",value:"update"},{label:"超时",value:"timeout"}],Te=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],Ge=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],Pe=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:ke},{label:"类型",prop:"eventType",type:"select",dicData:Te},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:Ge},{label:"值",prop:"fieldValue"}]}}]}}],Fe=[{label:"",labelWidth:0,prop:"timeLimit",type:"dynamic",children:{column:[{label:"名称",prop:"name"},{label:"最小值",prop:"min",type:"number"},{label:"最大值",prop:"max",type:"number"}]},value:[]}],ne=[{label:"驳回节点",prop:"rollbackNode",type:"select",component:j,params:{filterType:"userTask"}},{label:"重新提交后回到驳回人",prop:"backToRejecter",type:"switch",value:!1}],Ue=[{label:"基本配置",prop:"base",column:V}],Be={startEvent:[{label:"基本配置",prop:"baseGroup",column:V},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],endEvent:[{label:"基本配置",prop:"baseGroup",column:V},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],userTask:[{label:"基本配置",prop:"baseGroup",column:[...V,...ne]},{label:"人员配置",prop:"assigneeGroup",column:H},{label:"多实例配置",prop:"multiInstanceGroup",collapse:!1,column:S},{label:"按钮配置",prop:"buttonGroup",collapse:!1,column:q},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],serviceTask:[{label:"基本配置",prop:"baseGroup",column:V},{label:"服务配置",prop:"serviceGroup",column:oe},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],circulateTask:[{label:"基本配置",prop:"baseGroup",column:V},{label:"传阅配置",prop:"circulateGroup",column:Y},{label:"按钮配置",prop:"buttonGroup",collapse:!1,column:q},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:P}],sequenceFlow:[{label:"基本配置",prop:"baseGroup",column:V},{label:"条件配置",prop:"sequenceFlowGroup",column:ae},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],parallelGateway:[{label:"基本配置",prop:"baseGroup",column:V},{label:"网关配置",prop:"baseGroup",column:Z}],process:[{label:"流程配置",prop:"baseGroup",column:le},{label:"流水号配置",prop:"serialGroup",column:te},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],group:[{label:"基本配置",prop:"baseGroup",column:V},{label:"多实例配置",prop:"multiInstanceGroup",collapse:!1,column:S},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],note:[{label:"基本配置",prop:"baseGroup",column:ee}]},je=Object.freeze(Object.defineProperty({__proto__:null,assigneeColumn:H,baseColumn:V,buttonColumn:q,circulateColumn:Y,defaultGroup:Ue,defaultOptions:Be,executionListenerColumn:Ve,formPropertyColumn:P,gatewayColumn:Z,multiInstanceColumn:S,noteColumn:ee,processColumn:le,propertyColumn:x,sequenceFlowColumn:ae,serialColumn:te,serviceTaskColumn:oe,taskListenerColumn:Pe,timeLimitColumn:Fe,userTaskColumn:ne},Symbol.toStringTag,{value:"Module"}));export{z as A,je as B,ve as a,Se as b,N as c,Ue as d,Be as e,H as f,V as g,q as h,J as i,Y as j,Ve as k,P as l,Q as m,Z as n,S as o,ee as p,le as q,x as r,ae as s,te as t,qe as u,oe as v,Pe as w,Fe as x,ne as y,X as z};
