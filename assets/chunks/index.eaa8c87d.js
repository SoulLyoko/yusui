import{c7 as Ce,cj as R,bw as q,bx as ue}from"../composables_use-crud_index.md.5c097962.js";import{_ as he,a6 as re,a5 as xe}from"./index.vue_vue_type_script_setup_true_lang.42a6ca0d.js";import{f as M,c as Z,D as m,h as v,A as k,u as i,af as B,r as D,i as N,G as p,B as o,k as C,aq as z,ar as A,F as L,b as j,w as ie,aI as se,z as W,t as K,C as O,L as Y,a1 as de,n as ae,al as $e,d as Oe,j as Ie}from"./framework.6c76c79f.js";import{r as Me}from"./axios.8973be50.js";import{a as Ue,_ as Ne}from"./index.vue_vue_type_script_setup_true_lang.c6d362ed.js";import{d as Be}from"./data.ee8ef805.js";import{a as Fe}from"../flow-design_flow-modeler_index.md.5ac41c23.js";import{d as G}from"./theme.22e7a177.js";import"../app.c56750be.js";import"../components_basic-container_index.md.c2902401.js";import"../components_icon-select_index.md.5999308f.js";import"../components_index.md.43b501f2.js";import"../components_v-text_index.md.7d48616e.js";import"../composables_index.md.597fdd4c.js";import"../eslint-config_index.md.4cfe78e4.js";import"../flow-design_flow-viewer_index.md.dfcca5c1.js";import"../flow-design_index.md.3941a9f8.js";import"../flow-pages_flow-manage_index.md.9fb56950.js";import"../flow-pages_flow-template_index.md.91ba6131.js";import"../flow-pages_form-template_index.md.6956dabe.js";import"../flow-pages_index.md.8878ab87.js";import"../flow-pages_workbench_index.md.7ca76f06.js";import"../form-design_demo.md.c49a3eb1.js";import"../form-design_index.md.454afd6f.js";import"../guide_changelog.md.c778465a.js";import"../guide_start.md.af46786e.js";import"../index.md.86a560ec.js";import"../plugins_avue-patch_index.md.24b1b518.js";import"../plugins_env-dts_index.md.bfb63ee5.js";import"../plugins_index.md.f143dffe.js";import"../plugins_load-proxy_index.md.37974852.js";import"../plugins_uni-ui-patch_index.md.9d0386e8.js";import"../plugins_uview-patch_index.md.4541b0e0.js";import"../prettier-config_index.md.5a7d4d11.js";import"../types_avue_index.md.bdb5e61c.js";import"../utils_date_dateFormat.md.95a0ccc9.js";import"../utils_date_durationFormat.md.4812386a.js";import"../utils_emitter_mittAsync.md.06e446b4.js";import"../utils_file_downloadFile.md.443e622e.js";import"../utils_file_getFileName.md.07f04ee5.js";import"../utils_index.md.070bbed1.js";import"../utils_math_index.md.fa407fa4.js";import"../utils_object_filterObj.md.3ea17155.js";import"../utils_object_filterObjDeep.md.6105a7f1.js";import"../utils_object_getDataType.md.af302376.js";import"../utils_string_deserialize.md.df3c79a3.js";import"../utils_string_serialize.md.52ada63d.js";import"../utils_string_uuid.md.3777921e.js";import"../utils_tool_awaitTo.md.3e8c5a8a.js";import"../utils_tool_sleep.md.24e74816.js";import"../utils_tree_buildTree.md.c49d7f11.js";import"../utils_tree_filterTree.md.10578652.js";import"../utils_tree_findTree.md.a798ca70.js";import"../utils_tree_flatTree.md.1269767c.js";import"../utils_tree_treeMap.md.a3a60c1c.js";import"./vue.runtime.esm-bundler.e3f0d845.js";const Se={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"表单标识",prop:"formKey"},{label:"表单名称",prop:"formName"},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},ee=M({__name:"index",props:{modelValue:null,view:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:d}){const c=e,r=Z({get(){return c.modelValue?re(c.modelValue):{menuBtn:!1,span:24}},set(a){d("update:modelValue",xe(a,{useJson5:!1}))}});return(a,l)=>{const u=m("avue-form");return e.view?(v(),k(u,{key:0,modelValue:{},option:i(r)},null,8,["option"])):(v(),k(i(he),{key:1,modelValue:i(r),"onUpdate:modelValue":l[0]||(l[0]=n=>B(r)?r.value=n:null)},null,8,["modelValue"]))}}});var Ke=Me();const Le=Ce(Ke),h=Le.create();h.interceptors.response.use(e=>e.data);function pe(e){return h.get("/sapier-flow/dev-form/list",{params:e})}function Te(e){return h.post("/sapier-flow/dev-form/submit",e)}function Ee(e){return h.post("/sapier-flow/dev-form/submit",e)}function Re(e){return h.post("/sapier-flow/dev-form/remove",{},{params:{ids:e}})}const je=M({__name:"index",setup(e){const d={rowKey:"id",getList:pe,create:Te,update:Ee,remove:Re},{bindVal:c,crudStateRefs:{formData:r},getDataList:a,handleUpdate:l}=R({crudOption:d,tableOption:Se,mockCache:"form-template"});a();const u=D(!1);async function n(_){r.value={..._},u.value=!0}async function g(){await l(r.value,NaN,()=>u.value=!1,()=>{})}return(_,s)=>{const w=m("el-button"),y=m("avue-crud"),f=m("el-dialog");return v(),N(L,null,[p(y,z(A(i(c))),{formOption:o(({row:t})=>[p(w,{type:"primary",text:"",icon:"el-icon-crop",onClick:V=>n(t)},{default:o(()=>[C("设计")]),_:2},1032,["onClick"])]),_:1},16),p(f,{modelValue:u.value,"onUpdate:modelValue":s[2]||(s[2]=t=>u.value=t),title:`表单设计-${i(r).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[p(w,{type:"primary",onClick:g},{default:o(()=>[C("保存")]),_:1}),p(w,{onClick:s[1]||(s[1]=t=>u.value=!1)},{default:o(()=>[C("取消")]),_:1})]),default:o(()=>[p(ee,{modelValue:i(r).formOption,"onUpdate:modelValue":s[0]||(s[0]=t=>i(r).formOption=t),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Pe={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,span:24,column:[{label:"流程标识",prop:"flowKey"},{label:"流程名称",prop:"flowName"},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},qe=Fe,le=M({__name:"index",props:{modelValue:null,view:{type:Boolean}},emits:["update:modelValue"],setup(e,{emit:d}){const c=e,r=Z({get(){let l=Be();return typeof c.modelValue=="string"&&c.modelValue?l=JSON.parse(c.modelValue):typeof c.modelValue=="object"&&Object.keys(c.modelValue)&&(l=c.modelValue),l},set(l){d("update:modelValue",JSON.stringify(l))}}),a=D();return j(()=>{var l,u;(l=a.value)==null||l.on("anchor:dragstart",()=>{var n;(n=a.value)==null||n.updateEditConfig({stopMoveGraph:!0})}),(u=a.value)==null||u.on("anchor:dragend",()=>{var n;(n=a.value)==null||n.updateEditConfig({stopMoveGraph:!1})})}),(l,u)=>e.view?(v(),k(i(Ue),{key:0,modelValue:i(r),"onUpdate:modelValue":u[0]||(u[0]=n=>B(r)?r.value=n:null)},null,8,["modelValue"])):(v(),k(i(Ne),{key:1,lf:a.value,"onUpdate:lf":u[1]||(u[1]=n=>a.value=n),modelValue:i(r),"onUpdate:modelValue":u[2]||(u[2]=n=>B(r)?r.value=n:null),formOptions:i(qe),formWidth:"30%"},null,8,["lf","modelValue","formOptions"]))}});function fe(e){return h.get("/sapier-flow/dev-flow/list",{params:e})}function ze(e){return h.post("/sapier-flow/dev-flow/submit",e)}function Ae(e){return h.post("/sapier-flow/dev-flow/submit",e)}function We(e){return h.post("/sapier-flow/dev-flow/remove",{},{params:{ids:e}})}const Ge=M({__name:"index",setup(e){const d={rowKey:"id",getList:fe,create:ze,update:Ae,remove:We},{bindVal:c,crudStateRefs:{formData:r},getDataList:a,handleUpdate:l}=R({crudOption:d,tableOption:Pe,mockCache:"model-template"});a();const u=D(!1);async function n(_){r.value=_,u.value=!0}async function g(){await l(r.value,NaN,()=>u.value=!1,()=>{})}return(_,s)=>{const w=m("el-button"),y=m("avue-crud"),f=m("el-dialog");return v(),N(L,null,[p(y,z(A(i(c))),{flowData:o(({row:t})=>[p(w,{type:"primary",text:"",icon:"el-icon-crop",onClick:V=>n(t)},{default:o(()=>[C("设计")]),_:2},1032,["onClick"])]),_:1},16),p(f,{modelValue:u.value,"onUpdate:modelValue":s[2]||(s[2]=t=>u.value=t),title:`模型设计-${i(r).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[p(w,{type:"primary",onClick:g},{default:o(()=>[C("保存")]),_:1}),p(w,{onClick:s[1]||(s[1]=t=>u.value=!1)},{default:o(()=>[C("取消")]),_:1})]),default:o(()=>[p(le,{modelValue:i(r).flowData,"onUpdate:modelValue":s[0]||(s[0]=t=>i(r).flowData=t),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}});function Je(e){return h.get("/sapier-flow/flow-category/list",{params:e})}function He(e){return h.post("/sapier-flow/flow-category/save",e)}function Qe(e){return h.post("/sapier-flow/flow-category/update",e)}function Xe(e){return h.post("/sapier-flow/flow-category/remove",{},{params:{ids:e}})}const ne={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},Ye=M({__name:"index",emits:["node-click"],setup(e,{emit:d}){const c={rowKey:"id",getList:Je,create:He,update:Qe,remove:Xe,dataPath:"res.data"},{crudStateRefs:{formData:r,tableData:a},getDataList:l,handleSave:u,handleUpdate:n,handleDel:g}=R({crudOption:c,tableOption:ne,pageOption:{pageSize:20},mockCache:"flow-category"});l();function _(y,f,t,V){u(f,t,V)}function s(y,f,t,V){n(f,NaN,t,V)}function w(y){g(y,NaN)}return(y,f)=>{const t=m("avue-tree");return v(),k(t,{modelValue:i(r),"onUpdate:modelValue":f[0]||(f[0]=V=>B(r)?r.value=V:null),option:i(ne),data:i(a),onNodeClick:f[1]||(f[1]=V=>d("node-click",V)),onSave:_,onUpdate:s,onDel:w},null,8,["modelValue","option","data"])}}}),oe={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"groupId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"icon",component:"icon-select"},{label:"流程描述",prop:"remarks"}]};function Ze(e){return h.get("/sapier-flow/flow-definition/list",{params:e})}function ce(e){return h.get("/sapier-flow/flow-definition/detail",{params:e})}function el(e){return h.post("/sapier-flow/flow-definition/save",e)}function ll(e){return h.post("/sapier-flow/flow-definition/update",e)}function me(e){return h.post("/sapier-flow/flow-definition/deployFlow",e)}function ol(e){return h.get("/sapier-flow/flow-deploy/list",{params:e})}function ve(e){return h.get("/sapier-flow/flow-deploy/detail",{params:e})}function _e(e){return h.post("/sapier-flow/flow-deploy/update",e)}function tl(){return h.get("/sapier-flow/flow-run/queryPublishFlowList")}function we(e){return new Promise((d,c)=>{(B(e)?e.value:e).validate((a,l)=>{a?(l(),d(a)):c(a)})})}const al=W("span",null,"流程设计",-1),nl={key:0},ul={key:1},rl={style:{height:"calc(100vh - 144px)"}},il=M({__name:"index",props:{modelValue:null,visible:{type:Boolean}},emits:["close"],setup(e,{emit:d}){const r=G(e),{visible:a,modelValue:l}=r,u=["流程信息","表单设计","模型设计","完成"],n=D(!1);ie(a,async x=>{if(!x)return;const{flowModuleId:b}=l.value,{flowDeployId:$}=l.value;try{n.value=!0;let S={};$?S=await ve({flowDeployId:$}):b&&(S=await ce({flowModuleId:b})),l.value=S.data}finally{n.value=!1}},{immediate:!0});const g=D([]),_=D([]);pe({size:-1}).then(x=>g.value=x.data.records),fe({size:-1}).then(x=>_.value=x.data.records);const s=D(0),w=Z(()=>{var x,b;return s.value===1?((x=g.value)==null?void 0:x.map($=>({label:$.formName,value:$.formOption})))??[]:s.value===2?((b=_.value)==null?void 0:b.map($=>({label:$.flowName,value:$.flowData})))??[]:[]});function y(x){s.value===1?l.value.formOption=x.value:s.value===2&&(l.value.flowData=x.value)}const f=D();async function t(x){s.value===0&&await we(f),n.value=!0;const{flowModuleId:b}=l.value,{flowDeployId:$}=l.value;try{$?await _e(l.value):b?await ll(l.value):await el(l.value).then(S=>{l.value.flowModuleId=S.data.flowModuleId}),q.success("保存成功")}finally{n.value=!1}typeof x=="number"?s.value=x:s.value++}async function V(){await ue.confirm("发布新版本，是否确认？","提示"),n.value=!0,me({flowModuleId:l.value.flowModuleId}).then(()=>{q.success("发布成功")}).finally(()=>{n.value=!1})}function U(){a.value=!1,s.value=0,l.value={},d("close")}return(x,b)=>{const $=m("el-link"),S=m("el-dropdown-item"),J=m("el-dropdown-menu"),P=m("el-dropdown"),F=m("el-col"),H=m("el-step"),ye=m("el-steps"),T=m("el-button"),ge=m("el-row"),be=m("avue-form"),Ve=m("el-result"),ke=m("el-dialog"),De=se("loading");return v(),k(ke,{modelValue:i(a),"onUpdate:modelValue":b[4]||(b[4]=I=>B(a)?a.value=I:null),fullscreen:"","show-close":!1,onClose:U},{header:o(()=>[p(ge,{align:"center",justify:"center"},{default:o(()=>[p(F,{span:5},{default:o(()=>{var I,E,Q,te;return[W("div",null,[al,(I=i(l))!=null&&I.flowName?(v(),N("span",nl," - "+K((E=i(l))==null?void 0:E.flowName),1)):O("",!0),(Q=i(l))!=null&&Q.version?(v(),N("span",ul," - V"+K((te=i(l))==null?void 0:te.version),1)):O("",!0)]),i(w).length?(v(),k(P,{key:0},{dropdown:o(()=>[p(J,null,{default:o(()=>[(v(!0),N(L,null,Y(i(w),X=>(v(),k(S,{key:X.label,onClick:Dl=>y(X)},{default:o(()=>[C(K(X.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:o(()=>[p($,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[C("选择模板")]),_:1})]),_:1})):O("",!0)]}),_:1}),p(F,{span:14},{default:o(()=>[p(ye,{active:s.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(v(),N(L,null,Y(u,(I,E)=>p(H,{key:E,title:I,onClick:Q=>t(E)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),p(F,{span:5,style:{"text-align":"right"}},{default:o(()=>[p(T,{disabled:s.value===0,loading:n.value,type:"primary",onClick:b[0]||(b[0]=I=>s.value--)},{default:o(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),p(T,{disabled:s.value===u.length-1,type:"primary",loading:n.value,onClick:t},{default:o(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),p(T,{onClick:U},{default:o(()=>[C("关闭")]),_:1})]),_:1})]),_:1})]),default:o(()=>[de((v(),N("div",rl,[s.value===0?(v(),k(be,{key:0,ref_key:"formRef",ref:f,modelValue:i(l),"onUpdate:modelValue":b[1]||(b[1]=I=>B(l)?l.value=I:null),option:i(oe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):O("",!0),s.value===1?(v(),k(ee,{key:1,modelValue:i(l).formOption,"onUpdate:modelValue":b[2]||(b[2]=I=>i(l).formOption=I)},null,8,["modelValue"])):O("",!0),s.value===2?(v(),k(le,{key:2,modelValue:i(l).flowData,"onUpdate:modelValue":b[3]||(b[3]=I=>i(l).flowData=I)},null,8,["modelValue"])):O("",!0),s.value===3?(v(),k(Ve,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[i(l).flowDeployId?O("",!0):(v(),k(T,{key:0,type:"primary",onClick:V},{default:o(()=>[C("发布")]),_:1})),p(T,{onClick:U},{default:o(()=>[C("关闭")]),_:1})]),_:1})):O("",!0)])),[[De,n.value]])]),_:1},8,["modelValue"])}}}),sl=W("span",null,"流程查看",-1),dl={key:0},pl={key:1},fl=M({__name:"index",props:{modelValue:null,visible:{type:Boolean}},setup(e){const c=G(e),{visible:r,modelValue:a}=c,l=D("form"),u=D(!1);ie(r,async g=>{if(!g)return;const{flowModuleId:_}=a.value,{flowDeployId:s}=a.value;try{u.value=!0;let w={};s?w=await ve({flowDeployId:s}):_&&(w=await ce({flowModuleId:_})),a.value={...w.data}}finally{u.value=!1}},{immediate:!0});function n(){a.value={},l.value="form"}return(g,_)=>{const s=m("el-tab-pane"),w=m("el-tabs"),y=m("el-dialog"),f=se("loading");return v(),k(y,{modelValue:i(r),"onUpdate:modelValue":_[3]||(_[3]=t=>B(r)?r.value=t:null),width:"60%",top:"0",onClose:n},{header:o(()=>{var t,V,U,x;return[sl,(t=i(a))!=null&&t.flowName?(v(),N("span",dl," - "+K((V=i(a))==null?void 0:V.flowName),1)):O("",!0),(U=i(a))!=null&&U.version?(v(),N("span",pl," - V"+K((x=i(a))==null?void 0:x.version),1)):O("",!0)]}),default:o(()=>[de((v(),k(w,{modelValue:l.value,"onUpdate:modelValue":_[2]||(_[2]=t=>l.value=t)},{default:o(()=>[p(s,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[l.value==="form"&&i(a).formOption?(v(),k(ee,{key:0,ref:"formRef",modelValue:i(a).formOption,"onUpdate:modelValue":_[0]||(_[0]=t=>i(a).formOption=t),view:""},null,8,["modelValue"])):O("",!0)]),_:1}),p(s,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[l.value==="flow"?(v(),k(le,{key:0,modelValue:i(a).flowData,"onUpdate:modelValue":_[1]||(_[1]=t=>i(a).flowData=t),view:""},null,8,["modelValue"])):O("",!0)]),_:1})]),_:1},8,["modelValue"])),[[f,u.value]])]),_:1},8,["modelValue"])}}}),cl={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:300,column:[...oe.column,{label:"流程主版本",prop:"mainVersion",formatter(e,d){return d?`V${d||""}`:""}}]},ml=M({__name:"index",props:{groupId:null},emits:["add","view","edit","version"],setup(e,{emit:d}){const c=e,r={rowKey:"flowModuleId",getList:Ze},{bindVal:a,crudStateRefs:{searchForm:l},getDataList:u}=R({crudOption:r,tableOption:cl,searchForm:{groupId:c.groupId}});j(()=>{l.value.groupId=c.groupId??"",u()});const n=D(!1);async function g(_){await ue.confirm("发布新版本，是否确认？","提示",{type:"success"}),n.value=!0,me({flowModuleId:_.flowModuleId}).then(()=>{q.success("部署成功"),u()}).finally(()=>{n.value=!1})}return(_,s)=>{const w=m("el-button"),y=m("avue-crud");return v(),k(y,z(A(i(a))),{"menu-left":o(()=>[p(w,{type:"primary",icon:"el-icon-plus",onClick:s[0]||(s[0]=f=>d("add"))},{default:o(()=>[C("新增")]),_:1})]),menu:o(({row:f})=>[p(w,{loading:n.value,type:"text",icon:"el-icon-view",onClick:t=>d("view",f)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["loading","onClick"]),p(w,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:t=>d("edit",f)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["loading","onClick"]),p(w,{loading:n.value,type:"text",icon:"el-icon-upload",onClick:t=>g(f)},{default:o(()=>[C(" 发布 ")]),_:2},1032,["loading","onClick"]),p(w,{loading:n.value,type:"text",icon:"el-icon-switch",onClick:t=>d("version",f)},{default:o(()=>[C(" 版本管理 ")]),_:2},1032,["loading","onClick"])]),_:1},16)}}}),vl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:4,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:250,column:[...oe.column,{label:"流程版本",prop:"version",formatter(e,d){return d?`V${d||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},_l=M({__name:"index",props:{flowModuleId:null},emits:["back","view","edit"],setup(e,{emit:d}){const c=e,r={rowKey:"flowDeloyId",getList:ol,dataPath:"res.data"},{bindVal:a,crudStateRefs:{searchForm:l},getDataList:u}=R({crudOption:r,tableOption:vl});j(()=>{c.flowModuleId&&(l.value.flowModuleId=c.flowModuleId,u())});const n=D(!1);function g(_){n.value=!0,_e({flowDeployId:_.flowDeployId,flowModuleId:_.flowModuleId,mainVersion:1}).then(()=>{q.success("设置成功"),u()}).finally(()=>{n.value=!1})}return(_,s)=>{const w=m("el-button"),y=m("avue-crud");return v(),k(y,z(A(i(a))),{"menu-left":o(()=>[p(w,{loading:n.value,type:"primary",icon:"el-icon-arrow-left",onClick:s[0]||(s[0]=f=>d("back"))},{default:o(()=>[C("返回")]),_:1},8,["loading"])]),menu:o(({row:f})=>[p(w,{loading:n.value,type:"text",icon:"el-icon-view",onClick:t=>d("view",f)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["loading","onClick"]),p(w,{loading:n.value,type:"text",icon:"el-icon-edit",onClick:t=>d("edit",f)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["loading","onClick"]),p(w,{loading:n.value,disabled:f.mainVersion===1,type:"text",icon:"el-icon-switch",onClick:t=>g(f)},{default:o(()=>[C(" 设为主版本 ")]),_:2},1032,["loading","disabled","onClick"])]),_:1},16)}}}),wl=M({__name:"index",setup(e){const d=D("definition"),c=D({}),r=D(""),a=D("");function l(t){r.value===t.id?r.value="":r.value=t.id}const u=D(!1),n=D(!1);function g(){c.value={},u.value=!0}function _(t){c.value=t,u.value=!0}function s(t){c.value=t,n.value=!0}function w(t){a.value=t.flowModuleId||"",d.value="deploy"}function y(){a.value="",d.value="definition"}async function f(){const t=d.value;await ae(),d.value="",await ae(),d.value=t+""}return(t,V)=>{const U=m("el-col"),x=m("el-row");return v(),k(x,{gutter:20},{default:o(()=>[p(U,{span:4},{default:o(()=>[p(Ye,{onNodeClick:l})]),_:1}),p(U,{span:20},{default:o(()=>[d.value==="definition"?(v(),k(ml,{key:0,groupId:r.value,onAdd:g,onEdit:_,onView:s,onVersion:w},null,8,["groupId"])):O("",!0),d.value==="deploy"?(v(),k(_l,{key:1,flowModuleId:a.value,onEdit:_,onView:s,onBack:y},null,8,["flowModuleId"])):O("",!0),p(il,{modelValue:c.value,"onUpdate:modelValue":V[0]||(V[0]=b=>c.value=b),visible:u.value,"onUpdate:visible":V[1]||(V[1]=b=>u.value=b),onClose:f},null,8,["modelValue","visible"]),p(fl,{modelValue:c.value,"onUpdate:modelValue":V[2]||(V[2]=b=>c.value=b),visible:n.value,"onUpdate:visible":V[3]||(V[3]=b=>n.value=b)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}});function yl(e){return h.get("/sapier-flow/flow-run/queryPublishFlowDetail",{params:e})}function gl(e){return h.post("/sapier-flow/flow-run/startProcess",e)}const bl=M({props:{modelValue:{type:Object,default:()=>({})},flowDetail:{type:Object,default:()=>({})},detail:{type:Boolean}},setup(e){const{modelValue:d}=G(e,void 0,{passive:!0,deep:!0}),c=D({}),{proxy:r}=Oe(),a=D({});j(()=>{const{formOption:n}=e.flowDetail.process??{};a.value=re.bind(r)(n||'{"menuBtn":false}'),a.value.detail=!!e.detail});const l=D();function u(){return we(l)}return{form:d,option:a,defaults:c,formRef:l,validate:u}},render(){return $e(m("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),Vl=M({__name:"index",props:{flowKey:null,visible:{type:Boolean},flowDetail:null,processDetail:null,modelValue:null,formOption:null,loading:{type:Boolean},activeTab:null},setup(e){const d=e,c=G(d,void 0,{passive:!0,deep:!0}),{visible:r,flowDetail:a,processDetail:l,modelValue:u,loading:n,activeTab:g}=c;function _(y){g.value="form",a.value={},u.value={},y==null||y()}j(()=>{const{flowKey:y}=d;y&&r.value&&(_(),n.value=!0,yl({flowKey:y}).then(f=>{a.value=f.data,l.value=f.data.process,u.value=f.data.formData||{}}).finally(()=>{n.value=!1}))});const s=D();async function w(){var f;await((f=s.value)==null?void 0:f.validate());const y=Object.entries(u.value||{}).filter(([t])=>!t.startsWith("$")).map(([t,V])=>({key:t,value:V}));gl({flowKey:d.flowKey,variables:y})}return(y,f)=>{var P;const t=m("el-skeleton"),V=m("el-button"),U=m("el-header"),x=m("el-tab-pane"),b=m("el-tabs"),$=m("el-main"),S=m("el-container"),J=m("el-drawer");return v(),k(J,{modelValue:i(r),"onUpdate:modelValue":f[2]||(f[2]=F=>B(r)?r.value=F:null),title:(P=i(l))==null?void 0:P.flowName,"destroy-on-close":"","before-close":_,size:"60%"},{default:o(()=>[i(n)?(v(),k(t,{key:0})):(v(),k(S,{key:1},{default:o(()=>[p(U,{height:"40px",style:{padding:"0"}},{default:o(()=>[p(V,{type:"primary",onClick:w},{default:o(()=>[C("发送")]),_:1})]),_:1}),p($,{style:{padding:"0"}},{default:o(()=>[p(b,{modelValue:i(g),"onUpdate:modelValue":f[1]||(f[1]=F=>B(g)?g.value=F:null)},{default:o(()=>{var F;return[(F=i(l))!=null&&F.formPath?Ie(y.$slots,"default",{key:0}):(v(),k(x,{key:1,label:"审批信息",name:"form"},{default:o(()=>[p(bl,{ref_key:"formRef",ref:s,modelValue:i(u),"onUpdate:modelValue":f[0]||(f[0]=H=>B(u)?u.value=H:null),flowDetail:i(a)},null,8,["modelValue","flowDetail"])]),_:1}))]}),_:3},8,["modelValue"])]),_:3})]),_:3}))]),_:3},8,["modelValue","title"])}}}),kl=M({__name:"index",setup(e){const d=D([]);tl().then(l=>{d.value=l.data});const c=D(!1),r=D("");function a(l){r.value=l.flowKey,c.value=!0}return(l,u)=>{const n=m("el-button");return v(),N(L,null,[W("div",null,[(v(!0),N(L,null,Y(d.value,g=>(v(),k(n,{key:g.flowKey,type:"primary",plain:"",onClick:_=>a(g)},{default:o(()=>[C(K(g.flowName),1)]),_:2},1032,["onClick"]))),128))]),p(Vl,{visible:c.value,"onUpdate:visible":u[0]||(u[0]=g=>c.value=g),flowKey:r.value},null,8,["visible","flowKey"])],64)}}}),$o={install(e){e.component("FormTemplate",je),e.component("FlowTemplate",Ge),e.component("FlowManage",wl),e.component("Workbench",kl)}};export{wl as FlowManage,Ge as FlowTemplate,je as FormTemplate,kl as Workbench,$o as default};
