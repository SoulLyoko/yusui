import{Q as G,aM as ut,aN as Pt,aO as ne,aP as Ut,al as Et,an as At,aQ as Z,aR as Kt,K as Mt,R as de}from"../composables_use-crud_index.md.78467a23.js";import{I as se}from"../components_icon-select_index.md.445f9467.js";import{X as Me,B as De,r as I,s as he,d as U,e as J,w as pe,i as ee,u as k,n as _e,Y as Bt,h as A,H as V,j as T,k as E,R as X,F as W,D as $,E as w,J as g,p as P,q as j,a3 as tt,C as Q,_ as Te,G as B,K as jt,l as Ht,O as ot,b as it,L as zt,a5 as Ue,aA as Wt,M as Yt,ai as oe,aj as le,m as qt,aM as ct,aa as dt,I as Qt}from"./framework.19abbf41.js";import{a as Gt,c as Jt,e as Xt}from"../flow-design_demo.md.59eafbe3.js";import"./index.e7852450.js";import{t as pt,P as Zt,f as eo,M as mt,L as to,u as oo}from"./vuedraggable.umd.4d1557de.js";import{u as me,w as xe,d as lo,e as ao}from"./theme.df9598b1.js";import{p as no}from"../components_input-tree_index.md.585521e0.js";import{d as ft}from"./differenceBy.7f5ae056.js";import{a9 as so,au as ro,aj as ge}from"./index.daca2715.js";import{J as uo,K as io}from"../app.ec3531a1.js";import"./vue.runtime.esm-bundler.6ea500c1.js";import"../components_index.md.4d4b77b3.js";import"../components_v-text_index.md.ab7897dc.js";import"../composables_index.md.8102a498.js";import"../flow-design_index.md.267dc74d.js";import"../flow-pages_index.md.b332c49f.js";import"../flow-pages_pages_flow-button_index.md.cff1c959.js";import"../flow-pages_pages_flow-manage_index.md.3fe7431a.js";import"../flow-pages_pages_flow-ops_index.md.740e87f3.js";import"../flow-pages_pages_flow-param_index.md.38d922b3.js";import"../flow-pages_pages_flow-template_index.md.ab1c2131.js";import"../flow-pages_pages_flow-workbench_index.md.3abb69f4.js";import"../flow-pages_pages_form-template_index.md.d2944a19.js";import"../flow-pages_pages_table-template_index.md.d5d619a4.js";import"../form-design_demo.md.6bd3bed6.js";import"../form-design_index.md.e65b4571.js";import"../guide_changelog.md.dd2417b7.js";import"../guide_start.md.63241896.js";import"../index.md.10a29696.js";import"../plugins_avue-patch_index.md.4142a054.js";import"../plugins_compatible-tips_index.md.55e466cf.js";import"../plugins_env-dts_index.md.5446c6e1.js";import"../plugins_index.md.06e5bca9.js";import"../plugins_load-proxy_index.md.97000f94.js";import"../plugins_setup-extend_index.md.631ee47a.js";import"../plugins_uni-ui-patch_index.md.2504b2d2.js";import"../plugins_uview-patch_index.md.6ddb40f0.js";import"../types_avue_index.md.d294f23a.js";import"../types_index.md.b2ecc5b3.js";import"../utils_date_dateFormat.md.d75b5beb.js";import"../utils_date_durationFormat.md.3452ef38.js";import"../utils_emitter_mittAsync.md.c888c2ea.js";import"../utils_index.md.7db024e0.js";import"../utils_math_index.md.dfd5c6ea.js";import"../utils_object_filterObj.md.f0dc97c3.js";import"../utils_object_filterObjDeep.md.ff4b0903.js";import"../utils_object_getDataType.md.1d2816c5.js";import"../utils_string_deserialize.md.6296f7ed.js";import"../utils_string_serialize.md.547ef93e.js";import"../utils_string_uuid.md.e68bfa8c.js";import"../utils_tool_awaitTo.md.93c39e8e.js";import"../utils_tool_enumToDic.md.cff2a41a.js";import"../utils_tool_sleep.md.76753705.js";import"../utils_tree_buildTree.md.22d96cae.js";import"../utils_tree_filterTree.md.370e7afb.js";import"../utils_tree_findTree.md.f313e2c8.js";import"../utils_tree_flatTree.md.d34a1d9c.js";import"../utils_tree_treeMap.md.334d787b.js";const co={},po=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),mo=()=>co,ae=e=>e,Ee=e=>Array.isArray(e),Be=e=>e!==null&&typeof e=="object",je=e=>e instanceof Function,we=e=>e==null,He=typeof window>"u",vt=()=>{var e;return He||we((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},fo=()=>{var e,t;return(e=!He&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Se=()=>new Promise(()=>{}),te=e=>ee(e)?e.value:e,vo=e=>Be(e)?Object.assign(Ee(e)?[]:{},e):e,ke=new Map,_o=e=>we(e)?void 0:ke.get(e),wo=(e,t,o)=>{const p=ke.get(e);p!=null&&p.timer&&clearTimeout(p.timer);const n=setTimeout(()=>ke.delete(e),t);ke.set(e,{...o,timer:n})};function _t(e,t,o){let p,n,a,c,l,s,m=0,_=!1,r=!1,d=!0;const i=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Be(o)&&(_=!!o.leading,r="maxWait"in o,a=r?Math.max(+o.maxWait||0,t):a,d="trailing"in o?!!o.trailing:d);function y(C){const x=p,L=n;return p=n=void 0,m=C,c=e.apply(L,x),c}function b(C,x){return i?(window.cancelAnimationFrame(l),window.requestAnimationFrame(C)):setTimeout(C,x)}function u(C){if(i)return window.cancelAnimationFrame(C);clearTimeout(C)}function v(C){return m=C,l=b(D,t),_?y(C):c}function f(C){const x=C-s,L=C-m,K=t-x;return r?Math.min(K,a-L):K}function h(C){const x=C-s,L=C-m;return s===void 0||x>=t||x<0||r&&L>=a}function D(){const C=Date.now();if(h(C))return O(C);l=b(D,f(C))}function O(C){return l=void 0,d&&p?y(C):(p=n=void 0,c)}function F(){l!==void 0&&u(l),m=0,p=s=n=l=void 0}function N(){return l===void 0?c:O(Date.now())}function R(){return l!==void 0}function S(){const C=Date.now(),x=h(C);for(var L=arguments.length,K=new Array(L),H=0;H<L;H++)K[H]=arguments[H];if(p=K,n=this,s=C,x){if(l===void 0)return v(s);if(r)return l=b(D,t),y(s)}return l===void 0&&(l=b(D,t)),c}return S.cancel=F,S.flush=N,S.pending=R,S}function bo(e,t,o){let p=!0,n=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Be(o)&&(p="leading"in o?!!o.leading:p,n="trailing"in o?!!o.trailing:n),_t(e,t,{leading:p,trailing:n,maxWait:t})}var yo=ae((e,t)=>{let{debounceInterval:o,debounceOptions:p,manual:n}=t;const a=I(!1),c=I(),l=U(()=>p),s=U(()=>te(o)),m=I(e.context.runAsync);return n||(a.value=!0),J(_=>{we(s.value)||(c.value=_t(r=>r(),s.value,l.value),e.context.runAsync=function(){for(var r=arguments.length,d=new Array(r),i=0;i<r;i++)d[i]=arguments[i];return new Promise((y,b)=>{a.value?(a.value=!1,m.value(...d).then(y).catch(b)):c.value(()=>{m.value(...d).then(y).catch(b)})})},_(()=>{var r;(r=c.value)===null||r===void 0||r.cancel(),e.context.runAsync=m.value}))}),{onCancel(){var _;(_=c.value)===null||_===void 0||_.cancel()}}}),go=ae((e,t)=>{let{errorRetryCount:o=0,errorRetryInterval:p=0}=t;const n=I(),a=I(0),c=U(()=>te(o)),l=U(()=>te(p));let s=!1;const m=()=>{a.value=0},_=U(()=>{if(l.value)return l.value;const i=1e3,y=1,b=9,u=Math.floor(Math.random()*2**Math.min(a.value,b)+y);return i*u}),r=()=>{let i;const y=c.value===-1,b=a.value<c.value;return(y||b)&&(y||(a.value+=1),i=setTimeout(()=>{s=!0,e.context.refresh()},_.value)),()=>i&&clearTimeout(i)},d=()=>{n.value&&n.value()};return{onBefore(){s||m(),s=!1,d()},onSuccess(){m()},onError(){n.value=r()},onCancel(){m(),d()}}}),ho=ae((e,t)=>{let{ready:o=I(!0),manual:p,defaultParams:n=[]}=t;return pe(o,a=>{!p&&a&&e.context.run(...n)},{flush:"sync"}),{onBefore(){if(!(je(o)?o():o.value))return e.loading.value=!1,{isBreak:!0}}}}),ko=ae((e,t)=>{let{refreshDeps:o,refreshDepsAction:p,manual:n}=t;if(o===void 0||Ee(o)&&o.length===0)return{};const a=Ee(o)?o:[o];return pe(a,()=>{p?p():!n&&e.context.refresh()}),{}}),Co=ae((e,t)=>{let{throttleInterval:o,throttleOptions:p}=t;const n=I(),a=U(()=>te(o)),c=U(()=>p),l=I(e.context.runAsync);return J(s=>{if(we(o))return{};n.value=bo(m=>m(),a.value,c.value),e.context.runAsync=function(){for(var m=arguments.length,_=new Array(m),r=0;r<m;r++)_[r]=arguments[r];return new Promise((d,i)=>{n.value(()=>{l.value(..._).then(d).catch(i)})})},s(()=>{var m;(m=n.value)===null||m===void 0||m.cancel(),e.context.runAsync=l.value})}),{onCancel(){var s;(s=n.value)===null||s===void 0||s.cancel()}}});const Vo=(e,t)=>o=>{Object.keys(o).forEach(p=>{e[p].value=o[p]}),t.forEach(p=>p(e))},Do=(e,t)=>()=>{let o=t;for(let p=e.length;p-- >0;)o=e[p](o);return o()},To=(e,t,o)=>{var p,n;const{initialData:a,onSuccess:c,onError:l,onBefore:s,onAfter:m}=t,_=I((p=o==null?void 0:o.loading)!==null&&p!==void 0?p:!1),r=he((n=o==null?void 0:o.data)!==null&&n!==void 0?n:a),d=he(o==null?void 0:o.error),i=I(o==null?void 0:o.params),y=I([]),b=he("pending"),u={},v=Vo({status:b,loading:_,data:r,error:d,params:i},[]),f=function(D){for(var O=arguments.length,F=new Array(O>1?O-1:0),N=1;N<O;N++)F[N-1]=arguments[N];if(D==="onQuery"){const R=y.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:Do(R,F[0])()}}else{const R=y.value.map(S=>{var C;return(C=S[D])===null||C===void 0?void 0:C.call(S,...F)});return Object.assign({},...R)}},h=I(0);return u.runAsync=async function(){for(var D=arguments.length,O=new Array(D),F=0;F<D;F++)O[F]=arguments[F];v({loading:!0,params:O,status:"pending"}),h.value+=1;const N=h.value,{isBreak:R,breakResult:S=Se()}=f("onBefore",O);if(R)return v({status:"settled"}),S;s==null||s(O);try{const C=()=>new Promise(K=>K(e(...i.value)));let{servicePromise:x}=f("onQuery",C);x||(x=C());const L=await x;return N!==h.value?Se():(v({data:L,loading:!1,error:void 0,status:"settled"}),f("onSuccess",L,O),c==null||c(L,O),N===h.value&&f("onAfter",O,L,void 0),m==null||m(O),L)}catch(C){if(N!==h.value)return Se();throw v({loading:!1,error:C,status:"settled"}),f("onError",C,O),l==null||l(C,O),N===h.value&&f("onAfter",O,void 0,C),m==null||m(O),C}},u.run=function(){u.runAsync(...arguments).catch(D=>{l||console.error(D)})},u.cancel=()=>{h.value+=1,v({loading:!1}),f("onCancel")},u.refresh=()=>{u.run(...i.value||[])},u.refreshAsync=()=>u.runAsync(...i.value||[]),u.mutate=D=>{const O=je(D)?D(r.value):D,F=vo(O);v({data:F}),f("onMutate",F)},{status:b,loading:_,data:r,error:d,params:i,plugins:y,context:u}};function xo(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const p=Me(po,{}),n={...mo(),...p,...t},{manual:a=!1,defaultParams:c=[]}=n,l=To(e,n);if(l.plugins.value=o.map(s=>s(l,n)),!a){const s=l.params.value||c;l.context.run(...s)}return De(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const Ce=new Map,Lo=(e,t)=>{Ce.set(e,t),t.then(o=>(Ce.delete(e),o)).catch(()=>{Ce.delete(e)})},No=e=>Ce.get(e),ue=new Map,Io=(e,t)=>{ue.has(e)&&ue.get(e).forEach(o=>o(t))},Oo=(e,t)=>(ue.has(e)?ue.get(e).push(t):ue.set(e,[t]),()=>{const o=ue.get(e).indexOf(t);ue.get(e).splice(o,1)});var $o=ae((e,t)=>{let{cacheKey:o,cacheTime:p=6e5,staleTime:n=0,getCache:a,setCache:c}=t;if(!o)return{};const l=je(o)?o:()=>o,s=I(()=>{});let m;const _=v=>a?a(v):_o(v),r=(v,f,h)=>{c?c(v,h):wo(v,f,h),Io(v,h.data)},d=v=>n===-1||v+n>new Date().getTime(),i=(v,f)=>Object.prototype.hasOwnProperty.call(v,f),y=v=>{const f=l(v);return Oo(f,h=>{e.data.value=h})},b=l(),u=_(b);return u&&i(u,"data")&&(e.data.value=u.data,e.params.value=u.params),b&&(s.value=y()),De(()=>{s.value()}),{onBefore(v){const f=l(v),h=_(f);if(!h||!i(h,"data"))return{};if(d(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(v){const f=e.params.value,h=l(f);let D=No(h);return D&&D!==m?()=>D:(D=v(),m=D,Lo(h,D),()=>D)},onSuccess(v,f){const h=l(f);h&&(s.value(),r(h,p,{data:v,params:f,time:new Date().getTime()}),s.value=y(f))},onMutate(v){const f=l(e.params.value);f&&(s.value(),r(f,p,{data:v,params:e.params.value,time:new Date().getTime()}),s.value=y(e.params.value))}}});function So(e){let t,o;class p extends Promise{constructor(a){super(a),this.cancel=()=>{o(),clearTimeout(t)}}}return new p(n=>{o=n,t=setTimeout(o,e)})}function Re(){return new Date().getTime()}var Ro=ae((e,t)=>{let{loadingDelay:o=0,loadingKeep:p=0}=t;const n=I(()=>{}),a=U(()=>te(o)),c=U(()=>te(p));let l=0,s={};const m=()=>{let _;return a.value&&(_=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},a.value)),()=>_&&clearTimeout(_)};return{onBefore(){e.loading.value=!a.value,n.value(),n.value=m(),l=Re()},onQuery(_){if(!c.value)return()=>_();s=So(c.value+a.value);const r=async()=>{try{const i=await _();return Re()-l<=a.value&&s.cancel(),Promise.resolve(i)}catch(i){return Re()-l<=a.value&&s.cancel(),Promise.reject(i)}},d=Promise.allSettled([r(),s]).then(i=>{const y=i[0];return y.status==="fulfilled"?y.value:Promise.reject(y.reason)});return()=>d},onCancel(){n.value()},onAfter(){n.value()}}}),Fe;const wt=new Set,bt=new Set,yt=new Set,Ve=(e,t)=>{let o;switch(e){case"FOCUS_LISTENER":o=wt;break;case"RECONNECT_LISTENER":o=yt;break;case"VISIBLE_LISTENER":o=bt;break}if(!o.has(t))return o.add(t),()=>{o.delete(t)}},Pe=e=>{e.forEach(t=>{t()})};!He&&(Fe=window)!==null&&Fe!==void 0&&Fe.addEventListener&&(window.addEventListener("visibilitychange",()=>{vt()&&Pe(bt)},!1),window.addEventListener("focus",()=>Pe(wt),!1),window.addEventListener("online",()=>Pe(yt),!1));var Fo=ae((e,t)=>{let{pollingInterval:o,pollingWhenHidden:p=!1,pollingWhenOffline:n=!1,errorRetryCount:a=0}=t;const c=I(),l=I(!1),s=U(()=>te(o)),m=U(()=>te(a)),_=[],r=b=>{b&&_.push(b)},d=()=>(p||vt())&&(n||fo()),i=b=>{if(e.error.value&&m.value!==0)return;let u;if(!we(s.value)&&s.value>=0)if(d())u=setTimeout(b,s.value);else{l.value=!0;return}return()=>u&&clearTimeout(u)},y=()=>{l.value&&d()&&(e.context.refresh(),l.value=!1)};return pe(s,()=>{c.value&&(c.value(),c.value=i(()=>e.context.refresh()))}),p||r(Ve("VISIBLE_LISTENER",y)),n||r(Ve("RECONNECT_LISTENER",y)),De(()=>{_.forEach(b=>b())}),{onBefore(){var b;(b=c.value)===null||b===void 0||b.call(c)},onCancel(){var b;(b=c.value)===null||b===void 0||b.call(c)},onAfter(){c.value=i(()=>e.context.refresh())}}});const Po=(e,t)=>{let o=!1;return function(){o||(o=!0,e(...arguments),setTimeout(()=>{o=!1},t))}};var Uo=ae((e,t)=>{let{refreshOnWindowFocus:o=!1,refocusTimespan:p=5e3}=t;const n=U(()=>te(o)),a=U(()=>te(p)),c=[],l=m=>{m&&c.push(m)},s=()=>{c.forEach(m=>m())};return J(()=>{if(s(),n.value){const m=Po(e.context.refresh,a.value);l(Ve("VISIBLE_LISTENER",m)),l(Ve("FOCUS_LISTENER",m))}}),De(()=>{s()}),{}});function ie(e,t){return xo(e,t,[Ro,go,yo,Fo,Co,Uo,ko,ho,$o])}var gt=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(gt||{});function Le(){const{request:e}=z(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"};return{url:t,getPublishList:()=>e.get(t.publishList),getTaskList:u=>e.get(t.taskList,{params:u}),getFlowDetail:u=>e.get(t.detail,{params:u}),getApprovalNode:u=>e.post(t.approvalNode,u),startTask:u=>e.post(t.start,u),commitTask:u=>e.post(t.commit,u),saveDraft:u=>e.post(t.draft,u),revokeTask:u=>e.post(t.revoke,u),terminateTask:u=>e.post(t.terminate,u),withdrawTask:u=>e.post(t.withdraw,u),transferTask:u=>e.post(t.transfer,u),rejectTask:u=>e.post(t.reject,u),greenChannel:u=>e.post(t.green,u),circulateTask:u=>e.post(t.circulate,u)}}function Eo(e){const{commitTask:t,revokeTask:o,saveDraft:p,startTask:n,terminateTask:a,transferTask:c,withdrawTask:l,rejectTask:s,greenChannel:m,circulateTask:_}=Le(),r=U(()=>{const{flowDetail:i,formVariables:y,approvalFormData:b,debug:u,fileIds:v}=e,{flowDeployId:f}=i.value.process??{},{taskId:h,flowInstanceId:D}=i.value.task??{};return{flowDeployId:f,taskId:h,flowInstanceId:D,variables:y.value,debug:u.value,fileIds:v.value,...b.value}}),d=()=>r.value.taskId&&r.value.flowInstanceId;return{flow_draft(){if(d())return p(r.value)},flow_pass(){return d()?t(r.value):n(r.value)},flow_revoke(){if(d())return o(r.value)},flow_withdraw(){if(d())return l(r.value)},flow_terminate(){if(d())return a(r.value)},flow_transfer(){if(d())return c(r.value)},flow_reject(){if(d())return s(r.value)},flow_green(){if(d())return m(r.value)},flow_circulate(){if(d()){const{approvalFormData:i,circulateId:y}=e;return _({id:y==null?void 0:y.value,comment:i==null?void 0:i.value.comment})}}}}function Ao(e){const t=I({});return J(async()=>{var p;const{formProperty:o}=((p=k(e))==null?void 0:p.properties)||{};o!=null&&o.length&&(await _e(),Object.keys(t.value).forEach(n=>{var l,s,m,_;const a=((l=t.value[n])==null?void 0:l.label)||"",c=o==null?void 0:o.find(r=>r.prop===n);if(t.value[n].display=c==null?void 0:c.display,t.value[n].disabled=c==null?void 0:c.disabled,t.value[n].detail=c==null?void 0:c.detail,t.value[n].readonly=c==null?void 0:c.readonly,t.value[n].rules=t.value[n].rules??[],c!=null&&c.required&&((s=t.value[n].rules)!=null&&s.some(r=>r.required)))return null;c!=null&&c.required?(m=t.value[n].rules)==null||m.push({required:!0,message:`${a}为必填项`}):t.value[n].rules=(_=t.value[n].rules)==null?void 0:_.filter(r=>!r.required)}))}),t}function Ko(){return{modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}}}function Mo(){return{complete:e=>e}}const ht=Symbol("flowFormState");function Bo(e,t){const o=me(e,void 0,{passive:!0,deep:!0}),{flowDetail:p,modelValue:n,formLoading:a}=o,{getFlowDetail:c}=Le(),{tabs:l}=z(),s=U(()=>(l==null?void 0:l.filter(i=>{var b,u,v;const y=(v=(u=(b=p.value)==null?void 0:b.properties)==null?void 0:u.formProperty)==null?void 0:v.find(f=>f.prop===i.prop);return(y==null?void 0:y.display)!==!1}))??[]);J(()=>{const{flowKey:i,taskId:y,instanceId:b}=e;!i&&!y&&!b||(a.value=!0,c({flowKey:i,taskId:y,flowInstanceId:b}).then(u=>{p.value=u.data,n.value=u.data.formData||{}}).finally(()=>{a.value=!1}))});const m=I(!1),_=U(()=>Object.entries(n.value||{}).filter(([i])=>!i.startsWith("$")).map(([i,y])=>({key:i,value:y}))),r=I(),d={...o,formData:n,formVariables:_,approvalVisible:m,tabList:s,fileIds:r,emit:t};return Bt(ht,d),d}function ce(){return Me(ht)}const jo=A({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:o,circulateId:p}=ce(),{data:n}=Qe().useList(),{userInfo:a}=z();function c(s,m){return s.map(_=>{const r=m.find(i=>i.buttonKey===_.buttonKey);return{..._,...no(r,["display","approval"])}})}const l=U(()=>{var f,h,D,O,F,N;if(p!=null&&p.value){const R=(f=n.value)==null?void 0:f.find(S=>S.buttonKey==="flow_circulate");return R?[R]:[]}const s=typeof a=="function"?a():a,{assignee:m,status:_}=((h=o.value)==null?void 0:h.task)||{},{createUser:r,flowInstanceId:d,status:i}=((D=o.value)==null?void 0:D.flowInstance)||{},y={true:!0,false:!1,startUser:r==(s==null?void 0:s.userId),assignee:m==(s==null?void 0:s.userId),todo:_==2,done:_==1,notstarted:!d,started:!!d,finished:i===1,unfinished:i===2},b=((O=n.value)==null?void 0:O.filter(R=>R.buttonKey!=="flow_circulate"))??[],{button:u}=((F=o.value)==null?void 0:F.properties)||{};return((N=c(b,u??[]))==null?void 0:N.filter(R=>{var S,C;return(C=(S=R.display)==null?void 0:S.split(","))==null?void 0:C.every(x=>y[x])}))??[]});return(s,m)=>{const _=V("el-button");return T(!0),E(W,null,X(l.value,r=>(T(),$(_,{key:r.buttonKey,type:r.buttonType,onClick:d=>t("click",r)},{default:w(()=>[g(k(se),{icon:r.icon},null,8,["icon"]),P(" "+j(r.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function ze(e){return new Promise((t,o)=>{k(e).validate((n,a,c)=>{n?(a(),t(c)):o(c)})})}const Ho=A({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=me(t),{batchUpdate:p,create:n,remove:a,useList:c}=il(),l=I(!1),{activeBtn:s}=ce(),m=U(()=>{var h;return(h=s.value)==null?void 0:h.buttonKey}),{data:_,refresh:r}=c(m),d=U(()=>{var D,O,F;const h=o.value;if(h&&!((D=_.value)!=null&&D.some(N=>N.content===h))){const N=(((F=(O=_.value)==null?void 0:O[0])==null?void 0:F.sort)||1)-1;return[{content:h,sort:N},..._.value||[]]}return _.value});async function i(h){var D;await n({...h,type:(D=s.value)==null?void 0:D.buttonKey}),G.success("添加成功"),r()}async function y(h){await a(h.id),G.success("删除成功"),r()}async function b(h,D){let O=D.parent.data;O=O.map((F,N)=>({id:F.id,sort:N+1})),await p(O),G.success("修改排序成功"),r(),l.value=!1}function u(){l.value=!0}const v=I();async function f(h){var D;o.value=h.content??"",await _e(),(D=v.value)==null||D.blur()}return(h,D)=>{const O=V("el-input"),F=V("el-text"),N=V("el-col"),R=V("el-button"),S=V("el-row"),C=V("el-tree"),x=V("el-popover");return T(),$(x,{visible:l.value,placement:"bottom",title:"常用意见",width:600},{reference:w(()=>[g(O,{ref_key:"inputRef",ref:v,modelValue:k(o),"onUpdate:modelValue":D[0]||(D[0]=L=>ee(o)?o.value=L:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:D[1]||(D[1]=L=>l.value=!0),onBlur:D[2]||(D[2]=L=>l.value=!1)},null,8,["modelValue"])]),default:w(()=>[g(C,{data:d.value,"node-key":"content",draggable:"","allow-drop":(L,K,H)=>H!=="inner",props:{label:"content"},onNodeClick:f,onNodeDrop:b,onNodeDragStart:u},{default:w(({data:L})=>[g(S,{style:{width:"600px"}},{default:w(()=>[g(N,{span:22},{default:w(()=>[g(F,{truncated:"",title:L.content},{default:w(()=>[P(j(L.content),1)]),_:2},1032,["title"])]),_:2},1024),g(N,{span:2},{default:w(()=>[L.id?(T(),$(R,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:tt(K=>y(L),["stop"])},null,8,["onClick"])):(T(),$(R,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:tt(K=>i(L),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),zo=A({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:o}=me(t),p=I(),n={class(r){return`node-${r.type}`}},a=U(()=>pt(t.data??[],(r,d,i)=>{const y=ut();return r.taskNodeKey=(i==null?void 0:i.taskNodeKey)??r.taskNodeKey,r.incoming=(i==null?void 0:i.incoming)??r.incoming,r.multiple=(i==null?void 0:i.multiple)??r.multiple,{...r,id:y,label:r.title,disabled:r.type!=="user"}})),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};xe(()=>[a.value,p.value],async()=>{if(!p.value||!a.value.length)return;if(t.autoCheck){const d=l(a.value);d&&_([d])}Zt(a.value,d=>{var i;return!!((i=d.children)!=null&&i.length)}).map(async d=>{var y;await Pt(100);const i=(y=p.value)==null?void 0:y.getNode(d);i==null||i.expand()})},{immediate:!0,debounce:100});function l(r){var d;if(r.length===1)return(d=r[0].children)!=null&&d.length?l(r[0].children):r[0]}async function s(r,{checkedNodes:d}){var b;let i=d.filter(u=>u.type==="user");const y=i.some(u=>u.id===r.id);if(a.value.every(u=>!u.multiple)&&y)i=[r];else if(!r.multiple&&y){const f=((b=p.value)==null?void 0:b.getNode(r)).parent.data.children.filter(h=>h.id!==r.id);i=ft(i,f,"id")}_(i)}function m(r){const d=o.value.filter(i=>i.id!==r.id);_(d)}function _(r){var d;o.value=r,(d=p.value)==null||d.setCheckedNodes(r)}return(r,d)=>{const i=V("el-tag"),y=V("Icon"),b=V("el-tree");return T(),E(W,null,[(T(!0),E(W,null,X(k(o),u=>(T(),$(i,{key:u.id,type:"info",closable:"",onClose:v=>m(u)},{default:w(()=>[P(j(u.title),1)]),_:2},1032,["onClose"]))),128)),g(b,{ref_key:"treeRef",ref:p,class:"approval-tree",data:a.value,props:n,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:s},{default:w(({data:u})=>[Q("div",null,[g(y,{icon:c[u.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),Q("span",null,j(u.title),1)])]),_:1},8,["data"])],64)}}});const lt=Te(zo,[["__scopeId","data-v-f1318efd"]]),at=A({__name:"assignee-setter",props:{modelValue:{},tableData:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,p=U({get(){return typeof o.modelValue=="string"?o.modelValue?o.modelValue.split(","):[]:o.modelValue},set(r){t("update:modelValue",r.join(","))}}),n=U({get(){return Array.isArray(o.modelValue)?o.modelValue.join(","):o.modelValue},set(r){t("update:modelValue",r)}}),a=I(!1),c=U(()=>{var r,d;return(d=(r=o.tableData)==null?void 0:r.row)==null?void 0:d.type}),l=I([]),s=I([]),{getUserTree:m}=ml(),{getParam:_}=fe();return pe(c,r=>{["dept","post","user"].includes(r)?(a.value=!0,m(r==="user"?"":r).then(d=>{l.value=pt(d.data,i=>({label:i.title,value:i.id}))}).finally(()=>a.value=!1)):c.value==="dynamic"&&(a.value=!0,_("flow.trends.user").then(d=>{s.value=d.data}).finally(()=>a.value=!1))},{immediate:!0}),(r,d)=>{const i=V("el-tree-select"),y=V("el-input");return["dept","post","user"].includes(c.value)?(T(),$(i,{key:0,modelValue:p.value,"onUpdate:modelValue":d[0]||(d[0]=b=>p.value=b),data:l.value,loading:a.value,"expand-on-click-node":!1,multiple:"","check-on-click-node":"","show-checkbox":"","check-strictly":"",clearable:""},null,8,["modelValue","data","loading"])):c.value==="dynamic"?(T(),$(i,{key:1,modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=b=>n.value=b),data:s.value,loading:a.value,clearable:""},null,8,["modelValue","data","loading"])):c.value==="userTask"?(T(),$(k(Gt),{key:2,modelValue:n.value,"onUpdate:modelValue":d[2]||(d[2]=b=>n.value=b),"filter-type":"userTask"},null,8,["modelValue"])):(T(),$(y,{key:3,modelValue:n.value,"onUpdate:modelValue":d[3]||(d[3]=b=>n.value=b)},null,8,["modelValue"]))}}}),Wo={key:0,class:"flow-viewer"},Yo={key:0,class:"flow-status-legend"},qo=A({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const o=e,{FlowDesign:p,tabs:n}=z(),a=he();lo(a,()=>{var u;(u=a.value)==null||u.on("node:click",v=>t("nodeClick",v))});const c=U({get(){let u=Jt();return typeof o.modelValue=="string"&&o.modelValue?u=JSON.parse(o.modelValue):typeof o.modelValue=="object"&&Object.keys(o.modelValue)&&(u=o.modelValue),u},set(u){t("update:modelValue",JSON.stringify(u))}}),l=U(()=>{const{column:u=[],group:v=[]}=JSON.parse(o.flowFormOption||"{}");return[...u,...v.map(h=>h.column??[]).flat()]}),{data:s}=Qe().useList(),m=U(()=>(n==null?void 0:n.map(u=>({...u,display:!0})))??[]),_=U(()=>{var u;return{formPropertyList:[...l.value,...m.value],buttonList:(u=s.value)==null?void 0:u.filter(v=>v.status===1),fieldsDic:l.value.map(v=>({label:v.label,value:`\${${v.prop}}`,desc:`\${${v.prop}}`})),flowButtonDisplayDic:ne(Ye),flowButtonApprovalDic:ne(qe)}}),r=I({}),d=I({});xe(d,u=>{var v,f,h,D,O,F,N,R,S;u&&((h=(f=(v=u.assignee)==null?void 0:v.children)==null?void 0:f.column)!=null&&h[1]&&(u.assignee.children.column[1].component=at),(S=(R=(N=(F=(O=(D=u.circulate)==null?void 0:D.children)==null?void 0:O.column)==null?void 0:F[1])==null?void 0:N.children)==null?void 0:R.column)!=null&&S[1]&&(u.circulate.children.column[1].children.column[1].component=at))},{debounce:1});const{data:i}=fe().useParam("flow.task.status"),y=U(()=>{var u;return(u=o.flowHistory)==null?void 0:u.map(v=>{var h,D;const f=(D=(h=i.value)==null?void 0:h.find(O=>O.value===v.status))==null?void 0:D.style;return{id:v.taskNodeKey,style:f}})}),b=U(()=>{var u,v;return(v=(u=o.flowHistory)==null?void 0:u.filter(f=>f.taskNodeType==="userTask"))==null?void 0:v.map(f=>{var h;return{id:f.taskNodeKey,content:`<div>${f.assigneeName}</div>
        <div>${f.endTime??""}</div>
        <div>${((h=f.comment)==null?void 0:h.comment)??""}</div>`}})});return(u,v)=>u.view?(T(),E("div",Wo,[u.showLegend!==!1?(T(),E("div",Yo,[(T(!0),E(W,null,X(k(i),f=>{var h;return T(),E("div",{key:f.label,class:"legend-item"},[Q("div",{class:"legend-color",style:jt({backgroundColor:(h=f.style)==null?void 0:h.fill})},null,4),Q("span",null,j(f.label),1)])}),128))])):B("",!0),g(k(p),{lf:a.value,"onUpdate:lf":v[0]||(v[0]=f=>a.value=f),"model-value":c.value,styles:y.value,tooltips:b.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(T(),$(k(p),{key:1,modelValue:c.value,"onUpdate:modelValue":v[1]||(v[1]=f=>c.value=f),formData:r.value,"onUpdate:formData":v[2]||(v[2]=f=>r.value=f),formDefaults:d.value,"onUpdate:formDefaults":v[3]||(v[3]=f=>d.value=f),"form-options":k(Xt),"data-options":_.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const be=Te(qo,[["__scopeId","data-v-9aa4931a"]]),Qo=A({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:o}=me(t),{flowDetail:p}=ce(),n=I(!1);function a({data:c}){c.type==="userTask"&&(n.value=!1,o.value=c.id)}return(c,l)=>{const s=V("el-button"),m=V("el-popover");return T(),$(m,{visible:n.value,"onUpdate:visible":l[0]||(l[0]=_=>n.value=_),placement:"bottom-start",width:"800px",trigger:"click"},{reference:w(()=>[g(s,null,{default:w(()=>[P(" 点击选择节点 ")]),_:1})]),default:w(()=>{var _,r;return[g(be,{"model-value":(r=(_=k(p))==null?void 0:_.process)==null?void 0:r.flowData,view:"",style:{height:"600px"},onNodeClick:a},null,8,["model-value"])]}),_:1},8,["visible"])}}}),Go=A({__name:"approval-form",emits:["confirm"],setup(e,{emit:t}){const{getApprovalNode:o}=Le(),{useParam:p}=fe(),{formData:n,approvalFormData:a,activeBtn:c,approvalVisible:l,formVariables:s,flowDetail:m}=ce(),_=I([]),r=I([]),d=I([]),i=I([]),y=I(!1),b=I(!1),u=I(),v=I(),f={menuBtn:!1,labelWidth:100,column:[{label:"指定节点",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:h}]},{label:"传阅人",prop:"circulate",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function h(C,x,L){var Y,M,ye;const K=((Y=_.value[0])==null?void 0:Y.type)==="parallelGateway",H=(ye=(M=_.value[0])==null?void 0:M.children)==null?void 0:ye.every(re=>eo([re],Ne=>r.value.some(Ie=>Ie.id===Ne.id)));if(r.value.length){if(K&&!H)return L("请在每个节点选择审批人")}else return L("请选择审批人");return!0}const{data:D}=p("flow.default.comment"),{data:O}=p("flow.approval.autocheck");J(async()=>{var x;if(!l.value||!u.value||!v.value)return;F();const{taskId:C}=((x=m.value)==null?void 0:x.task)||{};_e(()=>{u.value.resetFields(),a.value.comment=n.value.comment||(C?"":D.value),v.value.jumpTaskNodeKey.display=N("specifyNode"),v.value.assignee.display=N("assignee"),v.value.circulate.display=N("circulate"),v.value.comment.display=N("comment")})}),J(async()=>{var L,K;if(!l.value||!N("assignee")||N("specifyNode")&&!a.value.jumpTaskNodeKey)return;F();const{flowKey:C}=((L=m.value)==null?void 0:L.process)||{},{taskId:x}=((K=m.value)==null?void 0:K.task)||{};try{b.value=!0;const H=await o({flowKey:C,taskId:x,variables:s.value,buttonType:c.value.buttonKey,jumpTaskNodeKey:a.value.jumpTaskNodeKey});_.value=H.data.approvalNodeList,d.value=H.data.circulateNodeList}finally{b.value=!1}});function F(){_.value=[],r.value=[],d.value=[],i.value=[]}function N(C){var x,L;return(L=(x=c.value)==null?void 0:x.approval)==null?void 0:L.includes(C)}async function R(){await ze(u),y.value=!0;const{data:C,outgoing:x}=S(r.value),{data:L}=S(i.value);a.value.assignee=C,a.value.outgoing=[...x],a.value.circulate=L,console.log("🚀 ~ file: approval-form.vue:210 ~ onConfirm ~ formData:",n),t("confirm")}function S(C){const x={},L={},K=new Set;return C.forEach(H=>{const{taskNodeKey:Y,incoming:M}=H;x[Y]||(x[Y]=new Set),H.userId&&x[Y].add(H.userId),L[Y]=[...x[Y]].join(","),M&&K.add(M)}),{set:x,data:L,outgoing:K}}return(C,x)=>{const L=V("el-skeleton"),K=V("avue-form"),H=V("el-button"),Y=V("el-dialog");return T(),$(Y,{modelValue:k(l),"onUpdate:modelValue":x[7]||(x[7]=M=>ee(l)?l.value=M:null),class:"approlval-form",title:k(c).name,width:"900px","append-to-body":""},{footer:w(()=>[g(H,{onClick:x[6]||(x[6]=M=>l.value=!1)},{default:w(()=>[P(" 取 消 ")]),_:1}),g(H,{type:"primary",onClick:R},{default:w(()=>[P(" 确 定 ")]),_:1})]),default:w(()=>[g(K,{ref_key:"formRef",ref:u,modelValue:k(a),"onUpdate:modelValue":x[4]||(x[4]=M=>ee(a)?a.value=M:null),defaults:v.value,"onUpdate:defaults":x[5]||(x[5]=M=>v.value=M),option:f},{jumpTaskNodeKey:w(()=>[g(Qo,{modelValue:k(a).jumpTaskNodeKey,"onUpdate:modelValue":x[0]||(x[0]=M=>k(a).jumpTaskNodeKey=M)},null,8,["modelValue"])]),assignee:w(()=>[b.value?(T(),$(L,{key:0})):(T(),$(lt,{key:"AssigneeTree",modelValue:r.value,"onUpdate:modelValue":x[1]||(x[1]=M=>r.value=M),data:_.value,"auto-check":k(O)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:w(()=>[b.value?(T(),$(L,{key:0})):(T(),$(lt,{key:"CirculateTree",modelValue:i.value,"onUpdate:modelValue":x[2]||(x[2]=M=>i.value=M),data:d.value},null,8,["modelValue","data"]))]),comment:w(()=>[g(Ho,{modelValue:k(a).comment,"onUpdate:modelValue":x[3]||(x[3]=M=>k(a).comment=M)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),Jo={class:"flow-form__title"},We=A({__name:"index",props:Ko(),emits:Mo(),setup(e,{emit:t}){const o=e,p=Bo(o,t),{flowDetail:n,tabList:a,activeTab:c,activeBtn:l,formLoading:s,approvalVisible:m,submitLoading:_}=p,r=I();async function d(b){var u,v;l.value=b,await((u=r.value)==null?void 0:u.validate()),await((v=o.beforeClick)==null?void 0:v.call(o,b)),(b==null?void 0:b.approval)!=="false"?m.value=!0:y()}const i=Eo(p);async function y(){var b,u;try{const{buttonKey:v}=l.value;_.value=!0,await((b=o.beforeSubmit)==null?void 0:b.call(o,l.value));const f=(u=i[v])==null?void 0:u.call(i);f instanceof Promise?(await f,G.success("操作成功"),m.value=!1,t("complete",l.value)):G.error("操作失败")}finally{_.value=!1}}return(b,u)=>{const v=V("el-skeleton"),f=V("el-main"),h=V("el-header"),D=V("el-tab-pane"),O=V("el-tabs"),F=V("el-container");return k(s)?(T(),$(f,{key:0},{default:w(()=>[g(v)]),_:1})):(T(),$(F,{key:1,class:"flow-form"},{default:w(()=>[g(h,{class:"flow-form__header",height:"auto"},{default:w(()=>{var N;return[Q("div",Jo,j(o.title??((N=k(n).flowInstance)==null?void 0:N.title)),1),b.detail?B("",!0):(T(),$(jo,{key:0,onClick:d})),Ht(b.$slots,"button")]}),_:3}),g(f,{class:"flow-form__main"},{default:w(()=>[g(O,{modelValue:k(c),"onUpdate:modelValue":u[0]||(u[0]=N=>ee(c)?c.value=N:null)},{default:w(()=>[(T(!0),E(W,null,X(k(a),N=>(T(),$(D,{key:N.prop,label:N.label,name:N.prop,lazy:""},{default:w(()=>[N.prop==="formTab"?(T(),$(ot(b.$slots.default??N.component),{key:0,ref_for:!0,ref:R=>r.value=R},null,512)):(T(),$(ot(N.component),{key:1}))]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(Go,{onConfirm:y})]),_:3}))}}});function kt(e,t){switch(t.type){case"window":return Xo(e,t);case"dialog":case"drawer":return Zo(e,t);default:return{open:o=>{},close:()=>{}}}}function Xo(e,t){const{window:[o="",p="flow-form",n="left=0,top=0,width=1600,height=900"]=[]}=t,a=I(null),c=U(()=>`${o}?${Ut(Et(e,At(so,ro)))}`);return{open:m=>{var _;a.value=window.open(c.value,p,n),(_=a.value)==null||_.addEventListener("message",r=>{const{event:d}=r.data,i={...k(e),...k(m)}[d];typeof i=="function"&&i(r.data)})},close:()=>{var m;return(m=a.value)==null?void 0:m.close()},openedWindow:a}}function Zo(e,t){const{appContext:o}=it();let p;const n=c=>{p=document.createElement("div"),p.className="flow-form-wrapper";const l=el(t.formPath),s=Ue(l,{...k(e),...k(c)}),m=Ue(t.type==="dialog"?uo:io,{customClass:"flow-form-overlay",modelValue:!0,width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0,onClose:a,...t.overlay},s);m.appContext=o,Wt(m,p),document.body.appendChild(p)},a=()=>{p&&document.body.removeChild(p)};return{open:n,close:a}}function el(e){return e?zt(()=>Yt(()=>import(e),[])):We}const tl=A({setup(){const{flowDetail:e,formData:t,detail:o}=ce(),p=Ao(e.value),{proxy:n}=it(),a=I({});J(()=>{const{formOption:s}=e.value.process??{};a.value=mt.bind(n)(s||'{"menuBtn":false}'),a.value.detail=!!o.value});const c=I();function l(){return ze(c)}return{form:t,option:a,defaults:p,formRef:c,validate:l}},render(){return Ue(V("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),ol=A({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:o}=ce(),{upload:{action:p,headers:n,preview:a,download:c,props:l}={}}=z(),s=typeof n=="function"?n():n,m=U(()=>{var f,h;return((h=(f=t.value)==null?void 0:f.task)==null?void 0:h.flowInstanceId)??ut()}),_={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:r,getDataList:d,handleDel:i,handleSave:y,afterGetList:b,crudStateRefs:{tableData:u}}=Z({crudOption:{...dl(),saveSuccessMsg:"上传成功"},tableOption:_,queryForm:{isLatest:1,flowInstanceId:m.value}});b(()=>{o.value=u.value.map(f=>f.id).join(",")}),d();async function v(f,h){var C,x;const{fileName:D,fileType:O,fileSize:F,fileUrl:N,res:R}=l,S={fileName:ge({res:f},`${R}.${D}`),fileType:ge({res:f},`${R}.${O}`),fileSize:ge({res:f},`${R}.${F}`),fileUrl:ge({res:f},`${R}.${N}`),taskId:(x=(C=t.value)==null?void 0:C.task)==null?void 0:x.taskId,flowInstanceId:m.value,rootMark:(h==null?void 0:h.rootMark)||"",version:typeof(h==null?void 0:h.version)=="number"?h.version+1:1};await y(S,d,()=>{})}return(f,h)=>{const D=V("el-button"),O=V("el-upload"),F=V("avue-crud");return T(),$(F,oe(le(k(r))),{"menu-left":w(()=>[g(O,{action:k(p),headers:k(s),"show-file-list":!1,onSuccess:h[0]||(h[0]=N=>v(N))},{default:w(()=>[g(D,{type:"primary",icon:"el-icon-upload"},{default:w(()=>[P(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:w(({row:N,index:R})=>[g(D,{type:"primary",text:"",icon:"el-icon-view",onClick:S=>{var C;return(C=k(a))==null?void 0:C(N,k(u))}},{default:w(()=>[P(" 预览 ")]),_:2},1032,["onClick"]),g(D,{type:"primary",text:"",icon:"el-icon-download",onClick:S=>{var C;return(C=k(c))==null?void 0:C(N,k(u))}},{default:w(()=>[P(" 下载 ")]),_:2},1032,["onClick"]),g(O,{action:k(p),headers:k(s),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:S=>v(S,N)},{default:w(()=>[g(D,{type:"primary",text:"",icon:"el-icon-upload"},{default:w(()=>[P(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),g(D,{type:"primary",text:"",icon:"el-icon-delete",onClick:S=>k(i)(N,R)},{default:w(()=>[P(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),ll={class:"flow-track"},al={key:0},nl={key:1},sl=A({__name:"flow-track",setup(e){const{flowDetail:t}=ce(),o=I("table"),p=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],n=U(()=>{var s,m,_;return((_=(m=(s=t.value)==null?void 0:s.flowHistory)==null?void 0:m.filter(r=>r.taskNodeType==="userTask"))==null?void 0:_.map(r=>({...r,duration:Kt(r.duration)})))??[]}),a={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.comment"}]},{data:c}=fe().useParam("flow.handle.type");function l(s){var m;return(m=c.value)==null?void 0:m.find(_=>_.value===s)}return(s,m)=>{var v,f,h;const _=V("el-radio-button"),r=V("el-radio-group"),d=V("avue-crud"),i=V("el-card"),y=V("el-timeline-item"),b=V("el-timeline"),u=V("el-empty");return T(),E(W,null,[g(r,{modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=D=>o.value=D)},{default:w(()=>[(T(),E(W,null,X(p,D=>g(_,{key:D.label,label:D.label},{default:w(()=>[g(k(se),{icon:D.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Q("div",ll,[o.value==="table"?(T(),$(d,{key:0,data:n.value,option:a},null,8,["data"])):B("",!0),o.value==="graph"?(T(),$(be,{key:1,"model-value":(f=(v=k(t))==null?void 0:v.process)==null?void 0:f.flowData,"flow-history":(h=k(t))==null?void 0:h.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):B("",!0),o.value==="timeline"?(T(),E(W,{key:2},[n.value.length?(T(),$(b,{key:0},{default:w(()=>[(T(!0),E(W,null,X([...n.value].reverse(),D=>(T(),$(y,{key:D.id,timestamp:D.endTime,placement:"top"},{default:w(()=>[g(i,null,{default:w(()=>{var O,F,N;return[Q("div",null,j(D.assigneeName)+" 开始处理 ["+j(D.taskNodeName)+"] 环节 ",1),D.duration?(T(),E("div",al," 办理时长："+j(D.duration),1)):B("",!0),D.type&&((O=D.comment)!=null&&O.comment)?(T(),E("div",nl,j((F=l(D.type))==null?void 0:F.label)+"意见："+j((N=D.comment)==null?void 0:N.comment),1)):B("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(T(),$(u,{key:1}))],64)):B("",!0)])],64)}}});const rl=Te(sl,[["__scopeId","data-v-ee4b339a"]]),nt=Symbol("flowPagesConfig"),ul={FlowDesign:{},FormDesign:{},FlowForm:We,tabs:[{label:"审批表单",prop:"formTab",component:tl},{label:"附件资料",prop:"fileTab",component:ol},{label:"流程跟踪",prop:"trackTab",component:rl}],request:()=>{},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var Ct=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(Ct||{});const Ae=ne(Ct);function z(e,t){return e&&t?(e.provide(nt,Mt(ul,t)),t):Me(nt)}function il(){const{request:e}=z(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},o=s=>e.get(t.list,{params:{type:s,ascs:"sort"}});return{url:t,getList:o,useList:s=>ie(()=>o(s.value).then(m=>m.data.records),{refreshDeps:[s]}),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),batchUpdate:s=>e.post(t.batchUpdate,s)}}var Vt=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(Vt||{}),Ye=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(Ye||{}),qe=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(qe||{}),Dt=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Dt||{});function Qe(){const{request:e}=z(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function cl(){const{request:e}=z(),t={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"};return{getList:l=>e.get(t.list,{params:l}),getTree:l=>e.get(t.tree,{params:l}),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function Tt(){const{request:e}=z(),t={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:t,getCirculateList:c=>e.get(t.list,{params:c}),getCirculateOpsList:c=>e.get(t.list,{params:c}),updateCirculate:c=>e.post(t.update,c),removeCirculate:c=>e.post(t.remove,{},{params:{ids:c}})}}function Ge(){const{request:e}=z(),t={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"};return{url:t,getList:s=>e.get(t.list,{params:s}),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),deploy:s=>e.post(t.deploy,s),getDetail:s=>e.get(t.detail,{params:s})}}var xt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(xt||{});function Je(){const{request:e}=z(),t={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:t,getList:c=>e.get(t.list,{params:c}),getDetail:c=>e.get(t.detail,{params:c}),update:c=>e.post(t.update,c),remove:c=>e.post(t.remove,{},{params:{ids:c}})}}function dl(){const{request:e}=z(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:a=>e.get(t.list,{params:a}),create:a=>e.post(t.save,a),remove:a=>e.post(t.remove,{},{params:{ids:a}})}}function pl(){const{request:e}=z(),t={list:"/sapier-flow/flow-ops/list"};return{url:t,getTaskOpsList:p=>e.get(t.list,{params:p})}}function fe(){const{request:e}=z(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},o=m=>e.get(t.list,{params:m}),p=()=>e.get(t.all),n=m=>e.get(t.key,{params:{paramKey:m}});return{url:t,getList:o,getAllParam:p,getParam:n,useParam:m=>ie(()=>n(m).then(_=>_.data)),create:m=>e.post(t.save,m),update:m=>e.post(t.update,m),remove:m=>e.post(t.remove,{},{params:{ids:m}})}}function Lt(){const{request:e}=z(),t={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function ml(){const{request:e}=z(),t={tree:"/sapier-flow/flow-user/tree"},o=n=>e.get(t.tree,{params:{filter:n}});return{url:t,getUserTree:o,useUserTree:()=>ie(()=>o().then(n=>n.data))}}function Nt(){const{request:e}=z(),t={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},o=l=>e.get(t.list,{params:l});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}var It=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(It||{});function Ke(){const{request:e}=z(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy"},o=s=>e.get(t.list,{params:s});return{url:t,getList:o,useList:()=>ie(()=>o({size:-1}).then(s=>s.data.records)),create:s=>e.post(t.save,s),update:s=>e.post(t.update,s),remove:s=>e.post(t.remove,{},{params:{ids:s}}),deploy:s=>e.post(t.deploy,s)}}const fl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:ne(Vt)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(Ye),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:ne(qe),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:ne(Dt)},{label:"按钮预览",prop:"buttonPreview",width:150}]},vl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:p}=Z({tableOption:fl,crudOption:Qe(),sortOption:{ascs:"sort"}});return p(),(n,a)=>{const c=V("el-button"),l=V("avue-crud");return T(),$(l,oe(le(k(t))),{icon:w(({row:s})=>[g(k(se),{icon:s.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:w(({row:s})=>[g(c,{type:s.buttonType},{default:w(()=>[g(k(se),{icon:s.icon},null,8,["icon"]),P(" "+j(s.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":w(()=>[g(c,{type:k(o).buttonType},{default:w(()=>[g(k(se),{icon:k(o).icon},null,8,["icon"]),P(" "+j(k(o).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Xe={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}}]},_l={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Xe.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Ot=A({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(e,{emit:t}){const o=e,{getList:p,deploy:n,remove:a}=Ge(),{bindVal:c,crudStateRefs:{searchForm:l},getDataList:s}=Z({tableOption:_l,crudOption:{getList:p,remove:a},searchForm:{categoryId:o.categoryId}});J(()=>{l.value.categoryId=o.categoryId??"",s()});const m=I(!1);async function _(d){await de.confirm("发布新版本，是否确认？","提示",{type:"success"}),m.value=!0,n({flowModuleId:d.flowModuleId}).then(()=>{G.success("发布成功"),s()}).finally(()=>{m.value=!1})}async function r(d){if(console.log("🚀 ~ file: index.vue:49 ~ handleDel ~ row:",d),d.mainVersion)return G.warning("请先删除已发布的流程");await de.confirm("确认删除？","提示",{type:"warning"}),await a(d.flowModuleId),G.success("删除成功"),s()}return(d,i)=>{const y=V("el-button"),b=V("el-dropdown-item"),u=V("avue-crud");return T(),$(u,oe(le(k(c))),{"menu-left":w(()=>[g(y,{type:"primary",icon:"el-icon-plus",onClick:i[0]||(i[0]=v=>t("add"))},{default:w(()=>[P(" 新增 ")]),_:1})]),"menu-btn":w(({row:v})=>[g(b,{icon:"el-icon-view",onClick:f=>t("view",v)},{default:w(()=>[P(" 查看 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-edit",onClick:f=>t("edit",v)},{default:w(()=>[P(" 编辑 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-delete",onClick:f=>r(v)},{default:w(()=>[P(" 删除 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-upload",onClick:f=>_(v)},{default:w(()=>[P(" 发布 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-switch",onClick:f=>t("version",v)},{default:w(()=>[P(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:w(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),wl={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...Xe.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},$t=A({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(e,{emit:t}){const o=e,{getList:p,update:n,remove:a}=Je(),{bindVal:c,crudStateRefs:{searchForm:l},getDataList:s}=Z({tableOption:wl,crudOption:{getList:p,dataPath:"res.data"}});J(()=>{o.flowModuleId&&(l.value.flowModuleId=o.flowModuleId,s())});const m=I(!1);async function _(d){await de.confirm(`确定将 ${d.flowName}(${d.flowKey}:v${d.version}) 设为主版本?`,"提示",{type:"warning"}),m.value=!0,n({flowDeployId:d.flowDeployId,flowModuleId:d.flowModuleId,mainVersion:1}).then(()=>{G.success("设置成功"),s()}).finally(()=>{m.value=!1})}async function r(d){const{value:i}=await de.prompt("请输入确认删除的流程标识","提示",{type:"warning"});i===d.flowKey&&(await a(d.flowDeployId),G.success("删除成功"),s())}return(d,i)=>{const y=V("el-button"),b=V("el-dropdown-item"),u=V("avue-crud");return T(),$(u,oe(le(k(c))),{"menu-left":w(()=>[g(y,{loading:m.value,type:"primary",icon:"el-icon-arrow-left",onClick:i[0]||(i[0]=v=>t("back"))},{default:w(()=>[P(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":w(({row:v})=>[g(b,{icon:"el-icon-view",onClick:f=>t("view",v)},{default:w(()=>[P(" 查看 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-edit",onClick:f=>t("edit",v)},{default:w(()=>[P(" 编辑 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-delete",onClick:f=>r(v)},{default:w(()=>[P(" 删除 ")]),_:2},1032,["onClick"]),g(b,{icon:"el-icon-switch",disabled:v.mainVersion===k(xt).是,onClick:f=>_(v)},{default:w(()=>[P(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:w(({row:v})=>[g(k(se),{icon:v.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),st={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},bl=A({__name:"index",emits:["node-click"],setup(e,{emit:t}){const{crudStateRefs:{formData:o,tableData:p},getDataList:n,handleSave:a,handleUpdate:c,handleDel:l}=Z({crudOption:{rowKey:"id",...cl(),dataPath:"res.data"},tableOption:st,pageOption:{pageSize:20}});n();function s(r,d,i,y){a(d,i,y)}function m(r,d,i,y){c(d,NaN,i,y)}async function _(r,d){await l(r.data,NaN),d()}return(r,d)=>{const i=V("avue-tree");return T(),$(i,{modelValue:k(o),"onUpdate:modelValue":d[0]||(d[0]=y=>ee(o)?o.value=y:null),option:k(st),data:k(p),onNodeClick:d[1]||(d[1]=y=>t("node-click",y)),onSave:s,onUpdate:m,onDel:_},null,8,["modelValue","option","data"])}}}),Ze=A({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(e,{emit:t}){var s;const o=e,{FormDesign:p}=z(),n=U({get(){return o.modelValue?mt(o.modelValue):{menuBtn:!1,span:24}},set(m){t("update:modelValue",to(m,{useJson5:!1}))}}),a=U(()=>o.fields?JSON.parse(o.fields):[]),c=U(()=>{const m={type:"select",dicData:a.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...m,props:{label:"name",value:"name",desc:"comment"}},{...m,props:{label:"comment",value:"comment",desc:"name"}}]}),l={form:{settings:Array.from({length:((s=oo.settings)==null?void 0:s.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(m,_)=>{const r=V("avue-form");return m.view?(T(),$(r,{key:0,class:qt(n.value.class),"model-value":{},option:n.value},null,8,["class","option"])):(T(),$(k(p),{key:1,modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=d=>n.value=d),"base-option":c.value,resources:l},null,8,["modelValue","base-option"]))}}}),yl=Q("span",null,"流程设计",-1),gl={key:0},hl={key:1},kl={style:{height:"calc(100vh - 144px)"}},Cl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(e,{emit:t}){const p=me(e),{visible:n,modelValue:a}=p,{create:c,deploy:l,getDetail:s,update:m}=Ge(),{getDetail:_,update:r}=Je(),d=["流程信息","表单设计","模型设计","完成"],i=I(!1);pe(n,async S=>{if(!S)return;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{i.value=!0;let L={};x?L=await _({flowDeployId:x}):C&&(L=await s({flowModuleId:C})),a.value=L.data}finally{i.value=!1}},{immediate:!0});const{data:y}=Nt().useList(),{data:b}=Lt().useList(),{data:u}=Ke().useList(),v=U(()=>{var S,C;return(C=(S=u.value)==null?void 0:S.find(x=>x.tableName===a.value.formDataTable))==null?void 0:C.tableFields}),f=I(0),h=U(()=>{var S,C;return f.value===1?((S=y.value)==null?void 0:S.map(x=>({label:x.formName,value:x.formOption})))??[]:f.value===2?((C=b.value)==null?void 0:C.map(x=>({label:x.flowName,value:x.flowData})))??[]:[]});function D(S){f.value===1?a.value.formOption=S.value:f.value===2&&(a.value.flowData=S.value)}const O=I();async function F(S){f.value===0&&await ze(O),i.value=!0;const{flowModuleId:C}=a.value,{flowDeployId:x}=a.value;try{x?await r(a.value):C?await m(a.value):await c(a.value).then(L=>{a.value.flowModuleId=L.data.flowModuleId}),G.success("保存成功")}finally{i.value=!1}typeof S=="number"?f.value=S:f.value++}async function N(){await de.confirm("发布新版本，是否确认？","提示"),i.value=!0,l({flowModuleId:a.value.flowModuleId}).then(()=>{G.success("发布成功")}).finally(()=>{i.value=!1})}function R(){n.value=!1,f.value=0,a.value={},t("close")}return(S,C)=>{const x=V("el-link"),L=V("el-dropdown-item"),K=V("el-dropdown-menu"),H=V("el-dropdown"),Y=V("el-col"),M=V("el-step"),ye=V("el-steps"),re=V("el-button"),Ne=V("el-row"),Ie=V("avue-form"),St=V("el-result"),Rt=V("el-dialog"),Ft=ct("loading");return T(),$(Rt,{modelValue:k(n),"onUpdate:modelValue":C[5]||(C[5]=q=>ee(n)?n.value=q:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:R},{header:w(()=>[g(Ne,{justify:"center"},{default:w(()=>[g(Y,{span:5},{default:w(()=>{var q,ve,Oe,et;return[Q("div",null,[yl,(q=k(a))!=null&&q.flowName?(T(),E("span",gl," - "+j((ve=k(a))==null?void 0:ve.flowName),1)):B("",!0),(Oe=k(a))!=null&&Oe.version?(T(),E("span",hl," - V"+j((et=k(a))==null?void 0:et.version),1)):B("",!0)]),h.value.length?(T(),$(H,{key:0},{dropdown:w(()=>[g(K,null,{default:w(()=>[(T(!0),E(W,null,X(h.value,$e=>(T(),$(L,{key:$e.label,onClick:ql=>D($e)},{default:w(()=>[P(j($e.label),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:w(()=>[g(x,{icon:"el-icon-arrow-down",underline:!1},{default:w(()=>[P(" 选择模板 ")]),_:1})]),_:1})):B("",!0)]}),_:1}),g(Y,{span:14},{default:w(()=>[g(ye,{active:f.value,simple:"","process-status":"finish","finish-status":"success"},{default:w(()=>[(T(),E(W,null,X(d,(q,ve)=>g(M,{key:ve,title:q,onClick:Oe=>F(ve)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),g(Y,{span:5,style:{"text-align":"right"}},{default:w(()=>[g(re,{disabled:f.value===0,loading:i.value,type:"primary",onClick:C[0]||(C[0]=q=>f.value--)},{default:w(()=>[P(" 上一步 ")]),_:1},8,["disabled","loading"]),g(re,{disabled:f.value===d.length-1,type:"primary",loading:i.value,onClick:C[1]||(C[1]=q=>F())},{default:w(()=>[P(" 下一步 ")]),_:1},8,["disabled","loading"]),g(re,{onClick:R},{default:w(()=>[P(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:w(()=>[dt((T(),E("div",kl,[f.value===0?(T(),$(Ie,{key:0,ref_key:"formRef",ref:O,modelValue:k(a),"onUpdate:modelValue":C[2]||(C[2]=q=>ee(a)?a.value=q:null),option:k(Xe),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),f.value===1?(T(),$(Ze,{key:1,modelValue:k(a).formOption,"onUpdate:modelValue":C[3]||(C[3]=q=>k(a).formOption=q),fields:v.value},null,8,["modelValue","fields"])):B("",!0),f.value===2?(T(),$(be,{key:2,modelValue:k(a).flowData,"onUpdate:modelValue":C[4]||(C[4]=q=>k(a).flowData=q),"flow-form-option":k(a).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),f.value===3?(T(),$(St,{key:3,icon:"success",title:"流程设计完成"},{extra:w(()=>[k(a).flowDeployId?B("",!0):(T(),$(re,{key:0,type:"primary",onClick:N},{default:w(()=>[P(" 发布 ")]),_:1})),g(re,{onClick:R},{default:w(()=>[P(" 关闭 ")]),_:1})]),_:1})):B("",!0)])),[[Ft,i.value]])]),_:1},8,["modelValue"])}}}),Vl=Q("span",null,"流程查看",-1),Dl={key:0},Tl={key:1},xl=A({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(e){const o=me(e),{visible:p,modelValue:n}=o,{getDetail:a}=Ge(),{getDetail:c}=Je(),l=I("form"),s=I(!1);pe(p,async _=>{if(!_)return;const{flowModuleId:r}=n.value,{flowDeployId:d}=n.value;try{s.value=!0;let i={};d?i=await c({flowDeployId:d}):r&&(i=await a({flowModuleId:r})),n.value={...i.data}}finally{s.value=!1}},{immediate:!0});function m(){n.value={},l.value="form"}return(_,r)=>{const d=V("el-tab-pane"),i=V("el-tabs"),y=V("el-dialog"),b=ct("loading");return T(),$(y,{modelValue:k(p),"onUpdate:modelValue":r[3]||(r[3]=u=>ee(p)?p.value=u:null),width:"60%",top:"0",onClose:m},{header:w(()=>{var u,v,f,h;return[Vl,(u=k(n))!=null&&u.flowName?(T(),E("span",Dl," - "+j((v=k(n))==null?void 0:v.flowName),1)):B("",!0),(f=k(n))!=null&&f.version?(T(),E("span",Tl," - V"+j((h=k(n))==null?void 0:h.version),1)):B("",!0)]}),default:w(()=>[dt((T(),$(i,{modelValue:l.value,"onUpdate:modelValue":r[2]||(r[2]=u=>l.value=u)},{default:w(()=>[g(d,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:w(()=>[l.value==="form"&&k(n).formOption?(T(),$(Ze,{key:0,modelValue:k(n).formOption,"onUpdate:modelValue":r[0]||(r[0]=u=>k(n).formOption=u),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),g(d,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:w(()=>[l.value==="flow"?(T(),$(be,{key:0,modelValue:k(n).flowData,"onUpdate:modelValue":r[1]||(r[1]=u=>k(n).flowData=u),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[b,s.value]])]),_:1},8,["modelValue"])}}}),Ll=A({__name:"index",setup(e){const t=I("definition"),o=I({}),p=I(""),n=I("");function a(y){p.value===y.id?p.value="":p.value=y.id}const c=I(!1),l=I(!1);function s(){o.value={},c.value=!0}function m(y){o.value=y,c.value=!0}function _(y){o.value=y,l.value=!0}function r(y){n.value=y.flowModuleId||"",t.value="deploy"}function d(){n.value="",t.value="definition"}async function i(){const y=t.value;await _e(),t.value="",await _e(),t.value=`${y}`}return(y,b)=>{const u=V("el-col"),v=V("el-row");return T(),$(v,{gutter:20},{default:w(()=>[g(u,{span:4},{default:w(()=>[g(bl,{onNodeClick:a})]),_:1}),g(u,{span:20},{default:w(()=>[t.value==="definition"?(T(),$(Ot,{key:0,"category-id":p.value,onAdd:s,onEdit:m,onView:_,onVersion:r},null,8,["category-id"])):B("",!0),t.value==="deploy"?(T(),$($t,{key:1,"flow-module-id":n.value,onEdit:m,onView:_,onBack:d},null,8,["flow-module-id"])):B("",!0),g(Cl,{modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=f=>o.value=f),visible:c.value,"onUpdate:visible":b[1]||(b[1]=f=>c.value=f),onClose:i},null,8,["modelValue","visible"]),g(xl,{modelValue:o.value,"onUpdate:modelValue":b[2]||(b[2]=f=>o.value=f),visible:l.value,"onUpdate:visible":b[3]||(b[3]=f=>l.value=f)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Nl=[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),Il=[{label:"审批人",prop:"assignee"},{label:"节点名称",prop:"taskNodeName"},{label:"接收时间",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"结束时间",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"耗时",prop:"duration"},{label:"传阅意见",prop:"comment"}].map(e=>({...e,hide:!0})),Ol={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Nl,...Il]},$l=A({__name:"index",setup(e){const t=ao("debugMode",!1),{getTaskOpsList:o}=pl(),{getCirculateOpsList:p,updateCirculate:n,removeCirculate:a}=Tt(),{bindVal:c,getDataList:l,crudStateRefs:{searchForm:s,crudOption:m}}=Z({tableOption:Ol,crudOption:{getList:o},searchForm:{status:2},sortOption:{descs:"start_time"}});xe(s,l,{debounce:300,immediate:!0,deep:!0});const _=I("task"),r=[{label:"任务",name:"task",getList:o},{label:"传阅",name:"circulate",getList:p,update:n,remove:a}];function d({paneName:u}){const v=r.find(f=>f.name===u);m.value.getList=v.getList,m.value.update=v.update,m.value.remove=v.remove,l()}const{open:i,close:y}=kt({onComplete:()=>(y(),l())},{type:"drawer"});function b(u){i({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,debug:t.value,circulateId:u.id})}return(u,v)=>{const f=V("el-tab-pane"),h=V("el-tabs"),D=V("el-switch"),O=V("el-button"),F=V("el-link"),N=V("avue-crud");return T(),E(W,null,[g(h,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=R=>_.value=R),onTabClick:d},{default:w(()=>[(T(),E(W,null,X(r,R=>g(f,{key:R.name,label:R.label,name:R.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(N,Qt(k(c),{permission:{menu:_.value==="circulate"}}),{"menu-right":w(()=>[g(O,{type:"text"},{default:w(()=>[g(D,{modelValue:k(t),"onUpdate:modelValue":v[1]||(v[1]=R=>ee(t)?t.value=R:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:w(({row:R})=>[g(F,{type:"primary",underline:!1,onClick:S=>b(R)},{default:w(()=>[P(j(R.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Sl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ae},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},Rl=A({__name:"index",setup(e){const{bindVal:t,getDataList:o}=Z({tableOption:Sl,crudOption:fe()});return o(),(p,n)=>{const a=V("avue-crud");return T(),$(a,oe(le(k(t))),null,16)}}}),Fl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},Pl={class:"flow-list"},Ul=["onClick"],El={class:"flow-name"},Al=A({__name:"index",setup(e){const t=I([]),{getPublishList:o,getTaskList:p}=Le(),{getCirculateList:n}=Tt();o().then(u=>{t.value=u.data});const a=[{label:"待办",value:2},{label:"已办",value:1}],{bindVal:c,getDataList:l,crudStateRefs:{searchForm:s,crudOption:m}}=Z({tableOption:Fl,crudOption:{getList:p},searchForm:{status:2}});xe(s,l,{debounce:300,immediate:!0,deep:!0});const _=I("task"),r=[{label:"任务",name:"task",getList:p},{label:"传阅",name:"circulate",getList:n}];function d({paneName:u}){const v=r.find(f=>f.name===u);m.value.getList=v.getList,l()}const{open:i,close:y}=kt({onComplete:()=>(y(),l())},{type:"drawer"});function b(u){i({flowKey:u.flowKey,taskId:u.taskId,instanceId:u.flowInstanceId,circulateId:u.id,detail:u.taskId?u.status===gt.已办:!1})}return(u,v)=>{const f=V("el-button"),h=V("el-collapse-item"),D=V("el-collapse"),O=V("el-card"),F=V("el-divider"),N=V("el-tab-pane"),R=V("el-tabs"),S=V("avue-radio"),C=V("el-link"),x=V("avue-crud");return T(),E(W,null,[g(O,{"body-style":{padding:"0 20px"}},{default:w(()=>[g(D,{"model-value":"1"},{default:w(()=>[g(h,{name:"1"},{title:w(()=>[g(f,{text:"",icon:"el-icon-promotion"},{default:w(()=>[P(" 发起审批 ")]),_:1})]),default:w(()=>[Q("div",Pl,[(T(!0),E(W,null,X(t.value,L=>(T(),E("div",{key:L.flowKey,class:"flow-item",onClick:K=>b(L)},[g(k(se),{class:"flow-icon",icon:L.flowIcon,width:"60"},null,8,["icon"]),Q("div",El,j(L.flowName),1)],8,Ul))),128))])]),_:1})]),_:1})]),_:1}),g(F,{direction:"horizontal","content-position":"left"}),g(R,{modelValue:_.value,"onUpdate:modelValue":v[0]||(v[0]=L=>_.value=L),onTabClick:d},{default:w(()=>[(T(),E(W,null,X(r,L=>g(N,{key:L.name,label:L.label,name:L.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),g(x,oe(le(k(c))),{"menu-left":w(()=>[g(S,{modelValue:k(s).status,"onUpdate:modelValue":v[1]||(v[1]=L=>k(s).status=L),button:"",dic:a},null,8,["modelValue"])]),processTitle:w(({row:L})=>[g(C,{type:"primary",underline:!1,onClick:K=>b(L)},{default:w(()=>[P(j(L.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}});const Kl=Te(Al,[["__scopeId","data-v-e1f72e36"]]),Ml={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程模型数据",prop:"flowData",display:!1},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},Bl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:p,handleUpdate:n}=Z({tableOption:Ml,crudOption:Lt()});p();const a=I(!1);async function c(s){o.value=s,a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(s,m)=>{const _=V("el-button"),r=V("avue-crud"),d=V("el-dialog");return T(),E(W,null,[g(r,oe(le(k(t))),{flowData:w(({row:i})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(i)},{default:w(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=i=>a.value=i),title:`模型设计-${k(o).flowName}`,fullscreen:"","destroy-on-close":""},{footer:w(()=>[g(_,{type:"primary",onClick:l},{default:w(()=>[P(" 保存 ")]),_:1}),g(_,{onClick:m[1]||(m[1]=i=>a.value=!1)},{default:w(()=>[P(" 取消 ")]),_:1})]),default:w(()=>[g(be,{modelValue:k(o).flowData,"onUpdate:modelValue":m[0]||(m[0]=i=>k(o).flowData=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),jl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单配置",prop:"formOption",display:!1},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},Hl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o},getDataList:p,handleUpdate:n}=Z({tableOption:jl,crudOption:Nt()});p();const a=I(!1);async function c(s){o.value={...s},a.value=!0}async function l(){await n(o.value,NaN,()=>a.value=!1,()=>{})}return(s,m)=>{const _=V("el-button"),r=V("avue-crud"),d=V("el-dialog");return T(),E(W,null,[g(r,oe(le(k(t))),{formOption:w(({row:i})=>[g(_,{type:"primary",text:"",icon:"el-icon-crop",onClick:y=>c(i)},{default:w(()=>[P(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),g(d,{modelValue:a.value,"onUpdate:modelValue":m[2]||(m[2]=i=>a.value=i),title:`表单设计-${k(o).formName}`,fullscreen:"","destroy-on-close":""},{footer:w(()=>[g(_,{type:"primary",onClick:l},{default:w(()=>[P(" 保存 ")]),_:1}),g(_,{onClick:m[1]||(m[1]=i=>a.value=!1)},{default:w(()=>[P(" 取消 ")]),_:1})]),default:w(()=>[g(Ze,{modelValue:k(o).formOption,"onUpdate:modelValue":m[0]||(m[0]=i=>k(o).formOption=i),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),rt=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:ne(It)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}],zl={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary"},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:rt}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:rt}}]},Wl=Q("br",null,null,-1),Yl=A({__name:"index",setup(e){const{bindVal:t,crudStateRefs:{formData:o,defaults:p},getDataList:n,afterOpen:a,beforeSubmit:c}=Z({crudOption:Ke(),tableOption:zl});n();const{data:l}=fe().useParam("table.default.fields");a(d=>{if(o.value.defaultFields=l.value??[],d==="edit"){const i=JSON.parse(o.value.tableFields);o.value.editFields=ft(i,l.value??[],"name")}}),c(d=>{const i=[...d.defaultFields,...d.editFields];d.tableFields=JSON.stringify(i)});const s=I(!1);J(()=>{var d;(d=p.value)!=null&&d.defaultFields&&(p.value.defaultFields.display=s.value)});const{deploy:m}=Ke(),_=I(!1);async function r(d){await de.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),_.value=!0,m({id:d.id}).then(()=>{G.success("部署成功"),n()}).finally(()=>{_.value=!1})}return(d,i)=>{const y=V("el-button"),b=V("el-switch"),u=V("el-tooltip"),v=V("avue-crud");return T(),$(v,oe(le(k(t))),{menu:w(({row:f})=>[g(y,{type:"text",icon:"el-icon-upload",onClick:h=>r(f)},{default:w(()=>[P(" 部署 ")]),_:2},1032,["onClick"])]),"editFields-label":w(()=>[Q("div",null,[P(" 数据库字段 "),Wl,g(u,{content:"显示默认字段"},{default:w(()=>[g(b,{modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=f=>s.value=f)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),en={install(e,t){e.component("FlowButton",vl).component("FlowDefinition",Ot).component("FlowDeploy",$t).component("FlowForm",We).component("FlowManage",Ll).component("FlowOps",$l).component("FlowParam",Rl).component("FlowTemplate",Bl).component("FormTemplate",Hl).component("TableTemplate",Yl).component("FlowWorkbench",Kl),z(e,t)}};export{ul as CONFIG_DEFAULT,nt as CONFIG_PROVIDE_KEY,vl as FlowButton,Ot as FlowDefinition,$t as FlowDeploy,We as FlowForm,Ll as FlowManage,$l as FlowOps,Rl as FlowParam,Bl as FlowTemplate,Kl as FlowWorkbench,Hl as FormTemplate,Yl as TableTemplate,Ct as Whether,en as default,el as resolveFlowFormComponent,z as useConfigProvider,kt as useFlowForm,Zo as useFlowFormOverlay,Xo as useFlowFormWindow,Ae as whetherDic};
