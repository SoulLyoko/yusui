import{d as rt}from"./index.a2682797.js";import{s as st,a as $e,e as W,u as ut}from"./index.ed326d4b.js";import{I as Ke}from"./iconify.a7519ee4.js";import{_ as it,a as ct,d as dt}from"./index.81c79613.js";import"./index.8d913286.js";import{j as pt}from"./tree.faa3b0d0.js";import{f as we,t as Be,a as ft}from"./vuedraggable.umd.3ed62a2a.js";import{X as he,B as de,r as L,s as se,b as P,e as q,w as pe,i as le,u as D,n as ke,Y as mt,L as vt,h as Y,H as R,k as j,R as te,F as G,j as V,D as A,E as x,J as E,p as F,q as H,a3 as Oe,C as Z,_ as Te,G as J,K as bt,I as yt,N as Re,a9 as gt,d as wt,a7 as _t,a8 as ht}from"./framework.87994f31.js";import{u as fe,w as je,c as kt}from"./theme.cdcbae00.js";import{p as Tt}from"./index.vue_vue_type_script_setup_true_lang.b05f95f4.js";import{E as oe,m as Ct}from"./index.05b719a1.js";import{d as Nt}from"./differenceBy.3d5e1611.js";import{D as re}from"./index.4aada9e5.js";const Dt={},Vt=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),xt=()=>Dt,Q=e=>e,_e=e=>Array.isArray(e),Ce=e=>e!==null&&typeof e=="object",Ne=e=>e instanceof Function,ne=e=>e==null,De=typeof window>"u",Me=()=>{var e;return De||ne((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},It=()=>{var e,t;return(e=!De&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},ve=()=>new Promise(()=>{}),z=e=>le(e)?e.value:e,Lt=e=>Ce(e)?Object.assign(_e(e)?[]:{},e):e,ue=new Map,Ot=e=>ne(e)?void 0:ue.get(e),Rt=(e,t,a)=>{const p=ue.get(e);p!=null&&p.timer&&clearTimeout(p.timer);const o=setTimeout(()=>ue.delete(e),t);ue.set(e,{...a,timer:o})};function Fe(e,t,a){let p,o,i,c,l,d,u=0,g=!1,s=!1,w=!0;const r=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,Ce(a)&&(g=!!a.leading,s="maxWait"in a,i=s?Math.max(+a.maxWait||0,t):i,w="trailing"in a?!!a.trailing:w);function b(h){const k=p,N=o;return p=o=void 0,u=h,c=e.apply(N,k),c}function y(h,k){return r?(window.cancelAnimationFrame(l),window.requestAnimationFrame(h)):setTimeout(h,k)}function f(h){if(r)return window.cancelAnimationFrame(h);clearTimeout(h)}function n(h){return u=h,l=y(_,t),g?b(h):c}function m(h){const k=h-d,N=h-u,K=t-k;return s?Math.min(K,i-N):K}function v(h){const k=h-d,N=h-u;return d===void 0||k>=t||k<0||s&&N>=i}function _(){const h=Date.now();if(v(h))return T(h);l=y(_,m(h))}function T(h){return l=void 0,w&&p?b(h):(p=o=void 0,c)}function I(){l!==void 0&&f(l),u=0,p=d=o=l=void 0}function C(){return l===void 0?c:T(Date.now())}function S(){return l!==void 0}function O(){const h=Date.now(),k=v(h);for(var N=arguments.length,K=new Array(N),B=0;B<N;B++)K[B]=arguments[B];if(p=K,o=this,d=h,k){if(l===void 0)return n(d);if(s)return l=y(_,t),b(d)}return l===void 0&&(l=y(_,t)),c}return O.cancel=I,O.flush=C,O.pending=S,O}function Et(e,t,a){let p=!0,o=!0;if(typeof e!="function")throw new TypeError("Expected a function");return Ce(a)&&(p="leading"in a?!!a.leading:p,o="trailing"in a?!!a.trailing:o),Fe(e,t,{leading:p,trailing:o,maxWait:t})}var St=Q((e,t)=>{let{debounceInterval:a,debounceOptions:p,manual:o}=t;const i=L(!1),c=L(),l=P(()=>p),d=P(()=>z(a)),u=L(e.context.runAsync);return o||(i.value=!0),q(g=>{ne(d.value)||(c.value=Fe(s=>s(),d.value,l.value),e.context.runAsync=function(){for(var s=arguments.length,w=new Array(s),r=0;r<s;r++)w[r]=arguments[r];return new Promise((b,y)=>{i.value?(i.value=!1,u.value(...w).then(b).catch(y)):c.value(()=>{u.value(...w).then(b).catch(y)})})},g(()=>{var s;(s=c.value)===null||s===void 0||s.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var g;(g=c.value)===null||g===void 0||g.cancel()}}}),Pt=Q((e,t)=>{let{errorRetryCount:a=0,errorRetryInterval:p=0}=t;const o=L(),i=L(0),c=P(()=>z(a)),l=P(()=>z(p));let d=!1;const u=()=>{i.value=0},g=P(()=>{if(l.value)return l.value;const r=1e3,b=1,y=9,f=Math.floor(Math.random()*2**Math.min(i.value,y)+b);return r*f}),s=()=>{let r;const b=c.value===-1,y=i.value<c.value;return(b||y)&&(b||(i.value+=1),r=setTimeout(()=>{d=!0,e.context.refresh()},g.value)),()=>r&&clearTimeout(r)},w=()=>{o.value&&o.value()};return{onBefore(){d||u(),d=!1,w()},onSuccess(){u()},onError(){o.value=s()},onCancel(){u(),w()}}}),At=Q((e,t)=>{let{ready:a=L(!0),manual:p,defaultParams:o=[]}=t;return pe(a,i=>{!p&&i&&e.context.run(...o)},{flush:"sync"}),{onBefore(){if(!(Ne(a)?a():a.value))return e.loading.value=!1,{isBreak:!0}}}}),Ut=Q((e,t)=>{let{refreshDeps:a,refreshDepsAction:p,manual:o}=t;if(a===void 0||_e(a)&&a.length===0)return{};const i=_e(a)?a:[a];return pe(i,()=>{p?p():!o&&e.context.refresh()}),{}}),$t=Q((e,t)=>{let{throttleInterval:a,throttleOptions:p}=t;const o=L(),i=P(()=>z(a)),c=P(()=>p),l=L(e.context.runAsync);return q(d=>{if(ne(a))return{};o.value=Et(u=>u(),i.value,c.value),e.context.runAsync=function(){for(var u=arguments.length,g=new Array(u),s=0;s<u;s++)g[s]=arguments[s];return new Promise((w,r)=>{o.value(()=>{l.value(...g).then(w).catch(r)})})},d(()=>{var u;(u=o.value)===null||u===void 0||u.cancel(),e.context.runAsync=l.value})}),{onCancel(){var d;(d=o.value)===null||d===void 0||d.cancel()}}});const Kt=(e,t)=>a=>{Object.keys(a).forEach(p=>{e[p].value=a[p]}),t.forEach(p=>p(e))},Bt=(e,t)=>()=>{let a=t;for(let p=e.length;p-- >0;)a=e[p](a);return a()},jt=(e,t,a)=>{var p,o;const{initialData:i,onSuccess:c,onError:l,onBefore:d,onAfter:u}=t,g=L((p=a==null?void 0:a.loading)!==null&&p!==void 0?p:!1),s=se((o=a==null?void 0:a.data)!==null&&o!==void 0?o:i),w=se(a==null?void 0:a.error),r=L(a==null?void 0:a.params),b=L([]),y=se("pending"),f={},n=Kt({status:y,loading:g,data:s,error:w,params:r},[]),m=function(_){for(var T=arguments.length,I=new Array(T>1?T-1:0),C=1;C<T;C++)I[C-1]=arguments[C];if(_==="onQuery"){const S=b.value.map(O=>O.onQuery).filter(Boolean);return{servicePromise:Bt(S,I[0])()}}else{const S=b.value.map(O=>{var h;return(h=O[_])===null||h===void 0?void 0:h.call(O,...I)});return Object.assign({},...S)}},v=L(0);return f.runAsync=async function(){for(var _=arguments.length,T=new Array(_),I=0;I<_;I++)T[I]=arguments[I];n({loading:!0,params:T,status:"pending"}),v.value+=1;const C=v.value,{isBreak:S,breakResult:O=ve()}=m("onBefore",T);if(S)return n({status:"settled"}),O;d==null||d(T);try{const h=()=>new Promise(K=>K(e(...r.value)));let{servicePromise:k}=m("onQuery",h);k||(k=h());const N=await k;return C!==v.value?ve():(n({data:N,loading:!1,error:void 0,status:"settled"}),m("onSuccess",N,T),c==null||c(N,T),C===v.value&&m("onAfter",T,N,void 0),u==null||u(T),N)}catch(h){if(C!==v.value)return ve();throw n({loading:!1,error:h,status:"settled"}),m("onError",h,T),l==null||l(h,T),C===v.value&&m("onAfter",T,void 0,h),u==null||u(T),h}},f.run=function(){f.runAsync(...arguments).catch(_=>{l||console.error(_)})},f.cancel=()=>{v.value+=1,n({loading:!1}),m("onCancel")},f.refresh=()=>{f.run(...r.value||[])},f.refreshAsync=()=>f.runAsync(...r.value||[]),f.mutate=_=>{const T=Ne(_)?_(s.value):_,I=Lt(T);n({data:I}),m("onMutate",I)},{status:y,loading:g,data:s,error:w,params:r,plugins:b,context:f}};function Mt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const p=he(Vt,{}),o={...xt(),...p,...t},{manual:i=!1,defaultParams:c=[]}=o,l=jt(e,o);if(l.plugins.value=a.map(d=>d(l,o)),!i){const d=l.params.value||c;l.context.run(...d)}return de(()=>{l.context.cancel()}),{loading:l.loading,data:l.data,error:l.error,params:l.params,cancel:l.context.cancel,refresh:l.context.refresh,refreshAsync:l.context.refreshAsync,mutate:l.context.mutate,run:l.context.run,runAsync:l.context.runAsync}}const ie=new Map,Ft=(e,t)=>{ie.set(e,t),t.then(a=>(ie.delete(e),a)).catch(()=>{ie.delete(e)})},Ht=e=>ie.get(e),X=new Map,Yt=(e,t)=>{X.has(e)&&X.get(e).forEach(a=>a(t))},zt=(e,t)=>(X.has(e)?X.get(e).push(t):X.set(e,[t]),()=>{const a=X.get(e).indexOf(t);X.get(e).splice(a,1)});var Wt=Q((e,t)=>{let{cacheKey:a,cacheTime:p=6e5,staleTime:o=0,getCache:i,setCache:c}=t;if(!a)return{};const l=Ne(a)?a:()=>a,d=L(()=>{});let u;const g=n=>i?i(n):Ot(n),s=(n,m,v)=>{c?c(n,v):Rt(n,m,v),Yt(n,v.data)},w=n=>o===-1||n+o>new Date().getTime(),r=(n,m)=>Object.prototype.hasOwnProperty.call(n,m),b=n=>{const m=l(n);return zt(m,v=>{e.data.value=v})},y=l(),f=g(y);return f&&r(f,"data")&&(e.data.value=f.data,e.params.value=f.params),y&&(d.value=b()),de(()=>{d.value()}),{onBefore(n){const m=l(n),v=g(m);if(!v||!r(v,"data"))return{};if(w(v.time))return e.data.value=v.data,e.loading.value=!1,{isBreak:!0,breakResult:v.data};e.data.value=v.data},onQuery(n){const m=e.params.value,v=l(m);let _=Ht(v);return _&&_!==u?()=>_:(_=n(),u=_,Ft(v,_),()=>_)},onSuccess(n,m){const v=l(m);v&&(d.value(),s(v,p,{data:n,params:m,time:new Date().getTime()}),d.value=b(m))},onMutate(n){const m=l(e.params.value);m&&(d.value(),s(m,p,{data:n,params:e.params.value,time:new Date().getTime()}),d.value=b(e.params.value))}}});function Gt(e){let t,a;class p extends Promise{constructor(i){super(i),this.cancel=()=>{a(),clearTimeout(t)}}}return new p(o=>{a=o,t=setTimeout(a,e)})}function be(){return new Date().getTime()}var Qt=Q((e,t)=>{let{loadingDelay:a=0,loadingKeep:p=0}=t;const o=L(()=>{}),i=P(()=>z(a)),c=P(()=>z(p));let l=0,d={};const u=()=>{let g;return i.value&&(g=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},i.value)),()=>g&&clearTimeout(g)};return{onBefore(){e.loading.value=!i.value,o.value(),o.value=u(),l=be()},onQuery(g){if(!c.value)return()=>g();d=Gt(c.value+i.value);const s=async()=>{try{const r=await g();return be()-l<=i.value&&d.cancel(),Promise.resolve(r)}catch(r){return be()-l<=i.value&&d.cancel(),Promise.reject(r)}},w=Promise.allSettled([s(),d]).then(r=>{const b=r[0];return b.status==="fulfilled"?b.value:Promise.reject(b.reason)});return()=>w},onCancel(){o.value()},onAfter(){o.value()}}}),ye;const He=new Set,Ye=new Set,ze=new Set,ce=(e,t)=>{let a;switch(e){case"FOCUS_LISTENER":a=He;break;case"RECONNECT_LISTENER":a=ze;break;case"VISIBLE_LISTENER":a=Ye;break}if(!a.has(t))return a.add(t),()=>{a.delete(t)}},ge=e=>{e.forEach(t=>{t()})};!De&&(ye=window)!==null&&ye!==void 0&&ye.addEventListener&&(window.addEventListener("visibilitychange",()=>{Me()&&ge(Ye)},!1),window.addEventListener("focus",()=>ge(He),!1),window.addEventListener("online",()=>ge(ze),!1));var qt=Q((e,t)=>{let{pollingInterval:a,pollingWhenHidden:p=!1,pollingWhenOffline:o=!1,errorRetryCount:i=0}=t;const c=L(),l=L(!1),d=P(()=>z(a)),u=P(()=>z(i)),g=[],s=y=>{y&&g.push(y)},w=()=>(p||Me())&&(o||It()),r=y=>{if(e.error.value&&u.value!==0)return;let f;if(!ne(d.value)&&d.value>=0)if(w())f=setTimeout(y,d.value);else{l.value=!0;return}return()=>f&&clearTimeout(f)},b=()=>{l.value&&w()&&(e.context.refresh(),l.value=!1)};return pe(d,()=>{c.value&&(c.value(),c.value=r(()=>e.context.refresh()))}),p||s(ce("VISIBLE_LISTENER",b)),o||s(ce("RECONNECT_LISTENER",b)),de(()=>{g.forEach(y=>y())}),{onBefore(){var y;(y=c.value)===null||y===void 0||y.call(c)},onCancel(){var y;(y=c.value)===null||y===void 0||y.call(c)},onAfter(){c.value=r(()=>e.context.refresh())}}});const Jt=(e,t)=>{let a=!1;return function(){a||(a=!0,e(...arguments),setTimeout(()=>{a=!1},t))}};var Xt=Q((e,t)=>{let{refreshOnWindowFocus:a=!1,refocusTimespan:p=5e3}=t;const o=P(()=>z(a)),i=P(()=>z(p)),c=[],l=u=>{u&&c.push(u)},d=()=>{c.forEach(u=>u())};return q(()=>{if(d(),o.value){const u=Jt(e.context.refresh,i.value);l(ce("VISIBLE_LISTENER",u)),l(ce("FOCUS_LISTENER",u))}}),de(()=>{d()}),{}});function ae(e,t){return Mt(e,t,[Qt,Pt,St,qt,$t,Xt,Ut,At,Wt])}var Zt=(e=>(e[e.已办=1]="已办",e[e.待办=2]="待办",e[e.失败=3]="失败",e[e.撤销=4]="撤销",e[e.终止=5]="终止",e))(Zt||{});function Ve(){const{request:e}=M(),t={publishList:"/sapier-flow/flow-run/queryPublishFlowList",taskList:"/sapier-flow/flow-run/userTaskList",detail:"/sapier-flow/flow-run/queryPublishFlowDetail",approvalNode:"/sapier-flow/flow-run/queryApprovalNode",start:"/sapier-flow/flow-run/startProcess",commit:"/sapier-flow/flow-run/commitTask",draft:"/sapier-flow/flow-run/saveDraft",revoke:"/sapier-flow/flow-run/revokeTask",terminate:"/sapier-flow/flow-run/terminateFlow",withdraw:"/sapier-flow/flow-run/withdrawToStart",transfer:"/sapier-flow/flow-run/transferTask",reject:"/sapier-flow/flow-run/rollbackTask",green:"/sapier-flow/flow-run/greenTask",circulate:"/sapier-flow/flow-circulate/commitTask"},a=n=>e.get(t.detail,{params:n}),p=n=>e.post(t.approvalNode,n),o=n=>e.post(t.start,n),i=n=>e.post(t.commit,n),c=n=>e.post(t.draft,n),l=n=>e.post(t.revoke,n),d=n=>e.post(t.terminate,n),u=n=>e.post(t.withdraw,n),g=n=>e.post(t.transfer,n),s=n=>e.post(t.reject,n),w=n=>e.post(t.circulate,n),r=n=>e.post(t.green,n),b=()=>e.get(t.publishList);return{url:t,getFlowDetail:a,getApprovalNode:p,startTask:o,commitTask:i,saveDraft:c,revokeTask:l,terminateTask:d,withdrawTask:u,transferTask:g,rejectTask:s,greenChannel:r,circulateTask:w,getPublishList:b,usePublishList:()=>ae(()=>b().then(n=>n.data)),getTaskList:n=>e.get(t.taskList,{params:n})}}function ea(e){const{commitTask:t,revokeTask:a,saveDraft:p,startTask:o,terminateTask:i,transferTask:c,withdrawTask:l,rejectTask:d,greenChannel:u,circulateTask:g}=Ve(),{buttonHandler:s}=M(),w=P(()=>{const{flowDetail:b,formVariables:y,approvalFormData:f,debug:n,fileIds:m}=e,{flowDeployId:v}=b.value.process??{},{taskId:_,flowInstanceId:T}=b.value.task??{};return{flowDeployId:v,taskId:_,flowInstanceId:T,variables:y.value,debug:n.value,fileIds:m==null?void 0:m.value,...f.value}}),r=()=>w.value.taskId&&w.value.flowInstanceId;return{flow_draft(){if(r())return p(w.value)},flow_pass(){return r()?t(w.value):o(w.value)},flow_revoke(){if(r())return a(w.value)},flow_withdraw(){if(r())return l(w.value)},flow_terminate(){if(r())return i(w.value)},flow_transfer(){if(r())return c(w.value)},flow_reject(){if(r())return d(w.value)},flow_green(){if(r())return u(w.value)},flow_circulate(){if(r()){const{approvalFormData:b,circulateId:y}=e;return g({id:y==null?void 0:y.value,comment:b==null?void 0:b.value.comment})}},...s==null?void 0:s(e)}}function ta(e){const t=L({});return q(async()=>{var p;const{formProperty:a}=((p=D(e))==null?void 0:p.properties)||{};a!=null&&a.length&&(await ke(),Object.keys(t.value).forEach(o=>{var l,d,u,g;const i=((l=t.value[o])==null?void 0:l.label)||"",c=a==null?void 0:a.find(s=>s.prop===o);if(t.value[o].display=c==null?void 0:c.display,t.value[o].disabled=c==null?void 0:c.disabled,t.value[o].detail=c==null?void 0:c.detail,t.value[o].readonly=c==null?void 0:c.readonly,t.value[o].rules=t.value[o].rules??[],c!=null&&c.required&&((d=t.value[o].rules)!=null&&d.some(s=>s.required)))return null;c!=null&&c.required?(u=t.value[o].rules)==null||u.push({required:!0,message:`${i}为必填项`}):t.value[o].rules=(g=t.value[o].rules)==null?void 0:g.filter(s=>!s.required)}))}),t}const aa={modelValue:{type:Object,default:()=>({})},title:{type:String},flowDetail:{type:Object,default:()=>({})},formLoading:{type:Boolean},submitLoading:{type:Boolean},activeTab:{type:String,default:"formTab"},activeBtn:{type:Object,default:()=>({})},approvalVisible:{type:Boolean},approvalFormData:{type:Object,default:()=>({})},flowKey:{type:String},taskId:{type:String},instanceId:{type:String},formId:{type:String},fileIds:{type:String},permission:{type:Object},beforeClick:{type:Function},beforeSubmit:{type:Function},detail:{type:Boolean},debug:{type:Boolean},circulateId:{type:String}},oa={complete:e=>e};function la(){const{request:e}=M(),t={list:"/sapier-flow/flow-user-common/list",save:"/sapier-flow/flow-user-common/save",update:"/sapier-flow/flow-user-common/update",remove:"/sapier-flow/flow-user-common/remove",batchUpdate:"/sapier-flow/flow-user-common/batchUpdate"},a=d=>e.get(t.list,{params:{type:d,ascs:"sort"}});return{url:t,getList:a,useList:d=>ae(()=>a(d.value).then(u=>u.data.records),{refreshDeps:[d]}),create:d=>e.post(t.save,d),update:d=>e.post(t.update,d),remove:d=>e.post(t.remove,{},{params:{ids:d}}),batchUpdate:d=>e.post(t.batchUpdate,d)}}var We=(e=>(e.默认="default",e.主要="primary",e.成功="success",e.警告="warning",e.危险="danger",e.信息="info",e.文字="text",e))(We||{}),xe=(e=>(e.显示="true",e.隐藏="false",e.发起人="startUser",e.处理人="assignee",e.已办="done",e.待办="todo",e.未发起="notstarted",e.已发起="started",e.未办结="unfinished",e.已办结="finished",e))(xe||{}),Ie=(e=>(e.不显示="false",e.指定节点="specifyNode",e.审批人="assignee",e.传阅人="circulate",e.意见="comment",e))(Ie||{}),Ge=(e=>(e[e.禁用=0]="禁用",e[e.正常=1]="正常",e))(Ge||{});function Qe(){const{request:e}=M(),t={list:"/sapier-flow/dev-button/list",save:"/sapier-flow/dev-button/save",update:"/sapier-flow/dev-button/update",remove:"/sapier-flow/dev-button/remove"},a=l=>e.get(t.list,{params:l});return{url:t,getList:a,useList:()=>ae(()=>a({size:-1,ascs:"sort"}).then(l=>l.data.records)),create:l=>e.post(t.save,l),update:l=>e.post(t.update,l),remove:l=>e.post(t.remove,{},{params:{ids:l}})}}function na(){const{request:e}=M(),t={list:"/sapier-flow/flow-file/list",save:"/sapier-flow/flow-file/save",remove:"/sapier-flow/flow-file/remove"};return{getList:i=>e.get(t.list,{params:i}),create:i=>e.post(t.save,i),remove:i=>e.post(t.remove,{},{params:{ids:i}})}}function me(){const{request:e}=M(),t={list:"/sapier-flow/flow-param/list",save:"/sapier-flow/flow-param/save",update:"/sapier-flow/flow-param/update",remove:"/sapier-flow/flow-param/remove",all:"/sapier-flow/flow-param/getAllParam",key:"/sapier-flow/flow-param/getParam"},a=u=>e.get(t.list,{params:u}),p=()=>e.get(t.all),o=u=>e.get(t.key,{params:{paramKey:u}});return{url:t,getList:a,getAllParam:p,getParam:o,useParam:u=>ae(()=>o(u).then(g=>g.data)),create:u=>e.post(t.save,u),update:u=>e.post(t.update,u),remove:u=>e.post(t.remove,{},{params:{ids:u}})}}function ra(){const{request:e}=M(),t={tree:"/sapier-flow/flow-user/tree"},a=o=>e.get(t.tree,{params:{filter:o}});return{url:t,getUserTree:a,useUserTree:()=>ae(()=>a().then(o=>o.data))}}var qe=(e=>(e.ASSIGN_ID="ASSIGN_ID",e.ASSIGN_UUID="ASSIGN_UUID",e.AUTO="AUTO",e.INPUT="INPUT",e.NONE="NONE",e))(qe||{}),Je=(e=>(e.bigint="bigint",e.blob="blob",e.char="char",e.date="date",e.datetime="datetime",e.decimal="decimal",e.double="double",e.enum="enum",e.float="float",e.int="int",e.longblob="longblob",e.longtext="longtext",e.mediumblob="mediumblob",e.mediumint="mediumint",e.mediumtext="mediumtext",e.set="set",e.smallint="smallint",e.text="text",e.time="time",e.timestamp="timestamp",e.tinyblob="tinyblob",e.tinyint="tinyint",e.tinytext="tinytext",e.varbinary="varbinary",e.varchar="varchar",e.year="year",e))(Je||{});function Ma(){const{request:e}=M(),t={list:"/sapier-flow/dev-table/list",save:"/sapier-flow/dev-table/save",update:"/sapier-flow/dev-table/update",remove:"/sapier-flow/dev-table/remove",deploy:"/sapier-flow/dev-table/deploy",getFields:"/sapier-flow/dev-table/getTableFields"},a=u=>e.get(t.list,{params:u});return{url:t,getList:a,useList:()=>ae(()=>a({size:-1}).then(u=>u.data.records)),create:u=>e.post(t.save,u),update:u=>e.post(t.update,u),remove:u=>e.post(t.remove,{},{params:{ids:u}}),deploy:u=>e.post(t.deploy,u),getFields:u=>e.get(t.getFields,{params:u})}}const Xe=Symbol("flowFormState");function sa(e,t){const a=fe(e,void 0,{passive:!0,deep:!0}),{flowDetail:p,modelValue:o,formLoading:i}=a,{tabs:c,customForm:l}=M(),d=L({}),u=P(()=>(c==null?void 0:c.filter(b=>{var f,n,m;const y=(m=(n=(f=p.value)==null?void 0:f.properties)==null?void 0:n.formProperty)==null?void 0:m.find(v=>v.prop===b.prop);return(y==null?void 0:y.display)!==!1}))??[]),g=P(()=>{var f,n,m;const b=(f=u.value.find(v=>v.prop==="formTab"))==null?void 0:f.component,y=l==null?void 0:l[((m=(n=p==null?void 0:p.value)==null?void 0:n.process)==null?void 0:m.formPath)??""];return typeof y=="function"?vt(y):y??b}),{getFlowDetail:s}=Ve();q(()=>{const{flowKey:b,taskId:y,instanceId:f}=e;!b&&!y&&!f||(i.value=!0,s({flowKey:b,taskId:y,flowInstanceId:f}).then(n=>{p.value=n.data,o.value=n.data.formData||{}}).finally(()=>{i.value=!1}))});const w=P(()=>Object.entries(o.value||{}).filter(([b])=>!b.startsWith("$")).map(([b,y])=>({key:b,value:y}))),r={...a,formData:o,formVariables:w,tabRefs:d,tabList:u,formTabComponent:g,emit:t};return mt(Xe,r),r}function ee(){return he(Xe)}const ua=Y({__name:"button-list",emits:["click"],setup(e,{emit:t}){const{flowDetail:a,circulateId:p}=ee(),{data:o}=Qe().useList(),{userInfo:i}=M();function c(d,u){return d.map(g=>{const s=u.find(r=>r.buttonKey===g.buttonKey);return{...g,...Tt(s,["display","approval"])}})}const l=P(()=>{var m,v,_,T,I,C;if(p!=null&&p.value){const S=(m=o.value)==null?void 0:m.find(O=>O.buttonKey==="flow_circulate");return S?[S]:[]}const d=typeof i=="function"?i():i,{assignee:u,status:g}=((v=a.value)==null?void 0:v.task)||{},{createUser:s,flowInstanceId:w,status:r}=((_=a.value)==null?void 0:_.flowInstance)||{},b={true:!0,false:!1,startUser:s==(d==null?void 0:d.userId),assignee:u==(d==null?void 0:d.userId),todo:g==2,done:g==1,notstarted:!w,started:!!w,finished:r===1,unfinished:r===2},y=((T=o.value)==null?void 0:T.filter(S=>S.buttonKey!=="flow_circulate"))??[],{button:f}=((I=a.value)==null?void 0:I.properties)||{};return((C=c(y,f??[]))==null?void 0:C.filter(S=>{var O,h;return(h=(O=S.display)==null?void 0:O.split(","))==null?void 0:h.every(k=>b[k])}))??[]});return(d,u)=>{const g=R("el-button");return V(!0),j(G,null,te(l.value,s=>(V(),A(g,{key:s.buttonKey,type:s.buttonType,onClick:w=>t("click",s)},{default:x(()=>[E(D(Ke),{icon:s.icon},null,8,["icon"]),F(" "+H(s.name),1)]),_:2},1032,["type","onClick"]))),128)}}});function Ze(e){return new Promise((t,a)=>{D(e).validate((o,i,c)=>{o?(i(),t(c)):a(c)})})}const ia=Y({__name:"common-comments",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=fe(t),{batchUpdate:p,create:o,remove:i,useList:c}=la(),l=L(!1),{activeBtn:d}=ee(),u=P(()=>{var v;return(v=d.value)==null?void 0:v.buttonKey}),{data:g,refresh:s}=c(u),w=P(()=>{var _,T,I;const v=a.value;if(v&&!((_=g.value)!=null&&_.some(C=>C.content===v))){const C=(((I=(T=g.value)==null?void 0:T[0])==null?void 0:I.sort)||1)-1;return[{content:v,sort:C},...g.value||[]]}return g.value});async function r(v){var _;await o({...v,type:(_=d.value)==null?void 0:_.buttonKey}),oe.success("添加成功"),s()}async function b(v){await i(v.id),oe.success("删除成功"),s()}async function y(v,_){let T=_.parent.data;T=T.map((I,C)=>({id:I.id,sort:C+1})),await p(T),oe.success("修改排序成功"),s(),l.value=!1}function f(){l.value=!0}const n=L();async function m(v){var _;a.value=v.content??"",await ke(),(_=n.value)==null||_.blur()}return(v,_)=>{const T=R("el-input"),I=R("el-text"),C=R("el-col"),S=R("el-button"),O=R("el-row"),h=R("el-tree"),k=R("el-popover");return V(),A(k,{visible:l.value,placement:"bottom",title:"常用意见",width:600},{reference:x(()=>[E(T,{ref_key:"inputRef",ref:n,modelValue:D(a),"onUpdate:modelValue":_[0]||(_[0]=N=>le(a)?a.value=N:null),type:"textarea",placeholder:"请输入意见",rows:"5",onFocus:_[1]||(_[1]=N=>l.value=!0),onBlur:_[2]||(_[2]=N=>l.value=!1)},null,8,["modelValue"])]),default:x(()=>[E(h,{data:w.value,"node-key":"content",draggable:"","allow-drop":(N,K,B)=>B!=="inner",props:{label:"content"},onNodeClick:m,onNodeDrop:y,onNodeDragStart:f},{default:x(({data:N})=>[E(O,{style:{width:"600px"}},{default:x(()=>[E(C,{span:22},{default:x(()=>[E(I,{truncated:"",title:N.content},{default:x(()=>[F(H(N.content),1)]),_:2},1032,["title"])]),_:2},1024),E(C,{span:2},{default:x(()=>[N.id?(V(),A(S,{key:0,type:"danger",size:"small",icon:"el-icon-close",text:"",onClick:Oe(K=>b(N),["stop"])},null,8,["onClick"])):(V(),A(S,{key:1,type:"primary",size:"small",icon:"el-icon-plus",text:"",onClick:Oe(K=>r(N),["stop"])},null,8,["onClick"]))]),_:2},1024)]),_:2},1024)]),_:1},8,["data","allow-drop"])]),_:1},8,["visible"])}}}),ca=Y({__name:"approval-tree",props:{modelValue:{},data:{},autoCheck:{type:Boolean}},setup(e){const t=e,{modelValue:a}=fe(t),p=L(),o={class(s){return`node-${s.type}`}},i=P(()=>Be(t.data??[],(s,w,r)=>{const b=$e();return s.taskNodeKey=(r==null?void 0:r.taskNodeKey)??s.taskNodeKey,s.incoming=(r==null?void 0:r.incoming)??s.incoming,s.multiple=(r==null?void 0:r.multiple)??s.multiple,{...s,id:b,label:s.title,disabled:s.type!=="user"}})),c={element:"ep:flag",post:"ep:share",dept:"ep:share",user:"ep:user"};je(()=>[i.value,p.value],async()=>{if(!p.value||!i.value.length)return;if(t.autoCheck){const w=l(i.value);w&&g([w])}we(i.value,w=>{var r;return!!((r=w.children)!=null&&r.length)}).map(async w=>{var b;await st(100);const r=(b=p.value)==null?void 0:b.getNode(w);r==null||r.expand()})},{immediate:!0,debounce:100});function l(s){var w;if(s.length===1)return(w=s[0].children)!=null&&w.length?l(s[0].children):s[0]}async function d(s,{checkedNodes:w}){var y;let r=w.filter(f=>f.type==="user");const b=r.some(f=>f.id===s.id);if(i.value.every(f=>!f.multiple)&&b)r=[s];else if(!s.multiple&&b){const m=((y=p.value)==null?void 0:y.getNode(s)).parent.data.children.filter(v=>v.id!==s.id);r=Nt(r,m,"id")}g(r)}function u(s){const w=a.value.filter(r=>r.id!==s.id);g(w)}function g(s){var w;a.value=s,(w=p.value)==null||w.setCheckedNodes(s)}return(s,w)=>{const r=R("el-tag"),b=R("Icon"),y=R("el-tree");return V(),j(G,null,[(V(!0),j(G,null,te(D(a),f=>(V(),A(r,{key:f.id,type:"info",closable:"",onClose:n=>u(f)},{default:x(()=>[F(H(f.title),1)]),_:2},1032,["onClose"]))),128)),E(y,{ref_key:"treeRef",ref:p,class:"approval-tree",data:i.value,props:o,"node-key":"id","check-on-click-node":"","show-checkbox":"",onCheck:d},{default:x(({data:f})=>[Z("div",null,[E(b,{icon:c[f.type]||c.element,style:{display:"inline-block"}},null,8,["icon"]),Z("span",null,H(f.title),1)])]),_:1},8,["data"])],64)}}});const Ee=Te(ca,[["__scopeId","data-v-f1318efd"]]),da={key:0},Se=Y({__name:"assignee-setter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,p=P({get(){return typeof a.modelValue=="string"?a.modelValue?a.modelValue.split(","):[]:a.modelValue},set(r){var b;t("update:modelValue",r.join(",")),(b=a.tableData)!=null&&b.row&&(a.tableData.row.idVal=we(l.value,y=>r==null?void 0:r.includes(y.id)).map(y=>y[`${c.value}Id`]).join(","))}}),o=P({get(){return Array.isArray(a.modelValue)?a.modelValue.join(","):a.modelValue},set(r){t("update:modelValue",r)}}),i=L(!1),c=P(()=>{var r,b;return(b=(r=a.tableData)==null?void 0:r.row)==null?void 0:b.type}),l=L([]),d=L([]),{getUserTree:u}=ra(),{getParam:g}=me();pe(c,r=>{["dept","post","user"].includes(r)?(i.value=!0,u(r==="user"?"":r).then(b=>{l.value=Be(b.data,y=>({...y,label:y.title,value:y.id,disabled:r==="user"?y.type!=="user":!1}))}).finally(()=>i.value=!1)):c.value==="dynamic"&&(i.value=!0,g("flow.trends.user").then(b=>{d.value=b.data}).finally(()=>i.value=!1))},{immediate:!0});const s=L();function w(){p.value=we(l.value,r=>r.type===c.value).map(r=>r.id)}return(r,b)=>{const y=R("ElTreeSelect"),f=R("el-button"),n=R("el-input");return["dept","post","user"].includes(c.value)?(V(),j("div",da,[E(y,{ref_key:"treeRef",ref:s,modelValue:p.value,"onUpdate:modelValue":b[0]||(b[0]=m=>p.value=m),"check-on-click-node":"","check-strictly":"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",data:l.value,filterable:"",loading:i.value,"max-collapse-tags":3,multiple:"",placeholder:"请选择","show-checkbox":"",style:{width:"75%"}},null,8,["modelValue","data","loading"]),E(f,{text:"",type:"primary",icon:"el-icon-check",style:{width:"20%"},onClick:w},{default:x(()=>[F(" 全选 ")]),_:1})])):c.value==="dynamic"?(V(),A(y,{key:1,modelValue:o.value,"onUpdate:modelValue":b[1]||(b[1]=m=>o.value=m),clearable:"",data:d.value,filterable:"",loading:i.value,placeholder:"请选择",style:{width:"100%"}},null,8,["modelValue","data","loading"])):c.value==="userTask"?(V(),A(D(it),{key:2,modelValue:o.value,"onUpdate:modelValue":b[2]||(b[2]=m=>o.value=m),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(V(),A(n,{key:3,modelValue:o.value,"onUpdate:modelValue":b[3]||(b[3]=m=>o.value=m),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),pa={key:0,class:"flow-viewer"},fa={key:0,class:"flow-status-legend"},ma=Y({__name:"index",props:{modelValue:{},view:{type:Boolean},flowFormOption:{},flowHistory:{},showLegend:{type:Boolean}},emits:["update:modelValue","nodeClick"],setup(e,{emit:t}){const a=e,{FlowDesign:p,tabs:o}=M(),i=se();kt(i,()=>{var f;(f=i.value)==null||f.on("node:click",n=>t("nodeClick",n))});const c=P({get(){let f=dt();return typeof a.modelValue=="string"&&a.modelValue?f=JSON.parse(a.modelValue):typeof a.modelValue=="object"&&Object.keys(a.modelValue)&&(f=a.modelValue),f},set(f){t("update:modelValue",JSON.stringify(f))}}),l=P(()=>{const{column:f=[],group:n=[]}=JSON.parse(a.flowFormOption||"{}");return[...f,...n.map(v=>v.column??[]).flat()]}),{data:d}=Qe().useList(),u=P(()=>(o==null?void 0:o.map(f=>({...f,display:!0})))??[]),g=P(()=>{var f;return{formPropertyList:[...l.value,...u.value],buttonList:(f=d.value)==null?void 0:f.filter(n=>n.status===1),fieldsDic:l.value.map(n=>({label:n.label,value:`\${${n.prop}}`,desc:`\${${n.prop}}`})),flowButtonDisplayDic:W(xe),flowButtonApprovalDic:W(Ie)}}),s=L({}),w=L({});je(w,f=>{var n,m,v,_,T,I;f&&((v=(m=(n=f.assignee)==null?void 0:n.children)==null?void 0:m.column)!=null&&v[1]&&(f.assignee.children.column[1].component=Se),(I=(T=(_=f.circulate)==null?void 0:_.children)==null?void 0:T.column)!=null&&I[1]&&(f.circulate.children.column[1].component=Se))},{debounce:1});const{data:r}=me().useParam("flow.task.status"),b=P(()=>{var f;return(f=a.flowHistory)==null?void 0:f.map(n=>{var v,_;const m=(_=(v=r.value)==null?void 0:v.find(T=>T.value===n.status))==null?void 0:_.style;return{id:n.taskNodeKey,style:m}})}),y=P(()=>{var f,n;return(n=(f=a.flowHistory)==null?void 0:f.filter(m=>m.taskNodeType==="userTask"))==null?void 0:n.map(m=>{var v;return{id:m.taskNodeKey,content:`<div>${m.assigneeName}</div>
        <div>${m.endTime??""}</div>
        <div>${((v=m.comment)==null?void 0:v.handleComment)??""}</div>`}})});return(f,n)=>f.view?(V(),j("div",pa,[f.showLegend!==!1?(V(),j("div",fa,[(V(!0),j(G,null,te(D(r),m=>{var v;return V(),j("div",{key:m.label,class:"legend-item"},[Z("div",{class:"legend-color",style:bt({backgroundColor:(v=m.style)==null?void 0:v.fill})},null,4),Z("span",null,H(m.label),1)])}),128))])):J("",!0),E(D(p),{lf:i.value,"onUpdate:lf":n[0]||(n[0]=m=>i.value=m),"model-value":c.value,styles:b.value,tooltips:y.value,type:"viewer"},null,8,["lf","model-value","styles","tooltips"])])):(V(),A(D(p),{key:1,modelValue:c.value,"onUpdate:modelValue":n[1]||(n[1]=m=>c.value=m),formData:s.value,"onUpdate:formData":n[2]||(n[2]=m=>s.value=m),formDefaults:w.value,"onUpdate:formDefaults":n[3]||(n[3]=m=>w.value=m),"form-options":D(ct),"data-options":g.value,"form-width":"30%"},null,8,["modelValue","formData","formDefaults","form-options","data-options"]))}});const et=Te(ma,[["__scopeId","data-v-8d328451"]]),va=Y({__name:"node-select",props:{modelValue:{}},setup(e){const t=e,{modelValue:a}=fe(t),{flowDetail:p}=ee(),o=L(!1);function i({data:c}){c.type==="userTask"&&(o.value=!1,a.value=c.id)}return(c,l)=>{const d=R("el-button"),u=R("el-popover");return V(),A(u,{visible:o.value,"onUpdate:visible":l[0]||(l[0]=g=>o.value=g),placement:"bottom-start",width:"800px",trigger:"click"},{reference:x(()=>[E(d,null,{default:x(()=>[F(" 点击选择节点 ")]),_:1})]),default:x(()=>{var g,s;return[E(et,{"model-value":(s=(g=D(p))==null?void 0:g.process)==null?void 0:s.flowData,view:"",style:{height:"600px"},onNodeClick:i},null,8,["model-value"])]}),_:1},8,["visible"])}}}),ba=Y({__name:"approval-form",emits:["submit"],setup(e,{emit:t}){const{getApprovalNode:a}=Ve(),{useParam:p}=me(),{formData:o,approvalFormData:i,activeBtn:c,approvalVisible:l,formVariables:d,flowDetail:u}=ee(),g=L([]),s=L([]),w=L([]),r=L([]),b=L(!1),y=L(!1),f=L(),n=L(),m={menuBtn:!1,labelWidth:100,column:[{label:"指定节点",prop:"jumpTaskNodeKey",span:24,rules:[{required:!0,message:"请选择指定节点"}]},{label:"审批人",prop:"assignee",span:24,rules:[{required:!0,validator:v}]},{label:"传阅人",prop:"circulate",span:24},{label:"意见",prop:"comment",span:24,rules:[{required:!0,message:"请填写意见"}]}]};function v(h,k,N){var U,$,Le;const K=((U=g.value[0])==null?void 0:U.type)==="parallelGateway",B=(Le=($=g.value[0])==null?void 0:$.children)==null?void 0:Le.every(ot=>ft([ot],lt=>s.value.some(nt=>nt.id===lt.id)));if(s.value.length){if(K&&!B)return N("请在每个节点选择审批人")}else return N("请选择审批人");return!0}const{data:_}=p("flow.default.comment"),{data:T}=p("flow.approval.autocheck");q(async()=>{var k;if(!l.value||!f.value||!n.value)return;I();const{taskId:h}=((k=u.value)==null?void 0:k.task)||{};ke(()=>{f.value.resetFields(),i.value.comment=o.value.comment||(h?"":_.value)||"",n.value.jumpTaskNodeKey.display=C("specifyNode"),n.value.assignee.display=C("assignee"),n.value.circulate.display=C("circulate"),n.value.comment.display=C("comment")})}),q(async()=>{var N,K;if(!l.value||!C("assignee")||C("specifyNode")&&!i.value.jumpTaskNodeKey)return;I();const{flowKey:h}=((N=u.value)==null?void 0:N.process)||{},{taskId:k}=((K=u.value)==null?void 0:K.task)||{};try{y.value=!0;const B=await a({flowKey:h,taskId:k,variables:d.value,buttonType:c.value.buttonKey,jumpTaskNodeKey:i.value.jumpTaskNodeKey});g.value=B.data.approvalNodeList,w.value=B.data.circulateNodeList}finally{y.value=!1}});function I(){g.value=[],s.value=[],w.value=[],r.value=[]}function C(h){var k,N;return(N=(k=c.value)==null?void 0:k.approval)==null?void 0:N.includes(h)}async function S(){await Ze(f),b.value=!0;const{data:h,outgoing:k}=O(s.value),{data:N}=O(r.value);i.value.assignee=h,i.value.outgoing=[...k],i.value.circulate=N,console.log("🚀 ~ file: approval-form.vue:133 ~ onConfirm ~ formData:",o),t("submit")}function O(h){const k={},N={},K=new Set;return h.forEach(B=>{const{taskNodeKey:U,incoming:$}=B;k[U]||(k[U]=new Set),B.userId&&k[U].add(B.userId),N[U]=[...k[U]].join(","),$&&K.add($)}),{set:k,data:N,outgoing:K}}return(h,k)=>{const N=R("el-skeleton"),K=R("avue-form"),B=R("el-button"),U=R("el-dialog");return V(),A(U,{modelValue:D(l),"onUpdate:modelValue":k[7]||(k[7]=$=>le(l)?l.value=$:null),class:"approlval-form",title:D(c).name,width:"900px","append-to-body":""},{footer:x(()=>[E(B,{onClick:k[6]||(k[6]=$=>l.value=!1)},{default:x(()=>[F(" 取 消 ")]),_:1}),E(B,{type:"primary",onClick:S},{default:x(()=>[F(" 确 定 ")]),_:1})]),default:x(()=>[E(K,{ref_key:"formRef",ref:f,modelValue:D(i),"onUpdate:modelValue":k[4]||(k[4]=$=>le(i)?i.value=$:null),defaults:n.value,"onUpdate:defaults":k[5]||(k[5]=$=>n.value=$),option:m},{jumpTaskNodeKey:x(()=>[E(va,{modelValue:D(i).jumpTaskNodeKey,"onUpdate:modelValue":k[0]||(k[0]=$=>D(i).jumpTaskNodeKey=$)},null,8,["modelValue"])]),assignee:x(()=>[y.value?(V(),A(N,{key:0})):(V(),A(Ee,{key:"AssigneeTree",modelValue:s.value,"onUpdate:modelValue":k[1]||(k[1]=$=>s.value=$),data:g.value,"auto-check":D(T)==="true"},null,8,["modelValue","data","auto-check"]))]),circulate:x(()=>[y.value?(V(),A(N,{key:0})):(V(),A(Ee,{key:"CirculateTree",modelValue:r.value,"onUpdate:modelValue":k[2]||(k[2]=$=>r.value=$),data:w.value},null,8,["modelValue","data"]))]),comment:x(()=>[E(ia,{modelValue:D(i).comment,"onUpdate:modelValue":k[3]||(k[3]=$=>D(i).comment=$)},null,8,["modelValue"])]),_:1},8,["modelValue","defaults"])]),_:1},8,["modelValue","title"])}}}),ya={class:"flow-form__title"},ga=Y({__name:"index",props:aa,emits:oa,setup(e,{emit:t}){const p=sa(e,t),{ApprovalForm:o,tabsProps:i}=M(),c=o??ba,{title:l,detail:d,flowDetail:u,tabRefs:g,tabList:s,activeTab:w,activeBtn:r,formLoading:b,formTabComponent:y,approvalVisible:f,submitLoading:n,beforeClick:m,beforeSubmit:v}=p;async function _(C){var S,O;r.value=C;for(const h of Object.values(g.value))await((S=h==null?void 0:h.validate)==null?void 0:S.call(h));await((O=m==null?void 0:m.value)==null?void 0:O.call(m,C)),(C==null?void 0:C.approval)!=="false"?f.value=!0:I()}const T=ea(p);async function I(){var C;try{const{buttonKey:S}=r.value;n.value=!0,await((C=v==null?void 0:v.value)==null?void 0:C.call(v,r.value));const O=T[S];O?(await(O==null?void 0:O()),oe.success("操作成功"),f.value=!1,t("complete",r.value)):oe.error("无法找到相应的操作")}finally{n.value=!1}}return(C,S)=>{const O=R("el-skeleton"),h=R("el-main"),k=R("el-header"),N=R("el-tab-pane"),K=R("el-tabs"),B=R("el-container");return D(b)?(V(),A(h,{key:0},{default:x(()=>[E(O)]),_:1})):(V(),A(B,{key:1,class:"flow-form"},{default:x(()=>[E(k,{class:"flow-form__header",height:"auto"},{default:x(()=>{var U;return[Z("div",ya,H(D(l)??((U=D(u).flowInstance)==null?void 0:U.title)),1),D(d)?J("",!0):(V(),A(ua,{key:0,onClick:_}))]}),_:1}),E(h,{class:"flow-form__main"},{default:x(()=>[E(K,yt({modelValue:D(w),"onUpdate:modelValue":S[0]||(S[0]=U=>le(w)?w.value=U:null)},D(i)),{default:x(()=>[(V(!0),j(G,null,te(D(s),U=>(V(),A(N,{key:U.prop,label:U.label,name:U.prop,lazy:U.lazy,disabled:U.disabled,closable:U.closable},{default:x(()=>[U.prop==="formTab"?(V(),A(Re(D(y)),{key:0,ref_for:!0,ref:$=>D(g)[U.prop]=$},null,512)):(V(),A(Re(U.component),{key:1,ref_for:!0,ref:$=>D(g)[U.prop]=$},null,512))]),_:2},1032,["label","name","lazy","disabled","closable"]))),128))]),_:1},16,["modelValue"])]),_:1}),E(D(c),{onSubmit:I})]),_:1}))}}});const wa=Y({setup(){const{flowDetail:e,formData:t,detail:a}=ee(),p=ta(e.value),{proxy:o}=wt(),i=L({});q(()=>{const{formOption:d}=e.value.process??{};i.value=pt.bind(o)(d||'{"menuBtn":false}'),i.value.detail=!!a.value});const c=L();function l(){return Ze(c)}return{form:t,option:i,defaults:p,formRef:c,validate:l}},render(){return gt(R("avue-form"),{ref:"formRef",modelValue:this.form,defaults:this.defaults,option:this.option,class:this.option.class,"onUpdate:modelValue":e=>this.form=e,"onUpdate:defaults":e=>this.defaults=e})}}),_a=Y({__name:"upload-table",setup(e){const{flowDetail:t,fileIds:a}=ee(),{upload:{action:p,headers:o,preview:i,download:c,props:l}={}}=M(),d=typeof o=="function"?o():o,u=P(()=>{var m,v;return((v=(m=t.value)==null?void 0:m.task)==null?void 0:v.flowInstanceId)??$e()}),g={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:200,column:[{label:"文件名",prop:"fileName"},{label:"文件类型",prop:"fileType"},{label:"文件大小",prop:"fileSize"},{label:"版本",prop:"version"},{label:"上传时间",prop:"createTime"}]},{bindVal:s,getDataList:w,handleDel:r,handleSave:b,afterGetList:y,crudStateRefs:{tableData:f}}=ut({crudOption:{...na(),saveSuccessMsg:"上传成功"},tableOption:g,queryForm:{isLatest:1,flowInstanceId:u.value}});y(()=>{a.value=f.value.map(m=>m.id).join(",")}),w();async function n(m,v){var h,k;const{fileName:_,fileType:T,fileSize:I,fileUrl:C,res:S}=l,O={fileName:re({res:m},`${S}.${_}`),fileType:re({res:m},`${S}.${T}`),fileSize:re({res:m},`${S}.${I}`),fileUrl:re({res:m},`${S}.${C}`),taskId:(k=(h=t.value)==null?void 0:h.task)==null?void 0:k.taskId,flowInstanceId:u.value,rootMark:(v==null?void 0:v.rootMark)||"",version:typeof(v==null?void 0:v.version)=="number"?v.version+1:1};await b(O,w,()=>{})}return(m,v)=>{const _=R("el-button"),T=R("el-upload"),I=R("avue-crud");return V(),A(I,_t(ht(D(s))),{"menu-left":x(()=>[E(T,{action:D(p),headers:D(d),"show-file-list":!1,onSuccess:v[0]||(v[0]=C=>n(C))},{default:x(()=>[E(_,{type:"primary",icon:"el-icon-upload"},{default:x(()=>[F(" 点击上传 ")]),_:1})]),_:1},8,["action","headers"])]),menu:x(({row:C,index:S})=>[E(_,{type:"primary",text:"",icon:"el-icon-view",onClick:O=>{var h;return(h=D(i))==null?void 0:h(C,D(f))}},{default:x(()=>[F(" 预览 ")]),_:2},1032,["onClick"]),E(_,{type:"primary",text:"",icon:"el-icon-download",onClick:O=>{var h;return(h=D(c))==null?void 0:h(C,D(f))}},{default:x(()=>[F(" 下载 ")]),_:2},1032,["onClick"]),E(T,{action:D(p),headers:D(d),"show-file-list":!1,style:{display:"inline","vertical-align":"middle","margin-right":"10px"},onSuccess:O=>n(O,C)},{default:x(()=>[E(_,{type:"primary",text:"",icon:"el-icon-upload"},{default:x(()=>[F(" 更新版本 ")]),_:1})]),_:2},1032,["action","headers","onSuccess"]),E(_,{type:"primary",text:"",icon:"el-icon-delete",onClick:O=>D(r)(C,S)},{default:x(()=>[F(" 删除 ")]),_:2},1032,["onClick"])]),_:1},16)}}}),ha={class:"flow-track"},ka={key:0},Ta={key:1},Ca=Y({__name:"flow-track",setup(e){const{flowDetail:t}=ee(),a=L("table"),p=[{label:"table",icon:"ep:grid"},{label:"graph",icon:"ep:picture"},{label:"timeline",icon:"ep:finished"}],o=P(()=>{var d,u,g;return((g=(u=(d=t.value)==null?void 0:d.flowHistory)==null?void 0:u.filter(s=>s.taskNodeType==="userTask"))==null?void 0:g.map(s=>({...s,duration:rt(s.duration)})))??[]}),i={addBtn:!1,menu:!1,border:!0,column:[{label:"节点名称",prop:"taskNodeName"},{label:"处理人",prop:"assigneeName"},{label:"接收时间",prop:"startTime"},{label:"处理时间",prop:"endTime"},{label:"办理时长",prop:"duration"},{label:"操作类型",prop:"type",dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.handle.type"}},{label:"办理意见",prop:"comment",bind:"comment.handleComment"}]},{data:c}=me().useParam("flow.handle.type");function l(d){var u;return(u=c.value)==null?void 0:u.find(g=>g.value===d)}return(d,u)=>{var n,m,v;const g=R("el-radio-button"),s=R("el-radio-group"),w=R("avue-crud"),r=R("el-card"),b=R("el-timeline-item"),y=R("el-timeline"),f=R("el-empty");return V(),j(G,null,[E(s,{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=_=>a.value=_)},{default:x(()=>[(V(),j(G,null,te(p,_=>E(g,{key:_.label,label:_.label},{default:x(()=>[E(D(Ke),{icon:_.icon},null,8,["icon"])]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),Z("div",ha,[a.value==="table"?(V(),A(w,{key:0,data:o.value,option:i},null,8,["data"])):J("",!0),a.value==="graph"?(V(),A(et,{key:1,"model-value":(m=(n=D(t))==null?void 0:n.process)==null?void 0:m.flowData,"flow-history":(v=D(t))==null?void 0:v.flowHistory,view:"","show-legend":""},null,8,["model-value","flow-history"])):J("",!0),a.value==="timeline"?(V(),j(G,{key:2},[o.value.length?(V(),A(y,{key:0},{default:x(()=>[(V(!0),j(G,null,te([...o.value].reverse(),_=>(V(),A(b,{key:_.id,timestamp:_.endTime,placement:"top"},{default:x(()=>[E(r,null,{default:x(()=>{var T,I,C;return[Z("div",null,H(_.assigneeName)+" 开始处理 ["+H(_.taskNodeName)+"] 环节 ",1),_.duration?(V(),j("div",ka," 办理时长："+H(_.duration),1)):J("",!0),_.type&&((T=_.comment)!=null&&T.handleComment)?(V(),j("div",Ta,H((I=l(_.type))==null?void 0:I.label)+"意见："+H((C=_.comment)==null?void 0:C.handleComment),1)):J("",!0)]}),_:2},1024)]),_:2},1032,["timestamp"]))),128))]),_:1})):(V(),A(f,{key:1}))],64)):J("",!0)])],64)}}});const Na=Te(Ca,[["__scopeId","data-v-f55ecc9f"]]),Pe=Symbol("flowPagesConfig"),Da={FlowDesign:{},FormDesign:{},FlowForm:ga,tabs:[{label:"审批表单",prop:"formTab",component:wa},{label:"附件资料",prop:"fileTab",component:_a},{label:"流程跟踪",prop:"trackTab",component:Na}],request:()=>{},useFlowFormOptions:{type:"drawer",window:["","flow-form","left=0,top=0,width=1600,height=900"],overlay:{width:"80%",size:"80%",top:"100px",fullscreen:!0,destroyOnClose:!0}},upload:{props:{fileName:"fileOriginalName",fileType:"fileType",fileSize:"fileSize",fileUrl:"fileUrl",res:"res.data"}}};var tt=(e=>(e[e.否=0]="否",e[e.是=1]="是",e))(tt||{});const Ae=W(tt);function M(e,t){return e&&t?(e.provide(Pe,Ct(Da,t)),t):he(Pe)}const Fa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,labelWidth:150,span:24,column:[{label:"按钮名称",prop:"name",search:!0},{label:"按钮标识",prop:"buttonKey",search:!0},{label:"按钮图标",prop:"icon",component:"icon-select"},{label:"按钮类型",prop:"buttonType",type:"select",dicData:W(We)},{label:"默认显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",value:"false",dicData:W(xe),tip:"选择多个时,所有条件都满足才显示",labelTip:`显示: 始终显示;<br/>隐藏: 始终隐藏;<br/>
      发起人: 用户为发起人时显示;<br/>处理人: 用户为处理人时显示;<br/>
      已办: 任务状态为已办时显示;<br/>待办: 任务状态为待办时显示;<br/>
      未发起: 流程未发起时显示;<br/>已发起: 流程已发起时显示;<br/>
      未办结: 流程未办结时显示;<br/>已办结: 流程已办结时显示;`},{label:"默认审批窗口显示",prop:"approval",type:"select",multiple:!0,dataType:"string",value:"false",dicData:W(Ie),labelTip:`不显示: 不显示审批窗口;<br/>指定节点: 显示指定节点选择框(常用于绿色通道等);<br/>
      审批人: 显示审批人选择框;<br/>传阅人: 显示传阅人选择框;<br/>意见: 显示意见输入框;`},{label:"排序",prop:"sort",type:"number",value:0},{label:"状态",prop:"status",type:"switch",value:1,dicData:W(Ge)},{label:"按钮预览",prop:"buttonPreview",width:150}]},at={menuBtn:!1,span:24,column:[{label:"流程名称",prop:"flowName",rules:[{required:!0,message:"请输入流程名称"}]},{label:"流程标识",prop:"flowKey",editDisabled:!0,rules:[{required:!0,message:"请输入流程标识"}]},{label:"流程分类",prop:"categoryId",type:"select",dicUrl:"/sapier-flow/flow-category/list",dicQuery:{size:-1},props:{label:"name",value:"id"}},{label:"流程图标",prop:"flowIcon",component:"icon-select"},{label:"流程描述",prop:"remarks"},{label:"自定义表单",prop:"formPath"},{label:"关联表",prop:"formDataTable",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicUrl:"/sapier-flow/dev-table/list",dicQuery:{size:-1},props:{label:"tableComment",value:"tableName",desc:"tableName",res:"data.records"}},{label:"表单设计",prop:"formOption",display:!1,hide:!0},{label:"模型设计",prop:"flowData",display:!1,hide:!0}]},Ha={rowKey:"flowModuleId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...at.column.map((e,t)=>({...e,search:t<2})),{label:"流程主版本",prop:"mainVersion",formatter(e,t){return t?`V${t||""}`:""}}]},Ya={rowKey:"flowDeloyId",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,tabs:!0,dialogFullscreen:!0,addBtn:!1,editBtn:!1,delBtn:!1,menuWidth:100,menuType:"menu",menuBtnTitle:"操作",column:[...at.column,{label:"流程版本",prop:"version",formatter(e,t){return t?`V${t||""}`:""}},{label:"是否主版本",prop:"mainVersion",type:"select",dicData:[{label:"否",value:0},{label:"是",value:1}]}]},Va=[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"},{label:"任务状态",prop:"status",type:"select",search:!0,searchValue:2,dicUrl:"/sapier-flow/flow-param/getParam",dicQuery:{paramKey:"flow.task.status"}}].map(e=>({...e,display:!1})),xa=[{label:"审批人",prop:"assignee"},{label:"节点名称",prop:"taskNodeName"},{label:"接收时间",prop:"startTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"结束时间",prop:"endTime",type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},{label:"耗时",prop:"duration"},{label:"传阅意见",prop:"comment"}].map(e=>({...e,hide:!0})),za={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!0,addBtn:!1,column:[...Va,...xa]};const Ue=[{label:"字段名称",prop:"name"},{label:"字段备注",prop:"comment"},{label:"字段类型",prop:"type",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:W(Je)},{label:"字段长度",prop:"size",type:"number"},{label:"小数位",prop:"point",type:"number"},{label:"默认值",prop:"default"},{label:"是否主键",prop:"primary",type:"switch",dicData:Ae,value:0},{label:"是否允许为空",prop:"permitNull",type:"switch",dicData:Ae,value:1}],Wa={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,dialogFullscreen:!0,column:[{label:"表名",prop:"tableName",search:!0},{label:"表注释",prop:"tableComment",search:!0},{label:"表引擎",prop:"tableEngine"},{label:"表主键策略",prop:"tablePrimary",type:"select",filterable:!0,allowCreate:!0,defaultFirstOption:!0,dicData:W(qe)},{label:"数据库字段",prop:"editFields",hide:!0,type:"dynamic",children:{column:Ue}},{label:"默认字段",prop:"defaultFields",hide:!0,type:"dynamic",children:{addBtn:!1,delBtn:!1,column:Ue}}]};export{Pe as A,Da as C,et as F,Zt as T,tt as W,ga as _,Ze as a,M as b,ae as c,Qe as d,Ha as e,Ya as f,Ma as g,at as h,za as i,me as j,Ve as k,Wa as l,ba as m,ua as n,Na as o,wa as p,_a as q,ea as r,ta as s,Fa as t,ee as u,aa as v,Ae as w,oa as x,Xe as y,sa as z};
