import{r as N,a9 as we,aB as Ue,d as Se,h as S,H as m,D as I,E as o,a7 as j,a8 as J,u as f,j as V,J as a,p as F,q as A,e as de,i as G,b as Q,m as Be,k as P,R as Y,I as ge,F as E,G as B,w as ke,aM as Ve,C as H,a5 as De,n as ye,_ as Ae}from"./framework.87994f31.js";import"./index.a2682797.js";import{b as Ke,u as R}from"./index.d61e7aee.js";import{b as te,c as U,_ as Ee,C as Re,t as ze,d as je,e as Je,f as We,g as re,h as He,F as ce,a as Ge,i as Qe,w as Ye,j as Fe,k as Xe,T as Ze,l as qe}from"./form.259dd0fb.js";import{A as wo,B as yo,O as bo,z as go,q as ko,p as Vo,o as Do,r as Fo,n as Co,v as ho,H as Oo,E as Lo,y as xo,G as Io,W as $o,P as To,L as No,K as Po,D as Mo,M as Uo,Q as So,I as Bo,m as Ao,s as Ko,x as Eo,J as Ro,u as zo,N as jo}from"./form.259dd0fb.js";import{m as pe,a as X,E as z}from"./index.05b719a1.js";import{o as Ce}from"./omitBy.dee5f82d.js";import{a as et}from"./snakeCase.65aa62e9.js";import{z as tt}from"./Uint8Array.e988a1a5.js";import{F as ot}from"./index.4aada9e5.js";import{J as lt,K as at}from"../app.3c99a7fc.js";import{I as Z}from"./iconify.a7519ee4.js";import"./index.81c79613.js";import"./index.b9b6321b.js";import{j as nt,H as st}from"./tree.faa3b0d0.js";import"./vuedraggable.umd.3ed62a2a.js";import{w as oe,u as me,e as it}from"./theme.cdcbae00.js";import{f as ut}from"./form.d769572f.js";import{d as rt}from"./differenceBy.5155784c.js";import"./dayjs.min.80392c58.js";import"./omit.28986d82.js";import"./index.vue_vue_type_script_setup_true_lang.b05f95f4.js";import"./createCompounder.a55b8569.js";import"./kebabCase.6f38f518.js";import"./vue.runtime.esm-bundler.673250a5.js";function he(n){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},l=_=>n.get(e.list,{params:_});return{getList:l,useList:()=>te(()=>l({size:-1}).then(_=>_.data)),getTree:_=>n.get(e.tree,{params:_}),create:_=>n.post(e.save,_),update:_=>n.post(e.update,_),remove:_=>n.post(e.remove,{},{params:{ids:_}})}}function Oe(n){const e={list:"/sapier-flow/flow-circulate/userTaskList",opslist:"/sapier-flow/flow-circulate-ops/list",update:"/sapier-flow/flow-circulate-ops/update",remove:"/sapier-flow/flow-circulate-ops/remove"};return{url:e,getCirculateList:i=>n.get(e.list,{params:i}),getCirculateOpsList:i=>n.get(e.list,{params:i}),updateCirculate:i=>n.post(e.update,i),removeCirculate:i=>n.post(e.remove,{},{params:{ids:i}})}}function le(n){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},l=d=>n.get(e.list,{params:d});return{url:e,getList:l,useList:()=>te(()=>l({size:-1}).then(d=>d.data.records)),create:d=>n.post(e.save,d),update:d=>n.post(e.update,d),remove:d=>n.post(e.remove,{},{params:{ids:d}}),deploy:d=>n.post(e.deploy,d),getDetail:d=>n.get(e.detail,{params:d})}}var Le=(n=>(n[n.否=0]="否",n[n.是=1]="是",n))(Le||{});function fe(n){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"};return{url:e,getList:i=>n.get(e.list,{params:i}),getDetail:i=>n.get(e.detail,{params:i}),update:i=>n.post(e.update,i),remove:i=>n.post(e.remove,{},{params:{ids:i}})}}function dt(n){const e={list:"/sapier-flow/flow-ops/list"};return{url:e,getTaskOpsList:t=>n.get(e.list,{params:t})}}function xe(n){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},l=c=>n.get(e.list,{params:c});return{url:e,getList:l,useList:()=>te(()=>l({size:-1}).then(c=>c.data.records)),create:c=>n.post(e.save,c),update:c=>n.post(e.update,c),remove:c=>n.post(e.remove,{},{params:{ids:c}})}}function Ie(n){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},l=c=>n.get(e.list,{params:c});return{url:e,getList:l,useList:()=>te(()=>l({size:-1}).then(c=>c.data.records)),create:c=>n.post(e.save,c),update:c=>n.post(e.update,c),remove:c=>n.post(e.remove,{},{params:{ids:c}})}}function $e(n){return n in(Re.useFlowFormOptions??{})}function Te(n={}){const{useFlowFormOptions:e}=U(),l=pe({...e},{...n});switch(l==null?void 0:l.type){case"window":return ct(l);case"dialog":case"drawer":return pt(l);default:return{open:t=>{},close:()=>{}}}}function ct(n={}){const e=N(null);return{open:(u={})=>{var b;const s=pe({...n},{...u}),{window:[i,c,_]=[]}=s,d=`${i}?${Ke(Ce(s,et(tt,ot,$e)))}`;e.value=window.open(d,c,_),(b=e.value)==null||b.addEventListener("message",D=>{const{event:v}=D.data,p=u[v];typeof p=="function"&&p(D.data)})},close:()=>{var u;return(u=e.value)==null?void 0:u.close()},openedWindow:e}}function pt(n={}){const{appContext:e}=Se();let l,t;const u=i=>{l=document.createElement("div"),l.className="flow-form-wrapper";const c=pe({...n},{...i}),_=we(Ee,Ce(c,$e));t=we(c.type==="dialog"?lt:at,{class:"flow-form-overlay",modelValue:!0,onClose:s,...c.overlay},_),t.appContext=e,Ue(t,l),document.body.appendChild(l)},s=()=>{var i,c;(c=(i=t==null?void 0:t.component)==null?void 0:i.props)!=null&&c.modelValue&&(t.component.props.modelValue=!1),l&&document.body.removeChild(l),l=null};return{open:u,close:s}}const mt=S({__name:"index",setup(n){const{request:e}=U(),{bindVal:l,crudStateRefs:{formData:t},getDataList:u}=R({tableOption:ze,crudOption:je(e),sortOption:{ascs:"sort"}});return u(),(s,i)=>{const c=m("el-button"),_=m("avue-crud");return V(),I(_,j(J(f(l))),{icon:o(({row:d})=>[a(f(Z),{icon:d.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:d})=>[a(c,{type:d.buttonType},{default:o(()=>[a(f(Z),{icon:d.icon},null,8,["icon"]),F(" "+A(d.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[a(c,{type:f(t).buttonType},{default:o(()=>[a(f(Z),{icon:f(t).icon},null,8,["icon"]),F(" "+A(f(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ne=S({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(n,{emit:e}){const l=n,{request:t}=U(),{getList:u,deploy:s,remove:i}=le(t),{bindVal:c,crudStateRefs:{searchForm:_},getDataList:d}=R({tableOption:Je,crudOption:{getList:u,remove:i},searchForm:{categoryId:l.categoryId}});de(()=>{_.value.categoryId=l.categoryId??""}),oe(_,d,{debounce:300,immediate:!0,deep:!0});const b=N(!1);async function D(p){await X.confirm("发布新版本，是否确认？","提示",{type:"success"}),b.value=!0,s({flowModuleId:p.flowModuleId}).then(()=>{z.success("发布成功"),d()}).finally(()=>{b.value=!1})}async function v(p){if(p.mainVersion)return z.warning("请先删除已发布的流程");await X.confirm("确认删除？","提示",{type:"warning"}),await i(p.flowModuleId),z.success("删除成功"),d()}return(p,r)=>{const w=m("el-button"),y=m("el-dropdown-item"),k=m("avue-crud");return V(),I(k,j(J(f(c))),{"menu-left":o(()=>[a(w,{type:"primary",icon:"el-icon-plus",onClick:r[0]||(r[0]=g=>e("add"))},{default:o(()=>[F(" 新增 ")]),_:1})]),"menu-btn":o(({row:g})=>[a(y,{icon:"el-icon-view",onClick:L=>e("view",g)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-edit",onClick:L=>e("edit",g)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-delete",onClick:L=>v(g)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-upload",onClick:L=>D(g)},{default:o(()=>[F(" 发布 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-switch",onClick:L=>e("version",g)},{default:o(()=>[F(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:g})=>[a(f(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),Pe=S({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(n,{emit:e}){const l=n,{request:t}=U(),{getList:u,update:s,remove:i}=fe(t),{bindVal:c,crudStateRefs:{searchForm:_},getDataList:d}=R({tableOption:We,crudOption:{getList:u,dataPath:"res.data"}});de(()=>{_.value.flowModuleId=l.flowModuleId}),oe(_,d,{debounce:300,immediate:!0,deep:!0});const b=N(!1);async function D(p){await X.confirm(`确定将 ${p.flowName}(${p.flowKey}:v${p.version}) 设为主版本?`,"提示",{type:"warning"}),b.value=!0,s({flowDeployId:p.flowDeployId,flowModuleId:p.flowModuleId,mainVersion:1}).then(()=>{z.success("设置成功"),d()}).finally(()=>{b.value=!1})}async function v(p){const{value:r}=await X.prompt("请输入确认删除的流程标识","提示",{type:"warning"});r===p.flowKey&&(await i(p.flowDeployId),z.success("删除成功"),d())}return(p,r)=>{const w=m("el-button"),y=m("el-dropdown-item"),k=m("avue-crud");return V(),I(k,j(J(f(c))),{"menu-left":o(()=>[a(w,{loading:b.value,type:"primary",icon:"el-icon-arrow-left",onClick:r[0]||(r[0]=g=>e("back"))},{default:o(()=>[F(" 返回 ")]),_:1},8,["loading"])]),"menu-btn":o(({row:g})=>[a(y,{icon:"el-icon-view",onClick:L=>e("view",g)},{default:o(()=>[F(" 查看 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-edit",onClick:L=>e("edit",g)},{default:o(()=>[F(" 编辑 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-delete",onClick:L=>v(g)},{default:o(()=>[F(" 删除 ")]),_:2},1032,["onClick"]),a(y,{icon:"el-icon-switch",disabled:g.mainVersion===f(Le).是,onClick:L=>D(g)},{default:o(()=>[F(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:g})=>[a(f(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),be={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"}]}},ft=S({__name:"index",emits:["node-click"],setup(n,{emit:e}){const{request:l}=U(),{crudStateRefs:{formData:t,tableData:u},getDataList:s,handleSave:i,handleUpdate:c,handleDel:_}=R({crudOption:{rowKey:"id",...he(l),dataPath:"res.data"},tableOption:be,pageOption:{pageSize:20}});s();function d(v,p,r,w){i(p,r,w)}function b(v,p,r,w){c(p,NaN,r,w)}async function D(v,p){await _(v.data,NaN),p()}return(v,p)=>{const r=m("avue-tree");return V(),I(r,{modelValue:f(t),"onUpdate:modelValue":p[0]||(p[0]=w=>G(t)?t.value=w:null),option:f(be),data:f(u),onNodeClick:p[1]||(p[1]=w=>e("node-click",w)),onSave:d,onUpdate:b,onDel:D},null,8,["modelValue","option","data"])}}}),ve=S({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(n,{emit:e}){var _;const l=n,{FormDesign:t}=U(),u=Q({get(){return l.modelValue?nt(l.modelValue):{menuBtn:!1,span:24}},set(d){e("update:modelValue",st(d,{useJson5:!1}))}}),s=Q(()=>l.fields?JSON.parse(l.fields):[]),i=Q(()=>{const d={type:"select",dicData:s.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return[{...d,props:{label:"name",value:"name",desc:"comment"}},{...d,props:{label:"comment",value:"comment",desc:"name"}}]}),c={form:{settings:Array.from({length:((_=ut.settings)==null?void 0:_.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(d,b)=>{const D=m("avue-form");return d.view?(V(),I(D,{key:0,class:Be(u.value.class),"model-value":{},option:u.value},null,8,["class","option"])):(V(),I(f(t),{key:1,modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=v=>u.value=v),"base-option":i.value,resources:c},null,8,["modelValue","base-option"]))}}}),vt={key:1},_t=S({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(n){const e=n,{formData:l,activeStep:t}=me(e),{request:u}=U(),{getDetail:s,useList:i}=le(u),{data:c}=Ie(u).useList(),{data:_}=xe(u).useList(),{data:d}=i(),b=Q(()=>{var v,p,r,w;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((v=c.value)==null?void 0:v.map(y=>({label:y.formName,value:y.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((p=d.value)==null?void 0:p.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((r=_.value)==null?void 0:r.map(y=>({label:y.flowName,value:y.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((w=d.value)==null?void 0:w.map(y=>({label:y.flowName,value:y.flowModuleId,type:"definition"})))??[]]:[]});async function D(v){if((t==null?void 0:t.value)===1){if(v.type==="template")l.value.formOption=v.value;else if(v.type==="definition"){const p=await s({flowModuleId:v.value});l.value.formOption=p.data.formOption}}else if((t==null?void 0:t.value)===2){if(v.type==="template")l.value.flowData=v.value;else if(v.type==="definition"){const p=await s({flowModuleId:v.value});l.value.flowData=p.data.flowData}}}return(v,p)=>{const r=m("el-link"),w=m("el-divider"),y=m("el-dropdown-item"),k=m("el-scrollbar"),g=m("el-dropdown-menu"),L=m("el-dropdown");return b.value.length?(V(),I(L,{key:0},{dropdown:o(()=>[a(g,null,{default:o(()=>[a(k,{"max-height":"600px"},{default:o(()=>[(V(!0),P(E,null,Y(b.value,h=>(V(),I(y,ge({key:h.label},h,{disabled:h.type==="divider",onClick:$=>D(h)}),{default:o(()=>[h.type==="divider"?(V(),I(w,{key:0},{default:o(()=>[F(A(h.label),1)]),_:2},1024)):(V(),P("span",vt,A(h.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[a(r,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[F(" 选择模板 ")]),_:1})]),_:1})):B("",!0)}}}),wt=H("span",null,"流程设计",-1),yt={key:0},bt={key:1},gt={style:{height:"calc(100vh - 144px)"}},kt=S({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(n,{emit:e}){const t=me(n),{visible:u,modelValue:s}=t,{request:i}=U(),{create:c,deploy:_,getDetail:d,update:b}=le(i),{getDetail:D,update:v}=fe(i),p=["流程信息","表单设计","模型设计","完成"],r=N(!1);ke(u,async x=>{if(!x)return;const{flowModuleId:C}=s.value,{flowDeployId:M}=s.value;try{r.value=!0;let T={};M?T=await D({flowDeployId:M}):C&&(T=await d({flowModuleId:C})),s.value=T.data}finally{r.value=!1}},{immediate:!0});const{data:w}=re(i).useList(),y=Q(()=>{var x,C;return(C=(x=w.value)==null?void 0:x.find(M=>M.tableName===s.value.formDataTable))==null?void 0:C.tableFields}),k=N(0),g=N();async function L(x){k.value===0&&await Ge(g),r.value=!0;const{flowModuleId:C}=s.value,{flowDeployId:M}=s.value;try{M?await v(s.value):C?await b(s.value):await c(s.value).then(T=>{s.value.flowModuleId=T.data.flowModuleId}),z.success("保存成功")}finally{r.value=!1}typeof x=="number"?k.value=x:k.value++}async function h(){await X.confirm("发布新版本，是否确认？","提示"),r.value=!0,_({flowModuleId:s.value.flowModuleId}).then(()=>{z.success("发布成功")}).finally(()=>{r.value=!1})}function $(){u.value=!1,k.value=0,s.value={},e("close")}return(x,C)=>{const M=m("el-col"),T=m("el-step"),q=m("el-steps"),W=m("el-button"),ae=m("el-row"),ne=m("avue-form"),se=m("el-result"),ie=m("el-dialog"),ue=Ve("loading");return V(),I(ie,{modelValue:f(u),"onUpdate:modelValue":C[6]||(C[6]=O=>G(u)?u.value=O:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:$},{header:o(()=>[a(ae,{justify:"center"},{default:o(()=>[a(M,{span:5},{default:o(()=>{var O,K,ee,_e;return[H("div",null,[wt,(O=f(s))!=null&&O.flowName?(V(),P("span",yt," - "+A((K=f(s))==null?void 0:K.flowName),1)):B("",!0),(ee=f(s))!=null&&ee.version?(V(),P("span",bt," - V"+A((_e=f(s))==null?void 0:_e.version),1)):B("",!0)]),a(_t,{"form-data":f(s),"onUpdate:formData":C[0]||(C[0]=Me=>G(s)?s.value=Me:null),"active-step":k.value},null,8,["form-data","active-step"])]}),_:1}),a(M,{span:14},{default:o(()=>[a(q,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(V(),P(E,null,Y(p,(O,K)=>a(T,{key:K,title:O,style:{cursor:"pointer"},onClick:ee=>L(K)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),a(M,{span:5,style:{"text-align":"right"}},{default:o(()=>[a(W,{disabled:k.value===0,loading:r.value,type:"primary",onClick:C[1]||(C[1]=O=>k.value--)},{default:o(()=>[F(" 上一步 ")]),_:1},8,["disabled","loading"]),a(W,{disabled:k.value===p.length-1,type:"primary",loading:r.value,onClick:C[2]||(C[2]=O=>L())},{default:o(()=>[F(" 下一步 ")]),_:1},8,["disabled","loading"]),a(W,{onClick:$},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[De((V(),P("div",gt,[k.value===0?(V(),I(ne,{key:0,ref_key:"formRef",ref:g,modelValue:f(s),"onUpdate:modelValue":C[3]||(C[3]=O=>G(s)?s.value=O:null),option:f(He),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","option"])):B("",!0),k.value===1?(V(),I(ve,{key:1,modelValue:f(s).formOption,"onUpdate:modelValue":C[4]||(C[4]=O=>f(s).formOption=O),fields:y.value},null,8,["modelValue","fields"])):B("",!0),k.value===2?(V(),I(ce,{key:2,modelValue:f(s).flowData,"onUpdate:modelValue":C[5]||(C[5]=O=>f(s).flowData=O),"flow-form-option":f(s).formOption},null,8,["modelValue","flow-form-option"])):B("",!0),k.value===3?(V(),I(se,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[f(s).flowDeployId?B("",!0):(V(),I(W,{key:0,type:"primary",onClick:h},{default:o(()=>[F(" 发布 ")]),_:1})),a(W,{onClick:$},{default:o(()=>[F(" 关闭 ")]),_:1})]),_:1})):B("",!0)])),[[ue,r.value]])]),_:1},8,["modelValue"])}}}),Vt=H("span",null,"流程查看",-1),Dt={key:0},Ft={key:1},Ct=S({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(n){const l=me(n),{visible:t,modelValue:u}=l,{request:s}=U(),{getDetail:i}=le(s),{getDetail:c}=fe(s),_=N("form"),d=N(!1);ke(t,async D=>{if(!D)return;const{flowModuleId:v}=u.value,{flowDeployId:p}=u.value;try{d.value=!0;let r={};p?r=await c({flowDeployId:p}):v&&(r=await i({flowModuleId:v})),u.value={...r.data}}finally{d.value=!1}},{immediate:!0});function b(){u.value={},_.value="form"}return(D,v)=>{const p=m("el-tab-pane"),r=m("el-tabs"),w=m("el-dialog"),y=Ve("loading");return V(),I(w,{modelValue:f(t),"onUpdate:modelValue":v[3]||(v[3]=k=>G(t)?t.value=k:null),width:"60%",top:"0",onClose:b},{header:o(()=>{var k,g,L,h;return[Vt,(k=f(u))!=null&&k.flowName?(V(),P("span",Dt," - "+A((g=f(u))==null?void 0:g.flowName),1)):B("",!0),(L=f(u))!=null&&L.version?(V(),P("span",Ft," - V"+A((h=f(u))==null?void 0:h.version),1)):B("",!0)]}),default:o(()=>[De((V(),I(r,{modelValue:_.value,"onUpdate:modelValue":v[2]||(v[2]=k=>_.value=k)},{default:o(()=>[a(p,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[_.value==="form"&&f(u).formOption?(V(),I(ve,{key:0,modelValue:f(u).formOption,"onUpdate:modelValue":v[0]||(v[0]=k=>f(u).formOption=k),view:""},null,8,["modelValue"])):B("",!0)]),_:1}),a(p,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[_.value==="flow"?(V(),I(ce,{key:0,modelValue:f(u).flowData,"onUpdate:modelValue":v[1]||(v[1]=k=>f(u).flowData=k),view:""},null,8,["modelValue"])):B("",!0)]),_:1})]),_:1},8,["modelValue"])),[[y,d.value]])]),_:1},8,["modelValue"])}}}),ht=S({__name:"index",setup(n){const e=N("definition"),l=N({}),t=N(""),u=N("");function s(r){t.value===r.id?t.value="":t.value=r.id}const i=N(!1),c=N(!1);function _(){l.value={},i.value=!0}function d(r){l.value=r,i.value=!0}function b(r){l.value=r,c.value=!0}function D(r){u.value=r.flowModuleId||"",e.value="deploy"}function v(){u.value="",e.value="definition"}async function p(){const r=e.value;await ye(),e.value="",await ye(),e.value=`${r}`}return(r,w)=>{const y=m("el-col"),k=m("el-row");return V(),I(k,{gutter:20},{default:o(()=>[a(y,{span:4},{default:o(()=>[a(ft,{onNodeClick:s})]),_:1}),a(y,{span:20},{default:o(()=>[e.value==="definition"?(V(),I(Ne,{key:0,"category-id":t.value,onAdd:_,onEdit:d,onView:b,onVersion:D},null,8,["category-id"])):B("",!0),e.value==="deploy"&&u.value?(V(),I(Pe,{key:1,"flow-module-id":u.value,onEdit:d,onView:b,onBack:v},null,8,["flow-module-id"])):B("",!0),a(kt,{modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=g=>l.value=g),visible:i.value,"onUpdate:visible":w[1]||(w[1]=g=>i.value=g),onClose:p},null,8,["modelValue","visible"]),a(Ct,{modelValue:l.value,"onUpdate:modelValue":w[2]||(w[2]=g=>l.value=g),visible:c.value,"onUpdate:visible":w[3]||(w[3]=g=>c.value=g)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Ot=S({__name:"index",setup(n){const e=it("debugMode",!1),{request:l}=U(),{getTaskOpsList:t}=dt(l),{getCirculateOpsList:u,updateCirculate:s,removeCirculate:i}=Oe(l),{bindVal:c,getDataList:_,crudStateRefs:{searchForm:d,crudOption:b}}=R({tableOption:Qe,crudOption:{getList:t},searchForm:{status:2},sortOption:{descs:"start_time"}});oe(d,_,{debounce:300,immediate:!0,deep:!0});const D=N("task"),v=[{label:"任务",name:"task",getList:t},{label:"传阅",name:"circulate",getList:u,update:s,remove:i}];function p({paneName:k}){const g=v.find(L=>L.name===k);b.value.getList=g.getList,b.value.update=g.update,b.value.remove=g.remove,_()}const{open:r,close:w}=Te();function y(k){r({flowKey:k.flowKey,taskId:k.taskId,instanceId:k.flowInstanceId,debug:e.value,circulateId:k.id,onComplete(){w(),_()}})}return(k,g)=>{const L=m("el-tab-pane"),h=m("el-tabs"),$=m("el-switch"),x=m("el-button"),C=m("el-link"),M=m("avue-crud");return V(),P(E,null,[a(h,{modelValue:D.value,"onUpdate:modelValue":g[0]||(g[0]=T=>D.value=T),onTabClick:p},{default:o(()=>[(V(),P(E,null,Y(v,T=>a(L,{key:T.name,label:T.label,name:T.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),a(M,ge(f(c),{permission:{menu:D.value==="circulate"}}),{"menu-right":o(()=>[a(x,{type:"text"},{default:o(()=>[a($,{modelValue:f(e),"onUpdate:modelValue":g[1]||(g[1]=T=>G(e)?e.value=T:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:T})=>[a(C,{type:"primary",underline:!1,onClick:q=>y(T)},{default:o(()=>[F(A(T.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16,["permission"])],64)}}}),Lt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,column:[{label:"配置名称",prop:"paramName",search:!0},{label:"配置Key",prop:"paramKey",search:!0},{label:"备注",prop:"remark"},{label:"系统内置",prop:"paramType",type:"switch",dicData:Ye},{label:"配置值",prop:"paramValue",type:"textarea",maxRows:20,span:24,overHidden:!0}]},xt=S({__name:"index",setup(n){const{request:e}=U(),{bindVal:l,getDataList:t}=R({tableOption:Lt,crudOption:Fe(e)});return t(),(u,s)=>{const i=m("avue-crud");return V(),I(i,j(J(f(l))),null,16)}}}),It={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,menu:!1,addBtn:!1,column:[{label:"流程名称",prop:"flowName"},{label:"流程标识",prop:"flowKey"},{label:"流程分类",prop:"categoryId",type:"select",search:!0,dicUrl:"/sapier-flow/flow-category/list",props:{label:"name",value:"id"}},{label:"标题",prop:"processTitle",search:!0},{label:"流水号",prop:"serialNumber"},{label:"当前节点",prop:"taskNodeName"},{label:"审批人",prop:"assigneeName"},{label:"申请人",prop:"applyUserName"},{label:"接收时间",prop:"startTime"}]},$t={class:"flow-list"},Tt=["onClick"],Nt={class:"flow-name"},Pt=S({__name:"index",setup(n){const{request:e}=U(),{useList:l}=he(e),{usePublishList:t,getTaskList:u}=Xe(e),{getCirculateList:s}=Oe(e),{data:i}=l(),{data:c}=t(),_=Q(()=>{var h;return(h=i.value)==null?void 0:h.map($=>{var C;const x=((C=c.value)==null?void 0:C.filter(M=>M.categoryId===$.id))??[];return{...$,list:x}}).filter($=>{var x;return(x=$.list)==null?void 0:x.length})}),d=[{label:"待办",value:2},{label:"已办",value:1}],{bindVal:b,getDataList:D,crudStateRefs:{searchForm:v,crudOption:p}}=R({tableOption:It,crudOption:{getList:u},searchForm:{status:2}});oe(v,D,{debounce:300,immediate:!0,deep:!0});const r=N("task"),w=[{label:"任务",name:"task",getList:u},{label:"传阅",name:"circulate",getList:s}];function y({paneName:h}){const $=w.find(x=>x.name===h);p.value.getList=$.getList,D()}const{open:k,close:g}=Te();function L(h){k({flowKey:h.flowKey,taskId:h.taskId,instanceId:h.flowInstanceId,circulateId:h.id,detail:h.taskId?h.status===Ze.已办:!1,onComplete(){g(),D()}})}return(h,$)=>{const x=m("el-button"),C=m("el-divider"),M=m("Icon"),T=m("el-collapse-item"),q=m("el-collapse"),W=m("el-card"),ae=m("el-tab-pane"),ne=m("el-tabs"),se=m("avue-radio"),ie=m("el-link"),ue=m("avue-crud");return V(),P(E,null,[a(W,{"body-style":{padding:"0 20px"}},{default:o(()=>[a(q,{"model-value":"1"},{default:o(()=>[a(T,{name:"1"},{title:o(()=>[a(x,{text:"",icon:"el-icon-promotion"},{default:o(()=>[F(" 发起审批 ")]),_:1})]),default:o(()=>[H("div",$t,[(V(!0),P(E,null,Y(_.value,O=>(V(),P("div",{key:O.id,class:"flow-category"},[a(C,{"content-position":"left"},{default:o(()=>[F(A(O.name),1)]),_:2},1024),(V(!0),P(E,null,Y(O.list,K=>(V(),P("div",{key:K.flowKey,class:"flow-item",onClick:ee=>L(K)},[a(M,{class:"flow-icon",icon:K.flowIcon,width:"60"},null,8,["icon"]),H("div",Nt,A(K.flowName),1)],8,Tt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),a(C,{direction:"horizontal","content-position":"left"}),a(ne,{modelValue:r.value,"onUpdate:modelValue":$[0]||($[0]=O=>r.value=O),onTabClick:y},{default:o(()=>[(V(),P(E,null,Y(w,O=>a(ae,{key:O.name,label:O.label,name:O.name},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),a(ue,j(J(f(b))),{"menu-left":o(()=>[a(se,{modelValue:f(v).status,"onUpdate:modelValue":$[1]||($[1]=O=>f(v).status=O),button:"",dic:d},null,8,["modelValue"])]),processTitle:o(({row:O})=>[a(ie,{type:"primary",underline:!1,onClick:K=>L(O)},{default:o(()=>[F(A(O.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Mt=Ae(Pt,[["__scopeId","data-v-506d1a0f"]]),Ut={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"流程标识",prop:"flowKey",search:!0},{label:"流程名称",prop:"flowName",search:!0},{label:"流程备注",prop:"remarks"},{label:"排序",prop:"sort"}]},St=S({__name:"index",setup(n){const{request:e}=U(),{bindVal:l,crudStateRefs:{formData:t},getDataList:u,handleUpdate:s}=R({tableOption:Ut,crudOption:xe(e)});u();const i=N(!1);async function c(d){t.value=d,i.value=!0}async function _(){await s(t.value,NaN,()=>i.value=!1,()=>{})}return(d,b)=>{const D=m("el-button"),v=m("avue-crud"),p=m("el-dialog");return V(),P(E,null,[a(v,j(J(f(l))),{menu:o(({row:r})=>[a(D,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>c(r)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),a(p,{modelValue:i.value,"onUpdate:modelValue":b[2]||(b[2]=r=>i.value=r),title:`模型设计-${f(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[a(D,{type:"primary",onClick:_},{default:o(()=>[F(" 保存 ")]),_:1}),a(D,{onClick:b[1]||(b[1]=r=>i.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[a(ce,{modelValue:f(t).flowData,"onUpdate:modelValue":b[0]||(b[0]=r=>f(t).flowData=r),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Bt={rowKey:"id",align:"center",index:!0,border:!0,stripe:!0,searchMenuSpan:6,span:24,column:[{label:"表单标识",prop:"formKey",search:!0},{label:"表单名称",prop:"formName",search:!0},{label:"表单备注",prop:"remarks"},{label:"排序",prop:"sort",type:"number"}]},At=S({__name:"index",setup(n){const{request:e}=U(),{bindVal:l,crudStateRefs:{formData:t},getDataList:u,handleUpdate:s}=R({tableOption:Bt,crudOption:Ie(e)});u();const i=N(!1);async function c(d){t.value={...d},i.value=!0}async function _(){await s(t.value,NaN,()=>i.value=!1,()=>{})}return(d,b)=>{const D=m("el-button"),v=m("avue-crud"),p=m("el-dialog");return V(),P(E,null,[a(v,j(J(f(l))),{menu:o(({row:r})=>[a(D,{type:"primary",text:"",icon:"el-icon-crop",onClick:w=>c(r)},{default:o(()=>[F(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),a(p,{modelValue:i.value,"onUpdate:modelValue":b[2]||(b[2]=r=>i.value=r),title:`表单设计-${f(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[a(D,{type:"primary",onClick:_},{default:o(()=>[F(" 保存 ")]),_:1}),a(D,{onClick:b[1]||(b[1]=r=>i.value=!1)},{default:o(()=>[F(" 取消 ")]),_:1})]),default:o(()=>[a(ve,{modelValue:f(t).formOption,"onUpdate:modelValue":b[0]||(b[0]=r=>f(t).formOption=r),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Kt=H("br",null,null,-1),Et=S({__name:"index",setup(n){const{request:e}=U(),{bindVal:l,crudStateRefs:{formData:t,defaults:u},getDataList:s,afterOpen:i,beforeSubmit:c}=R({crudOption:re(e),tableOption:qe});s();const{data:_}=Fe(e).useParam("table.default.fields");i(w=>{if(t.value.defaultFields=_.value??[],w==="edit"){const y=JSON.parse(t.value.tableFields);t.value.editFields=rt(y,_.value??[],"name")}}),c(w=>{const y=[...w.defaultFields,...w.editFields];w.tableFields=JSON.stringify(y)});const d=N(!1);de(()=>{var w;(w=u.value)!=null&&w.defaultFields&&(u.value.defaultFields.display=d.value)});const{deploy:b,getFields:D}=re(e),v=N(!1);async function p(w){await X.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),v.value=!0,b({id:w.id}).then(()=>{z.success("部署成功"),s()}).finally(()=>{v.value=!1})}function r(){D({tableName:t.value.tableName}).then(w=>{var y;if(!((y=w.data)!=null&&y.length))return z.warning("未找到该表");t.value.editFields=w.data})}return(w,y)=>{const k=m("el-button"),g=m("el-input"),L=m("el-switch"),h=m("el-tooltip"),$=m("avue-crud");return V(),I($,j(J(f(l))),{menu:o(({row:x})=>[a(k,{type:"text",icon:"el-icon-upload",onClick:C=>p(x)},{default:o(()=>[F(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[a(g,{modelValue:f(t).tableName,"onUpdate:modelValue":y[0]||(y[0]=x=>f(t).tableName=x),placeholder:"请输入 表名"},{append:o(()=>[a(k,{type:"primary",size:"default",onClick:r},{default:o(()=>[F(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[H("div",null,[F(" 数据库字段 "),Kt,a(h,{content:"显示默认字段"},{default:o(()=>[a(L,{modelValue:d.value,"onUpdate:modelValue":y[1]||(y[1]=x=>d.value=x)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Rt=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:mt,PageFlowDefinition:Ne,PageFlowDeploy:Pe,PageFlowManage:ht,PageFlowOps:Ot,PageFlowParam:xt,PageFlowTemplate:St,PageFlowWorkbench:Mt,PageFormTemplate:At,PageTableTemplate:Et},Symbol.toStringTag,{value:"Module"})),fo={install(n,e){Object.entries(Rt).forEach(([l,t])=>{n.component(l,t)}),U(n,e)}};export{wo as ApprovalForm,yo as ButtonList,Re as CONFIG_DEFAULT,bo as CONFIG_PROVIDE_KEY,go as FieldType,ko as FlowButtonApproval,Vo as FlowButtonDisplay,Do as FlowButtonKey,Fo as FlowButtonStatus,Co as FlowButtonType,Ee as FlowForm,ho as FlowStatus,Oo as HandleType,Lo as InternalForm,Le as IsMainVersion,mt as PageFlowButton,Ne as PageFlowDefinition,Pe as PageFlowDeploy,ht as PageFlowManage,Ot as PageFlowOps,xt as PageFlowParam,St as PageFlowTemplate,Mt as PageFlowWorkbench,At as PageFormTemplate,Et as PageTableTemplate,xo as TablePrimary,Ze as TaskStatus,Io as UploadTable,$o as Whether,Ge as asyncValidate,fo as default,To as fieldTypeDic,No as flowFormEmits,Po as flowFormProps,Mo as flowTrack,Uo as injectionKey,So as tablePrimaryDic,Bo as useButtonHandler,Ao as useCommonCommentApi,U as useConfigProvider,je as useFlowButtonApi,he as useFlowCategoryApi,Oe as useFlowCirculateApi,le as useFlowDefinitionApi,fe as useFlowDeployApi,Ko as useFlowFileApi,Te as useFlowForm,pt as useFlowFormOverlay,ct as useFlowFormWindow,dt as useFlowOpsApi,Fe as useFlowParamApi,Xe as useFlowTaskApi,xe as useFlowTemplateApi,Eo as useFlowUserApi,Ro as useFormDefaults,Ie as useFormTemplateApi,zo as useInjectState,jo as useProvideState,re as useTableTemplateApi,Ye as whetherDic};
