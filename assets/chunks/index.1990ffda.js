import{c as P,C as Ae,t as Be,d as Ee,e as Ke,f as Re,g as ie,h as ze,F as ue,b as je,i as We,T as te,j as Je,k as ye,l as Ge,m as He,n as Qe,o as Xe,p as Ye}from"./mobile.de88c1f7.js";import{K as Qo,L as Xo,D as Yo,w as Zo,v as qo,s as el,x as tl,r as ol,_ as ll,z as al,H as nl,N as sl,B as il,O as ul,W as rl,E as dl,I as cl,U as pl,S as ml,M as fl,V as vl,Y as _l,R as wl,J as yl,P as gl,q as bl,Q as kl,y as Dl,A as Fl,a as Vl,u as Cl,X as hl,G as Ol}from"./mobile.de88c1f7.js";import{h as T,a5 as ve,aE as Ze,D as qe,d as M,J as _,b as h,w as o,a9 as z,aa as j,l as d,o as D,N as s,e as N,a as C,t as K,A as re,B as Y,g as J,n as et,c as A,L as oe,R as ge,K as G,z as be,aF as ke,k as H,a7 as De,E as _e,_ as tt}from"./framework.6b67ac47.js";import"./index.013eb64a.js";import{s as ot}from"./index.386fc70b.js";import{m as de}from"./merge.0f542de0.js";import{a as Fe}from"./omitBy.496be11f.js";import{a as lt}from"./snakeCase.f05f4dc6.js";import{k as at}from"./baseGet.f3f2ab16.js";import{i as nt}from"./isNil.990ccdb3.js";import{E as st,a as it}from"../app.bd7d715f.js";import{u as R}from"./index.2a155e22.js";import"./index.es.1accc3d3.js";import{I as Z}from"./iconify.924204c7.js";import"./index.ba494e7e.js";import"./form.814fb769.js";import"./index.100f92e3.js";import"./index.6700b933.js";import{j as ut,d as rt}from"./tree.50ccd3e9.js";import"./vuedraggable.umd.9831e9f5.js";import{u as q}from"./index.568e6668.js";import{d as dt}from"./union.c774781a.js";import{a as Q,E as B}from"./index.b68c08c0.js";import{p as ct}from"./pick.c38fd284.js";import{w as le,a as ce,u as pt,b as mt,c as ft}from"./index.63550f19.js";import{f as vt,b as _t}from"./form.d4ae7eba.js";import{e as wt}from"./index.0246ace1.js";import{d as yt}from"./zipWith.8642dcad.js";import"./index.da343e5c.js";import"./cloneDeep.6b1411dd.js";import"./baseSet.84292f44.js";import"./initCloneObject.fb0a9e5d.js";import"./getTag.9f0d1dee.js";import"./data.0c1ff404.js";import"./get.51c768ca.js";import"./basePickBy.40d88517.js";import"./pickBy.e06d9ce3.js";import"./baseMap.717c06fd.js";import"./createCompounder.12670e9b.js";import"./theme.43c1b85a.js";import"./index.vue_vue_type_script_setup_true_lang.814d8a22.js";import"./index.bde6247e.js";import"./use-form-item.18167ea7.js";import"./isEqual.1cc8ee6e.js";import"./index.caee73d1.js";import"./config.ed7166e7.js";import"./index.6748db2d.js";import"./set.30e920c7.js";import"./kebabCase.47021076.js";import"./state-local.dd516420.js";import"./vue.runtime.esm-bundler.21b58301.js";function Ve(u){const e={list:"/sapier-flow/flow-category/list",save:"/sapier-flow/flow-category/save",update:"/sapier-flow/flow-category/update",remove:"/sapier-flow/flow-category/remove",tree:"/sapier-flow/flow-category/tree"},a=v=>u.get(e.list,{params:v}),t=q(a,{res:"data",defaultParams:[{size:-1,ascs:"sort"}]});return{getList:a,useList:t,getTree:v=>u.get(e.tree,{params:v}),create:v=>u.post(e.save,v),update:v=>u.post(e.update,v),remove:v=>u.post(e.remove,{},{params:{ids:v}})}}function ae(u){const e={list:"/sapier-flow/flow-definition/list",save:"/sapier-flow/flow-definition/save",update:"/sapier-flow/flow-definition/update",remove:"/sapier-flow/flow-definition/remove",detail:"/sapier-flow/flow-definition/detail",deploy:"/sapier-flow/flow-definition/deployFlow"},a=c=>u.get(e.list,{params:c}),t=q(a,{res:"data.records",defaultParams:[{size:-1,ascs:"sort"}]});return{url:e,getList:a,useList:t,create:c=>u.post(e.save,c),update:c=>u.post(e.update,c),remove:c=>u.post(e.remove,{},{params:{ids:c}}),deploy:c=>u.post(e.deploy,c),getDetail:c=>u.get(e.detail,{params:c})}}var Ce=(u=>(u[u.否=0]="否",u[u.是=1]="是",u))(Ce||{});function pe(u){const e={list:"/sapier-flow/flow-deploy/list",update:"/sapier-flow/flow-deploy/update",remove:"/sapier-flow/flow-deploy/remove",detail:"/sapier-flow/flow-deploy/detail"},a=i=>u.get(e.list,{params:i}),t=q(a,{res:"data"});return{url:e,getList:a,useList:t,getDetail:i=>u.get(e.detail,{params:i}),update:i=>u.post(e.update,i),remove:i=>u.post(e.remove,{},{params:{ids:i}})}}function gt(u){const e={list:"/sapier-flow/flow-ops/list"},a=l=>u.get(e.list,{params:l}),t=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getTaskOpsList:a,useTaskOpsList:t}}function he(u){const e={list:"/sapier-flow/dev-flow/list",save:"/sapier-flow/dev-flow/save",update:"/sapier-flow/dev-flow/update",remove:"/sapier-flow/dev-flow/remove"},a=i=>u.get(e.list,{params:i}),t=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getList:a,useList:t,create:i=>u.post(e.save,i),update:i=>u.post(e.update,i),remove:i=>u.post(e.remove,{},{params:{ids:i}})}}function Oe(u){const e={list:"/sapier-flow/dev-form/list",save:"/sapier-flow/dev-form/save",update:"/sapier-flow/dev-form/update",remove:"/sapier-flow/dev-form/remove"},a=i=>u.get(e.list,{params:i}),t=q(a,{res:"data.records",defaultParams:[{size:-1}]});return{url:e,getList:a,useList:t,create:i=>u.post(e.save,i),update:i=>u.post(e.update,i),remove:i=>u.post(e.remove,{},{params:{ids:i}})}}function $e(u,e){return e in(Ae.useFlowFormOptions??{})}function ne(u={}){const{useFlowFormOptions:e}=P(),a=de({...e},{...u});switch(a==null?void 0:a.type){case"window":return bt(a);case"dialog":case"drawer":return kt(a);default:return{open:t=>{},close:()=>{}}}}function bt(u={}){const e=T(null);return{open:(l={})=>{var w;const n=de({...u},{...l}),{window:[r,i,v]=[]}=n,c=`${r}?${ot(Fe(n,lt(at,nt,$e)))}`;e.value=window.open(c,i,v),(w=e.value)==null||w.addEventListener("message",V=>{const{event:y,data:b}=V.data,m=l[y];typeof m=="function"&&m(b)})},close:()=>{var l;return(l=e.value)==null?void 0:l.close()},openedWindow:e}}function kt(u={}){const{appContext:e}=qe(),{FlowForm:a}=P();let t,l;const n=i=>{t=document.createElement("div"),t.className="flow-form-wrapper";const v=de({...u},{...i}),c=ve(a,Fe(v,$e));l=ve(v.type==="dialog"?st:it,{class:"flow-form-overlay",modelValue:!0,onClose:r,...v.overlay},c),l.appContext=e,Ze(l,t),document.body.appendChild(t)},r=()=>{var i,v;(v=(i=l==null?void 0:l.component)==null?void 0:i.props)!=null&&v.modelValue&&(l.component.props.modelValue=!1),t&&document.body.removeChild(t),t=null};return{open:n,close:r}}const Dt=M({__name:"index",setup(u){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:t},getDataList:l}=R({tableOption:Be,crudOption:Ee(e),sortOption:{ascs:"sort"}});return l(),(n,r)=>{const i=_("el-button"),v=_("avue-crud");return D(),h(v,z(j(d(a))),{icon:o(({row:c})=>[s(d(Z),{icon:c.icon,style:{display:"inline"}},null,8,["icon"])]),buttonPreview:o(({row:c})=>[s(i,{type:c.buttonType},{default:o(()=>[c.icon?(D(),h(d(Z),{key:0,icon:c.icon},null,8,["icon"])):N("",!0),C(" "+K(c.name),1)]),_:2},1032,["type"])]),"buttonPreview-form":o(()=>[s(i,{type:d(t).buttonType},{default:o(()=>[d(t).icon?(D(),h(d(Z),{key:0,icon:d(t).icon},null,8,["icon"])):N("",!0),C(" "+K(d(t).name),1)]),_:1},8,["type"])]),_:1},16)}}}),Ie=M({__name:"index",props:{categoryId:{}},emits:["add","view","edit","version"],setup(u,{emit:e}){const a=u,{request:t}=P(),{getList:l,deploy:n,update:r,remove:i}=ae(t),{bindVal:v,crudStateRefs:{searchForm:c},getDataList:w}=R({tableOption:Ke,crudOption:{getList:l,remove:i},sortOption:{ascs:"sort"},searchForm:{categoryId:a.categoryId}});re(()=>{c.value.categoryId=a.categoryId??""}),le(c,w,{debounce:300,immediate:!0,deep:!0});const V=T(!1);async function y(k){await Q.confirm("发布新版本，是否确认？","提示",{type:"success"}),V.value=!0,n({flowModuleId:k.flowModuleId}).then(()=>{B.success("发布成功"),w()}).finally(()=>{V.value=!1})}async function b(k){if(k.mainVersion)return B.warning("请先删除已发布的流程");await Q.confirm("确认删除？","提示",{type:"warning"}),await i(k.flowModuleId),B.success("删除成功"),w()}function m(k){r(ct(k,["flowModuleId","flowKey","sort"])),w()}const p=dt(m,500),{open:f,close:F}=ne();function O(k){f({flowKey:k.flowKey,debug:!0,onComplete(){F(),B.success("操作成功")}})}return(k,I)=>{const E=_("el-button"),x=_("el-dropdown-item"),S=_("el-input-number"),L=_("avue-crud");return D(),h(L,z(j(d(v))),{"menu-left":o(()=>[s(E,{type:"primary",icon:"el-icon-plus",onClick:I[0]||(I[0]=g=>e("add"))},{default:o(()=>[C(" 新增 ")]),_:1})]),"menu-btn":o(({row:g})=>[s(x,{icon:"el-icon-view",onClick:$=>e("view",g)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),s(x,{icon:"el-icon-edit",onClick:$=>e("edit",g)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),s(x,{icon:"el-icon-delete",onClick:$=>b(g)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),s(x,{icon:"el-icon-video-play",onClick:$=>O(g)},{default:o(()=>[C(" 调试 ")]),_:2},1032,["onClick"]),s(x,{icon:"el-icon-upload",onClick:$=>y(g)},{default:o(()=>[C(" 发布 ")]),_:2},1032,["onClick"]),s(x,{icon:"el-icon-switch",onClick:$=>e("version",g)},{default:o(()=>[C(" 版本管理 ")]),_:2},1032,["onClick"])]),flowIcon:o(({row:g})=>[s(d(Z),{icon:g.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),sort:o(({row:g})=>[s(S,{modelValue:g.sort,"onUpdate:modelValue":$=>g.sort=$,"controls-position":"right",style:{width:"100%"},onChange:$=>d(p)(g)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1},16)}}}),xe=M({__name:"index",props:{flowModuleId:{}},emits:["back","view","edit"],setup(u,{emit:e}){const a=u,{request:t}=P(),{getList:l,update:n,remove:r}=pe(t),{bindVal:i,crudStateRefs:{searchForm:v,tableData:c},getDataList:w}=R({tableOption:Re,crudOption:{getList:l,dataPath:"res.data"},sortOption:{descs:"version"}});re(()=>{v.value.flowModuleId=a.flowModuleId}),le(v,w,{debounce:300,immediate:!0,deep:!0});const V=T(!1);async function y(F){await Q.confirm(`确定将 ${F.flowName}(${F.flowKey}:v${F.version}) 设为主版本?`,"提示",{type:"warning"}),V.value=!0,n({flowDeployId:F.flowDeployId,flowModuleId:F.flowModuleId,mainVersion:1}).then(()=>{B.success("设置成功"),w()}).finally(()=>{V.value=!1})}async function b(F){const{value:O}=await Q.prompt("请输入确认删除的流程标识","提示",{type:"warning"});O===F.flowKey&&(await r(F.flowDeployId),B.success("删除成功"),w())}const{open:m,close:p}=ne();function f(){var O;const F=(O=c.value[0])==null?void 0:O.flowKey;F&&m({flowKey:F,debug:!0,onComplete(){p(),B.success("操作成功")}})}return(F,O)=>{const k=_("el-button"),I=_("el-tooltip"),E=_("el-dropdown-item"),x=_("avue-crud");return D(),h(x,z(j(d(i))),{"menu-left":o(()=>[s(k,{loading:V.value,type:"primary",icon:"el-icon-arrow-left",onClick:O[0]||(O[0]=S=>e("back"))},{default:o(()=>[C(" 返回 ")]),_:1},8,["loading"])]),"menu-right":o(()=>[s(I,{content:"调试"},{default:o(()=>[s(k,{icon:"el-icon-video-play",circle:"",onClick:f})]),_:1})]),"menu-btn":o(({row:S})=>[s(E,{icon:"el-icon-view",onClick:L=>e("view",S)},{default:o(()=>[C(" 查看 ")]),_:2},1032,["onClick"]),s(E,{icon:"el-icon-edit",onClick:L=>e("edit",S)},{default:o(()=>[C(" 编辑 ")]),_:2},1032,["onClick"]),s(E,{icon:"el-icon-delete",onClick:L=>b(S)},{default:o(()=>[C(" 删除 ")]),_:2},1032,["onClick"]),s(E,{icon:"el-icon-switch",disabled:S.mainVersion===d(Ce).是,onClick:L=>y(S)},{default:o(()=>[C(" 设为主版本 ")]),_:2},1032,["disabled","onClick"])]),flowIcon:o(({row:S})=>[s(d(Z),{icon:S.flowIcon,width:"25",style:{display:"inline"}},null,8,["icon"])]),_:1},16)}}}),we={defaultExpandAll:!0,props:{label:"name",value:"id"},filter:!0,formOption:{span:24,column:[{label:"分类名称",prop:"name",rules:[{required:!0,message:"请输入分类名称"}]},{label:"描述",prop:"remark"},{label:"排序",prop:"sort",type:"number"}]}},Ft=M({__name:"index",emits:["node-click"],setup(u,{emit:e}){const{request:a}=P(),{crudStateRefs:{formData:t,tableData:l},getDataList:n,handleSave:r,handleUpdate:i,handleDel:v}=R({crudOption:{rowKey:"id",...Ve(a),dataPath:"res.data"},sortOption:{ascs:"sort"},tableOption:we,pageOption:{pageSize:20}});n();function c(y,b,m,p){r(b,m,p)}function w(y,b,m,p){i(b,Number.NaN,m,p)}async function V(y,b){await v(y.data,Number.NaN),b()}return(y,b)=>{const m=_("avue-tree");return D(),h(m,{modelValue:d(t),"onUpdate:modelValue":b[0]||(b[0]=p=>Y(t)?t.value=p:null),option:d(we),data:d(l),onNodeClick:b[1]||(b[1]=p=>e("node-click",p)),onSave:c,onUpdate:w,onDel:V},null,8,["modelValue","option","data"])}}}),me=M({__name:"index",props:{modelValue:{},view:{type:Boolean},fields:{}},emits:["update:modelValue"],setup(u,{emit:e}){var v;const a=u,{FormDesign:t}=P(),l=J({get(){return a.modelValue?ut(a.modelValue):{menuBtn:!1,span:24}},set(c){e("update:modelValue",rt(c,{useJson5:!1}))}}),n=J(()=>a.fields?JSON.parse(a.fields):[]),r=J(()=>{const c={type:"select",dicData:n.value,filterable:!0,allowCreate:!0,defaultFirstOption:!0};return w=>{const V=_t(w);return[{...c,props:{label:"name",value:"name",desc:"comment"}},{...c,props:{label:"comment",value:"comment",desc:"name"}},...Array.from({length:((V==null?void 0:V.length)??0)-2}).fill({}).concat({label:"样式类",prop:"class"})]}}),i={form:{settings:Array.from({length:((v=vt.settings)==null?void 0:v.length)??0}).fill({}).concat({label:"样式类",prop:"class"})}};return(c,w)=>{const V=_("avue-form");return c.view?(D(),h(V,{key:0,class:et(l.value.class),"model-value":{},option:l.value},null,8,["class","option"])):(D(),h(d(t),{key:1,modelValue:l.value,"onUpdate:modelValue":w[0]||(w[0]=y=>l.value=y),"base-option":r.value,resources:i},null,8,["modelValue","base-option"]))}}}),Vt={key:1},Ct=M({__name:"template-select",props:{formData:{type:Object,default:()=>({})},activeStep:{type:Number}},setup(u){const e=u,{formData:a,activeStep:t}=ce(e),{request:l}=P(),{getDetail:n,useList:r}=ae(l),{data:i}=Oe(l).useList(),{data:v}=he(l).useList(),{data:c}=r(),w=J(()=>{var y,b,m,p;return(t==null?void 0:t.value)===1?[{label:"表单模板",value:"",type:"divider"},...((y=i.value)==null?void 0:y.map(f=>({label:f.formName,value:f.formOption,type:"template"})))??[],{label:"已有表单",value:"",type:"divider"},...((b=c.value)==null?void 0:b.map(f=>({label:f.flowName,value:f.flowModuleId,type:"definition"})))??[]]:(t==null?void 0:t.value)===2?[{label:"流程模板",value:"",type:"divider"},...((m=v.value)==null?void 0:m.map(f=>({label:f.flowName,value:f.flowData,type:"template"})))??[],{label:"已有流程",value:"",type:"divider"},...((p=c.value)==null?void 0:p.map(f=>({label:f.flowName,value:f.flowModuleId,type:"definition"})))??[]]:[]});async function V(y){if((t==null?void 0:t.value)===1){if(y.type==="template")a.value.formOption=y.value;else if(y.type==="definition"){const b=await n({flowModuleId:y.value});a.value.formOption=b.data.formOption}}else if((t==null?void 0:t.value)===2){if(y.type==="template")a.value.flowData=y.value;else if(y.type==="definition"){const b=await n({flowModuleId:y.value});a.value.flowData=b.data.flowData}}}return(y,b)=>{const m=_("el-link"),p=_("el-divider"),f=_("el-dropdown-item"),F=_("el-scrollbar"),O=_("el-dropdown-menu"),k=_("el-dropdown");return w.value.length?(D(),h(k,{key:0},{dropdown:o(()=>[s(O,null,{default:o(()=>[s(F,{"max-height":"600px"},{default:o(()=>[(D(!0),A(G,null,oe(w.value,I=>(D(),h(f,ge({key:I.label},I,{disabled:I.type==="divider",onClick:E=>V(I)}),{default:o(()=>[I.type==="divider"?(D(),h(p,{key:0},{default:o(()=>[C(K(I.label),1)]),_:2},1024)):(D(),A("span",Vt,K(I.label),1))]),_:2},1040,["disabled","onClick"]))),128))]),_:1})]),_:1})]),default:o(()=>[s(m,{icon:"el-icon-arrow-down",underline:!1},{default:o(()=>[C(" 选择模板 ")]),_:1})]),_:1})):N("",!0)}}}),ht=H("span",null,"流程设计",-1),Ot={key:0},$t={key:1},It={style:{height:"calc(100vh - 144px)"}},xt=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},emits:["close"],setup(u,{emit:e}){const t=ce(u),{visible:l,modelValue:n}=t,{request:r}=P(),{create:i,deploy:v,getDetail:c,update:w}=ae(r),{getDetail:V,update:y}=pe(r),b=["流程信息","表单设计","模型设计","完成"],m=T(),p=T(),f=T(!1);be(()=>[l.value,m.value],async()=>{var $;if(!l.value||!m.value)return;const{flowModuleId:L}=n.value,{flowDeployId:g}=n.value;try{f.value=!0;let W={};g?W=await V({flowDeployId:g}):L&&(W=await c({flowModuleId:L})),n.value=W.data,($=p.value)!=null&&$.sort&&(p.value.sort.display=!n.value.flowDeployId)}finally{f.value=!1}},{immediate:!0});const{data:F}=ie(r).useList(),O=J(()=>{var L,g;return(g=(L=F.value)==null?void 0:L.find($=>$.tableName===n.value.formDataTable))==null?void 0:g.tableFields}),k=T(0);async function I(L){k.value===0&&await je(m),f.value=!0;const{flowModuleId:g}=n.value,{flowDeployId:$}=n.value;try{$?await y(n.value):g?await w(n.value):await i(n.value).then(W=>{n.value.flowModuleId=W.data.flowModuleId}),B.success("保存成功")}finally{f.value=!1}typeof L=="number"?k.value=L:k.value++}async function E(){await Q.confirm("发布新版本，是否确认？","提示"),f.value=!0,v({flowModuleId:n.value.flowModuleId}).then(()=>{B.success("发布成功")}).finally(()=>{f.value=!1})}function x(){l.value=!1,k.value=0,n.value={},e("close")}async function S(){await Q.confirm("流程定义的数据(包括流程信息、表单设计、流程设计)将被修改为当前版本的数据，是否确认？","提示"),await w(n.value),B.success("同步成功")}return(L,g)=>{const $=_("el-col"),W=_("el-step"),Te=_("el-steps"),X=_("el-button"),Pe=_("el-row"),Le=_("avue-form"),Ne=_("el-result"),Ue=_("el-dialog"),Me=ke("loading");return D(),h(Ue,{modelValue:d(l),"onUpdate:modelValue":g[7]||(g[7]=U=>Y(l)?l.value=U:null),fullscreen:"","show-close":!1,"destroy-on-close":"",onClose:x},{header:o(()=>[s(Pe,{justify:"center"},{default:o(()=>[s($,{span:5},{default:o(()=>{var U,ee,se,fe;return[H("div",null,[ht,(U=d(n))!=null&&U.flowName?(D(),A("span",Ot," - "+K((ee=d(n))==null?void 0:ee.flowName),1)):N("",!0),(se=d(n))!=null&&se.version?(D(),A("span",$t," - V"+K((fe=d(n))==null?void 0:fe.version),1)):N("",!0)]),s(Ct,{"form-data":d(n),"onUpdate:formData":g[0]||(g[0]=Se=>Y(n)?n.value=Se:null),"active-step":k.value},null,8,["form-data","active-step"])]}),_:1}),s($,{span:14},{default:o(()=>[s(Te,{active:k.value,simple:"","process-status":"finish","finish-status":"success"},{default:o(()=>[(D(),A(G,null,oe(b,(U,ee)=>s(W,{key:ee,title:U,style:{cursor:"pointer"},onClick:se=>I(ee)},null,8,["title","onClick"])),64))]),_:1},8,["active"])]),_:1}),s($,{span:5,style:{"text-align":"right"}},{default:o(()=>[s(X,{disabled:k.value===0,loading:f.value,type:"primary",onClick:g[1]||(g[1]=U=>k.value--)},{default:o(()=>[C(" 上一步 ")]),_:1},8,["disabled","loading"]),s(X,{disabled:k.value===b.length-1,type:"primary",loading:f.value,onClick:g[2]||(g[2]=U=>I())},{default:o(()=>[C(" 下一步 ")]),_:1},8,["disabled","loading"]),s(X,{onClick:x},{default:o(()=>[C(" 关闭 ")]),_:1})]),_:1})]),_:1})]),default:o(()=>[De((D(),A("div",It,[k.value===0?(D(),h(Le,{key:0,ref_key:"formRef",ref:m,modelValue:d(n),"onUpdate:modelValue":g[3]||(g[3]=U=>Y(n)?n.value=U:null),defaults:p.value,"onUpdate:defaults":g[4]||(g[4]=U=>p.value=U),option:d(ze),style:{width:"50%",magin:"0 auto"}},null,8,["modelValue","defaults","option"])):N("",!0),k.value===1?(D(),h(me,{key:1,modelValue:d(n).formOption,"onUpdate:modelValue":g[5]||(g[5]=U=>d(n).formOption=U),fields:O.value},null,8,["modelValue","fields"])):N("",!0),k.value===2?(D(),h(ue,{key:2,modelValue:d(n).flowData,"onUpdate:modelValue":g[6]||(g[6]=U=>d(n).flowData=U),"flow-form-option":d(n).formOption},null,8,["modelValue","flow-form-option"])):N("",!0),k.value===3?(D(),h(Ne,{key:3,icon:"success",title:"流程设计完成"},{extra:o(()=>[d(n).flowDeployId?(D(),h(X,{key:0,type:"primary",onClick:S},{default:o(()=>[C(" 同步到流程定义 ")]),_:1})):N("",!0),d(n).flowDeployId?N("",!0):(D(),h(X,{key:1,type:"primary",onClick:E},{default:o(()=>[C(" 发布 ")]),_:1})),s(X,{onClick:x},{default:o(()=>[C(" 关闭 ")]),_:1})]),_:1})):N("",!0)])),[[Me,f.value]])]),_:1},8,["modelValue"])}}}),Tt=H("span",null,"流程查看",-1),Pt={key:0},Lt={key:1},Nt=M({__name:"index",props:{modelValue:{},visible:{type:Boolean}},setup(u){const a=ce(u),{visible:t,modelValue:l}=a,{request:n}=P(),{getDetail:r}=ae(n),{getDetail:i}=pe(n),v=T("form"),c=T(!1);be(t,async V=>{if(!V)return;const{flowModuleId:y}=l.value,{flowDeployId:b}=l.value;try{c.value=!0;let m={};b?m=await i({flowDeployId:b}):y&&(m=await r({flowModuleId:y})),l.value={...m.data}}finally{c.value=!1}},{immediate:!0});function w(){l.value={},v.value="form"}return(V,y)=>{const b=_("el-tab-pane"),m=_("el-tabs"),p=_("el-dialog"),f=ke("loading");return D(),h(p,{modelValue:d(t),"onUpdate:modelValue":y[3]||(y[3]=F=>Y(t)?t.value=F:null),width:"60%",top:"0",onClose:w},{header:o(()=>{var F,O,k,I;return[Tt,(F=d(l))!=null&&F.flowName?(D(),A("span",Pt," - "+K((O=d(l))==null?void 0:O.flowName),1)):N("",!0),(k=d(l))!=null&&k.version?(D(),A("span",Lt," - V"+K((I=d(l))==null?void 0:I.version),1)):N("",!0)]}),default:o(()=>[De((D(),h(m,{modelValue:v.value,"onUpdate:modelValue":y[2]||(y[2]=F=>v.value=F)},{default:o(()=>[s(b,{label:"查看表单",name:"form",style:{height:"600px","overflow-y":"auto"}},{default:o(()=>[v.value==="form"&&d(l).formOption?(D(),h(me,{key:0,modelValue:d(l).formOption,"onUpdate:modelValue":y[0]||(y[0]=F=>d(l).formOption=F),view:""},null,8,["modelValue"])):N("",!0)]),_:1}),s(b,{label:"查看流程",name:"flow",style:{height:"600px"}},{default:o(()=>[v.value==="flow"?(D(),h(ue,{key:0,modelValue:d(l).flowData,"onUpdate:modelValue":y[1]||(y[1]=F=>d(l).flowData=F),view:""},null,8,["modelValue"])):N("",!0)]),_:1})]),_:1},8,["modelValue"])),[[f,c.value]])]),_:1},8,["modelValue"])}}}),Ut=M({__name:"index",setup(u){const e=T("definition"),a=T({}),t=T(""),l=T("");function n(m){t.value===m.id?t.value="":t.value=m.id}const r=T(!1),i=T(!1);function v(){a.value={},r.value=!0}function c(m){a.value=m,r.value=!0}function w(m){a.value=m,i.value=!0}function V(m){l.value=m.flowModuleId||"",e.value="deploy"}function y(){l.value="",e.value="definition"}async function b(){const m=e.value;await _e(),e.value="",await _e(),e.value=`${m}`}return(m,p)=>{const f=_("el-card"),F=_("el-col"),O=_("el-row");return D(),h(O,{gutter:20},{default:o(()=>[s(F,{span:6},{default:o(()=>[s(f,{header:"流程分类",style:{height:"100%"}},{default:o(()=>[s(Ft,{onNodeClick:n})]),_:1})]),_:1}),s(F,{span:18},{default:o(()=>[e.value==="definition"?(D(),h(Ie,{key:0,"category-id":t.value,onAdd:v,onEdit:c,onView:w,onVersion:V},null,8,["category-id"])):N("",!0),e.value==="deploy"&&l.value?(D(),h(xe,{key:1,"flow-module-id":l.value,onEdit:c,onView:w,onBack:y},null,8,["flow-module-id"])):N("",!0),s(xt,{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=k=>a.value=k),visible:r.value,"onUpdate:visible":p[1]||(p[1]=k=>r.value=k),onClose:b},null,8,["modelValue","visible"]),s(Nt,{modelValue:a.value,"onUpdate:modelValue":p[2]||(p[2]=k=>a.value=k),visible:i.value,"onUpdate:visible":p[3]||(p[3]=k=>i.value=k)},null,8,["modelValue","visible"])]),_:1})]),_:1})}}}),Mt=M({__name:"index",setup(u){const e=pt("debugMode",!1),{request:a}=P(),{getTaskOpsList:t}=gt(a),{bindVal:l,getDataList:n,crudStateRefs:{searchForm:r}}=R({tableOption:We,crudOption:{getList:t},searchForm:{status:te.待办},sortOption:{descs:"start_time"}});le(r,n,{debounce:300,immediate:!0,deep:!0});const{open:i,close:v}=ne();function c(w){i({flowKey:w.flowKey,taskId:w.taskId,instanceId:w.flowInstanceId,debug:e.value,onComplete(){v(),B.success("操作成功"),n()}})}return(w,V)=>{const y=_("el-switch"),b=_("el-button"),m=_("el-link"),p=_("avue-crud");return D(),h(p,z(j(d(l))),{"menu-right":o(()=>[s(b,{type:"text"},{default:o(()=>[s(y,{modelValue:d(e),"onUpdate:modelValue":V[0]||(V[0]=f=>Y(e)?e.value=f:null),"inline-prompt":"","active-text":"debug","inactive-text":"debug"},null,8,["modelValue"])]),_:1})]),processTitle:o(({row:f})=>[s(m,{type:"primary",underline:!1,onClick:F=>c(f)},{default:o(()=>[C(K(f.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)}}}),St=M({__name:"index",setup(u){const{request:e}=P(),{bindVal:a,getDataList:t}=R({tableOption:Je,crudOption:ye(e)});return t(),(l,n)=>{const r=_("avue-crud");return D(),h(r,z(j(d(a))),null,16)}}}),At={class:"flow-list"},Bt=["onClick"],Et={class:"flow-name"},Kt=M({__name:"index",setup(u){const{request:e}=P(),{useList:a}=Ve(e),{usePublishList:t,getTaskList:l}=Ge(e),{data:n}=a(),{data:r}=t(),i=J(()=>{var p;return(p=n.value)==null?void 0:p.map(f=>{var O;const F=((O=r.value)==null?void 0:O.filter(k=>k.categoryId===f.id))??[];return{...f,list:F}}).filter(f=>{var F;return(F=f.list)==null?void 0:F.length})}),v=wt(te).filter((p,f)=>f<2).reverse(),{bindVal:c,getDataList:w,crudStateRefs:{searchForm:V}}=R({tableOption:He,crudOption:{getList:l},searchForm:{status:te.待办}});le(V,w,{debounce:300,immediate:!0,deep:!0});const{open:y,close:b}=ne();function m(p){y({flowKey:p.flowKey,taskId:p.taskId,instanceId:p.flowInstanceId,detail:p.taskId?p.status===te.已办:!1,onComplete(){b(),B.success("操作成功"),w()}})}return(p,f)=>{const F=_("el-button"),O=_("el-divider"),k=_("el-collapse-item"),I=_("el-collapse"),E=_("el-card"),x=_("avue-radio"),S=_("el-link"),L=_("avue-crud");return D(),A(G,null,[s(E,{"body-style":{padding:"0 20px"}},{default:o(()=>[s(I,{"model-value":"1"},{default:o(()=>[s(k,{name:"1"},{title:o(()=>[s(F,{text:"",icon:"el-icon-promotion"},{default:o(()=>[C(" 发起审批 ")]),_:1})]),default:o(()=>[H("div",At,[(D(!0),A(G,null,oe(i.value,g=>(D(),A("div",{key:g.id,class:"flow-category"},[s(O,{"content-position":"left"},{default:o(()=>[C(K(g.name),1)]),_:2},1024),(D(!0),A(G,null,oe(g.list,$=>(D(),A("div",{key:$.flowKey,class:"flow-item",onClick:W=>m($)},[s(d(Z),{class:"flow-icon",icon:$.flowIcon,width:"60"},null,8,["icon"]),H("div",Et,K($.flowName),1)],8,Bt))),128))]))),128))])]),_:1})]),_:1})]),_:1}),s(O),s(L,z(j(d(c))),{"menu-left":o(()=>[s(x,{modelValue:d(V).status,"onUpdate:modelValue":f[0]||(f[0]=g=>d(V).status=g),button:"",dic:d(v)},null,8,["modelValue","dic"])]),processTitle:o(({row:g})=>[s(S,{type:"primary",underline:!1,onClick:$=>m(g)},{default:o(()=>[C(K(g.processTitle||"无标题"),1)]),_:2},1032,["onClick"])]),_:1},16)],64)}}}),Rt=tt(Kt,[["__scopeId","data-v-c424ab4e"]]),zt=M({__name:"index",setup(u){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:t},getDataList:l,handleUpdate:n}=R({tableOption:Qe,crudOption:he(e)});l();const r=T(!1);async function i(c){t.value=c,r.value=!0}async function v(){await n(t.value,Number.NaN,()=>r.value=!1,()=>{})}return(c,w)=>{const V=_("el-button"),y=_("avue-crud"),b=_("el-dialog");return D(),A(G,null,[s(y,z(j(d(a))),{menu:o(({row:m})=>[s(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:p=>i(m)},{default:o(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),s(b,{modelValue:r.value,"onUpdate:modelValue":w[2]||(w[2]=m=>r.value=m),title:`模型设计-${d(t).flowName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[s(V,{type:"primary",onClick:v},{default:o(()=>[C(" 保存 ")]),_:1}),s(V,{onClick:w[1]||(w[1]=m=>r.value=!1)},{default:o(()=>[C(" 取消 ")]),_:1})]),default:o(()=>[s(ue,{modelValue:d(t).flowData,"onUpdate:modelValue":w[0]||(w[0]=m=>d(t).flowData=m),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),jt=M({__name:"index",setup(u){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:t},getDataList:l,handleUpdate:n}=R({tableOption:Xe,crudOption:Oe(e)});l();const r=T(!1);async function i(c){t.value={...c},r.value=!0}async function v(){await n(t.value,Number.NaN,()=>r.value=!1,()=>{})}return(c,w)=>{const V=_("el-button"),y=_("avue-crud"),b=_("el-dialog");return D(),A(G,null,[s(y,z(j(d(a))),{menu:o(({row:m})=>[s(V,{type:"primary",text:"",icon:"el-icon-crop",onClick:p=>i(m)},{default:o(()=>[C(" 设计 ")]),_:2},1032,["onClick"])]),_:1},16),s(b,{modelValue:r.value,"onUpdate:modelValue":w[2]||(w[2]=m=>r.value=m),title:`表单设计-${d(t).formName}`,fullscreen:"","destroy-on-close":""},{footer:o(()=>[s(V,{type:"primary",onClick:v},{default:o(()=>[C(" 保存 ")]),_:1}),s(V,{onClick:w[1]||(w[1]=m=>r.value=!1)},{default:o(()=>[C(" 取消 ")]),_:1})]),default:o(()=>[s(me,{modelValue:d(t).formOption,"onUpdate:modelValue":w[0]||(w[0]=m=>d(t).formOption=m),style:{height:"calc(100vh - 177px)"}},null,8,["modelValue"])]),_:1},8,["modelValue","title"])],64)}}}),Wt=H("br",null,null,-1),Jt=M({__name:"index",setup(u){const{request:e}=P(),{bindVal:a,crudStateRefs:{formData:t,defaults:l},getDataList:n,afterOpen:r,beforeSubmit:i}=R({crudOption:ie(e),tableOption:Ye});n();const{data:v}=ye(e).useParam("table.default.fields");r(p=>{if(t.value.defaultFields=v.value??[],p==="edit"){const f=JSON.parse(t.value.tableFields);t.value.editFields=yt(f,v.value??[],"name")}}),i(p=>{const f=[...p.defaultFields,...p.editFields];p.tableFields=JSON.stringify(f)});const c=T(!1);re(()=>{var p;(p=l.value)!=null&&p.defaultFields&&(l.value.defaultFields.display=c.value)});const{deploy:w,getFields:V}=ie(e),y=T(!1);async function b(p){await Q.confirm("部署将自动生成数据库表，是否确认？","提示",{type:"success"}),y.value=!0,w({id:p.id}).then(()=>{B.success("部署成功"),n()}).finally(()=>{y.value=!1})}function m(){V({tableName:t.value.tableName}).then(p=>{var f;if(!((f=p.data)!=null&&f.length))return B.warning("未找到该表");t.value.editFields=p.data})}return(p,f)=>{const F=_("el-button"),O=_("el-input"),k=_("el-switch"),I=_("el-tooltip"),E=_("avue-crud");return D(),h(E,z(j(d(a))),{menu:o(({row:x})=>[s(F,{type:"text",icon:"el-icon-upload",onClick:S=>b(x)},{default:o(()=>[C(" 部署 ")]),_:2},1032,["onClick"])]),"tableName-form":o(()=>[s(O,{modelValue:d(t).tableName,"onUpdate:modelValue":f[0]||(f[0]=x=>d(t).tableName=x),placeholder:"请输入 表名"},{append:o(()=>[s(F,{type:"primary",size:"default",onClick:m},{default:o(()=>[C(" 导入已有表 ")]),_:1})]),_:1},8,["modelValue"])]),"editFields-label":o(()=>[H("div",null,[C(" 数据库字段 "),Wt,s(I,{content:"显示默认字段"},{default:o(()=>[s(k,{modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=x=>c.value=x)},null,8,["modelValue"])]),_:1})])]),_:1},16)}}}),Gt=M({__name:"index",setup(u){const e=mt(),a=T({}),{FlowForm:t}=P(),l=J(()=>{const r=a.value.flowInstance;return e.detail===!0||e.detail==="true"?`查看流程：${r==null?void 0:r.title}`:e.instanceId||e.taskId?`办理流程：${r==null?void 0:r.title}`:`发起流程：${r==null?void 0:r.title}`});ft(l);async function n(r){window.postMessage({event:"onComplete",data:{...r}})}return(r,i)=>(D(),h(d(t),ge({flowDetail:a.value,"onUpdate:flowDetail":i[0]||(i[0]=v=>a.value=v)},d(e),{onComplete:n}),null,16,["flowDetail"]))}}),Ht=Object.freeze(Object.defineProperty({__proto__:null,PageFlowButton:Dt,PageFlowDefinition:Ie,PageFlowDeploy:xe,PageFlowForm:Gt,PageFlowManage:Ut,PageFlowOps:Mt,PageFlowParam:St,PageFlowTemplate:zt,PageFlowWorkbench:Rt,PageFormTemplate:jt,PageTableTemplate:Jt},Symbol.toStringTag,{value:"Module"})),Jo={install(u,e){P(e),Object.entries(Ht).forEach(([a,t])=>{u.component(a,t)})}};export{Qo as ApprovalForm,Xo as ButtonList,Ae as CONFIG_DEFAULT,Yo as FieldType,Zo as FlowButtonApproval,qo as FlowButtonDisplay,el as FlowButtonKey,tl as FlowButtonStatus,ol as FlowButtonType,ll as FlowForm,al as FlowStatus,nl as HandleType,sl as InternalForm,Ce as IsMainVersion,Dt as PageFlowButton,Ie as PageFlowDefinition,xe as PageFlowDeploy,Gt as PageFlowForm,Ut as PageFlowManage,Mt as PageFlowOps,St as PageFlowParam,zt as PageFlowTemplate,Rt as PageFlowWorkbench,jt as PageFormTemplate,Jt as PageTableTemplate,il as TablePrimary,te as TaskStatus,ul as UploadTable,rl as Whether,je as asyncValidate,Jo as default,dl as defineTableOption,cl as fieldTypeDic,pl as flowFormEmits,ml as flowFormProps,fl as flowTrack,vl as injectionKey,_l as isMobile,wl as mergeColumn,yl as tablePrimaryDic,gl as useButtonHandler,bl as useCommonCommentApi,P as useConfigProvider,kl as useEmitter,Ee as useFlowButtonApi,Ve as useFlowCategoryApi,ae as useFlowDefinitionApi,pe as useFlowDeployApi,Dl as useFlowFileApi,ne as useFlowForm,kt as useFlowFormOverlay,bt as useFlowFormWindow,gt as useFlowOpsApi,ye as useFlowParamApi,Ge as useFlowTaskApi,he as useFlowTemplateApi,Fl as useFlowUserApi,Vl as useFormDefaults,Oe as useFormTemplateApi,Cl as useInjectState,hl as useProvideState,ie as useTableTemplateApi,Ol as whetherDic};
