import{O as I,M as ue,a0 as ce,f as k,a as y,y as w,k as T,v as V,K as ie,S as N,R as g,J as de,e as A,I as me,V as E,B as P,T as $,F as M,L as K,x as be}from"./framework.1859beb2.js";import{a as O,k as ye}from"./theme.d27d32d4.js";import"./index.b942cce0.js";import{e as fe,s as z}from"./index.0246ace1.js";import{f as B}from"./index.7b9b2b88.js";import{d as L}from"./form.eeb0fdf0.js";import{a as J}from"./zipWith.1f1efbd8.js";var H=(t=>(t.用户="user",t.部门="dept",t.岗位="post",t.动态="dynamic",t.指定节点="userTask",t.指定用户="specifyUser",t.自定义="custom",t))(H||{});const Q=Symbol("flowDesignState");function je(t){const n=O(t,void 0,{passive:!0}),{lf:e,modelValue:p,elementData:l,formOptions:a,formData:s,formOption:i,formDefaults:f,dataOptions:d}=n,v=I(!1),h=I(!1);function c(o){var u,_,C;const r=(u=l.value)==null?void 0:u.id;r&&((_=e.value)==null||_.setProperties(r,o)),r&&((C=e.value)==null||C.updateText(r,o.name))}const b=I(),m={lf:e,graphData:p,elementData:l,formRef:b,formData:s,formDefaults:f,formLoading:v,formOption:i,formOptions:a,editorVisible:h,dataOptions:d,onUpdateFormData:c};return ce(Q,m),m}function U(){return ue(Q)}const R=k({__name:"FlowNodeSelect",props:{filterType:{},dic:{}},setup(t){const n=t,{lf:e}=U(),p=y(()=>{var l;return(l=e.value)==null?void 0:l.graphModel.nodes.filter(a=>n.filterType?n.filterType.includes(a.type):!0).map(a=>({label:a.text.value,value:a.id,desc:a.id}))});return(l,a)=>{const s=V("avue-select");return w(),T(s,{dic:p.value},null,8,["dic"])}}}),ve={key:0,style:{display:"flex"}},he=k({__name:"FlowAssigneeSetter",props:{modelValue:{},tableData:{},placeholder:{}},emits:["update:modelValue"],setup(t,{emit:n}){const e=t,p=n,l=I(!1),a=y(()=>{var o,r;return(r=(o=e.tableData)==null?void 0:o.row)==null?void 0:r.type}),s=y(()=>["dept","post","user","specifyUser"].includes(a.value)),{dataOptions:i}=U(),f=y(()=>{const{flowAssigneeUserDic:o=[],flowAssigneeDeptDic:r=[],flowAssigneePostDic:u=[],flowAssigneeDynamicDic:_=[]}=i.value??{};return{user:o,dept:r,post:u,dynamic:_,specifyUser:o,userTask:[]}}),d=y(()=>f.value[a.value]??[]),v=y({get(){return e.modelValue?e.modelValue.split(","):[]},set(o){var r;if(p("update:modelValue",o.join(",")),(r=e.tableData)!=null&&r.row){const u=B(d.value,_=>o==null?void 0:o.includes(_.id));e.tableData.row.idVal=u.map(_=>_[`${a.value.replace("specifyUser","user")}Id`]).join(",")}}}),h=y({get(){return e.modelValue},set(o){p("update:modelValue",o)}});ie(a,()=>{v.value=[],h.value=""});const c=y({get(){return s.value?v.value:h.value},set(o){s.value?v.value=o:h.value=o}});function b(){c.value=B(d.value,o=>o.type===a.value).map(o=>o.id)}const m=y(()=>{const o={clearable:!0,data:d.value,filterable:!0,loading:l.value,nodeKey:"value",placeholder:"请选择"},r={checkStrictly:!["user","specifyUser"].includes(a.value),multiple:!0,showCheckbox:!0,collapseTags:!0,collapseTagsTooltip:!0,maxCollapseTags:3};return{...o,...s.value?r:{}}});return(o,r)=>{const u=V("el-tree-select"),_=V("el-button"),C=V("el-input");return["dept","post","user","specifyUser","dynamic"].includes(a.value)?(w(),N("div",ve,[g(u,de({modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=S=>c.value=S)},m.value,{style:{width:"100%"}}),null,16,["modelValue"]),m.value.multiple?(w(),T(_,{key:0,text:"",type:"primary",icon:"el-icon-check",onClick:b},{default:A(()=>[me(" 全选 ")]),_:1})):E("",!0)])):a.value==="userTask"?(w(),T(R,{key:1,modelValue:h.value,"onUpdate:modelValue":r[1]||(r[1]=S=>h.value=S),"filter-type":"userTask",placeholder:"请选择"},null,8,["modelValue"])):(w(),T(C,{key:2,modelValue:h.value,"onUpdate:modelValue":r[2]||(r[2]=S=>h.value=S),clearable:"",placeholder:"请输入"},null,8,["modelValue"]))}}}),X=k({__name:"FlowAssignee",props:{modelValue:{}},setup(t){const n=t,{modelValue:e}=O(n,void 0,{defaultValue:[]}),p=y(()=>({rowKey:"type",addBtn:!0,column:[{label:"类型",prop:"type",type:"select",width:120,dicData:fe(H)},{label:"值",prop:"value",component:he}]}));return(l,a)=>{const s=V("avue-dynamic");return w(),T(s,{modelValue:P(e),"onUpdate:modelValue":a[0]||(a[0]=i=>$(e)?e.value=i:null),children:p.value},null,8,["modelValue","children"])}}}),Y=[{label:"",labelWidth:0,prop:"assignee",type:"dynamic",component:X,value:[]}],D=[{label:"节点id",prop:"id",readonly:!0},{label:"节点名称",prop:"name"},{label:"节点描述",prop:"desc"}];function _e(t,n){const e=[];return t.forEach(p=>{const l=n.find(i=>i.buttonKey===p.buttonKey);!l||[p.display===l.display,p.approval===l.approval,p.validate===l.validate].every(i=>i)||e.push(l)}),J(e,"buttonKey")}function Z(t,n){const e=[];return t.forEach(p=>{var m,o,r;const l=n.find(u=>u.prop===p.prop);if(!l)return;p.type==="dynamic"&&((o=(m=p.children)==null?void 0:m.column)!=null&&o.length)&&(l.children=Z(p.children.column,(l==null?void 0:l.children)??[]));const{display:a,disabled:s,detail:i,readonly:f,rules:d}={...L,...p},v=!!(d!=null&&d.some(u=>u.required)),h=!!(d!=null&&d.length);[a===l.display,s===l.disabled,i===l.detail,f===l.readonly,v===l.required,h===l.validate].every(u=>u)&&!((r=l.children)!=null&&r.length)||e.push(l)}),J(e,"prop")}function Ae(t,n){return{...t,...n,plugins:[...(t==null?void 0:t.plugins)??[],...(n==null?void 0:n.plugins)??[]]}}function ee(t){return t.map(n=>{var p,l,a;const e={label:n.label,value:n.prop,desc:n.prop};return n.type==="dynamic"&&((l=(p=n.children)==null?void 0:p.column)!=null&&l.length)&&(e.children=ee((a=n.children)==null?void 0:a.column)),e})}const we=k({__name:"FlowButton",props:{modelValue:{}},setup(t){const n=t,{modelValue:e}=O(n,void 0,{defaultValue:[]}),{dataOptions:p}=U();M(async()=>{var a;await z(),e.value=_e(((a=p.value)==null?void 0:a.buttonList)??[],e.value??[])});const l=y(()=>{const{flowButtonDisplayDic:a=[],flowButtonApprovalDic:s=[],flowButtonValidateDic:i=[],buttonList:f=[]}=p.value??{};return{rowKey:"buttonKey",column:[{label:"按钮",prop:"buttonKey",width:100,type:"select",dicData:(f==null?void 0:f.map(v=>({label:v.name,value:v.buttonKey,desc:v.buttonKey})))??[],filterable:!0},{label:"显示条件",prop:"display",type:"select",multiple:!0,dataType:"string",dicData:a??[]},{label:"审批窗口",prop:"approval",type:"select",multiple:!0,dataType:"string",dicData:s??[]},{label:"是否校验",prop:"validate",type:"switch",width:60,dicData:i??[]}]}});return(a,s)=>{const i=V("avue-dynamic");return w(),T(i,{modelValue:P(e),"onUpdate:modelValue":s[0]||(s[0]=f=>$(e)?e.value=f:null),children:l.value},null,8,["modelValue","children"])}}}),q=[{label:"",labelWidth:0,prop:"button",type:"dynamic",component:we,value:[],tip:"需要覆盖默认按钮配置时从这里添加"}],le=[{label:"",labelWidth:0,prop:"circulate",type:"dynamic",component:X,value:[]}],Ve=[{label:"开始",value:"start"},{label:"任务",value:"task"},{label:"结束",value:"end"}],De=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],xe=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],Te=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:Ve},{label:"类型",prop:"eventType",type:"select",dicData:De},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:xe},{label:"值",prop:"fieldValue"}]}}]}}],G=k({__name:"FlowCheckbox",props:{modelValue:{type:Boolean}},setup(t){const n=t,{modelValue:e}=O(n);return(p,l)=>{const a=V("el-checkbox");return w(),N("span",null,[g(a,{modelValue:P(e),"onUpdate:modelValue":l[0]||(l[0]=s=>$(e)?e.value=s:null)},null,8,["modelValue"])])}}}),ge={style:{display:"flex"}},ke={style:{position:"absolute",left:"12px",top:"16px","z-index":"10"}},Ce=K("strong",null," 字段",-1),Ge=k({__name:"FlowFormProperty",props:{modelValue:{}},setup(t){const n=t,{modelValue:e}=O(n,void 0,{defaultValue:[]}),[p,l]=ye(),{dataOptions:a}=U();M(async()=>{var c;await z(),e.value=Z(((c=a.value)==null?void 0:c.formPropertyList)??[],e.value??[])});const s=y(()=>{var c;return ee(((c=a.value)==null?void 0:c.formPropertyList)??[])}),i=y(()=>({rowKey:"prop",defaultExpandAll:!0,column:[{prop:"_index",hide:!0},{label:"",prop:"prop",component:l,type:"select",dicData:s.value??[]},{label:"显示",prop:"display",width:40,component:G},{label:"禁用",prop:"disabled",width:40,component:G},{label:"详情",prop:"detail",width:40,component:G},{label:"只读",prop:"readonly",width:40,component:G},{label:"必填",prop:"required",width:40,component:G},{label:"校验",prop:"validate",width:40,component:G}]}));function f(){e.value.push({...L})}function d(c){const b=e.value.find(m=>m.prop===c);b.children||(b.children=[]),b.children.push({...L,$cellEdit:!0})}function v(c){e.value=B(e.value,b=>b.prop!==c,{flat:!1})}function h(c){return!!s.value.find(m=>{var o;return m.value===c&&((o=m.children)==null?void 0:o.length)})}return(c,b)=>{const m=V("avue-input-tree"),o=V("el-button"),r=V("avue-dynamic");return w(),N(be,null,[g(P(p),null,{default:A(({modelValue:u,"onUpdate:modelValue":_})=>[K("div",ge,[g(m,{"model-value":u,dic:s.value,"default-expand-all":"",filterable:"","onUpdate:modelValue":_},null,8,["model-value","dic","onUpdate:modelValue"]),h(u)?(w(),T(o,{key:0,type:"primary",icon:"el-icon-plus",text:"",onClick:C=>d(u)},null,8,["onClick"])):E("",!0),g(o,{type:"danger",icon:"el-icon-delete",text:"",onClick:C=>v(u)},null,8,["onClick"])])]),_:1}),K("div",null,[K("div",ke,[g(o,{type:"primary",icon:"el-icon-plus",size:"small",circle:"",onClick:f}),Ce]),g(r,{modelValue:P(e),"onUpdate:modelValue":b[0]||(b[0]=u=>$(e)?e.value=u:null),children:i.value},null,8,["modelValue","children"])])],64)}}}),F=[{label:"",labelWidth:0,prop:"formProperty",type:"dynamic",component:Ge,value:[],tip:"需要覆盖默认表单配置时从这里添加"}],ae=[{label:"网关类型",prop:"inout",type:"radio",button:!0,value:"in",dicData:[{label:"进",value:"in"},{label:"出",value:"out"}]},{label:"完成条件",prop:"completionCondition",type:"slider",showInput:!0,showInputControls:!1,labelPosition:"top",step:.01,max:1,value:0,labelTip:"任务完成的百分比，如2人接收，需同时完成才往下进行时=100%，只需1人完成时=50%",span:23,offset:1}],W=[{label:"多实例类型",prop:"multiInstanceType",tip:"选择后节点变更为多人任务",type:"select",dicData:[{label:"并行审批",value:"parallel",desc:"同时接收审批"},{label:"顺序审批",value:"sequential",desc:"按顺序审批"}]},{label:"完成条件",prop:"completionCondition",type:"slider",showInput:!0,showInputControls:!1,labelPosition:"top",step:.01,max:1,value:0,labelTip:"任务完成的百分比，如2人接收，需同时完成才往下进行时=100%，只需1人完成时=50%",span:23,offset:1},{label:"回收任务",prop:"isRecall",type:"switch",value:!1,labelTip:"满足完成条件时，该节点未审批任务是否回收，回收的任务仅保留记录，对应人员无需再办理"}],te=[{label:"节点id",prop:"id",readonly:!0},{label:"节点描述",prop:"name",type:"textarea"}],j=k({__name:"FlowFieldsSelect",props:{dic:{}},setup(t){const{dataOptions:n}=U(),e=y(()=>{var p;return((p=n.value)==null?void 0:p.fieldsDic)??[]});return(p,l)=>{const a=V("avue-select");return w(),T(a,{dic:e.value},null,8,["dic"])}}}),oe=[{label:"跳过第一节点",prop:"skipFirstNode",type:"switch",labelWidth:100,value:!0},{label:"默认驳回节点",prop:"rollbackNode",type:"select",labelWidth:100,component:R,params:{filterType:"userTask"}},{label:"优先级字段",prop:"priority",type:"select",component:j,filterable:!0,allowCreate:!0,defaultFirstOption:!0},{label:"表单标题",prop:"formTitle",separator:"-",type:"select",component:j,dataType:"string",multiple:!0,filterable:!0,allowCreate:!0,defaultFirstOption:!0},{label:"标题分隔符",prop:"formTitleSeparator",value:"-",control(t){return{formTitle:{separator:t}}}}],x=[{label:"",labelWidth:0,prop:"property",type:"dynamic",children:{column:[{label:"属性名",prop:"name"},{label:"属性值",prop:"value",type:"textarea",minRows:1}]},value:[]}],ne=[{label:"条件表达式",prop:"conditionsequenceflow"},{label:"是否为默认分支",prop:"defaultConditions",labelWidth:120,type:"switch",value:!1,change({row:t,value:n}){t.isDefaultFlow=n}}],pe=[{label:"",labelWidth:0,prop:"serial",component:"avue-form",option:{menuBtn:!1,span:24,column:[{label:"名称",prop:"name"},{label:"前缀",prop:"prefix"},{label:"日期格式",prop:"dateFormat"},{label:"后缀位数",prop:"suffixLength"},{label:"初始数值",prop:"startSequence"},{label:"连接符",prop:"connector"},{label:"重置周期",prop:"cycle",type:"select",dicData:[{label:"不重置",value:"none"},{label:"按天重置",value:"day"},{label:"按周重置",value:"week"},{label:"按月重置",value:"month"},{label:"按年重置",value:"year"}]}]}}],re=[{label:"类",prop:"className"},{label:"异步",prop:"isAsync",type:"switch",value:!1}],Se=[{label:"创建",value:"create"},{label:"指派",value:"assignment"},{label:"完成",value:"complete"},{label:"删除",value:"delete"},{label:"更新",value:"update"},{label:"超时",value:"timeout"}],Fe=[{label:"类",value:"class"},{label:"表达式",value:"expression"},{label:"代理表达式",value:"delegateExpression"}],Pe=[{label:"字符串",value:"string"},{label:"表达式",value:"expression"}],Oe=[{label:"",labelWidth:0,prop:"executionListener",type:"dynamic",children:{type:"form",index:!1,column:[{label:"事件",prop:"eventName",type:"select",dicData:Se},{label:"类型",prop:"eventType",type:"select",dicData:Fe},{label:"值",prop:"eventValue",type:"textarea",minRows:1,span:24},{label:"字段",prop:"fields",type:"dynamic",span:24,children:{column:[{label:"字段名",prop:"fieldName"},{label:"类型",prop:"fieldType",type:"select",dicData:Pe},{label:"值",prop:"fieldValue"}]}}]}}],Ue=[{label:"",labelWidth:0,prop:"timeLimit",type:"dynamic",children:{column:[{label:"名称",prop:"name"},{label:"最小值",prop:"min",type:"number"},{label:"最大值",prop:"max",type:"number"}]},value:[]}],se=[{label:"驳回节点",prop:"rollbackNode",type:"select",component:R,params:{filterType:"userTask"}},{label:"重新提交后回到驳回人",prop:"backToRejecter",type:"switch",value:!1}],Ie=[{label:"基本配置",prop:"base",column:D}],Ke={startEvent:[{label:"基本配置",prop:"baseGroup",column:D},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:F},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],endEvent:[{label:"基本配置",prop:"baseGroup",column:D},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:F},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],userTask:[{label:"基本配置",prop:"baseGroup",column:[...D,...se]},{label:"人员配置",prop:"assigneeGroup",column:Y},{label:"多实例配置",prop:"multiInstanceGroup",collapse:!1,column:W},{label:"按钮配置",prop:"buttonGroup",collapse:!1,column:q},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:F},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],serviceTask:[{label:"基本配置",prop:"baseGroup",column:D},{label:"服务配置",prop:"serviceGroup",column:re},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],circulateTask:[{label:"基本配置",prop:"baseGroup",column:D},{label:"传阅配置",prop:"circulateGroup",column:le},{label:"按钮配置",prop:"buttonGroup",collapse:!1,column:q},{label:"表单配置",prop:"formPropertyGroup",collapse:!1,column:F}],sequenceFlow:[{label:"基本配置",prop:"baseGroup",column:D},{label:"条件配置",prop:"sequenceFlowGroup",column:ne},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],parallelGateway:[{label:"基本配置",prop:"baseGroup",column:D},{label:"网关配置",prop:"baseGroup",column:ae}],process:[{label:"流程配置",prop:"baseGroup",column:oe},{label:"流水号配置",prop:"serialGroup",column:pe},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],group:[{label:"基本配置",prop:"baseGroup",column:D},{label:"多实例配置",prop:"multiInstanceGroup",collapse:!1,column:W},{label:"扩展属性",prop:"propertyGroup",collapse:!1,column:x}],note:[{label:"基本配置",prop:"baseGroup",column:te}]},Ee=Object.freeze(Object.defineProperty({__proto__:null,assigneeColumn:Y,baseColumn:D,buttonColumn:q,circulateColumn:le,defaultGroup:Ie,defaultOptions:Ke,executionListenerColumn:Te,formPropertyColumn:F,gatewayColumn:ae,multiInstanceColumn:W,noteColumn:te,processColumn:oe,propertyColumn:x,sequenceFlowColumn:ne,serialColumn:pe,serviceTaskColumn:re,taskListenerColumn:Oe,timeLimitColumn:Ue,userTaskColumn:se},Symbol.toStringTag,{value:"Module"}));export{H as A,Ee as B,U as a,Ke as b,Y as c,Ie as d,D as e,q as f,le as g,Te as h,Q as i,F as j,ae as k,W as l,Ae as m,te as n,x as o,oe as p,pe as q,re as r,ne as s,Oe as t,je as u,Ue as v,se as w,_e as x,Z as y,ee as z};
