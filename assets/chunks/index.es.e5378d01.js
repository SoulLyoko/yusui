import{f as X,g as re,h as me,j as oe,c as ae,d as ge,k as he,l as pe,m as ie,i as ne,n as we,o as Re,p as te,q as Te,S as be}from"./Uint8Array.1590c62a.js";import{b as Ee,d as Ce,e as Oe,f as Ae,i as ye}from"./index.288677a1.js";import{s as Pe,o as Le,i as Se}from"./basePickBy.ac487ef2.js";import{S as xe,H as Q,h as C,C as K,g as P,A as Z,z,B as Ie}from"./framework.f01dabf7.js";function _e(e,t){return Pe(Le(e,t,Se),e+"")}function Fe(e,t,n){if(!X(n))return!1;var o=typeof t;return(o=="number"?re(n)&&me(t,n.length):o=="string"&&t in n)?oe(n[t],e):!1}function Be(e){return _e(function(t,n){var o=-1,a=n.length,u=a>1?n[a-1]:void 0,s=a>2?n[2]:void 0;for(u=e.length>3&&typeof u=="function"?(a--,u):void 0,s&&Fe(n[0],n[1],s)&&(u=a<3?void 0:u,a=1),t=Object(t);++o<a;){var r=n[o];r&&e(t,r,o,u)}return t})}var Ne="[object Object]",De=Function.prototype,$e=Object.prototype,ue=De.toString,Me=$e.hasOwnProperty,We=ue.call(Object);function Qe(e){if(!ae(e)||ge(e)!=Ne)return!1;var t=he(e);if(t===null)return!0;var n=Me.call(t,"constructor")&&t.constructor;return typeof n=="function"&&n instanceof n&&ue.call(n)==We}function Ke(e){return function(t,n,o){for(var a=-1,u=Object(t),s=o(t),r=s.length;r--;){var i=s[e?r:++a];if(n(u[i],i,u)===!1)break}return t}}var je=Ke();const Ge=je;function H(e,t,n){(n!==void 0&&!oe(e[t],n)||n===void 0&&!(t in e))&&pe(e,t,n)}function Ve(e){return ae(e)&&re(e)}function Y(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}function Ue(e){return Ee(e,ie(e))}function He(e,t,n,o,a,u,s){var r=Y(e,n),i=Y(t,n),l=s.get(i);if(l){H(e,n,l);return}var c=u?u(r,i,n+"",e,t,s):void 0,f=c===void 0;if(f){var R=ne(i),v=!R&&we(i),g=!R&&!v&&Re(i);c=i,R||v||g?ne(r)?c=r:Ve(r)?c=Ce(r):v?(f=!1,c=Oe(i,!0)):g?(f=!1,c=Ae(i,!0)):c=[]:Qe(i)||te(i)?(c=r,te(r)?c=Ue(r):(!X(r)||Te(r))&&(c=ye(i))):f=!1}f&&(s.set(i,c),a(c,i,o,u,s),s.delete(i)),H(e,n,c)}function se(e,t,n,o,a){e!==t&&Ge(t,function(u,s){if(a||(a=new be),X(u))He(e,t,s,n,se,o,a);else{var r=o?o(Y(e,s),u,s+"",e,t,a):void 0;r===void 0&&(r=u),H(e,s,r)}},ie)}var Ye=Be(function(e,t,n){se(e,t,n)});const yn=Ye,Je={},Xe=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),Ze=()=>Je,I=e=>e,J=e=>Array.isArray(e),q=e=>e!==null&&typeof e=="object",k=e=>e instanceof Function,N=e=>e==null,ee=typeof window>"u",le=()=>{var e;return ee||N((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ze=()=>{var e,t;return(e=!ee&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},j=()=>new Promise(()=>{}),x=e=>Ie(e)?e.value:e,qe=e=>q(e)?Object.assign(J(e)?[]:{},e):e,$=new Map,ke=e=>N(e)?void 0:$.get(e),en=(e,t,n)=>{const o=$.get(e);o!=null&&o.timer&&clearTimeout(o.timer);const a=setTimeout(()=>$.delete(e),t);$.set(e,{...n,timer:a})};function ce(e,t,n){let o,a,u,s,r,i,l=0,c=!1,f=!1,R=!0;const v=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,q(n)&&(c=!!n.leading,f="maxWait"in n,u=f?Math.max(+n.maxWait||0,t):u,R="trailing"in n?!!n.trailing:R);function g(d){const O=o,A=a;return o=a=void 0,l=d,s=e.apply(A,O),s}function m(d,O){return v?(window.cancelAnimationFrame(r),window.requestAnimationFrame(d)):setTimeout(d,O)}function b(d){if(v)return window.cancelAnimationFrame(d);clearTimeout(d)}function h(d){return l=d,r=m(T,t),c?g(d):s}function w(d){const O=d-i,A=d-l,F=t-O;return f?Math.min(F,u-A):F}function p(d){const O=d-i,A=d-l;return i===void 0||O>=t||O<0||f&&A>=u}function T(){const d=Date.now();if(p(d))return E(d);r=m(T,w(d))}function E(d){return r=void 0,R&&o?g(d):(o=a=void 0,s)}function y(){r!==void 0&&b(r),l=0,o=i=a=r=void 0}function L(){return r===void 0?s:E(Date.now())}function _(){return r!==void 0}function S(){const d=Date.now(),O=p(d);for(var A=arguments.length,F=new Array(A),D=0;D<A;D++)F[D]=arguments[D];if(o=F,a=this,i=d,O){if(r===void 0)return h(i);if(f)return r=m(T,t),g(i)}return r===void 0&&(r=m(T,t)),s}return S.cancel=y,S.flush=L,S.pending=_,S}function nn(e,t,n){let o=!0,a=!0;if(typeof e!="function")throw new TypeError("Expected a function");return q(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),ce(e,t,{leading:o,trailing:a,maxWait:t})}var tn=I((e,t)=>{let{debounceInterval:n,debounceOptions:o,manual:a}=t;const u=C(!1),s=C(),r=P(()=>o),i=P(()=>x(n)),l=C(e.context.runAsync);return a||(u.value=!0),Z(c=>{N(i.value)||(s.value=ce(f=>f(),i.value,r.value),e.context.runAsync=function(){for(var f=arguments.length,R=new Array(f),v=0;v<f;v++)R[v]=arguments[v];return new Promise((g,m)=>{u.value?(u.value=!1,l.value(...R).then(g).catch(m)):s.value(()=>{l.value(...R).then(g).catch(m)})})},c(()=>{var f;(f=s.value)===null||f===void 0||f.cancel(),e.context.runAsync=l.value}))}),{onCancel(){var c;(c=s.value)===null||c===void 0||c.cancel()}}}),rn=I((e,t)=>{let{errorRetryCount:n=0,errorRetryInterval:o=0}=t;const a=C(),u=C(0),s=P(()=>x(n)),r=P(()=>x(o));let i=!1;const l=()=>{u.value=0},c=P(()=>{if(r.value)return r.value;const v=1e3,g=1,m=9,b=Math.floor(Math.random()*2**Math.min(u.value,m)+g);return v*b}),f=()=>{let v;const g=s.value===-1,m=u.value<s.value;return(g||m)&&(g||(u.value+=1),v=setTimeout(()=>{i=!0,e.context.refresh()},c.value)),()=>v&&clearTimeout(v)},R=()=>{a.value&&a.value()};return{onBefore(){i||l(),i=!1,R()},onSuccess(){l()},onError(){a.value=f()},onCancel(){l(),R()}}}),on=I((e,t)=>{let{ready:n=C(!0),manual:o,defaultParams:a=[]}=t;return z(n,u=>{!o&&u&&e.context.run(...a)},{flush:"sync"}),{onBefore(){if(!(k(n)?n():n.value))return e.loading.value=!1,{isBreak:!0}}}}),an=I((e,t)=>{let{refreshDeps:n,refreshDepsAction:o,manual:a}=t;if(n===void 0||J(n)&&n.length===0)return{};const u=J(n)?n:[n];return z(u,()=>{o?o():!a&&e.context.refresh()}),{}}),un=I((e,t)=>{let{throttleInterval:n,throttleOptions:o}=t;const a=C(),u=P(()=>x(n)),s=P(()=>o),r=C(e.context.runAsync);return Z(i=>{if(N(n))return{};a.value=nn(l=>l(),u.value,s.value),e.context.runAsync=function(){for(var l=arguments.length,c=new Array(l),f=0;f<l;f++)c[f]=arguments[f];return new Promise((R,v)=>{a.value(()=>{r.value(...c).then(R).catch(v)})})},i(()=>{var l;(l=a.value)===null||l===void 0||l.cancel(),e.context.runAsync=r.value})}),{onCancel(){var i;(i=a.value)===null||i===void 0||i.cancel()}}});const sn=(e,t)=>n=>{Object.keys(n).forEach(o=>{e[o].value=n[o]}),t.forEach(o=>o(e))},ln=(e,t)=>()=>{let n=t;for(let o=e.length;o-- >0;)n=e[o](n);return n()},cn=(e,t,n)=>{var o,a;const{initialData:u,onSuccess:s,onError:r,onBefore:i,onAfter:l}=t,c=C((o=n==null?void 0:n.loading)!==null&&o!==void 0?o:!1),f=K((a=n==null?void 0:n.data)!==null&&a!==void 0?a:u),R=K(n==null?void 0:n.error),v=C(n==null?void 0:n.params),g=C([]),m=K("pending"),b={},h=sn({status:m,loading:c,data:f,error:R,params:v},[]),w=function(T){for(var E=arguments.length,y=new Array(E>1?E-1:0),L=1;L<E;L++)y[L-1]=arguments[L];if(T==="onQuery"){const _=g.value.map(S=>S.onQuery).filter(Boolean);return{servicePromise:ln(_,y[0])()}}else{const _=g.value.map(S=>{var d;return(d=S[T])===null||d===void 0?void 0:d.call(S,...y)});return Object.assign({},..._)}},p=C(0);return b.runAsync=async function(){for(var T=arguments.length,E=new Array(T),y=0;y<T;y++)E[y]=arguments[y];h({loading:!0,params:E,status:"pending"}),p.value+=1;const L=p.value,{isBreak:_,breakResult:S=j()}=w("onBefore",E);if(_)return h({status:"settled"}),S;i==null||i(E);try{const d=()=>new Promise(F=>F(e(...v.value)));let{servicePromise:O}=w("onQuery",d);O||(O=d());const A=await O;return L!==p.value?j():(h({data:A,loading:!1,error:void 0,status:"settled"}),w("onSuccess",A,E),s==null||s(A,E),L===p.value&&w("onAfter",E,A,void 0),l==null||l(E),A)}catch(d){if(L!==p.value)return j();throw h({loading:!1,error:d,status:"settled"}),w("onError",d,E),r==null||r(d,E),L===p.value&&w("onAfter",E,void 0,d),l==null||l(E),d}},b.run=function(){b.runAsync(...arguments).catch(T=>{r||console.error(T)})},b.cancel=()=>{p.value+=1,h({loading:!1}),w("onCancel")},b.refresh=()=>{b.run(...v.value||[])},b.refreshAsync=()=>b.runAsync(...v.value||[]),b.mutate=T=>{const E=k(T)?T(f.value):T,y=qe(E);h({data:y}),w("onMutate",y)},{status:m,loading:c,data:f,error:R,params:v,plugins:g,context:b}};function fn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const o=xe(Xe,{}),a={...Ze(),...o,...t},{manual:u=!1,defaultParams:s=[]}=a,r=cn(e,a);if(r.plugins.value=n.map(i=>i(r,a)),!u){const i=r.params.value||s;r.context.run(...i)}return Q(()=>{r.context.cancel()}),{loading:r.loading,data:r.data,error:r.error,params:r.params,cancel:r.context.cancel,refresh:r.context.refresh,refreshAsync:r.context.refreshAsync,mutate:r.context.mutate,run:r.context.run,runAsync:r.context.runAsync}}const M=new Map,dn=(e,t)=>{M.set(e,t),t.then(n=>(M.delete(e),n)).catch(()=>{M.delete(e)})},vn=e=>M.get(e),B=new Map,mn=(e,t)=>{B.has(e)&&B.get(e).forEach(n=>n(t))},gn=(e,t)=>(B.has(e)?B.get(e).push(t):B.set(e,[t]),()=>{const n=B.get(e).indexOf(t);B.get(e).splice(n,1)});var hn=I((e,t)=>{let{cacheKey:n,cacheTime:o=6e5,staleTime:a=0,getCache:u,setCache:s}=t;if(!n)return{};const r=k(n)?n:()=>n,i=C(()=>{});let l;const c=h=>u?u(h):ke(h),f=(h,w,p)=>{s?s(h,p):en(h,w,p),mn(h,p.data)},R=h=>a===-1||h+a>new Date().getTime(),v=(h,w)=>Object.prototype.hasOwnProperty.call(h,w),g=h=>{const w=r(h);return gn(w,p=>{e.data.value=p})},m=r(),b=c(m);return b&&v(b,"data")&&(e.data.value=b.data,e.params.value=b.params),m&&(i.value=g()),Q(()=>{i.value()}),{onBefore(h){const w=r(h),p=c(w);if(!p||!v(p,"data"))return{};if(R(p.time))return e.data.value=p.data,e.loading.value=!1,{isBreak:!0,breakResult:p.data};e.data.value=p.data},onQuery(h){const w=e.params.value,p=r(w);let T=vn(p);return T&&T!==l?()=>T:(T=h(),l=T,dn(p,T),()=>T)},onSuccess(h,w){const p=r(w);p&&(i.value(),f(p,o,{data:h,params:w,time:new Date().getTime()}),i.value=g(w))},onMutate(h){const w=r(e.params.value);w&&(i.value(),f(w,o,{data:h,params:e.params.value,time:new Date().getTime()}),i.value=g(e.params.value))}}});function pn(e){let t,n;class o extends Promise{constructor(u){super(u),this.cancel=()=>{n(),clearTimeout(t)}}}return new o(a=>{n=a,t=setTimeout(n,e)})}function G(){return new Date().getTime()}var wn=I((e,t)=>{let{loadingDelay:n=0,loadingKeep:o=0}=t;const a=C(()=>{}),u=P(()=>x(n)),s=P(()=>x(o));let r=0,i={};const l=()=>{let c;return u.value&&(c=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},u.value)),()=>c&&clearTimeout(c)};return{onBefore(){e.loading.value=!u.value,a.value(),a.value=l(),r=G()},onQuery(c){if(!s.value)return()=>c();i=pn(s.value+u.value);const f=async()=>{try{const v=await c();return G()-r<=u.value&&i.cancel(),Promise.resolve(v)}catch(v){return G()-r<=u.value&&i.cancel(),Promise.reject(v)}},R=Promise.allSettled([f(),i]).then(v=>{const g=v[0];return g.status==="fulfilled"?g.value:Promise.reject(g.reason)});return()=>R},onCancel(){a.value()},onAfter(){a.value()}}}),V;const fe=new Set,de=new Set,ve=new Set,W=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=fe;break;case"RECONNECT_LISTENER":n=ve;break;case"VISIBLE_LISTENER":n=de;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},U=e=>{e.forEach(t=>{t()})};!ee&&(V=window)!==null&&V!==void 0&&V.addEventListener&&(window.addEventListener("visibilitychange",()=>{le()&&U(de)},!1),window.addEventListener("focus",()=>U(fe),!1),window.addEventListener("online",()=>U(ve),!1));var Rn=I((e,t)=>{let{pollingInterval:n,pollingWhenHidden:o=!1,pollingWhenOffline:a=!1,errorRetryCount:u=0}=t;const s=C(),r=C(!1),i=P(()=>x(n)),l=P(()=>x(u)),c=[],f=m=>{m&&c.push(m)},R=()=>(o||le())&&(a||ze()),v=m=>{if(e.error.value&&l.value!==0)return;let b;if(!N(i.value)&&i.value>=0)if(R())b=setTimeout(m,i.value);else{r.value=!0;return}return()=>b&&clearTimeout(b)},g=()=>{r.value&&R()&&(e.context.refresh(),r.value=!1)};return z(i,()=>{s.value&&(s.value(),s.value=v(()=>e.context.refresh()))}),o||f(W("VISIBLE_LISTENER",g)),a||f(W("RECONNECT_LISTENER",g)),Q(()=>{c.forEach(m=>m())}),{onBefore(){var m;(m=s.value)===null||m===void 0||m.call(s)},onCancel(){var m;(m=s.value)===null||m===void 0||m.call(s)},onAfter(){s.value=v(()=>e.context.refresh())}}});const Tn=(e,t)=>{let n=!1;return function(){n||(n=!0,e(...arguments),setTimeout(()=>{n=!1},t))}};var bn=I((e,t)=>{let{refreshOnWindowFocus:n=!1,refocusTimespan:o=5e3}=t;const a=P(()=>x(n)),u=P(()=>x(o)),s=[],r=l=>{l&&s.push(l)},i=()=>{s.forEach(l=>l())};return Z(()=>{if(i(),a.value){const l=Tn(e.context.refresh,u.value);r(W("VISIBLE_LISTENER",l)),r(W("FOCUS_LISTENER",l))}}),Q(()=>{i()}),{}});function Pn(e,t){return fn(e,t,[wn,rn,tn,Rn,un,bn,an,on,hn])}export{Qe as a,_e as b,Ge as c,Be as d,Fe as e,se as f,Ke as g,Ve as i,yn as m,Ue as t,Pn as u};
